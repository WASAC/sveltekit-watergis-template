var Uy=Object.defineProperty;var qm=Object.getOwnPropertySymbols;var Vy=Object.prototype.hasOwnProperty,Ny=Object.prototype.propertyIsEnumerable;var Gm=(A,w,C)=>w in A?Uy(A,w,{enumerable:!0,configurable:!0,writable:!0,value:C}):A[w]=C,Yc=(A,w)=>{for(var C in w||(w={}))Vy.call(w,C)&&Gm(A,C,w[C]);if(qm)for(var C of qm(w))Ny.call(w,C)&&Gm(A,C,w[C]);return A};import{K as Tp,L as jy,M as qy,N as Gy,S as xs,i as bs,s as ws,F as ou,C as kr,e as zo,c as Po,a as vs,d as ki,O as Ka,g as cr,P as Ja,G as au,H as su,I as lu,z as uu,Q as nh,q as tn,o as rn,R as oh,T as _o,U as cu,v as Jf,V as hu,W as Zy,X as qs,w as Wo,l as ru,x as Ya,y as Ko,A as Oh,p as Yf,B as Jo,Y as wd,r as Ed,Z as wg,n as Qf,_ as Xy,E as Zu,b as On,k as Sl,m as Tl,$ as $y,J as em,a0 as Hy,t as Id,h as Cd,j as Wy}from"./index-865578a0.js";import{r as Ky,_ as kf}from"./preload-helper-0cd93918.js";/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Gf=function(A,w){return Gf=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,D){C.__proto__=D}||function(C,D){for(var U in D)Object.prototype.hasOwnProperty.call(D,U)&&(C[U]=D[U])},Gf(A,w)};function jh(A,w){if(typeof w!="function"&&w!==null)throw new TypeError("Class extends value "+String(w)+" is not a constructor or null");Gf(A,w);function C(){this.constructor=A}A.prototype=w===null?Object.create(w):(C.prototype=w.prototype,new C)}var Xu=function(){return Xu=Object.assign||function(w){for(var C,D=1,U=arguments.length;D<U;D++){C=arguments[D];for(var H in C)Object.prototype.hasOwnProperty.call(C,H)&&(w[H]=C[H])}return w},Xu.apply(this,arguments)};function ld(A){var w=typeof Symbol=="function"&&Symbol.iterator,C=w&&A[w],D=0;if(C)return C.call(A);if(A&&typeof A.length=="number")return{next:function(){return A&&D>=A.length&&(A=void 0),{value:A&&A[D++],done:!A}}};throw new TypeError(w?"Object is not iterable.":"Symbol.iterator is not defined.")}/**
 * @license
 * Copyright 2016 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var tm=function(){function A(w){w===void 0&&(w={}),this.adapter=w}return Object.defineProperty(A,"cssClasses",{get:function(){return{}},enumerable:!1,configurable:!0}),Object.defineProperty(A,"strings",{get:function(){return{}},enumerable:!1,configurable:!0}),Object.defineProperty(A,"numbers",{get:function(){return{}},enumerable:!1,configurable:!0}),Object.defineProperty(A,"defaultAdapter",{get:function(){return{}},enumerable:!1,configurable:!0}),A.prototype.init=function(){},A.prototype.destroy=function(){},A}();/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */function Jy(A){return A===void 0&&(A=window),Yy(A)?{passive:!0}:!1}function Yy(A){A===void 0&&(A=window);var w=!1;try{var C={get passive(){return w=!0,!1}},D=function(){};A.document.addEventListener("test",D,C),A.document.removeEventListener("test",D,C)}catch{w=!1}return w}var Qy=Object.freeze(Object.defineProperty({__proto__:null,applyPassive:Jy},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */function e_(A,w){if(A.closest)return A.closest(w);for(var C=A;C;){if(Eg(C,w))return C;C=C.parentElement}return null}function Eg(A,w){var C=A.matches||A.webkitMatchesSelector||A.msMatchesSelector;return C.call(A,w)}function t_(A){var w=A;if(w.offsetParent!==null)return w.scrollWidth;var C=w.cloneNode(!0);C.style.setProperty("position","absolute"),C.style.setProperty("transform","translate(-9999px, -9999px)"),document.documentElement.appendChild(C);var D=C.scrollWidth;return document.documentElement.removeChild(C),D}var i_=Object.freeze(Object.defineProperty({__proto__:null,closest:e_,matches:Eg,estimateScrollWidth:t_},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2016 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var r_={BG_FOCUSED:"mdc-ripple-upgraded--background-focused",FG_ACTIVATION:"mdc-ripple-upgraded--foreground-activation",FG_DEACTIVATION:"mdc-ripple-upgraded--foreground-deactivation",ROOT:"mdc-ripple-upgraded",UNBOUNDED:"mdc-ripple-upgraded--unbounded"},n_={VAR_FG_SCALE:"--mdc-ripple-fg-scale",VAR_FG_SIZE:"--mdc-ripple-fg-size",VAR_FG_TRANSLATE_END:"--mdc-ripple-fg-translate-end",VAR_FG_TRANSLATE_START:"--mdc-ripple-fg-translate-start",VAR_LEFT:"--mdc-ripple-left",VAR_TOP:"--mdc-ripple-top"},Zm={DEACTIVATION_TIMEOUT_MS:225,FG_DEACTIVATION_MS:150,INITIAL_ORIGIN_SCALE:.6,PADDING:10,TAP_DELAY_MS:300},ud;function o_(A,w){w===void 0&&(w=!1);var C=A.CSS,D=ud;if(typeof ud=="boolean"&&!w)return ud;var U=C&&typeof C.supports=="function";if(!U)return!1;var H=C.supports("--css-vars","yes"),m=C.supports("(--css-vars: yes)")&&C.supports("color","#00000000");return D=H||m,w||(ud=D),D}function a_(A,w,C){if(!A)return{x:0,y:0};var D=w.x,U=w.y,H=D+C.left,m=U+C.top,g,Z;if(A.type==="touchstart"){var ve=A;g=ve.changedTouches[0].pageX-H,Z=ve.changedTouches[0].pageY-m}else{var he=A;g=he.pageX-H,Z=he.pageY-m}return{x:g,y:Z}}/**
 * @license
 * Copyright 2016 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var Xm=["touchstart","pointerdown","mousedown","keydown"],$m=["touchend","pointerup","mouseup","contextmenu"],cd=[],s_=function(A){jh(w,A);function w(C){var D=A.call(this,Xu(Xu({},w.defaultAdapter),C))||this;return D.activationAnimationHasEnded=!1,D.activationTimer=0,D.fgDeactivationRemovalTimer=0,D.fgScale="0",D.frame={width:0,height:0},D.initialSize=0,D.layoutFrame=0,D.maxRadius=0,D.unboundedCoords={left:0,top:0},D.activationState=D.defaultActivationState(),D.activationTimerCallback=function(){D.activationAnimationHasEnded=!0,D.runDeactivationUXLogicIfReady()},D.activateHandler=function(U){D.activateImpl(U)},D.deactivateHandler=function(){D.deactivateImpl()},D.focusHandler=function(){D.handleFocus()},D.blurHandler=function(){D.handleBlur()},D.resizeHandler=function(){D.layout()},D}return Object.defineProperty(w,"cssClasses",{get:function(){return r_},enumerable:!1,configurable:!0}),Object.defineProperty(w,"strings",{get:function(){return n_},enumerable:!1,configurable:!0}),Object.defineProperty(w,"numbers",{get:function(){return Zm},enumerable:!1,configurable:!0}),Object.defineProperty(w,"defaultAdapter",{get:function(){return{addClass:function(){},browserSupportsCssVars:function(){return!0},computeBoundingRect:function(){return{top:0,right:0,bottom:0,left:0,width:0,height:0}},containsEventTarget:function(){return!0},deregisterDocumentInteractionHandler:function(){},deregisterInteractionHandler:function(){},deregisterResizeHandler:function(){},getWindowPageOffset:function(){return{x:0,y:0}},isSurfaceActive:function(){return!0},isSurfaceDisabled:function(){return!0},isUnbounded:function(){return!0},registerDocumentInteractionHandler:function(){},registerInteractionHandler:function(){},registerResizeHandler:function(){},removeClass:function(){},updateCssVariable:function(){}}},enumerable:!1,configurable:!0}),w.prototype.init=function(){var C=this,D=this.supportsPressRipple();if(this.registerRootHandlers(D),D){var U=w.cssClasses,H=U.ROOT,m=U.UNBOUNDED;requestAnimationFrame(function(){C.adapter.addClass(H),C.adapter.isUnbounded()&&(C.adapter.addClass(m),C.layoutInternal())})}},w.prototype.destroy=function(){var C=this;if(this.supportsPressRipple()){this.activationTimer&&(clearTimeout(this.activationTimer),this.activationTimer=0,this.adapter.removeClass(w.cssClasses.FG_ACTIVATION)),this.fgDeactivationRemovalTimer&&(clearTimeout(this.fgDeactivationRemovalTimer),this.fgDeactivationRemovalTimer=0,this.adapter.removeClass(w.cssClasses.FG_DEACTIVATION));var D=w.cssClasses,U=D.ROOT,H=D.UNBOUNDED;requestAnimationFrame(function(){C.adapter.removeClass(U),C.adapter.removeClass(H),C.removeCssVars()})}this.deregisterRootHandlers(),this.deregisterDeactivationHandlers()},w.prototype.activate=function(C){this.activateImpl(C)},w.prototype.deactivate=function(){this.deactivateImpl()},w.prototype.layout=function(){var C=this;this.layoutFrame&&cancelAnimationFrame(this.layoutFrame),this.layoutFrame=requestAnimationFrame(function(){C.layoutInternal(),C.layoutFrame=0})},w.prototype.setUnbounded=function(C){var D=w.cssClasses.UNBOUNDED;C?this.adapter.addClass(D):this.adapter.removeClass(D)},w.prototype.handleFocus=function(){var C=this;requestAnimationFrame(function(){return C.adapter.addClass(w.cssClasses.BG_FOCUSED)})},w.prototype.handleBlur=function(){var C=this;requestAnimationFrame(function(){return C.adapter.removeClass(w.cssClasses.BG_FOCUSED)})},w.prototype.supportsPressRipple=function(){return this.adapter.browserSupportsCssVars()},w.prototype.defaultActivationState=function(){return{activationEvent:void 0,hasDeactivationUXRun:!1,isActivated:!1,isProgrammatic:!1,wasActivatedByPointer:!1,wasElementMadeActive:!1}},w.prototype.registerRootHandlers=function(C){var D,U;if(C){try{for(var H=ld(Xm),m=H.next();!m.done;m=H.next()){var g=m.value;this.adapter.registerInteractionHandler(g,this.activateHandler)}}catch(Z){D={error:Z}}finally{try{m&&!m.done&&(U=H.return)&&U.call(H)}finally{if(D)throw D.error}}this.adapter.isUnbounded()&&this.adapter.registerResizeHandler(this.resizeHandler)}this.adapter.registerInteractionHandler("focus",this.focusHandler),this.adapter.registerInteractionHandler("blur",this.blurHandler)},w.prototype.registerDeactivationHandlers=function(C){var D,U;if(C.type==="keydown")this.adapter.registerInteractionHandler("keyup",this.deactivateHandler);else try{for(var H=ld($m),m=H.next();!m.done;m=H.next()){var g=m.value;this.adapter.registerDocumentInteractionHandler(g,this.deactivateHandler)}}catch(Z){D={error:Z}}finally{try{m&&!m.done&&(U=H.return)&&U.call(H)}finally{if(D)throw D.error}}},w.prototype.deregisterRootHandlers=function(){var C,D;try{for(var U=ld(Xm),H=U.next();!H.done;H=U.next()){var m=H.value;this.adapter.deregisterInteractionHandler(m,this.activateHandler)}}catch(g){C={error:g}}finally{try{H&&!H.done&&(D=U.return)&&D.call(U)}finally{if(C)throw C.error}}this.adapter.deregisterInteractionHandler("focus",this.focusHandler),this.adapter.deregisterInteractionHandler("blur",this.blurHandler),this.adapter.isUnbounded()&&this.adapter.deregisterResizeHandler(this.resizeHandler)},w.prototype.deregisterDeactivationHandlers=function(){var C,D;this.adapter.deregisterInteractionHandler("keyup",this.deactivateHandler);try{for(var U=ld($m),H=U.next();!H.done;H=U.next()){var m=H.value;this.adapter.deregisterDocumentInteractionHandler(m,this.deactivateHandler)}}catch(g){C={error:g}}finally{try{H&&!H.done&&(D=U.return)&&D.call(U)}finally{if(C)throw C.error}}},w.prototype.removeCssVars=function(){var C=this,D=w.strings,U=Object.keys(D);U.forEach(function(H){H.indexOf("VAR_")===0&&C.adapter.updateCssVariable(D[H],null)})},w.prototype.activateImpl=function(C){var D=this;if(!this.adapter.isSurfaceDisabled()){var U=this.activationState;if(!U.isActivated){var H=this.previousActivationEvent,m=H&&C!==void 0&&H.type!==C.type;if(!m){U.isActivated=!0,U.isProgrammatic=C===void 0,U.activationEvent=C,U.wasActivatedByPointer=U.isProgrammatic?!1:C!==void 0&&(C.type==="mousedown"||C.type==="touchstart"||C.type==="pointerdown");var g=C!==void 0&&cd.length>0&&cd.some(function(Z){return D.adapter.containsEventTarget(Z)});if(g){this.resetActivationState();return}C!==void 0&&(cd.push(C.target),this.registerDeactivationHandlers(C)),U.wasElementMadeActive=this.checkElementMadeActive(C),U.wasElementMadeActive&&this.animateActivation(),requestAnimationFrame(function(){cd=[],!U.wasElementMadeActive&&C!==void 0&&(C.key===" "||C.keyCode===32)&&(U.wasElementMadeActive=D.checkElementMadeActive(C),U.wasElementMadeActive&&D.animateActivation()),U.wasElementMadeActive||(D.activationState=D.defaultActivationState())})}}}},w.prototype.checkElementMadeActive=function(C){return C!==void 0&&C.type==="keydown"?this.adapter.isSurfaceActive():!0},w.prototype.animateActivation=function(){var C=this,D=w.strings,U=D.VAR_FG_TRANSLATE_START,H=D.VAR_FG_TRANSLATE_END,m=w.cssClasses,g=m.FG_DEACTIVATION,Z=m.FG_ACTIVATION,ve=w.numbers.DEACTIVATION_TIMEOUT_MS;this.layoutInternal();var he="",ye="";if(!this.adapter.isUnbounded()){var re=this.getFgTranslationCoordinates(),it=re.startPoint,et=re.endPoint;he=it.x+"px, "+it.y+"px",ye=et.x+"px, "+et.y+"px"}this.adapter.updateCssVariable(U,he),this.adapter.updateCssVariable(H,ye),clearTimeout(this.activationTimer),clearTimeout(this.fgDeactivationRemovalTimer),this.rmBoundedActivationClasses(),this.adapter.removeClass(g),this.adapter.computeBoundingRect(),this.adapter.addClass(Z),this.activationTimer=setTimeout(function(){C.activationTimerCallback()},ve)},w.prototype.getFgTranslationCoordinates=function(){var C=this.activationState,D=C.activationEvent,U=C.wasActivatedByPointer,H;U?H=a_(D,this.adapter.getWindowPageOffset(),this.adapter.computeBoundingRect()):H={x:this.frame.width/2,y:this.frame.height/2},H={x:H.x-this.initialSize/2,y:H.y-this.initialSize/2};var m={x:this.frame.width/2-this.initialSize/2,y:this.frame.height/2-this.initialSize/2};return{startPoint:H,endPoint:m}},w.prototype.runDeactivationUXLogicIfReady=function(){var C=this,D=w.cssClasses.FG_DEACTIVATION,U=this.activationState,H=U.hasDeactivationUXRun,m=U.isActivated,g=H||!m;g&&this.activationAnimationHasEnded&&(this.rmBoundedActivationClasses(),this.adapter.addClass(D),this.fgDeactivationRemovalTimer=setTimeout(function(){C.adapter.removeClass(D)},Zm.FG_DEACTIVATION_MS))},w.prototype.rmBoundedActivationClasses=function(){var C=w.cssClasses.FG_ACTIVATION;this.adapter.removeClass(C),this.activationAnimationHasEnded=!1,this.adapter.computeBoundingRect()},w.prototype.resetActivationState=function(){var C=this;this.previousActivationEvent=this.activationState.activationEvent,this.activationState=this.defaultActivationState(),setTimeout(function(){return C.previousActivationEvent=void 0},w.numbers.TAP_DELAY_MS)},w.prototype.deactivateImpl=function(){var C=this,D=this.activationState;if(!!D.isActivated){var U=Xu({},D);D.isProgrammatic?(requestAnimationFrame(function(){C.animateDeactivation(U)}),this.resetActivationState()):(this.deregisterDeactivationHandlers(),requestAnimationFrame(function(){C.activationState.hasDeactivationUXRun=!0,C.animateDeactivation(U),C.resetActivationState()}))}},w.prototype.animateDeactivation=function(C){var D=C.wasActivatedByPointer,U=C.wasElementMadeActive;(D||U)&&this.runDeactivationUXLogicIfReady()},w.prototype.layoutInternal=function(){var C=this;this.frame=this.adapter.computeBoundingRect();var D=Math.max(this.frame.height,this.frame.width),U=function(){var m=Math.sqrt(Math.pow(C.frame.width,2)+Math.pow(C.frame.height,2));return m+w.numbers.PADDING};this.maxRadius=this.adapter.isUnbounded()?D:U();var H=Math.floor(D*w.numbers.INITIAL_ORIGIN_SCALE);this.adapter.isUnbounded()&&H%2!==0?this.initialSize=H-1:this.initialSize=H,this.fgScale=""+this.maxRadius/this.initialSize,this.updateLayoutCssVars()},w.prototype.updateLayoutCssVars=function(){var C=w.strings,D=C.VAR_FG_SIZE,U=C.VAR_LEFT,H=C.VAR_TOP,m=C.VAR_FG_SCALE;this.adapter.updateCssVariable(D,this.initialSize+"px"),this.adapter.updateCssVariable(m,this.fgScale),this.adapter.isUnbounded()&&(this.unboundedCoords={left:Math.round(this.frame.width/2-this.initialSize/2),top:Math.round(this.frame.height/2-this.initialSize/2)},this.adapter.updateCssVariable(U,this.unboundedCoords.left+"px"),this.adapter.updateCssVariable(H,this.unboundedCoords.top+"px"))},w}(tm);/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var ih={FIXED_CLASS:"mdc-top-app-bar--fixed",FIXED_SCROLLED_CLASS:"mdc-top-app-bar--fixed-scrolled",SHORT_CLASS:"mdc-top-app-bar--short",SHORT_COLLAPSED_CLASS:"mdc-top-app-bar--short-collapsed",SHORT_HAS_ACTION_ITEM_CLASS:"mdc-top-app-bar--short-has-action-item"},_d={DEBOUNCE_THROTTLE_RESIZE_TIME_MS:100,MAX_TOP_APP_BAR_HEIGHT:128},l_={ACTION_ITEM_SELECTOR:".mdc-top-app-bar__action-item",NAVIGATION_EVENT:"MDCTopAppBar:nav",NAVIGATION_ICON_SELECTOR:".mdc-top-app-bar__navigation-icon",ROOT_SELECTOR:".mdc-top-app-bar",TITLE_SELECTOR:".mdc-top-app-bar__title"};/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var im=function(A){jh(w,A);function w(C){return A.call(this,Xu(Xu({},w.defaultAdapter),C))||this}return Object.defineProperty(w,"strings",{get:function(){return l_},enumerable:!1,configurable:!0}),Object.defineProperty(w,"cssClasses",{get:function(){return ih},enumerable:!1,configurable:!0}),Object.defineProperty(w,"numbers",{get:function(){return _d},enumerable:!1,configurable:!0}),Object.defineProperty(w,"defaultAdapter",{get:function(){return{addClass:function(){},removeClass:function(){},hasClass:function(){return!1},setStyle:function(){},getTopAppBarHeight:function(){return 0},notifyNavigationIconClicked:function(){},getViewportScrollY:function(){return 0},getTotalActionItems:function(){return 0}}},enumerable:!1,configurable:!0}),w.prototype.handleTargetScroll=function(){},w.prototype.handleWindowResize=function(){},w.prototype.handleNavigationClick=function(){this.adapter.notifyNavigationIconClicked()},w}(tm);/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var hd=0,Sg=function(A){jh(w,A);function w(C){var D=A.call(this,C)||this;return D.wasDocked=!0,D.isDockedShowing=!0,D.currentAppBarOffsetTop=0,D.isCurrentlyBeingResized=!1,D.resizeThrottleId=hd,D.resizeDebounceId=hd,D.lastScrollPosition=D.adapter.getViewportScrollY(),D.topAppBarHeight=D.adapter.getTopAppBarHeight(),D}return w.prototype.destroy=function(){A.prototype.destroy.call(this),this.adapter.setStyle("top","")},w.prototype.handleTargetScroll=function(){var C=Math.max(this.adapter.getViewportScrollY(),0),D=C-this.lastScrollPosition;this.lastScrollPosition=C,this.isCurrentlyBeingResized||(this.currentAppBarOffsetTop-=D,this.currentAppBarOffsetTop>0?this.currentAppBarOffsetTop=0:Math.abs(this.currentAppBarOffsetTop)>this.topAppBarHeight&&(this.currentAppBarOffsetTop=-this.topAppBarHeight),this.moveTopAppBar())},w.prototype.handleWindowResize=function(){var C=this;this.resizeThrottleId||(this.resizeThrottleId=setTimeout(function(){C.resizeThrottleId=hd,C.throttledResizeHandler()},_d.DEBOUNCE_THROTTLE_RESIZE_TIME_MS)),this.isCurrentlyBeingResized=!0,this.resizeDebounceId&&clearTimeout(this.resizeDebounceId),this.resizeDebounceId=setTimeout(function(){C.handleTargetScroll(),C.isCurrentlyBeingResized=!1,C.resizeDebounceId=hd},_d.DEBOUNCE_THROTTLE_RESIZE_TIME_MS)},w.prototype.checkForUpdate=function(){var C=-this.topAppBarHeight,D=this.currentAppBarOffsetTop<0,U=this.currentAppBarOffsetTop>C,H=D&&U;if(H)this.wasDocked=!1;else if(this.wasDocked){if(this.isDockedShowing!==U)return this.isDockedShowing=U,!0}else return this.wasDocked=!0,!0;return H},w.prototype.moveTopAppBar=function(){if(this.checkForUpdate()){var C=this.currentAppBarOffsetTop;Math.abs(C)>=this.topAppBarHeight&&(C=-_d.MAX_TOP_APP_BAR_HEIGHT),this.adapter.setStyle("top",C+"px")}},w.prototype.throttledResizeHandler=function(){var C=this.adapter.getTopAppBarHeight();this.topAppBarHeight!==C&&(this.wasDocked=!1,this.currentAppBarOffsetTop-=this.topAppBarHeight-C,this.topAppBarHeight=C),this.handleTargetScroll()},w}(im);/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var u_=function(A){jh(w,A);function w(){var C=A!==null&&A.apply(this,arguments)||this;return C.wasScrolled=!1,C}return w.prototype.handleTargetScroll=function(){var C=this.adapter.getViewportScrollY();C<=0?this.wasScrolled&&(this.adapter.removeClass(ih.FIXED_SCROLLED_CLASS),this.wasScrolled=!1):this.wasScrolled||(this.adapter.addClass(ih.FIXED_SCROLLED_CLASS),this.wasScrolled=!0)},w}(Sg);/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var c_=function(A){jh(w,A);function w(C){var D=A.call(this,C)||this;return D.collapsed=!1,D.isAlwaysCollapsed=!1,D}return Object.defineProperty(w.prototype,"isCollapsed",{get:function(){return this.collapsed},enumerable:!1,configurable:!0}),w.prototype.init=function(){A.prototype.init.call(this),this.adapter.getTotalActionItems()>0&&this.adapter.addClass(ih.SHORT_HAS_ACTION_ITEM_CLASS),this.setAlwaysCollapsed(this.adapter.hasClass(ih.SHORT_COLLAPSED_CLASS))},w.prototype.setAlwaysCollapsed=function(C){this.isAlwaysCollapsed=!!C,this.isAlwaysCollapsed?this.collapse():this.maybeCollapseBar()},w.prototype.getAlwaysCollapsed=function(){return this.isAlwaysCollapsed},w.prototype.handleTargetScroll=function(){this.maybeCollapseBar()},w.prototype.maybeCollapseBar=function(){if(!this.isAlwaysCollapsed){var C=this.adapter.getViewportScrollY();C<=0?this.collapsed&&this.uncollapse():this.collapsed||this.collapse()}},w.prototype.uncollapse=function(){this.adapter.removeClass(ih.SHORT_COLLAPSED_CLASS),this.collapsed=!1},w.prototype.collapse=function(){this.adapter.addClass(ih.SHORT_COLLAPSED_CLASS),this.collapsed=!0},w}(im);function nu(A){return Object.entries(A).filter(([w,C])=>w!==""&&C).map(([w])=>w).join(" ")}function Zf(A,w,C,D={bubbles:!0},U=!1){if(typeof Event!="undefined"&&A){const H=new CustomEvent(w,Object.assign(Object.assign({},D),{detail:C}));if(A==null||A.dispatchEvent(H),U&&w.startsWith("SMUI")){const m=new CustomEvent(w.replace(/^SMUI/g,()=>"MDC"),Object.assign(Object.assign({},D),{detail:C}));A==null||A.dispatchEvent(m),m.defaultPrevented&&H.preventDefault()}return H}}const Hm=/^[a-z]+(?::(?:preventDefault|stopPropagation|passive|nonpassive|capture|once|self))+$/,h_=/^[^$]+(?:\$(?:preventDefault|stopPropagation|passive|nonpassive|capture|once|self))+$/;function pu(A){let w,C=[];A.$on=(U,H)=>{let m=U,g=()=>{};return w?g=w(m,H):C.push([m,H]),m.match(Hm)&&console&&console.warn('Event modifiers in SMUI now use "$" instead of ":", so that all events can be bound with modifiers. Please update your event binding: ',m),()=>{g()}};function D(U){jy(A,U)}return U=>{const H=[],m={};w=(g,Z)=>{let ve=g,he=Z,ye=!1;const re=ve.match(Hm),it=ve.match(h_),et=re||it;if(ve.match(/^SMUI:\w+:/)){const Xt=ve.split(":");let Wt="";for(let _t=0;_t<Xt.length;_t++)Wt+=_t===Xt.length-1?":"+Xt[_t]:Xt[_t].split("-").map(ui=>ui.slice(0,1).toUpperCase()+ui.slice(1)).join("");console.warn(`The event ${ve.split("$")[0]} has been renamed to ${Wt.split("$")[0]}.`),ve=Wt}if(et){const Xt=ve.split(re?":":"$");ve=Xt[0];const Wt=Object.fromEntries(Xt.slice(1).map(_t=>[_t,!0]));Wt.passive&&(ye=ye||{},ye.passive=!0),Wt.nonpassive&&(ye=ye||{},ye.passive=!1),Wt.capture&&(ye=ye||{},ye.capture=!0),Wt.once&&(ye=ye||{},ye.once=!0),Wt.preventDefault&&(he=qy(he)),Wt.stopPropagation&&(he=Gy(he))}const St=Tp(U,ve,he,ye),vt=()=>{St();const Xt=H.indexOf(vt);Xt>-1&&H.splice(Xt,1)};return H.push(vt),ve in m||(m[ve]=Tp(U,ve,D)),vt};for(let g=0;g<C.length;g++)w(C[g][0],C[g][1]);return{destroy:()=>{for(let g=0;g<H.length;g++)H[g]();for(let g of Object.entries(m))g[1]()}}}}function ah(A,w){let C=[];if(w)for(let D=0;D<w.length;D++){const U=w[D],H=Array.isArray(U)?U[0]:U;Array.isArray(U)&&U.length>1?C.push(H(A,U[1])):C.push(H(A))}return{update(D){if((D&&D.length||0)!=C.length)throw new Error("You must not change the length of an actions array.");if(D)for(let U=0;U<D.length;U++){const H=C[U];if(H&&H.update){const m=D[U];Array.isArray(m)&&m.length>1?H.update(m[1]):H.update()}}},destroy(){for(let D=0;D<C.length;D++){const U=C[D];U&&U.destroy&&U.destroy()}}}}const{window:Wm}=Zy;function p_(A){let w,C,D,U,H,m,g;const Z=A[22].default,ve=ou(Z,A,A[21],null);let he=[{class:C=nu(Yc({[A[2]]:!0,"mdc-top-app-bar":!0,"mdc-top-app-bar--short":A[4]==="short","mdc-top-app-bar--short-collapsed":A[0],"mdc-top-app-bar--fixed":A[4]==="fixed","smui-top-app-bar--static":A[4]==="static","smui-top-app-bar--color-secondary":A[5]==="secondary","mdc-top-app-bar--prominent":A[6],"mdc-top-app-bar--dense":A[7]},A[11]))},{style:D=Object.entries(A[12]).map(Km).concat([A[3]]).join(" ")},A[15]],ye={};for(let re=0;re<he.length;re+=1)ye=kr(ye,he[re]);return{c(){w=zo("header"),ve&&ve.c(),this.h()},l(re){w=Po(re,"HEADER",{class:!0,style:!0});var it=vs(w);ve&&ve.l(it),it.forEach(ki),this.h()},h(){Ka(w,ye)},m(re,it){cr(re,w,it),ve&&ve.m(w,null),A[25](w),H=!0,m||(g=[Tp(Wm,"resize",A[23]),Tp(Wm,"scroll",A[24]),Ja(U=ah.call(null,w,A[1])),Ja(A[13].call(null,w)),Tp(w,"SMUITopAppBarIconButton:nav",A[26])],m=!0)},p(re,it){ve&&ve.p&&(!H||it[0]&2097152)&&au(ve,Z,re,re[21],H?lu(Z,re[21],it,null):su(re[21]),null),Ka(w,ye=uu(he,[(!H||it[0]&2293&&C!==(C=nu(Yc({[re[2]]:!0,"mdc-top-app-bar":!0,"mdc-top-app-bar--short":re[4]==="short","mdc-top-app-bar--short-collapsed":re[0],"mdc-top-app-bar--fixed":re[4]==="fixed","smui-top-app-bar--static":re[4]==="static","smui-top-app-bar--color-secondary":re[5]==="secondary","mdc-top-app-bar--prominent":re[6],"mdc-top-app-bar--dense":re[7]},re[11]))))&&{class:C},(!H||it[0]&4104&&D!==(D=Object.entries(re[12]).map(Km).concat([re[3]]).join(" ")))&&{style:D},it[0]&32768&&re[15]])),U&&nh(U.update)&&it[0]&2&&U.update.call(null,re[1])},i(re){H||(tn(ve,re),H=!0)},o(re){rn(ve,re),H=!1},d(re){re&&ki(w),ve&&ve.d(re),A[25](null),m=!1,oh(g)}}}const Km=([A,w])=>`${A}: ${w};`;function d_(A,w,C){const D=["use","class","style","variant","color","collapsed","prominent","dense","scrollTarget","getPropStore","getElement"];let U=_o(w,D),{$$slots:H={},$$scope:m}=w;const g=pu(cu());let Z=()=>{};function ve(oi){return oi===Z}let{use:he=[]}=w,{class:ye=""}=w,{style:re=""}=w,{variant:it="standard"}=w,{color:et="primary"}=w,{collapsed:St=Z}=w;const vt=!ve(St)&&!!St;ve(St)&&(St=!1);let{prominent:Xt=!1}=w,{dense:Wt=!1}=w,{scrollTarget:_t=void 0}=w,ui,qt,Zt={},si={},Wi,Gi=Ky({variant:it,prominent:Xt,dense:Wt},oi=>{C(18,Wi=oi)}),Zi,Ki=it;Jf(()=>(C(9,qt=Mr()),qt.init(),()=>{qt.destroy()}));function Mr(){const oi={static:im,short:c_,fixed:u_}[it]||Sg;return new oi({hasClass:Oi,addClass:hr,removeClass:eo,setStyle:ii,getTopAppBarHeight:()=>ui.clientHeight,notifyNavigationIconClicked:()=>Zf(ui,"SMUITopAppBar:nav",void 0,void 0,!0),getViewportScrollY:()=>_t==null?window.pageYOffset:_t.scrollTop,getTotalActionItems:()=>ui.querySelectorAll(".mdc-top-app-bar__action-item").length})}function Oi(oi){return oi in Zt?Zt[oi]:Fn().classList.contains(oi)}function hr(oi){Zt[oi]||C(11,Zt[oi]=!0,Zt)}function eo(oi){(!(oi in Zt)||Zt[oi])&&C(11,Zt[oi]=!1,Zt)}function ii(oi,$r){si[oi]!=$r&&($r===""||$r==null?(delete si[oi],C(12,si),C(20,Ki),C(4,it),C(9,qt)):C(12,si[oi]=$r,si))}function Lr(){qt&&(qt.handleTargetScroll(),it==="short"&&C(0,St="isCollapsed"in qt&&qt.isCollapsed))}function un(){return Gi}function Fn(){return ui}const Dr=()=>it!=="short"&&it!=="fixed"&&qt&&qt.handleWindowResize(),Vr=()=>_t==null&&Lr();function nn(oi){qs[oi?"unshift":"push"](()=>{ui=oi,C(10,ui)})}const cn=()=>qt&&qt.handleNavigationClick();return A.$$set=oi=>{w=kr(kr({},w),hu(oi)),C(15,U=_o(w,D)),"use"in oi&&C(1,he=oi.use),"class"in oi&&C(2,ye=oi.class),"style"in oi&&C(3,re=oi.style),"variant"in oi&&C(4,it=oi.variant),"color"in oi&&C(5,et=oi.color),"collapsed"in oi&&C(0,St=oi.collapsed),"prominent"in oi&&C(6,Xt=oi.prominent),"dense"in oi&&C(7,Wt=oi.dense),"scrollTarget"in oi&&C(8,_t=oi.scrollTarget),"$$scope"in oi&&C(21,m=oi.$$scope)},A.$$.update=()=>{A.$$.dirty[0]&262352&&Wi&&Wi({variant:it,prominent:Xt,dense:Wt}),A.$$.dirty[0]&1049104&&Ki!==it&&qt&&(C(20,Ki=it),qt.destroy(),C(11,Zt={}),C(12,si={}),C(9,qt=Mr()),qt.init()),A.$$.dirty[0]&528&&qt&&it==="short"&&"setAlwaysCollapsed"in qt&&qt.setAlwaysCollapsed(vt),A.$$.dirty[0]&524544&&Zi!==_t&&(Zi&&Zi.removeEventListener("scroll",Lr),_t&&_t.addEventListener("scroll",Lr),C(19,Zi=_t))},[St,he,ye,re,it,et,Xt,Wt,_t,qt,ui,Zt,si,g,Lr,U,un,Fn,Wi,Zi,Ki,m,H,Dr,Vr,nn,cn]}class f_ extends xs{constructor(w){super(),bs(this,w,d_,p_,ws,{use:1,class:2,style:3,variant:4,color:5,collapsed:0,prominent:6,dense:7,scrollTarget:8,getPropStore:16,getElement:17},null,[-1,-1])}get getPropStore(){return this.$$.ctx[16]}get getElement(){return this.$$.ctx[17]}}function m_(A){let w,C,D,U,H;const m=A[6].default,g=ou(m,A,A[5],null);let Z=[A[3]],ve={};for(let he=0;he<Z.length;he+=1)ve=kr(ve,Z[he]);return{c(){w=zo("div"),g&&g.c(),this.h()},l(he){w=Po(he,"DIV",{});var ye=vs(w);g&&g.l(ye),ye.forEach(ki),this.h()},h(){Ka(w,ve)},m(he,ye){cr(he,w,ye),g&&g.m(w,null),A[7](w),D=!0,U||(H=[Ja(C=ah.call(null,w,A[0])),Ja(A[2].call(null,w))],U=!0)},p(he,[ye]){g&&g.p&&(!D||ye&32)&&au(g,m,he,he[5],D?lu(m,he[5],ye,null):su(he[5]),null),Ka(w,ve=uu(Z,[ye&8&&he[3]])),C&&nh(C.update)&&ye&1&&C.update.call(null,he[0])},i(he){D||(tn(g,he),D=!0)},o(he){rn(g,he),D=!1},d(he){he&&ki(w),g&&g.d(he),A[7](null),U=!1,oh(H)}}}function g_(A,w,C){const D=["use","getElement"];let U=_o(w,D),{$$slots:H={},$$scope:m}=w,{use:g=[]}=w;const Z=pu(cu());let ve;function he(){return ve}function ye(re){qs[re?"unshift":"push"](()=>{ve=re,C(1,ve)})}return A.$$set=re=>{w=kr(kr({},w),hu(re)),C(3,U=_o(w,D)),"use"in re&&C(0,g=re.use),"$$scope"in re&&C(5,m=re.$$scope)},[g,ve,Z,U,he,m,H,ye]}class Tg extends xs{constructor(w){super(),bs(this,w,g_,m_,ws,{use:0,getElement:4})}get getElement(){return this.$$.ctx[4]}}function y_(A){let w;const C=A[10].default,D=ou(C,A,A[12],null);return{c(){D&&D.c()},l(U){D&&D.l(U)},m(U,H){D&&D.m(U,H),w=!0},p(U,H){D&&D.p&&(!w||H&4096)&&au(D,C,U,U[12],w?lu(C,U[12],H,null):su(U[12]),null)},i(U){w||(tn(D,U),w=!0)},o(U){rn(D,U),w=!1},d(U){D&&D.d(U)}}}function __(A){let w,C,D;const U=[{use:[A[7],...A[0]]},{class:nu(Yc({[A[1]]:!0,[A[5]]:!0},A[4]))},A[6],A[8]];var H=A[2];function m(g){let Z={$$slots:{default:[y_]},$$scope:{ctx:g}};for(let ve=0;ve<U.length;ve+=1)Z=kr(Z,U[ve]);return{props:Z}}return H&&(w=new H(m(A)),A[11](w)),{c(){w&&Wo(w.$$.fragment),C=ru()},l(g){w&&Ya(w.$$.fragment,g),C=ru()},m(g,Z){w&&Ko(w,g,Z),cr(g,C,Z),D=!0},p(g,[Z]){const ve=Z&499?uu(U,[Z&129&&{use:[g[7],...g[0]]},Z&50&&{class:nu(Yc({[g[1]]:!0,[g[5]]:!0},g[4]))},Z&64&&Oh(g[6]),Z&256&&Oh(g[8])]):{};if(Z&4096&&(ve.$$scope={dirty:Z,ctx:g}),H!==(H=g[2])){if(w){Qf();const he=w;rn(he.$$.fragment,1,0,()=>{Jo(he,1)}),Yf()}H?(w=new H(m(g)),g[11](w),Wo(w.$$.fragment),tn(w.$$.fragment,1),Ko(w,C.parentNode,C)):w=null}else H&&w.$set(ve)},i(g){D||(w&&tn(w.$$.fragment,g),D=!0)},o(g){w&&rn(w.$$.fragment,g),D=!1},d(g){A[11](null),g&&ki(C),w&&Jo(w,g)}}}const Ec={component:Tg,class:"",classMap:{},contexts:{},props:{}};function v_(A,w,C){const D=["use","class","component","getElement"];let U=_o(w,D),{$$slots:H={},$$scope:m}=w,{use:g=[]}=w,{class:Z=""}=w,ve;const he=Ec.class,ye={},re=[],it=Ec.contexts,et=Ec.props;let{component:St=Ec.component}=w;Object.entries(Ec.classMap).forEach(([_t,ui])=>{const qt=wd(ui);qt&&"subscribe"in qt&&re.push(qt.subscribe(Zt=>{C(4,ye[_t]=Zt,ye)}))});const vt=pu(cu());for(let _t in it)it.hasOwnProperty(_t)&&Ed(_t,it[_t]);wg(()=>{for(const _t of re)_t()});function Xt(){return ve.getElement()}function Wt(_t){qs[_t?"unshift":"push"](()=>{ve=_t,C(3,ve)})}return A.$$set=_t=>{w=kr(kr({},w),hu(_t)),C(8,U=_o(w,D)),"use"in _t&&C(0,g=_t.use),"class"in _t&&C(1,Z=_t.class),"component"in _t&&C(2,St=_t.component),"$$scope"in _t&&C(12,m=_t.$$scope)},[g,Z,St,ve,ye,he,et,vt,U,Xt,H,Wt,m]}class x_ extends xs{constructor(w){super(),bs(this,w,v_,__,ws,{use:0,class:1,component:2,getElement:9})}get getElement(){return this.$$.ctx[9]}}const Jm=Object.assign({},Ec);function Ag(A){return new Proxy(x_,{construct:function(w,C){return Object.assign(Ec,Jm,A),new w(...C)},get:function(w,C){return Object.assign(Ec,Jm,A),w[C]}})}function b_(A){let w,C,D,U,H;const m=A[7].default,g=ou(m,A,A[6],null);let Z=[{href:A[1]},A[4]],ve={};for(let he=0;he<Z.length;he+=1)ve=kr(ve,Z[he]);return{c(){w=zo("a"),g&&g.c(),this.h()},l(he){w=Po(he,"A",{href:!0});var ye=vs(w);g&&g.l(ye),ye.forEach(ki),this.h()},h(){Ka(w,ve)},m(he,ye){cr(he,w,ye),g&&g.m(w,null),A[8](w),D=!0,U||(H=[Ja(C=ah.call(null,w,A[0])),Ja(A[3].call(null,w))],U=!0)},p(he,[ye]){g&&g.p&&(!D||ye&64)&&au(g,m,he,he[6],D?lu(m,he[6],ye,null):su(he[6]),null),Ka(w,ve=uu(Z,[(!D||ye&2)&&{href:he[1]},ye&16&&he[4]])),C&&nh(C.update)&&ye&1&&C.update.call(null,he[0])},i(he){D||(tn(g,he),D=!0)},o(he){rn(g,he),D=!1},d(he){he&&ki(w),g&&g.d(he),A[8](null),U=!1,oh(H)}}}function w_(A,w,C){const D=["use","href","getElement"];let U=_o(w,D),{$$slots:H={},$$scope:m}=w,{use:g=[]}=w,{href:Z="javascript:void(0);"}=w;const ve=pu(cu());let he;function ye(){return he}function re(it){qs[it?"unshift":"push"](()=>{he=it,C(2,he)})}return A.$$set=it=>{w=kr(kr({},w),hu(it)),C(4,U=_o(w,D)),"use"in it&&C(0,g=it.use),"href"in it&&C(1,Z=it.href),"$$scope"in it&&C(6,m=it.$$scope)},[g,Z,he,ve,U,ye,m,H,re]}class E_ extends xs{constructor(w){super(),bs(this,w,w_,b_,ws,{use:0,href:1,getElement:5})}get getElement(){return this.$$.ctx[5]}}function S_(A){let w,C,D,U,H;const m=A[6].default,g=ou(m,A,A[5],null);let Z=[A[3]],ve={};for(let he=0;he<Z.length;he+=1)ve=kr(ve,Z[he]);return{c(){w=zo("button"),g&&g.c(),this.h()},l(he){w=Po(he,"BUTTON",{});var ye=vs(w);g&&g.l(ye),ye.forEach(ki),this.h()},h(){Ka(w,ve)},m(he,ye){cr(he,w,ye),g&&g.m(w,null),w.autofocus&&w.focus(),A[7](w),D=!0,U||(H=[Ja(C=ah.call(null,w,A[0])),Ja(A[2].call(null,w))],U=!0)},p(he,[ye]){g&&g.p&&(!D||ye&32)&&au(g,m,he,he[5],D?lu(m,he[5],ye,null):su(he[5]),null),Ka(w,ve=uu(Z,[ye&8&&he[3]])),C&&nh(C.update)&&ye&1&&C.update.call(null,he[0])},i(he){D||(tn(g,he),D=!0)},o(he){rn(g,he),D=!1},d(he){he&&ki(w),g&&g.d(he),A[7](null),U=!1,oh(H)}}}function T_(A,w,C){const D=["use","getElement"];let U=_o(w,D),{$$slots:H={},$$scope:m}=w,{use:g=[]}=w;const Z=pu(cu());let ve;function he(){return ve}function ye(re){qs[re?"unshift":"push"](()=>{ve=re,C(1,ve)})}return A.$$set=re=>{w=kr(kr({},w),hu(re)),C(3,U=_o(w,D)),"use"in re&&C(0,g=re.use),"$$scope"in re&&C(5,m=re.$$scope)},[g,ve,Z,U,he,m,H,ye]}class A_ extends xs{constructor(w){super(),bs(this,w,T_,S_,ws,{use:0,getElement:4})}get getElement(){return this.$$.ctx[4]}}function I_(A){let w,C,D,U,H;const m=A[6].default,g=ou(m,A,A[5],null);let Z=[A[3]],ve={};for(let he=0;he<Z.length;he+=1)ve=kr(ve,Z[he]);return{c(){w=zo("main"),g&&g.c(),this.h()},l(he){w=Po(he,"MAIN",{});var ye=vs(w);g&&g.l(ye),ye.forEach(ki),this.h()},h(){Ka(w,ve)},m(he,ye){cr(he,w,ye),g&&g.m(w,null),A[7](w),D=!0,U||(H=[Ja(C=ah.call(null,w,A[0])),Ja(A[2].call(null,w))],U=!0)},p(he,[ye]){g&&g.p&&(!D||ye&32)&&au(g,m,he,he[5],D?lu(m,he[5],ye,null):su(he[5]),null),Ka(w,ve=uu(Z,[ye&8&&he[3]])),C&&nh(C.update)&&ye&1&&C.update.call(null,he[0])},i(he){D||(tn(g,he),D=!0)},o(he){rn(g,he),D=!1},d(he){he&&ki(w),g&&g.d(he),A[7](null),U=!1,oh(H)}}}function C_(A,w,C){const D=["use","getElement"];let U=_o(w,D),{$$slots:H={},$$scope:m}=w,{use:g=[]}=w;const Z=pu(cu());let ve;function he(){return ve}function ye(re){qs[re?"unshift":"push"](()=>{ve=re,C(1,ve)})}return A.$$set=re=>{w=kr(kr({},w),hu(re)),C(3,U=_o(w,D)),"use"in re&&C(0,g=re.use),"$$scope"in re&&C(5,m=re.$$scope)},[g,ve,Z,U,he,m,H,ye]}class z_ extends xs{constructor(w){super(),bs(this,w,C_,I_,ws,{use:0,getElement:4})}get getElement(){return this.$$.ctx[4]}}function P_(A){let w,C,D,U,H;const m=A[6].default,g=ou(m,A,A[5],null);let Z=[A[3]],ve={};for(let he=0;he<Z.length;he+=1)ve=kr(ve,Z[he]);return{c(){w=zo("span"),g&&g.c(),this.h()},l(he){w=Po(he,"SPAN",{});var ye=vs(w);g&&g.l(ye),ye.forEach(ki),this.h()},h(){Ka(w,ve)},m(he,ye){cr(he,w,ye),g&&g.m(w,null),A[7](w),D=!0,U||(H=[Ja(C=ah.call(null,w,A[0])),Ja(A[2].call(null,w))],U=!0)},p(he,[ye]){g&&g.p&&(!D||ye&32)&&au(g,m,he,he[5],D?lu(m,he[5],ye,null):su(he[5]),null),Ka(w,ve=uu(Z,[ye&8&&he[3]])),C&&nh(C.update)&&ye&1&&C.update.call(null,he[0])},i(he){D||(tn(g,he),D=!0)},o(he){rn(g,he),D=!1},d(he){he&&ki(w),g&&g.d(he),A[7](null),U=!1,oh(H)}}}function k_(A,w,C){const D=["use","getElement"];let U=_o(w,D),{$$slots:H={},$$scope:m}=w,{use:g=[]}=w;const Z=pu(cu());let ve;function he(){return ve}function ye(re){qs[re?"unshift":"push"](()=>{ve=re,C(1,ve)})}return A.$$set=re=>{w=kr(kr({},w),hu(re)),C(3,U=_o(w,D)),"use"in re&&C(0,g=re.use),"$$scope"in re&&C(5,m=re.$$scope)},[g,ve,Z,U,he,m,H,ye]}class M_ extends xs{constructor(w){super(),bs(this,w,k_,P_,ws,{use:0,getElement:4})}get getElement(){return this.$$.ctx[4]}}const L_=E_,D_=A_,R_=Tg,B_=z_,O_=M_;var F_=Ag({class:"mdc-top-app-bar__row",component:R_});function U_(A){let w,C,D,U,H,m;const g=A[9].default,Z=ou(g,A,A[8],null);let ve=[{class:C=nu({[A[1]]:!0,"mdc-top-app-bar__section":!0,"mdc-top-app-bar__section--align-start":A[2]==="start","mdc-top-app-bar__section--align-end":A[2]==="end"})},A[3]?{role:"toolbar"}:{},A[6]],he={};for(let ye=0;ye<ve.length;ye+=1)he=kr(he,ve[ye]);return{c(){w=zo("section"),Z&&Z.c(),this.h()},l(ye){w=Po(ye,"SECTION",{class:!0});var re=vs(w);Z&&Z.l(re),re.forEach(ki),this.h()},h(){Ka(w,he)},m(ye,re){cr(ye,w,re),Z&&Z.m(w,null),A[10](w),U=!0,H||(m=[Ja(D=ah.call(null,w,A[0])),Ja(A[5].call(null,w))],H=!0)},p(ye,[re]){Z&&Z.p&&(!U||re&256)&&au(Z,g,ye,ye[8],U?lu(g,ye[8],re,null):su(ye[8]),null),Ka(w,he=uu(ve,[(!U||re&6&&C!==(C=nu({[ye[1]]:!0,"mdc-top-app-bar__section":!0,"mdc-top-app-bar__section--align-start":ye[2]==="start","mdc-top-app-bar__section--align-end":ye[2]==="end"})))&&{class:C},re&8&&(ye[3]?{role:"toolbar"}:{}),re&64&&ye[6]])),D&&nh(D.update)&&re&1&&D.update.call(null,ye[0])},i(ye){U||(tn(Z,ye),U=!0)},o(ye){rn(Z,ye),U=!1},d(ye){ye&&ki(w),Z&&Z.d(ye),A[10](null),H=!1,oh(m)}}}function V_(A,w,C){const D=["use","class","align","toolbar","getElement"];let U=_o(w,D),{$$slots:H={},$$scope:m}=w;const g=pu(cu());let{use:Z=[]}=w,{class:ve=""}=w,{align:he="start"}=w,{toolbar:ye=!1}=w,re;Ed("SMUI:icon-button:context",ye?"top-app-bar:action":"top-app-bar:navigation"),Ed("SMUI:button:context",ye?"top-app-bar:action":"top-app-bar:navigation");function it(){return re}function et(St){qs[St?"unshift":"push"](()=>{re=St,C(4,re)})}return A.$$set=St=>{w=kr(kr({},w),hu(St)),C(6,U=_o(w,D)),"use"in St&&C(0,Z=St.use),"class"in St&&C(1,ve=St.class),"align"in St&&C(2,he=St.align),"toolbar"in St&&C(3,ye=St.toolbar),"$$scope"in St&&C(8,m=St.$$scope)},[Z,ve,he,ye,re,g,U,it,m,H,et]}class N_ extends xs{constructor(w){super(),bs(this,w,V_,U_,ws,{use:0,class:1,align:2,toolbar:3,getElement:7})}get getElement(){return this.$$.ctx[7]}}var j_=Ag({class:"mdc-top-app-bar__title",component:O_});function q_(A){let w;const C=A[11].default,D=ou(C,A,A[13],null);return{c(){D&&D.c()},l(U){D&&D.l(U)},m(U,H){D&&D.m(U,H),w=!0},p(U,H){D&&D.p&&(!w||H&8192)&&au(D,C,U,U[13],w?lu(C,U[13],H,null):su(U[13]),null)},i(U){w||(tn(D,U),w=!0)},o(U){rn(D,U),w=!1},d(U){D&&D.d(U)}}}function G_(A){let w,C,D;const U=[{use:[A[6],...A[0]]},{class:nu({[A[1]]:!0,[A[5]]:!0})},A[7]];var H=A[2];function m(g){let Z={$$slots:{default:[q_]},$$scope:{ctx:g}};for(let ve=0;ve<U.length;ve+=1)Z=kr(Z,U[ve]);return{props:Z}}return H&&(w=new H(m(A)),A[12](w)),{c(){w&&Wo(w.$$.fragment),C=ru()},l(g){w&&Ya(w.$$.fragment,g),C=ru()},m(g,Z){w&&Ko(w,g,Z),cr(g,C,Z),D=!0},p(g,[Z]){const ve=Z&227?uu(U,[Z&65&&{use:[g[6],...g[0]]},Z&34&&{class:nu({[g[1]]:!0,[g[5]]:!0})},Z&128&&Oh(g[7])]):{};if(Z&8192&&(ve.$$scope={dirty:Z,ctx:g}),H!==(H=g[2])){if(w){Qf();const he=w;rn(he.$$.fragment,1,0,()=>{Jo(he,1)}),Yf()}H?(w=new H(m(g)),g[12](w),Wo(w.$$.fragment),tn(w.$$.fragment,1),Ko(w,C.parentNode,C)):w=null}else H&&w.$set(ve)},i(g){D||(w&&tn(w.$$.fragment,g),D=!0)},o(g){w&&rn(w.$$.fragment,g),D=!1},d(g){A[12](null),g&&ki(C),w&&Jo(w,g)}}}function Z_(A,w,C){let D,U;const H=["use","class","topAppBar","component","getElement"];let m=_o(w,H),g,Z=Zu,ve=()=>(Z(),Z=Xy(D,ui=>C(10,g=ui)),D);A.$$.on_destroy.push(()=>Z());let{$$slots:he={},$$scope:ye}=w;const re=pu(cu());let{use:it=[]}=w,{class:et=""}=w,{topAppBar:St}=w,vt,{component:Xt=B_}=w;function Wt(){return vt.getElement()}function _t(ui){qs[ui?"unshift":"push"](()=>{vt=ui,C(4,vt)})}return A.$$set=ui=>{w=kr(kr({},w),hu(ui)),C(7,m=_o(w,H)),"use"in ui&&C(0,it=ui.use),"class"in ui&&C(1,et=ui.class),"topAppBar"in ui&&C(8,St=ui.topAppBar),"component"in ui&&C(2,Xt=ui.component),"$$scope"in ui&&C(13,ye=ui.$$scope)},A.$$.update=()=>{A.$$.dirty&256&&ve(C(3,D=St&&St.getPropStore())),A.$$.dirty&1032&&C(5,U=(()=>!D||g.variant==="static"?"":g.variant==="short"?"mdc-top-app-bar--short-fixed-adjust":g.prominent&&g.dense?"mdc-top-app-bar--dense-prominent-fixed-adjust":g.prominent?"mdc-top-app-bar--prominent-fixed-adjust":g.dense?"mdc-top-app-bar--dense-fixed-adjust":"mdc-top-app-bar--fixed-adjust")())},[it,et,Xt,D,vt,U,re,m,St,Wt,g,he,_t,ye]}class X_ extends xs{constructor(w){super(),bs(this,w,Z_,G_,ws,{use:0,class:1,topAppBar:8,component:2,getElement:9})}get getElement(){return this.$$.ctx[9]}}const Ym=N_,$_=X_;/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var pd={ICON_BUTTON_ON:"mdc-icon-button--on",ROOT:"mdc-icon-button"},Gu={ARIA_LABEL:"aria-label",ARIA_PRESSED:"aria-pressed",DATA_ARIA_LABEL_OFF:"data-aria-label-off",DATA_ARIA_LABEL_ON:"data-aria-label-on",CHANGE_EVENT:"MDCIconButtonToggle:change"};/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var H_=function(A){jh(w,A);function w(C){var D=A.call(this,Xu(Xu({},w.defaultAdapter),C))||this;return D.hasToggledAriaLabel=!1,D}return Object.defineProperty(w,"cssClasses",{get:function(){return pd},enumerable:!1,configurable:!0}),Object.defineProperty(w,"strings",{get:function(){return Gu},enumerable:!1,configurable:!0}),Object.defineProperty(w,"defaultAdapter",{get:function(){return{addClass:function(){},hasClass:function(){return!1},notifyChange:function(){},removeClass:function(){},getAttr:function(){return null},setAttr:function(){}}},enumerable:!1,configurable:!0}),w.prototype.init=function(){var C=this.adapter.getAttr(Gu.DATA_ARIA_LABEL_ON),D=this.adapter.getAttr(Gu.DATA_ARIA_LABEL_OFF);if(C&&D){if(this.adapter.getAttr(Gu.ARIA_PRESSED)!==null)throw new Error("MDCIconButtonToggleFoundation: Button should not set `aria-pressed` if it has a toggled aria label.");this.hasToggledAriaLabel=!0}else this.adapter.setAttr(Gu.ARIA_PRESSED,String(this.isOn()))},w.prototype.handleClick=function(){this.toggle(),this.adapter.notifyChange({isOn:this.isOn()})},w.prototype.isOn=function(){return this.adapter.hasClass(pd.ICON_BUTTON_ON)},w.prototype.toggle=function(C){if(C===void 0&&(C=!this.isOn()),C?this.adapter.addClass(pd.ICON_BUTTON_ON):this.adapter.removeClass(pd.ICON_BUTTON_ON),this.hasToggledAriaLabel){var D=C?this.adapter.getAttr(Gu.DATA_ARIA_LABEL_ON):this.adapter.getAttr(Gu.DATA_ARIA_LABEL_OFF);this.adapter.setAttr(Gu.ARIA_LABEL,D||"")}else this.adapter.setAttr(Gu.ARIA_PRESSED,""+C)},w}(tm);const{applyPassive:dd}=Qy,{matches:W_}=i_;function Qm(A,{ripple:w=!0,surface:C=!1,unbounded:D=!1,disabled:U=!1,color:H,active:m,rippleElement:g,eventTarget:Z,activeTarget:ve,addClass:he=et=>A.classList.add(et),removeClass:ye=et=>A.classList.remove(et),addStyle:re=(et,St)=>A.style.setProperty(et,St),initPromise:it=Promise.resolve()}={}){let et,St=wd("SMUI:addLayoutListener"),vt,Xt=m,Wt=Z,_t=ve;function ui(){C?(he("mdc-ripple-surface"),H==="primary"?(he("smui-ripple-surface--primary"),ye("smui-ripple-surface--secondary")):H==="secondary"?(ye("smui-ripple-surface--primary"),he("smui-ripple-surface--secondary")):(ye("smui-ripple-surface--primary"),ye("smui-ripple-surface--secondary"))):(ye("mdc-ripple-surface"),ye("smui-ripple-surface--primary"),ye("smui-ripple-surface--secondary")),et&&Xt!==m&&(Xt=m,m?et.activate():m===!1&&et.deactivate()),w&&!et?(et=new s_({addClass:he,browserSupportsCssVars:()=>o_(window),computeBoundingRect:()=>(g||A).getBoundingClientRect(),containsEventTarget:Zt=>A.contains(Zt),deregisterDocumentInteractionHandler:(Zt,si)=>document.documentElement.removeEventListener(Zt,si,dd()),deregisterInteractionHandler:(Zt,si)=>(Z||A).removeEventListener(Zt,si,dd()),deregisterResizeHandler:Zt=>window.removeEventListener("resize",Zt),getWindowPageOffset:()=>({x:window.pageXOffset,y:window.pageYOffset}),isSurfaceActive:()=>m==null?W_(ve||A,":active"):m,isSurfaceDisabled:()=>!!U,isUnbounded:()=>!!D,registerDocumentInteractionHandler:(Zt,si)=>document.documentElement.addEventListener(Zt,si,dd()),registerInteractionHandler:(Zt,si)=>(Z||A).addEventListener(Zt,si,dd()),registerResizeHandler:Zt=>window.addEventListener("resize",Zt),removeClass:ye,updateCssVariable:re}),it.then(()=>{et&&(et.init(),et.setUnbounded(D))})):et&&!w&&it.then(()=>{et&&(et.destroy(),et=void 0)}),et&&(Wt!==Z||_t!==ve)&&(Wt=Z,_t=ve,et.destroy(),requestAnimationFrame(()=>{et&&(et.init(),et.setUnbounded(D))})),!w&&D&&he("mdc-ripple-upgraded--unbounded")}ui(),St&&(vt=St(qt));function qt(){et&&et.layout()}return{update(Zt){({ripple:w,surface:C,unbounded:D,disabled:U,color:H,active:m,rippleElement:g,eventTarget:Z,activeTarget:ve,addClass:he,removeClass:ye,addStyle:re,initPromise:it}=Object.assign({ripple:!0,surface:!1,unbounded:!1,disabled:!1,color:void 0,active:void 0,rippleElement:void 0,eventTarget:void 0,activeTarget:void 0,addClass:si=>A.classList.add(si),removeClass:si=>A.classList.remove(si),addStyle:(si,Wi)=>A.style.setProperty(si,Wi),initPromise:Promise.resolve()},Zt)),ui()},destroy(){et&&(et.destroy(),et=void 0,ye("mdc-ripple-surface"),ye("smui-ripple-surface--primary"),ye("smui-ripple-surface--secondary")),vt&&vt()}}}function eg(A){let w;return{c(){w=zo("div"),this.h()},l(C){w=Po(C,"DIV",{class:!0}),vs(w).forEach(ki),this.h()},h(){On(w,"class","mdc-icon-button__touch")},m(C,D){cr(C,w,D)},d(C){C&&ki(w)}}}function K_(A){let w,C,D,U;const H=A[32].default,m=ou(H,A,A[36],null);let g=A[8]&&eg();return{c(){w=zo("div"),C=Sl(),m&&m.c(),g&&g.c(),D=ru(),this.h()},l(Z){w=Po(Z,"DIV",{class:!0}),vs(w).forEach(ki),C=Tl(Z),m&&m.l(Z),g&&g.l(Z),D=ru(),this.h()},h(){On(w,"class","mdc-icon-button__ripple")},m(Z,ve){cr(Z,w,ve),cr(Z,C,ve),m&&m.m(Z,ve),g&&g.m(Z,ve),cr(Z,D,ve),U=!0},p(Z,ve){m&&m.p&&(!U||ve[1]&32)&&au(m,H,Z,Z[36],U?lu(H,Z[36],ve,null):su(Z[36]),null),Z[8]?g||(g=eg(),g.c(),g.m(D.parentNode,D)):g&&(g.d(1),g=null)},i(Z){U||(tn(m,Z),U=!0)},o(Z){rn(m,Z),U=!1},d(Z){Z&&ki(w),Z&&ki(C),m&&m.d(Z),g&&g.d(Z),Z&&ki(D)}}}function J_(A){let w,C,D;const U=[{use:[[Qm,{ripple:A[4],unbounded:!0,color:A[5],disabled:!!A[28].disabled,addClass:A[25],removeClass:A[26],addStyle:A[27]}],A[21],...A[1]]},{class:nu(Yc({[A[2]]:!0,"mdc-icon-button":!0,"mdc-icon-button--on":!A[22](A[0])&&A[0],"mdc-icon-button--touch":A[8],"mdc-icon-button--display-flex":A[9],"smui-icon-button--size-button":A[10]==="button","mdc-icon-button--reduced-size":A[10]==="mini"||A[10]==="button","mdc-card__action":A[23]==="card:action","mdc-card__action--icon":A[23]==="card:action","mdc-top-app-bar__navigation-icon":A[23]==="top-app-bar:navigation","mdc-top-app-bar__action-item":A[23]==="top-app-bar:action","mdc-snackbar__dismiss":A[23]==="snackbar:actions","mdc-data-table__pagination-button":A[23]==="data-table:pagination","mdc-data-table__sort-icon-button":A[23]==="data-table:sortable-header-cell","mdc-dialog__close":A[23]==="dialog:header"&&A[12]==="close"},A[17]))},{style:Object.entries(A[18]).map(tg).concat([A[3]]).join(" ")},{"aria-pressed":A[22](A[0])?null:A[0]?"true":"false"},{"aria-label":A[0]?A[6]:A[7]},{"data-aria-label-on":A[6]},{"data-aria-label-off":A[7]},{"aria-describedby":A[24]},{href:A[11]},A[20],A[19],A[28]];var H=A[13];function m(g){let Z={$$slots:{default:[K_]},$$scope:{ctx:g}};for(let ve=0;ve<U.length;ve+=1)Z=kr(Z,U[ve]);return{props:Z}}return H&&(w=new H(m(A)),A[33](w),w.$on("click",A[34]),w.$on("click",A[35])),{c(){w&&Wo(w.$$.fragment),C=ru()},l(g){w&&Ya(w.$$.fragment,g),C=ru()},m(g,Z){w&&Ko(w,g,Z),cr(g,C,Z),D=!0},p(g,Z){const ve=Z[0]&536748031?uu(U,[Z[0]&505413682&&{use:[[Qm,{ripple:g[4],unbounded:!0,color:g[5],disabled:!!g[28].disabled,addClass:g[25],removeClass:g[26],addStyle:g[27]}],g[21],...g[1]]},Z[0]&12719877&&{class:nu(Yc({[g[2]]:!0,"mdc-icon-button":!0,"mdc-icon-button--on":!g[22](g[0])&&g[0],"mdc-icon-button--touch":g[8],"mdc-icon-button--display-flex":g[9],"smui-icon-button--size-button":g[10]==="button","mdc-icon-button--reduced-size":g[10]==="mini"||g[10]==="button","mdc-card__action":g[23]==="card:action","mdc-card__action--icon":g[23]==="card:action","mdc-top-app-bar__navigation-icon":g[23]==="top-app-bar:navigation","mdc-top-app-bar__action-item":g[23]==="top-app-bar:action","mdc-snackbar__dismiss":g[23]==="snackbar:actions","mdc-data-table__pagination-button":g[23]==="data-table:pagination","mdc-data-table__sort-icon-button":g[23]==="data-table:sortable-header-cell","mdc-dialog__close":g[23]==="dialog:header"&&g[12]==="close"},g[17]))},Z[0]&262152&&{style:Object.entries(g[18]).map(tg).concat([g[3]]).join(" ")},Z[0]&4194305&&{"aria-pressed":g[22](g[0])?null:g[0]?"true":"false"},Z[0]&193&&{"aria-label":g[0]?g[6]:g[7]},Z[0]&64&&{"data-aria-label-on":g[6]},Z[0]&128&&{"data-aria-label-off":g[7]},Z[0]&16777216&&{"aria-describedby":g[24]},Z[0]&2048&&{href:g[11]},Z[0]&1048576&&Oh(g[20]),Z[0]&524288&&Oh(g[19]),Z[0]&268435456&&Oh(g[28])]):{};if(Z[0]&256|Z[1]&32&&(ve.$$scope={dirty:Z,ctx:g}),H!==(H=g[13])){if(w){Qf();const he=w;rn(he.$$.fragment,1,0,()=>{Jo(he,1)}),Yf()}H?(w=new H(m(g)),g[33](w),w.$on("click",g[34]),w.$on("click",g[35]),Wo(w.$$.fragment),tn(w.$$.fragment,1),Ko(w,C.parentNode,C)):w=null}else H&&w.$set(ve)},i(g){D||(w&&tn(w.$$.fragment,g),D=!0)},o(g){w&&rn(w.$$.fragment,g),D=!1},d(g){A[33](null),g&&ki(C),w&&Jo(w,g)}}}const tg=([A,w])=>`${A}: ${w};`;function Y_(A,w,C){let D;const U=["use","class","style","ripple","color","toggle","pressed","ariaLabelOn","ariaLabelOff","touch","displayFlex","size","href","action","component","getElement"];let H=_o(w,U),{$$slots:m={},$$scope:g}=w;const Z=pu(cu());let ve=()=>{};function he(Ut){return Ut===ve}let{use:ye=[]}=w,{class:re=""}=w,{style:it=""}=w,{ripple:et=!0}=w,{color:St=void 0}=w,{toggle:vt=!1}=w,{pressed:Xt=ve}=w,{ariaLabelOn:Wt=void 0}=w,{ariaLabelOff:_t=void 0}=w,{touch:ui=!1}=w,{displayFlex:qt=!0}=w,{size:Zt="normal"}=w,{href:si=void 0}=w,{action:Wi=void 0}=w,Gi,Zi,Ki={},Mr={},Oi={},hr=wd("SMUI:icon-button:context"),eo=wd("SMUI:icon-button:aria-describedby"),{component:ii=si==null?D_:L_}=w,Lr=H.disabled;Ed("SMUI:icon:context","icon-button");let un=null;wg(()=>{Zi&&Zi.destroy()});function Fn(Ut){return Ut in Ki?Ki[Ut]:Hr().classList.contains(Ut)}function Dr(Ut){Ki[Ut]||C(17,Ki[Ut]=!0,Ki)}function Vr(Ut){(!(Ut in Ki)||Ki[Ut])&&C(17,Ki[Ut]=!1,Ki)}function nn(Ut,Nr){Mr[Ut]!=Nr&&(Nr===""||Nr==null?(delete Mr[Ut],C(18,Mr)):C(18,Mr[Ut]=Nr,Mr))}function cn(Ut){var Nr;return Ut in Oi?(Nr=Oi[Ut])!==null&&Nr!==void 0?Nr:null:Hr().getAttribute(Ut)}function oi(Ut,Nr){Oi[Ut]!==Nr&&C(19,Oi[Ut]=Nr,Oi)}function $r(Ut){C(0,Xt=Ut.isOn)}function Hr(){return Gi.getElement()}function wr(Ut){qs[Ut?"unshift":"push"](()=>{Gi=Ut,C(15,Gi)})}const hn=()=>Zi&&Zi.handleClick(),Fi=()=>hr==="top-app-bar:navigation"&&Zf(Hr(),"SMUITopAppBarIconButton:nav");return A.$$set=Ut=>{w=kr(kr({},w),hu(Ut)),C(28,H=_o(w,U)),"use"in Ut&&C(1,ye=Ut.use),"class"in Ut&&C(2,re=Ut.class),"style"in Ut&&C(3,it=Ut.style),"ripple"in Ut&&C(4,et=Ut.ripple),"color"in Ut&&C(5,St=Ut.color),"toggle"in Ut&&C(29,vt=Ut.toggle),"pressed"in Ut&&C(0,Xt=Ut.pressed),"ariaLabelOn"in Ut&&C(6,Wt=Ut.ariaLabelOn),"ariaLabelOff"in Ut&&C(7,_t=Ut.ariaLabelOff),"touch"in Ut&&C(8,ui=Ut.touch),"displayFlex"in Ut&&C(9,qt=Ut.displayFlex),"size"in Ut&&C(10,Zt=Ut.size),"href"in Ut&&C(11,si=Ut.href),"action"in Ut&&C(12,Wi=Ut.action),"component"in Ut&&C(13,ii=Ut.component),"$$scope"in Ut&&C(36,g=Ut.$$scope)},A.$$.update=()=>{if(A.$$.dirty[0]&4096&&C(20,D=(()=>{if(hr==="data-table:pagination")switch(Wi){case"first-page":return{"data-first-page":"true"};case"prev-page":return{"data-prev-page":"true"};case"next-page":return{"data-next-page":"true"};case"last-page":return{"data-last-page":"true"};default:return{"data-action":"true"}}else return hr==="dialog:header"?{"data-mdc-dialog-action":Wi}:{action:Wi}})()),Lr!==H.disabled){const Ut=Hr();"blur"in Ut&&Ut.blur(),C(30,Lr=H.disabled)}A.$$.dirty[0]&536969216|A.$$.dirty[1]&1&&Gi&&Hr()&&vt!==un&&(vt&&!Zi?(C(16,Zi=new H_({addClass:Dr,hasClass:Fn,notifyChange:Ut=>{$r(Ut),Zf(Hr(),"SMUIIconButtonToggle:change",Ut,void 0,!0)},removeClass:Vr,getAttr:cn,setAttr:oi})),Zi.init()):!vt&&Zi&&(Zi.destroy(),C(16,Zi=void 0),C(17,Ki={}),C(19,Oi={})),C(31,un=vt)),A.$$.dirty[0]&65537&&Zi&&!he(Xt)&&Zi.isOn()!==Xt&&Zi.toggle(Xt)},[Xt,ye,re,it,et,St,Wt,_t,ui,qt,Zt,si,Wi,ii,Hr,Gi,Zi,Ki,Mr,Oi,D,Z,he,hr,eo,Dr,Vr,nn,H,vt,Lr,un,m,wr,hn,Fi,g]}class Xf extends xs{constructor(w){super(),bs(this,w,Y_,J_,ws,{use:1,class:2,style:3,ripple:4,color:5,toggle:29,pressed:0,ariaLabelOn:6,ariaLabelOff:7,touch:8,displayFlex:9,size:10,href:11,action:12,component:13,getElement:14},null,[-1,-1])}get getElement(){return this.$$.ctx[14]}}const Pr={title:"GIS for Water",url:"https://water-gis.com",logo:"https://raw.githubusercontent.com/watergis/logo/main/logo.svg",basePath:"/sveltekit-watergis-template",attribution:"\xA9NARWASSCO",styles:[{title:"UNVT(Water)",uri:"https://narwassco.github.io/mapbox-stylefiles/unvt/style.json"},{title:"UNVT(Sewer",uri:"https://narwassco.github.io/mapbox-stylefiles/unvt/style-sewer.json"}],center:{lng:35.87063,lat:-1.08551},zoom:13,search:{url:"https://narwassco.github.io/vt/meter.geojson",target:["connno","serialno"],format:A=>`${A.customer}, ${A.connno}, ${A.serialno}, ${A.village}`,place_type:["meter"],placeholder:"Search CONN NO or S/N",zoom:17},popup:{target:["meter","flow meter","valve","washout","firehydrant","tank","pipeline"]},areaSwitcher:{areas:[{title:"Narok",latlng:[35.87063,-1.08551],zoom:14},{title:"Ololulung'a",latlng:[35.65072,-1.0085],zoom:13},{title:"Kilgoris",latlng:[34.87533,-1.00278],zoom:14},{title:"Suswa",latlng:[36.33078,-1.05307],zoom:13}]},legend:{targets:{pipeline:"Pipeline",pipeline_annotation:"Pipeline Label",meter:"Water Meter","flow meter":"Flow Meter",valve:"Valve",firehydrant:"Fire Hydrant",washout:"Washout",tank:"Tank",tank_annotation:"Tank Label",wtp:"WTP",wtp_annotation:"WTP Label",intake:"Intake",intake_annotation:"Intake Label",parcels:"Parcels",parcels_annotation:"Parcels Label",village:"Village",village_annotation:"Village Label",dma:"DMA","dma-annotation":"DMA Label","contour-line":"Countour","contour-label":"Contour Label",hillshade:"Hillshade"},options:{showDefault:!1,showCheckbox:!0,reverseOrder:!0,onlyRendered:!0}},elevation:{url:"https://narwassco.github.io/narok-terrain/tiles/{z}/{x}/{y}.png",options:{tileSize:512,font:["Roboto Medium"],fontSize:12,fontHalo:1,mainColor:"#263238",haloColor:"#fff",units:"kilometers"}},valhalla:{url:"https://valhalla.water-gis.com",options:{Contours:[{time:3,distance:1,color:"ff0000"},{time:5,distance:2,color:"ffff00"},{time:10,distance:3,color:"0000ff"},{time:15,distance:4,color:"ff00ff"}]}}};function Q_(A){let w;return{c(){w=zo("link"),this.h()},l(C){w=Po(C,"LINK",{rel:!0,href:!0}),this.h()},h(){On(w,"rel","stylesheet"),On(w,"href","/smui.css")},m(C,D){cr(C,w,D)},p:Zu,d(C){C&&ki(w)}}}function ev(A){let w,C,D;return{c(){w=zo("link"),C=Sl(),D=zo("link"),this.h()},l(U){w=Po(U,"LINK",{rel:!0,href:!0,media:!0}),C=Tl(U),D=Po(U,"LINK",{rel:!0,href:!0,media:!0}),this.h()},h(){On(w,"rel","stylesheet"),On(w,"href",Pr.basePath+"/smui.css"),On(w,"media","print"),On(D,"rel","stylesheet"),On(D,"href",Pr.basePath+"/smui-dark.css"),On(D,"media","screen")},m(U,H){cr(U,w,H),cr(U,C,H),cr(U,D,H)},p:Zu,d(U){U&&ki(w),U&&ki(C),U&&ki(D)}}}function tv(A){let w,C,D;return{c(){w=zo("link"),C=Sl(),D=zo("link"),this.h()},l(U){w=Po(U,"LINK",{rel:!0,href:!0,media:!0}),C=Tl(U),D=Po(U,"LINK",{rel:!0,href:!0,media:!0}),this.h()},h(){On(w,"rel","stylesheet"),On(w,"href",Pr.basePath+"/smui.css"),On(w,"media","(prefers-color-scheme: light)"),On(D,"rel","stylesheet"),On(D,"href",Pr.basePath+"/smui-dark.css"),On(D,"media","screen and (prefers-color-scheme: dark)")},m(U,H){cr(U,w,H),cr(U,C,H),cr(U,D,H)},p:Zu,d(U){U&&ki(w),U&&ki(C),U&&ki(D)}}}function iv(A){let w;return{c(){w=Id("menu")},l(C){w=Cd(C,"menu")},m(C,D){cr(C,w,D)},d(C){C&&ki(w)}}}function rv(A){let w=Pr.title+"",C;return{c(){C=Id(w)},l(D){C=Cd(D,w)},m(D,U){cr(D,C,U)},p:Zu,d(D){D&&ki(C)}}}function nv(A){let w,C,D,U,H,m,g,Z;return w=new Xf({props:{class:"material-icons",$$slots:{default:[iv]},$$scope:{ctx:A}}}),g=new j_({props:{$$slots:{default:[rv]},$$scope:{ctx:A}}}),{c(){Wo(w.$$.fragment),C=Sl(),D=zo("a"),U=zo("img"),m=Sl(),Wo(g.$$.fragment),this.h()},l(ve){Ya(w.$$.fragment,ve),C=Tl(ve),D=Po(ve,"A",{href:!0});var he=vs(D);U=Po(he,"IMG",{src:!0,alt:!0,class:!0}),he.forEach(ki),m=Tl(ve),Ya(g.$$.fragment,ve),this.h()},h(){Hy(U.src,H=Pr.logo)||On(U,"src",H),On(U,"alt","logo"),On(U,"class","logo svelte-1cnjkz4"),On(D,"href",Pr.url)},m(ve,he){Ko(w,ve,he),cr(ve,C,he),cr(ve,D,he),em(D,U),cr(ve,m,he),Ko(g,ve,he),Z=!0},p(ve,he){const ye={};he&64&&(ye.$$scope={dirty:he,ctx:ve}),w.$set(ye);const re={};he&64&&(re.$$scope={dirty:he,ctx:ve}),g.$set(re)},i(ve){Z||(tn(w.$$.fragment,ve),tn(g.$$.fragment,ve),Z=!0)},o(ve){rn(w.$$.fragment,ve),rn(g.$$.fragment,ve),Z=!1},d(ve){Jo(w,ve),ve&&ki(C),ve&&ki(D),ve&&ki(m),Jo(g,ve)}}}function ov(A){let w;return{c(){w=Id("print")},l(C){w=Cd(C,"print")},m(C,D){cr(C,w,D)},d(C){C&&ki(w)}}}function av(A){let w;return{c(){w=Id(A[2])},l(C){w=Cd(C,A[2])},m(C,D){cr(C,w,D)},p(C,D){D&4&&Wy(w,C[2])},d(C){C&&ki(w)}}}function sv(A){let w,C,D,U;return w=new Xf({props:{class:"material-icons","aria-label":"Print",$$slots:{default:[ov]},$$scope:{ctx:A}}}),D=new Xf({props:{"aria-label":A[3],class:"material-icons",title:A[3],$$slots:{default:[av]},$$scope:{ctx:A}}}),D.$on("click",A[4]),{c(){Wo(w.$$.fragment),C=Sl(),Wo(D.$$.fragment)},l(H){Ya(w.$$.fragment,H),C=Tl(H),Ya(D.$$.fragment,H)},m(H,m){Ko(w,H,m),cr(H,C,m),Ko(D,H,m),U=!0},p(H,m){const g={};m&64&&(g.$$scope={dirty:m,ctx:H}),w.$set(g);const Z={};m&8&&(Z["aria-label"]=H[3]),m&8&&(Z.title=H[3]),m&68&&(Z.$$scope={dirty:m,ctx:H}),D.$set(Z)},i(H){U||(tn(w.$$.fragment,H),tn(D.$$.fragment,H),U=!0)},o(H){rn(w.$$.fragment,H),rn(D.$$.fragment,H),U=!1},d(H){Jo(w,H),H&&ki(C),Jo(D,H)}}}function lv(A){let w,C,D,U,H,m;return w=new Ym({props:{$$slots:{default:[nv]},$$scope:{ctx:A}}}),H=new Ym({props:{align:"end",toolbar:!0,$$slots:{default:[sv]},$$scope:{ctx:A}}}),{c(){Wo(w.$$.fragment),C=Sl(),D=zo("section"),U=Sl(),Wo(H.$$.fragment)},l(g){Ya(w.$$.fragment,g),C=Tl(g),D=Po(g,"SECTION",{}),vs(D).forEach(ki),U=Tl(g),Ya(H.$$.fragment,g)},m(g,Z){Ko(w,g,Z),cr(g,C,Z),cr(g,D,Z),cr(g,U,Z),Ko(H,g,Z),m=!0},p(g,Z){const ve={};Z&64&&(ve.$$scope={dirty:Z,ctx:g}),w.$set(ve);const he={};Z&76&&(he.$$scope={dirty:Z,ctx:g}),H.$set(he)},i(g){m||(tn(w.$$.fragment,g),tn(H.$$.fragment,g),m=!0)},o(g){rn(w.$$.fragment,g),rn(H.$$.fragment,g),m=!1},d(g){Jo(w,g),g&&ki(C),g&&ki(D),g&&ki(U),Jo(H,g)}}}function uv(A){let w,C;return w=new F_({props:{$$slots:{default:[lv]},$$scope:{ctx:A}}}),{c(){Wo(w.$$.fragment)},l(D){Ya(w.$$.fragment,D)},m(D,U){Ko(w,D,U),C=!0},p(D,U){const H={};U&76&&(H.$$scope={dirty:U,ctx:D}),w.$set(H)},i(D){C||(tn(w.$$.fragment,D),C=!0)},o(D){rn(w.$$.fragment,D),C=!1},d(D){Jo(w,D)}}}function cv(A){let w,C,D,U,H,m;function g(ye,re){return ye[0]===void 0?tv:ye[0]?ev:Q_}let Z=g(A),ve=Z(A),he={variant:"fixed",$$slots:{default:[uv]},$$scope:{ctx:A}};return D=new f_({props:he}),A[5](D),H=new $_({props:{topAppBar:A[1]}}),{c(){ve.c(),w=ru(),C=Sl(),Wo(D.$$.fragment),U=Sl(),Wo(H.$$.fragment)},l(ye){const re=$y('[data-svelte="svelte-dmsmzh"]',document.head);ve.l(re),w=ru(),re.forEach(ki),C=Tl(ye),Ya(D.$$.fragment,ye),U=Tl(ye),Ya(H.$$.fragment,ye)},m(ye,re){ve.m(document.head,null),em(document.head,w),cr(ye,C,re),Ko(D,ye,re),cr(ye,U,re),Ko(H,ye,re),m=!0},p(ye,[re]){Z===(Z=g(ye))&&ve?ve.p(ye,re):(ve.d(1),ve=Z(ye),ve&&(ve.c(),ve.m(w.parentNode,w)));const it={};re&76&&(it.$$scope={dirty:re,ctx:ye}),D.$set(it);const et={};re&2&&(et.topAppBar=ye[1]),H.$set(et)},i(ye){m||(tn(D.$$.fragment,ye),tn(H.$$.fragment,ye),m=!0)},o(ye){rn(D.$$.fragment,ye),rn(H.$$.fragment,ye),m=!1},d(ye){ve.d(ye),ki(w),ye&&ki(C),A[5](null),Jo(D,ye),ye&&ki(U),Jo(H,ye)}}}function hv(A,w,C){let D,U,H,m;Jf(()=>{C(0,H=window.matchMedia("(prefers-color-scheme: light)").matches)});const g=()=>C(0,H=!H);function Z(ve){qs[ve?"unshift":"push"](()=>{m=ve,C(1,m)})}return A.$$.update=()=>{A.$$.dirty&1&&C(3,D=`switch to ${H?"light":"dark"} mode`),A.$$.dirty&1&&C(2,U=H?"light_mode":"dark_mode")},[H,m,U,D,g,Z]}class pv extends xs{constructor(w){super(),bs(this,w,hv,cv,ws,{})}}var js=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function bb(A){return A&&A.__esModule&&Object.prototype.hasOwnProperty.call(A,"default")?A.default:A}function dv(A){if(A.__esModule)return A;var w=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(A).forEach(function(C){var D=Object.getOwnPropertyDescriptor(A,C);Object.defineProperty(w,C,D.get?D:{enumerable:!0,get:function(){return A[C]}})}),w}var th={exports:{}};(function(A,w){(function(C,D){A.exports=D()})(js,function(){var C,D,U;function H(g,Z){if(!C)C=Z;else if(!D)D=Z;else{var ve="var sharedChunk = {}; ("+C+")(sharedChunk); ("+D+")(sharedChunk);",he={};C(he),U=Z(he),typeof window!="undefined"&&(U.workerUrl=window.URL.createObjectURL(new Blob([ve],{type:"text/javascript"})))}}H(["exports"],function(g){var Z=ve;function ve(i,t,o,l){this.cx=3*i,this.bx=3*(o-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(l-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=o,this.p2y=l}function he(i,t,o,l){const p=new Z(i,t,o,l);return function(y){return p.solve(y)}}ve.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var o=i,l=0;l<8;l++){var p=this.sampleCurveX(o)-i;if(Math.abs(p)<t)return o;var y=this.sampleCurveDerivativeX(o);if(Math.abs(y)<1e-6)break;o-=p/y}var v=0,I=1;for(o=i,l=0;l<20&&(p=this.sampleCurveX(o),!(Math.abs(p-i)<t));l++)i>p?v=o:I=o,o=.5*(I-v)+v;return o},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};const ye=he(.25,.1,.25,1);function re(i,t,o){return Math.min(o,Math.max(t,i))}function it(i,t,o){const l=o-t,p=((i-t)%l+l)%l+t;return p===t?o:p}function et(i,...t){for(const o of t)for(const l in o)i[l]=o[l];return i}let St=1;function vt(i,t){i.forEach(o=>{t[o]&&(t[o]=t[o].bind(t))})}function Xt(i,t,o){const l={};for(const p in i)l[p]=t.call(o||this,i[p],p,i);return l}function Wt(i,t,o){const l={};for(const p in i)t.call(o||this,i[p],p,i)&&(l[p]=i[p]);return l}function _t(i){return Array.isArray(i)?i.map(_t):typeof i=="object"&&i?Xt(i,_t):i}const ui={};function qt(i){ui[i]||(typeof console!="undefined"&&console.warn(i),ui[i]=!0)}function Zt(i,t,o){return(o.y-i.y)*(t.x-i.x)>(t.y-i.y)*(o.x-i.x)}function si(i){let t=0;for(let o,l,p=0,y=i.length,v=y-1;p<y;v=p++)o=i[p],l=i[v],t+=(l.x-o.x)*(o.y+l.y);return t}function Wi(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Gi(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,l,p,y)=>{const v=p||y;return t[l]=!v||v.toLowerCase(),""}),t["max-age"]){const o=parseInt(t["max-age"],10);isNaN(o)?delete t["max-age"]:t["max-age"]=o}return t}let Zi,Ki,Mr=null;function Oi(i){if(Mr==null){const t=i.navigator?i.navigator.userAgent:null;Mr=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Mr}function hr(i){return typeof ImageBitmap!="undefined"&&i instanceof ImageBitmap}const eo={now:typeof performance!="undefined"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const t=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(i,t=0){const o=window.document.createElement("canvas"),l=o.getContext("2d");if(!l)throw new Error("failed to create canvas 2d context");return o.width=i.width,o.height=i.height,l.drawImage(i,0,0,i.width,i.height),l.getImageData(-t,-t,i.width+2*t,i.height+2*t)},resolveURL:i=>(Zi||(Zi=document.createElement("a")),Zi.href=i,Zi.href),hardwareConcurrency:typeof navigator!="undefined"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Ki==null&&(Ki=matchMedia("(prefers-reduced-motion: reduce)")),Ki.matches)}};var ii=Lr;function Lr(i,t){this.x=i,this.y=t}Lr.prototype={clone:function(){return new Lr(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,o=i.y-this.y;return t*t+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),o=Math.sin(i),l=o*this.x+t*this.y;return this.x=t*this.x-o*this.y,this.y=l,this},_rotateAround:function(i,t){var o=Math.cos(i),l=Math.sin(i),p=t.y+l*(this.x-t.x)+o*(this.y-t.y);return this.x=t.x+o*(this.x-t.x)-l*(this.y-t.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Lr.convert=function(i){return i instanceof Lr?i:Array.isArray(i)?new Lr(i[0],i[1]):i};const un={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},Fn="mapbox-tiles";let Dr,Vr,nn=500,cn=50;function oi(){typeof caches=="undefined"||Dr||(Dr=caches.open(Fn))}let $r=1/0;const Hr={supported:!1,testSupport:function(i){!Fi&&hn&&(Ut?Nr(i):wr=i)}};let wr,hn,Fi=!1,Ut=!1;function Nr(i){const t=i.createTexture();i.bindTexture(i.TEXTURE_2D,t);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,hn),i.isContextLost())return;Hr.supported=!0}catch{}i.deleteTexture(t),Fi=!0}typeof document!="undefined"&&(hn=document.createElement("img"),hn.onload=function(){wr&&Nr(wr),wr=null,Ut=!0},hn.onerror=function(){Fi=!0,wr=null},hn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const to={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(to);class ci extends Error{constructor(t,o,l,p){super(`AJAXError: ${o} (${t}): ${l}`),this.status=t,this.statusText=o,this.url=l,this.body=p}}const Hn=Wi()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function pn(i,t){const o=new AbortController,l=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:Hn(),signal:o.signal});let p=!1,y=!1;return i.type==="json"&&l.headers.set("Accept","application/json"),((v,I,k)=>{if(y)return;const L=Date.now();fetch(l).then(O=>O.ok?((B,q,$)=>{(i.type==="arrayBuffer"?B.arrayBuffer():i.type==="json"?B.json():B.text()).then(W=>{y||(q&&$&&function(ne,ue,Ie){if(oi(),!Dr)return;const De={status:ue.status,statusText:ue.statusText,headers:new Headers};ue.headers.forEach((Ue,We)=>De.headers.set(We,Ue));const Fe=Gi(ue.headers.get("Cache-Control")||"");Fe["no-store"]||(Fe["max-age"]&&De.headers.set("Expires",new Date(Ie+1e3*Fe["max-age"]).toUTCString()),new Date(De.headers.get("Expires")).getTime()-Ie<42e4||function(Ue,We){if(Vr===void 0)try{new Response(new ReadableStream),Vr=!0}catch{Vr=!1}Vr?We(Ue.body):Ue.blob().then(We)}(ue,Ue=>{const We=new Response(Ue,De);oi(),Dr&&Dr.then(Ve=>Ve.put(function(mt){const dt=mt.indexOf("?");return dt<0?mt:mt.slice(0,dt)}(ne.url),We)).catch(Ve=>qt(Ve.message))}))}(l,q,$),p=!0,t(null,W,B.headers.get("Cache-Control"),B.headers.get("Expires")))}).catch(W=>{y||t(new Error(W.message))})})(O,null,L):O.blob().then(B=>t(new ci(O.status,O.statusText,i.url,B)))).catch(O=>{O.code!==20&&t(new Error(O.message))})})(),{cancel:()=>{y=!0,p||o.abort()}}}const Sn=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(Wi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,t);if(!Wi()){const l=i.url.substring(0,i.url.indexOf("://"));return(un.REGISTERED_PROTOCOLS[l]||pn)(i,t)}}if(!(/^file:/.test(o=i.url)||/^file:/.test(Hn())&&!/^\w+:/.test(o))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return pn(i,t);if(Wi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,t,void 0,!0)}var o;return function(l,p){const y=new XMLHttpRequest;y.open(l.method||"GET",l.url,!0),l.type==="arrayBuffer"&&(y.responseType="arraybuffer");for(const v in l.headers)y.setRequestHeader(v,l.headers[v]);return l.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=l.credentials==="include",y.onerror=()=>{p(new Error(y.statusText))},y.onload=()=>{if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){let v=y.response;if(l.type==="json")try{v=JSON.parse(y.response)}catch(I){return p(I)}p(null,v,y.getResponseHeader("Cache-Control"),y.getResponseHeader("Expires"))}else{const v=new Blob([y.response],{type:y.getResponseHeader("Content-Type")});p(new ci(y.status,y.statusText,l.url,v))}},y.send(l.body),{cancel:()=>y.abort()}}(i,t)},ko=function(i,t){return Sn(et(i,{type:"arrayBuffer"}),t)};function io(i){const t=window.document.createElement("a");return t.href=i,t.protocol===window.document.location.protocol&&t.host===window.document.location.host}const vo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Wr,Un;Wr=[],Un=0;const Yo=function(i,t){if(Hr.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),Un>=un.MAX_PARALLEL_IMAGE_REQUESTS){const y={requestParameters:i,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return Wr.push(y),y}Un++;let o=!1;const l=()=>{if(!o)for(o=!0,Un--;Wr.length&&Un<un.MAX_PARALLEL_IMAGE_REQUESTS;){const y=Wr.shift(),{requestParameters:v,callback:I,cancelled:k}=y;k||(y.cancel=Yo(v,I).cancel)}},p=ko(i,(y,v,I,k)=>{l(),y?t(y):v&&function(L,O){typeof createImageBitmap=="function"?function(B,q){const $=new Blob([new Uint8Array(B)],{type:"image/png"});createImageBitmap($).then(W=>{q(null,W)}).catch(W=>{q(new Error(`Could not load image because of ${W.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(L,O):function(B,q){const $=new Image;$.onload=()=>{q(null,$),URL.revokeObjectURL($.src),$.onload=null,window.requestAnimationFrame(()=>{$.src=vo})},$.onerror=()=>q(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const W=new Blob([new Uint8Array(B)],{type:"image/png"});$.src=B.byteLength?URL.createObjectURL(W):vo}(L,O)}(v,(L,O)=>{L!=null?t(L):O!=null&&t(null,O,{cacheControl:I,expires:k})})});return{cancel:()=>{p.cancel(),l()}}};function wi(i,t,o){o[i]&&o[i].indexOf(t)!==-1||(o[i]=o[i]||[],o[i].push(t))}function Tn(i,t,o){if(o&&o[i]){const l=o[i].indexOf(t);l!==-1&&o[i].splice(l,1)}}class ro{constructor(t,o={}){et(this,o),this.type=t}}class kn extends ro{constructor(t,o={}){super("error",et({error:t},o))}}class Ma{on(t,o){return this._listeners=this._listeners||{},wi(t,o,this._listeners),this}off(t,o){return Tn(t,o,this._listeners),Tn(t,o,this._oneTimeListeners),this}once(t,o){return this._oneTimeListeners=this._oneTimeListeners||{},wi(t,o,this._oneTimeListeners),this}fire(t,o){typeof t=="string"&&(t=new ro(t,o||{}));const l=t.type;if(this.listens(l)){t.target=this;const p=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const I of p)I.call(this,t);const y=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const I of y)Tn(l,I,this._oneTimeListeners),I.call(this,t);const v=this._eventedParent;v&&(et(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(t))}else t instanceof kn&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,o){return this._eventedParent=t,this._eventedParentData=o,this}}var st={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Rt{constructor(t,o,l,p){this.message=(t?`${t}: `:"")+l,p&&(this.identifier=p),o!=null&&o.__line__&&(this.line=o.__line__)}}function Vo(i){const t=i.value;return t?[new Rt(i.key,t,"constants have been deprecated as of v8")]:[]}function no(i,...t){for(const o of t)for(const l in o)i[l]=o[l];return i}function or(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Mn(i){if(Array.isArray(i))return i.map(Mn);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const o in i)t[o]=Mn(i[o]);return t}return or(i)}class dn extends Error{constructor(t,o){super(o),this.message=o,this.key=t}}class xo{constructor(t,o=[]){this.parent=t,this.bindings={};for(const[l,p]of o)this.bindings[l]=p}concat(t){return new xo(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const ur={kind:"null"},kt={kind:"number"},zi={kind:"string"},Ei={kind:"boolean"},Kr={kind:"color"},fn={kind:"object"},yi={kind:"value"},Mo={kind:"collator"},Wn={kind:"formatted"},ar={kind:"resolvedImage"};function J(i,t){return{kind:"array",itemType:i,N:t}}function te(i){if(i.kind==="array"){const t=te(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}const oe=[ur,kt,zi,Ei,Kr,Wn,fn,J(yi),ar];function me(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!me(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(const o of oe)if(!me(o,t))return null}}return`Expected ${te(i)} but found ${te(t)} instead.`}function Te(i,t){return t.some(o=>o.kind===i.kind)}function Re(i,t){return t.some(o=>o==="null"?i===null:o==="array"?Array.isArray(i):o==="object"?i&&!Array.isArray(i)&&typeof i=="object":o===typeof i)}var Oe,fe={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Pe(i){return(i=Math.round(i))<0?0:i>255?255:i}function Xe(i){return Pe(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function ie(i){return(t=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:t>1?1:t;var t}function N(i,t,o){return o<0?o+=1:o>1&&(o-=1),6*o<1?i+(t-i)*o*6:2*o<1?t:3*o<2?i+(t-i)*(2/3-o)*6:i}try{Oe={}.parseCSSColor=function(i){var t,o=i.replace(/ /g,"").toLowerCase();if(o in fe)return fe[o].slice();if(o[0]==="#")return o.length===4?(t=parseInt(o.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:o.length===7&&(t=parseInt(o.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var l=o.indexOf("("),p=o.indexOf(")");if(l!==-1&&p+1===o.length){var y=o.substr(0,l),v=o.substr(l+1,p-(l+1)).split(","),I=1;switch(y){case"rgba":if(v.length!==4)return null;I=ie(v.pop());case"rgb":return v.length!==3?null:[Xe(v[0]),Xe(v[1]),Xe(v[2]),I];case"hsla":if(v.length!==4)return null;I=ie(v.pop());case"hsl":if(v.length!==3)return null;var k=(parseFloat(v[0])%360+360)%360/360,L=ie(v[1]),O=ie(v[2]),B=O<=.5?O*(L+1):O+L-O*L,q=2*O-B;return[Pe(255*N(q,B,k+1/3)),Pe(255*N(q,B,k)),Pe(255*N(q,B,k-1/3)),I];default:return null}}return null}}catch{}class j{constructor(t,o,l,p=1){this.r=t,this.g=o,this.b=l,this.a=p}static parse(t){if(!t)return;if(t instanceof j)return t;if(typeof t!="string")return;const o=Oe(t);return o?new j(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3]):void 0}toString(){const[t,o,l,p]=this.toArray();return`rgba(${Math.round(t)},${Math.round(o)},${Math.round(l)},${p})`}toArray(){const{r:t,g:o,b:l,a:p}=this;return p===0?[0,0,0,0]:[255*t/p,255*o/p,255*l/p,p]}}j.black=new j(0,0,0,1),j.white=new j(1,1,1,1),j.transparent=new j(0,0,0,0),j.red=new j(1,0,0,1);class ee{constructor(t,o,l){this.sensitivity=t?o?"variant":"case":o?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,o){return this.collator.compare(t,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class se{constructor(t,o,l,p,y){this.text=t,this.image=o,this.scale=l,this.fontStack=p,this.textColor=y}}class ge{constructor(t){this.sections=t}static fromString(t){return new ge([new se(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof ge?t:ge.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const o of this.sections){if(o.image){t.push(["image",o.image.name]);continue}t.push(o.text);const l={};o.fontStack&&(l["text-font"]=["literal",o.fontStack.split(",")]),o.scale&&(l["font-scale"]=o.scale),o.textColor&&(l["text-color"]=["rgba"].concat(o.textColor.toArray())),t.push(l)}return t}}class pe{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new pe({name:t,available:!1}):null}serialize(){return["image",this.name]}}function Ee(i,t,o,l){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof o=="number"&&o>=0&&o<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[i,t,o,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[i,t,o,l]:[i,t,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function we(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof j||i instanceof ee||i instanceof ge||i instanceof pe)return!0;if(Array.isArray(i)){for(const t of i)if(!we(t))return!1;return!0}if(typeof i=="object"){for(const t in i)if(!we(i[t]))return!1;return!0}return!1}function Se(i){if(i===null)return ur;if(typeof i=="string")return zi;if(typeof i=="boolean")return Ei;if(typeof i=="number")return kt;if(i instanceof j)return Kr;if(i instanceof ee)return Mo;if(i instanceof ge)return Wn;if(i instanceof pe)return ar;if(Array.isArray(i)){const t=i.length;let o;for(const l of i){const p=Se(l);if(o){if(o===p)continue;o=yi;break}o=p}return J(o||yi,t)}return fn}function $e(i){const t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof j||i instanceof ge||i instanceof pe?i.toString():JSON.stringify(i)}class je{constructor(t,o){this.type=t,this.value=o}static parse(t,o){if(t.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!we(t[1]))return o.error("invalid value");const l=t[1];let p=Se(l);const y=o.expectedType;return p.kind!=="array"||p.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(p=y),new je(p,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof j?["rgba"].concat(this.value.toArray()):this.value instanceof ge?this.value.serialize():this.value}}class He{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Tt={string:zi,number:kt,boolean:Ei,object:fn};class ft{constructor(t,o){this.type=t,this.args=o}static parse(t,o){if(t.length<2)return o.error("Expected at least one argument.");let l,p=1;const y=t[0];if(y==="array"){let I,k;if(t.length>2){const L=t[1];if(typeof L!="string"||!(L in Tt)||L==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);I=Tt[L],p++}else I=yi;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return o.error('The length argument to "array" must be a positive integer literal',2);k=t[2],p++}l=J(I,k)}else l=Tt[y];const v=[];for(;p<t.length;p++){const I=o.parse(t[p],p,yi);if(!I)return null;v.push(I)}return new ft(l,v)}evaluate(t){for(let o=0;o<this.args.length;o++){const l=this.args[o].evaluate(t);if(!me(this.type,Se(l)))return l;if(o===this.args.length-1)throw new He(`Expected value to be of type ${te(this.type)}, but found ${te(Se(l))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,o=[t.kind];if(t.kind==="array"){const l=t.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){o.push(l.kind);const p=t.N;(typeof p=="number"||this.args.length>1)&&o.push(p)}}return o.concat(this.args.map(l=>l.serialize()))}}class wt{constructor(t){this.type=Wn,this.sections=t}static parse(t,o){if(t.length<2)return o.error("Expected at least one argument.");const l=t[1];if(!Array.isArray(l)&&typeof l=="object")return o.error("First argument must be an image or text section.");const p=[];let y=!1;for(let v=1;v<=t.length-1;++v){const I=t[v];if(y&&typeof I=="object"&&!Array.isArray(I)){y=!1;let k=null;if(I["font-scale"]&&(k=o.parse(I["font-scale"],1,kt),!k))return null;let L=null;if(I["text-font"]&&(L=o.parse(I["text-font"],1,J(zi)),!L))return null;let O=null;if(I["text-color"]&&(O=o.parse(I["text-color"],1,Kr),!O))return null;const B=p[p.length-1];B.scale=k,B.font=L,B.textColor=O}else{const k=o.parse(t[v],1,yi);if(!k)return null;const L=k.type.kind;if(L!=="string"&&L!=="value"&&L!=="null"&&L!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,p.push({content:k,scale:null,font:null,textColor:null})}}return new wt(p)}evaluate(t){return new ge(this.sections.map(o=>{const l=o.content.evaluate(t);return Se(l)===ar?new se("",l,null,null,null):new se($e(l),null,o.scale?o.scale.evaluate(t):null,o.font?o.font.evaluate(t).join(","):null,o.textColor?o.textColor.evaluate(t):null)}))}eachChild(t){for(const o of this.sections)t(o.content),o.scale&&t(o.scale),o.font&&t(o.font),o.textColor&&t(o.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const o of this.sections){t.push(o.content.serialize());const l={};o.scale&&(l["font-scale"]=o.scale.serialize()),o.font&&(l["text-font"]=o.font.serialize()),o.textColor&&(l["text-color"]=o.textColor.serialize()),t.push(l)}return t}}class It{constructor(t){this.type=ar,this.input=t}static parse(t,o){if(t.length!==2)return o.error("Expected two arguments.");const l=o.parse(t[1],1,zi);return l?new It(l):o.error("No image name provided.")}evaluate(t){const o=this.input.evaluate(t),l=pe.fromString(o);return l&&t.availableImages&&(l.available=t.availableImages.indexOf(o)>-1),l}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const xi={"to-boolean":Ei,"to-color":Kr,"to-number":kt,"to-string":zi};class Qt{constructor(t,o){this.type=t,this.args=o}static parse(t,o){if(t.length<2)return o.error("Expected at least one argument.");const l=t[0];if((l==="to-boolean"||l==="to-string")&&t.length!==2)return o.error("Expected one argument.");const p=xi[l],y=[];for(let v=1;v<t.length;v++){const I=o.parse(t[v],v,yi);if(!I)return null;y.push(I)}return new Qt(p,y)}evaluate(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){let o,l;for(const p of this.args){if(o=p.evaluate(t),l=null,o instanceof j)return o;if(typeof o=="string"){const y=t.parseColor(o);if(y)return y}else if(Array.isArray(o)&&(l=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:Ee(o[0],o[1],o[2],o[3]),!l))return new j(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new He(l||`Could not parse color from value '${typeof o=="string"?o:String(JSON.stringify(o))}'`)}if(this.type.kind==="number"){let o=null;for(const l of this.args){if(o=l.evaluate(t),o===null)return 0;const p=Number(o);if(!isNaN(p))return p}throw new He(`Could not convert ${JSON.stringify(o)} to number.`)}return this.type.kind==="formatted"?ge.fromString($e(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?pe.fromString($e(this.args[0].evaluate(t))):$e(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new wt([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new It(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild(o=>{t.push(o.serialize())}),t}}const ni=["Unknown","Point","LineString","Polygon"];class $t{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ni[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let o=this._parseColorCache[t];return o||(o=this._parseColorCache[t]=j.parse(t)),o}}class Mt{constructor(t,o,l,p){this.name=t,this.type=o,this._evaluate=l,this.args=p}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,o){const l=t[0],p=Mt.definitions[l];if(!p)return o.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(p)?p[0]:p.type,v=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,I=v.filter(([L])=>!Array.isArray(L)||L.length===t.length-1);let k=null;for(const[L,O]of I){k=new Qo(o.registry,o.path,null,o.scope);const B=[];let q=!1;for(let $=1;$<t.length;$++){const W=t[$],ne=Array.isArray(L)?L[$-1]:L.type,ue=k.parse(W,1+B.length,ne);if(!ue){q=!0;break}B.push(ue)}if(!q)if(Array.isArray(L)&&L.length!==B.length)k.error(`Expected ${L.length} arguments, but found ${B.length} instead.`);else{for(let $=0;$<B.length;$++){const W=Array.isArray(L)?L[$]:L.type,ne=B[$];k.concat($+1).checkSubtype(W,ne.type)}if(k.errors.length===0)return new Mt(l,y,O,B)}}if(I.length===1)o.errors.push(...k.errors);else{const L=(I.length?I:v).map(([B])=>{return q=B,Array.isArray(q)?`(${q.map(te).join(", ")})`:`(${te(q.type)}...)`;var q}).join(" | "),O=[];for(let B=1;B<t.length;B++){const q=o.parse(t[B],1+O.length);if(!q)return null;O.push(te(q.type))}o.error(`Expected arguments of type ${L}, but found (${O.join(", ")}) instead.`)}return null}static register(t,o){Mt.definitions=o;for(const l in o)t[l]=Mt}}class di{constructor(t,o,l){this.type=Mo,this.locale=l,this.caseSensitive=t,this.diacriticSensitive=o}static parse(t,o){if(t.length!==2)return o.error("Expected one argument.");const l=t[1];if(typeof l!="object"||Array.isArray(l))return o.error("Collator options argument must be an object.");const p=o.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,Ei);if(!p)return null;const y=o.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,Ei);if(!y)return null;let v=null;return l.locale&&(v=o.parse(l.locale,1,zi),!v)?null:new di(p,y,v)}evaluate(t){return new ee(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const qi=8192;function jr(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function Xi(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function Ln(i,t){const o=(180+i[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,p=Math.pow(2,t.z);return[Math.round(o*p*qi),Math.round(l*p*qi)]}function Gs(i,t,o){const l=i[0]-t[0],p=i[1]-t[1],y=i[0]-o[0],v=i[1]-o[1];return l*v-y*p==0&&l*y<=0&&p*v<=0}function tr(i,t){let o=!1;for(let v=0,I=t.length;v<I;v++){const k=t[v];for(let L=0,O=k.length;L<O-1;L++){if(Gs(i,k[L],k[L+1]))return!1;(p=k[L])[1]>(l=i)[1]!=(y=k[L+1])[1]>l[1]&&l[0]<(y[0]-p[0])*(l[1]-p[1])/(y[1]-p[1])+p[0]&&(o=!o)}}var l,p,y;return o}function Rr(i,t){for(let o=0;o<t.length;o++)if(tr(i,t[o]))return!0;return!1}function es(i,t,o,l){const p=l[0]-o[0],y=l[1]-o[1],v=(i[0]-o[0])*y-p*(i[1]-o[1]),I=(t[0]-o[0])*y-p*(t[1]-o[1]);return v>0&&I<0||v<0&&I>0}function Vn(i,t,o){for(const L of o)for(let O=0;O<L.length-1;++O)if((I=[(v=L[O+1])[0]-(y=L[O])[0],v[1]-y[1]])[0]*(k=[(p=t)[0]-(l=i)[0],p[1]-l[1]])[1]-I[1]*k[0]!=0&&es(l,p,y,v)&&es(y,v,l,p))return!0;var l,p,y,v,I,k;return!1}function Jr(i,t){for(let o=0;o<i.length;++o)if(!tr(i[o],t))return!1;for(let o=0;o<i.length-1;++o)if(Vn(i[o],i[o+1],t))return!1;return!0}function bo(i,t){for(let o=0;o<t.length;o++)if(Jr(i,t[o]))return!0;return!1}function pr(i,t,o){const l=[];for(let p=0;p<i.length;p++){const y=[];for(let v=0;v<i[p].length;v++){const I=Ln(i[p][v],o);jr(t,I),y.push(I)}l.push(y)}return l}function wo(i,t,o){const l=[];for(let p=0;p<i.length;p++){const y=pr(i[p],t,o);l.push(y)}return l}function Kn(i,t,o,l){if(i[0]<o[0]||i[0]>o[2]){const p=.5*l;let y=i[0]-o[0]>p?-l:o[0]-i[0]>p?l:0;y===0&&(y=i[0]-o[2]>p?-l:o[2]-i[0]>p?l:0),i[0]+=y}jr(t,i)}function du(i,t,o,l){const p=Math.pow(2,l.z)*qi,y=[l.x*qi,l.y*qi],v=[];for(const I of i)for(const k of I){const L=[k.x+y[0],k.y+y[1]];Kn(L,t,o,p),v.push(L)}return v}function Eo(i,t,o,l){const p=Math.pow(2,l.z)*qi,y=[l.x*qi,l.y*qi],v=[];for(const k of i){const L=[];for(const O of k){const B=[O.x+y[0],O.y+y[1]];jr(t,B),L.push(B)}v.push(L)}if(t[2]-t[0]<=p/2){(I=t)[0]=I[1]=1/0,I[2]=I[3]=-1/0;for(const k of v)for(const L of k)Kn(L,t,o,p)}var I;return v}class ts{constructor(t,o){this.type=Ei,this.geojson=t,this.geometries=o}static parse(t,o){if(t.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(we(t[1])){const l=t[1];if(l.type==="FeatureCollection")for(let p=0;p<l.features.length;++p){const y=l.features[p].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new ts(l,l.features[p].geometry)}else if(l.type==="Feature"){const p=l.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new ts(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new ts(l,l)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(o,l){const p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],v=o.canonicalID();if(l.type==="Polygon"){const I=pr(l.coordinates,y,v),k=du(o.geometry(),p,y,v);if(!Xi(p,y))return!1;for(const L of k)if(!tr(L,I))return!1}if(l.type==="MultiPolygon"){const I=wo(l.coordinates,y,v),k=du(o.geometry(),p,y,v);if(!Xi(p,y))return!1;for(const L of k)if(!Rr(L,I))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(o,l){const p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],v=o.canonicalID();if(l.type==="Polygon"){const I=pr(l.coordinates,y,v),k=Eo(o.geometry(),p,y,v);if(!Xi(p,y))return!1;for(const L of k)if(!Jr(L,I))return!1}if(l.type==="MultiPolygon"){const I=wo(l.coordinates,y,v),k=Eo(o.geometry(),p,y,v);if(!Xi(p,y))return!1;for(const L of k)if(!bo(L,I))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Lo(i){if(i instanceof Mt&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof ts)return!1;let t=!0;return i.eachChild(o=>{t&&!Lo(o)&&(t=!1)}),t}function Br(i){if(i instanceof Mt&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(o=>{t&&!Br(o)&&(t=!1)}),t}function oo(i,t){if(i instanceof Mt&&t.indexOf(i.name)>=0)return!1;let o=!0;return i.eachChild(l=>{o&&!oo(l,t)&&(o=!1)}),o}class mn{constructor(t,o){this.type=o.type,this.name=t,this.boundExpression=o}static parse(t,o){if(t.length!==2||typeof t[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const l=t[1];return o.scope.has(l)?new mn(l,o.scope.get(l)):o.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Qo{constructor(t,o=[],l,p=new xo,y=[]){this.registry=t,this.path=o,this.key=o.map(v=>`[${v}]`).join(""),this.scope=p,this.errors=y,this.expectedType=l}parse(t,o,l,p,y={}){return o?this.concat(o,l,p)._parse(t,y):this._parse(t,y)}_parse(t,o){function l(p,y,v){return v==="assert"?new ft(y,[p]):v==="coerce"?new Qt(y,[p]):p}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=t[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const y=this.registry[p];if(y){let v=y.parse(t,this);if(!v)return null;if(this.expectedType){const I=this.expectedType,k=v.type;if(I.kind!=="string"&&I.kind!=="number"&&I.kind!=="boolean"&&I.kind!=="object"&&I.kind!=="array"||k.kind!=="value")if(I.kind!=="color"&&I.kind!=="formatted"&&I.kind!=="resolvedImage"||k.kind!=="value"&&k.kind!=="string"){if(this.checkSubtype(I,k))return null}else v=l(v,I,o.typeAnnotation||"coerce");else v=l(v,I,o.typeAnnotation||"assert")}if(!(v instanceof je)&&v.type.kind!=="resolvedImage"&&Zs(v)){const I=new $t;try{v=new je(v.type,v.evaluate(I))}catch(k){return this.error(k.message),null}}return v}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,o,l){const p=typeof t=="number"?this.path.concat(t):this.path,y=l?this.scope.concat(l):this.scope;return new Qo(this.registry,p,o||null,y,this.errors)}error(t,...o){const l=`${this.key}${o.map(p=>`[${p}]`).join("")}`;this.errors.push(new dn(l,t))}checkSubtype(t,o){const l=me(t,o);return l&&this.error(l),l}}function Zs(i){if(i instanceof mn)return Zs(i.boundExpression);if(i instanceof Mt&&i.name==="error"||i instanceof di||i instanceof ts)return!1;const t=i instanceof Qt||i instanceof ft;let o=!0;return i.eachChild(l=>{o=t?o&&Zs(l):o&&l instanceof je}),!!o&&Lo(i)&&oo(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Il(i,t){const o=i.length-1;let l,p,y=0,v=o,I=0;for(;y<=v;)if(I=Math.floor((y+v)/2),l=i[I],p=i[I+1],l<=t){if(I===o||t<p)return I;y=I+1}else{if(!(l>t))throw new He("Input is not a number.");v=I-1}return 0}class is{constructor(t,o,l){this.type=t,this.input=o,this.labels=[],this.outputs=[];for(const[p,y]of l)this.labels.push(p),this.outputs.push(y)}static parse(t,o){if(t.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");const l=o.parse(t[1],1,kt);if(!l)return null;const p=[];let y=null;o.expectedType&&o.expectedType.kind!=="value"&&(y=o.expectedType);for(let v=1;v<t.length;v+=2){const I=v===1?-1/0:t[v],k=t[v+1],L=v,O=v+1;if(typeof I!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(p.length&&p[p.length-1][0]>=I)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',L);const B=o.parse(k,O,y);if(!B)return null;y=y||B.type,p.push([I,B])}return new is(y,l,p)}evaluate(t){const o=this.labels,l=this.outputs;if(o.length===1)return l[0].evaluate(t);const p=this.input.evaluate(t);if(p<=o[0])return l[0].evaluate(t);const y=o.length;return p>=o[y-1]?l[y-1].evaluate(t):l[Il(o,p)].evaluate(t)}eachChild(t){t(this.input);for(const o of this.outputs)t(o)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let o=0;o<this.labels.length;o++)o>0&&t.push(this.labels[o]),t.push(this.outputs[o].serialize());return t}}function on(i,t,o){return i*(1-o)+t*o}var Ss=Object.freeze({__proto__:null,number:on,color:function(i,t,o){return new j(on(i.r,t.r,o),on(i.g,t.g,o),on(i.b,t.b,o),on(i.a,t.a,o))},array:function(i,t,o){return i.map((l,p)=>on(l,t[p],o))}});const fu=.95047,mu=1.08883,gu=4/29,fa=6/29,Xs=3*fa*fa,$s=Math.PI/180,$u=180/Math.PI;function Ts(i){return i>.008856451679035631?Math.pow(i,1/3):i/Xs+gu}function ao(i){return i>fa?i*i*i:Xs*(i-gu)}function ea(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function ta(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function La(i){const t=ta(i.r),o=ta(i.g),l=ta(i.b),p=Ts((.4124564*t+.3575761*o+.1804375*l)/fu),y=Ts((.2126729*t+.7151522*o+.072175*l)/1);return{l:116*y-16,a:500*(p-y),b:200*(y-Ts((.0193339*t+.119192*o+.9503041*l)/mu)),alpha:i.a}}function Ri(i){let t=(i.l+16)/116,o=isNaN(i.a)?t:t+i.a/500,l=isNaN(i.b)?t:t-i.b/200;return t=1*ao(t),o=fu*ao(o),l=mu*ao(l),new j(ea(3.2404542*o-1.5371385*t-.4985314*l),ea(-.969266*o+1.8760108*t+.041556*l),ea(.0556434*o-.2040259*t+1.0572252*l),i.alpha)}function Da(i,t,o){const l=t-i;return i+o*(l>180||l<-180?l-360*Math.round(l/360):l)}const Ra={forward:La,reverse:Ri,interpolate:function(i,t,o){return{l:on(i.l,t.l,o),a:on(i.a,t.a,o),b:on(i.b,t.b,o),alpha:on(i.alpha,t.alpha,o)}}},An={forward:function(i){const{l:t,a:o,b:l}=La(i),p=Math.atan2(l,o)*$u;return{h:p<0?p+360:p,c:Math.sqrt(o*o+l*l),l:t,alpha:i.a}},reverse:function(i){const t=i.h*$s,o=i.c;return Ri({l:i.l,a:Math.cos(t)*o,b:Math.sin(t)*o,alpha:i.alpha})},interpolate:function(i,t,o){return{h:Da(i.h,t.h,o),c:on(i.c,t.c,o),l:on(i.l,t.l,o),alpha:on(i.alpha,t.alpha,o)}}};var Or=Object.freeze({__proto__:null,lab:Ra,hcl:An});class In{constructor(t,o,l,p,y){this.type=t,this.operator=o,this.interpolation=l,this.input=p,this.labels=[],this.outputs=[];for(const[v,I]of y)this.labels.push(v),this.outputs.push(I)}static interpolationFactor(t,o,l,p){let y=0;if(t.name==="exponential")y=Cl(o,t.base,l,p);else if(t.name==="linear")y=Cl(o,1,l,p);else if(t.name==="cubic-bezier"){const v=t.controlPoints;y=new Z(v[0],v[1],v[2],v[3]).solve(Cl(o,1,l,p))}return y}static parse(t,o){let[l,p,y,...v]=t;if(!Array.isArray(p)||p.length===0)return o.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const L=p[1];if(typeof L!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:L}}else{if(p[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const L=p.slice(1);if(L.length!==4||L.some(O=>typeof O!="number"||O<0||O>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:L}}}if(t.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(y=o.parse(y,2,kt),!y)return null;const I=[];let k=null;l==="interpolate-hcl"||l==="interpolate-lab"?k=Kr:o.expectedType&&o.expectedType.kind!=="value"&&(k=o.expectedType);for(let L=0;L<v.length;L+=2){const O=v[L],B=v[L+1],q=L+3,$=L+4;if(typeof O!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',q);if(I.length&&I[I.length-1][0]>=O)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',q);const W=o.parse(B,$,k);if(!W)return null;k=k||W.type,I.push([O,W])}return k.kind==="number"||k.kind==="color"||k.kind==="array"&&k.itemType.kind==="number"&&typeof k.N=="number"?new In(k,l,p,y,I):o.error(`Type ${te(k)} is not interpolatable.`)}evaluate(t){const o=this.labels,l=this.outputs;if(o.length===1)return l[0].evaluate(t);const p=this.input.evaluate(t);if(p<=o[0])return l[0].evaluate(t);const y=o.length;if(p>=o[y-1])return l[y-1].evaluate(t);const v=Il(o,p),I=In.interpolationFactor(this.interpolation,p,o[v],o[v+1]),k=l[v].evaluate(t),L=l[v+1].evaluate(t);return this.operator==="interpolate"?Ss[this.type.kind.toLowerCase()](k,L,I):this.operator==="interpolate-hcl"?An.reverse(An.interpolate(An.forward(k),An.forward(L),I)):Ra.reverse(Ra.interpolate(Ra.forward(k),Ra.forward(L),I))}eachChild(t){t(this.input);for(const o of this.outputs)t(o)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const o=[this.operator,t,this.input.serialize()];for(let l=0;l<this.labels.length;l++)o.push(this.labels[l],this.outputs[l].serialize());return o}}function Cl(i,t,o,l){const p=l-o,y=i-o;return p===0?0:t===1?y/p:(Math.pow(t,y)-1)/(Math.pow(t,p)-1)}class zl{constructor(t,o){this.type=t,this.args=o}static parse(t,o){if(t.length<2)return o.error("Expectected at least one argument.");let l=null;const p=o.expectedType;p&&p.kind!=="value"&&(l=p);const y=[];for(const I of t.slice(1)){const k=o.parse(I,1+y.length,l,void 0,{typeAnnotation:"omit"});if(!k)return null;l=l||k.type,y.push(k)}const v=p&&y.some(I=>me(p,I.type));return new zl(v?yi:l,y)}evaluate(t){let o,l=null,p=0;for(const y of this.args)if(p++,l=y.evaluate(t),l&&l instanceof pe&&!l.available&&(o||(o=l.name),l=null,p===this.args.length&&(l=o)),l!==null)break;return l}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(o=>{t.push(o.serialize())}),t}}class Pl{constructor(t,o){this.type=o.type,this.bindings=[].concat(t),this.result=o}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const o of this.bindings)t(o[1]);t(this.result)}static parse(t,o){if(t.length<4)return o.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const l=[];for(let y=1;y<t.length-1;y+=2){const v=t[y];if(typeof v!="string")return o.error(`Expected string, but found ${typeof v} instead.`,y);if(/[^a-zA-Z0-9_]/.test(v))return o.error("Variable names must contain only alphanumeric characters or '_'.",y);const I=o.parse(t[y+1],y+1);if(!I)return null;l.push([v,I])}const p=o.parse(t[t.length-1],t.length-1,o.expectedType,l);return p?new Pl(l,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[o,l]of this.bindings)t.push(o,l.serialize());return t.push(this.result.serialize()),t}}class Hs{constructor(t,o,l){this.type=t,this.index=o,this.input=l}static parse(t,o){if(t.length!==3)return o.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=o.parse(t[1],1,kt),p=o.parse(t[2],2,J(o.expectedType||yi));return l&&p?new Hs(p.type.itemType,l,p):null}evaluate(t){const o=this.index.evaluate(t),l=this.input.evaluate(t);if(o<0)throw new He(`Array index out of bounds: ${o} < 0.`);if(o>=l.length)throw new He(`Array index out of bounds: ${o} > ${l.length-1}.`);if(o!==Math.floor(o))throw new He(`Array index must be an integer, but found ${o} instead.`);return l[o]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Ws{constructor(t,o){this.type=Ei,this.needle=t,this.haystack=o}static parse(t,o){if(t.length!==3)return o.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=o.parse(t[1],1,yi),p=o.parse(t[2],2,yi);return l&&p?Te(l.type,[Ei,zi,kt,ur,yi])?new Ws(l,p):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${te(l.type)} instead`):null}evaluate(t){const o=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!l)return!1;if(!Re(o,["boolean","string","number","null"]))throw new He(`Expected first argument to be of type boolean, string, number or null, but found ${te(Se(o))} instead.`);if(!Re(l,["string","array"]))throw new He(`Expected second argument to be of type array or string, but found ${te(Se(l))} instead.`);return l.indexOf(o)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class As{constructor(t,o,l){this.type=kt,this.needle=t,this.haystack=o,this.fromIndex=l}static parse(t,o){if(t.length<=2||t.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=o.parse(t[1],1,yi),p=o.parse(t[2],2,yi);if(!l||!p)return null;if(!Te(l.type,[Ei,zi,kt,ur,yi]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${te(l.type)} instead`);if(t.length===4){const y=o.parse(t[3],3,kt);return y?new As(l,p,y):null}return new As(l,p)}evaluate(t){const o=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!Re(o,["boolean","string","number","null"]))throw new He(`Expected first argument to be of type boolean, string, number or null, but found ${te(Se(o))} instead.`);if(!Re(l,["string","array"]))throw new He(`Expected second argument to be of type array or string, but found ${te(Se(l))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(t);return l.indexOf(o,p)}return l.indexOf(o)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Ks{constructor(t,o,l,p,y,v){this.inputType=t,this.type=o,this.input=l,this.cases=p,this.outputs=y,this.otherwise=v}static parse(t,o){if(t.length<5)return o.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return o.error("Expected an even number of arguments.");let l,p;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);const y={},v=[];for(let L=2;L<t.length-1;L+=2){let O=t[L];const B=t[L+1];Array.isArray(O)||(O=[O]);const q=o.concat(L);if(O.length===0)return q.error("Expected at least one branch label.");for(const W of O){if(typeof W!="number"&&typeof W!="string")return q.error("Branch labels must be numbers or strings.");if(typeof W=="number"&&Math.abs(W)>Number.MAX_SAFE_INTEGER)return q.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof W=="number"&&Math.floor(W)!==W)return q.error("Numeric branch labels must be integer values.");if(l){if(q.checkSubtype(l,Se(W)))return null}else l=Se(W);if(y[String(W)]!==void 0)return q.error("Branch labels must be unique.");y[String(W)]=v.length}const $=o.parse(B,L,p);if(!$)return null;p=p||$.type,v.push($)}const I=o.parse(t[1],1,yi);if(!I)return null;const k=o.parse(t[t.length-1],t.length-1,p);return k?I.type.kind!=="value"&&o.concat(1).checkSubtype(l,I.type)?null:new Ks(l,p,I,y,v,k):null}evaluate(t){const o=this.input.evaluate(t);return(Se(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],o=Object.keys(this.cases).sort(),l=[],p={};for(const v of o){const I=p[this.cases[v]];I===void 0?(p[this.cases[v]]=l.length,l.push([this.cases[v],[v]])):l[I][1].push(v)}const y=v=>this.inputType.kind==="number"?Number(v):v;for(const[v,I]of l)t.push(I.length===1?y(I[0]):I.map(y)),t.push(this.outputs[v].serialize());return t.push(this.otherwise.serialize()),t}}class kl{constructor(t,o,l){this.type=t,this.branches=o,this.otherwise=l}static parse(t,o){if(t.length<4)return o.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return o.error("Expected an odd number of arguments.");let l;o.expectedType&&o.expectedType.kind!=="value"&&(l=o.expectedType);const p=[];for(let v=1;v<t.length-1;v+=2){const I=o.parse(t[v],v,Ei);if(!I)return null;const k=o.parse(t[v+1],v+1,l);if(!k)return null;p.push([I,k]),l=l||k.type}const y=o.parse(t[t.length-1],t.length-1,l);return y?new kl(l,p,y):null}evaluate(t){for(const[o,l]of this.branches)if(o.evaluate(t))return l.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[o,l]of this.branches)t(o),t(l);t(this.otherwise)}outputDefined(){return this.branches.every(([t,o])=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(o=>{t.push(o.serialize())}),t}}class Js{constructor(t,o,l,p){this.type=t,this.input=o,this.beginIndex=l,this.endIndex=p}static parse(t,o){if(t.length<=2||t.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=o.parse(t[1],1,yi),p=o.parse(t[2],2,kt);if(!l||!p)return null;if(!Te(l.type,[J(yi),zi,yi]))return o.error(`Expected first argument to be of type array or string, but found ${te(l.type)} instead`);if(t.length===4){const y=o.parse(t[3],3,kt);return y?new Js(l.type,l,p,y):null}return new Js(l.type,l,p)}evaluate(t){const o=this.input.evaluate(t),l=this.beginIndex.evaluate(t);if(!Re(o,["string","array"]))throw new He(`Expected first argument to be of type array or string, but found ${te(Se(o))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(t);return o.slice(l,p)}return o.slice(l)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Hu(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Is(i,t,o,l){return l.compare(t,o)===0}function ia(i,t,o){const l=i!=="=="&&i!=="!=";return class Ig{constructor(y,v,I){this.type=Ei,this.lhs=y,this.rhs=v,this.collator=I,this.hasUntypedArgument=y.type.kind==="value"||v.type.kind==="value"}static parse(y,v){if(y.length!==3&&y.length!==4)return v.error("Expected two or three arguments.");const I=y[0];let k=v.parse(y[1],1,yi);if(!k)return null;if(!Hu(I,k.type))return v.concat(1).error(`"${I}" comparisons are not supported for type '${te(k.type)}'.`);let L=v.parse(y[2],2,yi);if(!L)return null;if(!Hu(I,L.type))return v.concat(2).error(`"${I}" comparisons are not supported for type '${te(L.type)}'.`);if(k.type.kind!==L.type.kind&&k.type.kind!=="value"&&L.type.kind!=="value")return v.error(`Cannot compare types '${te(k.type)}' and '${te(L.type)}'.`);l&&(k.type.kind==="value"&&L.type.kind!=="value"?k=new ft(L.type,[k]):k.type.kind!=="value"&&L.type.kind==="value"&&(L=new ft(k.type,[L])));let O=null;if(y.length===4){if(k.type.kind!=="string"&&L.type.kind!=="string"&&k.type.kind!=="value"&&L.type.kind!=="value")return v.error("Cannot use collator to compare non-string types.");if(O=v.parse(y[3],3,Mo),!O)return null}return new Ig(k,L,O)}evaluate(y){const v=this.lhs.evaluate(y),I=this.rhs.evaluate(y);if(l&&this.hasUntypedArgument){const k=Se(v),L=Se(I);if(k.kind!==L.kind||k.kind!=="string"&&k.kind!=="number")throw new He(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${k.kind}, ${L.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const k=Se(v),L=Se(I);if(k.kind!=="string"||L.kind!=="string")return t(y,v,I)}return this.collator?o(y,v,I,this.collator.evaluate(y)):t(y,v,I)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}serialize(){const y=[i];return this.eachChild(v=>{y.push(v.serialize())}),y}}}const Wu=ia("==",function(i,t,o){return t===o},Is),Cn=ia("!=",function(i,t,o){return t!==o},function(i,t,o,l){return!Is(0,t,o,l)}),yu=ia("<",function(i,t,o){return t<o},function(i,t,o,l){return l.compare(t,o)<0}),Ba=ia(">",function(i,t,o){return t>o},function(i,t,o,l){return l.compare(t,o)>0}),Oa=ia("<=",function(i,t,o){return t<=o},function(i,t,o,l){return l.compare(t,o)<=0}),rs=ia(">=",function(i,t,o){return t>=o},function(i,t,o,l){return l.compare(t,o)>=0});class ma{constructor(t,o,l,p,y){this.type=zi,this.number=t,this.locale=o,this.currency=l,this.minFractionDigits=p,this.maxFractionDigits=y}static parse(t,o){if(t.length!==3)return o.error("Expected two arguments.");const l=o.parse(t[1],1,kt);if(!l)return null;const p=t[2];if(typeof p!="object"||Array.isArray(p))return o.error("NumberFormat options argument must be an object.");let y=null;if(p.locale&&(y=o.parse(p.locale,1,zi),!y))return null;let v=null;if(p.currency&&(v=o.parse(p.currency,1,zi),!v))return null;let I=null;if(p["min-fraction-digits"]&&(I=o.parse(p["min-fraction-digits"],1,kt),!I))return null;let k=null;return p["max-fraction-digits"]&&(k=o.parse(p["max-fraction-digits"],1,kt),!k)?null:new ma(l,y,v,I,k)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class ra{constructor(t){this.type=kt,this.input=t}static parse(t,o){if(t.length!==2)return o.error(`Expected 1 argument, but found ${t.length-1} instead.`);const l=o.parse(t[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${te(l.type)} instead.`):new ra(l):null}evaluate(t){const o=this.input.evaluate(t);if(typeof o=="string"||Array.isArray(o))return o.length;throw new He(`Expected value to be of type string or array, but found ${te(Se(o))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(o=>{t.push(o.serialize())}),t}}const Do={"==":Wu,"!=":Cn,">":Ba,"<":yu,">=":rs,"<=":Oa,array:ft,at:Hs,boolean:ft,case:kl,coalesce:zl,collator:di,format:wt,image:It,in:Ws,"index-of":As,interpolate:In,"interpolate-hcl":In,"interpolate-lab":In,length:ra,let:Pl,literal:je,match:Ks,number:ft,"number-format":ma,object:ft,slice:Js,step:is,string:ft,"to-boolean":Qt,"to-color":Qt,"to-number":Qt,"to-string":Qt,var:mn,within:ts};function Fa(i,[t,o,l,p]){t=t.evaluate(i),o=o.evaluate(i),l=l.evaluate(i);const y=p?p.evaluate(i):1,v=Ee(t,o,l,y);if(v)throw new He(v);return new j(t/255*y,o/255*y,l/255*y,y)}function ga(i,t){return i in t}function Ml(i,t){const o=t[i];return o===void 0?null:o}function Ua(i){return{type:i}}function ir(i){return{result:"success",value:i}}function ns(i){return{result:"error",value:i}}function ya(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function _u(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Ll(i){return!!i.expression&&i.expression.interpolated}function Si(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Ys(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Ni(i){return i}function No(i,t){const o=t.type==="color",l=i.stops&&typeof i.stops[0][0]=="object",p=l||!(l||i.property!==void 0),y=i.type||(Ll(t)?"exponential":"interval");if(o&&((i=no({},i)).stops&&(i.stops=i.stops.map(L=>[L[0],j.parse(L[1])])),i.default=j.parse(i.default?i.default:t.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!Or[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let v,I,k;if(y==="exponential")v=el;else if(y==="interval")v=Qs;else if(y==="categorical"){v=Fr,I=Object.create(null);for(const L of i.stops)I[L[0]]=L[1];k=typeof i.stops[0][0]}else{if(y!=="identity")throw new Error(`Unknown function type "${y}"`);v=os}if(l){const L={},O=[];for(let $=0;$<i.stops.length;$++){const W=i.stops[$],ne=W[0].zoom;L[ne]===void 0&&(L[ne]={zoom:ne,type:i.type,property:i.property,default:i.default,stops:[]},O.push(ne)),L[ne].stops.push([W[0].value,W[1]])}const B=[];for(const $ of O)B.push([L[$].zoom,No(L[$],t)]);const q={name:"linear"};return{kind:"composite",interpolationType:q,interpolationFactor:In.interpolationFactor.bind(void 0,q),zoomStops:B.map($=>$[0]),evaluate:({zoom:$},W)=>el({stops:B,base:i.base},t,$).evaluate($,W)}}if(p){const L=y==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:L,interpolationFactor:In.interpolationFactor.bind(void 0,L),zoomStops:i.stops.map(O=>O[0]),evaluate:({zoom:O})=>v(i,t,O,I,k)}}return{kind:"source",evaluate(L,O){const B=O&&O.properties?O.properties[i.property]:void 0;return B===void 0?sr(i.default,t.default):v(i,t,B,I,k)}}}function sr(i,t,o){return i!==void 0?i:t!==void 0?t:o!==void 0?o:void 0}function Fr(i,t,o,l,p){return sr(typeof o===p?l[o]:void 0,i.default,t.default)}function Qs(i,t,o){if(Si(o)!=="number")return sr(i.default,t.default);const l=i.stops.length;if(l===1||o<=i.stops[0][0])return i.stops[0][1];if(o>=i.stops[l-1][0])return i.stops[l-1][1];const p=Il(i.stops.map(y=>y[0]),o);return i.stops[p][1]}function el(i,t,o){const l=i.base!==void 0?i.base:1;if(Si(o)!=="number")return sr(i.default,t.default);const p=i.stops.length;if(p===1||o<=i.stops[0][0])return i.stops[0][1];if(o>=i.stops[p-1][0])return i.stops[p-1][1];const y=Il(i.stops.map(O=>O[0]),o),v=function(O,B,q,$){const W=$-q,ne=O-q;return W===0?0:B===1?ne/W:(Math.pow(B,ne)-1)/(Math.pow(B,W)-1)}(o,l,i.stops[y][0],i.stops[y+1][0]),I=i.stops[y][1],k=i.stops[y+1][1];let L=Ss[t.type]||Ni;if(i.colorSpace&&i.colorSpace!=="rgb"){const O=Or[i.colorSpace];L=(B,q)=>O.reverse(O.interpolate(O.forward(B),O.forward(q),v))}return typeof I.evaluate=="function"?{evaluate(...O){const B=I.evaluate.apply(void 0,O),q=k.evaluate.apply(void 0,O);if(B!==void 0&&q!==void 0)return L(B,q,v)}}:L(I,k,v)}function os(i,t,o){return t.type==="color"?o=j.parse(o):t.type==="formatted"?o=ge.fromString(o.toString()):t.type==="resolvedImage"?o=pe.fromString(o.toString()):Si(o)===t.type||t.type==="enum"&&t.values[o]||(o=void 0),sr(o,i.default,t.default)}Mt.register(Do,{error:[{kind:"error"},[zi],(i,[t])=>{throw new He(t.evaluate(i))}],typeof:[zi,[yi],(i,[t])=>te(Se(t.evaluate(i)))],"to-rgba":[J(kt,4),[Kr],(i,[t])=>t.evaluate(i).toArray()],rgb:[Kr,[kt,kt,kt],Fa],rgba:[Kr,[kt,kt,kt,kt],Fa],has:{type:Ei,overloads:[[[zi],(i,[t])=>ga(t.evaluate(i),i.properties())],[[zi,fn],(i,[t,o])=>ga(t.evaluate(i),o.evaluate(i))]]},get:{type:yi,overloads:[[[zi],(i,[t])=>Ml(t.evaluate(i),i.properties())],[[zi,fn],(i,[t,o])=>Ml(t.evaluate(i),o.evaluate(i))]]},"feature-state":[yi,[zi],(i,[t])=>Ml(t.evaluate(i),i.featureState||{})],properties:[fn,[],i=>i.properties()],"geometry-type":[zi,[],i=>i.geometryType()],id:[yi,[],i=>i.id()],zoom:[kt,[],i=>i.globals.zoom],"heatmap-density":[kt,[],i=>i.globals.heatmapDensity||0],"line-progress":[kt,[],i=>i.globals.lineProgress||0],accumulated:[yi,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[kt,Ua(kt),(i,t)=>{let o=0;for(const l of t)o+=l.evaluate(i);return o}],"*":[kt,Ua(kt),(i,t)=>{let o=1;for(const l of t)o*=l.evaluate(i);return o}],"-":{type:kt,overloads:[[[kt,kt],(i,[t,o])=>t.evaluate(i)-o.evaluate(i)],[[kt],(i,[t])=>-t.evaluate(i)]]},"/":[kt,[kt,kt],(i,[t,o])=>t.evaluate(i)/o.evaluate(i)],"%":[kt,[kt,kt],(i,[t,o])=>t.evaluate(i)%o.evaluate(i)],ln2:[kt,[],()=>Math.LN2],pi:[kt,[],()=>Math.PI],e:[kt,[],()=>Math.E],"^":[kt,[kt,kt],(i,[t,o])=>Math.pow(t.evaluate(i),o.evaluate(i))],sqrt:[kt,[kt],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[kt,[kt],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[kt,[kt],(i,[t])=>Math.log(t.evaluate(i))],log2:[kt,[kt],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[kt,[kt],(i,[t])=>Math.sin(t.evaluate(i))],cos:[kt,[kt],(i,[t])=>Math.cos(t.evaluate(i))],tan:[kt,[kt],(i,[t])=>Math.tan(t.evaluate(i))],asin:[kt,[kt],(i,[t])=>Math.asin(t.evaluate(i))],acos:[kt,[kt],(i,[t])=>Math.acos(t.evaluate(i))],atan:[kt,[kt],(i,[t])=>Math.atan(t.evaluate(i))],min:[kt,Ua(kt),(i,t)=>Math.min(...t.map(o=>o.evaluate(i)))],max:[kt,Ua(kt),(i,t)=>Math.max(...t.map(o=>o.evaluate(i)))],abs:[kt,[kt],(i,[t])=>Math.abs(t.evaluate(i))],round:[kt,[kt],(i,[t])=>{const o=t.evaluate(i);return o<0?-Math.round(-o):Math.round(o)}],floor:[kt,[kt],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[kt,[kt],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[Ei,[zi,yi],(i,[t,o])=>i.properties()[t.value]===o.value],"filter-id-==":[Ei,[yi],(i,[t])=>i.id()===t.value],"filter-type-==":[Ei,[zi],(i,[t])=>i.geometryType()===t.value],"filter-<":[Ei,[zi,yi],(i,[t,o])=>{const l=i.properties()[t.value],p=o.value;return typeof l==typeof p&&l<p}],"filter-id-<":[Ei,[yi],(i,[t])=>{const o=i.id(),l=t.value;return typeof o==typeof l&&o<l}],"filter->":[Ei,[zi,yi],(i,[t,o])=>{const l=i.properties()[t.value],p=o.value;return typeof l==typeof p&&l>p}],"filter-id->":[Ei,[yi],(i,[t])=>{const o=i.id(),l=t.value;return typeof o==typeof l&&o>l}],"filter-<=":[Ei,[zi,yi],(i,[t,o])=>{const l=i.properties()[t.value],p=o.value;return typeof l==typeof p&&l<=p}],"filter-id-<=":[Ei,[yi],(i,[t])=>{const o=i.id(),l=t.value;return typeof o==typeof l&&o<=l}],"filter->=":[Ei,[zi,yi],(i,[t,o])=>{const l=i.properties()[t.value],p=o.value;return typeof l==typeof p&&l>=p}],"filter-id->=":[Ei,[yi],(i,[t])=>{const o=i.id(),l=t.value;return typeof o==typeof l&&o>=l}],"filter-has":[Ei,[yi],(i,[t])=>t.value in i.properties()],"filter-has-id":[Ei,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Ei,[J(zi)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[Ei,[J(yi)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[Ei,[zi,J(yi)],(i,[t,o])=>o.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[Ei,[zi,J(yi)],(i,[t,o])=>function(l,p,y,v){for(;y<=v;){const I=y+v>>1;if(p[I]===l)return!0;p[I]>l?v=I-1:y=I+1}return!1}(i.properties()[t.value],o.value,0,o.value.length-1)],all:{type:Ei,overloads:[[[Ei,Ei],(i,[t,o])=>t.evaluate(i)&&o.evaluate(i)],[Ua(Ei),(i,t)=>{for(const o of t)if(!o.evaluate(i))return!1;return!0}]]},any:{type:Ei,overloads:[[[Ei,Ei],(i,[t,o])=>t.evaluate(i)||o.evaluate(i)],[Ua(Ei),(i,t)=>{for(const o of t)if(o.evaluate(i))return!0;return!1}]]},"!":[Ei,[Ei],(i,[t])=>!t.evaluate(i)],"is-supported-script":[Ei,[zi],(i,[t])=>{const o=i.globals&&i.globals.isSupportedScript;return!o||o(t.evaluate(i))}],upcase:[zi,[zi],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[zi,[zi],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[zi,Ua(yi),(i,t)=>t.map(o=>$e(o.evaluate(i))).join("")],"resolved-locale":[zi,[Mo],(i,[t])=>t.evaluate(i).resolvedLocale()]});class Dl{constructor(t,o){this.expression=t,this._warningHistory={},this._evaluator=new $t,this._defaultValue=o?function(l){return l.type==="color"&&Ys(l.default)?new j(0,0,0,0):l.type==="color"?j.parse(l.default)||null:l.default===void 0?null:l.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null}evaluateWithoutErrorHandling(t,o,l,p,y,v){return this._evaluator.globals=t,this._evaluator.feature=o,this._evaluator.featureState=l,this._evaluator.canonical=p,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=v,this.expression.evaluate(this._evaluator)}evaluate(t,o,l,p,y,v){this._evaluator.globals=t,this._evaluator.feature=o||null,this._evaluator.featureState=l||null,this._evaluator.canonical=p,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=v||null;try{const I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new He(`Expected value to be one of ${Object.keys(this._enumValues).map(k=>JSON.stringify(k)).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console!="undefined"&&console.warn(I.message)),this._defaultValue}}}function na(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Do}function oa(i,t){const o=new Qo(Do,[],t?function(p){const y={color:Kr,string:zi,number:kt,enum:zi,boolean:Ei,formatted:Wn,resolvedImage:ar};return p.type==="array"?J(y[p.value]||yi,p.length):y[p.type]}(t):void 0),l=o.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?ir(new Dl(l,t)):ns(o.errors)}class tl{constructor(t,o){this.kind=t,this._styleExpression=o,this.isStateDependent=t!=="constant"&&!Br(o.expression)}evaluateWithoutErrorHandling(t,o,l,p,y,v){return this._styleExpression.evaluateWithoutErrorHandling(t,o,l,p,y,v)}evaluate(t,o,l,p,y,v){return this._styleExpression.evaluate(t,o,l,p,y,v)}}class Va{constructor(t,o,l,p){this.kind=t,this.zoomStops=l,this._styleExpression=o,this.isStateDependent=t!=="camera"&&!Br(o.expression),this.interpolationType=p}evaluateWithoutErrorHandling(t,o,l,p,y,v){return this._styleExpression.evaluateWithoutErrorHandling(t,o,l,p,y,v)}evaluate(t,o,l,p,y,v){return this._styleExpression.evaluate(t,o,l,p,y,v)}interpolationFactor(t,o,l){return this.interpolationType?In.interpolationFactor(this.interpolationType,t,o,l):0}}function lr(i,t){const o=oa(i,t);if(o.result==="error")return o;const l=o.value.expression,p=Lo(l);if(!p&&!ya(t))return ns([new dn("","data expressions not supported")]);const y=oo(l,["zoom"]);if(!y&&!_u(t))return ns([new dn("","zoom expressions not supported")]);const v=Rl(l);return v||y?v instanceof dn?ns([v]):v instanceof In&&!Ll(t)?ns([new dn("",'"interpolate" expressions cannot be used with this property')]):ir(v?new Va(p?"camera":"composite",o.value,v.labels,v instanceof In?v.interpolation:void 0):new tl(p?"constant":"source",o.value)):ns([new dn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class _a{constructor(t,o){this._parameters=t,this._specification=o,no(this,No(this._parameters,this._specification))}static deserialize(t){return new _a(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Rl(i){let t=null;if(i instanceof Pl)t=Rl(i.result);else if(i instanceof zl){for(const o of i.args)if(t=Rl(o),t)break}else(i instanceof is||i instanceof In)&&i.input instanceof Mt&&i.input.name==="zoom"&&(t=i);return t instanceof dn||i.eachChild(o=>{const l=Rl(o);l instanceof dn?t=l:!t&&l?t=new dn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&l&&t!==l&&(t=new dn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Nn(i){const t=i.key,o=i.value,l=i.valueSpec||{},p=i.objectElementValidators||{},y=i.style,v=i.styleSpec;let I=[];const k=Si(o);if(k!=="object")return[new Rt(t,o,`object expected, ${k} found`)];for(const L in o){const O=L.split(".")[0],B=l[O]||l["*"];let q;if(p[O])q=p[O];else if(l[O])q=qn;else if(p["*"])q=p["*"];else{if(!l["*"]){I.push(new Rt(t,o[L],`unknown property "${L}"`));continue}q=qn}I=I.concat(q({key:(t&&`${t}.`)+L,value:o[L],valueSpec:B,style:y,styleSpec:v,object:o,objectKey:L},o))}for(const L in l)p[L]||l[L].required&&l[L].default===void 0&&o[L]===void 0&&I.push(new Rt(t,o,`missing required property "${L}"`));return I}function vu(i){const t=i.value,o=i.valueSpec,l=i.style,p=i.styleSpec,y=i.key,v=i.arrayElementValidator||qn;if(Si(t)!=="array")return[new Rt(y,t,`array expected, ${Si(t)} found`)];if(o.length&&t.length!==o.length)return[new Rt(y,t,`array length ${o.length} expected, length ${t.length} found`)];if(o["min-length"]&&t.length<o["min-length"])return[new Rt(y,t,`array length at least ${o["min-length"]} expected, length ${t.length} found`)];let I={type:o.value,values:o.values};p.$version<7&&(I.function=o.function),Si(o.value)==="object"&&(I=o.value);let k=[];for(let L=0;L<t.length;L++)k=k.concat(v({array:t,arrayIndex:L,value:t[L],valueSpec:I,style:l,styleSpec:p,key:`${y}[${L}]`}));return k}function Ku(i){const t=i.key,o=i.value,l=i.valueSpec;let p=Si(o);return p==="number"&&o!=o&&(p="NaN"),p!=="number"?[new Rt(t,o,`number expected, ${p} found`)]:"minimum"in l&&o<l.minimum?[new Rt(t,o,`${o} is less than the minimum value ${l.minimum}`)]:"maximum"in l&&o>l.maximum?[new Rt(t,o,`${o} is greater than the maximum value ${l.maximum}`)]:[]}function xu(i){const t=i.valueSpec,o=or(i.value.type);let l,p,y,v={};const I=o!=="categorical"&&i.value.property===void 0,k=!I,L=Si(i.value.stops)==="array"&&Si(i.value.stops[0])==="array"&&Si(i.value.stops[0][0])==="object",O=Nn({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function($){if(o==="identity")return[new Rt($.key,$.value,'identity function may not have a "stops" property')];let W=[];const ne=$.value;return W=W.concat(vu({key:$.key,value:ne,valueSpec:$.valueSpec,style:$.style,styleSpec:$.styleSpec,arrayElementValidator:B})),Si(ne)==="array"&&ne.length===0&&W.push(new Rt($.key,ne,"array must have at least one stop")),W},default:function($){return qn({key:$.key,value:$.value,valueSpec:t,style:$.style,styleSpec:$.styleSpec})}}});return o==="identity"&&I&&O.push(new Rt(i.key,i.value,'missing required property "property"')),o==="identity"||i.value.stops||O.push(new Rt(i.key,i.value,'missing required property "stops"')),o==="exponential"&&i.valueSpec.expression&&!Ll(i.valueSpec)&&O.push(new Rt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(k&&!ya(i.valueSpec)?O.push(new Rt(i.key,i.value,"property functions not supported")):I&&!_u(i.valueSpec)&&O.push(new Rt(i.key,i.value,"zoom functions not supported"))),o!=="categorical"&&!L||i.value.property!==void 0||O.push(new Rt(i.key,i.value,'"property" property is required')),O;function B($){let W=[];const ne=$.value,ue=$.key;if(Si(ne)!=="array")return[new Rt(ue,ne,`array expected, ${Si(ne)} found`)];if(ne.length!==2)return[new Rt(ue,ne,`array length 2 expected, length ${ne.length} found`)];if(L){if(Si(ne[0])!=="object")return[new Rt(ue,ne,`object expected, ${Si(ne[0])} found`)];if(ne[0].zoom===void 0)return[new Rt(ue,ne,"object stop key must have zoom")];if(ne[0].value===void 0)return[new Rt(ue,ne,"object stop key must have value")];if(y&&y>or(ne[0].zoom))return[new Rt(ue,ne[0].zoom,"stop zoom values must appear in ascending order")];or(ne[0].zoom)!==y&&(y=or(ne[0].zoom),p=void 0,v={}),W=W.concat(Nn({key:`${ue}[0]`,value:ne[0],valueSpec:{zoom:{}},style:$.style,styleSpec:$.styleSpec,objectElementValidators:{zoom:Ku,value:q}}))}else W=W.concat(q({key:`${ue}[0]`,value:ne[0],valueSpec:{},style:$.style,styleSpec:$.styleSpec},ne));return na(Mn(ne[1]))?W.concat([new Rt(`${ue}[1]`,ne[1],"expressions are not allowed in function stops.")]):W.concat(qn({key:`${ue}[1]`,value:ne[1],valueSpec:t,style:$.style,styleSpec:$.styleSpec}))}function q($,W){const ne=Si($.value),ue=or($.value),Ie=$.value!==null?$.value:W;if(l){if(ne!==l)return[new Rt($.key,Ie,`${ne} stop domain type must match previous stop domain type ${l}`)]}else l=ne;if(ne!=="number"&&ne!=="string"&&ne!=="boolean")return[new Rt($.key,Ie,"stop domain value must be a number, string, or boolean")];if(ne!=="number"&&o!=="categorical"){let De=`number expected, ${ne} found`;return ya(t)&&o===void 0&&(De+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Rt($.key,Ie,De)]}return o!=="categorical"||ne!=="number"||isFinite(ue)&&Math.floor(ue)===ue?o!=="categorical"&&ne==="number"&&p!==void 0&&ue<p?[new Rt($.key,Ie,"stop domain values must appear in ascending order")]:(p=ue,o==="categorical"&&ue in v?[new Rt($.key,Ie,"stop domain values must be unique")]:(v[ue]=!0,[])):[new Rt($.key,Ie,`integer expected, found ${ue}`)]}}function va(i){const t=(i.expressionContext==="property"?lr:oa)(Mn(i.value),i.valueSpec);if(t.result==="error")return t.value.map(l=>new Rt(`${i.key}${l.key}`,i.value,l.message));const o=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!o.outputDefined())return[new Rt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Br(o))return[new Rt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Br(o))return[new Rt(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!oo(o,["zoom","feature-state"]))return[new Rt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Lo(o))return[new Rt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function xa(i){const t=i.key,o=i.value,l=i.valueSpec,p=[];return Array.isArray(l.values)?l.values.indexOf(or(o))===-1&&p.push(new Rt(t,o,`expected one of [${l.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(l.values).indexOf(or(o))===-1&&p.push(new Rt(t,o,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(o)} found`)),p}function as(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!as(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const il={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Na(i){if(i==null)return{filter:()=>!0,needGeometry:!1};as(i)||(i=aa(i));const t=oa(i,il);if(t.result==="error")throw new Error(t.value.map(o=>`${o.key}: ${o.message}`).join(", "));return{filter:(o,l,p)=>t.value.evaluate(o,l,{},p),needGeometry:bu(i)}}function ba(i,t){return i<t?-1:i>t?1:0}function bu(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let t=1;t<i.length;t++)if(bu(i[t]))return!0;return!1}function aa(i){if(!i)return!0;const t=i[0];return i.length<=1?t!=="any":t==="=="?So(i[1],i[2],"=="):t==="!="?ss(So(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?So(i[1],i[2],t):t==="any"?(o=i.slice(1),["any"].concat(o.map(aa))):t==="all"?["all"].concat(i.slice(1).map(aa)):t==="none"?["all"].concat(i.slice(1).map(aa).map(ss)):t==="in"?rl(i[1],i.slice(2)):t==="!in"?ss(rl(i[1],i.slice(2))):t==="has"?nl(i[1]):t==="!has"?ss(nl(i[1])):t!=="within"||i;var o}function So(i,t,o){switch(i){case"$type":return[`filter-type-${o}`,t];case"$id":return[`filter-id-${o}`,t];default:return[`filter-${o}`,i,t]}}function rl(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(o=>typeof o!=typeof t[0])?["filter-in-large",i,["literal",t.sort(ba)]]:["filter-in-small",i,["literal",t]]}}function nl(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function ss(i){return["!",i]}function jo(i){return as(Mn(i.value))?va(no({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Cs(i)}function Cs(i){const t=i.value,o=i.key;if(Si(t)!=="array")return[new Rt(o,t,`array expected, ${Si(t)} found`)];const l=i.styleSpec;let p,y=[];if(t.length<1)return[new Rt(o,t,"filter array must have at least 1 element")];switch(y=y.concat(xa({key:`${o}[0]`,value:t[0],valueSpec:l.filter_operator,style:i.style,styleSpec:i.styleSpec})),or(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&or(t[1])==="$type"&&y.push(new Rt(o,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&y.push(new Rt(o,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(p=Si(t[1]),p!=="string"&&y.push(new Rt(`${o}[1]`,t[1],`string expected, ${p} found`)));for(let v=2;v<t.length;v++)p=Si(t[v]),or(t[1])==="$type"?y=y.concat(xa({key:`${o}[${v}]`,value:t[v],valueSpec:l.geometry_type,style:i.style,styleSpec:i.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&y.push(new Rt(`${o}[${v}]`,t[v],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let v=1;v<t.length;v++)y=y.concat(Cs({key:`${o}[${v}]`,value:t[v],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":p=Si(t[1]),t.length!==2?y.push(new Rt(o,t,`filter array for "${t[0]}" operator must have 2 elements`)):p!=="string"&&y.push(new Rt(`${o}[1]`,t[1],`string expected, ${p} found`));break;case"within":p=Si(t[1]),t.length!==2?y.push(new Rt(o,t,`filter array for "${t[0]}" operator must have 2 elements`)):p!=="object"&&y.push(new Rt(`${o}[1]`,t[1],`object expected, ${p} found`))}return y}function ja(i,t){const o=i.key,l=i.style,p=i.styleSpec,y=i.value,v=i.objectKey,I=p[`${t}_${i.layerType}`];if(!I)return[];const k=v.match(/^(.*)-transition$/);if(t==="paint"&&k&&I[k[1]]&&I[k[1]].transition)return qn({key:o,value:y,valueSpec:p.transition,style:l,styleSpec:p});const L=i.valueSpec||I[v];if(!L)return[new Rt(o,y,`unknown property "${v}"`)];let O;if(Si(y)==="string"&&ya(L)&&!L.tokens&&(O=/^{([^}]+)}$/.exec(y)))return[new Rt(o,y,`"${v}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(O[1])} }\`.`)];const B=[];return i.layerType==="symbol"&&(v==="text-field"&&l&&!l.glyphs&&B.push(new Rt(o,y,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&Ys(Mn(y))&&or(y.type)==="identity"&&B.push(new Rt(o,y,'"text-font" does not support identity functions'))),B.concat(qn({key:i.key,value:y,valueSpec:L,style:l,styleSpec:p,expressionContext:"property",propertyType:t,propertyKey:v}))}function Bl(i){return ja(i,"paint")}function ol(i){return ja(i,"layout")}function Ju(i){let t=[];const o=i.value,l=i.key,p=i.style,y=i.styleSpec;o.type||o.ref||t.push(new Rt(l,o,'either "type" or "ref" is required'));let v=or(o.type);const I=or(o.ref);if(o.id){const k=or(o.id);for(let L=0;L<i.arrayIndex;L++){const O=p.layers[L];or(O.id)===k&&t.push(new Rt(l,o.id,`duplicate layer id "${o.id}", previously used at line ${O.id.__line__}`))}}if("ref"in o){let k;["type","source","source-layer","filter","layout"].forEach(L=>{L in o&&t.push(new Rt(l,o[L],`"${L}" is prohibited for ref layers`))}),p.layers.forEach(L=>{or(L.id)===I&&(k=L)}),k?k.ref?t.push(new Rt(l,o.ref,"ref cannot reference another ref layer")):v=or(k.type):t.push(new Rt(l,o.ref,`ref layer "${I}" not found`))}else if(v!=="background")if(o.source){const k=p.sources&&p.sources[o.source],L=k&&or(k.type);k?L==="vector"&&v==="raster"?t.push(new Rt(l,o.source,`layer "${o.id}" requires a raster source`)):L==="raster"&&v!=="raster"?t.push(new Rt(l,o.source,`layer "${o.id}" requires a vector source`)):L!=="vector"||o["source-layer"]?L==="raster-dem"&&v!=="hillshade"?t.push(new Rt(l,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):v!=="line"||!o.paint||!o.paint["line-gradient"]||L==="geojson"&&k.lineMetrics||t.push(new Rt(l,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Rt(l,o,`layer "${o.id}" must specify a "source-layer"`)):t.push(new Rt(l,o.source,`source "${o.source}" not found`))}else t.push(new Rt(l,o,'missing required property "source"'));return t=t.concat(Nn({key:l,value:o,valueSpec:y.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>qn({key:`${l}.type`,value:o.type,valueSpec:y.layer.type,style:i.style,styleSpec:i.styleSpec,object:o,objectKey:"type"}),filter:jo,layout:k=>Nn({layer:o,key:k.key,value:k.value,style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":L=>ol(no({layerType:v},L))}}),paint:k=>Nn({layer:o,key:k.key,value:k.value,style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":L=>Bl(no({layerType:v},L))}})}})),t}function wa(i){const t=i.value,o=i.key,l=Si(t);return l!=="string"?[new Rt(o,t,`string expected, ${l} found`)]:[]}const Ol={promoteId:function({key:i,value:t}){if(Si(t)==="string")return wa({key:i,value:t});{const o=[];for(const l in t)o.push(...wa({key:`${i}.${l}`,value:t[l]}));return o}}};function zs(i){const t=i.value,o=i.key,l=i.styleSpec,p=i.style;if(!t.type)return[new Rt(o,t,'"type" is required')];const y=or(t.type);let v;switch(y){case"vector":case"raster":case"raster-dem":return v=Nn({key:o,value:t,valueSpec:l[`source_${y.replace("-","_")}`],style:i.style,styleSpec:l,objectElementValidators:Ol}),v;case"geojson":if(v=Nn({key:o,value:t,valueSpec:l.source_geojson,style:p,styleSpec:l,objectElementValidators:Ol}),t.cluster)for(const I in t.clusterProperties){const[k,L]=t.clusterProperties[I],O=typeof k=="string"?[k,["accumulated"],["get",I]]:k;v.push(...va({key:`${o}.${I}.map`,value:L,expressionContext:"cluster-map"})),v.push(...va({key:`${o}.${I}.reduce`,value:O,expressionContext:"cluster-reduce"}))}return v;case"video":return Nn({key:o,value:t,valueSpec:l.source_video,style:p,styleSpec:l});case"image":return Nn({key:o,value:t,valueSpec:l.source_image,style:p,styleSpec:l});case"canvas":return[new Rt(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return xa({key:`${o}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:p,styleSpec:l})}}function Ps(i){const t=i.value,o=i.styleSpec,l=o.light,p=i.style;let y=[];const v=Si(t);if(t===void 0)return y;if(v!=="object")return y=y.concat([new Rt("light",t,`object expected, ${v} found`)]),y;for(const I in t){const k=I.match(/^(.*)-transition$/);y=y.concat(k&&l[k[1]]&&l[k[1]].transition?qn({key:I,value:t[I],valueSpec:o.transition,style:p,styleSpec:o}):l[I]?qn({key:I,value:t[I],valueSpec:l[I],style:p,styleSpec:o}):[new Rt(I,t[I],`unknown property "${I}"`)])}return y}const jn={"*":()=>[],array:vu,boolean:function(i){const t=i.value,o=i.key,l=Si(t);return l!=="boolean"?[new Rt(o,t,`boolean expected, ${l} found`)]:[]},number:Ku,color:function(i){const t=i.key,o=i.value,l=Si(o);return l!=="string"?[new Rt(t,o,`color expected, ${l} found`)]:Oe(o)===null?[new Rt(t,o,`color expected, "${o}" found`)]:[]},constants:Vo,enum:xa,filter:jo,function:xu,layer:Ju,object:Nn,source:zs,light:Ps,string:wa,formatted:function(i){return wa(i).length===0?[]:va(i)},resolvedImage:function(i){return wa(i).length===0?[]:va(i)}};function qn(i){const t=i.value,o=i.valueSpec,l=i.styleSpec;return o.expression&&Ys(or(t))?xu(i):o.expression&&na(Mn(t))?va(i):o.type&&jn[o.type]?jn[o.type](i):Nn(no({},i,{valueSpec:o.type?l[o.type]:o}))}function wu(i){const t=i.value,o=i.key,l=wa(i);return l.length||(t.indexOf("{fontstack}")===-1&&l.push(new Rt(o,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&l.push(new Rt(o,t,'"glyphs" url must include a "{range}" token'))),l}function Ea(i,t=st){let o=[];return o=o.concat(qn({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,objectElementValidators:{glyphs:wu,"*":()=>[]}})),i.constants&&(o=o.concat(Vo({key:"constants",value:i.constants,style:i,styleSpec:t}))),ks(o)}function ks(i){return[].concat(i).sort((t,o)=>t.line-o.line)}function ls(i){return function(...t){return ks(i.apply(this,t))}}Ea.source=ls(zs),Ea.light=ls(Ps),Ea.layer=ls(Ju),Ea.filter=ls(jo),Ea.paintProperty=ls(Bl),Ea.layoutProperty=ls(ol);const To=Ea,_r=To.light,Ms=To.paintProperty,us=To.layoutProperty;function Sa(i,t){let o=!1;if(t&&t.length)for(const l of t)i.fire(new kn(new Error(l.message))),o=!0;return o}class Ii{constructor(t,o,l){const p=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const v=new Int32Array(this.arrayBuffer);t=v[0],this.d=(o=v[1])+2*(l=v[2]);for(let k=0;k<this.d*this.d;k++){const L=v[3+k],O=v[3+k+1];p.push(L===O?null:v.subarray(L,O))}const I=v[3+p.length+1];this.keys=v.subarray(v[3+p.length],I),this.bboxes=v.subarray(I),this.insert=this._insertReadonly}else{this.d=o+2*l;for(let v=0;v<this.d*this.d;v++)p.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=t,this.padding=l,this.scale=o/t,this.uid=0;const y=l/o*t;this.min=-y,this.max=t+y}insert(t,o,l,p,y){this._forEachCell(o,l,p,y,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(o),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(y)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,o,l,p,y,v){this.cells[y].push(v)}query(t,o,l,p,y){const v=this.min,I=this.max;if(t<=v&&o<=v&&I<=l&&I<=p&&!y)return Array.prototype.slice.call(this.keys);{const k=[];return this._forEachCell(t,o,l,p,this._queryCell,k,{},y),k}}_queryCell(t,o,l,p,y,v,I,k){const L=this.cells[y];if(L!==null){const O=this.keys,B=this.bboxes;for(let q=0;q<L.length;q++){const $=L[q];if(I[$]===void 0){const W=4*$;(k?k(B[W+0],B[W+1],B[W+2],B[W+3]):t<=B[W+2]&&o<=B[W+3]&&l>=B[W+0]&&p>=B[W+1])?(I[$]=!0,v.push(O[$])):I[$]=!1}}}}_forEachCell(t,o,l,p,y,v,I,k){const L=this._convertToCellCoord(t),O=this._convertToCellCoord(o),B=this._convertToCellCoord(l),q=this._convertToCellCoord(p);for(let $=L;$<=B;$++)for(let W=O;W<=q;W++){const ne=this.d*W+$;if((!k||k(this._convertFromCellCoord($),this._convertFromCellCoord(W),this._convertFromCellCoord($+1),this._convertFromCellCoord(W+1)))&&y.call(this,t,o,l,p,ne,v,I,k))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,o=3+this.cells.length+1+1;let l=0;for(let v=0;v<this.cells.length;v++)l+=this.cells[v].length;const p=new Int32Array(o+l+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;let y=o;for(let v=0;v<t.length;v++){const I=t[v];p[3+v]=y,p.set(I,y),y+=I.length}return p[3+t.length]=y,p.set(this.keys,y),y+=this.keys.length,p[3+t.length+1]=y,p.set(this.bboxes,y),y+=this.bboxes.length,p.buffer}static serialize(t,o){const l=t.toArrayBuffer();return o&&o.push(l),{buffer:l}}static deserialize(t){return new Ii(t.buffer)}}const Ji={};function Lt(i,t,o={}){Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),Ji[i]={klass:t,omit:o.omit||[],shallow:o.shallow||[]}}Lt("Object",Object),Lt("TransferableGridIndex",Ii),Lt("Color",j),Lt("Error",Error),Lt("AJAXError",ci),Lt("ResolvedImage",pe),Lt("StylePropertyFunction",_a),Lt("StyleExpression",Dl,{omit:["_evaluator"]}),Lt("ZoomDependentExpression",Va),Lt("ZoomConstantExpression",tl),Lt("CompoundExpression",Mt,{omit:["_evaluate"]});for(const i in Do)Do[i]._classRegistryKey||Lt(`Expression_${i}`,Do[i]);function cs(i){return i&&typeof ArrayBuffer!="undefined"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function sa(i,t){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(cs(i)||hr(i))return t&&t.push(i),i;if(ArrayBuffer.isView(i)){const o=i;return t&&t.push(o.buffer),o}if(i instanceof ImageData)return t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const o=[];for(const l of i)o.push(sa(l,t));return o}if(typeof i=="object"){const o=i.constructor,l=o._classRegistryKey;if(!l)throw new Error("can't serialize object of unregistered class");const p=o.serialize?o.serialize(i,t):{};if(!o.serialize){for(const y in i){if(!i.hasOwnProperty(y)||Ji[l].omit.indexOf(y)>=0)continue;const v=i[y];p[y]=Ji[l].shallow.indexOf(y)>=0?v:sa(v,t)}i instanceof Error&&(p.message=i.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(p.$name=l),p}throw new Error("can't serialize object of type "+typeof i)}function qo(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||cs(i)||hr(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(qo);if(typeof i=="object"){const t=i.$name||"Object";if(!Ji[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:o}=Ji[t];if(!o)throw new Error(`can't deserialize unregistered class ${t}`);if(o.deserialize)return o.deserialize(i);const l=Object.create(o.prototype);for(const p of Object.keys(i)){if(p==="$name")continue;const y=i[p];l[p]=Ji[t].shallow.indexOf(p)>=0?y:qo(y)}return l}throw new Error("can't deserialize object of type "+typeof i)}class al{constructor(){this.first=!0}update(t,o){const l=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=o),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=l,!0))}}const Vt={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function hs(i){for(const t of i)if(Er(t.charCodeAt(0)))return!0;return!1}function Ls(i){for(const t of i)if(!Ta(t.charCodeAt(0)))return!1;return!0}function Ta(i){return!(Vt.Arabic(i)||Vt["Arabic Supplement"](i)||Vt["Arabic Extended-A"](i)||Vt["Arabic Presentation Forms-A"](i)||Vt["Arabic Presentation Forms-B"](i))}function Er(i){return!(i!==746&&i!==747&&(i<4352||!(Vt["Bopomofo Extended"](i)||Vt.Bopomofo(i)||Vt["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Vt["CJK Compatibility Ideographs"](i)||Vt["CJK Compatibility"](i)||Vt["CJK Radicals Supplement"](i)||Vt["CJK Strokes"](i)||!(!Vt["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Vt["CJK Unified Ideographs Extension A"](i)||Vt["CJK Unified Ideographs"](i)||Vt["Enclosed CJK Letters and Months"](i)||Vt["Hangul Compatibility Jamo"](i)||Vt["Hangul Jamo Extended-A"](i)||Vt["Hangul Jamo Extended-B"](i)||Vt["Hangul Jamo"](i)||Vt["Hangul Syllables"](i)||Vt.Hiragana(i)||Vt["Ideographic Description Characters"](i)||Vt.Kanbun(i)||Vt["Kangxi Radicals"](i)||Vt["Katakana Phonetic Extensions"](i)||Vt.Katakana(i)&&i!==12540||!(!Vt["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Vt["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Vt["Unified Canadian Aboriginal Syllabics"](i)||Vt["Unified Canadian Aboriginal Syllabics Extended"](i)||Vt["Vertical Forms"](i)||Vt["Yijing Hexagram Symbols"](i)||Vt["Yi Syllables"](i)||Vt["Yi Radicals"](i))))}function Ds(i){return!(Er(i)||function(t){return!!(Vt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Vt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Vt["Letterlike Symbols"](t)||Vt["Number Forms"](t)||Vt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Vt["Control Pictures"](t)&&t!==9251||Vt["Optical Character Recognition"](t)||Vt["Enclosed Alphanumerics"](t)||Vt["Geometric Shapes"](t)||Vt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Vt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Vt["CJK Symbols and Punctuation"](t)||Vt.Katakana(t)||Vt["Private Use Area"](t)||Vt["CJK Compatibility Forms"](t)||Vt["Small Form Variants"](t)||Vt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}function Eu(i){return i>=1424&&i<=2303||Vt["Arabic Presentation Forms-A"](i)||Vt["Arabic Presentation Forms-B"](i)}function qr(i,t){return!(!t&&Eu(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Vt.Khmer(i))}function jt(i){for(const t of i)if(Eu(t.charCodeAt(0)))return!0;return!1}const Dn="deferred",Rs="loading",qa="loaded";let Ao=null,vr="unavailable",la=null;const Ct=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(vr="error"),Ao&&Ao(i)};function sl(){Aa.fire(new ro("pluginStateChange",{pluginStatus:vr,pluginURL:la}))}const Aa=new Ma,ll=function(){return vr},Jn=function(){if(vr!==Dn||!la)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");vr=Rs,sl(),la&&ko({url:la},i=>{i?Ct(i):(vr=qa,sl())})},Sr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>vr===qa||Sr.applyArabicShaping!=null,isLoading:()=>vr===Rs,setState(i){vr=i.pluginStatus,la=i.pluginURL},isParsed:()=>Sr.applyArabicShaping!=null&&Sr.processBidirectionalText!=null&&Sr.processStyledBidirectionalText!=null,getPluginURL:()=>la};class mr{constructor(t,o){this.zoom=t,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new al,this.transition={})}isSupportedScript(t){return function(o,l){for(const p of o)if(!qr(p.charCodeAt(0),l))return!1;return!0}(t,Sr.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,o=t-Math.floor(t),l=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*o}}}class ps{constructor(t,o){this.property=t,this.value=o,this.expression=function(l,p){if(Ys(l))return new _a(l,p);if(na(l)){const y=lr(l,p);if(y.result==="error")throw new Error(y.value.map(v=>`${v.key}: ${v.message}`).join(", "));return y.value}{let y=l;return typeof l=="string"&&p.type==="color"&&(y=j.parse(l)),{kind:"constant",evaluate:()=>y}}}(o===void 0?t.specification.default:o,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,o,l){return this.property.possiblyEvaluate(this,t,o,l)}}class Rn{constructor(t){this.property=t,this.value=new ps(t,void 0)}transitioned(t,o){return new Su(this.property,this.value,o,et({},t.transition,this.transition),t.now)}untransitioned(){return new Su(this.property,this.value,null,{},0)}}class Go{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return _t(this._values[t].value.value)}setValue(t,o){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Rn(this._values[t].property)),this._values[t].value=new ps(this._values[t].property,o===null?void 0:_t(o))}getTransition(t){return _t(this._values[t].transition)}setTransition(t,o){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Rn(this._values[t].property)),this._values[t].transition=_t(o)||void 0}serialize(){const t={};for(const o of Object.keys(this._values)){const l=this.getValue(o);l!==void 0&&(t[o]=l);const p=this.getTransition(o);p!==void 0&&(t[`${o}-transition`]=p)}return t}transitioned(t,o){const l=new Bs(this._properties);for(const p of Object.keys(this._values))l._values[p]=this._values[p].transitioned(t,o._values[p]);return l}untransitioned(){const t=new Bs(this._properties);for(const o of Object.keys(this._values))t._values[o]=this._values[o].untransitioned();return t}}class Su{constructor(t,o,l,p,y){this.property=t,this.value=o,this.begin=y+p.delay||0,this.end=this.begin+p.duration||0,t.specification.transition&&(p.delay||p.duration)&&(this.prior=l)}possiblyEvaluate(t,o,l){const p=t.now||0,y=this.value.possiblyEvaluate(t,o,l),v=this.prior;if(v){if(p>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(p<this.begin)return v.possiblyEvaluate(t,o,l);{const I=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(t,o,l),y,function(k){if(k<=0)return 0;if(k>=1)return 1;const L=k*k,O=L*k;return 4*(k<.5?O:3*(k-L)+O-.75)}(I))}}return y}}class Bs{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,o,l){const p=new so(this._properties);for(const y of Object.keys(this._values))p._values[y]=this._values[y].possiblyEvaluate(t,o,l);return p}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Tu{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return _t(this._values[t].value)}setValue(t,o){this._values[t]=new ps(this._values[t].property,o===null?void 0:_t(o))}serialize(){const t={};for(const o of Object.keys(this._values)){const l=this.getValue(o);l!==void 0&&(t[o]=l)}return t}possiblyEvaluate(t,o,l){const p=new so(this._properties);for(const y of Object.keys(this._values))p._values[y]=this._values[y].possiblyEvaluate(t,o,l);return p}}class Ro{constructor(t,o,l){this.property=t,this.value=o,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,o,l,p){return this.property.evaluate(this.value,this.parameters,t,o,l,p)}}class so{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Gt{constructor(t){this.specification=t}possiblyEvaluate(t,o){return t.expression.evaluate(o)}interpolate(t,o,l){const p=Ss[this.specification.type];return p?p(t,o,l):t}}class At{constructor(t,o){this.specification=t,this.overrides=o}possiblyEvaluate(t,o,l,p){return new Ro(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(o,null,{},l,p)}:t.expression,o)}interpolate(t,o,l){if(t.value.kind!=="constant"||o.value.kind!=="constant")return t;if(t.value.value===void 0||o.value.value===void 0)return new Ro(this,{kind:"constant",value:void 0},t.parameters);const p=Ss[this.specification.type];return p?new Ro(this,{kind:"constant",value:p(t.value.value,o.value.value,l)},t.parameters):t}evaluate(t,o,l,p,y,v){return t.kind==="constant"?t.value:t.evaluate(o,l,p,y,v)}}class lo extends At{possiblyEvaluate(t,o,l,p){if(t.value===void 0)return new Ro(this,{kind:"constant",value:void 0},o);if(t.expression.kind==="constant"){const y=t.expression.evaluate(o,null,{},l,p),v=t.property.specification.type==="resolvedImage"&&typeof y!="string"?y.name:y,I=this._calculate(v,v,v,o);return new Ro(this,{kind:"constant",value:I},o)}if(t.expression.kind==="camera"){const y=this._calculate(t.expression.evaluate({zoom:o.zoom-1}),t.expression.evaluate({zoom:o.zoom}),t.expression.evaluate({zoom:o.zoom+1}),o);return new Ro(this,{kind:"constant",value:y},o)}return new Ro(this,t.expression,o)}evaluate(t,o,l,p,y,v){if(t.kind==="source"){const I=t.evaluate(o,l,p,y,v);return this._calculate(I,I,I,o)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(o.zoom)-1},l,p),t.evaluate({zoom:Math.floor(o.zoom)},l,p),t.evaluate({zoom:Math.floor(o.zoom)+1},l,p),o):t.value}_calculate(t,o,l,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:o}:{from:l,to:o}}interpolate(t){return t}}class Gn{constructor(t){this.specification=t}possiblyEvaluate(t,o,l,p){if(t.value!==void 0){if(t.expression.kind==="constant"){const y=t.expression.evaluate(o,null,{},l,p);return this._calculate(y,y,y,o)}return this._calculate(t.expression.evaluate(new mr(Math.floor(o.zoom-1),o)),t.expression.evaluate(new mr(Math.floor(o.zoom),o)),t.expression.evaluate(new mr(Math.floor(o.zoom+1),o)),o)}}_calculate(t,o,l,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:o}:{from:l,to:o}}interpolate(t){return t}}class an{constructor(t){this.specification=t}possiblyEvaluate(t,o,l,p){return!!t.expression.evaluate(o,null,{},l,p)}interpolate(){return!1}}class Tr{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const o in t){const l=t[o];l.specification.overridable&&this.overridableProperties.push(o);const p=this.defaultPropertyValues[o]=new ps(l,void 0),y=this.defaultTransitionablePropertyValues[o]=new Rn(l);this.defaultTransitioningPropertyValues[o]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=p.possiblyEvaluate({})}}}Lt("DataDrivenProperty",At),Lt("DataConstantProperty",Gt),Lt("CrossFadedDataDrivenProperty",lo),Lt("CrossFadedProperty",Gn),Lt("ColorRampProperty",an);const uo="-transition";class Cr extends Ma{constructor(t,o){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=(t=t).metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),o.layout&&(this._unevaluatedLayout=new Tu(o.layout)),o.paint)){this._transitionablePaint=new Go(o.paint);for(const l in t.paint)this.setPaintProperty(l,t.paint[l],{validate:!1});for(const l in t.layout)this.setLayoutProperty(l,t.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new so(o.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,o,l={}){o!=null&&this._validate(us,`layers.${this.id}.layout.${t}`,t,o,l)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,o):this.visibility=o)}getPaintProperty(t){return t.endsWith(uo)?this._transitionablePaint.getTransition(t.slice(0,-uo.length)):this._transitionablePaint.getValue(t)}setPaintProperty(t,o,l={}){if(o!=null&&this._validate(Ms,`layers.${this.id}.paint.${t}`,t,o,l))return!1;if(t.endsWith(uo))return this._transitionablePaint.setTransition(t.slice(0,-uo.length),o||void 0),!1;{const p=this._transitionablePaint._values[t],y=p.property.specification["property-type"]==="cross-faded-data-driven",v=p.value.isDataDriven(),I=p.value;this._transitionablePaint.setValue(t,o),this._handleSpecialPaintPropertyUpdate(t);const k=this._transitionablePaint._values[t].value;return k.isDataDriven()||v||y||this._handleOverridablePaintPropertyUpdate(t,I,k)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,o,l){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,o){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,o)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Wt(t,(o,l)=>!(o===void 0||l==="layout"&&!Object.keys(o).length||l==="paint"&&!Object.keys(o).length))}_validate(t,o,l,p,y={}){return(!y||y.validate!==!1)&&Sa(this,t.call(To,{key:o,layerType:this.type,objectKey:l,value:p,styleSpec:st,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const o=this.paint.get(t);if(o instanceof Ro&&ya(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}}const Zn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ia{constructor(t,o){this._structArray=t,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Pt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,o){return t._trim(),o&&(t.isTransferred=!0,o.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const o=Object.create(this.prototype);return o.arrayBuffer=t.arrayBuffer,o.length=t.length,o.capacity=t.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function zt(i,t=1){let o=0,l=0;return{members:i.map(p=>{const y=Zn[p.type].BYTES_PER_ELEMENT,v=o=ul(o,Math.max(t,y)),I=p.components||1;return l=Math.max(l,y),o+=y*I,{name:p.name,type:p.type,components:I,offset:v}}),size:ul(o,Math.max(l,t)),alignment:t}}function ul(i,t){return Math.ceil(i/t)*t}class Yr extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o){const l=this.length;return this.resize(l+1),this.emplace(l,t,o)}emplace(t,o,l){const p=2*t;return this.int16[p+0]=o,this.int16[p+1]=l,t}}Yr.prototype.bytesPerElement=4,Lt("StructArrayLayout2i4",Yr);class Yn extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,l,p){const y=this.length;return this.resize(y+1),this.emplace(y,t,o,l,p)}emplace(t,o,l,p,y){const v=4*t;return this.int16[v+0]=o,this.int16[v+1]=l,this.int16[v+2]=p,this.int16[v+3]=y,t}}Yn.prototype.bytesPerElement=8,Lt("StructArrayLayout4i8",Yn);class b extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,l,p,y,v){const I=this.length;return this.resize(I+1),this.emplace(I,t,o,l,p,y,v)}emplace(t,o,l,p,y,v,I){const k=6*t;return this.int16[k+0]=o,this.int16[k+1]=l,this.int16[k+2]=p,this.int16[k+3]=y,this.int16[k+4]=v,this.int16[k+5]=I,t}}b.prototype.bytesPerElement=12,Lt("StructArrayLayout2i4i12",b);class n extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,l,p,y,v){const I=this.length;return this.resize(I+1),this.emplace(I,t,o,l,p,y,v)}emplace(t,o,l,p,y,v,I){const k=4*t,L=8*t;return this.int16[k+0]=o,this.int16[k+1]=l,this.uint8[L+4]=p,this.uint8[L+5]=y,this.uint8[L+6]=v,this.uint8[L+7]=I,t}}n.prototype.bytesPerElement=8,Lt("StructArrayLayout2i4ub8",n);class h extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o){const l=this.length;return this.resize(l+1),this.emplace(l,t,o)}emplace(t,o,l){const p=2*t;return this.float32[p+0]=o,this.float32[p+1]=l,t}}h.prototype.bytesPerElement=8,Lt("StructArrayLayout2f8",h);class x extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,l,p,y,v,I,k,L,O){const B=this.length;return this.resize(B+1),this.emplace(B,t,o,l,p,y,v,I,k,L,O)}emplace(t,o,l,p,y,v,I,k,L,O,B){const q=10*t;return this.uint16[q+0]=o,this.uint16[q+1]=l,this.uint16[q+2]=p,this.uint16[q+3]=y,this.uint16[q+4]=v,this.uint16[q+5]=I,this.uint16[q+6]=k,this.uint16[q+7]=L,this.uint16[q+8]=O,this.uint16[q+9]=B,t}}x.prototype.bytesPerElement=20,Lt("StructArrayLayout10ui20",x);class E extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,l,p,y,v,I,k,L,O,B,q){const $=this.length;return this.resize($+1),this.emplace($,t,o,l,p,y,v,I,k,L,O,B,q)}emplace(t,o,l,p,y,v,I,k,L,O,B,q,$){const W=12*t;return this.int16[W+0]=o,this.int16[W+1]=l,this.int16[W+2]=p,this.int16[W+3]=y,this.uint16[W+4]=v,this.uint16[W+5]=I,this.uint16[W+6]=k,this.uint16[W+7]=L,this.int16[W+8]=O,this.int16[W+9]=B,this.int16[W+10]=q,this.int16[W+11]=$,t}}E.prototype.bytesPerElement=24,Lt("StructArrayLayout4i4ui4i24",E);class z extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,o,l)}emplace(t,o,l,p){const y=3*t;return this.float32[y+0]=o,this.float32[y+1]=l,this.float32[y+2]=p,t}}z.prototype.bytesPerElement=12,Lt("StructArrayLayout3f12",z);class R extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const o=this.length;return this.resize(o+1),this.emplace(o,t)}emplace(t,o){return this.uint32[1*t+0]=o,t}}R.prototype.bytesPerElement=4,Lt("StructArrayLayout1ul4",R);class V extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,l,p,y,v,I,k,L){const O=this.length;return this.resize(O+1),this.emplace(O,t,o,l,p,y,v,I,k,L)}emplace(t,o,l,p,y,v,I,k,L,O){const B=10*t,q=5*t;return this.int16[B+0]=o,this.int16[B+1]=l,this.int16[B+2]=p,this.int16[B+3]=y,this.int16[B+4]=v,this.int16[B+5]=I,this.uint32[q+3]=k,this.uint16[B+8]=L,this.uint16[B+9]=O,t}}V.prototype.bytesPerElement=20,Lt("StructArrayLayout6i1ul2ui20",V);class G extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,l,p,y,v){const I=this.length;return this.resize(I+1),this.emplace(I,t,o,l,p,y,v)}emplace(t,o,l,p,y,v,I){const k=6*t;return this.int16[k+0]=o,this.int16[k+1]=l,this.int16[k+2]=p,this.int16[k+3]=y,this.int16[k+4]=v,this.int16[k+5]=I,t}}G.prototype.bytesPerElement=12,Lt("StructArrayLayout2i2i2i12",G);class K extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,l,p,y){const v=this.length;return this.resize(v+1),this.emplace(v,t,o,l,p,y)}emplace(t,o,l,p,y,v){const I=4*t,k=8*t;return this.float32[I+0]=o,this.float32[I+1]=l,this.float32[I+2]=p,this.int16[k+6]=y,this.int16[k+7]=v,t}}K.prototype.bytesPerElement=16,Lt("StructArrayLayout2f1f2i16",K);class Q extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,l,p){const y=this.length;return this.resize(y+1),this.emplace(y,t,o,l,p)}emplace(t,o,l,p,y){const v=12*t,I=3*t;return this.uint8[v+0]=o,this.uint8[v+1]=l,this.float32[I+1]=p,this.float32[I+2]=y,t}}Q.prototype.bytesPerElement=12,Lt("StructArrayLayout2ub2f12",Q);class ae extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,o,l)}emplace(t,o,l,p){const y=3*t;return this.uint16[y+0]=o,this.uint16[y+1]=l,this.uint16[y+2]=p,t}}ae.prototype.bytesPerElement=6,Lt("StructArrayLayout3ui6",ae);class _e extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,l,p,y,v,I,k,L,O,B,q,$,W,ne,ue,Ie){const De=this.length;return this.resize(De+1),this.emplace(De,t,o,l,p,y,v,I,k,L,O,B,q,$,W,ne,ue,Ie)}emplace(t,o,l,p,y,v,I,k,L,O,B,q,$,W,ne,ue,Ie,De){const Fe=24*t,Ue=12*t,We=48*t;return this.int16[Fe+0]=o,this.int16[Fe+1]=l,this.uint16[Fe+2]=p,this.uint16[Fe+3]=y,this.uint32[Ue+2]=v,this.uint32[Ue+3]=I,this.uint32[Ue+4]=k,this.uint16[Fe+10]=L,this.uint16[Fe+11]=O,this.uint16[Fe+12]=B,this.float32[Ue+7]=q,this.float32[Ue+8]=$,this.uint8[We+36]=W,this.uint8[We+37]=ne,this.uint8[We+38]=ue,this.uint32[Ue+10]=Ie,this.int16[Fe+22]=De,t}}_e.prototype.bytesPerElement=48,Lt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",_e);class Le extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,l,p,y,v,I,k,L,O,B,q,$,W,ne,ue,Ie,De,Fe,Ue,We,Ve,mt,dt,tt,pt,at,gt){const nt=this.length;return this.resize(nt+1),this.emplace(nt,t,o,l,p,y,v,I,k,L,O,B,q,$,W,ne,ue,Ie,De,Fe,Ue,We,Ve,mt,dt,tt,pt,at,gt)}emplace(t,o,l,p,y,v,I,k,L,O,B,q,$,W,ne,ue,Ie,De,Fe,Ue,We,Ve,mt,dt,tt,pt,at,gt,nt){const lt=34*t,Ft=17*t;return this.int16[lt+0]=o,this.int16[lt+1]=l,this.int16[lt+2]=p,this.int16[lt+3]=y,this.int16[lt+4]=v,this.int16[lt+5]=I,this.int16[lt+6]=k,this.int16[lt+7]=L,this.uint16[lt+8]=O,this.uint16[lt+9]=B,this.uint16[lt+10]=q,this.uint16[lt+11]=$,this.uint16[lt+12]=W,this.uint16[lt+13]=ne,this.uint16[lt+14]=ue,this.uint16[lt+15]=Ie,this.uint16[lt+16]=De,this.uint16[lt+17]=Fe,this.uint16[lt+18]=Ue,this.uint16[lt+19]=We,this.uint16[lt+20]=Ve,this.uint16[lt+21]=mt,this.uint16[lt+22]=dt,this.uint32[Ft+12]=tt,this.float32[Ft+13]=pt,this.float32[Ft+14]=at,this.float32[Ft+15]=gt,this.float32[Ft+16]=nt,t}}Le.prototype.bytesPerElement=68,Lt("StructArrayLayout8i15ui1ul4f68",Le);class be extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const o=this.length;return this.resize(o+1),this.emplace(o,t)}emplace(t,o){return this.float32[1*t+0]=o,t}}be.prototype.bytesPerElement=4,Lt("StructArrayLayout1f4",be);class Me extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,o,l)}emplace(t,o,l,p){const y=3*t;return this.int16[y+0]=o,this.int16[y+1]=l,this.int16[y+2]=p,t}}Me.prototype.bytesPerElement=6,Lt("StructArrayLayout3i6",Me);class qe extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,o,l)}emplace(t,o,l,p){const y=4*t;return this.uint32[2*t+0]=o,this.uint16[y+2]=l,this.uint16[y+3]=p,t}}qe.prototype.bytesPerElement=8,Lt("StructArrayLayout1ul2ui8",qe);class Ne extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o){const l=this.length;return this.resize(l+1),this.emplace(l,t,o)}emplace(t,o,l){const p=2*t;return this.uint16[p+0]=o,this.uint16[p+1]=l,t}}Ne.prototype.bytesPerElement=4,Lt("StructArrayLayout2ui4",Ne);class Ke extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const o=this.length;return this.resize(o+1),this.emplace(o,t)}emplace(t,o){return this.uint16[1*t+0]=o,t}}Ke.prototype.bytesPerElement=2,Lt("StructArrayLayout1ui2",Ke);class Ze extends Pt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,l,p){const y=this.length;return this.resize(y+1),this.emplace(y,t,o,l,p)}emplace(t,o,l,p,y){const v=4*t;return this.float32[v+0]=o,this.float32[v+1]=l,this.float32[v+2]=p,this.float32[v+3]=y,t}}Ze.prototype.bytesPerElement=16,Lt("StructArrayLayout4f16",Ze);class ut extends Ia{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ii(this.anchorPointX,this.anchorPointY)}}ut.prototype.size=20;class rt extends V{get(t){return new ut(this,t)}}Lt("CollisionBoxArray",rt);class ot extends Ia{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ot.prototype.size=48;class yt extends _e{get(t){return new ot(this,t)}}Lt("PlacedSymbolArray",yt);class Et extends Ia{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}Et.prototype.size=68;class ct extends Le{get(t){return new Et(this,t)}}Lt("SymbolInstanceArray",ct);class Kt extends be{getoffsetX(t){return this.float32[1*t+0]}}Lt("GlyphOffsetArray",Kt);class Ot extends Me{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Lt("SymbolLineVertexArray",Ot);class gi extends Ia{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}gi.prototype.size=8;class s extends qe{get(t){return new gi(this,t)}}Lt("FeatureIndexArray",s);class c extends Yr{}class u extends Yr{}class f extends b{}class T extends n{}class P extends h{}class M extends x{}class F extends E{}class X extends z{}class Y extends R{}class le extends G{}class ce extends Q{}class de extends ae{}class Ce extends Ne{}const Ae=zt([{name:"a_pos",components:2,type:"Int16"}],4),{members:ke}=Ae;class xe{constructor(t=[]){this.segments=t}prepareSegment(t,o,l,p){let y=this.segments[this.segments.length-1];return t>xe.MAX_VERTEX_ARRAY_LENGTH&&qt(`Max vertices per segment is ${xe.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!y||y.vertexLength+t>xe.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==p)&&(y={vertexOffset:o.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},p!==void 0&&(y.sortKey=p),this.segments.push(y)),y}get(){return this.segments}destroy(){for(const t of this.segments)for(const o in t.vaos)t.vaos[o].destroy()}static simpleSegment(t,o,l,p){return new xe([{vertexOffset:t,primitiveOffset:o,vertexLength:l,primitiveLength:p,vaos:{},sortKey:0}])}}function ze(i,t){return 256*(i=re(Math.floor(i),0,255))+re(Math.floor(t),0,255)}xe.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Lt("SegmentVector",xe);const Be=zt([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Ge={exports:{}},Je={exports:{}};Je.exports=function(i,t){var o,l,p,y,v,I,k,L;for(l=i.length-(o=3&i.length),p=t,v=3432918353,I=461845907,L=0;L<l;)k=255&i.charCodeAt(L)|(255&i.charCodeAt(++L))<<8|(255&i.charCodeAt(++L))<<16|(255&i.charCodeAt(++L))<<24,++L,p=27492+(65535&(y=5*(65535&(p=(p^=k=(65535&(k=(k=(65535&k)*v+(((k>>>16)*v&65535)<<16)&4294967295)<<15|k>>>17))*I+(((k>>>16)*I&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(k=0,o){case 3:k^=(255&i.charCodeAt(L+2))<<16;case 2:k^=(255&i.charCodeAt(L+1))<<8;case 1:p^=k=(65535&(k=(k=(65535&(k^=255&i.charCodeAt(L)))*v+(((k>>>16)*v&65535)<<16)&4294967295)<<15|k>>>17))*I+(((k>>>16)*I&65535)<<16)&4294967295}return p^=i.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0};var Ye={exports:{}};Ye.exports=function(i,t){for(var o,l=i.length,p=t^l,y=0;l>=4;)o=1540483477*(65535&(o=255&i.charCodeAt(y)|(255&i.charCodeAt(++y))<<8|(255&i.charCodeAt(++y))<<16|(255&i.charCodeAt(++y))<<24))+((1540483477*(o>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),l-=4,++y;switch(l){case 3:p^=(255&i.charCodeAt(y+2))<<16;case 2:p^=(255&i.charCodeAt(y+1))<<8;case 1:p=1540483477*(65535&(p^=255&i.charCodeAt(y)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};var Qe=Je.exports,ht=Ye.exports;Ge.exports=Qe,Ge.exports.murmur3=Qe,Ge.exports.murmur2=ht;var bt=Ge.exports;class xt{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,o,l,p){this.ids.push(Dt(t)),this.positions.push(o,l,p)}getPositions(t){const o=Dt(t);let l=0,p=this.ids.length-1;for(;l<p;){const v=l+p>>1;this.ids[v]>=o?p=v:l=v+1}const y=[];for(;this.ids[l]===o;)y.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return y}static serialize(t,o){const l=new Float64Array(t.ids),p=new Uint32Array(t.positions);return Yt(l,p,0,l.length-1),o&&o.push(l.buffer,p.buffer),{ids:l,positions:p}}static deserialize(t){const o=new xt;return o.ids=t.ids,o.positions=t.positions,o.indexed=!0,o}}function Dt(i){const t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:bt(String(i))}function Yt(i,t,o,l){for(;o<l;){const p=i[o+l>>1];let y=o-1,v=l+1;for(;;){do y++;while(i[y]<p);do v--;while(i[v]>p);if(y>=v)break;ti(i,y,v),ti(t,3*y,3*v),ti(t,3*y+1,3*v+1),ti(t,3*y+2,3*v+2)}v-o<l-v?(Yt(i,t,o,v),o=v+1):(Yt(i,t,v+1,l),l=v)}}function ti(i,t,o){const l=i[t];i[t]=i[o],i[o]=l}Lt("FeaturePositionMap",xt);class Jt{constructor(t,o){this.gl=t.gl,this.location=o}}class Mi extends Jt{constructor(t,o){super(t,o),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Nt extends Jt{constructor(t,o){super(t,o),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class fi extends Jt{constructor(t,o){super(t,o),this.current=j.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Ci=new Float32Array(16);function pi(i){return[ze(255*i.r,255*i.g),ze(255*i.b,255*i.a)]}class li{constructor(t,o,l){this.value=t,this.uniformNames=o.map(p=>`u_${p}`),this.type=l}setUniform(t,o,l){t.set(l.constantOr(this.value))}getBinding(t,o,l){return this.type==="color"?new fi(t,o):new Mi(t,o)}}class _i{constructor(t,o){this.uniformNames=o.map(l=>`u_${l}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=t.tlbr}setUniform(t,o,l,p){const y=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&t.set(y)}getBinding(t,o,l){return l.substr(0,9)==="u_pattern"?new Nt(t,o):new Mi(t,o)}}class ri{constructor(t,o,l,p){this.expression=t,this.type=l,this.maxValue=0,this.paintVertexAttributes=o.map(y=>({name:`a_${y}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(t,o,l,p,y){const v=this.paintVertexArray.length,I=this.expression.evaluate(new mr(0),o,{},p,[],y);this.paintVertexArray.resize(t),this._setPaintValue(v,t,I)}updatePaintArray(t,o,l,p){const y=this.expression.evaluate({zoom:0},l,p);this._setPaintValue(t,o,y)}_setPaintValue(t,o,l){if(this.type==="color"){const p=pi(l);for(let y=t;y<o;y++)this.paintVertexArray.emplace(y,p[0],p[1])}else{for(let p=t;p<o;p++)this.paintVertexArray.emplace(p,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ei{constructor(t,o,l,p,y,v){this.expression=t,this.uniformNames=o.map(I=>`u_${I}_t`),this.type=l,this.useIntegerZoom=p,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=o.map(I=>({name:`a_${I}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(t,o,l,p,y){const v=this.expression.evaluate(new mr(this.zoom),o,{},p,[],y),I=this.expression.evaluate(new mr(this.zoom+1),o,{},p,[],y),k=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(k,t,v,I)}updatePaintArray(t,o,l,p){const y=this.expression.evaluate({zoom:this.zoom},l,p),v=this.expression.evaluate({zoom:this.zoom+1},l,p);this._setPaintValue(t,o,y,v)}_setPaintValue(t,o,l,p){if(this.type==="color"){const y=pi(l),v=pi(p);for(let I=t;I<o;I++)this.paintVertexArray.emplace(I,y[0],y[1],v[0],v[1])}else{for(let y=t;y<o;y++)this.paintVertexArray.emplace(y,l,p);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(p))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,o){const l=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,p=re(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);t.set(p)}getBinding(t,o,l){return new Mi(t,o)}}class Ar{constructor(t,o,l,p,y,v){this.expression=t,this.type=o,this.useIntegerZoom=l,this.zoom=p,this.layerId=v,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(t,o,l){const p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(p,t,o.patterns&&o.patterns[this.layerId],l)}updatePaintArray(t,o,l,p,y){this._setPaintValues(t,o,l.patterns&&l.patterns[this.layerId],y)}_setPaintValues(t,o,l,p){if(!p||!l)return;const{min:y,mid:v,max:I}=l,k=p[y],L=p[v],O=p[I];if(k&&L&&O)for(let B=t;B<o;B++)this.zoomInPaintVertexArray.emplace(B,L.tl[0],L.tl[1],L.br[0],L.br[1],k.tl[0],k.tl[1],k.br[0],k.br[1],L.pixelRatio,k.pixelRatio),this.zoomOutPaintVertexArray.emplace(B,L.tl[0],L.tl[1],L.br[0],L.br[1],O.tl[0],O.tl[1],O.br[0],O.br[1],L.pixelRatio,O.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Be.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Be.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ur{constructor(t,o,l){this.binders={},this._buffers=[];const p=[];for(const y in t.paint._values){if(!l(y))continue;const v=t.paint.get(y);if(!(v instanceof Ro&&ya(v.property.specification)))continue;const I=Bn(y,t.type),k=v.value,L=v.property.specification.type,O=v.property.useIntegerZoom,B=v.property.specification["property-type"],q=B==="cross-faded"||B==="cross-faded-data-driven";if(k.kind==="constant")this.binders[y]=q?new _i(k.value,I):new li(k.value,I,L),p.push(`/u_${y}`);else if(k.kind==="source"||q){const $=zr(y,L,"source");this.binders[y]=q?new Ar(k,L,O,o,$,t.id):new ri(k,I,L,$),p.push(`/a_${y}`)}else{const $=zr(y,L,"composite");this.binders[y]=new ei(k,I,L,O,o,$),p.push(`/z_${y}`)}}this.cacheKey=p.sort().join("")}getMaxValue(t){const o=this.binders[t];return o instanceof ri||o instanceof ei?o.maxValue:0}populatePaintArrays(t,o,l,p,y){for(const v in this.binders){const I=this.binders[v];(I instanceof ri||I instanceof ei||I instanceof Ar)&&I.populatePaintArray(t,o,l,p,y)}}setConstantPatternPositions(t,o){for(const l in this.binders){const p=this.binders[l];p instanceof _i&&p.setConstantPatternPositions(t,o)}}updatePaintArrays(t,o,l,p,y){let v=!1;for(const I in t){const k=o.getPositions(I);for(const L of k){const O=l.feature(L.index);for(const B in this.binders){const q=this.binders[B];if((q instanceof ri||q instanceof ei||q instanceof Ar)&&q.expression.isStateDependent===!0){const $=p.paint.get(B);q.expression=$.value,q.updatePaintArray(L.start,L.end,O,t[I],y),v=!0}}}}return v}defines(){const t=[];for(const o in this.binders){const l=this.binders[o];(l instanceof li||l instanceof _i)&&t.push(...l.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return t}getBinderAttributes(){const t=[];for(const o in this.binders){const l=this.binders[o];if(l instanceof ri||l instanceof ei)for(let p=0;p<l.paintVertexAttributes.length;p++)t.push(l.paintVertexAttributes[p].name);else if(l instanceof Ar)for(let p=0;p<Be.members.length;p++)t.push(Be.members[p].name)}return t}getBinderUniforms(){const t=[];for(const o in this.binders){const l=this.binders[o];if(l instanceof li||l instanceof _i||l instanceof ei)for(const p of l.uniformNames)t.push(p)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,o){const l=[];for(const p in this.binders){const y=this.binders[p];if(y instanceof li||y instanceof _i||y instanceof ei){for(const v of y.uniformNames)if(o[v]){const I=y.getBinding(t,o[v],v);l.push({name:v,property:p,binding:I})}}}return l}setUniforms(t,o,l,p){for(const{name:y,property:v,binding:I}of o)this.binders[v].setUniform(I,p,l.get(v),y)}updatePaintBuffers(t){this._buffers=[];for(const o in this.binders){const l=this.binders[o];if(t&&l instanceof Ar){const p=t.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(l instanceof ri||l instanceof ei)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(t){for(const o in this.binders){const l=this.binders[o];(l instanceof ri||l instanceof ei||l instanceof Ar)&&l.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const o=this.binders[t];(o instanceof ri||o instanceof ei||o instanceof Ar)&&o.destroy()}}}class Qr{constructor(t,o,l=()=>!0){this.programConfigurations={};for(const p of t)this.programConfigurations[p.id]=new Ur(p,o,l);this.needsUpload=!1,this._featureMap=new xt,this._bufferOffset=0}populatePaintArrays(t,o,l,p,y,v){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(t,o,p,y,v);o.id!==void 0&&this._featureMap.add(o.id,l,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,o,l,p){for(const y of l)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(t,this._featureMap,o,y,p)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Bn(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function zr(i,t,o){const l={color:{source:h,composite:Ze},number:{source:be,composite:h}},p=function(y){return{"line-pattern":{source:M,composite:M},"fill-pattern":{source:M,composite:M},"fill-extrusion-pattern":{source:M,composite:M}}[y]}(i);return p&&p[o]||l[t][o]}Lt("ConstantBinder",li),Lt("CrossFadedConstantBinder",_i),Lt("SourceExpressionBinder",ri),Lt("CrossFadedCompositeBinder",Ar),Lt("CompositeExpressionBinder",ei),Lt("ProgramConfiguration",Ur,{omit:["_buffers"]}),Lt("ProgramConfigurationSet",Qr);var Di=8192;const co=Math.pow(2,14)-1,Qn=-co-1;function Bo(i){const t=Di/i.extent,o=i.loadGeometry();for(let l=0;l<o.length;l++){const p=o[l];for(let y=0;y<p.length;y++){const v=p[y],I=Math.round(v.x*t),k=Math.round(v.y*t);v.x=re(I,Qn,co),v.y=re(k,Qn,co),(I<v.x||I>v.x+1||k<v.y||k>v.y+1)&&qt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return o}function gn(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?Bo(i):[]}}function Oo(i,t,o,l,p){i.emplaceBack(2*t+(l+1)/2,2*o+(p+1)/2)}class Fo{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new c,this.indexArray=new de,this.segments=new xe,this.programConfigurations=new Qr(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(t,o,l){const p=this.layers[0],y=[];let v=null,I=!1;p.type==="circle"&&(v=p.layout.get("circle-sort-key"),I=!v.isConstant());for(const{feature:k,id:L,index:O,sourceLayerIndex:B}of t){const q=this.layers[0]._featureFilter.needGeometry,$=gn(k,q);if(!this.layers[0]._featureFilter.filter(new mr(this.zoom),$,l))continue;const W=I?v.evaluate($,{},l):void 0,ne={id:L,properties:k.properties,type:k.type,sourceLayerIndex:B,index:O,geometry:q?$.geometry:Bo(k),patterns:{},sortKey:W};y.push(ne)}I&&y.sort((k,L)=>k.sortKey-L.sortKey);for(const k of y){const{geometry:L,index:O,sourceLayerIndex:B}=k,q=t[O].feature;this.addFeature(k,L,O,l),o.featureIndex.insert(q,L,O,B,this.index)}}update(t,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ke),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,o,l,p){for(const y of o)for(const v of y){const I=v.x,k=v.y;if(I<0||I>=Di||k<0||k>=Di)continue;const L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),O=L.vertexLength;Oo(this.layoutVertexArray,I,k,-1,-1),Oo(this.layoutVertexArray,I,k,1,-1),Oo(this.layoutVertexArray,I,k,1,1),Oo(this.layoutVertexArray,I,k,-1,1),this.indexArray.emplaceBack(O,O+1,O+2),this.indexArray.emplaceBack(O,O+3,O+2),L.vertexLength+=4,L.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,{},p)}}function Fl(i,t){for(let o=0;o<i.length;o++)if(Uo(t,i[o]))return!0;for(let o=0;o<t.length;o++)if(Uo(i,t[o]))return!0;return!!cl(i,t)}function Ul(i,t,o){return!!Uo(i,t)||!!hl(t,i,o)}function ds(i,t){if(i.length===1)return yn(t,i[0]);for(let o=0;o<t.length;o++){const l=t[o];for(let p=0;p<l.length;p++)if(Uo(i,l[p]))return!0}for(let o=0;o<i.length;o++)if(yn(t,i[o]))return!0;for(let o=0;o<t.length;o++)if(cl(i,t[o]))return!0;return!1}function Vl(i,t,o){if(i.length>1){if(cl(i,t))return!0;for(let l=0;l<t.length;l++)if(hl(t[l],i,o))return!0}for(let l=0;l<i.length;l++)if(hl(i[l],t,o))return!0;return!1}function cl(i,t){if(i.length===0||t.length===0)return!1;for(let o=0;o<i.length-1;o++){const l=i[o],p=i[o+1];for(let y=0;y<t.length-1;y++)if(Ga(l,p,t[y],t[y+1]))return!0}return!1}function Ga(i,t,o,l){return Zt(i,o,l)!==Zt(t,o,l)&&Zt(i,t,o)!==Zt(i,t,l)}function hl(i,t,o){const l=o*o;if(t.length===1)return i.distSqr(t[0])<l;for(let p=1;p<t.length;p++)if(Ca(i,t[p-1],t[p])<l)return!0;return!1}function Ca(i,t,o){const l=t.distSqr(o);if(l===0)return i.distSqr(t);const p=((i.x-t.x)*(o.x-t.x)+(i.y-t.y)*(o.y-t.y))/l;return i.distSqr(p<0?t:p>1?o:o.sub(t)._mult(p)._add(t))}function yn(i,t){let o,l,p,y=!1;for(let v=0;v<i.length;v++){o=i[v];for(let I=0,k=o.length-1;I<o.length;k=I++)l=o[I],p=o[k],l.y>t.y!=p.y>t.y&&t.x<(p.x-l.x)*(t.y-l.y)/(p.y-l.y)+l.x&&(y=!y)}return y}function Uo(i,t){let o=!1;for(let l=0,p=i.length-1;l<i.length;p=l++){const y=i[l],v=i[p];y.y>t.y!=v.y>t.y&&t.x<(v.x-y.x)*(t.y-y.y)/(v.y-y.y)+y.x&&(o=!o)}return o}function Os(i,t,o){const l=o[0],p=o[2];if(i.x<l.x&&t.x<l.x||i.x>p.x&&t.x>p.x||i.y<l.y&&t.y<l.y||i.y>p.y&&t.y>p.y)return!1;const y=Zt(i,t,o[0]);return y!==Zt(i,t,o[1])||y!==Zt(i,t,o[2])||y!==Zt(i,t,o[3])}function za(i,t,o){const l=t.paint.get(i).value;return l.kind==="constant"?l.value:o.programConfigurations.get(t.id).getMaxValue(i)}function ji(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function ho(i,t,o,l,p){if(!t[0]&&!t[1])return i;const y=ii.convert(t)._mult(p);o==="viewport"&&y._rotate(-l);const v=[];for(let I=0;I<i.length;I++)v.push(i[I].sub(y));return v}Lt("CircleBucket",Fo,{omit:["layers"]});const Io=new Tr({"circle-sort-key":new At(st.layout_circle["circle-sort-key"])});var pl={paint:new Tr({"circle-radius":new At(st.paint_circle["circle-radius"]),"circle-color":new At(st.paint_circle["circle-color"]),"circle-blur":new At(st.paint_circle["circle-blur"]),"circle-opacity":new At(st.paint_circle["circle-opacity"]),"circle-translate":new Gt(st.paint_circle["circle-translate"]),"circle-translate-anchor":new Gt(st.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Gt(st.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Gt(st.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new At(st.paint_circle["circle-stroke-width"]),"circle-stroke-color":new At(st.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new At(st.paint_circle["circle-stroke-opacity"])}),layout:Io},Nl=typeof Float32Array!="undefined"?Float32Array:Array;function jl(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function lh(i,t,o){var l=t[0],p=t[1],y=t[2],v=t[3],I=t[4],k=t[5],L=t[6],O=t[7],B=t[8],q=t[9],$=t[10],W=t[11],ne=t[12],ue=t[13],Ie=t[14],De=t[15],Fe=o[0],Ue=o[1],We=o[2],Ve=o[3];return i[0]=Fe*l+Ue*I+We*B+Ve*ne,i[1]=Fe*p+Ue*k+We*q+Ve*ue,i[2]=Fe*y+Ue*L+We*$+Ve*Ie,i[3]=Fe*v+Ue*O+We*W+Ve*De,i[4]=(Fe=o[4])*l+(Ue=o[5])*I+(We=o[6])*B+(Ve=o[7])*ne,i[5]=Fe*p+Ue*k+We*q+Ve*ue,i[6]=Fe*y+Ue*L+We*$+Ve*Ie,i[7]=Fe*v+Ue*O+We*W+Ve*De,i[8]=(Fe=o[8])*l+(Ue=o[9])*I+(We=o[10])*B+(Ve=o[11])*ne,i[9]=Fe*p+Ue*k+We*q+Ve*ue,i[10]=Fe*y+Ue*L+We*$+Ve*Ie,i[11]=Fe*v+Ue*O+We*W+Ve*De,i[12]=(Fe=o[12])*l+(Ue=o[13])*I+(We=o[14])*B+(Ve=o[15])*ne,i[13]=Fe*p+Ue*k+We*q+Ve*ue,i[14]=Fe*y+Ue*L+We*$+Ve*Ie,i[15]=Fe*v+Ue*O+We*W+Ve*De,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var fs,uh=lh;function ms(i,t,o){var l=t[0],p=t[1],y=t[2],v=t[3];return i[0]=o[0]*l+o[4]*p+o[8]*y+o[12]*v,i[1]=o[1]*l+o[5]*p+o[9]*y+o[13]*v,i[2]=o[2]*l+o[6]*p+o[10]*y+o[14]*v,i[3]=o[3]*l+o[7]*p+o[11]*y+o[15]*v,i}function Au(i,t){const o=ms([],[i.x,i.y,0,1],t);return new ii(o[0]/o[3],o[1]/o[3])}fs=new Nl(4),Nl!=Float32Array&&(fs[0]=0,fs[1]=0,fs[2]=0,fs[3]=0);class ch extends Fo{}Lt("HeatmapBucket",ch,{omit:["layers"]});var Iu={paint:new Tr({"heatmap-radius":new At(st.paint_heatmap["heatmap-radius"]),"heatmap-weight":new At(st.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Gt(st.paint_heatmap["heatmap-intensity"]),"heatmap-color":new an(st.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Gt(st.paint_heatmap["heatmap-opacity"])})};function po(i,{width:t,height:o},l,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==t*o*l)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${t*o*l}`)}else p=new Uint8Array(t*o*l);return i.width=t,i.height=o,i.data=p,i}function Ip(i,{width:t,height:o},l){if(t===i.width&&o===i.height)return;const p=po({},{width:t,height:o},l);hh(i,p,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,o)},l),i.width=t,i.height=o,i.data=p.data}function hh(i,t,o,l,p,y){if(p.width===0||p.height===0)return t;if(p.width>i.width||p.height>i.height||o.x>i.width-p.width||o.y>i.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>t.width||p.height>t.height||l.x>t.width-p.width||l.y>t.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const v=i.data,I=t.data;for(let k=0;k<p.height;k++){const L=((o.y+k)*i.width+o.x)*y,O=((l.y+k)*t.width+l.x)*y;for(let B=0;B<p.width*y;B++)I[O+B]=v[L+B]}return t}class Ic{constructor(t,o){po(this,t,1,o)}resize(t){Ip(this,t,1)}clone(){return new Ic({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,o,l,p,y){hh(t,o,l,p,y,1)}}class Pa{constructor(t,o){po(this,t,4,o)}resize(t){Ip(this,t,4)}replace(t,o){o?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Pa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,o,l,p,y){hh(t,o,l,p,y,4)}}function Cp(i){const t={},o=i.resolution||256,l=i.clips?i.clips.length:1,p=i.image||new Pa({width:o,height:l}),y=(v,I,k)=>{t[i.evaluationKey]=k;const L=i.expression.evaluate(t);p.data[v+I+0]=Math.floor(255*L.r/L.a),p.data[v+I+1]=Math.floor(255*L.g/L.a),p.data[v+I+2]=Math.floor(255*L.b/L.a),p.data[v+I+3]=Math.floor(255*L.a)};if(i.clips)for(let v=0,I=0;v<l;++v,I+=4*o)for(let k=0,L=0;k<o;k++,L+=4){const O=k/(o-1),{start:B,end:q}=i.clips[v];y(I,L,B*(1-O)+q*O)}else for(let v=0,I=0;v<o;v++,I+=4)y(0,I,v/(o-1));return p}Lt("AlphaImage",Ic),Lt("RGBAImage",Pa);var Bd={paint:new Tr({"hillshade-illumination-direction":new Gt(st.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Gt(st.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Gt(st.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Gt(st.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Gt(st.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Gt(st.paint_hillshade["hillshade-accent-color"])})};const Gh=zt([{name:"a_pos",components:2,type:"Int16"}],4),{members:Od}=Gh;var Yu={exports:{}};function Cc(i,t,o){o=o||2;var l,p,y,v,I,k,L,O=t&&t.length,B=O?t[0]*o:i.length,q=dl(i,0,B,o,!0),$=[];if(!q||q.next===q.prev)return $;if(O&&(q=function(ne,ue,Ie,De){var Fe,Ue,We,Ve=[];for(Fe=0,Ue=ue.length;Fe<Ue;Fe++)(We=dl(ne,ue[Fe]*De,Fe<Ue-1?ue[Fe+1]*De:ne.length,De,!1))===We.next&&(We.steiner=!0),Ve.push(Qu(We));for(Ve.sort(jd),Fe=0;Fe<Ve.length;Fe++)Ie=Za(Ie=qd(Ve[Fe],Ie),Ie.next);return Ie}(i,t,q,o)),i.length>80*o){l=y=i[0],p=v=i[1];for(var W=o;W<B;W+=o)(I=i[W])<l&&(l=I),(k=i[W+1])<p&&(p=k),I>y&&(y=I),k>v&&(v=k);L=(L=Math.max(y-l,v-p))!==0?1/L:0}return zc(q,$,o,l,p,L),$}function dl(i,t,o,l,p){var y,v;if(p===Hh(i,t,o,l)>0)for(y=t;y<o;y+=l)v=ic(y,i[y],i[y+1],v);else for(y=o-l;y>=t;y-=l)v=ic(y,i[y],i[y+1],v);return v&&Pc(v,v.next)&&(zu(v),v=v.next),v}function Za(i,t){if(!i)return i;t||(t=i);var o,l=i;do if(o=!1,l.steiner||!Pc(l,l.next)&&Gr(l.prev,l,l.next)!==0)l=l.next;else{if(zu(l),(l=t=l.prev)===l.next)break;o=!0}while(o||l!==t);return t}function zc(i,t,o,l,p,y,v){if(i){!v&&y&&function(O,B,q,$){var W=O;do W.z===null&&(W.z=Xh(W.x,W.y,B,q,$)),W.prevZ=W.prev,W.nextZ=W.next,W=W.next;while(W!==O);W.prevZ.nextZ=null,W.prevZ=null,function(ne){var ue,Ie,De,Fe,Ue,We,Ve,mt,dt=1;do{for(Ie=ne,ne=null,Ue=null,We=0;Ie;){for(We++,De=Ie,Ve=0,ue=0;ue<dt&&(Ve++,De=De.nextZ);ue++);for(mt=dt;Ve>0||mt>0&&De;)Ve!==0&&(mt===0||!De||Ie.z<=De.z)?(Fe=Ie,Ie=Ie.nextZ,Ve--):(Fe=De,De=De.nextZ,mt--),Ue?Ue.nextZ=Fe:ne=Fe,Fe.prevZ=Ue,Ue=Fe;Ie=De}Ue.nextZ=null,dt*=2}while(We>1)}(W)}(i,l,p,y);for(var I,k,L=i;i.prev!==i.next;)if(I=i.prev,k=i.next,y?Ud(i,l,p,y):Fd(i))t.push(I.i/o),t.push(i.i/o),t.push(k.i/o),zu(i),i=k.next,L=k.next;else if((i=k)===L){v?v===1?zc(i=Vd(Za(i),t,o),t,o,l,p,y,2):v===2&&Nd(i,t,o,l,p,y):zc(Za(i),t,o,l,p,y,1);break}}}function Fd(i){var t=i.prev,o=i,l=i.next;if(Gr(t,o,l)>=0)return!1;for(var p=i.next.next;p!==i.prev;){if(ec(t.x,t.y,o.x,o.y,l.x,l.y,p.x,p.y)&&Gr(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function Ud(i,t,o,l){var p=i.prev,y=i,v=i.next;if(Gr(p,y,v)>=0)return!1;for(var I=p.x>y.x?p.x>v.x?p.x:v.x:y.x>v.x?y.x:v.x,k=p.y>y.y?p.y>v.y?p.y:v.y:y.y>v.y?y.y:v.y,L=Xh(p.x<y.x?p.x<v.x?p.x:v.x:y.x<v.x?y.x:v.x,p.y<y.y?p.y<v.y?p.y:v.y:y.y<v.y?y.y:v.y,t,o,l),O=Xh(I,k,t,o,l),B=i.prevZ,q=i.nextZ;B&&B.z>=L&&q&&q.z<=O;){if(B!==i.prev&&B!==i.next&&ec(p.x,p.y,y.x,y.y,v.x,v.y,B.x,B.y)&&Gr(B.prev,B,B.next)>=0||(B=B.prevZ,q!==i.prev&&q!==i.next&&ec(p.x,p.y,y.x,y.y,v.x,v.y,q.x,q.y)&&Gr(q.prev,q,q.next)>=0))return!1;q=q.nextZ}for(;B&&B.z>=L;){if(B!==i.prev&&B!==i.next&&ec(p.x,p.y,y.x,y.y,v.x,v.y,B.x,B.y)&&Gr(B.prev,B,B.next)>=0)return!1;B=B.prevZ}for(;q&&q.z<=O;){if(q!==i.prev&&q!==i.next&&ec(p.x,p.y,y.x,y.y,v.x,v.y,q.x,q.y)&&Gr(q.prev,q,q.next)>=0)return!1;q=q.nextZ}return!0}function Vd(i,t,o){var l=i;do{var p=l.prev,y=l.next.next;!Pc(p,y)&&kc(p,l,l.next,y)&&tc(p,y)&&tc(y,p)&&(t.push(p.i/o),t.push(l.i/o),t.push(y.i/o),zu(l),zu(l.next),l=i=y),l=l.next}while(l!==i);return Za(l)}function Nd(i,t,o,l,p,y){var v=i;do{for(var I=v.next.next;I!==v.prev;){if(v.i!==I.i&&_n(v,I)){var k=$h(v,I);return v=Za(v,v.next),k=Za(k,k.next),zc(v,t,o,l,p,y),void zc(k,t,o,l,p,y)}I=I.next}v=v.next}while(v!==i)}function jd(i,t){return i.x-t.x}function qd(i,t){var o=function(y,v){var I,k=v,L=y.x,O=y.y,B=-1/0;do{if(O<=k.y&&O>=k.next.y&&k.next.y!==k.y){var q=k.x+(O-k.y)*(k.next.x-k.x)/(k.next.y-k.y);if(q<=L&&q>B){if(B=q,q===L){if(O===k.y)return k;if(O===k.next.y)return k.next}I=k.x<k.next.x?k:k.next}}k=k.next}while(k!==v);if(!I)return null;if(L===B)return I;var $,W=I,ne=I.x,ue=I.y,Ie=1/0;k=I;do L>=k.x&&k.x>=ne&&L!==k.x&&ec(O<ue?L:B,O,ne,ue,O<ue?B:L,O,k.x,k.y)&&($=Math.abs(O-k.y)/(L-k.x),tc(k,y)&&($<Ie||$===Ie&&(k.x>I.x||k.x===I.x&&Zh(I,k)))&&(I=k,Ie=$)),k=k.next;while(k!==W);return I}(i,t);if(!o)return t;var l=$h(o,i),p=Za(o,o.next);return Za(l,l.next),t===o?p:t}function Zh(i,t){return Gr(i.prev,i,t.prev)<0&&Gr(t.next,i,i.next)<0}function Xh(i,t,o,l,p){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-o)*p)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-l)*p)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Qu(i){var t=i,o=i;do(t.x<o.x||t.x===o.x&&t.y<o.y)&&(o=t),t=t.next;while(t!==i);return o}function ec(i,t,o,l,p,y,v,I){return(p-v)*(t-I)-(i-v)*(y-I)>=0&&(i-v)*(l-I)-(o-v)*(t-I)>=0&&(o-v)*(y-I)-(p-v)*(l-I)>=0}function _n(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(o,l){var p=o;do{if(p.i!==o.i&&p.next.i!==o.i&&p.i!==l.i&&p.next.i!==l.i&&kc(p,p.next,o,l))return!0;p=p.next}while(p!==o);return!1}(i,t)&&(tc(i,t)&&tc(t,i)&&function(o,l){var p=o,y=!1,v=(o.x+l.x)/2,I=(o.y+l.y)/2;do p.y>I!=p.next.y>I&&p.next.y!==p.y&&v<(p.next.x-p.x)*(I-p.y)/(p.next.y-p.y)+p.x&&(y=!y),p=p.next;while(p!==o);return y}(i,t)&&(Gr(i.prev,i,t.prev)||Gr(i,t.prev,t))||Pc(i,t)&&Gr(i.prev,i,i.next)>0&&Gr(t.prev,t,t.next)>0)}function Gr(i,t,o){return(t.y-i.y)*(o.x-t.x)-(t.x-i.x)*(o.y-t.y)}function Pc(i,t){return i.x===t.x&&i.y===t.y}function kc(i,t,o,l){var p=ql(Gr(i,t,o)),y=ql(Gr(i,t,l)),v=ql(Gr(o,l,i)),I=ql(Gr(o,l,t));return p!==y&&v!==I||!(p!==0||!Cu(i,o,t))||!(y!==0||!Cu(i,l,t))||!(v!==0||!Cu(o,i,l))||!(I!==0||!Cu(o,t,l))}function Cu(i,t,o){return t.x<=Math.max(i.x,o.x)&&t.x>=Math.min(i.x,o.x)&&t.y<=Math.max(i.y,o.y)&&t.y>=Math.min(i.y,o.y)}function ql(i){return i>0?1:i<0?-1:0}function tc(i,t){return Gr(i.prev,i,i.next)<0?Gr(i,t,i.next)>=0&&Gr(i,i.prev,t)>=0:Gr(i,t,i.prev)<0||Gr(i,i.next,t)<0}function $h(i,t){var o=new Mc(i.i,i.x,i.y),l=new Mc(t.i,t.x,t.y),p=i.next,y=t.prev;return i.next=t,t.prev=i,o.next=p,p.prev=o,l.next=o,o.prev=l,y.next=l,l.prev=y,l}function ic(i,t,o,l){var p=new Mc(i,t,o);return l?(p.next=l.next,p.prev=l,l.next.prev=p,l.next=p):(p.prev=p,p.next=p),p}function zu(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Mc(i,t,o){this.i=i,this.x=t,this.y=o,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Hh(i,t,o,l){for(var p=0,y=t,v=o-l;y<o;y+=l)p+=(i[v]-i[y])*(i[y+1]+i[v+1]),v=y;return p}Yu.exports=Cc,Yu.exports.default=Cc,Cc.deviation=function(i,t,o,l){var p=t&&t.length,y=Math.abs(Hh(i,0,p?t[0]*o:i.length,o));if(p)for(var v=0,I=t.length;v<I;v++)y-=Math.abs(Hh(i,t[v]*o,v<I-1?t[v+1]*o:i.length,o));var k=0;for(v=0;v<l.length;v+=3){var L=l[v]*o,O=l[v+1]*o,B=l[v+2]*o;k+=Math.abs((i[L]-i[B])*(i[O+1]-i[L+1])-(i[L]-i[O])*(i[B+1]-i[L+1]))}return y===0&&k===0?0:Math.abs((k-y)/y)},Cc.flatten=function(i){for(var t=i[0][0].length,o={vertices:[],holes:[],dimensions:t},l=0,p=0;p<i.length;p++){for(var y=0;y<i[p].length;y++)for(var v=0;v<t;v++)o.vertices.push(i[p][y][v]);p>0&&o.holes.push(l+=i[p-1].length)}return o};var rc=Yu.exports;function Gd(i,t,o,l,p){ph(i,t,o||0,l||i.length-1,p||Wh)}function ph(i,t,o,l,p){for(;l>o;){if(l-o>600){var y=l-o+1,v=t-o+1,I=Math.log(y),k=.5*Math.exp(2*I/3),L=.5*Math.sqrt(I*k*(y-k)/y)*(v-y/2<0?-1:1);ph(i,t,Math.max(o,Math.floor(t-v*k/y+L)),Math.min(l,Math.floor(t+(y-v)*k/y+L)),p)}var O=i[t],B=o,q=l;for(Lc(i,o,t),p(i[l],O)>0&&Lc(i,o,l);B<q;){for(Lc(i,B,q),B++,q--;p(i[B],O)<0;)B++;for(;p(i[q],O)>0;)q--}p(i[o],O)===0?Lc(i,o,q):Lc(i,++q,l),q<=t&&(o=q+1),t<=q&&(l=q-1)}}function Lc(i,t,o){var l=i[t];i[t]=i[o],i[o]=l}function Wh(i,t){return i<t?-1:i>t?1:0}function Dc(i,t){const o=i.length;if(o<=1)return[i];const l=[];let p,y;for(let v=0;v<o;v++){const I=si(i[v]);I!==0&&(i[v].area=Math.abs(I),y===void 0&&(y=I<0),y===I<0?(p&&l.push(p),p=[i[v]]):p.push(i[v]))}if(p&&l.push(p),t>1)for(let v=0;v<l.length;v++)l[v].length<=t||(Gd(l[v],t,1,l[v].length-1,gs),l[v]=l[v].slice(0,t));return l}function gs(i,t){return t.area-i.area}function Kh(i,t,o){const l=o.patternDependencies;let p=!1;for(const y of t){const v=y.paint.get(`${i}-pattern`);v.isConstant()||(p=!0);const I=v.constantOr(null);I&&(p=!0,l[I.to]=!0,l[I.from]=!0)}return p}function Jh(i,t,o,l,p){const y=p.patternDependencies;for(const v of t){const I=v.paint.get(`${i}-pattern`).value;if(I.kind!=="constant"){let k=I.evaluate({zoom:l-1},o,{},p.availableImages),L=I.evaluate({zoom:l},o,{},p.availableImages),O=I.evaluate({zoom:l+1},o,{},p.availableImages);k=k&&k.name?k.name:k,L=L&&L.name?L.name:L,O=O&&O.name?O.name:O,y[k]=!0,y[L]=!0,y[O]=!0,o.patterns[v.id]={min:k,mid:L,max:O}}}return o}class Yh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new u,this.indexArray=new de,this.indexArray2=new Ce,this.programConfigurations=new Qr(t.layers,t.zoom),this.segments=new xe,this.segments2=new xe,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(t,o,l){this.hasPattern=Kh("fill",this.layers,o);const p=this.layers[0].layout.get("fill-sort-key"),y=!p.isConstant(),v=[];for(const{feature:I,id:k,index:L,sourceLayerIndex:O}of t){const B=this.layers[0]._featureFilter.needGeometry,q=gn(I,B);if(!this.layers[0]._featureFilter.filter(new mr(this.zoom),q,l))continue;const $=y?p.evaluate(q,{},l,o.availableImages):void 0,W={id:k,properties:I.properties,type:I.type,sourceLayerIndex:O,index:L,geometry:B?q.geometry:Bo(I),patterns:{},sortKey:$};v.push(W)}y&&v.sort((I,k)=>I.sortKey-k.sortKey);for(const I of v){const{geometry:k,index:L,sourceLayerIndex:O}=I;if(this.hasPattern){const B=Jh("fill",this.layers,I,this.zoom,o);this.patternFeatures.push(B)}else this.addFeature(I,k,L,l,{});o.featureIndex.insert(t[L].feature,k,L,O,this.index)}}update(t,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,l)}addFeatures(t,o,l){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,o,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Od),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,o,l,p,y){for(const v of Dc(o,500)){let I=0;for(const $ of v)I+=$.length;const k=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray),L=k.vertexLength,O=[],B=[];for(const $ of v){if($.length===0)continue;$!==v[0]&&B.push(O.length/2);const W=this.segments2.prepareSegment($.length,this.layoutVertexArray,this.indexArray2),ne=W.vertexLength;this.layoutVertexArray.emplaceBack($[0].x,$[0].y),this.indexArray2.emplaceBack(ne+$.length-1,ne),O.push($[0].x),O.push($[0].y);for(let ue=1;ue<$.length;ue++)this.layoutVertexArray.emplaceBack($[ue].x,$[ue].y),this.indexArray2.emplaceBack(ne+ue-1,ne+ue),O.push($[ue].x),O.push($[ue].y);W.vertexLength+=$.length,W.primitiveLength+=$.length}const q=rc(O,B);for(let $=0;$<q.length;$+=3)this.indexArray.emplaceBack(L+q[$],L+q[$+1],L+q[$+2]);k.vertexLength+=I,k.primitiveLength+=q.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,y,p)}}Lt("FillBucket",Yh,{omit:["layers","patternFeatures"]});const Zd=new Tr({"fill-sort-key":new At(st.layout_fill["fill-sort-key"])});var zp={paint:new Tr({"fill-antialias":new Gt(st.paint_fill["fill-antialias"]),"fill-opacity":new At(st.paint_fill["fill-opacity"]),"fill-color":new At(st.paint_fill["fill-color"]),"fill-outline-color":new At(st.paint_fill["fill-outline-color"]),"fill-translate":new Gt(st.paint_fill["fill-translate"]),"fill-translate-anchor":new Gt(st.paint_fill["fill-translate-anchor"]),"fill-pattern":new lo(st.paint_fill["fill-pattern"])}),layout:Zd};const nc=zt([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),{members:Xd}=nc;var Gl={},Pp=ii,Qh=oc;function oc(i,t,o,l,p){this.properties={},this.extent=o,this.type=0,this._pbf=i,this._geometry=-1,this._keys=l,this._values=p,i.readFields($d,this,t)}function $d(i,t,o){i==1?t.id=o.readVarint():i==2?function(l,p){for(var y=l.readVarint()+l.pos;l.pos<y;){var v=p._keys[l.readVarint()],I=p._values[l.readVarint()];p.properties[v]=I}}(o,t):i==3?t.type=o.readVarint():i==4&&(t._geometry=o.pos)}function ac(i){for(var t,o,l=0,p=0,y=i.length,v=y-1;p<y;v=p++)l+=((o=i[v]).x-(t=i[p]).x)*(t.y+o.y);return l}oc.types=["Unknown","Point","LineString","Polygon"],oc.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,o=i.readVarint()+i.pos,l=1,p=0,y=0,v=0,I=[];i.pos<o;){if(p<=0){var k=i.readVarint();l=7&k,p=k>>3}if(p--,l===1||l===2)y+=i.readSVarint(),v+=i.readSVarint(),l===1&&(t&&I.push(t),t=[]),t.push(new Pp(y,v));else{if(l!==7)throw new Error("unknown command "+l);t&&t.push(t[0].clone())}}return t&&I.push(t),I},oc.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,o=1,l=0,p=0,y=0,v=1/0,I=-1/0,k=1/0,L=-1/0;i.pos<t;){if(l<=0){var O=i.readVarint();o=7&O,l=O>>3}if(l--,o===1||o===2)(p+=i.readSVarint())<v&&(v=p),p>I&&(I=p),(y+=i.readSVarint())<k&&(k=y),y>L&&(L=y);else if(o!==7)throw new Error("unknown command "+o)}return[v,k,I,L]},oc.prototype.toGeoJSON=function(i,t,o){var l,p,y=this.extent*Math.pow(2,o),v=this.extent*i,I=this.extent*t,k=this.loadGeometry(),L=oc.types[this.type];function O($){for(var W=0;W<$.length;W++){var ne=$[W];$[W]=[360*(ne.x+v)/y-180,360/Math.PI*Math.atan(Math.exp((180-360*(ne.y+I)/y)*Math.PI/180))-90]}}switch(this.type){case 1:var B=[];for(l=0;l<k.length;l++)B[l]=k[l][0];O(k=B);break;case 2:for(l=0;l<k.length;l++)O(k[l]);break;case 3:for(k=function($){var W=$.length;if(W<=1)return[$];for(var ne,ue,Ie=[],De=0;De<W;De++){var Fe=ac($[De]);Fe!==0&&(ue===void 0&&(ue=Fe<0),ue===Fe<0?(ne&&Ie.push(ne),ne=[$[De]]):ne.push($[De]))}return ne&&Ie.push(ne),Ie}(k),l=0;l<k.length;l++)for(p=0;p<k[l].length;p++)O(k[l][p])}k.length===1?k=k[0]:L="Multi"+L;var q={type:"Feature",geometry:{type:L,coordinates:k},properties:this.properties};return"id"in this&&(q.id=this.id),q};var Hd=Qh,dh=sc;function sc(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(ys,this,t),this.length=this._features.length}function ys(i,t,o){i===15?t.version=o.readVarint():i===1?t.name=o.readString():i===5?t.extent=o.readVarint():i===2?t._features.push(o.pos):i===3?t._keys.push(o.readString()):i===4&&t._values.push(function(l){for(var p=null,y=l.readVarint()+l.pos;l.pos<y;){var v=l.readVarint()>>3;p=v===1?l.readString():v===2?l.readFloat():v===3?l.readDouble():v===4?l.readVarint64():v===5?l.readVarint():v===6?l.readSVarint():v===7?l.readBoolean():null}return p}(o))}sc.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new Hd(this._pbf,t,this.extent,this._keys,this._values)};var Wd=dh;function Kd(i,t,o){if(i===3){var l=new Wd(o,o.readVarint()+o.pos);l.length&&(t[l.name]=l)}}Gl.VectorTile=function(i,t){this.layers=i.readFields(Kd,{},t)},Gl.VectorTileFeature=Qh,Gl.VectorTileLayer=dh;const Jd=Gl.VectorTileFeature.types,Pu=Math.pow(2,13);function lc(i,t,o,l,p,y,v,I){i.emplaceBack(t,o,2*Math.floor(l*Pu)+v,p*Pu*2,y*Pu*2,Math.round(I))}class ep{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new f,this.indexArray=new de,this.programConfigurations=new Qr(t.layers,t.zoom),this.segments=new xe,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(t,o,l){this.features=[],this.hasPattern=Kh("fill-extrusion",this.layers,o);for(const{feature:p,id:y,index:v,sourceLayerIndex:I}of t){const k=this.layers[0]._featureFilter.needGeometry,L=gn(p,k);if(!this.layers[0]._featureFilter.filter(new mr(this.zoom),L,l))continue;const O={id:y,sourceLayerIndex:I,index:v,geometry:k?L.geometry:Bo(p),properties:p.properties,type:p.type,patterns:{}};this.hasPattern?this.features.push(Jh("fill-extrusion",this.layers,O,this.zoom,o)):this.addFeature(O,O.geometry,v,l,{}),o.featureIndex.insert(p,O.geometry,v,I,this.index,!0)}}addFeatures(t,o,l){for(const p of this.features){const{geometry:y}=p;this.addFeature(p,y,p.index,o,l)}}update(t,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Xd),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,o,l,p,y){for(const v of Dc(o,500)){let I=0;for(const $ of v)I+=$.length;let k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const $ of v){if($.length===0||Qd($))continue;let W=0;for(let ne=0;ne<$.length;ne++){const ue=$[ne];if(ne>=1){const Ie=$[ne-1];if(!Yd(ue,Ie)){k.vertexLength+4>xe.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const De=ue.sub(Ie)._perp()._unit(),Fe=Ie.dist(ue);W+Fe>32768&&(W=0),lc(this.layoutVertexArray,ue.x,ue.y,De.x,De.y,0,0,W),lc(this.layoutVertexArray,ue.x,ue.y,De.x,De.y,0,1,W),W+=Fe,lc(this.layoutVertexArray,Ie.x,Ie.y,De.x,De.y,0,0,W),lc(this.layoutVertexArray,Ie.x,Ie.y,De.x,De.y,0,1,W);const Ue=k.vertexLength;this.indexArray.emplaceBack(Ue,Ue+2,Ue+1),this.indexArray.emplaceBack(Ue+1,Ue+2,Ue+3),k.vertexLength+=4,k.primitiveLength+=2}}}}if(k.vertexLength+I>xe.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray)),Jd[t.type]!=="Polygon")continue;const L=[],O=[],B=k.vertexLength;for(const $ of v)if($.length!==0){$!==v[0]&&O.push(L.length/2);for(let W=0;W<$.length;W++){const ne=$[W];lc(this.layoutVertexArray,ne.x,ne.y,0,0,1,1,0),L.push(ne.x),L.push(ne.y)}}const q=rc(L,O);for(let $=0;$<q.length;$+=3)this.indexArray.emplaceBack(B+q[$],B+q[$+2],B+q[$+1]);k.primitiveLength+=q.length/3,k.vertexLength+=I}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,y,p)}}function Yd(i,t){return i.x===t.x&&(i.x<0||i.x>Di)||i.y===t.y&&(i.y<0||i.y>Di)}function Qd(i){return i.every(t=>t.x<0)||i.every(t=>t.x>Di)||i.every(t=>t.y<0)||i.every(t=>t.y>Di)}Lt("FillExtrusionBucket",ep,{omit:["layers","features"]});var ef={paint:new Tr({"fill-extrusion-opacity":new Gt(st["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new At(st["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Gt(st["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Gt(st["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new lo(st["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new At(st["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new At(st["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Gt(st["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function uc(i,t){return i.x*t.x+i.y*t.y}function fo(i,t){if(i.length===1){let o=0;const l=t[o++];let p;for(;!p||l.equals(p);)if(p=t[o++],!p)return 1/0;for(;o<t.length;o++){const y=t[o],v=i[0],I=p.sub(l),k=y.sub(l),L=v.sub(l),O=uc(I,I),B=uc(I,k),q=uc(k,k),$=uc(L,I),W=uc(L,k),ne=O*q-B*B,ue=(q*$-B*W)/ne,Ie=(O*W-B*$)/ne,De=l.z*(1-ue-Ie)+p.z*ue+y.z*Ie;if(isFinite(De))return De}return 1/0}{let o=1/0;for(const l of t)o=Math.min(o,l.z);return o}}const tf=zt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:kp}=tf,Mp=zt([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:rf}=Mp,Lp=Gl.VectorTileFeature.types,nf=Math.cos(Math.PI/180*37.5),Dp=Math.pow(2,14)/.5;class tp{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new T,this.layoutVertexArray2=new P,this.indexArray=new de,this.programConfigurations=new Qr(t.layers,t.zoom),this.segments=new xe,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(t,o,l){this.hasPattern=Kh("line",this.layers,o);const p=this.layers[0].layout.get("line-sort-key"),y=!p.isConstant(),v=[];for(const{feature:I,id:k,index:L,sourceLayerIndex:O}of t){const B=this.layers[0]._featureFilter.needGeometry,q=gn(I,B);if(!this.layers[0]._featureFilter.filter(new mr(this.zoom),q,l))continue;const $=y?p.evaluate(q,{},l):void 0,W={id:k,properties:I.properties,type:I.type,sourceLayerIndex:O,index:L,geometry:B?q.geometry:Bo(I),patterns:{},sortKey:$};v.push(W)}y&&v.sort((I,k)=>I.sortKey-k.sortKey);for(const I of v){const{geometry:k,index:L,sourceLayerIndex:O}=I;if(this.hasPattern){const B=Jh("line",this.layers,I,this.zoom,o);this.patternFeatures.push(B)}else this.addFeature(I,k,L,l,{});o.featureIndex.insert(t[L].feature,k,L,O,this.index)}}update(t,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,l)}addFeatures(t,o,l){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,o,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,rf)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,kp),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,o,l,p,y){const v=this.layers[0].layout,I=v.get("line-join").evaluate(t,{}),k=v.get("line-cap"),L=v.get("line-miter-limit"),O=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const B of o)this.addLine(B,t,I,k,L,O);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,y,p)}addLine(t,o,l,p,y,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ie=0;Ie<t.length-1;Ie++)this.totalDistance+=t[Ie].dist(t[Ie+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const I=Lp[o.type]==="Polygon";let k=t.length;for(;k>=2&&t[k-1].equals(t[k-2]);)k--;let L=0;for(;L<k-1&&t[L].equals(t[L+1]);)L++;if(k<(I?3:2))return;l==="bevel"&&(y=1.05);const O=this.overscaling<=16?122880/(512*this.overscaling):0,B=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray);let q,$,W,ne,ue;this.e1=this.e2=-1,I&&(q=t[k-2],ue=t[L].sub(q)._unit()._perp());for(let Ie=L;Ie<k;Ie++){if(W=Ie===k-1?I?t[L+1]:void 0:t[Ie+1],W&&t[Ie].equals(W))continue;ue&&(ne=ue),q&&($=q),q=t[Ie],ue=W?W.sub(q)._unit()._perp():ne,ne=ne||ue;let De=ne.add(ue);De.x===0&&De.y===0||De._unit();const Fe=ne.x*ue.x+ne.y*ue.y,Ue=De.x*ue.x+De.y*ue.y,We=Ue!==0?1/Ue:1/0,Ve=2*Math.sqrt(2-2*Ue),mt=Ue<nf&&$&&W,dt=ne.x*ue.y-ne.y*ue.x>0;if(mt&&Ie>L){const at=q.dist($);if(at>2*O){const gt=q.sub(q.sub($)._mult(O/at)._round());this.updateDistance($,gt),this.addCurrentVertex(gt,ne,0,0,B),$=gt}}const tt=$&&W;let pt=tt?l:I?"butt":p;if(tt&&pt==="round"&&(We<v?pt="miter":We<=2&&(pt="fakeround")),pt==="miter"&&We>y&&(pt="bevel"),pt==="bevel"&&(We>2&&(pt="flipbevel"),We<y&&(pt="miter")),$&&this.updateDistance($,q),pt==="miter")De._mult(We),this.addCurrentVertex(q,De,0,0,B);else if(pt==="flipbevel"){if(We>100)De=ue.mult(-1);else{const at=We*ne.add(ue).mag()/ne.sub(ue).mag();De._perp()._mult(at*(dt?-1:1))}this.addCurrentVertex(q,De,0,0,B),this.addCurrentVertex(q,De.mult(-1),0,0,B)}else if(pt==="bevel"||pt==="fakeround"){const at=-Math.sqrt(We*We-1),gt=dt?at:0,nt=dt?0:at;if($&&this.addCurrentVertex(q,ne,gt,nt,B),pt==="fakeround"){const lt=Math.round(180*Ve/Math.PI/20);for(let Ft=1;Ft<lt;Ft++){let Bt=Ft/lt;if(Bt!==.5){const hi=Bt-.5;Bt+=Bt*hi*(Bt-1)*((1.0904+Fe*(Fe*(3.55645-1.43519*Fe)-3.2452))*hi*hi+(.848013+Fe*(.215638*Fe-1.06021)))}const ai=ue.sub(ne)._mult(Bt)._add(ne)._unit()._mult(dt?-1:1);this.addHalfVertex(q,ai.x,ai.y,!1,dt,0,B)}}W&&this.addCurrentVertex(q,ue,-gt,-nt,B)}else if(pt==="butt")this.addCurrentVertex(q,De,0,0,B);else if(pt==="square"){const at=$?1:-1;this.addCurrentVertex(q,De,at,at,B)}else pt==="round"&&($&&(this.addCurrentVertex(q,ne,0,0,B),this.addCurrentVertex(q,ne,1,1,B,!0)),W&&(this.addCurrentVertex(q,ue,-1,-1,B,!0),this.addCurrentVertex(q,ue,0,0,B)));if(mt&&Ie<k-1){const at=q.dist(W);if(at>2*O){const gt=q.add(W.sub(q)._mult(O/at)._round());this.updateDistance(q,gt),this.addCurrentVertex(gt,ue,0,0,B),q=gt}}}}addCurrentVertex(t,o,l,p,y,v=!1){const I=o.y*p-o.x,k=-o.y-o.x*p;this.addHalfVertex(t,o.x+o.y*l,o.y-o.x*l,v,!1,l,y),this.addHalfVertex(t,I,k,v,!0,-p,y),this.distance>Dp/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,o,l,p,y,v))}addHalfVertex({x:t,y:o},l,p,y,v,I,k){const L=.5*(this.lineClips?this.scaledDistance*(Dp-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(y?1:0),(o<<1)+(v?1:0),Math.round(63*l)+128,Math.round(63*p)+128,1+(I===0?0:I<0?-1:1)|(63&L)<<2,L>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const O=k.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,O),k.primitiveLength++),v?this.e2=O:this.e1=O}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,o){this.distance+=t.dist(o),this.updateScaledDistance()}}Lt("LineBucket",tp,{omit:["layers","patternFeatures"]});const Rp=new Tr({"line-cap":new Gt(st.layout_line["line-cap"]),"line-join":new At(st.layout_line["line-join"]),"line-miter-limit":new Gt(st.layout_line["line-miter-limit"]),"line-round-limit":new Gt(st.layout_line["line-round-limit"]),"line-sort-key":new At(st.layout_line["line-sort-key"])});var Bp={paint:new Tr({"line-opacity":new At(st.paint_line["line-opacity"]),"line-color":new At(st.paint_line["line-color"]),"line-translate":new Gt(st.paint_line["line-translate"]),"line-translate-anchor":new Gt(st.paint_line["line-translate-anchor"]),"line-width":new At(st.paint_line["line-width"]),"line-gap-width":new At(st.paint_line["line-gap-width"]),"line-offset":new At(st.paint_line["line-offset"]),"line-blur":new At(st.paint_line["line-blur"]),"line-dasharray":new Gn(st.paint_line["line-dasharray"]),"line-pattern":new lo(st.paint_line["line-pattern"]),"line-gradient":new an(st.paint_line["line-gradient"])}),layout:Rp};const Op=new class extends At{possiblyEvaluate(i,t){return t=new mr(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(i,t)}evaluate(i,t,o,l){return t=et({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(i,t,o,l)}}(Bp.paint.properties["line-width"].specification);function cc(i,t){return t>0?t+2*i:i}Op.useIntegerZoom=!0;const Fp=zt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Up=zt([{name:"a_projected_pos",components:3,type:"Float32"}],4);zt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const fh=zt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);zt([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const gr=zt([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Vp=zt([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function fl(i,t,o){return i.sections.forEach(l=>{l.text=function(p,y,v){const I=y.layout.get("text-transform").evaluate(v,{});return I==="uppercase"?p=p.toLocaleUpperCase():I==="lowercase"&&(p=p.toLocaleLowerCase()),Sr.applyArabicShaping&&(p=Sr.applyArabicShaping(p)),p}(l.text,t,o)}),i}zt([{name:"triangle",components:3,type:"Uint16"}]),zt([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),zt([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),zt([{type:"Float32",name:"offsetX"}]),zt([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Fs={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var Xn=24,ip=xr,Np=function(i,t,o,l,p){var y,v,I=8*p-l-1,k=(1<<I)-1,L=k>>1,O=-7,B=o?p-1:0,q=o?-1:1,$=i[t+B];for(B+=q,y=$&(1<<-O)-1,$>>=-O,O+=I;O>0;y=256*y+i[t+B],B+=q,O-=8);for(v=y&(1<<-O)-1,y>>=-O,O+=l;O>0;v=256*v+i[t+B],B+=q,O-=8);if(y===0)y=1-L;else{if(y===k)return v?NaN:1/0*($?-1:1);v+=Math.pow(2,l),y-=L}return($?-1:1)*v*Math.pow(2,y-l)},jp=function(i,t,o,l,p,y){var v,I,k,L=8*y-p-1,O=(1<<L)-1,B=O>>1,q=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,$=l?0:y-1,W=l?1:-1,ne=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(I=isNaN(t)?1:0,v=O):(v=Math.floor(Math.log(t)/Math.LN2),t*(k=Math.pow(2,-v))<1&&(v--,k*=2),(t+=v+B>=1?q/k:q*Math.pow(2,1-B))*k>=2&&(v++,k/=2),v+B>=O?(I=0,v=O):v+B>=1?(I=(t*k-1)*Math.pow(2,p),v+=B):(I=t*Math.pow(2,B-1)*Math.pow(2,p),v=0));p>=8;i[o+$]=255&I,$+=W,I/=256,p-=8);for(v=v<<p|I,L+=p;L>0;i[o+$]=255&v,$+=W,v/=256,L-=8);i[o+$-W]|=128*ne};function xr(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}xr.Varint=0,xr.Fixed64=1,xr.Bytes=2,xr.Fixed32=5;var Zl,rp=4294967296,qp=1/rp,Gp=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function ml(i){return i.type===xr.Bytes?i.readVarint()+i.pos:i.pos+1}function gl(i,t,o){return o?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function ku(i,t,o){var l=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));o.realloc(l);for(var p=o.pos-1;p>=i;p--)o.buf[p+l]=o.buf[p]}function Zp(i,t){for(var o=0;o<i.length;o++)t.writeVarint(i[o])}function of(i,t){for(var o=0;o<i.length;o++)t.writeSVarint(i[o])}function af(i,t){for(var o=0;o<i.length;o++)t.writeFloat(i[o])}function sf(i,t){for(var o=0;o<i.length;o++)t.writeDouble(i[o])}function Xp(i,t){for(var o=0;o<i.length;o++)t.writeBoolean(i[o])}function mh(i,t){for(var o=0;o<i.length;o++)t.writeFixed32(i[o])}function Rc(i,t){for(var o=0;o<i.length;o++)t.writeSFixed32(i[o])}function Bc(i,t){for(var o=0;o<i.length;o++)t.writeFixed64(i[o])}function ua(i,t){for(var o=0;o<i.length;o++)t.writeSFixed64(i[o])}function yl(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function vn(i,t,o){i[o]=t,i[o+1]=t>>>8,i[o+2]=t>>>16,i[o+3]=t>>>24}function Oc(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}function gh(i,t,o){i===1&&o.readMessage(Zo,t)}function Zo(i,t,o){if(i===3){const{id:l,bitmap:p,width:y,height:v,left:I,top:k,advance:L}=o.readMessage($p,{});t.push({id:l,bitmap:new Ic({width:y+6,height:v+6},p),metrics:{width:y,height:v,left:I,top:k,advance:L}})}}function $p(i,t,o){i===1?t.id=o.readVarint():i===2?t.bitmap=o.readBytes():i===3?t.width=o.readVarint():i===4?t.height=o.readVarint():i===5?t.left=o.readSVarint():i===6?t.top=o.readSVarint():i===7&&(t.advance=o.readVarint())}function np(i){let t=0,o=0;for(const v of i)t+=v.w*v.h,o=Math.max(o,v.w);i.sort((v,I)=>I.h-v.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),o),h:1/0}];let p=0,y=0;for(const v of i)for(let I=l.length-1;I>=0;I--){const k=l[I];if(!(v.w>k.w||v.h>k.h)){if(v.x=k.x,v.y=k.y,y=Math.max(y,v.y+v.h),p=Math.max(p,v.x+v.w),v.w===k.w&&v.h===k.h){const L=l.pop();I<l.length&&(l[I]=L)}else v.h===k.h?(k.x+=v.w,k.w-=v.w):v.w===k.w?(k.y+=v.h,k.h-=v.h):(l.push({x:k.x+v.w,y:k.y,w:k.w-v.w,h:v.h}),k.y+=v.h,k.h-=v.h);break}}return{w:p,h:y,fill:t/(p*y)||0}}xr.prototype={destroy:function(){this.buf=null},readFields:function(i,t,o){for(o=o||this.length;this.pos<o;){var l=this.readVarint(),p=l>>3,y=this.pos;this.type=7&l,i(p,t,this),this.pos===y&&this.skip(l)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=yl(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Oc(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=yl(this.buf,this.pos)+yl(this.buf,this.pos+4)*rp;return this.pos+=8,i},readSFixed64:function(){var i=yl(this.buf,this.pos)+Oc(this.buf,this.pos+4)*rp;return this.pos+=8,i},readFloat:function(){var i=Np(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Np(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,o,l=this.buf;return t=127&(o=l[this.pos++]),o<128?t:(t|=(127&(o=l[this.pos++]))<<7,o<128?t:(t|=(127&(o=l[this.pos++]))<<14,o<128?t:(t|=(127&(o=l[this.pos++]))<<21,o<128?t:function(p,y,v){var I,k,L=v.buf;if(I=(112&(k=L[v.pos++]))>>4,k<128||(I|=(127&(k=L[v.pos++]))<<3,k<128)||(I|=(127&(k=L[v.pos++]))<<10,k<128)||(I|=(127&(k=L[v.pos++]))<<17,k<128)||(I|=(127&(k=L[v.pos++]))<<24,k<128)||(I|=(1&(k=L[v.pos++]))<<31,k<128))return gl(p,I,y);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(o=l[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&Gp?function(o,l,p){return Gp.decode(o.subarray(l,p))}(this.buf,t,i):function(o,l,p){for(var y="",v=l;v<p;){var I,k,L,O=o[v],B=null,q=O>239?4:O>223?3:O>191?2:1;if(v+q>p)break;q===1?O<128&&(B=O):q===2?(192&(I=o[v+1]))==128&&(B=(31&O)<<6|63&I)<=127&&(B=null):q===3?(k=o[v+2],(192&(I=o[v+1]))==128&&(192&k)==128&&((B=(15&O)<<12|(63&I)<<6|63&k)<=2047||B>=55296&&B<=57343)&&(B=null)):q===4&&(k=o[v+2],L=o[v+3],(192&(I=o[v+1]))==128&&(192&k)==128&&(192&L)==128&&((B=(15&O)<<18|(63&I)<<12|(63&k)<<6|63&L)<=65535||B>=1114112)&&(B=null)),B===null?(B=65533,q=1):B>65535&&(B-=65536,y+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),y+=String.fromCharCode(B),v+=q}return y}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==xr.Bytes)return i.push(this.readVarint(t));var o=ml(this);for(i=i||[];this.pos<o;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==xr.Bytes)return i.push(this.readSVarint());var t=ml(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==xr.Bytes)return i.push(this.readBoolean());var t=ml(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==xr.Bytes)return i.push(this.readFloat());var t=ml(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==xr.Bytes)return i.push(this.readDouble());var t=ml(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==xr.Bytes)return i.push(this.readFixed32());var t=ml(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==xr.Bytes)return i.push(this.readSFixed32());var t=ml(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==xr.Bytes)return i.push(this.readFixed64());var t=ml(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==xr.Bytes)return i.push(this.readSFixed64());var t=ml(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===xr.Varint)for(;this.buf[this.pos++]>127;);else if(t===xr.Bytes)this.pos=this.readVarint()+this.pos;else if(t===xr.Fixed32)this.pos+=4;else{if(t!==xr.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var o=new Uint8Array(t);o.set(this.buf),this.buf=o,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),vn(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),vn(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),vn(this.buf,-1&i,this.pos),vn(this.buf,Math.floor(i*qp),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),vn(this.buf,-1&i,this.pos),vn(this.buf,Math.floor(i*qp),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,o){var l,p;if(t>=0?(l=t%4294967296|0,p=t/4294967296|0):(p=~(-t/4294967296),4294967295^(l=~(-t%4294967296))?l=l+1|0:(l=0,p=p+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),function(y,v,I){I.buf[I.pos++]=127&y|128,y>>>=7,I.buf[I.pos++]=127&y|128,y>>>=7,I.buf[I.pos++]=127&y|128,y>>>=7,I.buf[I.pos++]=127&y|128,I.buf[I.pos]=127&(y>>>=7)}(l,0,o),function(y,v){var I=(7&y)<<4;v.buf[v.pos++]|=I|((y>>>=3)?128:0),y&&(v.buf[v.pos++]=127&y|((y>>>=7)?128:0),y&&(v.buf[v.pos++]=127&y|((y>>>=7)?128:0),y&&(v.buf[v.pos++]=127&y|((y>>>=7)?128:0),y&&(v.buf[v.pos++]=127&y|((y>>>=7)?128:0),y&&(v.buf[v.pos++]=127&y)))))}(p,o)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(l,p,y){for(var v,I,k=0;k<p.length;k++){if((v=p.charCodeAt(k))>55295&&v<57344){if(!I){v>56319||k+1===p.length?(l[y++]=239,l[y++]=191,l[y++]=189):I=v;continue}if(v<56320){l[y++]=239,l[y++]=191,l[y++]=189,I=v;continue}v=I-55296<<10|v-56320|65536,I=null}else I&&(l[y++]=239,l[y++]=191,l[y++]=189,I=null);v<128?l[y++]=v:(v<2048?l[y++]=v>>6|192:(v<65536?l[y++]=v>>12|224:(l[y++]=v>>18|240,l[y++]=v>>12&63|128),l[y++]=v>>6&63|128),l[y++]=63&v|128)}return y}(this.buf,i,this.pos);var o=this.pos-t;o>=128&&ku(t,o,this),this.pos=t-1,this.writeVarint(o),this.pos+=o},writeFloat:function(i){this.realloc(4),jp(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),jp(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var o=0;o<t;o++)this.buf[this.pos++]=i[o]},writeRawMessage:function(i,t){this.pos++;var o=this.pos;i(t,this);var l=this.pos-o;l>=128&&ku(o,l,this),this.pos=o-1,this.writeVarint(l),this.pos+=l},writeMessage:function(i,t,o){this.writeTag(i,xr.Bytes),this.writeRawMessage(t,o)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,Zp,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,of,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,Xp,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,af,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,sf,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,mh,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,Rc,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,Bc,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,ua,t)},writeBytesField:function(i,t){this.writeTag(i,xr.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,xr.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,xr.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,xr.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,xr.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,xr.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,xr.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,xr.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,xr.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,xr.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,Boolean(t))}};class op{constructor(t,{pixelRatio:o,version:l,stretchX:p,stretchY:y,content:v}){this.paddedRect=t,this.pixelRatio=o,this.stretchX=p,this.stretchY=y,this.content=v,this.version=l}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class ap{constructor(t,o){const l={},p={};this.haveRenderCallbacks=[];const y=[];this.addImages(t,l,y),this.addImages(o,p,y);const{w:v,h:I}=np(y),k=new Pa({width:v||1,height:I||1});for(const L in t){const O=t[L],B=l[L].paddedRect;Pa.copy(O.data,k,{x:0,y:0},{x:B.x+1,y:B.y+1},O.data)}for(const L in o){const O=o[L],B=p[L].paddedRect,q=B.x+1,$=B.y+1,W=O.data.width,ne=O.data.height;Pa.copy(O.data,k,{x:0,y:0},{x:q,y:$},O.data),Pa.copy(O.data,k,{x:0,y:ne-1},{x:q,y:$-1},{width:W,height:1}),Pa.copy(O.data,k,{x:0,y:0},{x:q,y:$+ne},{width:W,height:1}),Pa.copy(O.data,k,{x:W-1,y:0},{x:q-1,y:$},{width:1,height:ne}),Pa.copy(O.data,k,{x:0,y:0},{x:q+W,y:$},{width:1,height:ne})}this.image=k,this.iconPositions=l,this.patternPositions=p}addImages(t,o,l){for(const p in t){const y=t[p],v={x:0,y:0,w:y.data.width+2,h:y.data.height+2};l.push(v),o[p]=new op(v,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(t,o){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in t.updatedImages)this.patchUpdatedImage(this.iconPositions[l],t.getImage(l),o),this.patchUpdatedImage(this.patternPositions[l],t.getImage(l),o)}patchUpdatedImage(t,o,l){if(!t||!o||t.version===o.version)return;t.version=o.version;const[p,y]=t.tl;l.update(o.data,void 0,{x:p,y})}}Lt("ImagePosition",op),Lt("ImageAtlas",ap),g.WritingMode=void 0,(Zl=g.WritingMode||(g.WritingMode={}))[Zl.none=0]="none",Zl[Zl.horizontal=1]="horizontal",Zl[Zl.vertical=2]="vertical",Zl[Zl.horizontalOnly=3]="horizontalOnly";const hc=-17;class Mu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,o){const l=new Mu;return l.scale=t||1,l.fontStack=o,l}static forImage(t){const o=new Mu;return o.imageName=t,o}}class pc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,o){const l=new pc;for(let p=0;p<t.sections.length;p++){const y=t.sections[p];y.image?l.addImageSection(y):l.addTextSection(y,o)}return l}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let o="";for(let l=0;l<t.length;l++){const p=t.charCodeAt(l+1)||null,y=t.charCodeAt(l-1)||null;o+=p&&Ds(p)&&!Fs[t[l+1]]||y&&Ds(y)&&!Fs[t[l-1]]||!Fs[t[l]]?t[l]:Fs[t[l]]}return o}(this.text)}trim(){let t=0;for(let l=0;l<this.text.length&&_l[this.text.charCodeAt(l)];l++)t++;let o=this.text.length;for(let l=this.text.length-1;l>=0&&l>=t&&_l[this.text.charCodeAt(l)];l--)o--;this.text=this.text.substring(t,o),this.sectionIndex=this.sectionIndex.slice(t,o)}substring(t,o){const l=new pc;return l.text=this.text.substring(t,o),l.sectionIndex=this.sectionIndex.slice(t,o),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,o)=>Math.max(t,this.sections[o].scale),0)}addTextSection(t,o){this.text+=t.text,this.sections.push(Mu.forText(t.scale,t.fontStack||o));const l=this.sections.length-1;for(let p=0;p<t.text.length;++p)this.sectionIndex.push(l)}addImageSection(t){const o=t.image?t.image.name:"";if(o.length===0)return void qt("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(Mu.forImage(o)),this.sectionIndex.push(this.sections.length-1)):qt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Fc(i,t,o,l,p,y,v,I,k,L,O,B,q,$,W,ne){const ue=pc.fromFeature(i,p);let Ie;B===g.WritingMode.vertical&&ue.verticalizePunctuation();const{processBidirectionalText:De,processStyledBidirectionalText:Fe}=Sr;if(De&&ue.sections.length===1){Ie=[];const Ve=De(ue.toString(),yh(ue,L,y,t,l,$,W));for(const mt of Ve){const dt=new pc;dt.text=mt,dt.sections=ue.sections;for(let tt=0;tt<mt.length;tt++)dt.sectionIndex.push(0);Ie.push(dt)}}else if(Fe){Ie=[];const Ve=Fe(ue.text,ue.sectionIndex,yh(ue,L,y,t,l,$,W));for(const mt of Ve){const dt=new pc;dt.text=mt[0],dt.sectionIndex=mt[1],dt.sections=ue.sections,Ie.push(dt)}}else Ie=function(Ve,mt){const dt=[],tt=Ve.text;let pt=0;for(const at of mt)dt.push(Ve.substring(pt,at)),pt=at;return pt<tt.length&&dt.push(Ve.substring(pt,tt.length)),dt}(ue,yh(ue,L,y,t,l,$,W));const Ue=[],We={positionedLines:Ue,text:ue.toString(),top:O[1],bottom:O[1],left:O[0],right:O[0],writingMode:B,iconsInText:!1,verticalizable:!1};return function(Ve,mt,dt,tt,pt,at,gt,nt,lt,Ft,Bt,ai){let hi=0,Ti=hc,Li=0,$i=0;const Hi=nt==="right"?1:nt==="left"?0:.5;let Ui=0;for(const bi of pt){bi.trim();const Ai=bi.getMaxScale(),vi=(Ai-1)*Xn,yr={positionedGlyphs:[],lineOffset:0};Ve.positionedLines[Ui]=yr;const dr=yr.positionedGlyphs;let Bi=0;if(!bi.length()){Ti+=at,++Ui;continue}for(let Yi=0;Yi<bi.length();Yi++){const Ht=bi.getSection(Yi),bn=bi.getSectionIndex(Yi),br=bi.getCharCode(Yi);let Zr=0,nr=null,$n=null,Pn=null,ca=Xn;const mo=!(lt===g.WritingMode.horizontal||!Bt&&!Er(br)||Bt&&(_l[br]||(Qi=br,Vt.Arabic(Qi)||Vt["Arabic Supplement"](Qi)||Vt["Arabic Extended-A"](Qi)||Vt["Arabic Presentation Forms-A"](Qi)||Vt["Arabic Presentation Forms-B"](Qi))));if(Ht.imageName){const go=tt[Ht.imageName];if(!go)continue;Pn=Ht.imageName,Ve.iconsInText=Ve.iconsInText||!0,$n=go.paddedRect;const wn=go.displaySize;Ht.scale=Ht.scale*Xn/ai,nr={width:wn[0],height:wn[1],left:1,top:-3,advance:mo?wn[1]:wn[0]},Zr=vi+(Xn-wn[1]*Ht.scale),ca=nr.advance;const ha=mo?wn[0]*Ht.scale-Xn*Ai:wn[1]*Ht.scale-Xn*Ai;ha>0&&ha>Bi&&(Bi=ha)}else{const go=dt[Ht.fontStack],wn=go&&go[br];if(wn&&wn.rect)$n=wn.rect,nr=wn.metrics;else{const ha=mt[Ht.fontStack],Yl=ha&&ha[br];if(!Yl)continue;nr=Yl.metrics}Zr=(Ai-Ht.scale)*Xn}mo?(Ve.verticalizable=!0,dr.push({glyph:br,imageName:Pn,x:hi,y:Ti+Zr,vertical:mo,scale:Ht.scale,fontStack:Ht.fontStack,sectionIndex:bn,metrics:nr,rect:$n}),hi+=ca*Ht.scale+Ft):(dr.push({glyph:br,imageName:Pn,x:hi,y:Ti+Zr,vertical:mo,scale:Ht.scale,fontStack:Ht.fontStack,sectionIndex:bn,metrics:nr,rect:$n}),hi+=nr.advance*Ht.scale+Ft)}dr.length!==0&&(Li=Math.max(hi-Ft,Li),uf(dr,0,dr.length-1,Hi,Bi)),hi=0;const Pi=at*Ai+Bi;yr.lineOffset=Math.max(Bi,vi),Ti+=Pi,$i=Math.max(Pi,$i),++Ui}var Qi;const Vi=Ti-hc,{horizontalAlign:er,verticalAlign:mi}=_h(gt);(function(bi,Ai,vi,yr,dr,Bi,Pi,Yi,Ht){const bn=(Ai-vi)*dr;let br=0;br=Bi!==Pi?-Yi*yr-hc:(-yr*Ht+.5)*Pi;for(const Zr of bi)for(const nr of Zr.positionedGlyphs)nr.x+=bn,nr.y+=br})(Ve.positionedLines,Hi,er,mi,Li,$i,at,Vi,pt.length),Ve.top+=-mi*Vi,Ve.bottom=Ve.top+Vi,Ve.left+=-er*Li,Ve.right=Ve.left+Li}(We,t,o,l,Ie,v,I,k,B,L,q,ne),!function(Ve){for(const mt of Ve)if(mt.positionedGlyphs.length!==0)return!1;return!0}(Ue)&&We}const _l={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},sp={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function lp(i,t,o,l,p,y){if(t.imageName){const v=l[t.imageName];return v?v.displaySize[0]*t.scale*Xn/y+p:0}{const v=o[t.fontStack],I=v&&v[i];return I?I.metrics.advance*t.scale+p:0}}function up(i,t,o,l){const p=Math.pow(i-t,2);return l?i<t?p/2:2*p:p+Math.abs(o)*o}function lf(i,t,o){let l=0;return i===10&&(l-=1e4),o&&(l+=150),i!==40&&i!==65288||(l+=50),t!==41&&t!==65289||(l+=50),l}function cp(i,t,o,l,p,y){let v=null,I=up(t,o,p,y);for(const k of l){const L=up(t-k.x,o,p,y)+k.badness;L<=I&&(v=k,I=L)}return{index:i,x:t,priorBreak:v,badness:I}}function hp(i){return i?hp(i.priorBreak).concat(i.index):[]}function yh(i,t,o,l,p,y,v){if(y!=="point")return[];if(!i)return[];const I=[],k=function(q,$,W,ne,ue,Ie){let De=0;for(let Fe=0;Fe<q.length();Fe++){const Ue=q.getSection(Fe);De+=lp(q.getCharCode(Fe),Ue,ne,ue,$,Ie)}return De/Math.max(1,Math.ceil(De/W))}(i,t,o,l,p,v),L=i.text.indexOf("\u200B")>=0;let O=0;for(let q=0;q<i.length();q++){const $=i.getSection(q),W=i.getCharCode(q);if(_l[W]||(O+=lp(W,$,l,p,t,v)),q<i.length()-1){const ne=!((B=W)<11904||!(Vt["Bopomofo Extended"](B)||Vt.Bopomofo(B)||Vt["CJK Compatibility Forms"](B)||Vt["CJK Compatibility Ideographs"](B)||Vt["CJK Compatibility"](B)||Vt["CJK Radicals Supplement"](B)||Vt["CJK Strokes"](B)||Vt["CJK Symbols and Punctuation"](B)||Vt["CJK Unified Ideographs Extension A"](B)||Vt["CJK Unified Ideographs"](B)||Vt["Enclosed CJK Letters and Months"](B)||Vt["Halfwidth and Fullwidth Forms"](B)||Vt.Hiragana(B)||Vt["Ideographic Description Characters"](B)||Vt["Kangxi Radicals"](B)||Vt["Katakana Phonetic Extensions"](B)||Vt.Katakana(B)||Vt["Vertical Forms"](B)||Vt["Yi Radicals"](B)||Vt["Yi Syllables"](B)));(sp[W]||ne||$.imageName)&&I.push(cp(q+1,O,k,I,lf(W,i.getCharCode(q+1),ne&&L),!1))}}var B;return hp(cp(i.length(),O,k,I,0,!0))}function _h(i){let t=.5,o=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:t,verticalAlign:o}}function uf(i,t,o,l,p){if(!l&&!p)return;const y=i[o],v=(i[o].x+y.metrics.advance*y.scale)*l;for(let I=t;I<=o;I++)i[I].x-=v,i[I].y+=p}function cf(i,t,o){const{horizontalAlign:l,verticalAlign:p}=_h(o),y=t[0]-i.displaySize[0]*l,v=t[1]-i.displaySize[1]*p;return{image:i,top:v,bottom:v+i.displaySize[1],left:y,right:y+i.displaySize[0]}}function pp(i,t,o,l,p,y){const v=i.image;let I;if(v.content){const ue=v.content,Ie=v.pixelRatio||1;I=[ue[0]/Ie,ue[1]/Ie,v.displaySize[0]-ue[2]/Ie,v.displaySize[1]-ue[3]/Ie]}const k=t.left*y,L=t.right*y;let O,B,q,$;o==="width"||o==="both"?($=p[0]+k-l[3],B=p[0]+L+l[1]):($=p[0]+(k+L-v.displaySize[0])/2,B=$+v.displaySize[0]);const W=t.top*y,ne=t.bottom*y;return o==="height"||o==="both"?(O=p[1]+W-l[0],q=p[1]+ne+l[2]):(O=p[1]+(W+ne-v.displaySize[1])/2,q=O+v.displaySize[1]),{image:v,top:O,right:B,bottom:q,left:$,collisionPadding:I}}const Us=128;function Uc(i,t){const{expression:o}=t;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new mr(i+1))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:p}=o;let y=0;for(;y<l.length&&l[y]<=i;)y++;y=Math.max(0,y-1);let v=y;for(;v<l.length&&l[v]<i+1;)v++;v=Math.min(l.length-1,v);const I=l[y],k=l[v];return o.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:k,interpolationType:p}:{kind:"camera",minZoom:I,maxZoom:k,minSize:o.evaluate(new mr(I)),maxSize:o.evaluate(new mr(k)),interpolationType:p}}}class vl extends ii{constructor(t,o,l,p){super(t,o),this.angle=l,p!==void 0&&(this.segment=p)}clone(){return new vl(this.x,this.y,this.angle,this.segment)}}function Vc(i,t,o,l,p){if(t.segment===void 0)return!0;let y=t,v=t.segment+1,I=0;for(;I>-o/2;){if(v--,v<0)return!1;I-=i[v].dist(y),y=i[v]}I+=i[v].dist(i[v+1]),v++;const k=[];let L=0;for(;I<o/2;){const O=i[v],B=i[v+1];if(!B)return!1;let q=i[v-1].angleTo(O)-O.angleTo(B);for(q=Math.abs((q+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:I,angleDelta:q}),L+=q;I-k[0].distance>l;)L-=k.shift().angleDelta;if(L>p)return!1;v++,I+=O.dist(B)}return!0}function Nc(i){let t=0;for(let o=0;o<i.length-1;o++)t+=i[o].dist(i[o+1]);return t}function jc(i,t,o){return i?.6*t*o:0}function Lu(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function hf(i,t,o,l,p,y){const v=jc(o,p,y),I=Lu(o,l)*y;let k=0;const L=Nc(i)/2;for(let O=0;O<i.length-1;O++){const B=i[O],q=i[O+1],$=B.dist(q);if(k+$>L){const W=(L-k)/$,ne=on(B.x,q.x,W),ue=on(B.y,q.y,W),Ie=new vl(ne,ue,q.angleTo(B),O);return Ie._round(),!v||Vc(i,Ie,I,v,t)?Ie:void 0}k+=$}}function pf(i,t,o,l,p,y,v,I,k){const L=jc(l,y,v),O=Lu(l,p),B=O*v,q=i[0].x===0||i[0].x===k||i[0].y===0||i[0].y===k;return t-B<t/4&&(t=B+t/4),Hp(i,q?t/2*I%t:(O/2+2*y)*v*I%t,t,L,o,B,q,!1,k)}function Hp(i,t,o,l,p,y,v,I,k){const L=y/2,O=Nc(i);let B=0,q=t-o,$=[];for(let W=0;W<i.length-1;W++){const ne=i[W],ue=i[W+1],Ie=ne.dist(ue),De=ue.angleTo(ne);for(;q+o<B+Ie;){q+=o;const Fe=(q-B)/Ie,Ue=on(ne.x,ue.x,Fe),We=on(ne.y,ue.y,Fe);if(Ue>=0&&Ue<k&&We>=0&&We<k&&q-L>=0&&q+L<=O){const Ve=new vl(Ue,We,De,W);Ve._round(),l&&!Vc(i,Ve,y,l,p)||$.push(Ve)}}B+=Ie}return I||$.length||v||($=Hp(i,B/2,o,l,p,y,v,!0,k)),$}function Du(i,t,o,l,p){const y=[];for(let v=0;v<i.length;v++){const I=i[v];let k;for(let L=0;L<I.length-1;L++){let O=I[L],B=I[L+1];O.x<t&&B.x<t||(O.x<t?O=new ii(t,O.y+(t-O.x)/(B.x-O.x)*(B.y-O.y))._round():B.x<t&&(B=new ii(t,O.y+(t-O.x)/(B.x-O.x)*(B.y-O.y))._round()),O.y<o&&B.y<o||(O.y<o?O=new ii(O.x+(o-O.y)/(B.y-O.y)*(B.x-O.x),o)._round():B.y<o&&(B=new ii(O.x+(o-O.y)/(B.y-O.y)*(B.x-O.x),o)._round()),O.x>=l&&B.x>=l||(O.x>=l?O=new ii(l,O.y+(l-O.x)/(B.x-O.x)*(B.y-O.y))._round():B.x>=l&&(B=new ii(l,O.y+(l-O.x)/(B.x-O.x)*(B.y-O.y))._round()),O.y>=p&&B.y>=p||(O.y>=p?O=new ii(O.x+(p-O.y)/(B.y-O.y)*(B.x-O.x),p)._round():B.y>=p&&(B=new ii(O.x+(p-O.y)/(B.y-O.y)*(B.x-O.x),p)._round()),k&&O.equals(k[k.length-1])||(k=[O],y.push(k)),k.push(B)))))}}return y}function vh(i,t,o,l){const p=[],y=i.image,v=y.pixelRatio,I=y.paddedRect.w-2,k=y.paddedRect.h-2,L=i.right-i.left,O=i.bottom-i.top,B=y.stretchX||[[0,I]],q=y.stretchY||[[0,k]],$=(at,gt)=>at+gt[1]-gt[0],W=B.reduce($,0),ne=q.reduce($,0),ue=I-W,Ie=k-ne;let De=0,Fe=W,Ue=0,We=ne,Ve=0,mt=ue,dt=0,tt=Ie;if(y.content&&l){const at=y.content;De=qc(B,0,at[0]),Ue=qc(q,0,at[1]),Fe=qc(B,at[0],at[2]),We=qc(q,at[1],at[3]),Ve=at[0]-De,dt=at[1]-Ue,mt=at[2]-at[0]-Fe,tt=at[3]-at[1]-We}const pt=(at,gt,nt,lt)=>{const Ft=Gc(at.stretch-De,Fe,L,i.left),Bt=Zc(at.fixed-Ve,mt,at.stretch,W),ai=Gc(gt.stretch-Ue,We,O,i.top),hi=Zc(gt.fixed-dt,tt,gt.stretch,ne),Ti=Gc(nt.stretch-De,Fe,L,i.left),Li=Zc(nt.fixed-Ve,mt,nt.stretch,W),$i=Gc(lt.stretch-Ue,We,O,i.top),Hi=Zc(lt.fixed-dt,tt,lt.stretch,ne),Ui=new ii(Ft,ai),Qi=new ii(Ti,ai),Vi=new ii(Ti,$i),er=new ii(Ft,$i),mi=new ii(Bt/v,hi/v),bi=new ii(Li/v,Hi/v),Ai=t*Math.PI/180;if(Ai){const dr=Math.sin(Ai),Bi=Math.cos(Ai),Pi=[Bi,-dr,dr,Bi];Ui._matMult(Pi),Qi._matMult(Pi),er._matMult(Pi),Vi._matMult(Pi)}const vi=at.stretch+at.fixed,yr=gt.stretch+gt.fixed;return{tl:Ui,tr:Qi,bl:er,br:Vi,tex:{x:y.paddedRect.x+1+vi,y:y.paddedRect.y+1+yr,w:nt.stretch+nt.fixed-vi,h:lt.stretch+lt.fixed-yr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:mi,pixelOffsetBR:bi,minFontScaleX:mt/v/L,minFontScaleY:tt/v/O,isSDF:o}};if(l&&(y.stretchX||y.stretchY)){const at=xh(B,ue,W),gt=xh(q,Ie,ne);for(let nt=0;nt<at.length-1;nt++){const lt=at[nt],Ft=at[nt+1];for(let Bt=0;Bt<gt.length-1;Bt++)p.push(pt(lt,gt[Bt],Ft,gt[Bt+1]))}}else p.push(pt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:k+1}));return p}function qc(i,t,o){let l=0;for(const p of i)l+=Math.max(t,Math.min(o,p[1]))-Math.max(t,Math.min(o,p[0]));return l}function xh(i,t,o){const l=[{fixed:-1,stretch:0}];for(const[p,y]of i){const v=l[l.length-1];l.push({fixed:p-v.stretch,stretch:v.stretch}),l.push({fixed:p-v.stretch,stretch:v.stretch+(y-p)})}return l.push({fixed:t+1,stretch:o}),l}function Gc(i,t,o,l){return i/t*o+l}function Zc(i,t,o,l){return i-t*o/l}Lt("Anchor",vl);class bh{constructor(t,o,l,p,y,v,I,k,L,O){if(this.boxStartIndex=t.length,L){let B=v.top,q=v.bottom;const $=v.collisionPadding;$&&(B-=$[1],q+=$[3]);let W=q-B;W>0&&(W=Math.max(10,W),this.circleDiameter=W)}else{let B=v.top*I-k,q=v.bottom*I+k,$=v.left*I-k,W=v.right*I+k;const ne=v.collisionPadding;if(ne&&($-=ne[0]*I,B-=ne[1]*I,W+=ne[2]*I,q+=ne[3]*I),O){const ue=new ii($,B),Ie=new ii(W,B),De=new ii($,q),Fe=new ii(W,q),Ue=O*Math.PI/180;ue._rotate(Ue),Ie._rotate(Ue),De._rotate(Ue),Fe._rotate(Ue),$=Math.min(ue.x,Ie.x,De.x,Fe.x),W=Math.max(ue.x,Ie.x,De.x,Fe.x),B=Math.min(ue.y,Ie.y,De.y,Fe.y),q=Math.max(ue.y,Ie.y,De.y,Fe.y)}t.emplaceBack(o.x,o.y,$,B,W,q,l,p,y)}this.boxEndIndex=t.length}}class df{constructor(t=[],o=ff){if(this.data=t,this.length=this.data.length,this.compare=o,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:o,compare:l}=this,p=o[t];for(;t>0;){const y=t-1>>1,v=o[y];if(l(p,v)>=0)break;o[t]=v,t=y}o[t]=p}_down(t){const{data:o,compare:l}=this,p=this.length>>1,y=o[t];for(;t<p;){let v=1+(t<<1),I=o[v];const k=v+1;if(k<this.length&&l(o[k],I)<0&&(v=k,I=o[k]),l(I,y)>=0)break;o[t]=I,t=v}o[t]=y}}function ff(i,t){return i<t?-1:i>t?1:0}function wh(i,t=1,o=!1){let l=1/0,p=1/0,y=-1/0,v=-1/0;const I=i[0];for(let $=0;$<I.length;$++){const W=I[$];(!$||W.x<l)&&(l=W.x),(!$||W.y<p)&&(p=W.y),(!$||W.x>y)&&(y=W.x),(!$||W.y>v)&&(v=W.y)}const k=Math.min(y-l,v-p);let L=k/2;const O=new df([],dp);if(k===0)return new ii(l,p);for(let $=l;$<y;$+=k)for(let W=p;W<v;W+=k)O.push(new dc($+L,W+L,L,i));let B=function($){let W=0,ne=0,ue=0;const Ie=$[0];for(let De=0,Fe=Ie.length,Ue=Fe-1;De<Fe;Ue=De++){const We=Ie[De],Ve=Ie[Ue],mt=We.x*Ve.y-Ve.x*We.y;ne+=(We.x+Ve.x)*mt,ue+=(We.y+Ve.y)*mt,W+=3*mt}return new dc(ne/W,ue/W,0,$)}(i),q=O.length;for(;O.length;){const $=O.pop();($.d>B.d||!B.d)&&(B=$,o&&console.log("found best %d after %d probes",Math.round(1e4*$.d)/1e4,q)),$.max-B.d<=t||(L=$.h/2,O.push(new dc($.p.x-L,$.p.y-L,L,i)),O.push(new dc($.p.x+L,$.p.y-L,L,i)),O.push(new dc($.p.x-L,$.p.y+L,L,i)),O.push(new dc($.p.x+L,$.p.y+L,L,i)),q+=4)}return o&&(console.log(`num probes: ${q}`),console.log(`best distance: ${B.d}`)),B.p}function dp(i,t){return t.max-i.max}function dc(i,t,o,l){this.p=new ii(i,t),this.h=o,this.d=function(p,y){let v=!1,I=1/0;for(let k=0;k<y.length;k++){const L=y[k];for(let O=0,B=L.length,q=B-1;O<B;q=O++){const $=L[O],W=L[q];$.y>p.y!=W.y>p.y&&p.x<(W.x-$.x)*(p.y-$.y)/(W.y-$.y)+$.x&&(v=!v),I=Math.min(I,Ca(p,$,W))}}return(v?1:-1)*Math.sqrt(I)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}const Xl=Number.POSITIVE_INFINITY;function fc(i,t){return t[1]!==Xl?function(o,l,p){let y=0,v=0;switch(l=Math.abs(l),p=Math.abs(p),o){case"top-right":case"top-left":case"top":v=p-7;break;case"bottom-right":case"bottom-left":case"bottom":v=7-p}switch(o){case"top-right":case"bottom-right":case"right":y=-l;break;case"top-left":case"bottom-left":case"left":y=l}return[y,v]}(i,t[0],t[1]):function(o,l){let p=0,y=0;l<0&&(l=0);const v=l/Math.sqrt(2);switch(o){case"top-right":case"top-left":y=v-7;break;case"bottom-right":case"bottom-left":y=7-v;break;case"bottom":y=7-l;break;case"top":y=l-7}switch(o){case"top-right":case"bottom-right":p=-v;break;case"top-left":case"bottom-left":p=v;break;case"left":p=l;break;case"right":p=-l}return[p,y]}(i,t[0])}function rr(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function mf(i,t,o,l,p,y,v,I,k,L,O){let B=y.textMaxSize.evaluate(t,{});B===void 0&&(B=v);const q=i.layers[0].layout,$=q.get("icon-offset").evaluate(t,{},O),W=Wp(o.horizontal),ne=v/24,ue=i.tilePixelRatio*ne,Ie=i.tilePixelRatio*B/24,De=i.tilePixelRatio*I,Fe=i.tilePixelRatio*q.get("symbol-spacing"),Ue=q.get("text-padding")*i.tilePixelRatio,We=q.get("icon-padding")*i.tilePixelRatio,Ve=q.get("text-max-angle")/180*Math.PI,mt=q.get("text-rotation-alignment")!=="viewport"&&q.get("symbol-placement")!=="point",dt=q.get("icon-rotation-alignment")==="map"&&q.get("symbol-placement")!=="point",tt=q.get("symbol-placement"),pt=Fe/2,at=q.get("icon-text-fit");let gt;l&&at!=="none"&&(i.allowVerticalPlacement&&o.vertical&&(gt=pp(l,o.vertical,at,q.get("icon-text-fit-padding"),$,ne)),W&&(l=pp(l,W,at,q.get("icon-text-fit-padding"),$,ne)));const nt=(lt,Ft)=>{Ft.x<0||Ft.x>=Di||Ft.y<0||Ft.y>=Di||function(Bt,ai,hi,Ti,Li,$i,Hi,Ui,Qi,Vi,er,mi,bi,Ai,vi,yr,dr,Bi,Pi,Yi,Ht,bn,br,Zr,nr){const $n=Bt.addToLineVertexArray(ai,hi);let Pn,ca,mo,go,wn=0,ha=0,Yl=0,Fu=0,Uu=-1,_c=-1;const $a={};let Ns=bt(""),Vu=0,Ql=0;if(Ui._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Vu,Ql]=Ui.layout.get("text-offset").evaluate(Ht,{},Zr).map(yo=>yo*Xn):(Vu=Ui.layout.get("text-radial-offset").evaluate(Ht,{},Zr)*Xn,Ql=Xl),Bt.allowVerticalPlacement&&Ti.vertical){const yo=Ui.layout.get("text-rotate").evaluate(Ht,{},Zr)+90;mo=new bh(Qi,ai,Vi,er,mi,Ti.vertical,bi,Ai,vi,yo),Hi&&(go=new bh(Qi,ai,Vi,er,mi,Hi,dr,Bi,vi,yo))}if(Li){const yo=Ui.layout.get("icon-rotate").evaluate(Ht,{}),$o=Ui.layout.get("icon-text-fit")!=="none",wl=vh(Li,yo,br,$o),_s=Hi?vh(Hi,yo,br,$o):void 0;ca=new bh(Qi,ai,Vi,er,mi,Li,dr,Bi,!1,yo),wn=4*wl.length;const xc=Bt.iconSizeData;let Ha=null;xc.kind==="source"?(Ha=[Us*Ui.layout.get("icon-size").evaluate(Ht,{})],Ha[0]>Vs&&qt(`${Bt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):xc.kind==="composite"&&(Ha=[Us*bn.compositeIconSizes[0].evaluate(Ht,{},Zr),Us*bn.compositeIconSizes[1].evaluate(Ht,{},Zr)],(Ha[0]>Vs||Ha[1]>Vs)&&qt(`${Bt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Bt.addSymbols(Bt.icon,wl,Ha,Yi,Pi,Ht,g.WritingMode.none,ai,$n.lineStartIndex,$n.lineLength,-1,Zr),Uu=Bt.icon.placedSymbolArray.length-1,_s&&(ha=4*_s.length,Bt.addSymbols(Bt.icon,_s,Ha,Yi,Pi,Ht,g.WritingMode.vertical,ai,$n.lineStartIndex,$n.lineLength,-1,Zr),_c=Bt.icon.placedSymbolArray.length-1)}const bl=Object.keys(Ti.horizontal);for(const yo of bl){const $o=Ti.horizontal[yo];if(!Pn){Ns=bt($o.text);const _s=Ui.layout.get("text-rotate").evaluate(Ht,{},Zr);Pn=new bh(Qi,ai,Vi,er,mi,$o,bi,Ai,vi,_s)}const wl=$o.positionedLines.length===1;if(Yl+=Ru(Bt,ai,$o,$i,Ui,vi,Ht,yr,$n,Ti.vertical?g.WritingMode.horizontal:g.WritingMode.horizontalOnly,wl?bl:[yo],$a,Uu,bn,Zr),wl)break}Ti.vertical&&(Fu+=Ru(Bt,ai,Ti.vertical,$i,Ui,vi,Ht,yr,$n,g.WritingMode.vertical,["vertical"],$a,_c,bn,Zr));const vc=Pn?Pn.boxStartIndex:Bt.collisionBoxArray.length,Ch=Pn?Pn.boxEndIndex:Bt.collisionBoxArray.length,zh=mo?mo.boxStartIndex:Bt.collisionBoxArray.length,$c=mo?mo.boxEndIndex:Bt.collisionBoxArray.length,Hc=ca?ca.boxStartIndex:Bt.collisionBoxArray.length,Ph=ca?ca.boxEndIndex:Bt.collisionBoxArray.length,Wc=go?go.boxStartIndex:Bt.collisionBoxArray.length,Kc=go?go.boxEndIndex:Bt.collisionBoxArray.length;let Xo=-1;const Nu=(yo,$o)=>yo&&yo.circleDiameter?Math.max(yo.circleDiameter,$o):$o;Xo=Nu(Pn,Xo),Xo=Nu(mo,Xo),Xo=Nu(ca,Xo),Xo=Nu(go,Xo);const ju=Xo>-1?1:0;ju&&(Xo*=nr/Xn),Bt.glyphOffsetArray.length>=Bu.MAX_GLYPHS&&qt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ht.sortKey!==void 0&&Bt.addToSortKeyRanges(Bt.symbolInstances.length,Ht.sortKey),Bt.symbolInstances.emplaceBack(ai.x,ai.y,$a.right>=0?$a.right:-1,$a.center>=0?$a.center:-1,$a.left>=0?$a.left:-1,$a.vertical||-1,Uu,_c,Ns,vc,Ch,zh,$c,Hc,Ph,Wc,Kc,Vi,Yl,Fu,wn,ha,ju,0,bi,Vu,Ql,Xo)}(i,Ft,lt,o,l,p,gt,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,ue,Ue,mt,k,De,We,dt,$,t,y,L,O,v)};if(tt==="line")for(const lt of Du(t.geometry,0,0,Di,Di)){const Ft=pf(lt,Fe,Ve,o.vertical||W,l,24,Ie,i.overscaling,Di);for(const Bt of Ft){const ai=W;ai&&gf(i,ai.text,pt,Bt)||nt(lt,Bt)}}else if(tt==="line-center"){for(const lt of t.geometry)if(lt.length>1){const Ft=hf(lt,Ve,o.vertical||W,l,24,Ie);Ft&&nt(lt,Ft)}}else if(t.type==="Polygon")for(const lt of Dc(t.geometry,0)){const Ft=wh(lt,16);nt(lt[0],new vl(Ft.x,Ft.y,0))}else if(t.type==="LineString")for(const lt of t.geometry)nt(lt,new vl(lt[0].x,lt[0].y,0));else if(t.type==="Point")for(const lt of t.geometry)for(const Ft of lt)nt([Ft],new vl(Ft.x,Ft.y,0))}const Vs=32640;function Ru(i,t,o,l,p,y,v,I,k,L,O,B,q,$,W){const ne=function(De,Fe,Ue,We,Ve,mt,dt,tt){const pt=We.layout.get("text-rotate").evaluate(mt,{})*Math.PI/180,at=[];for(const gt of Fe.positionedLines)for(const nt of gt.positionedGlyphs){if(!nt.rect)continue;const lt=nt.rect||{};let Ft=4,Bt=!0,ai=1,hi=0;const Ti=(Ve||tt)&&nt.vertical,Li=nt.metrics.advance*nt.scale/2;if(tt&&Fe.verticalizable){const Pi=(nt.scale-1)*Xn,Yi=(Xn-nt.metrics.width*nt.scale)/2;hi=gt.lineOffset/2-(nt.imageName?-Yi:Pi)}if(nt.imageName){const Pi=dt[nt.imageName];Bt=Pi.sdf,ai=Pi.pixelRatio,Ft=1/ai}const $i=Ve?[nt.x+Li,nt.y]:[0,0];let Hi=Ve?[0,0]:[nt.x+Li+Ue[0],nt.y+Ue[1]-hi],Ui=[0,0];Ti&&(Ui=Hi,Hi=[0,0]);const Qi=(nt.metrics.left-Ft)*nt.scale-Li+Hi[0],Vi=(-nt.metrics.top-Ft)*nt.scale+Hi[1],er=Qi+lt.w*nt.scale/ai,mi=Vi+lt.h*nt.scale/ai,bi=new ii(Qi,Vi),Ai=new ii(er,Vi),vi=new ii(Qi,mi),yr=new ii(er,mi);if(Ti){const Pi=new ii(-Li,Li-hc),Yi=-Math.PI/2,Ht=12-Li,bn=new ii(22-Ht,-(nt.imageName?Ht:0)),br=new ii(...Ui);bi._rotateAround(Yi,Pi)._add(bn)._add(br),Ai._rotateAround(Yi,Pi)._add(bn)._add(br),vi._rotateAround(Yi,Pi)._add(bn)._add(br),yr._rotateAround(Yi,Pi)._add(bn)._add(br)}if(pt){const Pi=Math.sin(pt),Yi=Math.cos(pt),Ht=[Yi,-Pi,Pi,Yi];bi._matMult(Ht),Ai._matMult(Ht),vi._matMult(Ht),yr._matMult(Ht)}const dr=new ii(0,0),Bi=new ii(0,0);at.push({tl:bi,tr:Ai,bl:vi,br:yr,tex:lt,writingMode:Fe.writingMode,glyphOffset:$i,sectionIndex:nt.sectionIndex,isSDF:Bt,pixelOffsetTL:dr,pixelOffsetBR:Bi,minFontScaleX:0,minFontScaleY:0})}return at}(0,o,I,p,y,v,l,i.allowVerticalPlacement),ue=i.textSizeData;let Ie=null;ue.kind==="source"?(Ie=[Us*p.layout.get("text-size").evaluate(v,{})],Ie[0]>Vs&&qt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ue.kind==="composite"&&(Ie=[Us*$.compositeTextSizes[0].evaluate(v,{},W),Us*$.compositeTextSizes[1].evaluate(v,{},W)],(Ie[0]>Vs||Ie[1]>Vs)&&qt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,ne,Ie,I,y,v,L,t,k.lineStartIndex,k.lineLength,q,W);for(const De of O)B[De]=i.text.placedSymbolArray.length-1;return 4*ne.length}function Wp(i){for(const t in i)return i[t];return null}function gf(i,t,o,l){const p=i.compareText;if(t in p){const y=p[t];for(let v=y.length-1;v>=0;v--)if(l.dist(y[v])<o)return!0}else p[t]=[];return p[t].push(l),!1}const yf=Gl.VectorTileFeature.types,_f=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Eh(i,t,o,l,p,y,v,I,k,L,O,B,q){const $=I?Math.min(Vs,Math.round(I[0])):0,W=I?Math.min(Vs,Math.round(I[1])):0;i.emplaceBack(t,o,Math.round(32*l),Math.round(32*p),y,v,($<<1)+(k?1:0),W,16*L,16*O,256*B,256*q)}function fp(i,t,o){i.emplaceBack(t.x,t.y,o),i.emplaceBack(t.x,t.y,o),i.emplaceBack(t.x,t.y,o),i.emplaceBack(t.x,t.y,o)}function vf(i){for(const t of i.sections)if(jt(t.text))return!0;return!1}class Sh{constructor(t){this.layoutVertexArray=new F,this.indexArray=new de,this.programConfigurations=t,this.segments=new xe,this.dynamicLayoutVertexArray=new X,this.opacityVertexArray=new Y,this.placedSymbolArray=new yt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,o,l,p){this.isEmpty()||(l&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Fp.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Up.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,_f,!0),this.opacityVertexBuffer.itemSize=1),(l||p)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Lt("SymbolBuffers",Sh);class Th{constructor(t,o,l){this.layoutVertexArray=new t,this.layoutAttributes=o,this.indexArray=new l,this.segments=new xe,this.collisionVertexArray=new ce}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,fh.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Lt("CollisionBuffers",Th);class Bu{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(v=>v.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=jl([]),this.placementViewportMatrix=jl([]);const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Uc(this.zoom,o["text-size"]),this.iconSizeData=Uc(this.zoom,o["icon-size"]);const l=this.layers[0].layout,p=l.get("symbol-sort-key"),y=l.get("symbol-z-order");this.canOverlap=Hl(l,"text-overlap","text-allow-overlap")!=="never"||Hl(l,"icon-overlap","icon-allow-overlap")!=="never"||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&!p.isConstant(),this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map(v=>g.WritingMode[v])),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=t.sourceID}createArrays(){this.text=new Sh(new Qr(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Sh(new Qr(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Kt,this.lineVertexArray=new Ot,this.symbolInstances=new ct}calculateGlyphDependencies(t,o,l,p,y){for(let v=0;v<t.length;v++)if(o[t.charCodeAt(v)]=!0,(l||p)&&y){const I=Fs[t.charAt(v)];I&&(o[I.charCodeAt(0)]=!0)}}populate(t,o,l){const p=this.layers[0],y=p.layout,v=y.get("text-font"),I=y.get("text-field"),k=y.get("icon-image"),L=(I.value.kind!=="constant"||I.value.value instanceof ge&&!I.value.value.isEmpty()||I.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),O=k.value.kind!=="constant"||!!k.value.value||Object.keys(k.parameters).length>0,B=y.get("symbol-sort-key");if(this.features=[],!L&&!O)return;const q=o.iconDependencies,$=o.glyphDependencies,W=o.availableImages,ne=new mr(this.zoom);for(const{feature:ue,id:Ie,index:De,sourceLayerIndex:Fe}of t){const Ue=p._featureFilter.needGeometry,We=gn(ue,Ue);if(!p._featureFilter.filter(ne,We,l))continue;let Ve,mt;if(Ue||(We.geometry=Bo(ue)),L){const tt=p.getValueAndResolveTokens("text-field",We,l,W),pt=ge.factory(tt);vf(pt)&&(this.hasRTLText=!0),(!this.hasRTLText||ll()==="unavailable"||this.hasRTLText&&Sr.isParsed())&&(Ve=fl(pt,p,We))}if(O){const tt=p.getValueAndResolveTokens("icon-image",We,l,W);mt=tt instanceof pe?tt:pe.fromString(tt)}if(!Ve&&!mt)continue;const dt=this.sortFeaturesByKey?B.evaluate(We,{},l):void 0;if(this.features.push({id:Ie,text:Ve,icon:mt,index:De,sourceLayerIndex:Fe,geometry:We.geometry,properties:ue.properties,type:yf[ue.type],sortKey:dt}),mt&&(q[mt.name]=!0),Ve){const tt=v.evaluate(We,{},l).join(","),pt=y.get("text-rotation-alignment")!=="viewport"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(g.WritingMode.vertical)>=0;for(const at of Ve.sections)if(at.image)q[at.image.name]=!0;else{const gt=hs(Ve.toString()),nt=at.fontStack||tt,lt=$[nt]=$[nt]||{};this.calculateGlyphDependencies(at.text,lt,pt,this.allowVerticalPlacement,gt)}}}y.get("symbol-placement")==="line"&&(this.features=function(ue){const Ie={},De={},Fe=[];let Ue=0;function We(tt){Fe.push(ue[tt]),Ue++}function Ve(tt,pt,at){const gt=De[tt];return delete De[tt],De[pt]=gt,Fe[gt].geometry[0].pop(),Fe[gt].geometry[0]=Fe[gt].geometry[0].concat(at[0]),gt}function mt(tt,pt,at){const gt=Ie[pt];return delete Ie[pt],Ie[tt]=gt,Fe[gt].geometry[0].shift(),Fe[gt].geometry[0]=at[0].concat(Fe[gt].geometry[0]),gt}function dt(tt,pt,at){const gt=at?pt[0][pt[0].length-1]:pt[0][0];return`${tt}:${gt.x}:${gt.y}`}for(let tt=0;tt<ue.length;tt++){const pt=ue[tt],at=pt.geometry,gt=pt.text?pt.text.toString():null;if(!gt){We(tt);continue}const nt=dt(gt,at),lt=dt(gt,at,!0);if(nt in De&&lt in Ie&&De[nt]!==Ie[lt]){const Ft=mt(nt,lt,at),Bt=Ve(nt,lt,Fe[Ft].geometry);delete Ie[nt],delete De[lt],De[dt(gt,Fe[Bt].geometry,!0)]=Bt,Fe[Ft].geometry=null}else nt in De?Ve(nt,lt,at):lt in Ie?mt(nt,lt,at):(We(tt),Ie[nt]=Ue-1,De[lt]=Ue-1)}return Fe.filter(tt=>tt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ue,Ie)=>ue.sortKey-Ie.sortKey)}update(t,o,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,o,this.layers,l),this.icon.programConfigurations.updatePaintArrays(t,o,this.layers,l))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,o){const l=this.lineVertexArray.length;if(t.segment!==void 0){let p=t.dist(o[t.segment+1]),y=t.dist(o[t.segment]);const v={};for(let I=t.segment+1;I<o.length;I++)v[I]={x:o[I].x,y:o[I].y,tileUnitDistanceFromAnchor:p},I<o.length-1&&(p+=o[I+1].dist(o[I]));for(let I=t.segment||0;I>=0;I--)v[I]={x:o[I].x,y:o[I].y,tileUnitDistanceFromAnchor:y},I>0&&(y+=o[I-1].dist(o[I]));for(let I=0;I<o.length;I++){const k=v[I];this.lineVertexArray.emplaceBack(k.x,k.y,k.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(t,o,l,p,y,v,I,k,L,O,B,q){const $=t.indexArray,W=t.layoutVertexArray,ne=t.segments.prepareSegment(4*o.length,W,$,this.canOverlap?v.sortKey:void 0),ue=this.glyphOffsetArray.length,Ie=ne.vertexLength,De=this.allowVerticalPlacement&&I===g.WritingMode.vertical?Math.PI/2:0,Fe=v.text&&v.text.sections;for(let Ue=0;Ue<o.length;Ue++){const{tl:We,tr:Ve,bl:mt,br:dt,tex:tt,pixelOffsetTL:pt,pixelOffsetBR:at,minFontScaleX:gt,minFontScaleY:nt,glyphOffset:lt,isSDF:Ft,sectionIndex:Bt}=o[Ue],ai=ne.vertexLength,hi=lt[1];Eh(W,k.x,k.y,We.x,hi+We.y,tt.x,tt.y,l,Ft,pt.x,pt.y,gt,nt),Eh(W,k.x,k.y,Ve.x,hi+Ve.y,tt.x+tt.w,tt.y,l,Ft,at.x,pt.y,gt,nt),Eh(W,k.x,k.y,mt.x,hi+mt.y,tt.x,tt.y+tt.h,l,Ft,pt.x,at.y,gt,nt),Eh(W,k.x,k.y,dt.x,hi+dt.y,tt.x+tt.w,tt.y+tt.h,l,Ft,at.x,at.y,gt,nt),fp(t.dynamicLayoutVertexArray,k,De),$.emplaceBack(ai,ai+1,ai+2),$.emplaceBack(ai+1,ai+2,ai+3),ne.vertexLength+=4,ne.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(lt[0]),Ue!==o.length-1&&Bt===o[Ue+1].sectionIndex||t.programConfigurations.populatePaintArrays(W.length,v,v.index,{},q,Fe&&Fe[Bt])}t.placedSymbolArray.emplaceBack(k.x,k.y,ue,this.glyphOffsetArray.length-ue,Ie,L,O,k.segment,l?l[0]:0,l?l[1]:0,p[0],p[1],I,0,!1,0,B)}_addCollisionDebugVertex(t,o,l,p,y,v){return o.emplaceBack(0,0),t.emplaceBack(l.x,l.y,p,y,Math.round(v.x),Math.round(v.y))}addCollisionDebugVertices(t,o,l,p,y,v,I){const k=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),L=k.vertexLength,O=y.layoutVertexArray,B=y.collisionVertexArray,q=I.anchorX,$=I.anchorY;this._addCollisionDebugVertex(O,B,v,q,$,new ii(t,o)),this._addCollisionDebugVertex(O,B,v,q,$,new ii(l,o)),this._addCollisionDebugVertex(O,B,v,q,$,new ii(l,p)),this._addCollisionDebugVertex(O,B,v,q,$,new ii(t,p)),k.vertexLength+=4;const W=y.indexArray;W.emplaceBack(L,L+1),W.emplaceBack(L+1,L+2),W.emplaceBack(L+2,L+3),W.emplaceBack(L+3,L),k.primitiveLength+=4}addDebugCollisionBoxes(t,o,l,p){for(let y=t;y<o;y++){const v=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(v.x1,v.y1,v.x2,v.y2,p?this.textCollisionBox:this.iconCollisionBox,v.anchorPoint,l)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Th(le,gr.members,Ce),this.iconCollisionBox=new Th(le,gr.members,Ce);for(let t=0;t<this.symbolInstances.length;t++){const o=this.symbolInstances.get(t);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}}_deserializeCollisionBoxesForSymbol(t,o,l,p,y,v,I,k,L){const O={};for(let B=o;B<l;B++){const q=t.get(B);O.textBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},O.textFeatureIndex=q.featureIndex;break}for(let B=p;B<y;B++){const q=t.get(B);O.verticalTextBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},O.verticalTextFeatureIndex=q.featureIndex;break}for(let B=v;B<I;B++){const q=t.get(B);O.iconBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},O.iconFeatureIndex=q.featureIndex;break}for(let B=k;B<L;B++){const q=t.get(B);O.verticalIconBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},O.verticalIconFeatureIndex=q.featureIndex;break}return O}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const l=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,o){const l=t.placedSymbolArray.get(o),p=l.vertexStartIndex+4*l.numGlyphs;for(let y=l.vertexStartIndex;y<p;y+=4)t.indexArray.emplaceBack(y,y+1,y+2),t.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(t),l=Math.cos(t),p=[],y=[],v=[];for(let I=0;I<this.symbolInstances.length;++I){v.push(I);const k=this.symbolInstances.get(I);p.push(0|Math.round(o*k.anchorX+l*k.anchorY)),y.push(k.featureIndex)}return v.sort((I,k)=>p[I]-p[k]||y[k]-y[I]),v}addToSortKeyRanges(t,o){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===o?l.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const l=this.symbolInstances.get(o);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach((p,y,v)=>{p>=0&&v.indexOf(p)===y&&this.addIndicesForPlacedSymbol(this.text,p)}),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Lt("SymbolBucket",Bu,{omit:["layers","collisionBoxArray","features","compareText"]}),Bu.MAX_GLYPHS=65535,Bu.addDynamicAttributes=fp;const Kp=new Tr({"symbol-placement":new Gt(st.layout_symbol["symbol-placement"]),"symbol-spacing":new Gt(st.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Gt(st.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new At(st.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Gt(st.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Gt(st.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Gt(st.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Gt(st.layout_symbol["icon-ignore-placement"]),"icon-optional":new Gt(st.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Gt(st.layout_symbol["icon-rotation-alignment"]),"icon-size":new At(st.layout_symbol["icon-size"]),"icon-text-fit":new Gt(st.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Gt(st.layout_symbol["icon-text-fit-padding"]),"icon-image":new At(st.layout_symbol["icon-image"]),"icon-rotate":new At(st.layout_symbol["icon-rotate"]),"icon-padding":new Gt(st.layout_symbol["icon-padding"]),"icon-keep-upright":new Gt(st.layout_symbol["icon-keep-upright"]),"icon-offset":new At(st.layout_symbol["icon-offset"]),"icon-anchor":new At(st.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Gt(st.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Gt(st.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Gt(st.layout_symbol["text-rotation-alignment"]),"text-field":new At(st.layout_symbol["text-field"]),"text-font":new At(st.layout_symbol["text-font"]),"text-size":new At(st.layout_symbol["text-size"]),"text-max-width":new At(st.layout_symbol["text-max-width"]),"text-line-height":new Gt(st.layout_symbol["text-line-height"]),"text-letter-spacing":new At(st.layout_symbol["text-letter-spacing"]),"text-justify":new At(st.layout_symbol["text-justify"]),"text-radial-offset":new At(st.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Gt(st.layout_symbol["text-variable-anchor"]),"text-anchor":new At(st.layout_symbol["text-anchor"]),"text-max-angle":new Gt(st.layout_symbol["text-max-angle"]),"text-writing-mode":new Gt(st.layout_symbol["text-writing-mode"]),"text-rotate":new At(st.layout_symbol["text-rotate"]),"text-padding":new Gt(st.layout_symbol["text-padding"]),"text-keep-upright":new Gt(st.layout_symbol["text-keep-upright"]),"text-transform":new At(st.layout_symbol["text-transform"]),"text-offset":new At(st.layout_symbol["text-offset"]),"text-allow-overlap":new Gt(st.layout_symbol["text-allow-overlap"]),"text-overlap":new Gt(st.layout_symbol["text-overlap"]),"text-ignore-placement":new Gt(st.layout_symbol["text-ignore-placement"]),"text-optional":new Gt(st.layout_symbol["text-optional"])});var mc={paint:new Tr({"icon-opacity":new At(st.paint_symbol["icon-opacity"]),"icon-color":new At(st.paint_symbol["icon-color"]),"icon-halo-color":new At(st.paint_symbol["icon-halo-color"]),"icon-halo-width":new At(st.paint_symbol["icon-halo-width"]),"icon-halo-blur":new At(st.paint_symbol["icon-halo-blur"]),"icon-translate":new Gt(st.paint_symbol["icon-translate"]),"icon-translate-anchor":new Gt(st.paint_symbol["icon-translate-anchor"]),"text-opacity":new At(st.paint_symbol["text-opacity"]),"text-color":new At(st.paint_symbol["text-color"],{runtimeType:Kr,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new At(st.paint_symbol["text-halo-color"]),"text-halo-width":new At(st.paint_symbol["text-halo-width"]),"text-halo-blur":new At(st.paint_symbol["text-halo-blur"]),"text-translate":new Gt(st.paint_symbol["text-translate"]),"text-translate-anchor":new Gt(st.paint_symbol["text-translate-anchor"])}),layout:Kp};class $l{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:ur,this.defaultValue=t}evaluate(t){if(t.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(t.formattedSection))return o.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Lt("FormatSectionOverride",$l,{omit:["defaultValue"]});class gc extends Cr{constructor(t){super(t,mc)}recalculate(t,o){if(super.recalculate(t,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const l=this.layout.get("text-writing-mode");if(l){const p=[];for(const y of l)p.indexOf(y)<0&&p.push(y);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,o,l,p){const y=this.layout.get(t).evaluate(o,{},l,p),v=this._unevaluatedLayout._values[t];return v.isDataDriven()||na(v.value)||!y?y:function(I,k){return k.replace(/{([^{}]+)}/g,(L,O)=>O in I?String(I[O]):"")}(o.properties,y)}createBucket(t){return new Bu(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of mc.paint.overridableProperties){if(!gc.hasPaintOverride(this.layout,t))continue;const o=this.paint.get(t),l=new $l(o),p=new Dl(l,o.property.specification);let y=null;y=o.value.kind==="constant"||o.value.kind==="source"?new tl("source",p):new Va("composite",p,o.value.zoomStops,o.value._interpolationType),this.paint._values[t]=new Ro(o.property,y,o.parameters)}}_handleOverridablePaintPropertyUpdate(t,o,l){return!(!this.layout||o.isDataDriven()||l.isDataDriven())&&gc.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,o){const l=t.get("text-field"),p=mc.paint.properties[o];let y=!1;const v=I=>{for(const k of I)if(p.overrides&&p.overrides.hasOverride(k))return void(y=!0)};if(l.value.kind==="constant"&&l.value.value instanceof ge)v(l.value.value.sections);else if(l.value.kind==="source"){const I=L=>{y||(L instanceof je&&Se(L.value)===Wn?v(L.value.sections):L instanceof wt?v(L.sections):L.eachChild(I))},k=l.value;k._styleExpression&&I(k._styleExpression.expression)}return y}}function Hl(i,t,o){let l="never";const p=i.get(t);return p?l=p:i.get(o)&&(l="always"),l}var Jp={paint:new Tr({"background-color":new Gt(st.paint_background["background-color"]),"background-pattern":new Gn(st.paint_background["background-pattern"]),"background-opacity":new Gt(st.paint_background["background-opacity"])})},xn={paint:new Tr({"raster-opacity":new Gt(st.paint_raster["raster-opacity"]),"raster-hue-rotate":new Gt(st.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Gt(st.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Gt(st.paint_raster["raster-brightness-max"]),"raster-saturation":new Gt(st.paint_raster["raster-saturation"]),"raster-contrast":new Gt(st.paint_raster["raster-contrast"]),"raster-resampling":new Gt(st.paint_raster["raster-resampling"]),"raster-fade-duration":new Gt(st.paint_raster["raster-fade-duration"])})};class Ir extends Cr{constructor(t){super(t,{}),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}}const Yp={circle:class extends Cr{constructor(i){super(i,pl)}createBucket(i){return new Fo(i)}queryRadius(i){const t=i;return za("circle-radius",this,t)+za("circle-stroke-width",this,t)+ji(this.paint.get("circle-translate"))}queryIntersectsFeature(i,t,o,l,p,y,v,I){const k=ho(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,v),L=this.paint.get("circle-radius").evaluate(t,o)+this.paint.get("circle-stroke-width").evaluate(t,o),O=this.paint.get("circle-pitch-alignment")==="map",B=O?k:function($,W){return $.map(ne=>Au(ne,W))}(k,I),q=O?L*v:L;for(const $ of l)for(const W of $){const ne=O?W:Au(W,I);let ue=q;const Ie=ms([],[W.x,W.y,0,1],I);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ue*=Ie[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ue*=y.cameraToCenterDistance/Ie[3]),Ul(B,ne,ue))return!0}return!1}},heatmap:class extends Cr{constructor(i){super(i,Iu),this._updateColorRamp()}createBucket(i){return new ch(i)}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Cp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends Cr{constructor(i){super(i,Bd)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends Cr{constructor(i){super(i,zp)}recalculate(i,t){super.recalculate(i,t);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Yh(i)}queryRadius(){return ji(this.paint.get("fill-translate"))}queryIntersectsFeature(i,t,o,l,p,y,v){return ds(ho(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,v),l)}isTileClipped(){return!0}},"fill-extrusion":class extends Cr{constructor(i){super(i,ef)}createBucket(i){return new ep(i)}queryRadius(){return ji(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,t,o,l,p,y,v,I){const k=ho(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,v),L=this.paint.get("fill-extrusion-height").evaluate(t,o),O=this.paint.get("fill-extrusion-base").evaluate(t,o),B=function($,W,ne,ue){const Ie=[];for(const De of $){const Fe=[De.x,De.y,0,1];ms(Fe,Fe,W),Ie.push(new ii(Fe[0]/Fe[3],Fe[1]/Fe[3]))}return Ie}(k,I),q=function($,W,ne,ue){const Ie=[],De=[],Fe=ue[8]*W,Ue=ue[9]*W,We=ue[10]*W,Ve=ue[11]*W,mt=ue[8]*ne,dt=ue[9]*ne,tt=ue[10]*ne,pt=ue[11]*ne;for(const at of $){const gt=[],nt=[];for(const lt of at){const Ft=lt.x,Bt=lt.y,ai=ue[0]*Ft+ue[4]*Bt+ue[12],hi=ue[1]*Ft+ue[5]*Bt+ue[13],Ti=ue[2]*Ft+ue[6]*Bt+ue[14],Li=ue[3]*Ft+ue[7]*Bt+ue[15],$i=Ti+We,Hi=Li+Ve,Ui=ai+mt,Qi=hi+dt,Vi=Ti+tt,er=Li+pt,mi=new ii((ai+Fe)/Hi,(hi+Ue)/Hi);mi.z=$i/Hi,gt.push(mi);const bi=new ii(Ui/er,Qi/er);bi.z=Vi/er,nt.push(bi)}Ie.push(gt),De.push(nt)}return[Ie,De]}(l,O,L,I);return function($,W,ne){let ue=1/0;ds(ne,W)&&(ue=fo(ne,W[0]));for(let Ie=0;Ie<W.length;Ie++){const De=W[Ie],Fe=$[Ie];for(let Ue=0;Ue<De.length-1;Ue++){const We=De[Ue],Ve=[We,De[Ue+1],Fe[Ue+1],Fe[Ue],We];Fl(ne,Ve)&&(ue=Math.min(ue,fo(ne,Ve)))}}return ue!==1/0&&ue}(q[0],q[1],B)}},line:class extends Cr{constructor(i){super(i,Bp),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){i==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof is,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,t){super.recalculate(i,t),this.paint._values["line-floorwidth"]=Op.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new tp(i)}queryRadius(i){const t=i,o=cc(za("line-width",this,t),za("line-gap-width",this,t)),l=za("line-offset",this,t);return o/2+Math.abs(l)+ji(this.paint.get("line-translate"))}queryIntersectsFeature(i,t,o,l,p,y,v){const I=ho(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,v),k=v/2*cc(this.paint.get("line-width").evaluate(t,o),this.paint.get("line-gap-width").evaluate(t,o)),L=this.paint.get("line-offset").evaluate(t,o);return L&&(l=function(O,B){const q=[];for(let $=0;$<O.length;$++){const W=O[$],ne=[];for(let ue=0;ue<W.length;ue++){const Ie=W[ue-1],De=W[ue],Fe=W[ue+1],Ue=ue===0?new ii(0,0):De.sub(Ie)._unit()._perp(),We=ue===W.length-1?new ii(0,0):Fe.sub(De)._unit()._perp(),Ve=Ue._add(We)._unit(),mt=Ve.x*We.x+Ve.y*We.y;mt!==0&&Ve._mult(1/mt),ne.push(Ve._mult(B)._add(De))}q.push(ne)}return q}(l,L*v)),function(O,B,q){for(let $=0;$<B.length;$++){const W=B[$];if(O.length>=3){for(let ne=0;ne<W.length;ne++)if(Uo(O,W[ne]))return!0}if(Vl(O,W,q))return!0}return!1}(I,l,k)}isTileClipped(){return!0}},symbol:gc,background:class extends Cr{constructor(i){super(i,Jp)}},raster:class extends Cr{constructor(i){super(i,xn)}}};class Qp{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const mp=63710088e-1;class en{constructor(t,o){if(isNaN(t)||isNaN(o))throw new Error(`Invalid LngLat object: (${t}, ${o})`);if(this.lng=+t,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new en(it(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const o=Math.PI/180,l=this.lat*o,p=t.lat*o,y=Math.sin(l)*Math.sin(p)+Math.cos(l)*Math.cos(p)*Math.cos((t.lng-this.lng)*o);return mp*Math.acos(Math.min(y,1))}toBounds(t=0){const o=360*t/40075017,l=o/Math.cos(Math.PI/180*this.lat);return new Wl(new en(this.lng-l,this.lat-o),new en(this.lng+l,this.lat+o))}static convert(t){if(t instanceof en)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new en(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new en(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Wl{constructor(t,o){t&&(o?this.setSouthWest(t).setNorthEast(o):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof en?new en(t.lng,t.lat):en.convert(t),this}setSouthWest(t){return this._sw=t instanceof en?new en(t.lng,t.lat):en.convert(t),this}extend(t){const o=this._sw,l=this._ne;let p,y;if(t instanceof en)p=t,y=t;else{if(!(t instanceof Wl))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Wl.convert(t)):this.extend(en.convert(t)):this;if(p=t._sw,y=t._ne,!p||!y)return this}return o||l?(o.lng=Math.min(p.lng,o.lng),o.lat=Math.min(p.lat,o.lat),l.lng=Math.max(y.lng,l.lng),l.lat=Math.max(y.lat,l.lat)):(this._sw=new en(p.lng,p.lat),this._ne=new en(y.lng,y.lat)),this}getCenter(){return new en((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new en(this.getWest(),this.getNorth())}getSouthEast(){return new en(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:o,lat:l}=en.convert(t);let p=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&p}static convert(t){return t instanceof Wl?t:t&&new Wl(t)}}const Ah=2*Math.PI*mp;function Kl(i){return Ah*Math.cos(i*Math.PI/180)}function Jl(i){return(180+i)/360}function gp(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function sn(i,t){return i/Kl(t)}function Ou(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Xa{constructor(t,o,l=0){this.x=+t,this.y=+o,this.z=+l}static fromLngLat(t,o=0){const l=en.convert(t);return new Xa(Jl(l.lng),gp(l.lat),sn(o,l.lat))}toLngLat(){return new en(360*this.x-180,Ou(this.y))}toAltitude(){return this.z*Kl(Ou(this.y))}meterInMercatorCoordinateUnits(){return 1/Ah*(t=Ou(this.y),1/Math.cos(t*Math.PI/180));var t}}function Xc(i,t,o){var l=2*Math.PI*6378137/256/Math.pow(2,o);return[i*l-2*Math.PI*6378137/2,t*l-2*Math.PI*6378137/2]}class yc{constructor(t,o,l){this.z=t,this.x=o,this.y=l,this.key=ka(0,t,t,o,l)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,o,l){const p=(v=this.y,I=this.z,k=Xc(256*(y=this.x),256*(v=Math.pow(2,I)-v-1),I),L=Xc(256*(y+1),256*(v+1),I),k[0]+","+k[1]+","+L[0]+","+L[1]);var y,v,I,k,L;const O=function(B,q,$){let W,ne="";for(let ue=B;ue>0;ue--)W=1<<ue-1,ne+=(q&W?1:0)+($&W?2:0);return ne}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,o>1?"@2x":"").replace(/{quadkey}/g,O).replace(/{bbox-epsg-3857}/g,p)}getTilePoint(t){const o=Math.pow(2,this.z);return new ii((t.x*o-this.x)*Di,(t.y*o-this.y)*Di)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ih{constructor(t,o){this.wrap=t,this.canonical=o,this.key=ka(t,o.z,o.z,o.x,o.y)}}class Co{constructor(t,o,l,p,y){this.overscaledZ=t,this.wrap=o,this.canonical=new yc(l,+p,+y),this.key=ka(o,t,l,p,y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const o=this.canonical.z-t;return t>this.canonical.z?new Co(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Co(t,this.wrap,t,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(t,o){const l=this.canonical.z-t;return t>this.canonical.z?ka(this.wrap*+o,t,this.canonical.z,this.canonical.x,this.canonical.y):ka(this.wrap*+o,t,t,this.canonical.x>>l,this.canonical.y>>l)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const o=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>o&&t.canonical.y===this.canonical.y>>o}children(t){if(this.overscaledZ>=t)return[new Co(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,l=2*this.canonical.x,p=2*this.canonical.y;return[new Co(o,this.wrap,o,l,p),new Co(o,this.wrap,o,l+1,p),new Co(o,this.wrap,o,l,p+1),new Co(o,this.wrap,o,l+1,p+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Co(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Co(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ih(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Xa(t.x-this.wrap,t.y))}}function ka(i,t,o,l,p){(i*=2)<0&&(i=-1*i-1);const y=1<<o;return(y*y*i+y*p+l).toString(36)+o.toString(36)+t.toString(36)}Lt("CanonicalTileID",yc),Lt("OverscaledTileID",Co,{omit:["posMatrix"]});class yp{constructor(t,o,l){if(this.uid=t,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return void qt(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;const p=this.dim=o.height-2;this.data=new Uint32Array(o.data.buffer),this.encoding=l||"mapbox";for(let y=0;y<p;y++)this.data[this._idx(-1,y)]=this.data[this._idx(0,y)],this.data[this._idx(p,y)]=this.data[this._idx(p-1,y)],this.data[this._idx(y,-1)]=this.data[this._idx(y,0)],this.data[this._idx(y,p)]=this.data[this._idx(y,p-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(p,-1)]=this.data[this._idx(p-1,0)],this.data[this._idx(-1,p)]=this.data[this._idx(0,p-1)],this.data[this._idx(p,p)]=this.data[this._idx(p-1,p-1)]}get(t,o){const l=new Uint8Array(this.data.buffer),p=4*this._idx(t,o);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(l[p],l[p+1],l[p+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(t,o){if(t<-1||t>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(t+1)}_unpackMapbox(t,o,l){return(256*t*256+256*o+l)/10-1e4}_unpackTerrarium(t,o,l){return 256*t+o+l/256-32768}getPixels(){return new Pa({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,o,l){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let p=o*this.dim,y=o*this.dim+this.dim,v=l*this.dim,I=l*this.dim+this.dim;switch(o){case-1:p=y-1;break;case 1:y=p+1}switch(l){case-1:v=I-1;break;case 1:I=v+1}const k=-o*this.dim,L=-l*this.dim;for(let O=v;O<I;O++)for(let B=p;B<y;B++)this.data[this._idx(B,O)]=t.data[this._idx(B+k,O+L)]}}Lt("DEMData",yp);class _p{constructor(t){this._stringToNumber={},this._numberToString=[];for(let o=0;o<t.length;o++){const l=t[o];this._stringToNumber[l]=o,this._numberToString[o]=l}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}class ed{constructor(t,o,l,p,y){this.type="Feature",this._vectorTileFeature=t,t._z=o,t._x=l,t._y=p,this.properties=t.properties,this.id=y}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(t[o]=this[o]);return t}}class zn{constructor(t,o){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Ii(Di,16,0),this.grid3D=new Ii(Di,16,0),this.featureIndexArray=new s,this.promoteId=o}insert(t,o,l,p,y,v){const I=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,p,y);const k=v?this.grid3D:this.grid;for(let L=0;L<o.length;L++){const O=o[L],B=[1/0,1/0,-1/0,-1/0];for(let q=0;q<O.length;q++){const $=O[q];B[0]=Math.min(B[0],$.x),B[1]=Math.min(B[1],$.y),B[2]=Math.max(B[2],$.x),B[3]=Math.max(B[3],$.y)}B[0]<Di&&B[1]<Di&&B[2]>=0&&B[3]>=0&&k.insert(I,B[0],B[1],B[2],B[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Gl.VectorTile(new ip(this.rawTileData)).layers,this.sourceLayerCoder=new _p(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,o,l,p){this.loadVTLayers();const y=t.params||{},v=Di/t.tileSize/t.scale,I=Na(y.filter),k=t.queryGeometry,L=t.queryPadding*v,O=vp(k),B=this.grid.query(O.minX-L,O.minY-L,O.maxX+L,O.maxY+L),q=vp(t.cameraQueryGeometry),$=this.grid3D.query(q.minX-L,q.minY-L,q.maxX+L,q.maxY+L,(ue,Ie,De,Fe)=>function(Ue,We,Ve,mt,dt){for(const pt of Ue)if(We<=pt.x&&Ve<=pt.y&&mt>=pt.x&&dt>=pt.y)return!0;const tt=[new ii(We,Ve),new ii(We,dt),new ii(mt,dt),new ii(mt,Ve)];if(Ue.length>2){for(const pt of tt)if(Uo(Ue,pt))return!0}for(let pt=0;pt<Ue.length-1;pt++)if(Os(Ue[pt],Ue[pt+1],tt))return!0;return!1}(t.cameraQueryGeometry,ue-L,Ie-L,De+L,Fe+L));for(const ue of $)B.push(ue);B.sort(e);const W={};let ne;for(let ue=0;ue<B.length;ue++){const Ie=B[ue];if(Ie===ne)continue;ne=Ie;const De=this.featureIndexArray.get(Ie);let Fe=null;this.loadMatchingFeature(W,De.bucketIndex,De.sourceLayerIndex,De.featureIndex,I,y.layers,y.availableImages,o,l,p,(Ue,We,Ve)=>(Fe||(Fe=Bo(Ue)),We.queryIntersectsFeature(k,Ue,Ve,Fe,this.z,t.transform,v,t.pixelPosMatrix)))}return W}loadMatchingFeature(t,o,l,p,y,v,I,k,L,O,B){const q=this.bucketLayerIDs[o];if(v&&!function(ue,Ie){for(let De=0;De<ue.length;De++)if(Ie.indexOf(ue[De])>=0)return!0;return!1}(v,q))return;const $=this.sourceLayerCoder.decode(l),W=this.vtLayers[$].feature(p);if(y.needGeometry){const ue=gn(W,!0);if(!y.filter(new mr(this.tileID.overscaledZ),ue,this.tileID.canonical))return}else if(!y.filter(new mr(this.tileID.overscaledZ),W))return;const ne=this.getId(W,$);for(let ue=0;ue<q.length;ue++){const Ie=q[ue];if(v&&v.indexOf(Ie)<0)continue;const De=k[Ie];if(!De)continue;let Fe={};ne&&O&&(Fe=O.getState(De.sourceLayer||"_geojsonTileLayer",ne));const Ue=et({},L[Ie]);Ue.paint=xl(Ue.paint,De.paint,W,Fe,I),Ue.layout=xl(Ue.layout,De.layout,W,Fe,I);const We=!B||B(W,De,Fe);if(!We)continue;const Ve=new ed(W,this.z,this.x,this.y,ne);Ve.layer=Ue;let mt=t[Ie];mt===void 0&&(mt=t[Ie]=[]),mt.push({featureIndex:p,feature:Ve,intersectionZ:We})}}lookupSymbolFeatures(t,o,l,p,y,v,I,k){const L={};this.loadVTLayers();const O=Na(y);for(const B of t)this.loadMatchingFeature(L,l,p,B,O,v,I,k,o);return L}hasLayer(t){for(const o of this.bucketLayerIDs)for(const l of o)if(t===l)return!0;return!1}getId(t,o){let l=t.id;return this.promoteId&&(l=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]],typeof l=="boolean"&&(l=Number(l))),l}}function xl(i,t,o,l,p){return Xt(i,(y,v)=>{const I=t instanceof so?t.get(v):null;return I&&I.evaluate?I.evaluate(o,l,p):I})}function vp(i){let t=1/0,o=1/0,l=-1/0,p=-1/0;for(const y of i)t=Math.min(t,y.x),o=Math.min(o,y.y),l=Math.max(l,y.x),p=Math.max(p,y.y);return{minX:t,minY:o,maxX:l,maxY:p}}function e(i,t){return t-i}var r;Lt("FeatureIndex",zn,{omit:["rawTileData","sourceLayerCoder"]}),g.PerformanceMarkers=void 0,(r=g.PerformanceMarkers||(g.PerformanceMarkers={})).create="create",r.load="load",r.fullLoad="fullLoad";let a=null,d=[];const _=1e3/30,S={mark(i){performance.mark(i)},frame(i){const t=i;a!=null&&d.push(t-a),a=t},clearMetrics(){a=null,d=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const i in g.PerformanceMarkers)performance.clearMarks(g.PerformanceMarkers[i])},getPerformanceMetrics(){performance.measure("loadTime",g.PerformanceMarkers.create,g.PerformanceMarkers.load),performance.measure("fullLoadTime",g.PerformanceMarkers.create,g.PerformanceMarkers.fullLoad);const i=performance.getEntriesByName("loadTime")[0].duration,t=performance.getEntriesByName("fullLoadTime")[0].duration,o=d.length,l=1/(d.reduce((y,v)=>y+v,0)/o/1e3),p=d.filter(y=>y>_).reduce((y,v)=>y+(v-_)/_,0);return{loadTime:i,fullLoadTime:t,fps:l,percentDroppedFrames:p/(o+p)*100}}};g.AJAXError=ci,g.ARRAY_TYPE=Nl,g.Actor=class{constructor(i,t,o){this.target=i,this.parent=t,this.mapId=o,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},vt(["receive","process"],this),this.invoker=new Qp(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Wi()?i:window}send(i,t,o,l,p=!1){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(this.callbacks[y]=o);const v=Oi(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:i,hasCallback:!!o,targetMapId:l,mustQueue:p,sourceMapId:this.mapId,data:sa(t,v)},v),{cancel:()=>{o&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(i){const t=i.data,o=t.id;if(o&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){delete this.tasks[o];const l=this.cancelCallbacks[o];delete this.cancelCallbacks[o],l&&l()}else Wi()||t.mustQueue?(this.tasks[o]=t,this.taskQueue.push(o),this.invoker.trigger()):this.processTask(o,t)}process(){if(!this.taskQueue.length)return;const i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){if(t.type==="<response>"){const o=this.callbacks[i];delete this.callbacks[i],o&&(t.error?o(qo(t.error)):o(null,qo(t.data)))}else{let o=!1;const l=Oi(this.globalScope)?void 0:[],p=t.hasCallback?(I,k)=>{o=!0,delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:I?sa(I):null,data:sa(k,l)},l)}:I=>{o=!0};let y=null;const v=qo(t.data);if(this.parent[t.type])y=this.parent[t.type](t.sourceMapId,v,p);else if(this.parent.getWorkerSource){const I=t.type.split(".");y=this.parent.getWorkerSource(t.sourceMapId,I[0],v.source)[I[1]](v,p)}else p(new Error(`Could not find function ${t.type}`));!o&&y&&y.cancel&&(this.cancelCallbacks[i]=y.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},g.AlphaImage=Ic,g.CanonicalTileID=yc,g.CollisionBoxArray=rt,g.CollisionCircleLayoutArray=class extends K{},g.Color=j,g.DEMData=yp,g.DataConstantProperty=Gt,g.DictionaryCoder=_p,g.EXTENT=Di,g.ErrorEvent=kn,g.EvaluationParameters=mr,g.Event=ro,g.Evented=Ma,g.FeatureIndex=zn,g.FillBucket=Yh,g.FillExtrusionBucket=ep,g.GeoJSONFeature=ed,g.ImageAtlas=ap,g.ImagePosition=op,g.LineBucket=tp,g.LineStripIndexArray=class extends Ke{},g.LngLat=en,g.LngLatBounds=Wl,g.MercatorCoordinate=Xa,g.ONE_EM=Xn,g.OverscaledTileID=Co,g.PerformanceUtils=S,g.PosArray=class extends Yr{},g.Properties=Tr,g.QuadTriangleArray=class extends ae{},g.RGBAImage=Pa,g.RasterBoundsArray=class extends Yn{},g.RequestPerformance=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},g.ResourceType=to,g.SegmentVector=xe,g.SymbolBucket=Bu,g.Transitionable=Go,g.TriangleIndexArray=de,g.Uniform1f=Mi,g.Uniform1i=class extends Jt{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},g.Uniform2f=class extends Jt{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},g.Uniform3f=class extends Jt{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},g.Uniform4f=Nt,g.UniformColor=fi,g.UniformMatrix4f=class extends Jt{constructor(i,t){super(i,t),this.current=Ci}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},g.UnwrappedTileID=Ih,g.ValidationError=Rt,g.ZoomHistory=al,g.addDynamicAttributes=fp,g.asyncAll=function(i,t,o){if(!i.length)return o(null,[]);let l=i.length;const p=new Array(i.length);let y=null;i.forEach((v,I)=>{t(v,(k,L)=>{k&&(y=k),p[I]=L,--l==0&&o(y,p)})})},g.bezier=he,g.bindAll=vt,g.cacheEntryPossiblyAdded=function(i){$r++,$r>cn&&(i.getActor().send("enforceCacheSizeLimit",nn),$r=0)},g.clamp=re,g.clearTileCache=function(i){const t=caches.delete(Fn);i&&t.catch(i).then(()=>i())},g.clipLine=Du,g.clone=function(i){var t=new Nl(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},g.clone$1=_t,g.collisionCircleLayout=Vp,g.config=un,g.create=function(){var i=new Nl(16);return Nl!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},g.createExpression=oa,g.createFilter=Na,g.createLayout=zt,g.createStyleLayer=function(i){return i.type==="custom"?new Ir(i):new Yp[i.type](i)},g.dot=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]},g.ease=ye,g.emitValidationErrors=Sa,g.enforceCacheSizeLimit=function(i){oi(),Dr&&Dr.then(t=>{t.keys().then(o=>{for(let l=0;l<o.length-i;l++)t.delete(o[l])})})},g.evaluateSizeForFeature=function(i,{uSize:t,uSizeT:o},{lowerSize:l,upperSize:p}){return i.kind==="source"?l/Us:i.kind==="composite"?on(l/Us,p/Us,o):t},g.evaluateSizeForZoom=function(i,t){let o=0,l=0;if(i.kind==="constant")l=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:p,minZoom:y,maxZoom:v}=i,I=p?re(In.interpolationFactor(p,t,y,v),0,1):0;i.kind==="camera"?l=on(i.minSize,i.maxSize,I):o=I}return{uSizeT:o,uSize:l}},g.evaluateVariableOffset=fc,g.evented=Aa,g.exported=eo,g.exported$1=Hr,g.extend=et,g.filterObject=Wt,g.getAnchorAlignment=_h,g.getAnchorJustification=rr,g.getArrayBuffer=ko,g.getImage=Yo,g.getJSON=function(i,t){return Sn(et(i,{type:"json"}),t)},g.getOverlapMode=Hl,g.getRTLTextPluginStatus=ll,g.getReferrer=Hn,g.getVideo=function(i,t){const o=window.document.createElement("video");o.muted=!0,o.onloadstart=function(){t(null,o)};for(let l=0;l<i.length;l++){const p=window.document.createElement("source");io(i[l])||(o.crossOrigin="Anonymous"),p.src=i[l],o.appendChild(p)}return{cancel:()=>{}}},g.identity=jl,g.invert=function(i,t){var o=t[0],l=t[1],p=t[2],y=t[3],v=t[4],I=t[5],k=t[6],L=t[7],O=t[8],B=t[9],q=t[10],$=t[11],W=t[12],ne=t[13],ue=t[14],Ie=t[15],De=o*I-l*v,Fe=o*k-p*v,Ue=o*L-y*v,We=l*k-p*I,Ve=l*L-y*I,mt=p*L-y*k,dt=O*ne-B*W,tt=O*ue-q*W,pt=O*Ie-$*W,at=B*ue-q*ne,gt=B*Ie-$*ne,nt=q*Ie-$*ue,lt=De*nt-Fe*gt+Ue*at+We*pt-Ve*tt+mt*dt;return lt?(i[0]=(I*nt-k*gt+L*at)*(lt=1/lt),i[1]=(p*gt-l*nt-y*at)*lt,i[2]=(ne*mt-ue*Ve+Ie*We)*lt,i[3]=(q*Ve-B*mt-$*We)*lt,i[4]=(k*pt-v*nt-L*tt)*lt,i[5]=(o*nt-p*pt+y*tt)*lt,i[6]=(ue*Ue-W*mt-Ie*Fe)*lt,i[7]=(O*mt-q*Ue+$*Fe)*lt,i[8]=(v*gt-I*pt+L*dt)*lt,i[9]=(l*pt-o*gt-y*dt)*lt,i[10]=(W*Ve-ne*Ue+Ie*De)*lt,i[11]=(B*Ue-O*Ve-$*De)*lt,i[12]=(I*tt-v*at-k*dt)*lt,i[13]=(o*at-l*tt+p*dt)*lt,i[14]=(ne*Fe-W*We-ue*De)*lt,i[15]=(O*We-B*Fe+q*De)*lt,i):null},g.isImageBitmap=hr,g.isSafari=Oi,g.keysDifference=function(i,t){const o=[];for(const l in i)l in t||o.push(l);return o},g.lazyLoadRTLTextPlugin=function(){Sr.isLoading()||Sr.isLoaded()||ll()!=="deferred"||Jn()},g.makeRequest=Sn,g.mapObject=Xt,g.mercatorXfromLng=Jl,g.mercatorYfromLat=gp,g.mercatorZfromAltitude=sn,g.mul=uh,g.multiply=lh,g.nextPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},g.number=on,g.ortho=function(i,t,o,l,p,y,v){var I=1/(t-o),k=1/(l-p),L=1/(y-v);return i[0]=-2*I,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*k,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*L,i[11]=0,i[12]=(t+o)*I,i[13]=(p+l)*k,i[14]=(v+y)*L,i[15]=1,i},g.parseCacheControl=Gi,g.parseGlyphPBF=function(i){return new ip(i).readFields(gh,[])},g.pbf=ip,g.performSymbolLayout=function(i,t,o,l,p,y,v){i.createArrays(),i.tilePixelRatio=Di/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const I=i.layers[0].layout,k=i.layers[0]._unevaluatedLayout._values,L={layoutIconSize:k["icon-size"].possiblyEvaluate(new mr(i.zoom+1),v),layoutTextSize:k["text-size"].possiblyEvaluate(new mr(i.zoom+1),v),textMaxSize:k["text-size"].possiblyEvaluate(new mr(18))};if(i.textSizeData.kind==="composite"){const{minZoom:W,maxZoom:ne}=i.textSizeData;L.compositeTextSizes=[k["text-size"].possiblyEvaluate(new mr(W),v),k["text-size"].possiblyEvaluate(new mr(ne),v)]}if(i.iconSizeData.kind==="composite"){const{minZoom:W,maxZoom:ne}=i.iconSizeData;L.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new mr(W),v),k["icon-size"].possiblyEvaluate(new mr(ne),v)]}const O=I.get("text-line-height")*Xn,B=I.get("text-rotation-alignment")!=="viewport"&&I.get("symbol-placement")!=="point",q=I.get("text-keep-upright"),$=I.get("text-size");for(const W of i.features){const ne=I.get("text-font").evaluate(W,{},v).join(","),ue=$.evaluate(W,{},v),Ie=L.layoutTextSize.evaluate(W,{},v),De=L.layoutIconSize.evaluate(W,{},v),Fe={horizontal:{},vertical:void 0},Ue=W.text;let We,Ve=[0,0];if(Ue){const tt=Ue.toString(),pt=I.get("text-letter-spacing").evaluate(W,{},v)*Xn,at=Ls(tt)?pt:0,gt=I.get("text-anchor").evaluate(W,{},v),nt=I.get("text-variable-anchor");if(!nt){const hi=I.get("text-radial-offset").evaluate(W,{},v);Ve=hi?fc(gt,[hi*Xn,Xl]):I.get("text-offset").evaluate(W,{},v).map(Ti=>Ti*Xn)}let lt=B?"center":I.get("text-justify").evaluate(W,{},v);const Ft=I.get("symbol-placement"),Bt=Ft==="point"?I.get("text-max-width").evaluate(W,{},v)*Xn:0,ai=()=>{i.allowVerticalPlacement&&hs(tt)&&(Fe.vertical=Fc(Ue,t,o,p,ne,Bt,O,gt,"left",at,Ve,g.WritingMode.vertical,!0,Ft,Ie,ue))};if(!B&&nt){const hi=lt==="auto"?nt.map(Li=>rr(Li)):[lt];let Ti=!1;for(let Li=0;Li<hi.length;Li++){const $i=hi[Li];if(!Fe.horizontal[$i])if(Ti)Fe.horizontal[$i]=Fe.horizontal[0];else{const Hi=Fc(Ue,t,o,p,ne,Bt,O,"center",$i,at,Ve,g.WritingMode.horizontal,!1,Ft,Ie,ue);Hi&&(Fe.horizontal[$i]=Hi,Ti=Hi.positionedLines.length===1)}}ai()}else{lt==="auto"&&(lt=rr(gt));const hi=Fc(Ue,t,o,p,ne,Bt,O,gt,lt,at,Ve,g.WritingMode.horizontal,!1,Ft,Ie,ue);hi&&(Fe.horizontal[lt]=hi),ai(),hs(tt)&&B&&q&&(Fe.vertical=Fc(Ue,t,o,p,ne,Bt,O,gt,lt,at,Ve,g.WritingMode.vertical,!1,Ft,Ie,ue))}}let mt=!1;if(W.icon&&W.icon.name){const tt=l[W.icon.name];tt&&(We=cf(p[W.icon.name],I.get("icon-offset").evaluate(W,{},v),I.get("icon-anchor").evaluate(W,{},v)),mt=!!tt.sdf,i.sdfIcons===void 0?i.sdfIcons=mt:i.sdfIcons!==mt&&qt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(tt.pixelRatio!==i.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const dt=Wp(Fe.horizontal)||Fe.vertical;i.iconsInText=!!dt&&dt.iconsInText,(dt||We)&&mf(i,W,Fe,We,l,L,Ie,De,Ve,mt,v)}y&&i.generateCollisionDebugBuffers()},g.perspective=function(i,t,o,l,p){var y,v=1/Math.tan(t/2);return i[0]=v/o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=v,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,p!=null&&p!==1/0?(i[10]=(p+l)*(y=1/(l-p)),i[14]=2*p*l*y):(i[10]=-1,i[14]=-2*l),i},g.pick=function(i,t){const o={};for(let l=0;l<t.length;l++){const p=t[l];p in i&&(o[p]=i[p])}return o},g.plugin=Sr,g.pointGeometry=ii,g.polygonIntersectsPolygon=Fl,g.potpack=np,g.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],g.register=Lt,g.registerForPluginStateChange=function(i){return i({pluginStatus:vr,pluginURL:la}),Aa.on("pluginStateChange",i),i},g.renderColorRamp=Cp,g.rotateX=function(i,t,o){var l=Math.sin(o),p=Math.cos(o),y=t[4],v=t[5],I=t[6],k=t[7],L=t[8],O=t[9],B=t[10],q=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=y*p+L*l,i[5]=v*p+O*l,i[6]=I*p+B*l,i[7]=k*p+q*l,i[8]=L*p-y*l,i[9]=O*p-v*l,i[10]=B*p-I*l,i[11]=q*p-k*l,i},g.rotateZ=function(i,t,o){var l=Math.sin(o),p=Math.cos(o),y=t[0],v=t[1],I=t[2],k=t[3],L=t[4],O=t[5],B=t[6],q=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=y*p+L*l,i[1]=v*p+O*l,i[2]=I*p+B*l,i[3]=k*p+q*l,i[4]=L*p-y*l,i[5]=O*p-v*l,i[6]=B*p-I*l,i[7]=q*p-k*l,i},g.scale=function(i,t,o){var l=o[0],p=o[1],y=o[2];return i[0]=t[0]*l,i[1]=t[1]*l,i[2]=t[2]*l,i[3]=t[3]*l,i[4]=t[4]*p,i[5]=t[5]*p,i[6]=t[6]*p,i[7]=t[7]*p,i[8]=t[8]*y,i[9]=t[9]*y,i[10]=t[10]*y,i[11]=t[11]*y,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},g.scale$1=function(i,t,o){return i[0]=t[0]*o,i[1]=t[1]*o,i[2]=t[2]*o,i[3]=t[3]*o,i},g.setCacheLimits=function(i,t){nn=i,cn=t},g.setRTLTextPlugin=function(i,t,o=!1){if(vr===Dn||vr===Rs||vr===qa)throw new Error("setRTLTextPlugin cannot be called multiple times.");la=eo.resolveURL(i),vr=Dn,Ao=t,sl(),o||Jn()},g.spec=st,g.sphericalToCartesian=function([i,t,o]){return t+=90,t*=Math.PI/180,o*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(o),y:i*Math.sin(t)*Math.sin(o),z:i*Math.cos(o)}},g.toEvaluationFeature=gn,g.transformMat4=ms,g.translate=function(i,t,o){var l,p,y,v,I,k,L,O,B,q,$,W,ne=o[0],ue=o[1],Ie=o[2];return t===i?(i[12]=t[0]*ne+t[4]*ue+t[8]*Ie+t[12],i[13]=t[1]*ne+t[5]*ue+t[9]*Ie+t[13],i[14]=t[2]*ne+t[6]*ue+t[10]*Ie+t[14],i[15]=t[3]*ne+t[7]*ue+t[11]*Ie+t[15]):(p=t[1],y=t[2],v=t[3],I=t[4],k=t[5],L=t[6],O=t[7],B=t[8],q=t[9],$=t[10],W=t[11],i[0]=l=t[0],i[1]=p,i[2]=y,i[3]=v,i[4]=I,i[5]=k,i[6]=L,i[7]=O,i[8]=B,i[9]=q,i[10]=$,i[11]=W,i[12]=l*ne+I*ue+B*Ie+t[12],i[13]=p*ne+k*ue+q*Ie+t[13],i[14]=y*ne+L*ue+$*Ie+t[14],i[15]=v*ne+O*ue+W*Ie+t[15]),i},g.triggerPluginCompletionEvent=Ct,g.unicodeBlockLookup=Vt,g.uniqueId=function(){return St++},g.validateCustomStyleLayer=function(i){const t=[],o=i.id;return o===void 0&&t.push({message:`layers.${o}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${o}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),t},g.validateLight=_r,g.validateStyle=To,g.vectorTile=Gl,g.warnOnce=qt,g.wrap=it}),H(["./shared"],function(g){function Z(ie){const N=typeof ie;if(N==="number"||N==="boolean"||N==="string"||ie==null)return JSON.stringify(ie);if(Array.isArray(ie)){let se="[";for(const ge of ie)se+=`${Z(ge)},`;return`${se}]`}const j=Object.keys(ie).sort();let ee="{";for(let se=0;se<j.length;se++)ee+=`${JSON.stringify(j[se])}:${Z(ie[j[se]])},`;return`${ee}}`}function ve(ie){let N="";for(const j of g.refProperties)N+=`/${Z(ie[j])}`;return N}class he{constructor(N){this.keyCache={},N&&this.replace(N)}replace(N){this._layerConfigs={},this._layers={},this.update(N,[])}update(N,j){for(const se of N){this._layerConfigs[se.id]=se;const ge=this._layers[se.id]=g.createStyleLayer(se);ge._featureFilter=g.createFilter(ge.filter),this.keyCache[se.id]&&delete this.keyCache[se.id]}for(const se of j)delete this.keyCache[se],delete this._layerConfigs[se],delete this._layers[se];this.familiesBySource={};const ee=function(se,ge){const pe={};for(let we=0;we<se.length;we++){const Se=ge&&ge[se[we].id]||ve(se[we]);ge&&(ge[se[we].id]=Se);let $e=pe[Se];$e||($e=pe[Se]=[]),$e.push(se[we])}const Ee=[];for(const we in pe)Ee.push(pe[we]);return Ee}(Object.values(this._layerConfigs),this.keyCache);for(const se of ee){const ge=se.map(je=>this._layers[je.id]),pe=ge[0];if(pe.visibility==="none")continue;const Ee=pe.source||"";let we=this.familiesBySource[Ee];we||(we=this.familiesBySource[Ee]={});const Se=pe.sourceLayer||"_geojsonTileLayer";let $e=we[Se];$e||($e=we[Se]=[]),$e.push(ge)}}}class ye{constructor(N){const j={},ee=[];for(const Ee in N){const we=N[Ee],Se=j[Ee]={};for(const $e in we){const je=we[+$e];if(!je||je.bitmap.width===0||je.bitmap.height===0)continue;const He={x:0,y:0,w:je.bitmap.width+2,h:je.bitmap.height+2};ee.push(He),Se[$e]={rect:He,metrics:je.metrics}}}const{w:se,h:ge}=g.potpack(ee),pe=new g.AlphaImage({width:se||1,height:ge||1});for(const Ee in N){const we=N[Ee];for(const Se in we){const $e=we[+Se];if(!$e||$e.bitmap.width===0||$e.bitmap.height===0)continue;const je=j[Ee][Se].rect;g.AlphaImage.copy($e.bitmap,pe,{x:0,y:0},{x:je.x+1,y:je.y+1},$e.bitmap)}}this.image=pe,this.positions=j}}g.register("GlyphAtlas",ye);class re{constructor(N){this.tileID=new g.OverscaledTileID(N.tileID.overscaledZ,N.tileID.wrap,N.tileID.canonical.z,N.tileID.canonical.x,N.tileID.canonical.y),this.uid=N.uid,this.zoom=N.zoom,this.pixelRatio=N.pixelRatio,this.tileSize=N.tileSize,this.source=N.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=N.showCollisionBoxes,this.collectResourceTiming=!!N.collectResourceTiming,this.returnDependencies=!!N.returnDependencies,this.promoteId=N.promoteId}parse(N,j,ee,se,ge){this.status="parsing",this.data=N,this.collisionBoxArray=new g.CollisionBoxArray;const pe=new g.DictionaryCoder(Object.keys(N.layers).sort()),Ee=new g.FeatureIndex(this.tileID,this.promoteId);Ee.bucketLayerIDs=[];const we={},Se={featureIndex:Ee,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ee},$e=j.familiesBySource[this.source];for(const ni in $e){const $t=N.layers[ni];if(!$t)continue;$t.version===1&&g.warnOnce(`Vector tile source "${this.source}" layer "${ni}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Mt=pe.encode(ni),di=[];for(let qi=0;qi<$t.length;qi++){const jr=$t.feature(qi),Xi=Ee.getId(jr,ni);di.push({feature:jr,id:Xi,index:qi,sourceLayerIndex:Mt})}for(const qi of $e[ni]){const jr=qi[0];jr.minzoom&&this.zoom<Math.floor(jr.minzoom)||jr.maxzoom&&this.zoom>=jr.maxzoom||jr.visibility!=="none"&&(it(qi,this.zoom,ee),(we[jr.id]=jr.createBucket({index:Ee.bucketLayerIDs.length,layers:qi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Mt,sourceID:this.source})).populate(di,Se,this.tileID.canonical),Ee.bucketLayerIDs.push(qi.map(Xi=>Xi.id)))}}let je,He,Tt,ft;const wt=g.mapObject(Se.glyphDependencies,ni=>Object.keys(ni).map(Number));Object.keys(wt).length?se.send("getGlyphs",{uid:this.uid,stacks:wt},(ni,$t)=>{je||(je=ni,He=$t,Qt.call(this))}):He={};const It=Object.keys(Se.iconDependencies);It.length?se.send("getImages",{icons:It,source:this.source,tileID:this.tileID,type:"icons"},(ni,$t)=>{je||(je=ni,Tt=$t,Qt.call(this))}):Tt={};const xi=Object.keys(Se.patternDependencies);function Qt(){if(je)return ge(je);if(He&&Tt&&ft){const ni=new ye(He),$t=new g.ImageAtlas(Tt,ft);for(const Mt in we){const di=we[Mt];di instanceof g.SymbolBucket?(it(di.layers,this.zoom,ee),g.performSymbolLayout(di,He,ni.positions,Tt,$t.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):di.hasPattern&&(di instanceof g.LineBucket||di instanceof g.FillBucket||di instanceof g.FillExtrusionBucket)&&(it(di.layers,this.zoom,ee),di.addFeatures(Se,this.tileID.canonical,$t.patternPositions))}this.status="done",ge(null,{buckets:Object.values(we).filter(Mt=>!Mt.isEmpty()),featureIndex:Ee,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ni.image,imageAtlas:$t,glyphMap:this.returnDependencies?He:null,iconMap:this.returnDependencies?Tt:null,glyphPositions:this.returnDependencies?ni.positions:null})}}xi.length?se.send("getImages",{icons:xi,source:this.source,tileID:this.tileID,type:"patterns"},(ni,$t)=>{je||(je=ni,ft=$t,Qt.call(this))}):ft={},Qt.call(this)}}function it(ie,N,j){const ee=new g.EvaluationParameters(N);for(const se of ie)se.recalculate(ee,j)}function et(ie,N){const j=g.getArrayBuffer(ie.request,(ee,se,ge,pe)=>{ee?N(ee):se&&N(null,{vectorTile:new g.vectorTile.VectorTile(new g.pbf(se)),rawData:se,cacheControl:ge,expires:pe})});return()=>{j.cancel(),N()}}class St{constructor(N,j,ee,se){this.actor=N,this.layerIndex=j,this.availableImages=ee,this.loadVectorData=se||et,this.loading={},this.loaded={}}loadTile(N,j){const ee=N.uid;this.loading||(this.loading={});const se=!!(N&&N.request&&N.request.collectResourceTiming)&&new g.RequestPerformance(N.request),ge=this.loading[ee]=new re(N);ge.abort=this.loadVectorData(N,(pe,Ee)=>{if(delete this.loading[ee],pe||!Ee)return ge.status="done",this.loaded[ee]=ge,j(pe);const we=Ee.rawData,Se={};Ee.expires&&(Se.expires=Ee.expires),Ee.cacheControl&&(Se.cacheControl=Ee.cacheControl);const $e={};if(se){const je=se.finish();je&&($e.resourceTiming=JSON.parse(JSON.stringify(je)))}ge.vectorTile=Ee.vectorTile,ge.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.actor,(je,He)=>{if(je||!He)return j(je);j(null,g.extend({rawTileData:we.slice(0)},He,Se,$e))}),this.loaded=this.loaded||{},this.loaded[ee]=ge})}reloadTile(N,j){const ee=this.loaded,se=N.uid,ge=this;if(ee&&ee[se]){const pe=ee[se];pe.showCollisionBoxes=N.showCollisionBoxes;const Ee=(we,Se)=>{const $e=pe.reloadCallback;$e&&(delete pe.reloadCallback,pe.parse(pe.vectorTile,ge.layerIndex,this.availableImages,ge.actor,$e)),j(we,Se)};pe.status==="parsing"?pe.reloadCallback=Ee:pe.status==="done"&&(pe.vectorTile?pe.parse(pe.vectorTile,this.layerIndex,this.availableImages,this.actor,Ee):Ee())}}abortTile(N,j){const ee=this.loading,se=N.uid;ee&&ee[se]&&ee[se].abort&&(ee[se].abort(),delete ee[se]),j()}removeTile(N,j){const ee=this.loaded,se=N.uid;ee&&ee[se]&&delete ee[se],j()}}class vt{constructor(){this.loaded={}}loadTile(N,j){const{uid:ee,encoding:se,rawImageData:ge}=N,pe=g.isImageBitmap(ge)?this.getImageData(ge):ge,Ee=new g.DEMData(ee,pe,se);this.loaded=this.loaded||{},this.loaded[ee]=Ee,j(null,Ee)}getImageData(N){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(N.width,N.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=N.width,this.offscreenCanvas.height=N.height,this.offscreenCanvasContext.drawImage(N,0,0,N.width,N.height);const j=this.offscreenCanvasContext.getImageData(-1,-1,N.width+2,N.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new g.RGBAImage({width:j.width,height:j.height},j.data)}removeTile(N){const j=this.loaded,ee=N.uid;j&&j[ee]&&delete j[ee]}}var Xt=function ie(N,j){var ee,se=N&&N.type;if(se==="FeatureCollection")for(ee=0;ee<N.features.length;ee++)ie(N.features[ee],j);else if(se==="GeometryCollection")for(ee=0;ee<N.geometries.length;ee++)ie(N.geometries[ee],j);else if(se==="Feature")ie(N.geometry,j);else if(se==="Polygon")Wt(N.coordinates,j);else if(se==="MultiPolygon")for(ee=0;ee<N.coordinates.length;ee++)Wt(N.coordinates[ee],j);return N};function Wt(ie,N){if(ie.length!==0){_t(ie[0],N);for(var j=1;j<ie.length;j++)_t(ie[j],!N)}}function _t(ie,N){for(var j=0,ee=0,se=0,ge=ie.length,pe=ge-1;se<ge;pe=se++){var Ee=(ie[se][0]-ie[pe][0])*(ie[pe][1]+ie[se][1]),we=j+Ee;ee+=Math.abs(j)>=Math.abs(Ee)?j-we+Ee:Ee-we+j,j=we}j+ee>=0!=!!N&&ie.reverse()}const ui=g.vectorTile.VectorTileFeature.prototype.toGeoJSON;class qt{constructor(N){this._feature=N,this.extent=g.EXTENT,this.type=N.type,this.properties=N.tags,"id"in N&&!isNaN(N.id)&&(this.id=parseInt(N.id,10))}loadGeometry(){if(this._feature.type===1){const N=[];for(const j of this._feature.geometry)N.push([new g.pointGeometry(j[0],j[1])]);return N}{const N=[];for(const j of this._feature.geometry){const ee=[];for(const se of j)ee.push(new g.pointGeometry(se[0],se[1]));N.push(ee)}return N}}toGeoJSON(N,j,ee){return ui.call(this,N,j,ee)}}class Zt{constructor(N){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=g.EXTENT,this.length=N.length,this._features=N}feature(N){return new qt(this._features[N])}}var si={exports:{}},Wi=g.pointGeometry,Gi=g.vectorTile.VectorTileFeature,Zi=Ki;function Ki(ie,N){this.options=N||{},this.features=ie,this.length=ie.length}function Mr(ie,N){this.id=typeof ie.id=="number"?ie.id:void 0,this.type=ie.type,this.rawGeometry=ie.type===1?[ie.geometry]:ie.geometry,this.properties=ie.tags,this.extent=N||4096}Ki.prototype.feature=function(ie){return new Mr(this.features[ie],this.options.extent)},Mr.prototype.loadGeometry=function(){var ie=this.rawGeometry;this.geometry=[];for(var N=0;N<ie.length;N++){for(var j=ie[N],ee=[],se=0;se<j.length;se++)ee.push(new Wi(j[se][0],j[se][1]));this.geometry.push(ee)}return this.geometry},Mr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ie=this.geometry,N=1/0,j=-1/0,ee=1/0,se=-1/0,ge=0;ge<ie.length;ge++)for(var pe=ie[ge],Ee=0;Ee<pe.length;Ee++){var we=pe[Ee];N=Math.min(N,we.x),j=Math.max(j,we.x),ee=Math.min(ee,we.y),se=Math.max(se,we.y)}return[N,ee,j,se]},Mr.prototype.toGeoJSON=Gi.prototype.toGeoJSON;var Oi=g.pbf,hr=Zi;function eo(ie){var N=new Oi;return function(j,ee){for(var se in j.layers)ee.writeMessage(3,ii,j.layers[se])}(ie,N),N.finish()}function ii(ie,N){var j;N.writeVarintField(15,ie.version||1),N.writeStringField(1,ie.name||""),N.writeVarintField(5,ie.extent||4096);var ee={keys:[],values:[],keycache:{},valuecache:{}};for(j=0;j<ie.length;j++)ee.feature=ie.feature(j),N.writeMessage(2,Lr,ee);var se=ee.keys;for(j=0;j<se.length;j++)N.writeStringField(3,se[j]);var ge=ee.values;for(j=0;j<ge.length;j++)N.writeMessage(4,nn,ge[j])}function Lr(ie,N){var j=ie.feature;j.id!==void 0&&N.writeVarintField(1,j.id),N.writeMessage(2,un,ie),N.writeVarintField(3,j.type),N.writeMessage(4,Vr,j)}function un(ie,N){var j=ie.feature,ee=ie.keys,se=ie.values,ge=ie.keycache,pe=ie.valuecache;for(var Ee in j.properties){var we=j.properties[Ee],Se=ge[Ee];if(we!==null){Se===void 0&&(ee.push(Ee),ge[Ee]=Se=ee.length-1),N.writeVarint(Se);var $e=typeof we;$e!=="string"&&$e!=="boolean"&&$e!=="number"&&(we=JSON.stringify(we));var je=$e+":"+we,He=pe[je];He===void 0&&(se.push(we),pe[je]=He=se.length-1),N.writeVarint(He)}}}function Fn(ie,N){return(N<<3)+(7&ie)}function Dr(ie){return ie<<1^ie>>31}function Vr(ie,N){for(var j=ie.loadGeometry(),ee=ie.type,se=0,ge=0,pe=j.length,Ee=0;Ee<pe;Ee++){var we=j[Ee],Se=1;ee===1&&(Se=we.length),N.writeVarint(Fn(1,Se));for(var $e=ee===3?we.length-1:we.length,je=0;je<$e;je++){je===1&&ee!==1&&N.writeVarint(Fn(2,$e-1));var He=we[je].x-se,Tt=we[je].y-ge;N.writeVarint(Dr(He)),N.writeVarint(Dr(Tt)),se+=He,ge+=Tt}ee===3&&N.writeVarint(Fn(7,1))}}function nn(ie,N){var j=typeof ie;j==="string"?N.writeStringField(1,ie):j==="boolean"?N.writeBooleanField(7,ie):j==="number"&&(ie%1!=0?N.writeDoubleField(3,ie):ie<0?N.writeSVarintField(6,ie):N.writeVarintField(5,ie))}si.exports=eo,si.exports.fromVectorTileJs=eo,si.exports.fromGeojsonVt=function(ie,N){N=N||{};var j={};for(var ee in ie)j[ee]=new hr(ie[ee].features,N),j[ee].name=ee,j[ee].version=N.version,j[ee].extent=N.extent;return eo({layers:j})},si.exports.GeoJSONWrapper=hr;var cn=si.exports;function oi(ie,N,j,ee,se,ge){if(se-ee<=j)return;const pe=ee+se>>1;$r(ie,N,pe,ee,se,ge%2),oi(ie,N,j,ee,pe-1,ge+1),oi(ie,N,j,pe+1,se,ge+1)}function $r(ie,N,j,ee,se,ge){for(;se>ee;){if(se-ee>600){const Se=se-ee+1,$e=j-ee+1,je=Math.log(Se),He=.5*Math.exp(2*je/3),Tt=.5*Math.sqrt(je*He*(Se-He)/Se)*($e-Se/2<0?-1:1);$r(ie,N,j,Math.max(ee,Math.floor(j-$e*He/Se+Tt)),Math.min(se,Math.floor(j+(Se-$e)*He/Se+Tt)),ge)}const pe=N[2*j+ge];let Ee=ee,we=se;for(Hr(ie,N,ee,j),N[2*se+ge]>pe&&Hr(ie,N,ee,se);Ee<we;){for(Hr(ie,N,Ee,we),Ee++,we--;N[2*Ee+ge]<pe;)Ee++;for(;N[2*we+ge]>pe;)we--}N[2*ee+ge]===pe?Hr(ie,N,ee,we):(we++,Hr(ie,N,we,se)),we<=j&&(ee=we+1),j<=we&&(se=we-1)}}function Hr(ie,N,j,ee){wr(ie,j,ee),wr(N,2*j,2*ee),wr(N,2*j+1,2*ee+1)}function wr(ie,N,j){const ee=ie[N];ie[N]=ie[j],ie[j]=ee}function hn(ie,N,j,ee){const se=ie-j,ge=N-ee;return se*se+ge*ge}const Fi=ie=>ie[0],Ut=ie=>ie[1];class Nr{constructor(N,j=Fi,ee=Ut,se=64,ge=Float64Array){this.nodeSize=se,this.points=N;const pe=N.length<65536?Uint16Array:Uint32Array,Ee=this.ids=new pe(N.length),we=this.coords=new ge(2*N.length);for(let Se=0;Se<N.length;Se++)Ee[Se]=Se,we[2*Se]=j(N[Se]),we[2*Se+1]=ee(N[Se]);oi(Ee,we,se,0,Ee.length-1,0)}range(N,j,ee,se){return function(ge,pe,Ee,we,Se,$e,je){const He=[0,ge.length-1,0],Tt=[];let ft,wt;for(;He.length;){const It=He.pop(),xi=He.pop(),Qt=He.pop();if(xi-Qt<=je){for(let Mt=Qt;Mt<=xi;Mt++)ft=pe[2*Mt],wt=pe[2*Mt+1],ft>=Ee&&ft<=Se&&wt>=we&&wt<=$e&&Tt.push(ge[Mt]);continue}const ni=Math.floor((Qt+xi)/2);ft=pe[2*ni],wt=pe[2*ni+1],ft>=Ee&&ft<=Se&&wt>=we&&wt<=$e&&Tt.push(ge[ni]);const $t=(It+1)%2;(It===0?Ee<=ft:we<=wt)&&(He.push(Qt),He.push(ni-1),He.push($t)),(It===0?Se>=ft:$e>=wt)&&(He.push(ni+1),He.push(xi),He.push($t))}return Tt}(this.ids,this.coords,N,j,ee,se,this.nodeSize)}within(N,j,ee){return function(se,ge,pe,Ee,we,Se){const $e=[0,se.length-1,0],je=[],He=we*we;for(;$e.length;){const Tt=$e.pop(),ft=$e.pop(),wt=$e.pop();if(ft-wt<=Se){for(let $t=wt;$t<=ft;$t++)hn(ge[2*$t],ge[2*$t+1],pe,Ee)<=He&&je.push(se[$t]);continue}const It=Math.floor((wt+ft)/2),xi=ge[2*It],Qt=ge[2*It+1];hn(xi,Qt,pe,Ee)<=He&&je.push(se[It]);const ni=(Tt+1)%2;(Tt===0?pe-we<=xi:Ee-we<=Qt)&&($e.push(wt),$e.push(It-1),$e.push(ni)),(Tt===0?pe+we>=xi:Ee+we>=Qt)&&($e.push(It+1),$e.push(ft),$e.push(ni))}return je}(this.ids,this.coords,N,j,ee,this.nodeSize)}}const to={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ie=>ie},ci=Math.fround||(Hn=new Float32Array(1),ie=>(Hn[0]=+ie,Hn[0]));var Hn;class pn{constructor(N){this.options=wi(Object.create(to),N),this.trees=new Array(this.options.maxZoom+1)}load(N){const{log:j,minZoom:ee,maxZoom:se,nodeSize:ge}=this.options;j&&console.time("total time");const pe=`prepare ${N.length} points`;j&&console.time(pe),this.points=N;let Ee=[];for(let we=0;we<N.length;we++)N[we].geometry&&Ee.push(ko(N[we],we));this.trees[se+1]=new Nr(Ee,Tn,ro,ge,Float32Array),j&&console.timeEnd(pe);for(let we=se;we>=ee;we--){const Se=+Date.now();Ee=this._cluster(Ee,we),this.trees[we]=new Nr(Ee,Tn,ro,ge,Float32Array),j&&console.log("z%d: %d clusters in %dms",we,Ee.length,+Date.now()-Se)}return j&&console.timeEnd("total time"),this}getClusters(N,j){let ee=((N[0]+180)%360+360)%360-180;const se=Math.max(-90,Math.min(90,N[1]));let ge=N[2]===180?180:((N[2]+180)%360+360)%360-180;const pe=Math.max(-90,Math.min(90,N[3]));if(N[2]-N[0]>=360)ee=-180,ge=180;else if(ee>ge){const $e=this.getClusters([ee,se,180,pe],j),je=this.getClusters([-180,se,ge,pe],j);return $e.concat(je)}const Ee=this.trees[this._limitZoom(j)],we=Ee.range(Wr(ee),Un(pe),Wr(ge),Un(se)),Se=[];for(const $e of we){const je=Ee.points[$e];Se.push(je.numPoints?io(je):this.points[je.index])}return Se}getChildren(N){const j=this._getOriginId(N),ee=this._getOriginZoom(N),se="No cluster with the specified id.",ge=this.trees[ee];if(!ge)throw new Error(se);const pe=ge.points[j];if(!pe)throw new Error(se);const Ee=this.options.radius/(this.options.extent*Math.pow(2,ee-1)),we=ge.within(pe.x,pe.y,Ee),Se=[];for(const $e of we){const je=ge.points[$e];je.parentId===N&&Se.push(je.numPoints?io(je):this.points[je.index])}if(Se.length===0)throw new Error(se);return Se}getLeaves(N,j,ee){const se=[];return this._appendLeaves(se,N,j=j||10,ee=ee||0,0),se}getTile(N,j,ee){const se=this.trees[this._limitZoom(N)],ge=Math.pow(2,N),{extent:pe,radius:Ee}=this.options,we=Ee/pe,Se=(ee-we)/ge,$e=(ee+1+we)/ge,je={features:[]};return this._addTileFeatures(se.range((j-we)/ge,Se,(j+1+we)/ge,$e),se.points,j,ee,ge,je),j===0&&this._addTileFeatures(se.range(1-we/ge,Se,1,$e),se.points,ge,ee,ge,je),j===ge-1&&this._addTileFeatures(se.range(0,Se,we/ge,$e),se.points,-1,ee,ge,je),je.features.length?je:null}getClusterExpansionZoom(N){let j=this._getOriginZoom(N)-1;for(;j<=this.options.maxZoom;){const ee=this.getChildren(N);if(j++,ee.length!==1)break;N=ee[0].properties.cluster_id}return j}_appendLeaves(N,j,ee,se,ge){const pe=this.getChildren(j);for(const Ee of pe){const we=Ee.properties;if(we&&we.cluster?ge+we.point_count<=se?ge+=we.point_count:ge=this._appendLeaves(N,we.cluster_id,ee,se,ge):ge<se?ge++:N.push(Ee),N.length===ee)break}return ge}_addTileFeatures(N,j,ee,se,ge,pe){for(const Ee of N){const we=j[Ee],Se=we.numPoints;let $e,je,He;if(Se)$e=vo(we),je=we.x,He=we.y;else{const wt=this.points[we.index];$e=wt.properties,je=Wr(wt.geometry.coordinates[0]),He=Un(wt.geometry.coordinates[1])}const Tt={type:1,geometry:[[Math.round(this.options.extent*(je*ge-ee)),Math.round(this.options.extent*(He*ge-se))]],tags:$e};let ft;Se?ft=we.id:this.options.generateId?ft=we.index:this.points[we.index].id&&(ft=this.points[we.index].id),ft!==void 0&&(Tt.id=ft),pe.features.push(Tt)}}_limitZoom(N){return Math.max(this.options.minZoom,Math.min(+N,this.options.maxZoom+1))}_cluster(N,j){const ee=[],{radius:se,extent:ge,reduce:pe,minPoints:Ee}=this.options,we=se/(ge*Math.pow(2,j));for(let Se=0;Se<N.length;Se++){const $e=N[Se];if($e.zoom<=j)continue;$e.zoom=j;const je=this.trees[j+1],He=je.within($e.x,$e.y,we),Tt=$e.numPoints||1;let ft=Tt;for(const wt of He){const It=je.points[wt];It.zoom>j&&(ft+=It.numPoints||1)}if(ft>Tt&&ft>=Ee){let wt=$e.x*Tt,It=$e.y*Tt,xi=pe&&Tt>1?this._map($e,!0):null;const Qt=(Se<<5)+(j+1)+this.points.length;for(const ni of He){const $t=je.points[ni];if($t.zoom<=j)continue;$t.zoom=j;const Mt=$t.numPoints||1;wt+=$t.x*Mt,It+=$t.y*Mt,$t.parentId=Qt,pe&&(xi||(xi=this._map($e,!0)),pe(xi,this._map($t)))}$e.parentId=Qt,ee.push(Sn(wt/ft,It/ft,Qt,ft,xi))}else if(ee.push($e),ft>1)for(const wt of He){const It=je.points[wt];It.zoom<=j||(It.zoom=j,ee.push(It))}}return ee}_getOriginId(N){return N-this.points.length>>5}_getOriginZoom(N){return(N-this.points.length)%32}_map(N,j){if(N.numPoints)return j?wi({},N.properties):N.properties;const ee=this.points[N.index].properties,se=this.options.map(ee);return j&&se===ee?wi({},se):se}}function Sn(ie,N,j,ee,se){return{x:ci(ie),y:ci(N),zoom:1/0,id:j,parentId:-1,numPoints:ee,properties:se}}function ko(ie,N){const[j,ee]=ie.geometry.coordinates;return{x:ci(Wr(j)),y:ci(Un(ee)),zoom:1/0,index:N,parentId:-1}}function io(ie){return{type:"Feature",id:ie.id,properties:vo(ie),geometry:{type:"Point",coordinates:[(N=ie.x,360*(N-.5)),Yo(ie.y)]}};var N}function vo(ie){const N=ie.numPoints,j=N>=1e4?`${Math.round(N/1e3)}k`:N>=1e3?Math.round(N/100)/10+"k":N;return wi(wi({},ie.properties),{cluster:!0,cluster_id:ie.id,point_count:N,point_count_abbreviated:j})}function Wr(ie){return ie/360+.5}function Un(ie){const N=Math.sin(ie*Math.PI/180),j=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return j<0?0:j>1?1:j}function Yo(ie){const N=(180-360*ie)*Math.PI/180;return 360*Math.atan(Math.exp(N))/Math.PI-90}function wi(ie,N){for(const j in N)ie[j]=N[j];return ie}function Tn(ie){return ie.x}function ro(ie){return ie.y}function kn(ie,N,j,ee){for(var se,ge=ee,pe=j-N>>1,Ee=j-N,we=ie[N],Se=ie[N+1],$e=ie[j],je=ie[j+1],He=N+3;He<j;He+=3){var Tt=Ma(ie[He],ie[He+1],we,Se,$e,je);if(Tt>ge)se=He,ge=Tt;else if(Tt===ge){var ft=Math.abs(He-pe);ft<Ee&&(se=He,Ee=ft)}}ge>ee&&(se-N>3&&kn(ie,N,se,ee),ie[se+2]=ge,j-se>3&&kn(ie,se,j,ee))}function Ma(ie,N,j,ee,se,ge){var pe=se-j,Ee=ge-ee;if(pe!==0||Ee!==0){var we=((ie-j)*pe+(N-ee)*Ee)/(pe*pe+Ee*Ee);we>1?(j=se,ee=ge):we>0&&(j+=pe*we,ee+=Ee*we)}return(pe=ie-j)*pe+(Ee=N-ee)*Ee}function st(ie,N,j,ee){var se={id:ie===void 0?null:ie,type:N,geometry:j,tags:ee,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ge){var pe=ge.geometry,Ee=ge.type;if(Ee==="Point"||Ee==="MultiPoint"||Ee==="LineString")Rt(ge,pe);else if(Ee==="Polygon"||Ee==="MultiLineString")for(var we=0;we<pe.length;we++)Rt(ge,pe[we]);else if(Ee==="MultiPolygon")for(we=0;we<pe.length;we++)for(var Se=0;Se<pe[we].length;Se++)Rt(ge,pe[we][Se])}(se),se}function Rt(ie,N){for(var j=0;j<N.length;j+=3)ie.minX=Math.min(ie.minX,N[j]),ie.minY=Math.min(ie.minY,N[j+1]),ie.maxX=Math.max(ie.maxX,N[j]),ie.maxY=Math.max(ie.maxY,N[j+1])}function Vo(ie,N,j,ee){if(N.geometry){var se=N.geometry.coordinates,ge=N.geometry.type,pe=Math.pow(j.tolerance/((1<<j.maxZoom)*j.extent),2),Ee=[],we=N.id;if(j.promoteId?we=N.properties[j.promoteId]:j.generateId&&(we=ee||0),ge==="Point")no(se,Ee);else if(ge==="MultiPoint")for(var Se=0;Se<se.length;Se++)no(se[Se],Ee);else if(ge==="LineString")or(se,Ee,pe,!1);else if(ge==="MultiLineString"){if(j.lineMetrics){for(Se=0;Se<se.length;Se++)or(se[Se],Ee=[],pe,!1),ie.push(st(we,"LineString",Ee,N.properties));return}Mn(se,Ee,pe,!1)}else if(ge==="Polygon")Mn(se,Ee,pe,!0);else{if(ge!=="MultiPolygon"){if(ge==="GeometryCollection"){for(Se=0;Se<N.geometry.geometries.length;Se++)Vo(ie,{id:we,geometry:N.geometry.geometries[Se],properties:N.properties},j,ee);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Se=0;Se<se.length;Se++){var $e=[];Mn(se[Se],$e,pe,!0),Ee.push($e)}}ie.push(st(we,ge,Ee,N.properties))}}function no(ie,N){N.push(dn(ie[0])),N.push(xo(ie[1])),N.push(0)}function or(ie,N,j,ee){for(var se,ge,pe=0,Ee=0;Ee<ie.length;Ee++){var we=dn(ie[Ee][0]),Se=xo(ie[Ee][1]);N.push(we),N.push(Se),N.push(0),Ee>0&&(pe+=ee?(se*Se-we*ge)/2:Math.sqrt(Math.pow(we-se,2)+Math.pow(Se-ge,2))),se=we,ge=Se}var $e=N.length-3;N[2]=1,kn(N,0,$e,j),N[$e+2]=1,N.size=Math.abs(pe),N.start=0,N.end=N.size}function Mn(ie,N,j,ee){for(var se=0;se<ie.length;se++){var ge=[];or(ie[se],ge,j,ee),N.push(ge)}}function dn(ie){return ie/360+.5}function xo(ie){var N=Math.sin(ie*Math.PI/180),j=.5-.25*Math.log((1+N)/(1-N))/Math.PI;return j<0?0:j>1?1:j}function ur(ie,N,j,ee,se,ge,pe,Ee){if(ee/=N,ge>=(j/=N)&&pe<ee)return ie;if(pe<j||ge>=ee)return null;for(var we=[],Se=0;Se<ie.length;Se++){var $e=ie[Se],je=$e.geometry,He=$e.type,Tt=se===0?$e.minX:$e.minY,ft=se===0?$e.maxX:$e.maxY;if(Tt>=j&&ft<ee)we.push($e);else if(!(ft<j||Tt>=ee)){var wt=[];if(He==="Point"||He==="MultiPoint")kt(je,wt,j,ee,se);else if(He==="LineString")zi(je,wt,j,ee,se,!1,Ee.lineMetrics);else if(He==="MultiLineString")Kr(je,wt,j,ee,se,!1);else if(He==="Polygon")Kr(je,wt,j,ee,se,!0);else if(He==="MultiPolygon")for(var It=0;It<je.length;It++){var xi=[];Kr(je[It],xi,j,ee,se,!0),xi.length&&wt.push(xi)}if(wt.length){if(Ee.lineMetrics&&He==="LineString"){for(It=0;It<wt.length;It++)we.push(st($e.id,He,wt[It],$e.tags));continue}He!=="LineString"&&He!=="MultiLineString"||(wt.length===1?(He="LineString",wt=wt[0]):He="MultiLineString"),He!=="Point"&&He!=="MultiPoint"||(He=wt.length===3?"Point":"MultiPoint"),we.push(st($e.id,He,wt,$e.tags))}}}return we.length?we:null}function kt(ie,N,j,ee,se){for(var ge=0;ge<ie.length;ge+=3){var pe=ie[ge+se];pe>=j&&pe<=ee&&(N.push(ie[ge]),N.push(ie[ge+1]),N.push(ie[ge+2]))}}function zi(ie,N,j,ee,se,ge,pe){for(var Ee,we,Se=Ei(ie),$e=se===0?yi:Mo,je=ie.start,He=0;He<ie.length-3;He+=3){var Tt=ie[He],ft=ie[He+1],wt=ie[He+2],It=ie[He+3],xi=ie[He+4],Qt=se===0?Tt:ft,ni=se===0?It:xi,$t=!1;pe&&(Ee=Math.sqrt(Math.pow(Tt-It,2)+Math.pow(ft-xi,2))),Qt<j?ni>j&&(we=$e(Se,Tt,ft,It,xi,j),pe&&(Se.start=je+Ee*we)):Qt>ee?ni<ee&&(we=$e(Se,Tt,ft,It,xi,ee),pe&&(Se.start=je+Ee*we)):fn(Se,Tt,ft,wt),ni<j&&Qt>=j&&(we=$e(Se,Tt,ft,It,xi,j),$t=!0),ni>ee&&Qt<=ee&&(we=$e(Se,Tt,ft,It,xi,ee),$t=!0),!ge&&$t&&(pe&&(Se.end=je+Ee*we),N.push(Se),Se=Ei(ie)),pe&&(je+=Ee)}var Mt=ie.length-3;Tt=ie[Mt],ft=ie[Mt+1],wt=ie[Mt+2],(Qt=se===0?Tt:ft)>=j&&Qt<=ee&&fn(Se,Tt,ft,wt),Mt=Se.length-3,ge&&Mt>=3&&(Se[Mt]!==Se[0]||Se[Mt+1]!==Se[1])&&fn(Se,Se[0],Se[1],Se[2]),Se.length&&N.push(Se)}function Ei(ie){var N=[];return N.size=ie.size,N.start=ie.start,N.end=ie.end,N}function Kr(ie,N,j,ee,se,ge){for(var pe=0;pe<ie.length;pe++)zi(ie[pe],N,j,ee,se,ge,!1)}function fn(ie,N,j,ee){ie.push(N),ie.push(j),ie.push(ee)}function yi(ie,N,j,ee,se,ge){var pe=(ge-N)/(ee-N);return ie.push(ge),ie.push(j+(se-j)*pe),ie.push(1),pe}function Mo(ie,N,j,ee,se,ge){var pe=(ge-j)/(se-j);return ie.push(N+(ee-N)*pe),ie.push(ge),ie.push(1),pe}function Wn(ie,N){for(var j=[],ee=0;ee<ie.length;ee++){var se,ge=ie[ee],pe=ge.type;if(pe==="Point"||pe==="MultiPoint"||pe==="LineString")se=ar(ge.geometry,N);else if(pe==="MultiLineString"||pe==="Polygon"){se=[];for(var Ee=0;Ee<ge.geometry.length;Ee++)se.push(ar(ge.geometry[Ee],N))}else if(pe==="MultiPolygon")for(se=[],Ee=0;Ee<ge.geometry.length;Ee++){for(var we=[],Se=0;Se<ge.geometry[Ee].length;Se++)we.push(ar(ge.geometry[Ee][Se],N));se.push(we)}j.push(st(ge.id,pe,se,ge.tags))}return j}function ar(ie,N){var j=[];j.size=ie.size,ie.start!==void 0&&(j.start=ie.start,j.end=ie.end);for(var ee=0;ee<ie.length;ee+=3)j.push(ie[ee]+N,ie[ee+1],ie[ee+2]);return j}function J(ie,N){if(ie.transformed)return ie;var j,ee,se,ge=1<<ie.z,pe=ie.x,Ee=ie.y;for(j=0;j<ie.features.length;j++){var we=ie.features[j],Se=we.geometry,$e=we.type;if(we.geometry=[],$e===1)for(ee=0;ee<Se.length;ee+=2)we.geometry.push(te(Se[ee],Se[ee+1],N,ge,pe,Ee));else for(ee=0;ee<Se.length;ee++){var je=[];for(se=0;se<Se[ee].length;se+=2)je.push(te(Se[ee][se],Se[ee][se+1],N,ge,pe,Ee));we.geometry.push(je)}}return ie.transformed=!0,ie}function te(ie,N,j,ee,se,ge){return[Math.round(j*(ie*ee-se)),Math.round(j*(N*ee-ge))]}function oe(ie,N,j,ee,se){for(var ge=N===se.maxZoom?0:se.tolerance/((1<<N)*se.extent),pe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:j,y:ee,z:N,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ee=0;Ee<ie.length;Ee++){pe.numFeatures++,me(pe,ie[Ee],ge,se);var we=ie[Ee].minX,Se=ie[Ee].minY,$e=ie[Ee].maxX,je=ie[Ee].maxY;we<pe.minX&&(pe.minX=we),Se<pe.minY&&(pe.minY=Se),$e>pe.maxX&&(pe.maxX=$e),je>pe.maxY&&(pe.maxY=je)}return pe}function me(ie,N,j,ee){var se=N.geometry,ge=N.type,pe=[];if(ge==="Point"||ge==="MultiPoint")for(var Ee=0;Ee<se.length;Ee+=3)pe.push(se[Ee]),pe.push(se[Ee+1]),ie.numPoints++,ie.numSimplified++;else if(ge==="LineString")Te(pe,se,ie,j,!1,!1);else if(ge==="MultiLineString"||ge==="Polygon")for(Ee=0;Ee<se.length;Ee++)Te(pe,se[Ee],ie,j,ge==="Polygon",Ee===0);else if(ge==="MultiPolygon")for(var we=0;we<se.length;we++){var Se=se[we];for(Ee=0;Ee<Se.length;Ee++)Te(pe,Se[Ee],ie,j,!0,Ee===0)}if(pe.length){var $e=N.tags||null;if(ge==="LineString"&&ee.lineMetrics){for(var je in $e={},N.tags)$e[je]=N.tags[je];$e.mapbox_clip_start=se.start/se.size,$e.mapbox_clip_end=se.end/se.size}var He={geometry:pe,type:ge==="Polygon"||ge==="MultiPolygon"?3:ge==="LineString"||ge==="MultiLineString"?2:1,tags:$e};N.id!==null&&(He.id=N.id),ie.features.push(He)}}function Te(ie,N,j,ee,se,ge){var pe=ee*ee;if(ee>0&&N.size<(se?pe:ee))j.numPoints+=N.length/3;else{for(var Ee=[],we=0;we<N.length;we+=3)(ee===0||N[we+2]>pe)&&(j.numSimplified++,Ee.push(N[we]),Ee.push(N[we+1])),j.numPoints++;se&&function(Se,$e){for(var je=0,He=0,Tt=Se.length,ft=Tt-2;He<Tt;ft=He,He+=2)je+=(Se[He]-Se[ft])*(Se[He+1]+Se[ft+1]);if(je>0===$e)for(He=0,Tt=Se.length;He<Tt/2;He+=2){var wt=Se[He],It=Se[He+1];Se[He]=Se[Tt-2-He],Se[He+1]=Se[Tt-1-He],Se[Tt-2-He]=wt,Se[Tt-1-He]=It}}(Ee,ge),ie.push(Ee)}}function Re(ie,N){var j=(N=this.options=function(se,ge){for(var pe in ge)se[pe]=ge[pe];return se}(Object.create(this.options),N)).debug;if(j&&console.time("preprocess data"),N.maxZoom<0||N.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(N.promoteId&&N.generateId)throw new Error("promoteId and generateId cannot be used together.");var ee=function(se,ge){var pe=[];if(se.type==="FeatureCollection")for(var Ee=0;Ee<se.features.length;Ee++)Vo(pe,se.features[Ee],ge,Ee);else Vo(pe,se.type==="Feature"?se:{geometry:se},ge);return pe}(ie,N);this.tiles={},this.tileCoords=[],j&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",N.indexMaxZoom,N.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ee=function(se,ge){var pe=ge.buffer/ge.extent,Ee=se,we=ur(se,1,-1-pe,pe,0,-1,2,ge),Se=ur(se,1,1-pe,2+pe,0,-1,2,ge);return(we||Se)&&(Ee=ur(se,1,-pe,1+pe,0,-1,2,ge)||[],we&&(Ee=Wn(we,1).concat(Ee)),Se&&(Ee=Ee.concat(Wn(Se,-1)))),Ee}(ee,N),ee.length&&this.splitTile(ee,0,0,0),j&&(ee.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Oe(ie,N,j){return 32*((1<<ie)*j+N)+ie}function fe(ie,N){const j=ie.tileID.canonical;if(!this._geoJSONIndex)return N(null,null);const ee=this._geoJSONIndex.getTile(j.z,j.x,j.y);if(!ee)return N(null,null);const se=new Zt(ee.features);let ge=cn(se);ge.byteOffset===0&&ge.byteLength===ge.buffer.byteLength||(ge=new Uint8Array(ge)),N(null,{vectorTile:se,rawData:ge.buffer})}Re.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Re.prototype.splitTile=function(ie,N,j,ee,se,ge,pe){for(var Ee=[ie,N,j,ee],we=this.options,Se=we.debug;Ee.length;){ee=Ee.pop(),j=Ee.pop(),N=Ee.pop(),ie=Ee.pop();var $e=1<<N,je=Oe(N,j,ee),He=this.tiles[je];if(!He&&(Se>1&&console.time("creation"),He=this.tiles[je]=oe(ie,N,j,ee,we),this.tileCoords.push({z:N,x:j,y:ee}),Se)){Se>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",N,j,ee,He.numFeatures,He.numPoints,He.numSimplified),console.timeEnd("creation"));var Tt="z"+N;this.stats[Tt]=(this.stats[Tt]||0)+1,this.total++}if(He.source=ie,se){if(N===we.maxZoom||N===se)continue;var ft=1<<se-N;if(j!==Math.floor(ge/ft)||ee!==Math.floor(pe/ft))continue}else if(N===we.indexMaxZoom||He.numPoints<=we.indexMaxPoints)continue;if(He.source=null,ie.length!==0){Se>1&&console.time("clipping");var wt,It,xi,Qt,ni,$t,Mt=.5*we.buffer/we.extent,di=.5-Mt,qi=.5+Mt,jr=1+Mt;wt=It=xi=Qt=null,ni=ur(ie,$e,j-Mt,j+qi,0,He.minX,He.maxX,we),$t=ur(ie,$e,j+di,j+jr,0,He.minX,He.maxX,we),ie=null,ni&&(wt=ur(ni,$e,ee-Mt,ee+qi,1,He.minY,He.maxY,we),It=ur(ni,$e,ee+di,ee+jr,1,He.minY,He.maxY,we),ni=null),$t&&(xi=ur($t,$e,ee-Mt,ee+qi,1,He.minY,He.maxY,we),Qt=ur($t,$e,ee+di,ee+jr,1,He.minY,He.maxY,we),$t=null),Se>1&&console.timeEnd("clipping"),Ee.push(wt||[],N+1,2*j,2*ee),Ee.push(It||[],N+1,2*j,2*ee+1),Ee.push(xi||[],N+1,2*j+1,2*ee),Ee.push(Qt||[],N+1,2*j+1,2*ee+1)}}},Re.prototype.getTile=function(ie,N,j){var ee=this.options,se=ee.extent,ge=ee.debug;if(ie<0||ie>24)return null;var pe=1<<ie,Ee=Oe(ie,N=(N%pe+pe)%pe,j);if(this.tiles[Ee])return J(this.tiles[Ee],se);ge>1&&console.log("drilling down to z%d-%d-%d",ie,N,j);for(var we,Se=ie,$e=N,je=j;!we&&Se>0;)Se--,$e=Math.floor($e/2),je=Math.floor(je/2),we=this.tiles[Oe(Se,$e,je)];return we&&we.source?(ge>1&&console.log("found parent tile z%d-%d-%d",Se,$e,je),ge>1&&console.time("drilling down"),this.splitTile(we.source,Se,$e,je,ie,N,j),ge>1&&console.timeEnd("drilling down"),this.tiles[Ee]?J(this.tiles[Ee],se):null):null};class Pe extends St{constructor(N,j,ee,se){super(N,j,ee,fe),se&&(this.loadGeoJSON=se)}loadData(N,j){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=j,this._pendingLoadDataParams=N,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())}_loadData(){if(!this._pendingCallback||!this._pendingLoadDataParams)return;const N=this._pendingCallback,j=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;const ee=!!(j&&j.request&&j.request.collectResourceTiming)&&new g.RequestPerformance(j.request);this.loadGeoJSON(j,(se,ge)=>{if(se||!ge)return N(se);if(typeof ge!="object")return N(new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`));{Xt(ge,!0);try{if(j.filter){const Ee=g.createExpression(j.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ee.result==="error")throw new Error(Ee.value.map(Se=>`${Se.key}: ${Se.message}`).join(", "));const we=ge.features.filter(Se=>Ee.value.evaluate({zoom:0},Se));ge={type:"FeatureCollection",features:we}}this._geoJSONIndex=j.cluster?new pn(function({superclusterOptions:Ee,clusterProperties:we}){if(!we||!Ee)return Ee;const Se={},$e={},je={accumulated:null,zoom:0},He={properties:null},Tt=Object.keys(we);for(const ft of Tt){const[wt,It]=we[ft],xi=g.createExpression(It),Qt=g.createExpression(typeof wt=="string"?[wt,["accumulated"],["get",ft]]:wt);Se[ft]=xi.value,$e[ft]=Qt.value}return Ee.map=ft=>{He.properties=ft;const wt={};for(const It of Tt)wt[It]=Se[It].evaluate(je,He);return wt},Ee.reduce=(ft,wt)=>{He.properties=wt;for(const It of Tt)je.accumulated=ft[It],ft[It]=$e[It].evaluate(je,He)},Ee}(j)).load(ge.features):function(Ee,we){return new Re(Ee,we)}(ge,j.geojsonVtOptions)}catch(Ee){return N(Ee)}this.loaded={};const pe={};if(ee){const Ee=ee.finish();Ee&&(pe.resourceTiming={},pe.resourceTiming[j.source]=JSON.parse(JSON.stringify(Ee)))}N(null,pe)}})}coalesce(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())}reloadTile(N,j){const ee=this.loaded;return ee&&ee[N.uid]?super.reloadTile(N,j):this.loadTile(N,j)}loadGeoJSON(N,j){if(N.request)g.getJSON(N.request,j);else{if(typeof N.data!="string")return j(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`));try{return j(null,JSON.parse(N.data))}catch{return j(new Error(`Input data given to '${N.source}' is not a valid GeoJSON object.`))}}}removeSource(N,j){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),j()}getClusterExpansionZoom(N,j){try{j(null,this._geoJSONIndex.getClusterExpansionZoom(N.clusterId))}catch(ee){j(ee)}}getClusterChildren(N,j){try{j(null,this._geoJSONIndex.getChildren(N.clusterId))}catch(ee){j(ee)}}getClusterLeaves(N,j){try{j(null,this._geoJSONIndex.getLeaves(N.clusterId,N.limit,N.offset))}catch(ee){j(ee)}}}class Xe{constructor(N){this.self=N,this.actor=new g.Actor(N,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:St,geojson:Pe},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(j,ee)=>{if(this.workerSourceTypes[j])throw new Error(`Worker source with name "${j}" already registered.`);this.workerSourceTypes[j]=ee},this.self.registerRTLTextPlugin=j=>{if(g.plugin.isParsed())throw new Error("RTL text plugin already registered.");g.plugin.applyArabicShaping=j.applyArabicShaping,g.plugin.processBidirectionalText=j.processBidirectionalText,g.plugin.processStyledBidirectionalText=j.processStyledBidirectionalText}}setReferrer(N,j){this.referrer=j}setImages(N,j,ee){this.availableImages[N]=j;for(const se in this.workerSources[N]){const ge=this.workerSources[N][se];for(const pe in ge)ge[pe].availableImages=j}ee()}setLayers(N,j,ee){this.getLayerIndex(N).replace(j),ee()}updateLayers(N,j,ee){this.getLayerIndex(N).update(j.layers,j.removedIds),ee()}loadTile(N,j,ee){this.getWorkerSource(N,j.type,j.source).loadTile(j,ee)}loadDEMTile(N,j,ee){this.getDEMWorkerSource(N,j.source).loadTile(j,ee)}reloadTile(N,j,ee){this.getWorkerSource(N,j.type,j.source).reloadTile(j,ee)}abortTile(N,j,ee){this.getWorkerSource(N,j.type,j.source).abortTile(j,ee)}removeTile(N,j,ee){this.getWorkerSource(N,j.type,j.source).removeTile(j,ee)}removeDEMTile(N,j){this.getDEMWorkerSource(N,j.source).removeTile(j)}removeSource(N,j,ee){if(!this.workerSources[N]||!this.workerSources[N][j.type]||!this.workerSources[N][j.type][j.source])return;const se=this.workerSources[N][j.type][j.source];delete this.workerSources[N][j.type][j.source],se.removeSource!==void 0?se.removeSource(j,ee):ee()}loadWorkerSource(N,j,ee){try{this.self.importScripts(j.url),ee()}catch(se){ee(se.toString())}}syncRTLPluginState(N,j,ee){try{g.plugin.setState(j);const se=g.plugin.getPluginURL();if(g.plugin.isLoaded()&&!g.plugin.isParsed()&&se!=null){this.self.importScripts(se);const ge=g.plugin.isParsed();ee(ge?void 0:new Error(`RTL Text Plugin failed to import scripts from ${se}`),ge)}}catch(se){ee(se.toString())}}getAvailableImages(N){let j=this.availableImages[N];return j||(j=[]),j}getLayerIndex(N){let j=this.layerIndexes[N];return j||(j=this.layerIndexes[N]=new he),j}getWorkerSource(N,j,ee){if(this.workerSources[N]||(this.workerSources[N]={}),this.workerSources[N][j]||(this.workerSources[N][j]={}),!this.workerSources[N][j][ee]){const se={send:(ge,pe,Ee)=>{this.actor.send(ge,pe,Ee,N)}};this.workerSources[N][j][ee]=new this.workerSourceTypes[j](se,this.getLayerIndex(N),this.getAvailableImages(N))}return this.workerSources[N][j][ee]}getDEMWorkerSource(N,j){return this.demWorkerSources[N]||(this.demWorkerSources[N]={}),this.demWorkerSources[N][j]||(this.demWorkerSources[N][j]=new vt),this.demWorkerSources[N][j]}enforceCacheSizeLimit(N,j){g.enforceCacheSizeLimit(j)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Xe(self)),Xe}),H(["./shared"],function(g){var Z=ve;function ve(b){return!function(n){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var x,E,z=new Blob([""],{type:"text/javascript"}),R=URL.createObjectURL(z);try{E=new Worker(R),x=!0}catch{x=!1}return E&&E.terminate(),URL.revokeObjectURL(R),x}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var x=document.createElement("canvas");x.width=x.height=1;var E=x.getContext("2d");if(!E)return!1;var z=E.getImageData(0,0,1,1);return z&&z.width===x.width}()?(he[h=n&&n.failIfMajorPerformanceCaveat]===void 0&&(he[h]=function(x){var E,z=function(R){var V=document.createElement("canvas"),G=Object.create(ve.webGLContextAttributes);return G.failIfMajorPerformanceCaveat=R,V.getContext("webgl",G)||V.getContext("experimental-webgl",G)}(x);if(!z)return!1;try{E=z.createShader(z.VERTEX_SHADER)}catch{return!1}return!(!E||z.isContextLost())&&(z.shaderSource(E,"void main() {}"),z.compileShader(E),z.getShaderParameter(E,z.COMPILE_STATUS)===!0)}(h)),he[h]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var h}(b)}var he={};function ye(b,n){if(Array.isArray(b)){if(!Array.isArray(n)||b.length!==n.length)return!1;for(let h=0;h<b.length;h++)if(!ye(b[h],n[h]))return!1;return!0}if(typeof b=="object"&&b!==null&&n!==null){if(typeof n!="object"||Object.keys(b).length!==Object.keys(n).length)return!1;for(const h in b)if(!ye(b[h],n[h]))return!1;return!0}return b===n}ve.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class re{static testProp(n){if(!re.docStyle)return n[0];for(let h=0;h<n.length;h++)if(n[h]in re.docStyle)return n[h];return n[0]}static create(n,h,x){const E=window.document.createElement(n);return h!==void 0&&(E.className=h),x&&x.appendChild(E),E}static createNS(n,h){return window.document.createElementNS(n,h)}static disableDrag(){re.docStyle&&re.selectProp&&(re.userSelect=re.docStyle[re.selectProp],re.docStyle[re.selectProp]="none")}static enableDrag(){re.docStyle&&re.selectProp&&(re.docStyle[re.selectProp]=re.userSelect)}static setTransform(n,h){n.style[re.transformProp]=h}static addEventListener(n,h,x,E={}){n.addEventListener(h,x,"passive"in E?E:E.capture)}static removeEventListener(n,h,x,E={}){n.removeEventListener(h,x,"passive"in E?E:E.capture)}static suppressClickInternal(n){n.preventDefault(),n.stopPropagation(),window.removeEventListener("click",re.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",re.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",re.suppressClickInternal,!0)},0)}static mousePos(n,h){const x=n.getBoundingClientRect();return new g.pointGeometry(h.clientX-x.left-n.clientLeft,h.clientY-x.top-n.clientTop)}static touchPos(n,h){const x=n.getBoundingClientRect(),E=[];for(let z=0;z<h.length;z++)E.push(new g.pointGeometry(h[z].clientX-x.left-n.clientLeft,h[z].clientY-x.top-n.clientTop));return E}static mouseButton(n){return n.button}static remove(n){n.parentNode&&n.parentNode.removeChild(n)}}re.docStyle=typeof window!="undefined"&&window.document&&window.document.documentElement.style,re.selectProp=re.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),re.transformProp=re.testProp(["transform","WebkitTransform"]);class it{constructor(n){this._transformRequestFn=n}transformRequest(n,h){return this._transformRequestFn&&this._transformRequestFn(n,h)||{url:n}}normalizeSpriteURL(n,h,x){const E=function(z){const R=z.match(et);if(!R)throw new Error(`Unable to parse URL "${z}"`);return{protocol:R[1],authority:R[2],path:R[3]||"/",params:R[4]?R[4].split("&"):[]}}(n);return E.path+=`${h}${x}`,function(z){const R=z.params.length?`?${z.params.join("&")}`:"";return`${z.protocol}://${z.authority}${z.path}${R}`}(E)}setTransformRequest(n){this._transformRequestFn=n}}const et=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function St(b){var n=new g.ARRAY_TYPE(3);return n[0]=b[0],n[1]=b[1],n[2]=b[2],n}var vt,Xt=function(b,n,h){return b[0]=n[0]-h[0],b[1]=n[1]-h[1],b[2]=n[2]-h[2],b};vt=new g.ARRAY_TYPE(3),g.ARRAY_TYPE!=Float32Array&&(vt[0]=0,vt[1]=0,vt[2]=0);var Wt=function(b){var n=b[0],h=b[1];return n*n+h*h};(function(){var b=new g.ARRAY_TYPE(2);g.ARRAY_TYPE!=Float32Array&&(b[0]=0,b[1]=0)})();class _t{constructor(n,h,x,E){this.context=n,this.format=x,this.texture=n.gl.createTexture(),this.update(h,E)}update(n,h,x){const{width:E,height:z}=n,R=!(this.size&&this.size[0]===E&&this.size[1]===z||x),{context:V}=this,{gl:G}=V;if(this.useMipmap=Boolean(h&&h.useMipmap),G.bindTexture(G.TEXTURE_2D,this.texture),V.pixelStoreUnpackFlipY.set(!1),V.pixelStoreUnpack.set(1),V.pixelStoreUnpackPremultiplyAlpha.set(this.format===G.RGBA&&(!h||h.premultiply!==!1)),R)this.size=[E,z],n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||g.isImageBitmap(n)?G.texImage2D(G.TEXTURE_2D,0,this.format,this.format,G.UNSIGNED_BYTE,n):G.texImage2D(G.TEXTURE_2D,0,this.format,E,z,0,this.format,G.UNSIGNED_BYTE,n.data);else{const{x:K,y:Q}=x||{x:0,y:0};n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||g.isImageBitmap(n)?G.texSubImage2D(G.TEXTURE_2D,0,K,Q,G.RGBA,G.UNSIGNED_BYTE,n):G.texSubImage2D(G.TEXTURE_2D,0,K,Q,E,z,G.RGBA,G.UNSIGNED_BYTE,n.data)}this.useMipmap&&this.isSizePowerOfTwo()&&G.generateMipmap(G.TEXTURE_2D)}bind(n,h,x){const{context:E}=this,{gl:z}=E;z.bindTexture(z.TEXTURE_2D,this.texture),x!==z.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(x=z.LINEAR),n!==this.filter&&(z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MAG_FILTER,n),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MIN_FILTER,x||n),this.filter=n),h!==this.wrap&&(z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_S,h),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}function ui(b){const{userImage:n}=b;return!!(n&&n.render&&n.render())&&(b.data.replace(new Uint8Array(n.data.buffer)),!0)}class qt extends g.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new g.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:h,callback:x}of this.requestors)this._notify(h,x);this.requestors=[]}}getImage(n){return this.images[n]}addImage(n,h){this._validate(n,h)&&(this.images[n]=h)}_validate(n,h){let x=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new g.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),x=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new g.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),x=!1),this._validateContent(h.content,h)||(this.fire(new g.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),x=!1),x}_validateStretch(n,h){if(!n)return!0;let x=0;for(const E of n){if(E[0]<x||E[1]<E[0]||h<E[1])return!1;x=E[1]}return!0}_validateContent(n,h){return!(n&&(n.length!==4||n[0]<0||h.data.width<n[0]||n[1]<0||h.data.height<n[1]||n[2]<0||h.data.width<n[2]||n[3]<0||h.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,h){h.version=this.images[n].version+1,this.images[n]=h,this.updatedImages[n]=!0}removeImage(n){const h=this.images[n];delete this.images[n],delete this.patterns[n],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,h){let x=!0;if(!this.isLoaded())for(const E of n)this.images[E]||(x=!1);this.isLoaded()||x?this._notify(n,h):this.requestors.push({ids:n,callback:h})}_notify(n,h){const x={};for(const E of n){this.images[E]||this.fire(new g.Event("styleimagemissing",{id:E}));const z=this.images[E];z?x[E]={data:z.data.clone(),pixelRatio:z.pixelRatio,sdf:z.sdf,version:z.version,stretchX:z.stretchX,stretchY:z.stretchY,content:z.content,hasRenderCallback:Boolean(z.userImage&&z.userImage.render)}:g.warnOnce(`Image "${E}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,x)}getPixelSize(){const{width:n,height:h}=this.atlasImage;return{width:n,height:h}}getPattern(n){const h=this.patterns[n],x=this.getImage(n);if(!x)return null;if(h&&h.position.version===x.version)return h.position;if(h)h.position.version=x.version;else{const E={w:x.data.width+2,h:x.data.height+2,x:0,y:0},z=new g.ImagePosition(E,x);this.patterns[n]={bin:E,position:z}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const h=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new _t(n,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const z in this.patterns)n.push(this.patterns[z].bin);const{w:h,h:x}=g.potpack(n),E=this.atlasImage;E.resize({width:h||1,height:x||1});for(const z in this.patterns){const{bin:R}=this.patterns[z],V=R.x+1,G=R.y+1,K=this.images[z].data,Q=K.width,ae=K.height;g.RGBAImage.copy(K,E,{x:0,y:0},{x:V,y:G},{width:Q,height:ae}),g.RGBAImage.copy(K,E,{x:0,y:ae-1},{x:V,y:G-1},{width:Q,height:1}),g.RGBAImage.copy(K,E,{x:0,y:0},{x:V,y:G+ae},{width:Q,height:1}),g.RGBAImage.copy(K,E,{x:Q-1,y:0},{x:V-1,y:G},{width:1,height:ae}),g.RGBAImage.copy(K,E,{x:0,y:0},{x:V+Q,y:G},{width:1,height:ae})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const h of n){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const x=this.images[h];ui(x)&&this.updateImage(h,x)}}}const Zt=1e20;function si(b,n,h,x,E,z,R,V,G){for(let K=n;K<n+x;K++)Wi(b,h*z+K,z,E,R,V,G);for(let K=h;K<h+E;K++)Wi(b,K*z+n,1,x,R,V,G)}function Wi(b,n,h,x,E,z,R){z[0]=0,R[0]=-Zt,R[1]=Zt,E[0]=b[n];for(let V=1,G=0,K=0;V<x;V++){E[V]=b[n+V*h];const Q=V*V;do{const ae=z[G];K=(E[V]-E[ae]+Q-ae*ae)/(V-ae)/2}while(K<=R[G]&&--G>-1);G++,z[G]=V,R[G]=K,R[G+1]=Zt}for(let V=0,G=0;V<x;V++){for(;R[G+1]<V;)G++;const K=z[G],Q=V-K;b[n+V*h]=E[K]+Q*Q}}class Gi{constructor(n,h){this.requestManager=n,this.localIdeographFontFamily=h,this.entries={}}setURL(n){this.url=n}getGlyphs(n,h){const x=[];for(const E in n)for(const z of n[E])x.push({stack:E,id:z});g.asyncAll(x,({stack:E,id:z},R)=>{let V=this.entries[E];V||(V=this.entries[E]={glyphs:{},requests:{},ranges:{}});let G=V.glyphs[z];if(G!==void 0)return void R(null,{stack:E,id:z,glyph:G});if(G=this._tinySDF(V,E,z),G)return V.glyphs[z]=G,void R(null,{stack:E,id:z,glyph:G});const K=Math.floor(z/256);if(256*K>65535)return void R(new Error("glyphs > 65535 not supported"));if(V.ranges[K])return void R(null,{stack:E,id:z,glyph:G});let Q=V.requests[K];Q||(Q=V.requests[K]=[],Gi.loadGlyphRange(E,K,this.url,this.requestManager,(ae,_e)=>{if(_e){for(const Le in _e)this._doesCharSupportLocalGlyph(+Le)||(V.glyphs[+Le]=_e[+Le]);V.ranges[K]=!0}for(const Le of Q)Le(ae,_e);delete V.requests[K]})),Q.push((ae,_e)=>{ae?R(ae):_e&&R(null,{stack:E,id:z,glyph:_e[z]||null})})},(E,z)=>{if(E)h(E);else if(z){const R={};for(const{stack:V,id:G,glyph:K}of z)(R[V]||(R[V]={}))[G]=K&&{id:K.id,bitmap:K.bitmap.clone(),metrics:K.metrics};h(null,R)}})}_doesCharSupportLocalGlyph(n){return!!this.localIdeographFontFamily&&(g.unicodeBlockLookup["CJK Unified Ideographs"](n)||g.unicodeBlockLookup["Hangul Syllables"](n)||g.unicodeBlockLookup.Hiragana(n)||g.unicodeBlockLookup.Katakana(n))}_tinySDF(n,h,x){const E=this.localIdeographFontFamily;if(!E||!this._doesCharSupportLocalGlyph(x))return;let z=n.tinySDF;if(!z){let V="400";/bold/i.test(h)?V="900":/medium/i.test(h)?V="500":/light/i.test(h)&&(V="200"),z=n.tinySDF=new Gi.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:E,fontWeight:V})}const R=z.draw(String.fromCharCode(x));return{id:x,bitmap:new g.AlphaImage({width:R.width||30,height:R.height||30},R.data),metrics:{width:R.glyphWidth||24,height:R.glyphHeight||24,left:R.glyphLeft||0,top:R.glyphTop-27||-8,advance:R.glyphAdvance||24}}}}Gi.loadGlyphRange=function(b,n,h,x,E){const z=256*n,R=z+255,V=x.transformRequest(h.replace("{fontstack}",b).replace("{range}",`${z}-${R}`),g.ResourceType.Glyphs);g.getArrayBuffer(V,(G,K)=>{if(G)E(G);else if(K){const Q={};for(const ae of g.parseGlyphPBF(K))Q[ae.id]=ae;E(null,Q)}})},Gi.TinySDF=class{constructor({fontSize:b=24,buffer:n=3,radius:h=8,cutoff:x=.25,fontFamily:E="sans-serif",fontWeight:z="normal",fontStyle:R="normal"}={}){this.buffer=n,this.cutoff=x,this.radius=h;const V=this.size=b+4*n,G=this._createCanvas(V),K=this.ctx=G.getContext("2d",{willReadFrequently:!0});K.font=`${R} ${z} ${b}px ${E}`,K.textBaseline="alphabetic",K.textAlign="left",K.fillStyle="black",this.gridOuter=new Float64Array(V*V),this.gridInner=new Float64Array(V*V),this.f=new Float64Array(V),this.z=new Float64Array(V+1),this.v=new Uint16Array(V)}_createCanvas(b){const n=document.createElement("canvas");return n.width=n.height=b,n}draw(b){const{width:n,actualBoundingBoxAscent:h,actualBoundingBoxDescent:x,actualBoundingBoxLeft:E,actualBoundingBoxRight:z}=this.ctx.measureText(b),R=Math.ceil(h),V=Math.min(this.size-this.buffer,Math.ceil(z-E)),G=Math.min(this.size-this.buffer,R+Math.ceil(x)),K=V+2*this.buffer,Q=G+2*this.buffer,ae=Math.max(K*Q,0),_e=new Uint8ClampedArray(ae),Le={data:_e,width:K,height:Q,glyphWidth:V,glyphHeight:G,glyphTop:R,glyphLeft:0,glyphAdvance:n};if(V===0||G===0)return Le;const{ctx:be,buffer:Me,gridInner:qe,gridOuter:Ne}=this;be.clearRect(Me,Me,V,G),be.fillText(b,Me,Me+R);const Ke=be.getImageData(Me,Me,V,G);Ne.fill(Zt,0,ae),qe.fill(0,0,ae);for(let Ze=0;Ze<G;Ze++)for(let ut=0;ut<V;ut++){const rt=Ke.data[4*(Ze*V+ut)+3]/255;if(rt===0)continue;const ot=(Ze+Me)*K+ut+Me;if(rt===1)Ne[ot]=0,qe[ot]=Zt;else{const yt=.5-rt;Ne[ot]=yt>0?yt*yt:0,qe[ot]=yt<0?yt*yt:0}}si(Ne,0,0,K,Q,K,this.f,this.v,this.z),si(qe,Me,Me,V,G,K,this.f,this.v,this.z);for(let Ze=0;Ze<ae;Ze++){const ut=Math.sqrt(Ne[Ze])-Math.sqrt(qe[Ze]);_e[Ze]=Math.round(255-255*(ut/this.radius+this.cutoff))}return Le}};const Zi=new g.Properties({anchor:new g.DataConstantProperty(g.spec.light.anchor),position:new class{constructor(){this.specification=g.spec.light.position}possiblyEvaluate(b,n){return g.sphericalToCartesian(b.expression.evaluate(n))}interpolate(b,n,h){return{x:g.number(b.x,n.x,h),y:g.number(b.y,n.y,h),z:g.number(b.z,n.z,h)}}},color:new g.DataConstantProperty(g.spec.light.color),intensity:new g.DataConstantProperty(g.spec.light.intensity)}),Ki="-transition";class Mr extends g.Evented{constructor(n){super(),this._transitionable=new g.Transitionable(Zi),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,h={}){if(!this._validate(g.validateLight,n,h))for(const x in n){const E=n[x];x.endsWith(Ki)?this._transitionable.setTransition(x.slice(0,-Ki.length),E):this._transitionable.setValue(x,E)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,h,x){return(!x||x.validate!==!1)&&g.emitValidationErrors(this,n.call(g.validateStyle,g.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:g.spec})))}}class Oi{constructor(n,h){this.width=n,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(n,h){const x=n.join(",")+String(h);return this.dashEntry[x]||(this.dashEntry[x]=this.addDash(n,h)),this.dashEntry[x]}getDashRanges(n,h,x){const E=[];let z=n.length%2==1?-n[n.length-1]*x:0,R=n[0]*x,V=!0;E.push({left:z,right:R,isDash:V,zeroLength:n[0]===0});let G=n[0];for(let K=1;K<n.length;K++){V=!V;const Q=n[K];z=G*x,G+=Q,R=G*x,E.push({left:z,right:R,isDash:V,zeroLength:Q===0})}return E}addRoundDash(n,h,x){const E=h/2;for(let z=-x;z<=x;z++){const R=this.width*(this.nextRow+x+z);let V=0,G=n[V];for(let K=0;K<this.width;K++){K/G.right>1&&(G=n[++V]);const Q=Math.abs(K-G.left),ae=Math.abs(K-G.right),_e=Math.min(Q,ae);let Le;const be=z/x*(E+1);if(G.isDash){const Me=E-Math.abs(be);Le=Math.sqrt(_e*_e+Me*Me)}else Le=E-Math.sqrt(_e*_e+be*be);this.data[R+K]=Math.max(0,Math.min(255,Le+128))}}}addRegularDash(n){for(let V=n.length-1;V>=0;--V){const G=n[V],K=n[V+1];G.zeroLength?n.splice(V,1):K&&K.isDash===G.isDash&&(K.left=G.left,n.splice(V,1))}const h=n[0],x=n[n.length-1];h.isDash===x.isDash&&(h.left=x.left-this.width,x.right=h.right+this.width);const E=this.width*this.nextRow;let z=0,R=n[z];for(let V=0;V<this.width;V++){V/R.right>1&&(R=n[++z]);const G=Math.abs(V-R.left),K=Math.abs(V-R.right),Q=Math.min(G,K);this.data[E+V]=Math.max(0,Math.min(255,(R.isDash?Q:-Q)+128))}}addDash(n,h){const x=h?7:0,E=2*x+1;if(this.nextRow+E>this.height)return g.warnOnce("LineAtlas out of space"),null;let z=0;for(let V=0;V<n.length;V++)z+=n[V];if(z!==0){const V=this.width/z,G=this.getDashRanges(n,this.width,V);h?this.addRoundDash(G,V,x):this.addRegularDash(G)}const R={y:(this.nextRow+x+.5)/this.height,height:2*x/this.height,width:z};return this.nextRow+=E,this.dirty=!0,R}bind(n){const h=n.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}class hr{constructor(n,h){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=g.uniqueId();const x=this.workerPool.acquire(this.id);for(let E=0;E<x.length;E++){const z=new hr.Actor(x[E],h,this.id);z.name=`Worker ${E}`,this.actors.push(z)}}broadcast(n,h,x){g.asyncAll(this.actors,(E,z)=>{E.send(n,h,z)},x=x||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}function eo(b,n,h){const x=function(E,z){if(E)return h(E);if(z){const R=g.pick(g.extend(z,b),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);z.vector_layers&&(R.vectorLayers=z.vector_layers,R.vectorLayerIds=R.vectorLayers.map(V=>V.id)),h(null,R)}};return b.url?g.getJSON(n.transformRequest(b.url,g.ResourceType.Source),x):g.exported.frame(()=>x(null,b))}hr.Actor=g.Actor;class ii{constructor(n,h,x){this.bounds=g.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=h||0,this.maxzoom=x||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const h=Math.pow(2,n.z),x=Math.floor(g.mercatorXfromLng(this.bounds.getWest())*h),E=Math.floor(g.mercatorYfromLat(this.bounds.getNorth())*h),z=Math.ceil(g.mercatorXfromLng(this.bounds.getEast())*h),R=Math.ceil(g.mercatorYfromLat(this.bounds.getSouth())*h);return n.x>=x&&n.x<z&&n.y>=E&&n.y<R}}class Lr extends g.Evented{constructor(n,h,x,E){if(super(),this.id=n,this.dispatcher=x,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,g.extend(this,g.pick(h,["url","scheme","tileSize","promoteId"])),this._options=g.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(E)}load(){this._loaded=!1,this.fire(new g.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=eo(this._options,this.map._requestManager,(n,h)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),n?this.fire(new g.ErrorEvent(n)):h&&(g.extend(this,h),h.bounds&&(this.tileBounds=new ii(h.bounds,this.minzoom,this.maxzoom)),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}setSourceProperty(n){this._tileJSONRequest&&this._tileJSONRequest.cancel(),n(),this.load()}setTiles(n){return this.setSourceProperty(()=>{this._options.tiles=n}),this}setUrl(n){return this.setSourceProperty(()=>{this.url=n,this._options.url=n}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return g.extend({},this._options)}loadTile(n,h){const x=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),E={request:this.map._requestManager.transformRequest(x,g.ResourceType.Tile),uid:n.uid,tileID:n.tileID,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function z(R,V){return delete n.request,n.aborted?h(null):R&&R.status!==404?h(R):(V&&V.resourceTiming&&(n.resourceTiming=V.resourceTiming),this.map._refreshExpiredTiles&&V&&n.setExpiryData(V),n.loadVectorData(V,this.map.painter),g.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}E.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired"?n.state==="loading"?n.reloadCallback=h:n.request=n.actor.send("reloadTile",E,z.bind(this)):(n.actor=this.dispatcher.getActor(),n.request=n.actor.send("loadTile",E,z.bind(this)))}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id},void 0)}unloadTile(n){n.unloadVectorData(),n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class un extends g.Evented{constructor(n,h,x,E){super(),this.id=n,this.dispatcher=x,this.setEventedParent(E),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=g.extend({type:"raster"},h),g.extend(this,g.pick(h,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new g.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=eo(this._options,this.map._requestManager,(n,h)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new g.ErrorEvent(n)):h&&(g.extend(this,h),h.bounds&&(this.tileBounds=new ii(h.bounds,this.minzoom,this.maxzoom)),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return g.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,h){const x=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);n.request=g.getImage(this.map._requestManager.transformRequest(x,g.ResourceType.Tile),(E,z,R)=>{if(delete n.request,n.aborted)n.state="unloaded",h(null);else if(E)n.state="errored",h(E);else if(z){this.map._refreshExpiredTiles&&n.setExpiryData(R);const V=this.map.painter.context,G=V.gl;n.texture=this.map.painter.getTileTexture(z.width),n.texture?n.texture.update(z,{useMipmap:!0}):(n.texture=new _t(V,z,G.RGBA,{useMipmap:!0}),n.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE,G.LINEAR_MIPMAP_NEAREST),V.extTextureFilterAnisotropic&&G.texParameterf(G.TEXTURE_2D,V.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,V.extTextureFilterAnisotropicMax)),n.state="loaded",g.cacheEntryPossiblyAdded(this.dispatcher),h(null)}})}abortTile(n,h){n.request&&(n.request.cancel(),delete n.request),h()}unloadTile(n,h){n.texture&&this.map.painter.saveTileTexture(n.texture),h()}hasTransition(){return!1}}let Fn;class Dr extends un{constructor(n,h,x,E){super(n,h,x,E),this.type="raster-dem",this.maxzoom=22,this._options=g.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(n,h){const x=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function E(z,R){z&&(n.state="errored",h(z)),R&&(n.dem=R,n.needsHillshadePrepare=!0,n.state="loaded",h(null))}n.request=g.getImage(this.map._requestManager.transformRequest(x,g.ResourceType.Tile),function(z,R){if(delete n.request,n.aborted)n.state="unloaded",h(null);else if(z)n.state="errored",h(z);else if(R){this.map._refreshExpiredTiles&&n.setExpiryData(R),delete R.cacheControl,delete R.expires;const V=g.isImageBitmap(R)&&(Fn==null&&(Fn=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Fn)?R:g.exported.getImageData(R,1),G={uid:n.uid,coord:n.tileID,source:this.id,rawImageData:V,encoding:this.encoding};n.actor&&n.state!=="expired"||(n.actor=this.dispatcher.getActor(),n.actor.send("loadDEMTile",G,E.bind(this)))}}.bind(this)),n.neighboringTiles=this._getNeighboringTiles(n.tileID)}_getNeighboringTiles(n){const h=n.canonical,x=Math.pow(2,h.z),E=(h.x-1+x)%x,z=h.x===0?n.wrap-1:n.wrap,R=(h.x+1+x)%x,V=h.x+1===x?n.wrap+1:n.wrap,G={};return G[new g.OverscaledTileID(n.overscaledZ,z,h.z,E,h.y).key]={backfilled:!1},G[new g.OverscaledTileID(n.overscaledZ,V,h.z,R,h.y).key]={backfilled:!1},h.y>0&&(G[new g.OverscaledTileID(n.overscaledZ,z,h.z,E,h.y-1).key]={backfilled:!1},G[new g.OverscaledTileID(n.overscaledZ,n.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},G[new g.OverscaledTileID(n.overscaledZ,V,h.z,R,h.y-1).key]={backfilled:!1}),h.y+1<x&&(G[new g.OverscaledTileID(n.overscaledZ,z,h.z,E,h.y+1).key]={backfilled:!1},G[new g.OverscaledTileID(n.overscaledZ,n.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},G[new g.OverscaledTileID(n.overscaledZ,V,h.z,R,h.y+1).key]={backfilled:!1}),G}unloadTile(n){n.demTexture&&this.map.painter.saveTileTexture(n.demTexture),n.fbo&&(n.fbo.destroy(),delete n.fbo),n.dem&&delete n.dem,delete n.neighboringTiles,n.state="unloaded",n.actor&&n.actor.send("removeDEMTile",{uid:n.uid,source:this.id})}}class Vr extends g.Evented{constructor(n,h,x,E){super(),this.id=n,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=x.getActor(),this.setEventedParent(E),this._data=h.data,this._options=g.extend({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const z=g.EXTENT/this.tileSize;this.workerOptions=g.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*z,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*z,extent:g.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:g.EXTENT,radius:(h.clusterRadius||50)*z,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(n){this.map=n,this.load()}setData(n){return this._data=n,this._updateWorkerData("content"),this}getClusterExpansionZoom(n,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:n,source:this.id},h),this}getClusterChildren(n,h){return this.actor.send("geojson.getClusterChildren",{clusterId:n,source:this.id},h),this}getClusterLeaves(n,h,x,E){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:n,limit:h,offset:x},E),this}_updateWorkerData(n){const h=g.extend({},this.workerOptions),x=this._data;typeof x=="string"?(h.request=this.map._requestManager.transformRequest(g.exported.resolveURL(x),g.ResourceType.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(x),this._pendingLoads++,this.fire(new g.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,h,(E,z)=>{if(this._pendingLoads--,this._removed||z&&z.abandoned)return;let R=null;if(z&&z.resourceTiming&&z.resourceTiming[this.id]&&(R=z.resourceTiming[this.id].slice(0)),this.actor.send(`${this.type}.coalesce`,{source:h.source},null),E)return void this.fire(new g.ErrorEvent(E));const V={dataType:"source",sourceDataType:n};this._collectResourceTiming&&R&&R.length>0&&g.extend(V,{resourceTiming:R}),this.fire(new g.Event("data",V))})}loaded(){return this._pendingLoads===0}loadTile(n,h){const x=n.actor?"reloadTile":"loadTile";n.actor=this.actor;const E={type:this.type,uid:n.uid,tileID:n.tileID,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};n.request=this.actor.send(x,E,(z,R)=>(delete n.request,n.unloadVectorData(),n.aborted?h(null):z?h(z):(n.loadVectorData(R,this.map.painter,x==="reloadTile"),h(null))))}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.aborted=!0}unloadTile(n){n.unloadVectorData(),this.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return g.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var nn=g.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class cn extends g.Evented{constructor(n,h,x,E){super(),this.id=n,this.dispatcher=x,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(E),this.options=h}load(n,h){this._loaded=!1,this.fire(new g.Event("dataloading",{dataType:"source"})),this.url=this.options.url,g.getImage(this.map._requestManager.transformRequest(this.url,g.ResourceType.Image),(x,E)=>{this._loaded=!0,x?this.fire(new g.ErrorEvent(x)):E&&(this.image=E,n&&(this.coordinates=n),h&&h(),this._finishLoading())})}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this.options.url=n.url,this.load(n.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}setCoordinates(n){this.coordinates=n;const h=n.map(g.MercatorCoordinate.fromLngLat);this.tileID=function(E){let z=1/0,R=1/0,V=-1/0,G=-1/0;for(const _e of E)z=Math.min(z,_e.x),R=Math.min(R,_e.y),V=Math.max(V,_e.x),G=Math.max(G,_e.y);const K=Math.max(V-z,G-R),Q=Math.max(0,Math.floor(-Math.log(K)/Math.LN2)),ae=Math.pow(2,Q);return new g.CanonicalTileID(Q,Math.floor((z+V)/2*ae),Math.floor((R+G)/2*ae))}(h),this.minzoom=this.maxzoom=this.tileID.z;const x=h.map(E=>this.tileID.getTilePoint(E)._round());return this._boundsArray=new g.RasterBoundsArray,this._boundsArray.emplaceBack(x[0].x,x[0].y,0,0),this._boundsArray.emplaceBack(x[1].x,x[1].y,g.EXTENT,0),this._boundsArray.emplaceBack(x[3].x,x[3].y,0,g.EXTENT),this._boundsArray.emplaceBack(x[2].x,x[2].y,g.EXTENT,g.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new g.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const n=this.map.painter.context,h=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,nn.members)),this.boundsSegments||(this.boundsSegments=g.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new _t(n,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));for(const x in this.tiles){const E=this.tiles[x];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture)}}loadTile(n,h){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},h(null)):(n.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class oi extends cn{constructor(n,h,x,E){super(n,h,x,E),this.roundZoom=!0,this.type="video",this.options=h}load(){this._loaded=!1;const n=this.options;this.urls=[];for(const h of n.urls)this.urls.push(this.map._requestManager.transformRequest(h,g.ResourceType.Source).url);g.getVideo(this.urls,(h,x)=>{this._loaded=!0,h?this.fire(new g.ErrorEvent(h)):x&&(this.video=x,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(n){if(this.video){const h=this.video.seekable;n<h.start(0)||n>h.end(0)?this.fire(new g.ErrorEvent(new g.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=n}}getVideo(){return this.video}onAdd(n){this.map||(this.map=n,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const n=this.map.painter.context,h=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,nn.members)),this.boundsSegments||(this.boundsSegments=g.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new _t(n,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));for(const x in this.tiles){const E=this.tiles[x];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class $r extends cn{constructor(n,h,x,E){super(n,h,x,E),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(z=>!Array.isArray(z)||z.length!==2||z.some(R=>typeof R!="number"))||this.fire(new g.ErrorEvent(new g.ValidationError(`sources.${n}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new g.ErrorEvent(new g.ValidationError(`sources.${n}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new g.ErrorEvent(new g.ValidationError(`sources.${n}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new g.ErrorEvent(new g.ValidationError(`sources.${n}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new g.ErrorEvent(new g.ValidationError(`sources.${n}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new g.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(n){this.map=n,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let n=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,n=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,n=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,x=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,nn.members)),this.boundsSegments||(this.boundsSegments=g.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(n||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new _t(h,this.canvas,x.RGBA,{premultiply:!0});for(const E in this.tiles){const z=this.tiles[E];z.state!=="loaded"&&(z.state="loaded",z.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const n of[this.canvas.width,this.canvas.height])if(isNaN(n)||n<=0)return!0;return!1}}const Hr={vector:Lr,raster:un,"raster-dem":Dr,geojson:Vr,video:oi,image:cn,canvas:$r};function wr(b,n){const h=g.create();return g.translate(h,h,[1,1,0]),g.scale(h,h,[.5*b.width,.5*b.height,1]),g.multiply(h,h,b.calculatePosMatrix(n.toUnwrapped()))}function hn(b,n,h,x,E,z){const R=function(ae,_e,Le){if(ae)for(const be of ae){const Me=_e[be];if(Me&&Me.source===Le&&Me.type==="fill-extrusion")return!0}else for(const be in _e){const Me=_e[be];if(Me.source===Le&&Me.type==="fill-extrusion")return!0}return!1}(E&&E.layers,n,b.id),V=z.maxPitchScaleFactor(),G=b.tilesIn(x,V,R);G.sort(Fi);const K=[];for(const ae of G)K.push({wrappedTileID:ae.tileID.wrapped().key,queryResults:ae.tile.queryRenderedFeatures(n,h,b._state,ae.queryGeometry,ae.cameraQueryGeometry,ae.scale,E,z,V,wr(b.transform,ae.tileID))});const Q=function(ae){const _e={},Le={};for(const be of ae){const Me=be.queryResults,qe=be.wrappedTileID,Ne=Le[qe]=Le[qe]||{};for(const Ke in Me){const Ze=Me[Ke],ut=Ne[Ke]=Ne[Ke]||{},rt=_e[Ke]=_e[Ke]||[];for(const ot of Ze)ut[ot.featureIndex]||(ut[ot.featureIndex]=!0,rt.push(ot))}}return _e}(K);for(const ae in Q)Q[ae].forEach(_e=>{const Le=_e.feature,be=b.getFeatureState(Le.layer["source-layer"],Le.id);Le.source=Le.layer.source,Le.layer["source-layer"]&&(Le.sourceLayer=Le.layer["source-layer"]),Le.state=be});return Q}function Fi(b,n){const h=b.tileID,x=n.tileID;return h.overscaledZ-x.overscaledZ||h.canonical.y-x.canonical.y||h.wrap-x.wrap||h.canonical.x-x.canonical.x}class Ut{constructor(n,h){this.tileID=n,this.uid=g.uniqueId(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(n){const h=n+this.timeAdded;h<g.exported.now()||this.fadeEndTime&&h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}loadVectorData(n,h,x){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(E,z){const R={};if(!z)return R;for(const V of E){const G=V.layerIds.map(K=>z.getLayer(K)).filter(Boolean);if(G.length!==0){V.layers=G,V.stateDependentLayerIds&&(V.stateDependentLayers=V.stateDependentLayerIds.map(K=>G.filter(Q=>Q.id===K)[0]));for(const K of G)R[K.id]=V}}return R}(n.buckets,h.style),this.hasSymbolBuckets=!1;for(const E in this.buckets){const z=this.buckets[E];if(z instanceof g.SymbolBucket){if(this.hasSymbolBuckets=!0,!x)break;z.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const E in this.buckets){const z=this.buckets[E];if(z instanceof g.SymbolBucket&&z.hasRTLText){this.hasRTLText=!0,g.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const E in this.buckets){const z=this.buckets[E];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(E).queryRadius(z))}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage)}else this.collisionBoxArray=new g.CollisionBoxArray}unloadVectorData(){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(n){return this.buckets[n.id]}upload(n){for(const x in this.buckets){const E=this.buckets[x];E.uploadPending()&&E.upload(n)}const h=n.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new _t(n,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new _t(n,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(n){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture)}queryRenderedFeatures(n,h,x,E,z,R,V,G,K,Q){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:E,cameraQueryGeometry:z,scale:R,tileSize:this.tileSize,pixelPosMatrix:Q,transform:G,params:V,queryPadding:this.queryPadding*K},n,h,x):{}}querySourceFeatures(n,h){const x=this.latestFeatureIndex;if(!x||!x.rawTileData)return;const E=x.loadVTLayers(),z=h?h.sourceLayer:"",R=E._geojsonTileLayer||E[z];if(!R)return;const V=g.createFilter(h&&h.filter),{z:G,x:K,y:Q}=this.tileID.canonical,ae={z:G,x:K,y:Q};for(let _e=0;_e<R.length;_e++){const Le=R.feature(_e);if(V.needGeometry){const qe=g.toEvaluationFeature(Le,!0);if(!V.filter(new g.EvaluationParameters(this.tileID.overscaledZ),qe,this.tileID.canonical))continue}else if(!V.filter(new g.EvaluationParameters(this.tileID.overscaledZ),Le))continue;const be=x.getId(Le,z),Me=new g.GeoJSONFeature(Le,G,K,Q,be);Me.tile=ae,n.push(Me)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){const h=this.expirationTime;if(n.cacheControl){const x=g.parseCacheControl(n.cacheControl);x["max-age"]&&(this.expirationTime=Date.now()+1e3*x["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const x=Date.now();let E=!1;if(this.expirationTime>x)E=!1;else if(h)if(this.expirationTime<h)E=!0;else{const z=this.expirationTime-h;z?this.expirationTime=x+Math.max(z,3e4):E=!0}else E=!0;E?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(n,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(n).length===0)return;const x=this.latestFeatureIndex.loadVTLayers();for(const E in this.buckets){if(!h.style.hasLayer(E))continue;const z=this.buckets[E],R=z.layers[0].sourceLayer||"_geojsonTileLayer",V=x[R],G=n[R];if(!V||!G||Object.keys(G).length===0)continue;z.update(G,V,this.imageAtlas&&this.imageAtlas.patternPositions||{});const K=h&&h.style&&h.style.getLayer(E);K&&(this.queryPadding=Math.max(this.queryPadding,K.queryRadius(z)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<g.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=g.exported.now()+n}setDependencies(n,h){const x={};for(const E of h)x[E]=!0;this.dependencies[n]=x}hasDependency(n,h){for(const x of n){const E=this.dependencies[x];if(E){for(const z of h)if(E[z])return!0}}return!1}}class Nr{constructor(n,h){this.max=n,this.onRemove=h,this.reset()}reset(){for(const n in this.data)for(const h of this.data[n])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(n,h,x){const E=n.wrapped().key;this.data[E]===void 0&&(this.data[E]=[]);const z={value:h,timeout:void 0};if(x!==void 0&&(z.timeout=setTimeout(()=>{this.remove(n,z)},x)),this.data[E].push(z),this.order.push(E),this.order.length>this.max){const R=this._getAndRemoveByKey(this.order[0]);R&&this.onRemove(R)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const h=this.data[n].shift();return h.timeout&&clearTimeout(h.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),h.value}getByKey(n){const h=this.data[n];return h?h[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,h){if(!this.has(n))return this;const x=n.wrapped().key,E=h===void 0?0:this.data[x].indexOf(h),z=this.data[x][E];return this.data[x].splice(E,1),z.timeout&&clearTimeout(z.timeout),this.data[x].length===0&&delete this.data[x],this.onRemove(z.value),this.order.splice(this.order.indexOf(x),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(n){const h=[];for(const x in this.data)for(const E of this.data[x])n(E.value)||h.push(E);for(const x of h)this.remove(x.value.tileID,x)}}class to{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,h,x){const E=String(h);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][E]=this.stateChanges[n][E]||{},g.extend(this.stateChanges[n][E],x),this.deletedStates[n]===null){this.deletedStates[n]={};for(const z in this.state[n])z!==E&&(this.deletedStates[n][z]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][E]===null){this.deletedStates[n][E]={};for(const z in this.state[n][E])x[z]||(this.deletedStates[n][E][z]=null)}else for(const z in x)this.deletedStates[n]&&this.deletedStates[n][E]&&this.deletedStates[n][E][z]===null&&delete this.deletedStates[n][E][z]}removeFeatureState(n,h,x){if(this.deletedStates[n]===null)return;const E=String(h);if(this.deletedStates[n]=this.deletedStates[n]||{},x&&h!==void 0)this.deletedStates[n][E]!==null&&(this.deletedStates[n][E]=this.deletedStates[n][E]||{},this.deletedStates[n][E][x]=null);else if(h!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][E])for(x in this.deletedStates[n][E]={},this.stateChanges[n][E])this.deletedStates[n][E][x]=null;else this.deletedStates[n][E]=null;else this.deletedStates[n]=null}getState(n,h){const x=String(h),E=g.extend({},(this.state[n]||{})[x],(this.stateChanges[n]||{})[x]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){const z=this.deletedStates[n][h];if(z===null)return{};for(const R in z)delete E[R]}return E}initializeTileState(n,h){n.setFeatureState(this.state,h)}coalesceChanges(n,h){const x={};for(const E in this.stateChanges){this.state[E]=this.state[E]||{};const z={};for(const R in this.stateChanges[E])this.state[E][R]||(this.state[E][R]={}),g.extend(this.state[E][R],this.stateChanges[E][R]),z[R]=this.state[E][R];x[E]=z}for(const E in this.deletedStates){this.state[E]=this.state[E]||{};const z={};if(this.deletedStates[E]===null)for(const R in this.state[E])z[R]={},this.state[E][R]={};else for(const R in this.deletedStates[E]){if(this.deletedStates[E][R]===null)this.state[E][R]={};else for(const V of Object.keys(this.deletedStates[E][R]))delete this.state[E][R][V];z[R]=this.state[E][R]}x[E]=x[E]||{},g.extend(x[E],z)}if(this.stateChanges={},this.deletedStates={},Object.keys(x).length!==0)for(const E in n)n[E].setFeatureState(x,h)}}class ci extends g.Evented{constructor(n,h,x){super(),this.id=n,this.dispatcher=x,this.on("data",E=>{E.dataType==="source"&&E.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&E.dataType==="source"&&E.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(E,z,R,V){const G=new Hr[z.type](E,z,R,V);if(G.id!==E)throw new Error(`Expected Source id to be ${E} instead of ${G.id}`);return g.bindAll(["load","abort","unload","serialize","prepare"],G),G}(n,h,x,this),this._tiles={},this._cache=new Nr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new to}onAdd(n){this.map=n,this._maxTileCacheSize=n?n._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(n)}onRemove(n){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(n)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles){const h=this._tiles[n];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,h){return this._source.loadTile(n,h)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n,()=>{})}_abortTile(n){this._source.abortTile&&this._source.abortTile(n,()=>{}),this._source.fire(new g.Event("dataabort",{tile:n,coord:n.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const x=this._tiles[h];x.upload(n),x.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(n=>n.tileID).sort(Hn).map(n=>n.key)}getRenderableIds(n){const h=[];for(const x in this._tiles)this._isIdRenderable(x,n)&&h.push(this._tiles[x]);return n?h.sort((x,E)=>{const z=x.tileID,R=E.tileID,V=new g.pointGeometry(z.canonical.x,z.canonical.y)._rotate(this.transform.angle),G=new g.pointGeometry(R.canonical.x,R.canonical.y)._rotate(this.transform.angle);return z.overscaledZ-R.overscaledZ||G.y-V.y||G.x-V.x}).map(x=>x.tileID.key):h.map(x=>x.tileID).sort(Hn).map(x=>x.key)}hasRenderableParent(n){const h=this.findLoadedParent(n,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(n,h){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(h||!this._tiles[n].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(n,"reloading")}}_reloadTile(n,h){const x=this._tiles[n];x&&(x.state!=="loading"&&(x.state=h),this._loadTile(x,this._tileLoaded.bind(this,x,n,h)))}_tileLoaded(n,h,x,E){if(E)return n.state="errored",void(E.status!==404?this._source.fire(new g.ErrorEvent(E,{tile:n})):this.update(this.transform));n.timeAdded=g.exported.now(),x==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(h,n),this.getSource().type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),n.aborted||this._source.fire(new g.Event("data",{dataType:"source",tile:n,coord:n.tileID}))}_backfillDEM(n){const h=this.getRenderableIds();for(let E=0;E<h.length;E++){const z=h[E];if(n.neighboringTiles&&n.neighboringTiles[z]){const R=this.getTileByID(z);x(n,R),x(R,n)}}function x(E,z){E.needsHillshadePrepare=!0;let R=z.tileID.canonical.x-E.tileID.canonical.x;const V=z.tileID.canonical.y-E.tileID.canonical.y,G=Math.pow(2,E.tileID.canonical.z),K=z.tileID.key;R===0&&V===0||Math.abs(V)>1||(Math.abs(R)>1&&(Math.abs(R+G)===1?R+=G:Math.abs(R-G)===1&&(R-=G)),z.dem&&E.dem&&(E.dem.backfillBorder(z.dem,R,V),E.neighboringTiles&&E.neighboringTiles[K]&&(E.neighboringTiles[K].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,h,x,E){for(const z in this._tiles){let R=this._tiles[z];if(E[z]||!R.hasData()||R.tileID.overscaledZ<=h||R.tileID.overscaledZ>x)continue;let V=R.tileID;for(;R&&R.tileID.overscaledZ>h+1;){const K=R.tileID.scaledTo(R.tileID.overscaledZ-1);R=this._tiles[K.key],R&&R.hasData()&&(V=K)}let G=V;for(;G.overscaledZ>h;)if(G=G.scaledTo(G.overscaledZ-1),n[G.key]){E[V.key]=V;break}}}findLoadedParent(n,h){if(n.key in this._loadedParentTiles){const x=this._loadedParentTiles[n.key];return x&&x.tileID.overscaledZ>=h?x:null}for(let x=n.overscaledZ-1;x>=h;x--){const E=n.scaledTo(x),z=this._getLoadedTile(E);if(z)return z}}_getLoadedTile(n){const h=this._tiles[n.key];return h&&h.hasData()?h:this._cache.getByKey(n.wrapped().key)}updateCacheSize(n){const h=Math.ceil(n.width/this._source.tileSize)+1,x=Math.ceil(n.height/this._source.tileSize)+1,E=Math.floor(h*x*5),z=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,E):E;this._cache.setMaxSize(z)}handleWrapJump(n){const h=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,h){const x={};for(const E in this._tiles){const z=this._tiles[E];z.tileID=z.tileID.unwrapTo(z.tileID.wrap+h),x[z.tileID.key]=z}this._tiles=x;for(const E in this._timers)clearTimeout(this._timers[E]),delete this._timers[E];for(const E in this._tiles)this._setTileReloadTimer(E,this._tiles[E])}}update(n){if(this.transform=n,!this._sourceLoaded||this._paused)return;let h;this.updateCacheSize(n),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?h=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(G=>new g.OverscaledTileID(G.canonical.z,G.wrap,G.canonical.z,G.canonical.x,G.canonical.y)):(h=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(h=h.filter(G=>this._source.hasTile(G)))):h=[];const x=n.coveringZoomLevel(this._source),E=Math.max(x-ci.maxOverzooming,this._source.minzoom),z=Math.max(x+ci.maxUnderzooming,this._source.minzoom),R=this._updateRetainedTiles(h,x);if(pn(this._source.type)){const G={},K={},Q=Object.keys(R);for(const ae of Q){const _e=R[ae],Le=this._tiles[ae];if(!Le||Le.fadeEndTime&&Le.fadeEndTime<=g.exported.now())continue;const be=this.findLoadedParent(_e,E);be&&(this._addTile(be.tileID),G[be.tileID.key]=be.tileID),K[ae]=_e}this._retainLoadedChildren(K,x,z,R);for(const ae in G)R[ae]||(this._coveredTiles[ae]=!0,R[ae]=G[ae])}for(const G in R)this._tiles[G].clearFadeHold();const V=g.keysDifference(this._tiles,R);for(const G of V){const K=this._tiles[G];K.hasSymbolBuckets&&!K.holdingForFade()?K.setHoldDuration(this.map._fadeDuration):K.hasSymbolBuckets&&!K.symbolFadeFinished()||this._removeTile(G)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(n)}_updateRetainedTiles(n,h){const x={},E={},z=Math.max(h-ci.maxOverzooming,this._source.minzoom),R=Math.max(h+ci.maxUnderzooming,this._source.minzoom),V={};for(const G of n){const K=this._addTile(G);x[G.key]=G,K.hasData()||h<this._source.maxzoom&&(V[G.key]=G)}this._retainLoadedChildren(V,h,R,x);for(const G of n){let K=this._tiles[G.key];if(K.hasData())continue;if(h+1>this._source.maxzoom){const ae=G.children(this._source.maxzoom)[0],_e=this.getTile(ae);if(_e&&_e.hasData()){x[ae.key]=ae;continue}}else{const ae=G.children(this._source.maxzoom);if(x[ae[0].key]&&x[ae[1].key]&&x[ae[2].key]&&x[ae[3].key])continue}let Q=K.wasRequested();for(let ae=G.overscaledZ-1;ae>=z;--ae){const _e=G.scaledTo(ae);if(E[_e.key]||(E[_e.key]=!0,K=this.getTile(_e),!K&&Q&&(K=this._addTile(_e)),K&&(x[_e.key]=_e,Q=K.wasRequested(),K.hasData())))break}}return x}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const h=[];let x,E=this._tiles[n].tileID;for(;E.overscaledZ>0;){if(E.key in this._loadedParentTiles){x=this._loadedParentTiles[E.key];break}h.push(E.key);const z=E.scaledTo(E.overscaledZ-1);if(x=this._getLoadedTile(z),x)break;E=z}for(const z of h)this._loadedParentTiles[z]=x}}_addTile(n){let h=this._tiles[n.key];if(h)return h;h=this._cache.getAndRemove(n),h&&(this._setTileReloadTimer(n.key,h),h.tileID=n,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,h)));const x=h;return h||(h=new Ut(n,this._source.tileSize*n.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,n.key,h.state))),h.uses++,this._tiles[n.key]=h,x||this._source.fire(new g.Event("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(n,h){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const x=h.getExpiryTimeout();x&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},x))}_removeTile(n){const h=this._tiles[n];h&&(h.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(n);this._cache.reset()}tilesIn(n,h,x){const E=[],z=this.transform;if(!z)return E;const R=x?z.getCameraQueryGeometry(n):n,V=n.map(be=>z.pointCoordinate(be)),G=R.map(be=>z.pointCoordinate(be)),K=this.getIds();let Q=1/0,ae=1/0,_e=-1/0,Le=-1/0;for(const be of G)Q=Math.min(Q,be.x),ae=Math.min(ae,be.y),_e=Math.max(_e,be.x),Le=Math.max(Le,be.y);for(let be=0;be<K.length;be++){const Me=this._tiles[K[be]];if(Me.holdingForFade())continue;const qe=Me.tileID,Ne=Math.pow(2,z.zoom-Me.tileID.overscaledZ),Ke=h*Me.queryPadding*g.EXTENT/Me.tileSize/Ne,Ze=[qe.getTilePoint(new g.MercatorCoordinate(Q,ae)),qe.getTilePoint(new g.MercatorCoordinate(_e,Le))];if(Ze[0].x-Ke<g.EXTENT&&Ze[0].y-Ke<g.EXTENT&&Ze[1].x+Ke>=0&&Ze[1].y+Ke>=0){const ut=V.map(ot=>qe.getTilePoint(ot)),rt=G.map(ot=>qe.getTilePoint(ot));E.push({tile:Me,tileID:qe,queryGeometry:ut,cameraQueryGeometry:rt,scale:Ne})}}return E}getVisibleCoordinates(n){const h=this.getRenderableIds(n).map(x=>this._tiles[x].tileID);for(const x of h)x.posMatrix=this.transform.calculatePosMatrix(x.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(pn(this._source.type))for(const n in this._tiles){const h=this._tiles[n];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=g.exported.now())return!0}return!1}setFeatureState(n,h,x){this._state.updateState(n=n||"_geojsonTileLayer",h,x)}removeFeatureState(n,h,x){this._state.removeFeatureState(n=n||"_geojsonTileLayer",h,x)}getFeatureState(n,h){return this._state.getState(n=n||"_geojsonTileLayer",h)}setDependencies(n,h,x){const E=this._tiles[n];E&&E.setDependencies(h,x)}reloadTilesForDependencies(n,h){for(const x in this._tiles)this._tiles[x].hasDependency(n,h)&&this._reloadTile(x,"reloading");this._cache.filter(x=>!x.hasDependency(n,h))}}function Hn(b,n){const h=Math.abs(2*b.wrap)-+(b.wrap<0),x=Math.abs(2*n.wrap)-+(n.wrap<0);return b.overscaledZ-n.overscaledZ||x-h||n.canonical.y-b.canonical.y||n.canonical.x-b.canonical.x}function pn(b){return b==="raster"||b==="image"||b==="video"}ci.maxOverzooming=10,ci.maxUnderzooming=3;const Sn="mapboxgl_preloaded_worker_pool";class ko{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<ko.workerCount;)this.workers.push(new Worker(Yn.workerUrl));return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Sn]}numActive(){return Object.keys(this.active).length}}const io=Math.floor(g.exported.hardwareConcurrency/2);let vo;function Wr(){return vo||(vo=new ko),vo}function Un(b,n){const h={};for(const x in b)x!=="ref"&&(h[x]=b[x]);return g.refProperties.forEach(x=>{x in n&&(h[x]=n[x])}),h}function Yo(b){b=b.slice();const n=Object.create(null);for(let h=0;h<b.length;h++)n[b[h].id]=b[h];for(let h=0;h<b.length;h++)"ref"in b[h]&&(b[h]=Un(b[h],n[b[h].ref]));return b}ko.workerCount=Math.max(Math.min(io,6),1);const wi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Tn(b,n,h){h.push({command:wi.addSource,args:[b,n[b]]})}function ro(b,n,h){n.push({command:wi.removeSource,args:[b]}),h[b]=!0}function kn(b,n,h,x){ro(b,h,x),Tn(b,n,h)}function Ma(b,n,h){let x;for(x in b[h])if(Object.prototype.hasOwnProperty.call(b[h],x)&&x!=="data"&&!ye(b[h][x],n[h][x]))return!1;for(x in n[h])if(Object.prototype.hasOwnProperty.call(n[h],x)&&x!=="data"&&!ye(b[h][x],n[h][x]))return!1;return!0}function st(b,n,h,x,E,z){let R;for(R in n=n||{},b=b||{})Object.prototype.hasOwnProperty.call(b,R)&&(ye(b[R],n[R])||h.push({command:z,args:[x,R,n[R],E]}));for(R in n)Object.prototype.hasOwnProperty.call(n,R)&&!Object.prototype.hasOwnProperty.call(b,R)&&(ye(b[R],n[R])||h.push({command:z,args:[x,R,n[R],E]}))}function Rt(b){return b.id}function Vo(b,n){return b[n.id]=n,b}class no{constructor(n,h){this.reset(n,h)}reset(n,h){this.points=n||[],this._distances=[0];for(let x=1;x<this.points.length;x++)this._distances[x]=this._distances[x-1]+this.points[x].dist(this.points[x-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=g.clamp(n,0,1);let h=1,x=this._distances[h];const E=n*this.paddedLength+this.padding;for(;x<E&&h<this._distances.length;)x=this._distances[++h];const z=h-1,R=this._distances[z],V=x-R,G=V>0?(E-R)/V:0;return this.points[z].mult(1-G).add(this.points[h].mult(G))}}function or(b,n){let h=!0;return b==="always"||b!=="never"&&n!=="never"||(h=!1),h}class Mn{constructor(n,h,x){const E=this.boxCells=[],z=this.circleCells=[];this.xCellCount=Math.ceil(n/x),this.yCellCount=Math.ceil(h/x);for(let R=0;R<this.xCellCount*this.yCellCount;R++)E.push([]),z.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=h,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,h,x,E,z){this._forEachCell(h,x,E,z,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(h),this.bboxes.push(x),this.bboxes.push(E),this.bboxes.push(z)}insertCircle(n,h,x,E){this._forEachCell(h-E,x-E,h+E,x+E,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(h),this.circles.push(x),this.circles.push(E)}_insertBoxCell(n,h,x,E,z,R){this.boxCells[z].push(R)}_insertCircleCell(n,h,x,E,z,R){this.circleCells[z].push(R)}_query(n,h,x,E,z,R,V){if(x<0||n>this.width||E<0||h>this.height)return[];const G=[];if(n<=0&&h<=0&&this.width<=x&&this.height<=E){if(z)return[{key:null,x1:n,y1:h,x2:x,y2:E}];for(let K=0;K<this.boxKeys.length;K++)G.push({key:this.boxKeys[K],x1:this.bboxes[4*K],y1:this.bboxes[4*K+1],x2:this.bboxes[4*K+2],y2:this.bboxes[4*K+3]});for(let K=0;K<this.circleKeys.length;K++){const Q=this.circles[3*K],ae=this.circles[3*K+1],_e=this.circles[3*K+2];G.push({key:this.circleKeys[K],x1:Q-_e,y1:ae-_e,x2:Q+_e,y2:ae+_e})}}else this._forEachCell(n,h,x,E,this._queryCell,G,{hitTest:z,overlapMode:R,seenUids:{box:{},circle:{}}},V);return G}query(n,h,x,E){return this._query(n,h,x,E,!1,null)}hitTest(n,h,x,E,z,R){return this._query(n,h,x,E,!0,z,R).length>0}hitTestCircle(n,h,x,E,z){const R=n-x,V=n+x,G=h-x,K=h+x;if(V<0||R>this.width||K<0||G>this.height)return!1;const Q=[];return this._forEachCell(R,G,V,K,this._queryCellCircle,Q,{hitTest:!0,overlapMode:E,circle:{x:n,y:h,radius:x},seenUids:{box:{},circle:{}}},z),Q.length>0}_queryCell(n,h,x,E,z,R,V,G){const{seenUids:K,hitTest:Q,overlapMode:ae}=V,_e=this.boxCells[z];if(_e!==null){const be=this.bboxes;for(const Me of _e)if(!K.box[Me]){K.box[Me]=!0;const qe=4*Me,Ne=this.boxKeys[Me];if(n<=be[qe+2]&&h<=be[qe+3]&&x>=be[qe+0]&&E>=be[qe+1]&&(!G||G(Ne))&&(!Q||!or(ae,Ne.overlapMode))&&(R.push({key:Ne,x1:be[qe],y1:be[qe+1],x2:be[qe+2],y2:be[qe+3]}),Q))return!0}}const Le=this.circleCells[z];if(Le!==null){const be=this.circles;for(const Me of Le)if(!K.circle[Me]){K.circle[Me]=!0;const qe=3*Me,Ne=this.circleKeys[Me];if(this._circleAndRectCollide(be[qe],be[qe+1],be[qe+2],n,h,x,E)&&(!G||G(Ne))&&(!Q||!or(ae,Ne.overlapMode))){const Ke=be[qe],Ze=be[qe+1],ut=be[qe+2];if(R.push({key:Ne,x1:Ke-ut,y1:Ze-ut,x2:Ke+ut,y2:Ze+ut}),Q)return!0}}}return!1}_queryCellCircle(n,h,x,E,z,R,V,G){const{circle:K,seenUids:Q,overlapMode:ae}=V,_e=this.boxCells[z];if(_e!==null){const be=this.bboxes;for(const Me of _e)if(!Q.box[Me]){Q.box[Me]=!0;const qe=4*Me,Ne=this.boxKeys[Me];if(this._circleAndRectCollide(K.x,K.y,K.radius,be[qe+0],be[qe+1],be[qe+2],be[qe+3])&&(!G||G(Ne))&&!or(ae,Ne.overlapMode))return R.push(!0),!0}}const Le=this.circleCells[z];if(Le!==null){const be=this.circles;for(const Me of Le)if(!Q.circle[Me]){Q.circle[Me]=!0;const qe=3*Me,Ne=this.circleKeys[Me];if(this._circlesCollide(be[qe],be[qe+1],be[qe+2],K.x,K.y,K.radius)&&(!G||G(Ne))&&!or(ae,Ne.overlapMode))return R.push(!0),!0}}}_forEachCell(n,h,x,E,z,R,V,G){const K=this._convertToXCellCoord(n),Q=this._convertToYCellCoord(h),ae=this._convertToXCellCoord(x),_e=this._convertToYCellCoord(E);for(let Le=K;Le<=ae;Le++)for(let be=Q;be<=_e;be++)if(z.call(this,n,h,x,E,this.xCellCount*be+Le,R,V,G))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,h,x,E,z,R){const V=E-n,G=z-h,K=x+R;return K*K>V*V+G*G}_circleAndRectCollide(n,h,x,E,z,R,V){const G=(R-E)/2,K=Math.abs(n-(E+G));if(K>G+x)return!1;const Q=(V-z)/2,ae=Math.abs(h-(z+Q));if(ae>Q+x)return!1;if(K<=G||ae<=Q)return!0;const _e=K-G,Le=ae-Q;return _e*_e+Le*Le<=x*x}}function dn(b,n,h,x,E){const z=g.create();return n?(g.scale(z,z,[1/E,1/E,1]),h||g.rotateZ(z,z,x.angle)):g.multiply(z,x.labelPlaneMatrix,b),z}function xo(b,n,h,x,E){if(n){const z=g.clone(b);return g.scale(z,z,[E,E,1]),h||g.rotateZ(z,z,-x.angle),z}return x.glCoordMatrix}function ur(b,n){const h=[b.x,b.y,0,1];te(h,h,n);const x=h[3];return{point:new g.pointGeometry(h[0]/x,h[1]/x),signedDistanceFromCamera:x}}function kt(b,n){return .5+b/n*.5}function zi(b,n){const h=b[0]/b[3],x=b[1]/b[3];return h>=-n[0]&&h<=n[0]&&x>=-n[1]&&x<=n[1]}function Ei(b,n,h,x,E,z,R,V,G){const K=x?b.textSizeData:b.iconSizeData,Q=g.evaluateSizeForZoom(K,h.transform.zoom),ae=[256/h.width*2+1,256/h.height*2+1],_e=x?b.text.dynamicLayoutVertexArray:b.icon.dynamicLayoutVertexArray;_e.clear();const Le=b.lineVertexArray,be=x?b.text.placedSymbolArray:b.icon.placedSymbolArray,Me=h.transform.width/h.transform.height;let qe=!1;for(let Ne=0;Ne<be.length;Ne++){const Ke=be.get(Ne);if(Ke.hidden||Ke.writingMode===g.WritingMode.vertical&&!qe){J(Ke.numGlyphs,_e);continue}qe=!1;const Ze=[Ke.anchorX,Ke.anchorY,0,1];if(g.transformMat4(Ze,Ze,n),!zi(Ze,ae)){J(Ke.numGlyphs,_e);continue}const ut=kt(h.transform.cameraToCenterDistance,Ze[3]),rt=g.evaluateSizeForFeature(K,Q,Ke),ot=R?rt/ut:rt*ut,yt=new g.pointGeometry(Ke.anchorX,Ke.anchorY),Et=ur(yt,E).point,ct={},Kt=yi(Ke,ot,!1,V,n,E,z,b.glyphOffsetArray,Le,_e,Et,yt,ct,Me,G);qe=Kt.useVertical,(Kt.notEnoughRoom||qe||Kt.needsFlipping&&yi(Ke,ot,!0,V,n,E,z,b.glyphOffsetArray,Le,_e,Et,yt,ct,Me,G).notEnoughRoom)&&J(Ke.numGlyphs,_e)}x?b.text.dynamicLayoutVertexBuffer.updateData(_e):b.icon.dynamicLayoutVertexBuffer.updateData(_e)}function Kr(b,n,h,x,E,z,R,V,G,K,Q,ae){const _e=V.glyphStartIndex+V.numGlyphs,Le=V.lineStartIndex,be=V.lineStartIndex+V.lineLength,Me=n.getoffsetX(V.glyphStartIndex),qe=n.getoffsetX(_e-1),Ne=Wn(b*Me,h,x,E,z,R,V.segment,Le,be,G,K,Q,ae);if(!Ne)return null;const Ke=Wn(b*qe,h,x,E,z,R,V.segment,Le,be,G,K,Q,ae);return Ke?{first:Ne,last:Ke}:null}function fn(b,n,h,x){return b===g.WritingMode.horizontal&&Math.abs(h.y-n.y)>Math.abs(h.x-n.x)*x?{useVertical:!0}:(b===g.WritingMode.vertical?n.y<h.y:n.x>h.x)?{needsFlipping:!0}:null}function yi(b,n,h,x,E,z,R,V,G,K,Q,ae,_e,Le,be){const Me=n/24,qe=b.lineOffsetX*Me,Ne=b.lineOffsetY*Me;let Ke;if(b.numGlyphs>1){const Ze=b.glyphStartIndex+b.numGlyphs,ut=b.lineStartIndex,rt=b.lineStartIndex+b.lineLength,ot=Kr(Me,V,qe,Ne,h,Q,ae,b,G,z,_e,be);if(!ot)return{notEnoughRoom:!0};const yt=ur(ot.first.point,R).point,Et=ur(ot.last.point,R).point;if(x&&!h){const ct=fn(b.writingMode,yt,Et,Le);if(ct)return ct}Ke=[ot.first];for(let ct=b.glyphStartIndex+1;ct<Ze-1;ct++)Ke.push(Wn(Me*V.getoffsetX(ct),qe,Ne,h,Q,ae,b.segment,ut,rt,G,z,_e,be));Ke.push(ot.last)}else{if(x&&!h){const ut=ur(ae,E).point,rt=b.lineStartIndex+b.segment+1,ot=new g.pointGeometry(G.getx(rt),G.gety(rt)),yt=ur(ot,E),Et=yt.signedDistanceFromCamera>0?yt.point:Mo(ae,ot,ut,1,E),ct=fn(b.writingMode,ut,Et,Le);if(ct)return ct}const Ze=Wn(Me*V.getoffsetX(b.glyphStartIndex),qe,Ne,h,Q,ae,b.segment,b.lineStartIndex,b.lineStartIndex+b.lineLength,G,z,_e,be);if(!Ze)return{notEnoughRoom:!0};Ke=[Ze]}for(const Ze of Ke)g.addDynamicAttributes(K,Ze.point,Ze.angle);return{}}function Mo(b,n,h,x,E){const z=ur(b.add(b.sub(n)._unit()),E).point,R=h.sub(z);return h.add(R._mult(x/R.mag()))}function Wn(b,n,h,x,E,z,R,V,G,K,Q,ae,_e){const Le=x?b-n:b+n;let be=Le>0?1:-1,Me=0;x&&(be*=-1,Me=Math.PI),be<0&&(Me+=Math.PI);let qe=be>0?V+R:V+R+1,Ne=E,Ke=E,Ze=0,ut=0;const rt=Math.abs(Le),ot=[];for(;Ze+ut<=rt;){if(qe+=be,qe<V||qe>=G)return null;if(Ke=Ne,ot.push(Ne),Ne=ae[qe],Ne===void 0){const Ot=new g.pointGeometry(K.getx(qe),K.gety(qe)),gi=ur(Ot,Q);if(gi.signedDistanceFromCamera>0)Ne=ae[qe]=gi.point;else{const s=qe-be;Ne=Mo(Ze===0?z:new g.pointGeometry(K.getx(s),K.gety(s)),Ot,Ke,rt-Ze+1,Q)}}Ze+=ut,ut=Ke.dist(Ne)}const yt=(rt-Ze)/ut,Et=Ne.sub(Ke),ct=Et.mult(yt)._add(Ke);ct._add(Et._unit()._perp()._mult(h*be));const Kt=Me+Math.atan2(Ne.y-Ke.y,Ne.x-Ke.x);return ot.push(ct),{point:ct,angle:_e?Kt:0,path:ot}}const ar=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function J(b,n){for(let h=0;h<b;h++){const x=n.length;n.resize(x+4),n.float32.set(ar,3*x)}}function te(b,n,h){const x=n[0],E=n[1];return b[0]=h[0]*x+h[4]*E+h[12],b[1]=h[1]*x+h[5]*E+h[13],b[3]=h[3]*x+h[7]*E+h[15],b}const oe=100;class me{constructor(n,h=new Mn(n.width+200,n.height+200,25),x=new Mn(n.width+200,n.height+200,25)){this.transform=n,this.grid=h,this.ignoredGrid=x,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+oe,this.screenBottomBoundary=n.height+oe,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200}placeCollisionBox(n,h,x,E,z){const R=this.projectAndGetPerspectiveRatio(E,n.anchorPointX,n.anchorPointY),V=x*R.perspectiveRatio,G=n.x1*V+R.point.x,K=n.y1*V+R.point.y,Q=n.x2*V+R.point.x,ae=n.y2*V+R.point.y;return!this.isInsideGrid(G,K,Q,ae)||h!=="always"&&this.grid.hitTest(G,K,Q,ae,h,z)?{box:[],offscreen:!1}:{box:[G,K,Q,ae],offscreen:this.isOffscreen(G,K,Q,ae)}}placeCollisionCircles(n,h,x,E,z,R,V,G,K,Q,ae,_e,Le){const be=[],Me=new g.pointGeometry(h.anchorX,h.anchorY),qe=ur(Me,R),Ne=kt(this.transform.cameraToCenterDistance,qe.signedDistanceFromCamera),Ke=(Q?z/Ne:z*Ne)/g.ONE_EM,Ze=ur(Me,V).point,ut=Kr(Ke,E,h.lineOffsetX*Ke,h.lineOffsetY*Ke,!1,Ze,Me,h,x,V,{},!1);let rt=!1,ot=!1,yt=!0;if(ut){const Et=.5*_e*Ne+Le,ct=new g.pointGeometry(-100,-100),Kt=new g.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Ot=new no,gi=ut.first,s=ut.last;let c=[];for(let T=gi.path.length-1;T>=1;T--)c.push(gi.path[T]);for(let T=1;T<s.path.length;T++)c.push(s.path[T]);const u=2.5*Et;if(G){const T=c.map(P=>ur(P,G));c=T.some(P=>P.signedDistanceFromCamera<=0)?[]:T.map(P=>P.point)}let f=[];if(c.length>0){const T=c[0].clone(),P=c[0].clone();for(let M=1;M<c.length;M++)T.x=Math.min(T.x,c[M].x),T.y=Math.min(T.y,c[M].y),P.x=Math.max(P.x,c[M].x),P.y=Math.max(P.y,c[M].y);f=T.x>=ct.x&&P.x<=Kt.x&&T.y>=ct.y&&P.y<=Kt.y?[c]:P.x<ct.x||T.x>Kt.x||P.y<ct.y||T.y>Kt.y?[]:g.clipLine([c],ct.x,ct.y,Kt.x,Kt.y)}for(const T of f){Ot.reset(T,.25*Et);let P=0;P=Ot.length<=.5*Et?1:Math.ceil(Ot.paddedLength/u)+1;for(let M=0;M<P;M++){const F=M/Math.max(P-1,1),X=Ot.lerp(F),Y=X.x+oe,le=X.y+oe;be.push(Y,le,Et,0);const ce=Y-Et,de=le-Et,Ce=Y+Et,Ae=le+Et;if(yt=yt&&this.isOffscreen(ce,de,Ce,Ae),ot=ot||this.isInsideGrid(ce,de,Ce,Ae),n!=="always"&&this.grid.hitTestCircle(Y,le,Et,n,ae)&&(rt=!0,!K))return{circles:[],offscreen:!1,collisionDetected:rt}}}}return{circles:!K&&rt||!ot?[]:be,offscreen:yt,collisionDetected:rt}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let x=1/0,E=1/0,z=-1/0,R=-1/0;for(const Q of n){const ae=new g.pointGeometry(Q.x+oe,Q.y+oe);x=Math.min(x,ae.x),E=Math.min(E,ae.y),z=Math.max(z,ae.x),R=Math.max(R,ae.y),h.push(ae)}const V=this.grid.query(x,E,z,R).concat(this.ignoredGrid.query(x,E,z,R)),G={},K={};for(const Q of V){const ae=Q.key;if(G[ae.bucketInstanceId]===void 0&&(G[ae.bucketInstanceId]={}),G[ae.bucketInstanceId][ae.featureIndex])continue;const _e=[new g.pointGeometry(Q.x1,Q.y1),new g.pointGeometry(Q.x2,Q.y1),new g.pointGeometry(Q.x2,Q.y2),new g.pointGeometry(Q.x1,Q.y2)];g.polygonIntersectsPolygon(h,_e)&&(G[ae.bucketInstanceId][ae.featureIndex]=!0,K[ae.bucketInstanceId]===void 0&&(K[ae.bucketInstanceId]=[]),K[ae.bucketInstanceId].push(ae.featureIndex))}return K}insertCollisionBox(n,h,x,E,z,R){(x?this.ignoredGrid:this.grid).insert({bucketInstanceId:E,featureIndex:z,collisionGroupID:R,overlapMode:h},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,h,x,E,z,R){const V=x?this.ignoredGrid:this.grid,G={bucketInstanceId:E,featureIndex:z,collisionGroupID:R,overlapMode:h};for(let K=0;K<n.length;K+=4)V.insertCircle(G,n[K],n[K+1],n[K+2])}projectAndGetPerspectiveRatio(n,h,x){const E=[h,x,0,1];return te(E,E,n),{point:new g.pointGeometry((E[0]/E[3]+1)/2*this.transform.width+oe,(-E[1]/E[3]+1)/2*this.transform.height+oe),perspectiveRatio:.5+this.transform.cameraToCenterDistance/E[3]*.5}}isOffscreen(n,h,x,E){return x<oe||n>=this.screenRightBoundary||E<oe||h>this.screenBottomBoundary}isInsideGrid(n,h,x,E){return x>=0&&n<this.gridRightBoundary&&E>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const n=g.identity([]);return g.translate(n,n,[-100,-100,0]),n}}function Te(b,n,h){return n*(g.EXTENT/(b.tileSize*Math.pow(2,h-b.tileID.overscaledZ)))}class Re{constructor(n,h,x,E){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?h:-h))):E&&x?1:0,this.placed=x}isHidden(){return this.opacity===0&&!this.placed}}class Oe{constructor(n,h,x,E,z){this.text=new Re(n?n.text:null,h,x,z),this.icon=new Re(n?n.icon:null,h,E,z)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class fe{constructor(n,h,x){this.text=n,this.icon=h,this.skipFade=x}}class Pe{constructor(){this.invProjMatrix=g.create(),this.viewportMatrix=g.create(),this.circles=[]}}class Xe{constructor(n,h,x,E,z){this.bucketInstanceId=n,this.featureIndex=h,this.sourceLayerIndex=x,this.bucketIndex=E,this.tileID=z}}class ie{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const h=++this.maxGroupID;this.collisionGroups[n]={ID:h,predicate:x=>x.collisionGroupID===h}}return this.collisionGroups[n]}}function N(b,n,h,x,E){const{horizontalAlign:z,verticalAlign:R}=g.getAnchorAlignment(b),V=-(z-.5)*n,G=-(R-.5)*h,K=g.evaluateVariableOffset(b,x);return new g.pointGeometry(V+K[0]*E,G+K[1]*E)}function j(b,n,h,x,E,z){const{x1:R,x2:V,y1:G,y2:K,anchorPointX:Q,anchorPointY:ae}=b,_e=new g.pointGeometry(n,h);return x&&_e._rotate(E?z:-z),{x1:R+_e.x,y1:G+_e.y,x2:V+_e.x,y2:K+_e.y,anchorPointX:Q,anchorPointY:ae}}class ee{constructor(n,h,x,E){this.transform=n.clone(),this.collisionIndex=new me(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new ie(x),this.collisionCircleArrays={},this.prevPlacement=E,E&&(E.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,h,x,E){const z=x.getBucket(h),R=x.latestFeatureIndex;if(!z||!R||h.id!==z.layerIds[0])return;const V=x.collisionBoxArray,G=z.layers[0].layout,K=Math.pow(2,this.transform.zoom-x.tileID.overscaledZ),Q=x.tileSize/g.EXTENT,ae=this.transform.calculatePosMatrix(x.tileID.toUnwrapped()),_e=G.get("text-pitch-alignment")==="map",Le=G.get("text-rotation-alignment")==="map",be=Te(x,1,this.transform.zoom),Me=dn(ae,_e,Le,this.transform,be);let qe=null;if(_e){const Ke=xo(ae,_e,Le,this.transform,be);qe=g.multiply([],this.transform.labelPlaneMatrix,Ke)}this.retainedQueryData[z.bucketInstanceId]=new Xe(z.bucketInstanceId,R,z.sourceLayerIndex,z.index,x.tileID);const Ne={bucket:z,layout:G,posMatrix:ae,textLabelPlaneMatrix:Me,labelToScreenMatrix:qe,scale:K,textPixelRatio:Q,holdingForFade:x.holdingForFade(),collisionBoxArray:V,partiallyEvaluatedTextSize:g.evaluateSizeForZoom(z.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(z.sourceID)};if(E)for(const Ke of z.sortKeyRanges){const{sortKey:Ze,symbolInstanceStart:ut,symbolInstanceEnd:rt}=Ke;n.push({sortKey:Ze,symbolInstanceStart:ut,symbolInstanceEnd:rt,parameters:Ne})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:z.symbolInstances.length,parameters:Ne})}attemptAnchorPlacement(n,h,x,E,z,R,V,G,K,Q,ae,_e,Le,be,Me){const qe=[_e.textOffset0,_e.textOffset1],Ne=N(n,x,E,qe,z),Ke=this.collisionIndex.placeCollisionBox(j(h,Ne.x,Ne.y,R,V,this.transform.angle),ae,G,K,Q.predicate);if((!Me||this.collisionIndex.placeCollisionBox(j(Me,Ne.x,Ne.y,R,V,this.transform.angle),ae,G,K,Q.predicate).box.length!==0)&&Ke.box.length>0){let Ze;return this.prevPlacement&&this.prevPlacement.variableOffsets[_e.crossTileID]&&this.prevPlacement.placements[_e.crossTileID]&&this.prevPlacement.placements[_e.crossTileID].text&&(Ze=this.prevPlacement.variableOffsets[_e.crossTileID].anchor),this.variableOffsets[_e.crossTileID]={textOffset:qe,width:x,height:E,anchor:n,textBoxScale:z,prevAnchor:Ze},this.markUsedJustification(Le,n,_e,be),Le.allowVerticalPlacement&&(this.markUsedOrientation(Le,be,_e),this.placedOrientations[_e.crossTileID]=be),{shift:Ne,placedGlyphBoxes:Ke}}}placeLayerBucketPart(n,h,x){const{bucket:E,layout:z,posMatrix:R,textLabelPlaneMatrix:V,labelToScreenMatrix:G,textPixelRatio:K,holdingForFade:Q,collisionBoxArray:ae,partiallyEvaluatedTextSize:_e,collisionGroup:Le}=n.parameters,be=z.get("text-optional"),Me=z.get("icon-optional"),qe=g.getOverlapMode(z,"text-overlap","text-allow-overlap"),Ne=qe==="always",Ke=g.getOverlapMode(z,"icon-overlap","icon-allow-overlap"),Ze=Ke==="always",ut=z.get("text-rotation-alignment")==="map",rt=z.get("text-pitch-alignment")==="map",ot=z.get("icon-text-fit")!=="none",yt=z.get("symbol-z-order")==="viewport-y",Et=Ne&&(Ze||!E.hasIconData()||Me),ct=Ze&&(Ne||!E.hasTextData()||be);!E.collisionArrays&&ae&&E.deserializeCollisionBoxes(ae);const Kt=(Ot,gi)=>{if(h[Ot.crossTileID])return;if(Q)return void(this.placements[Ot.crossTileID]=new fe(!1,!1,!1));let s=!1,c=!1,u=!0,f=null,T={box:null,offscreen:null},P={box:null,offscreen:null},M=null,F=null,X=null,Y=0,le=0,ce=0;gi.textFeatureIndex?Y=gi.textFeatureIndex:Ot.useRuntimeCollisionCircles&&(Y=Ot.featureIndex),gi.verticalTextFeatureIndex&&(le=gi.verticalTextFeatureIndex);const de=gi.textBox;if(de){const ke=ze=>{let Be=g.WritingMode.horizontal;if(E.allowVerticalPlacement&&!ze&&this.prevPlacement){const Ge=this.prevPlacement.placedOrientations[Ot.crossTileID];Ge&&(this.placedOrientations[Ot.crossTileID]=Ge,Be=Ge,this.markUsedOrientation(E,Be,Ot))}return Be},xe=(ze,Be)=>{if(E.allowVerticalPlacement&&Ot.numVerticalGlyphVertices>0&&gi.verticalTextBox){for(const Ge of E.writingModes)if(Ge===g.WritingMode.vertical?(T=Be(),P=T):T=ze(),T&&T.box&&T.box.length)break}else T=ze()};if(z.get("text-variable-anchor")){let ze=z.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ot.crossTileID]){const Je=this.prevPlacement.variableOffsets[Ot.crossTileID];ze.indexOf(Je.anchor)>0&&(ze=ze.filter(Ye=>Ye!==Je.anchor),ze.unshift(Je.anchor))}const Be=(Je,Ye,Qe)=>{const ht=Je.x2-Je.x1,bt=Je.y2-Je.y1,xt=Ot.textBoxScale,Dt=ot&&Ke==="never"?Ye:null;let Yt={box:[],offscreen:!1};const ti=qe!=="never"?2*ze.length:ze.length;for(let Jt=0;Jt<ti;++Jt){const Mi=this.attemptAnchorPlacement(ze[Jt%ze.length],Je,ht,bt,xt,ut,rt,K,R,Le,Jt>=ze.length?qe:"never",Ot,E,Qe,Dt);if(Mi&&(Yt=Mi.placedGlyphBoxes,Yt&&Yt.box&&Yt.box.length)){s=!0,f=Mi.shift;break}}return Yt};xe(()=>Be(de,gi.iconBox,g.WritingMode.horizontal),()=>{const Je=gi.verticalTextBox;return E.allowVerticalPlacement&&!(T&&T.box&&T.box.length)&&Ot.numVerticalGlyphVertices>0&&Je?Be(Je,gi.verticalIconBox,g.WritingMode.vertical):{box:null,offscreen:null}}),T&&(s=T.box,u=T.offscreen);const Ge=ke(T&&T.box);if(!s&&this.prevPlacement){const Je=this.prevPlacement.variableOffsets[Ot.crossTileID];Je&&(this.variableOffsets[Ot.crossTileID]=Je,this.markUsedJustification(E,Je.anchor,Ot,Ge))}}else{const ze=(Be,Ge)=>{const Je=this.collisionIndex.placeCollisionBox(Be,qe,K,R,Le.predicate);return Je&&Je.box&&Je.box.length&&(this.markUsedOrientation(E,Ge,Ot),this.placedOrientations[Ot.crossTileID]=Ge),Je};xe(()=>ze(de,g.WritingMode.horizontal),()=>{const Be=gi.verticalTextBox;return E.allowVerticalPlacement&&Ot.numVerticalGlyphVertices>0&&Be?ze(Be,g.WritingMode.vertical):{box:null,offscreen:null}}),ke(T&&T.box&&T.box.length)}}if(M=T,s=M&&M.box&&M.box.length>0,u=M&&M.offscreen,Ot.useRuntimeCollisionCircles){const ke=E.text.placedSymbolArray.get(Ot.centerJustifiedTextSymbolIndex),xe=g.evaluateSizeForFeature(E.textSizeData,_e,ke),ze=z.get("text-padding");F=this.collisionIndex.placeCollisionCircles(qe,ke,E.lineVertexArray,E.glyphOffsetArray,xe,R,V,G,x,rt,Le.predicate,Ot.collisionCircleDiameter,ze),s=Ne||F.circles.length>0&&!F.collisionDetected,u=u&&F.offscreen}if(gi.iconFeatureIndex&&(ce=gi.iconFeatureIndex),gi.iconBox){const ke=xe=>{const ze=ot&&f?j(xe,f.x,f.y,ut,rt,this.transform.angle):xe;return this.collisionIndex.placeCollisionBox(ze,Ke,K,R,Le.predicate)};P&&P.box&&P.box.length&&gi.verticalIconBox?(X=ke(gi.verticalIconBox),c=X.box.length>0):(X=ke(gi.iconBox),c=X.box.length>0),u=u&&X.offscreen}const Ce=be||Ot.numHorizontalGlyphVertices===0&&Ot.numVerticalGlyphVertices===0,Ae=Me||Ot.numIconVertices===0;if(Ce||Ae?Ae?Ce||(c=c&&s):s=c&&s:c=s=c&&s,s&&M&&M.box&&this.collisionIndex.insertCollisionBox(M.box,qe,z.get("text-ignore-placement"),E.bucketInstanceId,P&&P.box&&le?le:Y,Le.ID),c&&X&&this.collisionIndex.insertCollisionBox(X.box,Ke,z.get("icon-ignore-placement"),E.bucketInstanceId,ce,Le.ID),F&&(s&&this.collisionIndex.insertCollisionCircles(F.circles,qe,z.get("text-ignore-placement"),E.bucketInstanceId,Y,Le.ID),x)){const ke=E.bucketInstanceId;let xe=this.collisionCircleArrays[ke];xe===void 0&&(xe=this.collisionCircleArrays[ke]=new Pe);for(let ze=0;ze<F.circles.length;ze+=4)xe.circles.push(F.circles[ze+0]),xe.circles.push(F.circles[ze+1]),xe.circles.push(F.circles[ze+2]),xe.circles.push(F.collisionDetected?1:0)}this.placements[Ot.crossTileID]=new fe(s||Et,c||ct,u||E.justReloaded),h[Ot.crossTileID]=!0};if(yt){const Ot=E.getSortedSymbolIndexes(this.transform.angle);for(let gi=Ot.length-1;gi>=0;--gi){const s=Ot[gi];Kt(E.symbolInstances.get(s),E.collisionArrays[s])}}else for(let Ot=n.symbolInstanceStart;Ot<n.symbolInstanceEnd;Ot++)Kt(E.symbolInstances.get(Ot),E.collisionArrays[Ot]);if(x&&E.bucketInstanceId in this.collisionCircleArrays){const Ot=this.collisionCircleArrays[E.bucketInstanceId];g.invert(Ot.invProjMatrix,R),Ot.viewportMatrix=this.collisionIndex.getViewportMatrix()}E.justReloaded=!1}markUsedJustification(n,h,x,E){let z;z=E===g.WritingMode.vertical?x.verticalPlacedTextSymbolIndex:{left:x.leftJustifiedTextSymbolIndex,center:x.centerJustifiedTextSymbolIndex,right:x.rightJustifiedTextSymbolIndex}[g.getAnchorJustification(h)];const R=[x.leftJustifiedTextSymbolIndex,x.centerJustifiedTextSymbolIndex,x.rightJustifiedTextSymbolIndex,x.verticalPlacedTextSymbolIndex];for(const V of R)V>=0&&(n.text.placedSymbolArray.get(V).crossTileID=z>=0&&V!==z?0:x.crossTileID)}markUsedOrientation(n,h,x){const E=h===g.WritingMode.horizontal||h===g.WritingMode.horizontalOnly?h:0,z=h===g.WritingMode.vertical?h:0,R=[x.leftJustifiedTextSymbolIndex,x.centerJustifiedTextSymbolIndex,x.rightJustifiedTextSymbolIndex];for(const V of R)n.text.placedSymbolArray.get(V).placedOrientation=E;x.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(x.verticalPlacedTextSymbolIndex).placedOrientation=z)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let x=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const E=h?h.symbolFadeChange(n):1,z=h?h.opacities:{},R=h?h.variableOffsets:{},V=h?h.placedOrientations:{};for(const G in this.placements){const K=this.placements[G],Q=z[G];Q?(this.opacities[G]=new Oe(Q,E,K.text,K.icon),x=x||K.text!==Q.text.placed||K.icon!==Q.icon.placed):(this.opacities[G]=new Oe(null,E,K.text,K.icon,K.skipFade),x=x||K.text||K.icon)}for(const G in z){const K=z[G];if(!this.opacities[G]){const Q=new Oe(K,E,!1,!1);Q.isHidden()||(this.opacities[G]=Q,x=x||K.text.placed||K.icon.placed)}}for(const G in R)this.variableOffsets[G]||!this.opacities[G]||this.opacities[G].isHidden()||(this.variableOffsets[G]=R[G]);for(const G in V)this.placedOrientations[G]||!this.opacities[G]||this.opacities[G].isHidden()||(this.placedOrientations[G]=V[G]);x?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:n)}updateLayerOpacities(n,h){const x={};for(const E of h){const z=E.getBucket(n);z&&E.latestFeatureIndex&&n.id===z.layerIds[0]&&this.updateBucketOpacities(z,x,E.collisionBoxArray)}}updateBucketOpacities(n,h,x){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const E=n.layers[0].layout,z=new Oe(null,0,!1,!1,!0),R=E.get("text-allow-overlap"),V=E.get("icon-allow-overlap"),G=E.get("text-variable-anchor"),K=E.get("text-rotation-alignment")==="map",Q=E.get("text-pitch-alignment")==="map",ae=E.get("icon-text-fit")!=="none",_e=new Oe(null,0,R&&(V||!n.hasIconData()||E.get("icon-optional")),V&&(R||!n.hasTextData()||E.get("text-optional")),!0);!n.collisionArrays&&x&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(x);const Le=(be,Me,qe)=>{for(let Ne=0;Ne<Me/4;Ne++)be.opacityVertexArray.emplaceBack(qe)};for(let be=0;be<n.symbolInstances.length;be++){const Me=n.symbolInstances.get(be),{numHorizontalGlyphVertices:qe,numVerticalGlyphVertices:Ne,crossTileID:Ke}=Me;let Ze=this.opacities[Ke];h[Ke]?Ze=z:Ze||(Ze=_e,this.opacities[Ke]=Ze),h[Ke]=!0;const ut=Me.numIconVertices>0,rt=this.placedOrientations[Me.crossTileID],ot=rt===g.WritingMode.vertical,yt=rt===g.WritingMode.horizontal||rt===g.WritingMode.horizontalOnly;if(qe>0||Ne>0){const Et=He(Ze.text);Le(n.text,qe,ot?Tt:Et),Le(n.text,Ne,yt?Tt:Et);const ct=Ze.text.isHidden();[Me.rightJustifiedTextSymbolIndex,Me.centerJustifiedTextSymbolIndex,Me.leftJustifiedTextSymbolIndex].forEach(gi=>{gi>=0&&(n.text.placedSymbolArray.get(gi).hidden=ct||ot?1:0)}),Me.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(Me.verticalPlacedTextSymbolIndex).hidden=ct||yt?1:0);const Kt=this.variableOffsets[Me.crossTileID];Kt&&this.markUsedJustification(n,Kt.anchor,Me,rt);const Ot=this.placedOrientations[Me.crossTileID];Ot&&(this.markUsedJustification(n,"left",Me,Ot),this.markUsedOrientation(n,Ot,Me))}if(ut){const Et=He(Ze.icon),ct=!(ae&&Me.verticalPlacedIconSymbolIndex&&ot);Me.placedIconSymbolIndex>=0&&(Le(n.icon,Me.numIconVertices,ct?Et:Tt),n.icon.placedSymbolArray.get(Me.placedIconSymbolIndex).hidden=Ze.icon.isHidden()),Me.verticalPlacedIconSymbolIndex>=0&&(Le(n.icon,Me.numVerticalIconVertices,ct?Tt:Et),n.icon.placedSymbolArray.get(Me.verticalPlacedIconSymbolIndex).hidden=Ze.icon.isHidden())}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const Et=n.collisionArrays[be];if(Et){let ct=new g.pointGeometry(0,0);if(Et.textBox||Et.verticalTextBox){let Ot=!0;if(G){const gi=this.variableOffsets[Ke];gi?(ct=N(gi.anchor,gi.width,gi.height,gi.textOffset,gi.textBoxScale),K&&ct._rotate(Q?this.transform.angle:-this.transform.angle)):Ot=!1}Et.textBox&&se(n.textCollisionBox.collisionVertexArray,Ze.text.placed,!Ot||ot,ct.x,ct.y),Et.verticalTextBox&&se(n.textCollisionBox.collisionVertexArray,Ze.text.placed,!Ot||yt,ct.x,ct.y)}const Kt=Boolean(!yt&&Et.verticalIconBox);Et.iconBox&&se(n.iconCollisionBox.collisionVertexArray,Ze.icon.placed,Kt,ae?ct.x:0,ae?ct.y:0),Et.verticalIconBox&&se(n.iconCollisionBox.collisionVertexArray,Ze.icon.placed,!Kt,ae?ct.x:0,ae?ct.y:0)}}}if(n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const be=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=be.invProjMatrix,n.placementViewportMatrix=be.viewportMatrix,n.collisionCircleArray=be.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,h){const x=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*x>n}setStale(){this.stale=!0}}function se(b,n,h,x,E){b.emplaceBack(n?1:0,h?1:0,x||0,E||0),b.emplaceBack(n?1:0,h?1:0,x||0,E||0),b.emplaceBack(n?1:0,h?1:0,x||0,E||0),b.emplaceBack(n?1:0,h?1:0,x||0,E||0)}const ge=Math.pow(2,25),pe=Math.pow(2,24),Ee=Math.pow(2,17),we=Math.pow(2,16),Se=Math.pow(2,9),$e=Math.pow(2,8),je=Math.pow(2,1);function He(b){if(b.opacity===0&&!b.placed)return 0;if(b.opacity===1&&b.placed)return 4294967295;const n=b.placed?1:0,h=Math.floor(127*b.opacity);return h*ge+n*pe+h*Ee+n*we+h*Se+n*$e+h*je+n}const Tt=0;class ft{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&!n.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(n,h,x,E,z){const R=this._bucketParts;for(;this._currentTileIndex<n.length;)if(h.getBucketParts(R,E,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,z())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,R.sort((V,G)=>V.sortKey-G.sortKey));this._currentPartIndex<R.length;)if(h.placeLayerBucketPart(R[this._currentPartIndex],this._seenCrossTileIDs,x),this._currentPartIndex++,z())return!0;return!1}}class wt{constructor(n,h,x,E,z,R,V){this.placement=new ee(n,z,R,V),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=x,this._showCollisionBoxes=E,this._done=!1}isDone(){return this._done}continuePlacement(n,h,x){const E=g.exported.now(),z=()=>{const R=g.exported.now()-E;return!this._forceFullPlacement&&R>2};for(;this._currentPlacementIndex>=0;){const R=h[n[this._currentPlacementIndex]],V=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&(!R.minzoom||R.minzoom<=V)&&(!R.maxzoom||R.maxzoom>V)){if(this._inProgressLayer||(this._inProgressLayer=new ft(R)),this._inProgressLayer.continuePlacement(x[R.source],this.placement,this._showCollisionBoxes,R,z))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const It=512/g.EXTENT/2;class xi{constructor(n,h,x){this.tileID=n,this.indexedSymbolInstances={},this.bucketInstanceId=x;for(let E=0;E<h.length;E++){const z=h.get(E),R=z.key;this.indexedSymbolInstances[R]||(this.indexedSymbolInstances[R]=[]),this.indexedSymbolInstances[R].push({crossTileID:z.crossTileID,coord:this.getScaledCoordinates(z,n)})}}getScaledCoordinates(n,h){const x=It/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*g.EXTENT+n.anchorX)*x),y:Math.floor((h.canonical.y*g.EXTENT+n.anchorY)*x)}}findMatches(n,h,x){const E=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let z=0;z<n.length;z++){const R=n.get(z);if(R.crossTileID)continue;const V=this.indexedSymbolInstances[R.key];if(!V)continue;const G=this.getScaledCoordinates(R,h);for(const K of V)if(Math.abs(K.coord.x-G.x)<=E&&Math.abs(K.coord.y-G.y)<=E&&!x[K.crossTileID]){x[K.crossTileID]=!0,R.crossTileID=K.crossTileID;break}}}}class Qt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ni{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const h=Math.round((n-this.lng)/360);if(h!==0)for(const x in this.indexes){const E=this.indexes[x],z={};for(const R in E){const V=E[R];V.tileID=V.tileID.unwrapTo(V.tileID.wrap+h),z[V.tileID.key]=V}this.indexes[x]=z}this.lng=n}addBucket(n,h,x){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let z=0;z<h.symbolInstances.length;z++)h.symbolInstances.get(z).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});const E=this.usedCrossTileIDs[n.overscaledZ];for(const z in this.indexes){const R=this.indexes[z];if(Number(z)>n.overscaledZ)for(const V in R){const G=R[V];G.tileID.isChildOf(n)&&G.findMatches(h.symbolInstances,n,E)}else{const V=R[n.scaledTo(Number(z)).key];V&&V.findMatches(h.symbolInstances,n,E)}}for(let z=0;z<h.symbolInstances.length;z++){const R=h.symbolInstances.get(z);R.crossTileID||(R.crossTileID=x.generate(),E[R.crossTileID]=!0)}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new xi(n,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(n,h){for(const x in h.indexedSymbolInstances)for(const E of h.indexedSymbolInstances[x])delete this.usedCrossTileIDs[n][E.crossTileID]}removeStaleBuckets(n){let h=!1;for(const x in this.indexes){const E=this.indexes[x];for(const z in E)n[E[z].bucketInstanceId]||(this.removeBucketCrossTileIDs(x,E[z]),delete E[z],h=!0)}return h}}class $t{constructor(){this.layerIndexes={},this.crossTileIDs=new Qt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,h,x){let E=this.layerIndexes[n.id];E===void 0&&(E=this.layerIndexes[n.id]=new ni);let z=!1;const R={};E.handleWrapJump(x);for(const V of h){const G=V.getBucket(n);G&&n.id===G.layerIds[0]&&(G.bucketInstanceId||(G.bucketInstanceId=++this.maxBucketInstanceId),E.addBucket(V.tileID,G,this.crossTileIDs)&&(z=!0),R[G.bucketInstanceId]=!0)}return E.removeStaleBuckets(R)&&(z=!0),z}pruneUnusedLayers(n){const h={};n.forEach(x=>{h[x]=!0});for(const x in this.layerIndexes)h[x]||delete this.layerIndexes[x]}}const Mt=(b,n)=>g.emitValidationErrors(b,n&&n.filter(h=>h.identifier!=="source.canvas")),di=g.pick(wi,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),qi=g.pick(wi,["setCenter","setZoom","setBearing","setPitch"]),jr=function(){const b={},n=g.spec.$version;for(const h in g.spec.$root){const x=g.spec.$root[h];if(x.required){let E=null;E=h==="version"?n:x.type==="array"?[]:{},E!=null&&(b[h]=E)}}return b}();class Xi extends g.Evented{constructor(n,h={}){super(),this.map=n,this.dispatcher=new hr(Wr(),this),this.imageManager=new qt,this.imageManager.setEventedParent(this),this.glyphManager=new Gi(n._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Oi(256,512),this.crossTileSymbolIndex=new $t,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new g.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",g.getReferrer());const x=this;this._rtlTextPluginCallback=Xi.registerForPluginStateChange(E=>{x.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:E.pluginStatus,pluginURL:E.pluginURL},(z,R)=>{if(g.triggerPluginCompletionEvent(z),R&&R.every(V=>V))for(const V in x.sourceCaches)x.sourceCaches[V].reload()})}),this.on("data",E=>{if(E.dataType!=="source"||E.sourceDataType!=="metadata")return;const z=this.sourceCaches[E.sourceId];if(!z)return;const R=z.getSource();if(R&&R.vectorLayerIds)for(const V in this._layers){const G=this._layers[V];G.source===R.id&&this._validateLayer(G)}})}loadURL(n,h={}){this.fire(new g.Event("dataloading",{dataType:"style"}));const x=typeof h.validate!="boolean"||h.validate,E=this.map._requestManager.transformRequest(n,g.ResourceType.Style);this._request=g.getJSON(E,(z,R)=>{this._request=null,z?this.fire(new g.ErrorEvent(z)):R&&this._load(R,x)})}loadJSON(n,h={}){this.fire(new g.Event("dataloading",{dataType:"style"})),this._request=g.exported.frame(()=>{this._request=null,this._load(n,h.validate!==!1)})}loadEmpty(){this.fire(new g.Event("dataloading",{dataType:"style"})),this._load(jr,!1)}_load(n,h){if(h&&Mt(this,g.validateStyle(n)))return;this._loaded=!0,this.stylesheet=n;for(const E in n.sources)this.addSource(E,n.sources[E],{validate:!1});n.sprite?this._loadSprite(n.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(n.glyphs);const x=Yo(this.stylesheet.layers);this._order=x.map(E=>E.id),this._layers={},this._serializedLayers={};for(let E of x)E=g.createStyleLayer(E),E.setEventedParent(this,{layer:{id:E.id}}),this._layers[E.id]=E,this._serializedLayers[E.id]=E.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Mr(this.stylesheet.light),this.fire(new g.Event("data",{dataType:"style"})),this.fire(new g.Event("style.load"))}_loadSprite(n){this._spriteRequest=function(h,x,E,z){let R,V,G;const K=E>1?"@2x":"";let Q=g.getJSON(x.transformRequest(x.normalizeSpriteURL(h,K,".json"),g.ResourceType.SpriteJSON),(Le,be)=>{Q=null,G||(G=Le,R=be,_e())}),ae=g.getImage(x.transformRequest(x.normalizeSpriteURL(h,K,".png"),g.ResourceType.SpriteImage),(Le,be)=>{ae=null,G||(G=Le,V=be,_e())});function _e(){if(G)z(G);else if(R&&V){const Le=g.exported.getImageData(V),be={};for(const Me in R){const{width:qe,height:Ne,x:Ke,y:Ze,sdf:ut,pixelRatio:rt,stretchX:ot,stretchY:yt,content:Et}=R[Me],ct=new g.RGBAImage({width:qe,height:Ne});g.RGBAImage.copy(Le,ct,{x:Ke,y:Ze},{x:0,y:0},{width:qe,height:Ne}),be[Me]={data:ct,pixelRatio:rt,sdf:ut,stretchX:ot,stretchY:yt,content:Et}}z(null,be)}}return{cancel(){Q&&(Q.cancel(),Q=null),ae&&(ae.cancel(),ae=null)}}}(n,this.map._requestManager,this.map.getPixelRatio(),(h,x)=>{if(this._spriteRequest=null,h)this.fire(new g.ErrorEvent(h));else if(x)for(const E in x)this.imageManager.addImage(E,x[E]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new g.Event("data",{dataType:"style"}))})}_validateLayer(n){const h=this.sourceCaches[n.source];if(!h)return;const x=n.sourceLayer;if(!x)return;const E=h.getSource();(E.type==="geojson"||E.vectorLayerIds&&E.vectorLayerIds.indexOf(x)===-1)&&this.fire(new g.ErrorEvent(new Error(`Source layer "${x}" does not exist on source "${E.id}" as specified by style layer "${n.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this.sourceCaches)if(!this.sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){const h=[];for(const x of n){const E=this._layers[x];E.type!=="custom"&&h.push(E.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const n in this.sourceCaches)if(this.sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(n){if(!this._loaded)return;const h=this._changed;if(this._changed){const E=Object.keys(this._updatedLayers),z=Object.keys(this._removedLayers);(E.length||z.length)&&this._updateWorkerLayers(E,z);for(const R in this._updatedSources){const V=this._updatedSources[R];V==="reload"?this._reloadSource(R):V==="clear"&&this._clearSource(R)}this._updateTilesForChangedImages();for(const R in this._updatedPaintProps)this._layers[R].updateTransitions(n);this.light.updateTransitions(n),this._resetUpdates()}const x={};for(const E in this.sourceCaches){const z=this.sourceCaches[E];x[E]=z.used,z.used=!1}for(const E of this._order){const z=this._layers[E];z.recalculate(n,this._availableImages),!z.isHidden(n.zoom)&&z.source&&(this.sourceCaches[z.source].used=!0)}for(const E in x){const z=this.sourceCaches[E];x[E]!==z.used&&z.fire(new g.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:E}))}this.light.recalculate(n),this.z=n.zoom,h&&this.fire(new g.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(n){if(this._checkLoaded(),Mt(this,g.validateStyle(n)))return!1;(n=g.clone$1(n)).layers=Yo(n.layers);const h=function(E,z){if(!E)return[{command:wi.setStyle,args:[z]}];let R=[];try{if(!ye(E.version,z.version))return[{command:wi.setStyle,args:[z]}];ye(E.center,z.center)||R.push({command:wi.setCenter,args:[z.center]}),ye(E.zoom,z.zoom)||R.push({command:wi.setZoom,args:[z.zoom]}),ye(E.bearing,z.bearing)||R.push({command:wi.setBearing,args:[z.bearing]}),ye(E.pitch,z.pitch)||R.push({command:wi.setPitch,args:[z.pitch]}),ye(E.sprite,z.sprite)||R.push({command:wi.setSprite,args:[z.sprite]}),ye(E.glyphs,z.glyphs)||R.push({command:wi.setGlyphs,args:[z.glyphs]}),ye(E.transition,z.transition)||R.push({command:wi.setTransition,args:[z.transition]}),ye(E.light,z.light)||R.push({command:wi.setLight,args:[z.light]});const V={},G=[];(function(Q,ae,_e,Le){let be;for(be in ae=ae||{},Q=Q||{})Object.prototype.hasOwnProperty.call(Q,be)&&(Object.prototype.hasOwnProperty.call(ae,be)||ro(be,_e,Le));for(be in ae)Object.prototype.hasOwnProperty.call(ae,be)&&(Object.prototype.hasOwnProperty.call(Q,be)?ye(Q[be],ae[be])||(Q[be].type==="geojson"&&ae[be].type==="geojson"&&Ma(Q,ae,be)?_e.push({command:wi.setGeoJSONSourceData,args:[be,ae[be].data]}):kn(be,ae,_e,Le)):Tn(be,ae,_e))})(E.sources,z.sources,G,V);const K=[];E.layers&&E.layers.forEach(Q=>{V[Q.source]?R.push({command:wi.removeLayer,args:[Q.id]}):K.push(Q)}),R=R.concat(G),function(Q,ae,_e){ae=ae||[];const Le=(Q=Q||[]).map(Rt),be=ae.map(Rt),Me=Q.reduce(Vo,{}),qe=ae.reduce(Vo,{}),Ne=Le.slice(),Ke=Object.create(null);let Ze,ut,rt,ot,yt,Et,ct;for(Ze=0,ut=0;Ze<Le.length;Ze++)rt=Le[Ze],Object.prototype.hasOwnProperty.call(qe,rt)?ut++:(_e.push({command:wi.removeLayer,args:[rt]}),Ne.splice(Ne.indexOf(rt,ut),1));for(Ze=0,ut=0;Ze<be.length;Ze++)rt=be[be.length-1-Ze],Ne[Ne.length-1-Ze]!==rt&&(Object.prototype.hasOwnProperty.call(Me,rt)?(_e.push({command:wi.removeLayer,args:[rt]}),Ne.splice(Ne.lastIndexOf(rt,Ne.length-ut),1)):ut++,Et=Ne[Ne.length-Ze],_e.push({command:wi.addLayer,args:[qe[rt],Et]}),Ne.splice(Ne.length-Ze,0,rt),Ke[rt]=!0);for(Ze=0;Ze<be.length;Ze++)if(rt=be[Ze],ot=Me[rt],yt=qe[rt],!Ke[rt]&&!ye(ot,yt))if(ye(ot.source,yt.source)&&ye(ot["source-layer"],yt["source-layer"])&&ye(ot.type,yt.type)){for(ct in st(ot.layout,yt.layout,_e,rt,null,wi.setLayoutProperty),st(ot.paint,yt.paint,_e,rt,null,wi.setPaintProperty),ye(ot.filter,yt.filter)||_e.push({command:wi.setFilter,args:[rt,yt.filter]}),ye(ot.minzoom,yt.minzoom)&&ye(ot.maxzoom,yt.maxzoom)||_e.push({command:wi.setLayerZoomRange,args:[rt,yt.minzoom,yt.maxzoom]}),ot)Object.prototype.hasOwnProperty.call(ot,ct)&&ct!=="layout"&&ct!=="paint"&&ct!=="filter"&&ct!=="metadata"&&ct!=="minzoom"&&ct!=="maxzoom"&&(ct.indexOf("paint.")===0?st(ot[ct],yt[ct],_e,rt,ct.slice(6),wi.setPaintProperty):ye(ot[ct],yt[ct])||_e.push({command:wi.setLayerProperty,args:[rt,ct,yt[ct]]}));for(ct in yt)Object.prototype.hasOwnProperty.call(yt,ct)&&!Object.prototype.hasOwnProperty.call(ot,ct)&&ct!=="layout"&&ct!=="paint"&&ct!=="filter"&&ct!=="metadata"&&ct!=="minzoom"&&ct!=="maxzoom"&&(ct.indexOf("paint.")===0?st(ot[ct],yt[ct],_e,rt,ct.slice(6),wi.setPaintProperty):ye(ot[ct],yt[ct])||_e.push({command:wi.setLayerProperty,args:[rt,ct,yt[ct]]}))}else _e.push({command:wi.removeLayer,args:[rt]}),Et=Ne[Ne.lastIndexOf(rt)+1],_e.push({command:wi.addLayer,args:[yt,Et]})}(K,z.layers,R)}catch(V){console.warn("Unable to compute style diff:",V),R=[{command:wi.setStyle,args:[z]}]}return R}(this.serialize(),n).filter(E=>!(E.command in qi));if(h.length===0)return!1;const x=h.filter(E=>!(E.command in di));if(x.length>0)throw new Error(`Unimplemented: ${x.map(E=>E.command).join(", ")}.`);return h.forEach(E=>{E.command!=="setTransition"&&this[E.command].apply(this,E.args)}),this.stylesheet=n,!0}addImage(n,h){if(this.getImage(n))return this.fire(new g.ErrorEvent(new Error(`An image named "${n}" already exists.`)));this.imageManager.addImage(n,h),this._afterImageUpdated(n)}updateImage(n,h){this.imageManager.updateImage(n,h)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){if(!this.getImage(n))return this.fire(new g.ErrorEvent(new Error(`An image named "${n}" does not exist.`)));this.imageManager.removeImage(n),this._afterImageUpdated(n)}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new g.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(n,h,x={}){if(this._checkLoaded(),this.sourceCaches[n]!==void 0)throw new Error(`Source "${n}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(g.validateStyle.source,`sources.${n}`,h,null,x))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const E=this.sourceCaches[n]=new ci(n,h,this.dispatcher);E.style=this,E.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:E.serialize(),sourceId:n})),E.onAdd(this.map),this._changed=!0}removeSource(n){if(this._checkLoaded(),this.sourceCaches[n]===void 0)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===n)return this.fire(new g.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${x}" is using it.`)));const h=this.sourceCaches[n];delete this.sourceCaches[n],delete this._updatedSources[n],h.fire(new g.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:n})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(n,h){this._checkLoaded(),this.sourceCaches[n].getSource().setData(h),this._changed=!0}getSource(n){return this.sourceCaches[n]&&this.sourceCaches[n].getSource()}addLayer(n,h,x={}){this._checkLoaded();const E=n.id;if(this.getLayer(E))return void this.fire(new g.ErrorEvent(new Error(`Layer "${E}" already exists on this map.`)));let z;if(n.type==="custom"){if(Mt(this,g.validateCustomStyleLayer(n)))return;z=g.createStyleLayer(n)}else{if(typeof n.source=="object"&&(this.addSource(E,n.source),n=g.clone$1(n),n=g.extend(n,{source:E})),this._validate(g.validateStyle.layer,`layers.${E}`,n,{arrayIndex:-1},x))return;z=g.createStyleLayer(n),this._validateLayer(z),z.setEventedParent(this,{layer:{id:E}}),this._serializedLayers[z.id]=z.serialize()}const R=h?this._order.indexOf(h):this._order.length;if(h&&R===-1)this.fire(new g.ErrorEvent(new Error(`Cannot add layer "${E}" before non-existing layer "${h}".`)));else{if(this._order.splice(R,0,E),this._layerOrderChanged=!0,this._layers[E]=z,this._removedLayers[E]&&z.source&&z.type!=="custom"){const V=this._removedLayers[E];delete this._removedLayers[E],V.type!==z.type?this._updatedSources[z.source]="clear":(this._updatedSources[z.source]="reload",this.sourceCaches[z.source].pause())}this._updateLayer(z),z.onAdd&&z.onAdd(this.map)}}moveLayer(n,h){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new g.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===h)return;const x=this._order.indexOf(n);this._order.splice(x,1);const E=h?this._order.indexOf(h):this._order.length;h&&E===-1?this.fire(new g.ErrorEvent(new Error(`Cannot move layer "${n}" before non-existing layer "${h}".`))):(this._order.splice(E,0,n),this._layerOrderChanged=!0)}removeLayer(n){this._checkLoaded();const h=this._layers[n];if(!h)return void this.fire(new g.ErrorEvent(new Error(`Cannot remove non-existing layer "${n}".`)));h.setEventedParent(null);const x=this._order.indexOf(n);this._order.splice(x,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=h,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],h.onRemove&&h.onRemove(this.map)}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}setLayerZoomRange(n,h,x){this._checkLoaded();const E=this.getLayer(n);E?E.minzoom===h&&E.maxzoom===x||(h!=null&&(E.minzoom=h),x!=null&&(E.maxzoom=x),this._updateLayer(E)):this.fire(new g.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${n}".`)))}setFilter(n,h,x={}){this._checkLoaded();const E=this.getLayer(n);if(E){if(!ye(E.filter,h))return h==null?(E.filter=void 0,void this._updateLayer(E)):void(this._validate(g.validateStyle.filter,`layers.${E.id}.filter`,h,null,x)||(E.filter=g.clone$1(h),this._updateLayer(E)))}else this.fire(new g.ErrorEvent(new Error(`Cannot filter non-existing layer "${n}".`)))}getFilter(n){return g.clone$1(this.getLayer(n).filter)}setLayoutProperty(n,h,x,E={}){this._checkLoaded();const z=this.getLayer(n);z?ye(z.getLayoutProperty(h),x)||(z.setLayoutProperty(h,x,E),this._updateLayer(z)):this.fire(new g.ErrorEvent(new Error(`Cannot style non-existing layer "${n}".`)))}getLayoutProperty(n,h){const x=this.getLayer(n);if(x)return x.getLayoutProperty(h);this.fire(new g.ErrorEvent(new Error(`Cannot get style of non-existing layer "${n}".`)))}setPaintProperty(n,h,x,E={}){this._checkLoaded();const z=this.getLayer(n);z?ye(z.getPaintProperty(h),x)||(z.setPaintProperty(h,x,E)&&this._updateLayer(z),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new g.ErrorEvent(new Error(`Cannot style non-existing layer "${n}".`)))}getPaintProperty(n,h){return this.getLayer(n).getPaintProperty(h)}setFeatureState(n,h){this._checkLoaded();const x=n.source,E=n.sourceLayer,z=this.sourceCaches[x];if(z===void 0)return void this.fire(new g.ErrorEvent(new Error(`The source '${x}' does not exist in the map's style.`)));const R=z.getSource().type;R==="geojson"&&E?this.fire(new g.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):R!=="vector"||E?(n.id===void 0&&this.fire(new g.ErrorEvent(new Error("The feature id parameter must be provided."))),z.setFeatureState(E,n.id,h)):this.fire(new g.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(n,h){this._checkLoaded();const x=n.source,E=this.sourceCaches[x];if(E===void 0)return void this.fire(new g.ErrorEvent(new Error(`The source '${x}' does not exist in the map's style.`)));const z=E.getSource().type,R=z==="vector"?n.sourceLayer:void 0;z!=="vector"||R?h&&typeof n.id!="string"&&typeof n.id!="number"?this.fire(new g.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):E.removeFeatureState(R,n.id,h):this.fire(new g.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(n){this._checkLoaded();const h=n.source,x=n.sourceLayer,E=this.sourceCaches[h];if(E!==void 0)return E.getSource().type!=="vector"||x?(n.id===void 0&&this.fire(new g.ErrorEvent(new Error("The feature id parameter must be provided."))),E.getFeatureState(x,n.id)):void this.fire(new g.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new g.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return g.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return g.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:g.mapObject(this.sourceCaches,n=>n.serialize()),layers:this._serializeLayers(this._order)},n=>n!==void 0)}_updateLayer(n){this._updatedLayers[n.id]=!0,n.source&&!this._updatedSources[n.source]&&this.sourceCaches[n.source].getSource().type!=="raster"&&(this._updatedSources[n.source]="reload",this.sourceCaches[n.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(n){const h=R=>this._layers[R].type==="fill-extrusion",x={},E=[];for(let R=this._order.length-1;R>=0;R--){const V=this._order[R];if(h(V)){x[V]=R;for(const G of n){const K=G[V];if(K)for(const Q of K)E.push(Q)}}}E.sort((R,V)=>V.intersectionZ-R.intersectionZ);const z=[];for(let R=this._order.length-1;R>=0;R--){const V=this._order[R];if(h(V))for(let G=E.length-1;G>=0;G--){const K=E[G].feature;if(x[K.layer.id]<R)break;z.push(K),E.pop()}else for(const G of n){const K=G[V];if(K)for(const Q of K)z.push(Q.feature)}}return z}queryRenderedFeatures(n,h,x){h&&h.filter&&this._validate(g.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);const E={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new g.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const R of h.layers){const V=this._layers[R];if(!V)return this.fire(new g.ErrorEvent(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];E[V.source]=!0}}const z=[];h.availableImages=this._availableImages;for(const R in this.sourceCaches)h.layers&&!E[R]||z.push(hn(this.sourceCaches[R],this._layers,this._serializedLayers,n,h,x));return this.placement&&z.push(function(R,V,G,K,Q,ae,_e){const Le={},be=ae.queryRenderedSymbols(K),Me=[];for(const qe of Object.keys(be).map(Number))Me.push(_e[qe]);Me.sort(Fi);for(const qe of Me){const Ne=qe.featureIndex.lookupSymbolFeatures(be[qe.bucketInstanceId],V,qe.bucketIndex,qe.sourceLayerIndex,Q.filter,Q.layers,Q.availableImages,R);for(const Ke in Ne){const Ze=Le[Ke]=Le[Ke]||[],ut=Ne[Ke];ut.sort((rt,ot)=>{const yt=qe.featureSortOrder;if(yt){const Et=yt.indexOf(rt.featureIndex);return yt.indexOf(ot.featureIndex)-Et}return ot.featureIndex-rt.featureIndex});for(const rt of ut)Ze.push(rt)}}for(const qe in Le)Le[qe].forEach(Ne=>{const Ke=Ne.feature,Ze=G[R[qe].source].getFeatureState(Ke.layer["source-layer"],Ke.id);Ke.source=Ke.layer.source,Ke.layer["source-layer"]&&(Ke.sourceLayer=Ke.layer["source-layer"]),Ke.state=Ze});return Le}(this._layers,this._serializedLayers,this.sourceCaches,n,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(z)}querySourceFeatures(n,h){h&&h.filter&&this._validate(g.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);const x=this.sourceCaches[n];return x?function(E,z){const R=E.getRenderableIds().map(K=>E.getTileByID(K)),V=[],G={};for(let K=0;K<R.length;K++){const Q=R[K],ae=Q.tileID.canonical.key;G[ae]||(G[ae]=!0,Q.querySourceFeatures(V,z))}return V}(x,h):[]}addSourceType(n,h,x){return Xi.getSourceType(n)?x(new Error(`A source type called "${n}" already exists.`)):(Xi.setSourceType(n,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:h.workerSourceURL},x):x(null,null))}getLight(){return this.light.getLight()}setLight(n,h={}){this._checkLoaded();const x=this.light.getLight();let E=!1;for(const R in n)if(!ye(n[R],x[R])){E=!0;break}if(!E)return;const z={now:g.exported.now(),transition:g.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(n,h),this.light.updateTransitions(z)}_validate(n,h,x,E,z={}){return(!z||z.validate!==!1)&&Mt(this,n.call(g.validateStyle,g.extend({key:h,style:this.serialize(),value:x,styleSpec:g.spec},E)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),g.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this.sourceCaches){const h=this.sourceCaches[n];h.setEventedParent(null),h.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){this.sourceCaches[n].clearTiles()}_reloadSource(n){this.sourceCaches[n].resume(),this.sourceCaches[n].reload()}_updateSources(n){for(const h in this.sourceCaches)this.sourceCaches[h].update(n)}_generateCollisionBoxes(){for(const n in this.sourceCaches)this._reloadSource(n)}_updatePlacement(n,h,x,E,z=!1){let R=!1,V=!1;const G={};for(const K of this._order){const Q=this._layers[K];if(Q.type!=="symbol")continue;if(!G[Q.source]){const _e=this.sourceCaches[Q.source];G[Q.source]=_e.getRenderableIds(!0).map(Le=>_e.getTileByID(Le)).sort((Le,be)=>be.tileID.overscaledZ-Le.tileID.overscaledZ||(Le.tileID.isLessThan(be.tileID)?-1:1))}const ae=this.crossTileSymbolIndex.addLayer(Q,G[Q.source],n.center.lng);R=R||ae}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((z=z||this._layerOrderChanged||x===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(g.exported.now(),n.zoom))&&(this.pauseablePlacement=new wt(n,this._order,z,h,x,E,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,G),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(g.exported.now()),V=!0),R&&this.pauseablePlacement.placement.setStale()),V||R)for(const K of this._order){const Q=this._layers[K];Q.type==="symbol"&&this.placement.updateLayerOpacities(Q,G[Q.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(g.exported.now())}_releaseSymbolFadeTiles(){for(const n in this.sourceCaches)this.sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,h,x){this.imageManager.getImages(h.icons,x),this._updateTilesForChangedImages();const E=this.sourceCaches[h.source];E&&E.setDependencies(h.tileID.key,h.type,h.icons)}getGlyphs(n,h,x){this.glyphManager.getGlyphs(h.stacks,x)}getResource(n,h,x){return g.makeRequest(h,x)}}Xi.getSourceType=function(b){return Hr[b]},Xi.setSourceType=function(b,n){Hr[b]=n},Xi.registerForPluginStateChange=g.registerForPluginStateChange;var Ln=g.createLayout([{name:"a_pos",type:"Int16",components:2}]),Gs={prelude:tr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),background:tr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:tr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:tr(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:tr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:tr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:tr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:tr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:tr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:tr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),fill:tr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:tr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:tr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:tr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:tr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:tr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:tr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:tr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:tr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),lineGradient:tr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),linePattern:tr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:tr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:tr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:tr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),symbolSDF:tr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:tr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`)};function tr(b,n){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,x=n.match(/attribute ([\w]+) ([\w]+)/g),E=b.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),z=n.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),R=z?z.concat(E):E,V={};return{fragmentSource:b=b.replace(h,(G,K,Q,ae,_e)=>(V[_e]=!0,K==="define"?`
#ifndef HAS_UNIFORM_u_${_e}
varying ${Q} ${ae} ${_e};
#else
uniform ${Q} ${ae} u_${_e};
#endif
`:`
#ifdef HAS_UNIFORM_u_${_e}
    ${Q} ${ae} ${_e} = u_${_e};
#endif
`)),vertexSource:n=n.replace(h,(G,K,Q,ae,_e)=>{const Le=ae==="float"?"vec2":"vec4",be=_e.match(/color/)?"color":Le;return V[_e]?K==="define"?`
#ifndef HAS_UNIFORM_u_${_e}
uniform lowp float u_${_e}_t;
attribute ${Q} ${Le} a_${_e};
varying ${Q} ${ae} ${_e};
#else
uniform ${Q} ${ae} u_${_e};
#endif
`:be==="vec4"?`
#ifndef HAS_UNIFORM_u_${_e}
    ${_e} = a_${_e};
#else
    ${Q} ${ae} ${_e} = u_${_e};
#endif
`:`
#ifndef HAS_UNIFORM_u_${_e}
    ${_e} = unpack_mix_${be}(a_${_e}, u_${_e}_t);
#else
    ${Q} ${ae} ${_e} = u_${_e};
#endif
`:K==="define"?`
#ifndef HAS_UNIFORM_u_${_e}
uniform lowp float u_${_e}_t;
attribute ${Q} ${Le} a_${_e};
#else
uniform ${Q} ${ae} u_${_e};
#endif
`:be==="vec4"?`
#ifndef HAS_UNIFORM_u_${_e}
    ${Q} ${ae} ${_e} = a_${_e};
#else
    ${Q} ${ae} ${_e} = u_${_e};
#endif
`:`
#ifndef HAS_UNIFORM_u_${_e}
    ${Q} ${ae} ${_e} = unpack_mix_${be}(a_${_e}, u_${_e}_t);
#else
    ${Q} ${ae} ${_e} = u_${_e};
#endif
`}),staticAttributes:x,staticUniforms:R}}class Rr{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(n,h,x,E,z,R,V,G){this.context=n;let K=this.boundPaintVertexBuffers.length!==E.length;for(let Q=0;!K&&Q<E.length;Q++)this.boundPaintVertexBuffers[Q]!==E[Q]&&(K=!0);n.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===x&&!K&&this.boundIndexBuffer===z&&this.boundVertexOffset===R&&this.boundDynamicVertexBuffer===V&&this.boundDynamicVertexBuffer2===G?(n.bindVertexArrayOES.set(this.vao),V&&V.bind(),z&&z.dynamicDraw&&z.bind(),G&&G.bind()):this.freshBind(h,x,E,z,R,V,G)}freshBind(n,h,x,E,z,R,V){let G;const K=n.numAttributes,Q=this.context,ae=Q.gl;if(Q.extVertexArrayObject)this.vao&&this.destroy(),this.vao=Q.extVertexArrayObject.createVertexArrayOES(),Q.bindVertexArrayOES.set(this.vao),G=0,this.boundProgram=n,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=x,this.boundIndexBuffer=E,this.boundVertexOffset=z,this.boundDynamicVertexBuffer=R,this.boundDynamicVertexBuffer2=V;else{G=Q.currentNumAttributes||0;for(let _e=K;_e<G;_e++)ae.disableVertexAttribArray(_e)}h.enableAttributes(ae,n);for(const _e of x)_e.enableAttributes(ae,n);R&&R.enableAttributes(ae,n),V&&V.enableAttributes(ae,n),h.bind(),h.setVertexAttribPointers(ae,n,z);for(const _e of x)_e.bind(),_e.setVertexAttribPointers(ae,n,z);R&&(R.bind(),R.setVertexAttribPointers(ae,n,z)),E&&E.bind(),V&&(V.bind(),V.setVertexAttribPointers(ae,n,z)),Q.currentNumAttributes=K}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function es(b){const n=[];for(let h=0;h<b.length;h++){if(b[h]===null)continue;const x=b[h].split(" ");n.push(x.pop())}return n}class Vn{constructor(n,h,x,E,z,R){const V=n.gl;this.program=V.createProgram();const G=es(x.staticAttributes),K=E?E.getBinderAttributes():[],Q=G.concat(K),ae=x.staticUniforms?es(x.staticUniforms):[],_e=E?E.getBinderUniforms():[],Le=ae.concat(_e),be=[];for(const rt of Le)be.indexOf(rt)<0&&be.push(rt);const Me=E?E.defines():[];R&&Me.push("#define OVERDRAW_INSPECTOR;");const qe=Me.concat(Gs.prelude.fragmentSource,x.fragmentSource).join(`
`),Ne=Me.concat(Gs.prelude.vertexSource,x.vertexSource).join(`
`),Ke=V.createShader(V.FRAGMENT_SHADER);if(V.isContextLost())return void(this.failedToCreate=!0);V.shaderSource(Ke,qe),V.compileShader(Ke),V.attachShader(this.program,Ke);const Ze=V.createShader(V.VERTEX_SHADER);if(V.isContextLost())return void(this.failedToCreate=!0);V.shaderSource(Ze,Ne),V.compileShader(Ze),V.attachShader(this.program,Ze),this.attributes={};const ut={};this.numAttributes=Q.length;for(let rt=0;rt<this.numAttributes;rt++)Q[rt]&&(V.bindAttribLocation(this.program,rt,Q[rt]),this.attributes[Q[rt]]=rt);V.linkProgram(this.program),V.deleteShader(Ze),V.deleteShader(Ke);for(let rt=0;rt<be.length;rt++){const ot=be[rt];if(ot&&!ut[ot]){const yt=V.getUniformLocation(this.program,ot);yt&&(ut[ot]=yt)}}this.fixedUniforms=z(n,ut),this.binderUniforms=E?E.getUniforms(n,ut):[]}draw(n,h,x,E,z,R,V,G,K,Q,ae,_e,Le,be,Me,qe){const Ne=n.gl;if(this.failedToCreate)return;n.program.set(this.program),n.setDepthMode(x),n.setStencilMode(E),n.setColorMode(z),n.setCullFace(R);for(const Ze in this.fixedUniforms)this.fixedUniforms[Ze].set(V[Ze]);be&&be.setUniforms(n,this.binderUniforms,_e,{zoom:Le});const Ke={[Ne.LINES]:2,[Ne.TRIANGLES]:3,[Ne.LINE_STRIP]:1}[h];for(const Ze of ae.get()){const ut=Ze.vaos||(Ze.vaos={});(ut[G]||(ut[G]=new Rr)).bind(n,this,K,be?be.getPaintVertexBuffers():[],Q,Ze.vertexOffset,Me,qe),Ne.drawElements(h,Ze.primitiveLength*Ke,Ne.UNSIGNED_SHORT,Ze.primitiveOffset*Ke*2)}}}function Jr(b,n,h){const x=1/Te(h,1,n.transform.tileZoom),E=Math.pow(2,h.tileID.overscaledZ),z=h.tileSize*Math.pow(2,n.transform.tileZoom)/E,R=z*(h.tileID.canonical.x+h.tileID.wrap*E),V=z*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[x,b.fromScale,b.toScale],u_fade:b.t,u_pixel_coord_upper:[R>>16,V>>16],u_pixel_coord_lower:[65535&R,65535&V]}}const bo=(b,n,h,x)=>{const E=n.style.light,z=E.properties.get("position"),R=[z.x,z.y,z.z],V=function(){var K=new g.ARRAY_TYPE(9);return g.ARRAY_TYPE!=Float32Array&&(K[1]=0,K[2]=0,K[3]=0,K[5]=0,K[6]=0,K[7]=0),K[0]=1,K[4]=1,K[8]=1,K}();E.properties.get("anchor")==="viewport"&&function(K,Q){var ae=Math.sin(Q),_e=Math.cos(Q);K[0]=_e,K[1]=ae,K[2]=0,K[3]=-ae,K[4]=_e,K[5]=0,K[6]=0,K[7]=0,K[8]=1}(V,-n.transform.angle),function(K,Q,ae){var _e=Q[0],Le=Q[1],be=Q[2];K[0]=_e*ae[0]+Le*ae[3]+be*ae[6],K[1]=_e*ae[1]+Le*ae[4]+be*ae[7],K[2]=_e*ae[2]+Le*ae[5]+be*ae[8]}(R,R,V);const G=E.properties.get("color");return{u_matrix:b,u_lightpos:R,u_lightintensity:E.properties.get("intensity"),u_lightcolor:[G.r,G.g,G.b],u_vertical_gradient:+h,u_opacity:x}},pr=(b,n,h,x,E,z,R)=>g.extend(bo(b,n,h,x),Jr(z,n,R),{u_height_factor:-Math.pow(2,E.overscaledZ)/R.tileSize/8}),wo=b=>({u_matrix:b}),Kn=(b,n,h,x)=>g.extend(wo(b),Jr(h,n,x)),du=(b,n)=>({u_matrix:b,u_world:n}),Eo=(b,n,h,x,E)=>g.extend(Kn(b,n,h,x),{u_world:E}),ts=(b,n,h,x)=>{const E=b.transform;let z,R;if(x.paint.get("circle-pitch-alignment")==="map"){const V=Te(h,1,E.zoom);z=!0,R=[V,V]}else z=!1,R=E.pixelsToGLUnits;return{u_camera_to_center_distance:E.cameraToCenterDistance,u_scale_with_map:+(x.paint.get("circle-pitch-scale")==="map"),u_matrix:b.translatePosMatrix(n.posMatrix,h,x.paint.get("circle-translate"),x.paint.get("circle-translate-anchor")),u_pitch_with_map:+z,u_device_pixel_ratio:b.pixelRatio,u_extrude_scale:R}},Lo=(b,n,h)=>{const x=Te(h,1,n.zoom),E=Math.pow(2,n.zoom-h.tileID.overscaledZ),z=h.tileID.overscaleFactor();return{u_matrix:b,u_camera_to_center_distance:n.cameraToCenterDistance,u_pixels_to_tile_units:x,u_extrude_scale:[n.pixelsToGLUnits[0]/(x*E),n.pixelsToGLUnits[1]/(x*E)],u_overscale_factor:z}},Br=(b,n,h=1)=>({u_matrix:b,u_color:n,u_overlay:0,u_overlay_scale:h}),oo=b=>({u_matrix:b}),mn=(b,n,h,x)=>({u_matrix:b,u_extrude_scale:Te(n,1,h),u_intensity:x});function Qo(b,n){const h=Math.pow(2,n.canonical.z),x=n.canonical.y;return[new g.MercatorCoordinate(0,x/h).toLngLat().lat,new g.MercatorCoordinate(0,(x+1)/h).toLngLat().lat]}const Zs=(b,n,h)=>{const x=b.transform;return{u_matrix:fu(b,n,h),u_ratio:1/Te(n,1,x.zoom),u_device_pixel_ratio:b.pixelRatio,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},Il=(b,n,h,x)=>g.extend(Zs(b,n,h),{u_image:0,u_image_height:x}),is=(b,n,h,x)=>{const E=b.transform,z=Ss(n,E);return{u_matrix:fu(b,n,h),u_texsize:n.imageAtlasTexture.size,u_ratio:1/Te(n,1,E.zoom),u_device_pixel_ratio:b.pixelRatio,u_image:0,u_scale:[z,x.fromScale,x.toScale],u_fade:x.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]]}},on=(b,n,h,x,E)=>{const z=b.lineAtlas,R=Ss(n,b.transform),V=h.layout.get("line-cap")==="round",G=z.getDash(x.from,V),K=z.getDash(x.to,V),Q=G.width*E.fromScale,ae=K.width*E.toScale;return g.extend(Zs(b,n,h),{u_patternscale_a:[R/Q,-G.height/2],u_patternscale_b:[R/ae,-K.height/2],u_sdfgamma:z.width/(256*Math.min(Q,ae)*b.pixelRatio)/2,u_image:0,u_tex_y_a:G.y,u_tex_y_b:K.y,u_mix:E.t})};function Ss(b,n){return 1/Te(b,1,n.tileZoom)}function fu(b,n,h){return b.translatePosMatrix(n.tileID.posMatrix,n,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const mu=(b,n,h,x,E)=>{return{u_matrix:b,u_tl_parent:n,u_scale_parent:h,u_buffer_scale:1,u_fade_t:x.mix,u_opacity:x.opacity*E.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:E.paint.get("raster-brightness-min"),u_brightness_high:E.paint.get("raster-brightness-max"),u_saturation_factor:(R=E.paint.get("raster-saturation"),R>0?1-1/(1.001-R):-R),u_contrast_factor:(z=E.paint.get("raster-contrast"),z>0?1/(1-z):1+z),u_spin_weights:gu(E.paint.get("raster-hue-rotate"))};var z,R};function gu(b){b*=Math.PI/180;const n=Math.sin(b),h=Math.cos(b);return[(2*h+1)/3,(-Math.sqrt(3)*n-h+1)/3,(Math.sqrt(3)*n-h+1)/3]}const fa=(b,n,h,x,E,z,R,V,G,K)=>{const Q=E.transform;return{u_is_size_zoom_constant:+(b==="constant"||b==="source"),u_is_size_feature_constant:+(b==="constant"||b==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:Q.cameraToCenterDistance,u_pitch:Q.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:Q.width/Q.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:z,u_label_plane_matrix:R,u_coord_matrix:V,u_is_text:+G,u_pitch_with_map:+x,u_texsize:K,u_texture:0}},Xs=(b,n,h,x,E,z,R,V,G,K,Q)=>{const ae=E.transform;return g.extend(fa(b,n,h,x,E,z,R,V,G,K),{u_gamma_scale:x?Math.cos(ae._pitch)*ae.cameraToCenterDistance:1,u_device_pixel_ratio:E.pixelRatio,u_is_halo:+Q})},$s=(b,n,h,x,E,z,R,V,G,K)=>g.extend(Xs(b,n,h,x,E,z,R,V,!0,G,!0),{u_texsize_icon:K,u_texture_icon:1}),$u=(b,n,h)=>({u_matrix:b,u_opacity:n,u_color:h}),Ts=(b,n,h,x,E,z)=>g.extend(function(R,V,G,K){const Q=G.imageManager.getPattern(R.from.toString()),ae=G.imageManager.getPattern(R.to.toString()),{width:_e,height:Le}=G.imageManager.getPixelSize(),be=Math.pow(2,K.tileID.overscaledZ),Me=K.tileSize*Math.pow(2,G.transform.tileZoom)/be,qe=Me*(K.tileID.canonical.x+K.tileID.wrap*be),Ne=Me*K.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Q.tl,u_pattern_br_a:Q.br,u_pattern_tl_b:ae.tl,u_pattern_br_b:ae.br,u_texsize:[_e,Le],u_mix:V.t,u_pattern_size_a:Q.displaySize,u_pattern_size_b:ae.displaySize,u_scale_a:V.fromScale,u_scale_b:V.toScale,u_tile_units_to_pixels:1/Te(K,1,G.transform.tileZoom),u_pixel_coord_upper:[qe>>16,Ne>>16],u_pixel_coord_lower:[65535&qe,65535&Ne]}}(x,z,h,E),{u_matrix:b,u_opacity:n}),ao={fillExtrusion:(b,n)=>({u_matrix:new g.UniformMatrix4f(b,n.u_matrix),u_lightpos:new g.Uniform3f(b,n.u_lightpos),u_lightintensity:new g.Uniform1f(b,n.u_lightintensity),u_lightcolor:new g.Uniform3f(b,n.u_lightcolor),u_vertical_gradient:new g.Uniform1f(b,n.u_vertical_gradient),u_opacity:new g.Uniform1f(b,n.u_opacity)}),fillExtrusionPattern:(b,n)=>({u_matrix:new g.UniformMatrix4f(b,n.u_matrix),u_lightpos:new g.Uniform3f(b,n.u_lightpos),u_lightintensity:new g.Uniform1f(b,n.u_lightintensity),u_lightcolor:new g.Uniform3f(b,n.u_lightcolor),u_vertical_gradient:new g.Uniform1f(b,n.u_vertical_gradient),u_height_factor:new g.Uniform1f(b,n.u_height_factor),u_image:new g.Uniform1i(b,n.u_image),u_texsize:new g.Uniform2f(b,n.u_texsize),u_pixel_coord_upper:new g.Uniform2f(b,n.u_pixel_coord_upper),u_pixel_coord_lower:new g.Uniform2f(b,n.u_pixel_coord_lower),u_scale:new g.Uniform3f(b,n.u_scale),u_fade:new g.Uniform1f(b,n.u_fade),u_opacity:new g.Uniform1f(b,n.u_opacity)}),fill:(b,n)=>({u_matrix:new g.UniformMatrix4f(b,n.u_matrix)}),fillPattern:(b,n)=>({u_matrix:new g.UniformMatrix4f(b,n.u_matrix),u_image:new g.Uniform1i(b,n.u_image),u_texsize:new g.Uniform2f(b,n.u_texsize),u_pixel_coord_upper:new g.Uniform2f(b,n.u_pixel_coord_upper),u_pixel_coord_lower:new g.Uniform2f(b,n.u_pixel_coord_lower),u_scale:new g.Uniform3f(b,n.u_scale),u_fade:new g.Uniform1f(b,n.u_fade)}),fillOutline:(b,n)=>({u_matrix:new g.UniformMatrix4f(b,n.u_matrix),u_world:new g.Uniform2f(b,n.u_world)}),fillOutlinePattern:(b,n)=>({u_matrix:new g.UniformMatrix4f(b,n.u_matrix),u_world:new g.Uniform2f(b,n.u_world),u_image:new g.Uniform1i(b,n.u_image),u_texsize:new g.Uniform2f(b,n.u_texsize),u_pixel_coord_upper:new g.Uniform2f(b,n.u_pixel_coord_upper),u_pixel_coord_lower:new g.Uniform2f(b,n.u_pixel_coord_lower),u_scale:new g.Uniform3f(b,n.u_scale),u_fade:new g.Uniform1f(b,n.u_fade)}),circle:(b,n)=>({u_camera_to_center_distance:new g.Uniform1f(b,n.u_camera_to_center_distance),u_scale_with_map:new g.Uniform1i(b,n.u_scale_with_map),u_pitch_with_map:new g.Uniform1i(b,n.u_pitch_with_map),u_extrude_scale:new g.Uniform2f(b,n.u_extrude_scale),u_device_pixel_ratio:new g.Uniform1f(b,n.u_device_pixel_ratio),u_matrix:new g.UniformMatrix4f(b,n.u_matrix)}),collisionBox:(b,n)=>({u_matrix:new g.UniformMatrix4f(b,n.u_matrix),u_camera_to_center_distance:new g.Uniform1f(b,n.u_camera_to_center_distance),u_pixels_to_tile_units:new g.Uniform1f(b,n.u_pixels_to_tile_units),u_extrude_scale:new g.Uniform2f(b,n.u_extrude_scale),u_overscale_factor:new g.Uniform1f(b,n.u_overscale_factor)}),collisionCircle:(b,n)=>({u_matrix:new g.UniformMatrix4f(b,n.u_matrix),u_inv_matrix:new g.UniformMatrix4f(b,n.u_inv_matrix),u_camera_to_center_distance:new g.Uniform1f(b,n.u_camera_to_center_distance),u_viewport_size:new g.Uniform2f(b,n.u_viewport_size)}),debug:(b,n)=>({u_color:new g.UniformColor(b,n.u_color),u_matrix:new g.UniformMatrix4f(b,n.u_matrix),u_overlay:new g.Uniform1i(b,n.u_overlay),u_overlay_scale:new g.Uniform1f(b,n.u_overlay_scale)}),clippingMask:(b,n)=>({u_matrix:new g.UniformMatrix4f(b,n.u_matrix)}),heatmap:(b,n)=>({u_extrude_scale:new g.Uniform1f(b,n.u_extrude_scale),u_intensity:new g.Uniform1f(b,n.u_intensity),u_matrix:new g.UniformMatrix4f(b,n.u_matrix)}),heatmapTexture:(b,n)=>({u_matrix:new g.UniformMatrix4f(b,n.u_matrix),u_world:new g.Uniform2f(b,n.u_world),u_image:new g.Uniform1i(b,n.u_image),u_color_ramp:new g.Uniform1i(b,n.u_color_ramp),u_opacity:new g.Uniform1f(b,n.u_opacity)}),hillshade:(b,n)=>({u_matrix:new g.UniformMatrix4f(b,n.u_matrix),u_image:new g.Uniform1i(b,n.u_image),u_latrange:new g.Uniform2f(b,n.u_latrange),u_light:new g.Uniform2f(b,n.u_light),u_shadow:new g.UniformColor(b,n.u_shadow),u_highlight:new g.UniformColor(b,n.u_highlight),u_accent:new g.UniformColor(b,n.u_accent)}),hillshadePrepare:(b,n)=>({u_matrix:new g.UniformMatrix4f(b,n.u_matrix),u_image:new g.Uniform1i(b,n.u_image),u_dimension:new g.Uniform2f(b,n.u_dimension),u_zoom:new g.Uniform1f(b,n.u_zoom),u_unpack:new g.Uniform4f(b,n.u_unpack)}),line:(b,n)=>({u_matrix:new g.UniformMatrix4f(b,n.u_matrix),u_ratio:new g.Uniform1f(b,n.u_ratio),u_device_pixel_ratio:new g.Uniform1f(b,n.u_device_pixel_ratio),u_units_to_pixels:new g.Uniform2f(b,n.u_units_to_pixels)}),lineGradient:(b,n)=>({u_matrix:new g.UniformMatrix4f(b,n.u_matrix),u_ratio:new g.Uniform1f(b,n.u_ratio),u_device_pixel_ratio:new g.Uniform1f(b,n.u_device_pixel_ratio),u_units_to_pixels:new g.Uniform2f(b,n.u_units_to_pixels),u_image:new g.Uniform1i(b,n.u_image),u_image_height:new g.Uniform1f(b,n.u_image_height)}),linePattern:(b,n)=>({u_matrix:new g.UniformMatrix4f(b,n.u_matrix),u_texsize:new g.Uniform2f(b,n.u_texsize),u_ratio:new g.Uniform1f(b,n.u_ratio),u_device_pixel_ratio:new g.Uniform1f(b,n.u_device_pixel_ratio),u_image:new g.Uniform1i(b,n.u_image),u_units_to_pixels:new g.Uniform2f(b,n.u_units_to_pixels),u_scale:new g.Uniform3f(b,n.u_scale),u_fade:new g.Uniform1f(b,n.u_fade)}),lineSDF:(b,n)=>({u_matrix:new g.UniformMatrix4f(b,n.u_matrix),u_ratio:new g.Uniform1f(b,n.u_ratio),u_device_pixel_ratio:new g.Uniform1f(b,n.u_device_pixel_ratio),u_units_to_pixels:new g.Uniform2f(b,n.u_units_to_pixels),u_patternscale_a:new g.Uniform2f(b,n.u_patternscale_a),u_patternscale_b:new g.Uniform2f(b,n.u_patternscale_b),u_sdfgamma:new g.Uniform1f(b,n.u_sdfgamma),u_image:new g.Uniform1i(b,n.u_image),u_tex_y_a:new g.Uniform1f(b,n.u_tex_y_a),u_tex_y_b:new g.Uniform1f(b,n.u_tex_y_b),u_mix:new g.Uniform1f(b,n.u_mix)}),raster:(b,n)=>({u_matrix:new g.UniformMatrix4f(b,n.u_matrix),u_tl_parent:new g.Uniform2f(b,n.u_tl_parent),u_scale_parent:new g.Uniform1f(b,n.u_scale_parent),u_buffer_scale:new g.Uniform1f(b,n.u_buffer_scale),u_fade_t:new g.Uniform1f(b,n.u_fade_t),u_opacity:new g.Uniform1f(b,n.u_opacity),u_image0:new g.Uniform1i(b,n.u_image0),u_image1:new g.Uniform1i(b,n.u_image1),u_brightness_low:new g.Uniform1f(b,n.u_brightness_low),u_brightness_high:new g.Uniform1f(b,n.u_brightness_high),u_saturation_factor:new g.Uniform1f(b,n.u_saturation_factor),u_contrast_factor:new g.Uniform1f(b,n.u_contrast_factor),u_spin_weights:new g.Uniform3f(b,n.u_spin_weights)}),symbolIcon:(b,n)=>({u_is_size_zoom_constant:new g.Uniform1i(b,n.u_is_size_zoom_constant),u_is_size_feature_constant:new g.Uniform1i(b,n.u_is_size_feature_constant),u_size_t:new g.Uniform1f(b,n.u_size_t),u_size:new g.Uniform1f(b,n.u_size),u_camera_to_center_distance:new g.Uniform1f(b,n.u_camera_to_center_distance),u_pitch:new g.Uniform1f(b,n.u_pitch),u_rotate_symbol:new g.Uniform1i(b,n.u_rotate_symbol),u_aspect_ratio:new g.Uniform1f(b,n.u_aspect_ratio),u_fade_change:new g.Uniform1f(b,n.u_fade_change),u_matrix:new g.UniformMatrix4f(b,n.u_matrix),u_label_plane_matrix:new g.UniformMatrix4f(b,n.u_label_plane_matrix),u_coord_matrix:new g.UniformMatrix4f(b,n.u_coord_matrix),u_is_text:new g.Uniform1i(b,n.u_is_text),u_pitch_with_map:new g.Uniform1i(b,n.u_pitch_with_map),u_texsize:new g.Uniform2f(b,n.u_texsize),u_texture:new g.Uniform1i(b,n.u_texture)}),symbolSDF:(b,n)=>({u_is_size_zoom_constant:new g.Uniform1i(b,n.u_is_size_zoom_constant),u_is_size_feature_constant:new g.Uniform1i(b,n.u_is_size_feature_constant),u_size_t:new g.Uniform1f(b,n.u_size_t),u_size:new g.Uniform1f(b,n.u_size),u_camera_to_center_distance:new g.Uniform1f(b,n.u_camera_to_center_distance),u_pitch:new g.Uniform1f(b,n.u_pitch),u_rotate_symbol:new g.Uniform1i(b,n.u_rotate_symbol),u_aspect_ratio:new g.Uniform1f(b,n.u_aspect_ratio),u_fade_change:new g.Uniform1f(b,n.u_fade_change),u_matrix:new g.UniformMatrix4f(b,n.u_matrix),u_label_plane_matrix:new g.UniformMatrix4f(b,n.u_label_plane_matrix),u_coord_matrix:new g.UniformMatrix4f(b,n.u_coord_matrix),u_is_text:new g.Uniform1i(b,n.u_is_text),u_pitch_with_map:new g.Uniform1i(b,n.u_pitch_with_map),u_texsize:new g.Uniform2f(b,n.u_texsize),u_texture:new g.Uniform1i(b,n.u_texture),u_gamma_scale:new g.Uniform1f(b,n.u_gamma_scale),u_device_pixel_ratio:new g.Uniform1f(b,n.u_device_pixel_ratio),u_is_halo:new g.Uniform1i(b,n.u_is_halo)}),symbolTextAndIcon:(b,n)=>({u_is_size_zoom_constant:new g.Uniform1i(b,n.u_is_size_zoom_constant),u_is_size_feature_constant:new g.Uniform1i(b,n.u_is_size_feature_constant),u_size_t:new g.Uniform1f(b,n.u_size_t),u_size:new g.Uniform1f(b,n.u_size),u_camera_to_center_distance:new g.Uniform1f(b,n.u_camera_to_center_distance),u_pitch:new g.Uniform1f(b,n.u_pitch),u_rotate_symbol:new g.Uniform1i(b,n.u_rotate_symbol),u_aspect_ratio:new g.Uniform1f(b,n.u_aspect_ratio),u_fade_change:new g.Uniform1f(b,n.u_fade_change),u_matrix:new g.UniformMatrix4f(b,n.u_matrix),u_label_plane_matrix:new g.UniformMatrix4f(b,n.u_label_plane_matrix),u_coord_matrix:new g.UniformMatrix4f(b,n.u_coord_matrix),u_is_text:new g.Uniform1i(b,n.u_is_text),u_pitch_with_map:new g.Uniform1i(b,n.u_pitch_with_map),u_texsize:new g.Uniform2f(b,n.u_texsize),u_texsize_icon:new g.Uniform2f(b,n.u_texsize_icon),u_texture:new g.Uniform1i(b,n.u_texture),u_texture_icon:new g.Uniform1i(b,n.u_texture_icon),u_gamma_scale:new g.Uniform1f(b,n.u_gamma_scale),u_device_pixel_ratio:new g.Uniform1f(b,n.u_device_pixel_ratio),u_is_halo:new g.Uniform1i(b,n.u_is_halo)}),background:(b,n)=>({u_matrix:new g.UniformMatrix4f(b,n.u_matrix),u_opacity:new g.Uniform1f(b,n.u_opacity),u_color:new g.UniformColor(b,n.u_color)}),backgroundPattern:(b,n)=>({u_matrix:new g.UniformMatrix4f(b,n.u_matrix),u_opacity:new g.Uniform1f(b,n.u_opacity),u_image:new g.Uniform1i(b,n.u_image),u_pattern_tl_a:new g.Uniform2f(b,n.u_pattern_tl_a),u_pattern_br_a:new g.Uniform2f(b,n.u_pattern_br_a),u_pattern_tl_b:new g.Uniform2f(b,n.u_pattern_tl_b),u_pattern_br_b:new g.Uniform2f(b,n.u_pattern_br_b),u_texsize:new g.Uniform2f(b,n.u_texsize),u_mix:new g.Uniform1f(b,n.u_mix),u_pattern_size_a:new g.Uniform2f(b,n.u_pattern_size_a),u_pattern_size_b:new g.Uniform2f(b,n.u_pattern_size_b),u_scale_a:new g.Uniform1f(b,n.u_scale_a),u_scale_b:new g.Uniform1f(b,n.u_scale_b),u_pixel_coord_upper:new g.Uniform2f(b,n.u_pixel_coord_upper),u_pixel_coord_lower:new g.Uniform2f(b,n.u_pixel_coord_lower),u_tile_units_to_pixels:new g.Uniform1f(b,n.u_tile_units_to_pixels)})};class ea{constructor(n,h,x){this.context=n;const E=n.gl;this.buffer=E.createBuffer(),this.dynamicDraw=Boolean(x),this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),E.bufferData(E.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ta={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class La{constructor(n,h,x,E){this.length=h.length,this.attributes=x,this.itemSize=h.bytesPerElement,this.dynamicDraw=E,this.context=n;const z=n.gl;this.buffer=z.createBuffer(),n.bindVertexBuffer.set(this.buffer),z.bufferData(z.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?z.DYNAMIC_DRAW:z.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,h){for(let x=0;x<this.attributes.length;x++){const E=h.attributes[this.attributes[x].name];E!==void 0&&n.enableVertexAttribArray(E)}}setVertexAttribPointers(n,h,x){for(let E=0;E<this.attributes.length;E++){const z=this.attributes[E],R=h.attributes[z.name];R!==void 0&&n.vertexAttribPointer(R,z.components,n[ta[z.type]],!1,this.itemSize,z.offset+this.itemSize*(x||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ri{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Da extends Ri{getDefault(){return g.Color.transparent}set(n){const h=this.current;(n.r!==h.r||n.g!==h.g||n.b!==h.b||n.a!==h.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Ra extends Ri{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class An extends Ri{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Or extends Ri{getDefault(){return[!0,!0,!0,!0]}set(n){const h=this.current;(n[0]!==h[0]||n[1]!==h[1]||n[2]!==h[2]||n[3]!==h[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class In extends Ri{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Cl extends Ri{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class zl extends Ri{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const h=this.current;(n.func!==h.func||n.ref!==h.ref||n.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class Pl extends Ri{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const h=this.current;(n[0]!==h[0]||n[1]!==h[1]||n[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Hs extends Ri{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;n?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=n,this.dirty=!1}}class Ws extends Ri{getDefault(){return[0,1]}set(n){const h=this.current;(n[0]!==h[0]||n[1]!==h[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class As extends Ri{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;n?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=n,this.dirty=!1}}class Ks extends Ri{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class kl extends Ri{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;n?h.enable(h.BLEND):h.disable(h.BLEND),this.current=n,this.dirty=!1}}class Js extends Ri{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const h=this.current;(n[0]!==h[0]||n[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class Hu extends Ri{getDefault(){return g.Color.transparent}set(n){const h=this.current;(n.r!==h.r||n.g!==h.g||n.b!==h.b||n.a!==h.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Is extends Ri{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class ia extends Ri{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;n?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=n,this.dirty=!1}}class Wu extends Ri{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class Cn extends Ri{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}class yu extends Ri{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}}class Ba extends Ri{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class Oa extends Ri{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const h=this.current;(n[0]!==h[0]||n[1]!==h[1]||n[2]!==h[2]||n[3]!==h[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class rs extends Ri{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class ma extends Ri{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class ra extends Ri{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Do extends Ri{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Fa extends Ri{getDefault(){return null}set(n){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class ga extends Ri{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class Ml extends Ri{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class Ua extends Ri{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class ir extends Ri{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class ns extends Ri{constructor(n,h){super(n),this.context=n,this.parent=h}getDefault(){return null}}class ya extends ns{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class _u extends ns{set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Ll{constructor(n,h,x,E){this.context=n,this.width=h,this.height=x;const z=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new ya(n,z),E&&(this.depthAttachment=new _u(n,z))}destroy(){const n=this.context.gl,h=this.colorAttachment.get();if(h&&n.deleteTexture(h),this.depthAttachment){const x=this.depthAttachment.get();x&&n.deleteRenderbuffer(x)}n.deleteFramebuffer(this.framebuffer)}}class Si{constructor(n,h,x){this.blendFunction=n,this.blendColor=h,this.mask=x}}Si.Replace=[1,0],Si.disabled=new Si(Si.Replace,g.Color.transparent,[!1,!1,!1,!1]),Si.unblended=new Si(Si.Replace,g.Color.transparent,[!0,!0,!0,!0]),Si.alphaBlended=new Si([1,771],g.Color.transparent,[!0,!0,!0,!0]);class Ys{constructor(n){this.gl=n,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Da(this),this.clearDepth=new Ra(this),this.clearStencil=new An(this),this.colorMask=new Or(this),this.depthMask=new In(this),this.stencilMask=new Cl(this),this.stencilFunc=new zl(this),this.stencilOp=new Pl(this),this.stencilTest=new Hs(this),this.depthRange=new Ws(this),this.depthTest=new As(this),this.depthFunc=new Ks(this),this.blend=new kl(this),this.blendFunc=new Js(this),this.blendColor=new Hu(this),this.blendEquation=new Is(this),this.cullFace=new ia(this),this.cullFaceSide=new Wu(this),this.frontFace=new Cn(this),this.program=new yu(this),this.activeTexture=new Ba(this),this.viewport=new Oa(this),this.bindFramebuffer=new rs(this),this.bindRenderbuffer=new ma(this),this.bindTexture=new ra(this),this.bindVertexBuffer=new Do(this),this.bindElementBuffer=new Fa(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ga(this),this.pixelStoreUnpack=new Ml(this),this.pixelStoreUnpackPremultiplyAlpha=new Ua(this),this.pixelStoreUnpackFlipY=new ir(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=n.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(n.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,h){return new ea(this,n,h)}createVertexBuffer(n,h,x){return new La(this,n,h,x)}createRenderbuffer(n,h,x){const E=this.gl,z=E.createRenderbuffer();return this.bindRenderbuffer.set(z),E.renderbufferStorage(E.RENDERBUFFER,n,h,x),this.bindRenderbuffer.set(null),z}createFramebuffer(n,h,x){return new Ll(this,n,h,x)}clear({color:n,depth:h}){const x=this.gl;let E=0;n&&(E|=x.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(E|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),x.clear(E)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){ye(n.blendFunction,Si.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Ni{constructor(n,h,x){this.func=n,this.mask=h,this.range=x}}Ni.ReadOnly=!1,Ni.ReadWrite=!0,Ni.disabled=new Ni(519,Ni.ReadOnly,[0,1]);const No=7680;class sr{constructor(n,h,x,E,z,R){this.test=n,this.ref=h,this.mask=x,this.fail=E,this.depthFail=z,this.pass=R}}sr.disabled=new sr({func:519,mask:0},0,0,No,No,No);class Fr{constructor(n,h,x){this.enable=n,this.mode=h,this.frontFace=x}}let Qs;function el(b,n,h,x,E,z,R){const V=b.context,G=V.gl,K=b.useProgram("collisionBox"),Q=[];let ae=0,_e=0;for(let Ze=0;Ze<x.length;Ze++){const ut=x[Ze],rt=n.getTile(ut),ot=rt.getBucket(h);if(!ot)continue;let yt=ut.posMatrix;E[0]===0&&E[1]===0||(yt=b.translatePosMatrix(ut.posMatrix,rt,E,z));const Et=R?ot.textCollisionBox:ot.iconCollisionBox,ct=ot.collisionCircleArray;if(ct.length>0){const Kt=g.create(),Ot=yt;g.mul(Kt,ot.placementInvProjMatrix,b.transform.glCoordMatrix),g.mul(Kt,Kt,ot.placementViewportMatrix),Q.push({circleArray:ct,circleOffset:_e,transform:Ot,invTransform:Kt}),ae+=ct.length/4,_e=ae}Et&&K.draw(V,G.LINES,Ni.disabled,sr.disabled,b.colorModeForRenderPass(),Fr.disabled,Lo(yt,b.transform,rt),h.id,Et.layoutVertexBuffer,Et.indexBuffer,Et.segments,null,b.transform.zoom,null,null,Et.collisionVertexBuffer)}if(!R||!Q.length)return;const Le=b.useProgram("collisionCircle"),be=new g.CollisionCircleLayoutArray;be.resize(4*ae),be._trim();let Me=0;for(const Ze of Q)for(let ut=0;ut<Ze.circleArray.length/4;ut++){const rt=4*ut,ot=Ze.circleArray[rt+0],yt=Ze.circleArray[rt+1],Et=Ze.circleArray[rt+2],ct=Ze.circleArray[rt+3];be.emplace(Me++,ot,yt,Et,ct,0),be.emplace(Me++,ot,yt,Et,ct,1),be.emplace(Me++,ot,yt,Et,ct,2),be.emplace(Me++,ot,yt,Et,ct,3)}(!Qs||Qs.length<2*ae)&&(Qs=function(Ze){const ut=2*Ze,rt=new g.QuadTriangleArray;rt.resize(ut),rt._trim();for(let ot=0;ot<ut;ot++){const yt=6*ot;rt.uint16[yt+0]=4*ot+0,rt.uint16[yt+1]=4*ot+1,rt.uint16[yt+2]=4*ot+2,rt.uint16[yt+3]=4*ot+2,rt.uint16[yt+4]=4*ot+3,rt.uint16[yt+5]=4*ot+0}return rt}(ae));const qe=V.createIndexBuffer(Qs,!0),Ne=V.createVertexBuffer(be,g.collisionCircleLayout.members,!0);for(const Ze of Q){const ut={u_matrix:Ze.transform,u_inv_matrix:Ze.invTransform,u_camera_to_center_distance:(Ke=b.transform).cameraToCenterDistance,u_viewport_size:[Ke.width,Ke.height]};Le.draw(V,G.TRIANGLES,Ni.disabled,sr.disabled,b.colorModeForRenderPass(),Fr.disabled,ut,h.id,Ne,qe,g.SegmentVector.simpleSegment(0,2*Ze.circleOffset,Ze.circleArray.length,Ze.circleArray.length/2),null,b.transform.zoom,null,null,null)}var Ke;Ne.destroy(),qe.destroy()}Fr.disabled=new Fr(!1,1029,2305),Fr.backCCW=new Fr(!0,1029,2305);const os=g.identity(new Float32Array(16));function Dl(b,n,h,x,E,z){const{horizontalAlign:R,verticalAlign:V}=g.getAnchorAlignment(b),G=-(R-.5)*n,K=-(V-.5)*h,Q=g.evaluateVariableOffset(b,x);return new g.pointGeometry((G/E+Q[0])*z,(K/E+Q[1])*z)}function na(b,n,h,x,E,z,R,V,G,K){const Q=b.text.placedSymbolArray,ae=b.text.dynamicLayoutVertexArray,_e=b.icon.dynamicLayoutVertexArray,Le={};ae.clear();for(let be=0;be<Q.length;be++){const Me=Q.get(be),qe=b.allowVerticalPlacement&&!Me.placedOrientation,Ne=Me.hidden||!Me.crossTileID||qe?null:x[Me.crossTileID];if(Ne){const Ke=new g.pointGeometry(Me.anchorX,Me.anchorY),Ze=ur(Ke,h?R:z),ut=kt(E.cameraToCenterDistance,Ze.signedDistanceFromCamera);let rt=g.evaluateSizeForFeature(b.textSizeData,G,Me)*ut/g.ONE_EM;h&&(rt*=b.tilePixelRatio/V);const{width:ot,height:yt,anchor:Et,textOffset:ct,textBoxScale:Kt}=Ne,Ot=Dl(Et,ot,yt,ct,Kt,rt),gi=h?ur(Ke.add(Ot),z).point:Ze.point.add(n?Ot.rotate(-E.angle):Ot),s=b.allowVerticalPlacement&&Me.placedOrientation===g.WritingMode.vertical?Math.PI/2:0;for(let c=0;c<Me.numGlyphs;c++)g.addDynamicAttributes(ae,gi,s);K&&Me.associatedIconIndex>=0&&(Le[Me.associatedIconIndex]={shiftedAnchor:gi,angle:s})}else J(Me.numGlyphs,ae)}if(K){_e.clear();const be=b.icon.placedSymbolArray;for(let Me=0;Me<be.length;Me++){const qe=be.get(Me);if(qe.hidden)J(qe.numGlyphs,_e);else{const Ne=Le[Me];if(Ne)for(let Ke=0;Ke<qe.numGlyphs;Ke++)g.addDynamicAttributes(_e,Ne.shiftedAnchor,Ne.angle);else J(qe.numGlyphs,_e)}}b.icon.dynamicLayoutVertexBuffer.updateData(_e)}b.text.dynamicLayoutVertexBuffer.updateData(ae)}function oa(b,n,h){return h.iconsInText&&n?"symbolTextAndIcon":b?"symbolSDF":"symbolIcon"}function tl(b,n,h,x,E,z,R,V,G,K,Q,ae){const _e=b.context,Le=_e.gl,be=b.transform,Me=V==="map",qe=G==="map",Ne=V!=="viewport"&&h.layout.get("symbol-placement")!=="point",Ke=Me&&!qe&&!Ne,Ze=!h.layout.get("symbol-sort-key").isConstant();let ut=!1;const rt=b.depthModeForSublayer(0,Ni.ReadOnly),ot=h.layout.get("text-variable-anchor"),yt=[];for(const Et of x){const ct=n.getTile(Et),Kt=ct.getBucket(h);if(!Kt)continue;const Ot=E?Kt.text:Kt.icon;if(!Ot||!Ot.segments.get().length)continue;const gi=Ot.programConfigurations.get(h.id),s=E||Kt.sdfIcons,c=E?Kt.textSizeData:Kt.iconSizeData,u=qe||be.pitch!==0,f=b.useProgram(oa(s,E,Kt),gi),T=g.evaluateSizeForZoom(c,be.zoom);let P,M,F,X,Y=[0,0],le=null;if(E){if(M=ct.glyphAtlasTexture,F=Le.LINEAR,P=ct.glyphAtlasTexture.size,Kt.iconsInText){Y=ct.imageAtlasTexture.size,le=ct.imageAtlasTexture;const Qe=c.kind==="composite"||c.kind==="camera";X=u||b.options.rotating||b.options.zooming||Qe?Le.LINEAR:Le.NEAREST}}else{const Qe=h.layout.get("icon-size").constantOr(0)!==1||Kt.iconsNeedLinear;M=ct.imageAtlasTexture,F=s||b.options.rotating||b.options.zooming||Qe||u?Le.LINEAR:Le.NEAREST,P=ct.imageAtlasTexture.size}const ce=Te(ct,1,b.transform.zoom),de=dn(Et.posMatrix,qe,Me,b.transform,ce),Ce=xo(Et.posMatrix,qe,Me,b.transform,ce),Ae=ot&&Kt.hasTextData(),ke=h.layout.get("icon-text-fit")!=="none"&&Ae&&Kt.hasIconData();if(Ne){const Qe=h.layout.get("text-rotation-alignment")==="map";Ei(Kt,Et.posMatrix,b,E,de,Ce,qe,K,Qe)}const xe=b.translatePosMatrix(Et.posMatrix,ct,z,R),ze=Ne||E&&ot||ke?os:de,Be=b.translatePosMatrix(Ce,ct,z,R,!0),Ge=s&&h.paint.get(E?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Je;Je=s?Kt.iconsInText?$s(c.kind,T,Ke,qe,b,xe,ze,Be,P,Y):Xs(c.kind,T,Ke,qe,b,xe,ze,Be,E,P,!0):fa(c.kind,T,Ke,qe,b,xe,ze,Be,E,P);const Ye={program:f,buffers:Ot,uniformValues:Je,atlasTexture:M,atlasTextureIcon:le,atlasInterpolation:F,atlasInterpolationIcon:X,isSDF:s,hasHalo:Ge};if(Ze&&Kt.canOverlap){ut=!0;const Qe=Ot.segments.get();for(const ht of Qe)yt.push({segments:new g.SegmentVector([ht]),sortKey:ht.sortKey,state:Ye})}else yt.push({segments:Ot.segments,sortKey:0,state:Ye})}ut&&yt.sort((Et,ct)=>Et.sortKey-ct.sortKey);for(const Et of yt){const ct=Et.state;if(_e.activeTexture.set(Le.TEXTURE0),ct.atlasTexture.bind(ct.atlasInterpolation,Le.CLAMP_TO_EDGE),ct.atlasTextureIcon&&(_e.activeTexture.set(Le.TEXTURE1),ct.atlasTextureIcon&&ct.atlasTextureIcon.bind(ct.atlasInterpolationIcon,Le.CLAMP_TO_EDGE)),ct.isSDF){const Kt=ct.uniformValues;ct.hasHalo&&(Kt.u_is_halo=1,Va(ct.buffers,Et.segments,h,b,ct.program,rt,Q,ae,Kt)),Kt.u_is_halo=0}Va(ct.buffers,Et.segments,h,b,ct.program,rt,Q,ae,ct.uniformValues)}}function Va(b,n,h,x,E,z,R,V,G){const K=x.context;E.draw(K,K.gl.TRIANGLES,z,R,V,Fr.disabled,G,h.id,b.layoutVertexBuffer,b.indexBuffer,n,h.paint,x.transform.zoom,b.programConfigurations.get(h.id),b.dynamicLayoutVertexBuffer,b.opacityVertexBuffer)}function lr(b,n,h,x,E,z,R){const V=b.context.gl,G=h.paint.get("fill-pattern"),K=G&&G.constantOr(1),Q=h.getCrossfadeParameters();let ae,_e,Le,be,Me;R?(_e=K&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ae=V.LINES):(_e=K?"fillPattern":"fill",ae=V.TRIANGLES);for(const qe of x){const Ne=n.getTile(qe);if(K&&!Ne.patternsLoaded())continue;const Ke=Ne.getBucket(h);if(!Ke)continue;const Ze=Ke.programConfigurations.get(h.id),ut=b.useProgram(_e,Ze);K&&(b.context.activeTexture.set(V.TEXTURE0),Ne.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),Ze.updatePaintBuffers(Q));const rt=G.constantOr(null);if(rt&&Ne.imageAtlas){const yt=Ne.imageAtlas,Et=yt.patternPositions[rt.to.toString()],ct=yt.patternPositions[rt.from.toString()];Et&&ct&&Ze.setConstantPatternPositions(Et,ct)}const ot=b.translatePosMatrix(qe.posMatrix,Ne,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(R){be=Ke.indexBuffer2,Me=Ke.segments2;const yt=[V.drawingBufferWidth,V.drawingBufferHeight];Le=_e==="fillOutlinePattern"&&K?Eo(ot,b,Q,Ne,yt):du(ot,yt)}else be=Ke.indexBuffer,Me=Ke.segments,Le=K?Kn(ot,b,Q,Ne):wo(ot);ut.draw(b.context,ae,E,b.stencilModeForClipping(qe),z,Fr.disabled,Le,h.id,Ke.layoutVertexBuffer,be,Me,h.paint,b.transform.zoom,Ze)}}function _a(b,n,h,x,E,z,R){const V=b.context,G=V.gl,K=h.paint.get("fill-extrusion-pattern"),Q=K.constantOr(1),ae=h.getCrossfadeParameters(),_e=h.paint.get("fill-extrusion-opacity");for(const Le of x){const be=n.getTile(Le),Me=be.getBucket(h);if(!Me)continue;const qe=Me.programConfigurations.get(h.id),Ne=b.useProgram(Q?"fillExtrusionPattern":"fillExtrusion",qe);Q&&(b.context.activeTexture.set(G.TEXTURE0),be.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),qe.updatePaintBuffers(ae));const Ke=K.constantOr(null);if(Ke&&be.imageAtlas){const ot=be.imageAtlas,yt=ot.patternPositions[Ke.to.toString()],Et=ot.patternPositions[Ke.from.toString()];yt&&Et&&qe.setConstantPatternPositions(yt,Et)}const Ze=b.translatePosMatrix(Le.posMatrix,be,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),ut=h.paint.get("fill-extrusion-vertical-gradient"),rt=Q?pr(Ze,b,ut,_e,Le,ae,be):bo(Ze,b,ut,_e);Ne.draw(V,V.gl.TRIANGLES,E,z,R,Fr.backCCW,rt,h.id,Me.layoutVertexBuffer,Me.indexBuffer,Me.segments,h.paint,b.transform.zoom,qe)}}function Rl(b,n,h,x,E,z){const R=b.context,V=R.gl,G=n.fbo;if(!G)return;const K=b.useProgram("hillshade");R.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,G.colorAttachment.get());const Q=((ae,_e,Le)=>{const be=Le.paint.get("hillshade-shadow-color"),Me=Le.paint.get("hillshade-highlight-color"),qe=Le.paint.get("hillshade-accent-color");let Ne=Le.paint.get("hillshade-illumination-direction")*(Math.PI/180);Le.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ne-=ae.transform.angle);const Ke=!ae.options.moving;return{u_matrix:ae.transform.calculatePosMatrix(_e.tileID.toUnwrapped(),Ke),u_image:0,u_latrange:Qo(0,_e.tileID),u_light:[Le.paint.get("hillshade-exaggeration"),Ne],u_shadow:be,u_highlight:Me,u_accent:qe}})(b,n,h);K.draw(R,V.TRIANGLES,x,E,z,Fr.disabled,Q,h.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments)}function Nn(b,n,h,x,E,z){const R=b.context,V=R.gl,G=n.dem;if(G&&G.data){const K=G.dim,Q=G.stride,ae=G.getPixels();if(R.activeTexture.set(V.TEXTURE1),R.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||b.getTileTexture(Q),n.demTexture){const Le=n.demTexture;Le.update(ae,{premultiply:!1}),Le.bind(V.NEAREST,V.CLAMP_TO_EDGE)}else n.demTexture=new _t(R,ae,V.RGBA,{premultiply:!1}),n.demTexture.bind(V.NEAREST,V.CLAMP_TO_EDGE);R.activeTexture.set(V.TEXTURE0);let _e=n.fbo;if(!_e){const Le=new _t(R,{width:K,height:K,data:null},V.RGBA);Le.bind(V.LINEAR,V.CLAMP_TO_EDGE),_e=n.fbo=R.createFramebuffer(K,K,!0),_e.colorAttachment.set(Le.texture)}R.bindFramebuffer.set(_e.framebuffer),R.viewport.set([0,0,K,K]),b.useProgram("hillshadePrepare").draw(R,V.TRIANGLES,x,E,z,Fr.disabled,((Le,be)=>{const Me=be.stride,qe=g.create();return g.ortho(qe,0,g.EXTENT,-g.EXTENT,0,0,1),g.translate(qe,qe,[0,-g.EXTENT,0]),{u_matrix:qe,u_image:1,u_dimension:[Me,Me],u_zoom:Le.overscaledZ,u_unpack:be.getUnpackVector()}})(n.tileID,G),h.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments),n.needsHillshadePrepare=!1}}function vu(b,n,h,x,E){const z=x.paint.get("raster-fade-duration");if(z>0){const R=g.exported.now(),V=(R-b.timeAdded)/z,G=n?(R-n.timeAdded)/z:-1,K=h.getSource(),Q=E.coveringZoomLevel({tileSize:K.tileSize,roundZoom:K.roundZoom}),ae=!n||Math.abs(n.tileID.overscaledZ-Q)>Math.abs(b.tileID.overscaledZ-Q),_e=ae&&b.refreshedUponExpiration?1:g.clamp(ae?V:1-G,0,1);return b.refreshedUponExpiration&&V>=1&&(b.refreshedUponExpiration=!1),n?{opacity:1,mix:1-_e}:{opacity:_e,mix:0}}return{opacity:1,mix:0}}const Ku=new g.Color(1,0,0,1),xu=new g.Color(0,1,0,1),va=new g.Color(0,0,1,1),xa=new g.Color(1,0,1,1),as=new g.Color(0,1,1,1);function il(b,n,h,x){ba(b,0,n+h/2,b.transform.width,h,x)}function Na(b,n,h,x){ba(b,n-h/2,0,h,b.transform.height,x)}function ba(b,n,h,x,E,z){const R=b.context,V=R.gl;V.enable(V.SCISSOR_TEST),V.scissor(n*b.pixelRatio,h*b.pixelRatio,x*b.pixelRatio,E*b.pixelRatio),R.clear({color:z}),V.disable(V.SCISSOR_TEST)}function bu(b,n,h){const x=b.context,E=x.gl,z=h.posMatrix,R=b.useProgram("debug"),V=Ni.disabled,G=sr.disabled,K=b.colorModeForRenderPass(),Q="$debug";x.activeTexture.set(E.TEXTURE0),b.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),R.draw(x,E.LINE_STRIP,V,G,K,Fr.disabled,Br(z,g.Color.red),Q,b.debugBuffer,b.tileBorderIndexBuffer,b.debugSegments);const ae=n.getTileByID(h.key).latestRawTileData,_e=Math.floor((ae&&ae.byteLength||0)/1024),Le=n.getTile(h).tileSize,be=512/Math.min(Le,512)*(h.overscaledZ/b.transform.zoom)*.5;let Me=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Me+=` => ${h.overscaledZ}`),function(qe,Ne){qe.initDebugOverlayCanvas();const Ke=qe.debugOverlayCanvas,Ze=qe.context.gl,ut=qe.debugOverlayCanvas.getContext("2d");ut.clearRect(0,0,Ke.width,Ke.height),ut.shadowColor="white",ut.shadowBlur=2,ut.lineWidth=1.5,ut.strokeStyle="white",ut.textBaseline="top",ut.font="bold 36px Open Sans, sans-serif",ut.fillText(Ne,5,5),ut.strokeText(Ne,5,5),qe.debugOverlayTexture.update(Ke),qe.debugOverlayTexture.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE)}(b,`${Me} ${_e}kb`),R.draw(x,E.TRIANGLES,V,G,Si.alphaBlended,Fr.disabled,Br(z,g.Color.transparent,be),Q,b.debugBuffer,b.quadTriangleIndexBuffer,b.debugSegments)}const aa={symbol:function(b,n,h,x,E){if(b.renderPass!=="translucent")return;const z=sr.disabled,R=b.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(V,G,K,Q,ae,_e,Le){const be=G.transform,Me=ae==="map",qe=_e==="map";for(const Ne of V){const Ke=Q.getTile(Ne),Ze=Ke.getBucket(K);if(!Ze||!Ze.text||!Ze.text.segments.get().length)continue;const ut=g.evaluateSizeForZoom(Ze.textSizeData,be.zoom),rt=Te(Ke,1,G.transform.zoom),ot=dn(Ne.posMatrix,qe,Me,G.transform,rt),yt=K.layout.get("icon-text-fit")!=="none"&&Ze.hasIconData();if(ut){const Et=Math.pow(2,be.zoom-Ke.tileID.overscaledZ);na(Ze,Me,qe,Le,be,ot,Ne.posMatrix,Et,ut,yt)}}}(x,b,h,n,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),E),h.paint.get("icon-opacity").constantOr(1)!==0&&tl(b,n,h,x,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),z,R),h.paint.get("text-opacity").constantOr(1)!==0&&tl(b,n,h,x,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),z,R),n.map.showCollisionBoxes&&(el(b,n,h,x,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),el(b,n,h,x,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(b,n,h,x){if(b.renderPass!=="translucent")return;const E=h.paint.get("circle-opacity"),z=h.paint.get("circle-stroke-width"),R=h.paint.get("circle-stroke-opacity"),V=!h.layout.get("circle-sort-key").isConstant();if(E.constantOr(1)===0&&(z.constantOr(1)===0||R.constantOr(1)===0))return;const G=b.context,K=G.gl,Q=b.depthModeForSublayer(0,Ni.ReadOnly),ae=sr.disabled,_e=b.colorModeForRenderPass(),Le=[];for(let be=0;be<x.length;be++){const Me=x[be],qe=n.getTile(Me),Ne=qe.getBucket(h);if(!Ne)continue;const Ke=Ne.programConfigurations.get(h.id),Ze={programConfiguration:Ke,program:b.useProgram("circle",Ke),layoutVertexBuffer:Ne.layoutVertexBuffer,indexBuffer:Ne.indexBuffer,uniformValues:ts(b,Me,qe,h)};if(V){const ut=Ne.segments.get();for(const rt of ut)Le.push({segments:new g.SegmentVector([rt]),sortKey:rt.sortKey,state:Ze})}else Le.push({segments:Ne.segments,sortKey:0,state:Ze})}V&&Le.sort((be,Me)=>be.sortKey-Me.sortKey);for(const be of Le){const{programConfiguration:Me,program:qe,layoutVertexBuffer:Ne,indexBuffer:Ke,uniformValues:Ze}=be.state;qe.draw(G,K.TRIANGLES,Q,ae,_e,Fr.disabled,Ze,h.id,Ne,Ke,be.segments,h.paint,b.transform.zoom,Me)}},heatmap:function(b,n,h,x){if(h.paint.get("heatmap-opacity")!==0)if(b.renderPass==="offscreen"){const E=b.context,z=E.gl,R=sr.disabled,V=new Si([z.ONE,z.ONE],g.Color.transparent,[!0,!0,!0,!0]);(function(G,K,Q){const ae=G.gl;G.activeTexture.set(ae.TEXTURE1),G.viewport.set([0,0,K.width/4,K.height/4]);let _e=Q.heatmapFbo;if(_e)ae.bindTexture(ae.TEXTURE_2D,_e.colorAttachment.get()),G.bindFramebuffer.set(_e.framebuffer);else{const Le=ae.createTexture();ae.bindTexture(ae.TEXTURE_2D,Le),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_WRAP_S,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_WRAP_T,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_MIN_FILTER,ae.LINEAR),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_MAG_FILTER,ae.LINEAR),_e=Q.heatmapFbo=G.createFramebuffer(K.width/4,K.height/4,!1),function(be,Me,qe,Ne){const Ke=be.gl;Ke.texImage2D(Ke.TEXTURE_2D,0,Ke.RGBA,Me.width/4,Me.height/4,0,Ke.RGBA,be.extRenderToTextureHalfFloat?be.extTextureHalfFloat.HALF_FLOAT_OES:Ke.UNSIGNED_BYTE,null),Ne.colorAttachment.set(qe)}(G,K,Le,_e)}})(E,b,h),E.clear({color:g.Color.transparent});for(let G=0;G<x.length;G++){const K=x[G];if(n.hasRenderableParent(K))continue;const Q=n.getTile(K),ae=Q.getBucket(h);if(!ae)continue;const _e=ae.programConfigurations.get(h.id),Le=b.useProgram("heatmap",_e),{zoom:be}=b.transform;Le.draw(E,z.TRIANGLES,Ni.disabled,R,V,Fr.disabled,mn(K.posMatrix,Q,be,h.paint.get("heatmap-intensity")),h.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,h.paint,b.transform.zoom,_e)}E.viewport.set([0,0,b.width,b.height])}else b.renderPass==="translucent"&&(b.context.setColorMode(b.colorModeForRenderPass()),function(E,z){const R=E.context,V=R.gl,G=z.heatmapFbo;if(!G)return;R.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,G.colorAttachment.get()),R.activeTexture.set(V.TEXTURE1);let K=z.colorRampTexture;K||(K=z.colorRampTexture=new _t(R,z.colorRamp,V.RGBA)),K.bind(V.LINEAR,V.CLAMP_TO_EDGE),E.useProgram("heatmapTexture").draw(R,V.TRIANGLES,Ni.disabled,sr.disabled,E.colorModeForRenderPass(),Fr.disabled,((Q,ae,_e,Le)=>{const be=g.create();g.ortho(be,0,Q.width,Q.height,0,0,1);const Me=Q.context.gl;return{u_matrix:be,u_world:[Me.drawingBufferWidth,Me.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:ae.paint.get("heatmap-opacity")}})(E,z),z.id,E.viewportBuffer,E.quadTriangleIndexBuffer,E.viewportSegments,z.paint,E.transform.zoom)}(b,h))},line:function(b,n,h,x){if(b.renderPass!=="translucent")return;const E=h.paint.get("line-opacity"),z=h.paint.get("line-width");if(E.constantOr(1)===0||z.constantOr(1)===0)return;const R=b.depthModeForSublayer(0,Ni.ReadOnly),V=b.colorModeForRenderPass(),G=h.paint.get("line-dasharray"),K=h.paint.get("line-pattern"),Q=K.constantOr(1),ae=h.paint.get("line-gradient"),_e=h.getCrossfadeParameters(),Le=Q?"linePattern":G?"lineSDF":ae?"lineGradient":"line",be=b.context,Me=be.gl;let qe=!0;for(const Ne of x){const Ke=n.getTile(Ne);if(Q&&!Ke.patternsLoaded())continue;const Ze=Ke.getBucket(h);if(!Ze)continue;const ut=Ze.programConfigurations.get(h.id),rt=b.context.program.get(),ot=b.useProgram(Le,ut),yt=qe||ot.program!==rt,Et=K.constantOr(null);if(Et&&Ke.imageAtlas){const Kt=Ke.imageAtlas,Ot=Kt.patternPositions[Et.to.toString()],gi=Kt.patternPositions[Et.from.toString()];Ot&&gi&&ut.setConstantPatternPositions(Ot,gi)}const ct=Q?is(b,Ke,h,_e):G?on(b,Ke,h,G,_e):ae?Il(b,Ke,h,Ze.lineClipsArray.length):Zs(b,Ke,h);if(Q)be.activeTexture.set(Me.TEXTURE0),Ke.imageAtlasTexture.bind(Me.LINEAR,Me.CLAMP_TO_EDGE),ut.updatePaintBuffers(_e);else if(G&&(yt||b.lineAtlas.dirty))be.activeTexture.set(Me.TEXTURE0),b.lineAtlas.bind(be);else if(ae){const Kt=Ze.gradients[h.id];let Ot=Kt.texture;if(h.gradientVersion!==Kt.version){let gi=256;if(h.stepInterpolant){const s=n.getSource().maxzoom,c=Ne.canonical.z===s?Math.ceil(1<<b.transform.maxZoom-Ne.canonical.z):1;gi=g.clamp(g.nextPowerOfTwo(Ze.maxLineLength/g.EXTENT*1024*c),256,be.maxTextureSize)}Kt.gradient=g.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:gi,image:Kt.gradient||void 0,clips:Ze.lineClipsArray}),Kt.texture?Kt.texture.update(Kt.gradient):Kt.texture=new _t(be,Kt.gradient,Me.RGBA),Kt.version=h.gradientVersion,Ot=Kt.texture}be.activeTexture.set(Me.TEXTURE0),Ot.bind(h.stepInterpolant?Me.NEAREST:Me.LINEAR,Me.CLAMP_TO_EDGE)}ot.draw(be,Me.TRIANGLES,R,b.stencilModeForClipping(Ne),V,Fr.disabled,ct,h.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ze.segments,h.paint,b.transform.zoom,ut,Ze.layoutVertexBuffer2),qe=!1}},fill:function(b,n,h,x){const E=h.paint.get("fill-color"),z=h.paint.get("fill-opacity");if(z.constantOr(1)===0)return;const R=b.colorModeForRenderPass(),V=h.paint.get("fill-pattern"),G=b.opaquePassEnabledForLayer()&&!V.constantOr(1)&&E.constantOr(g.Color.transparent).a===1&&z.constantOr(0)===1?"opaque":"translucent";if(b.renderPass===G){const K=b.depthModeForSublayer(1,b.renderPass==="opaque"?Ni.ReadWrite:Ni.ReadOnly);lr(b,n,h,x,K,R,!1)}if(b.renderPass==="translucent"&&h.paint.get("fill-antialias")){const K=b.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,Ni.ReadOnly);lr(b,n,h,x,K,R,!0)}},"fill-extrusion":function(b,n,h,x){const E=h.paint.get("fill-extrusion-opacity");if(E!==0&&b.renderPass==="translucent"){const z=new Ni(b.context.gl.LEQUAL,Ni.ReadWrite,b.depthRangeFor3D);if(E!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))_a(b,n,h,x,z,sr.disabled,Si.disabled),_a(b,n,h,x,z,b.stencilModeFor3D(),b.colorModeForRenderPass());else{const R=b.colorModeForRenderPass();_a(b,n,h,x,z,sr.disabled,R)}}},hillshade:function(b,n,h,x){if(b.renderPass!=="offscreen"&&b.renderPass!=="translucent")return;const E=b.context,z=b.depthModeForSublayer(0,Ni.ReadOnly),R=b.colorModeForRenderPass(),[V,G]=b.renderPass==="translucent"?b.stencilConfigForOverlap(x):[{},x];for(const K of G){const Q=n.getTile(K);Q.needsHillshadePrepare&&b.renderPass==="offscreen"?Nn(b,Q,h,z,sr.disabled,R):b.renderPass==="translucent"&&Rl(b,Q,h,z,V[K.overscaledZ],R)}E.viewport.set([0,0,b.width,b.height])},raster:function(b,n,h,x){if(b.renderPass!=="translucent"||h.paint.get("raster-opacity")===0||!x.length)return;const E=b.context,z=E.gl,R=n.getSource(),V=b.useProgram("raster"),G=b.colorModeForRenderPass(),[K,Q]=R instanceof cn?[{},x]:b.stencilConfigForOverlap(x),ae=Q[Q.length-1].overscaledZ,_e=!b.options.moving;for(const Le of Q){const be=b.depthModeForSublayer(Le.overscaledZ-ae,h.paint.get("raster-opacity")===1?Ni.ReadWrite:Ni.ReadOnly,z.LESS),Me=n.getTile(Le),qe=b.transform.calculatePosMatrix(Le.toUnwrapped(),_e);Me.registerFadeDuration(h.paint.get("raster-fade-duration"));const Ne=n.findLoadedParent(Le,0),Ke=vu(Me,Ne,n,h,b.transform);let Ze,ut;const rt=h.paint.get("raster-resampling")==="nearest"?z.NEAREST:z.LINEAR;E.activeTexture.set(z.TEXTURE0),Me.texture.bind(rt,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(z.TEXTURE1),Ne?(Ne.texture.bind(rt,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),Ze=Math.pow(2,Ne.tileID.overscaledZ-Me.tileID.overscaledZ),ut=[Me.tileID.canonical.x*Ze%1,Me.tileID.canonical.y*Ze%1]):Me.texture.bind(rt,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST);const ot=mu(qe,ut||[0,0],Ze||1,Ke,h);R instanceof cn?V.draw(E,z.TRIANGLES,be,sr.disabled,G,Fr.disabled,ot,h.id,R.boundsBuffer,b.quadTriangleIndexBuffer,R.boundsSegments):V.draw(E,z.TRIANGLES,be,K[Le.overscaledZ],G,Fr.disabled,ot,h.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments)}},background:function(b,n,h){const x=h.paint.get("background-color"),E=h.paint.get("background-opacity");if(E===0)return;const z=b.context,R=z.gl,V=b.transform,G=V.tileSize,K=h.paint.get("background-pattern");if(b.isPatternMissing(K))return;const Q=!K&&x.a===1&&E===1&&b.opaquePassEnabledForLayer()?"opaque":"translucent";if(b.renderPass!==Q)return;const ae=sr.disabled,_e=b.depthModeForSublayer(0,Q==="opaque"?Ni.ReadWrite:Ni.ReadOnly),Le=b.colorModeForRenderPass(),be=b.useProgram(K?"backgroundPattern":"background"),Me=V.coveringTiles({tileSize:G});K&&(z.activeTexture.set(R.TEXTURE0),b.imageManager.bind(b.context));const qe=h.getCrossfadeParameters();for(const Ne of Me){const Ke=b.transform.calculatePosMatrix(Ne.toUnwrapped()),Ze=K?Ts(Ke,E,b,K,{tileID:Ne,tileSize:G},qe):$u(Ke,E,x);be.draw(z,R.TRIANGLES,_e,ae,Le,Fr.disabled,Ze,h.id,b.tileExtentBuffer,b.quadTriangleIndexBuffer,b.tileExtentSegments)}},debug:function(b,n,h){for(let x=0;x<h.length;x++)bu(b,n,h[x])},custom:function(b,n,h){const x=b.context,E=h.implementation;if(b.renderPass==="offscreen"){const z=E.prerender;z&&(b.setCustomLayerDefaults(),x.setColorMode(b.colorModeForRenderPass()),z.call(E,x.gl,b.transform.customLayerMatrix()),x.setDirty(),b.setBaseState())}else if(b.renderPass==="translucent"){b.setCustomLayerDefaults(),x.setColorMode(b.colorModeForRenderPass()),x.setStencilMode(sr.disabled);const z=E.renderingMode==="3d"?new Ni(b.context.gl.LEQUAL,Ni.ReadWrite,b.depthRangeFor3D):b.depthModeForSublayer(0,Ni.ReadOnly);x.setDepthMode(z),E.render(x.gl,b.transform.customLayerMatrix()),x.setDirty(),b.setBaseState(),x.bindFramebuffer.set(null)}}};class So{constructor(n,h){this.context=new Ys(n),this.transform=h,this._tileTextures={},this.setup(),this.numSublayers=ci.maxUnderzooming+ci.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new $t,this.gpuTimers={}}resize(n,h,x){if(this.width=n*x,this.height=h*x,this.pixelRatio=x,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const E of this.style._order)this.style._layers[E].resize()}setup(){const n=this.context,h=new g.PosArray;h.emplaceBack(0,0),h.emplaceBack(g.EXTENT,0),h.emplaceBack(0,g.EXTENT),h.emplaceBack(g.EXTENT,g.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(h,Ln.members),this.tileExtentSegments=g.SegmentVector.simpleSegment(0,0,4,2);const x=new g.PosArray;x.emplaceBack(0,0),x.emplaceBack(g.EXTENT,0),x.emplaceBack(0,g.EXTENT),x.emplaceBack(g.EXTENT,g.EXTENT),this.debugBuffer=n.createVertexBuffer(x,Ln.members),this.debugSegments=g.SegmentVector.simpleSegment(0,0,4,5);const E=new g.RasterBoundsArray;E.emplaceBack(0,0,0,0),E.emplaceBack(g.EXTENT,0,g.EXTENT,0),E.emplaceBack(0,g.EXTENT,0,g.EXTENT),E.emplaceBack(g.EXTENT,g.EXTENT,g.EXTENT,g.EXTENT),this.rasterBoundsBuffer=n.createVertexBuffer(E,nn.members),this.rasterBoundsSegments=g.SegmentVector.simpleSegment(0,0,4,2);const z=new g.PosArray;z.emplaceBack(0,0),z.emplaceBack(1,0),z.emplaceBack(0,1),z.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(z,Ln.members),this.viewportSegments=g.SegmentVector.simpleSegment(0,0,4,2);const R=new g.LineStripIndexArray;R.emplaceBack(0),R.emplaceBack(1),R.emplaceBack(3),R.emplaceBack(2),R.emplaceBack(0),this.tileBorderIndexBuffer=n.createIndexBuffer(R);const V=new g.TriangleIndexArray;V.emplaceBack(0,1,2),V.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(V),this.emptyTexture=new _t(n,{width:1,height:1,data:new Uint8Array([0,0,0,0])},n.gl.RGBA);const G=this.context.gl;this.stencilClearMode=new sr({func:G.ALWAYS,mask:0},0,255,G.ZERO,G.ZERO,G.ZERO)}clearStencil(){const n=this.context,h=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const x=g.create();g.ortho(x,0,this.width,this.height,0,0,1),g.scale(x,x,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(n,h.TRIANGLES,Ni.disabled,this.stencilClearMode,Si.disabled,Fr.disabled,oo(x),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(n,h){if(this.currentStencilSource===n.source||!n.isTileClipped()||!h||!h.length)return;this.currentStencilSource=n.source;const x=this.context,E=x.gl;this.nextStencilID+h.length>256&&this.clearStencil(),x.setColorMode(Si.disabled),x.setDepthMode(Ni.disabled);const z=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const R of h){const V=this._tileClippingMaskIDs[R.key]=this.nextStencilID++;z.draw(x,E.TRIANGLES,Ni.disabled,new sr({func:E.ALWAYS,mask:0},V,255,E.KEEP,E.KEEP,E.REPLACE),Si.disabled,Fr.disabled,oo(R.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,h=this.context.gl;return new sr({func:h.NOTEQUAL,mask:255},n,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(n){const h=this.context.gl;return new sr({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(n){const h=this.context.gl,x=n.sort((R,V)=>V.overscaledZ-R.overscaledZ),E=x[x.length-1].overscaledZ,z=x[0].overscaledZ-E+1;if(z>1){this.currentStencilSource=void 0,this.nextStencilID+z>256&&this.clearStencil();const R={};for(let V=0;V<z;V++)R[V+E]=new sr({func:h.GEQUAL,mask:255},V+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=z,[R,x]}return[{[E]:sr.disabled},x]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new Si([n.CONSTANT_COLOR,n.ONE],new g.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Si.unblended:Si.alphaBlended}depthModeForSublayer(n,h,x){if(!this.opaquePassEnabledForLayer())return Ni.disabled;const E=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new Ni(x||this.context.gl.LEQUAL,h,[E,E])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,h){this.style=n,this.options=h,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(g.exported.now()),this.imageManager.beginFrame();const x=this.style._order,E=this.style.sourceCaches;for(const G in E){const K=E[G];K.used&&K.prepare(this.context)}const z={},R={},V={};for(const G in E){const K=E[G];z[G]=K.getVisibleCoordinates(),R[G]=z[G].slice().reverse(),V[G]=K.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let G=0;G<x.length;G++)if(this.style._layers[x[G]].is3D()){this.opaquePassCutoff=G;break}this.renderPass="offscreen";for(const G of x){const K=this.style._layers[G];if(!K.hasOffscreenPass()||K.isHidden(this.transform.zoom))continue;const Q=R[K.source];(K.type==="custom"||Q.length)&&this.renderLayer(this,E[K.source],K,Q)}for(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?g.Color.black:g.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(n._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){const G=this.style._layers[x[this.currentLayer]],K=E[G.source],Q=z[G.source];this._renderTileClippingMasks(G,Q),this.renderLayer(this,K,G,Q)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){const G=this.style._layers[x[this.currentLayer]],K=E[G.source],Q=(G.type==="symbol"?V:R)[G.source];this._renderTileClippingMasks(G,z[G.source]),this.renderLayer(this,K,G,Q)}if(this.options.showTileBoundaries){let G,K;Object.values(this.style._layers).forEach(Q=>{Q.source&&!Q.isHidden(this.transform.zoom)&&(Q.source!==(K&&K.id)&&(K=this.style.sourceCaches[Q.source]),(!G||G.getSource().maxzoom<K.getSource().maxzoom)&&(G=K))}),G&&aa.debug(this,G,G.getVisibleCoordinates())}this.options.showPadding&&function(G){const K=G.transform.padding;il(G,G.transform.height-(K.top||0),3,Ku),il(G,K.bottom||0,3,xu),Na(G,K.left||0,3,va),Na(G,G.transform.width-(K.right||0),3,xa);const Q=G.transform.centerPoint;(function(ae,_e,Le,be){ba(ae,_e-1,Le-10,2,20,be),ba(ae,_e-10,Le-1,20,2,be)})(G,Q.x,G.transform.height-Q.y,as)}(this),this.context.setDefault()}renderLayer(n,h,x,E){x.isHidden(this.transform.zoom)||(x.type==="background"||x.type==="custom"||E.length)&&(this.id=x.id,this.gpuTimingStart(x),aa[x.type](n,h,x,E,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let x=this.gpuTimers[n.id];x||(x=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),x.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,x.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}queryGpuTimers(n){const h={};for(const x in n){const E=n[x],z=this.context.extTimerQuery,R=z.getQueryObjectEXT(E.query,z.QUERY_RESULT_EXT)/1e6;z.deleteQueryEXT(E.query),h[x]=R}return h}translatePosMatrix(n,h,x,E,z){if(!x[0]&&!x[1])return n;const R=z?E==="map"?this.transform.angle:0:E==="viewport"?-this.transform.angle:0;if(R){const K=Math.sin(R),Q=Math.cos(R);x=[x[0]*Q-x[1]*K,x[0]*K+x[1]*Q]}const V=[z?x[0]:Te(h,x[0],this.transform.zoom),z?x[1]:Te(h,x[1],this.transform.zoom),0],G=new Float32Array(16);return g.translate(G,n,V),G}saveTileTexture(n){const h=this._tileTextures[n.size[0]];h?h.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const h=this._tileTextures[n];return h&&h.length>0?h.pop():null}isPatternMissing(n){if(!n)return!1;if(!n.from||!n.to)return!0;const h=this.imageManager.getPattern(n.from.toString()),x=this.imageManager.getPattern(n.to.toString());return!h||!x}useProgram(n,h){this.cache=this.cache||{};const x=`${n}${h?h.cacheKey:""}${this._showOverdrawInspector?"/overdraw":""}`;return this.cache[x]||(this.cache[x]=new Vn(this.context,n,Gs[n],h,ao[n],this._showOverdrawInspector)),this.cache[x]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new _t(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class rl{constructor(n,h){this.points=n,this.planes=h}static fromInvProjectionMatrix(n,h,x){const E=Math.pow(2,x),z=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(V=>g.transformMat4([],V,n)).map(V=>g.scale$1([],V,1/V[3]/h*E)),R=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(V=>{const G=function(_e,Le){var be=Le[0],Me=Le[1],qe=Le[2],Ne=be*be+Me*Me+qe*qe;return Ne>0&&(Ne=1/Math.sqrt(Ne)),_e[0]=Le[0]*Ne,_e[1]=Le[1]*Ne,_e[2]=Le[2]*Ne,_e}([],function(_e,Le,be){var Me=Le[0],qe=Le[1],Ne=Le[2],Ke=be[0],Ze=be[1],ut=be[2];return _e[0]=qe*ut-Ne*Ze,_e[1]=Ne*Ke-Me*ut,_e[2]=Me*Ze-qe*Ke,_e}([],Xt([],z[V[0]],z[V[1]]),Xt([],z[V[2]],z[V[1]]))),K=-((Q=G)[0]*(ae=z[V[1]])[0]+Q[1]*ae[1]+Q[2]*ae[2]);var Q,ae;return G.concat(K)});return new rl(z,R)}}class nl{constructor(n,h){this.min=n,this.max=h,this.center=function(x,E,z){return x[0]=.5*E[0],x[1]=.5*E[1],x[2]=.5*E[2],x}([],function(x,E,z){return x[0]=E[0]+z[0],x[1]=E[1]+z[1],x[2]=E[2]+z[2],x}([],this.min,this.max))}quadrant(n){const h=[n%2==0,n<2],x=St(this.min),E=St(this.max);for(let z=0;z<h.length;z++)x[z]=h[z]?this.min[z]:this.center[z],E[z]=h[z]?this.center[z]:this.max[z];return E[2]=this.max[2],new nl(x,E)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}intersects(n){const h=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]];let x=!0;for(let E=0;E<n.planes.length;E++){const z=n.planes[E];let R=0;for(let V=0;V<h.length;V++)g.dot(z,h[V])>=0&&R++;if(R===0)return 0;R!==h.length&&(x=!1)}if(x)return 2;for(let E=0;E<3;E++){let z=Number.MAX_VALUE,R=-Number.MAX_VALUE;for(let V=0;V<n.points.length;V++){const G=n.points[V][E]-this.min[E];z=Math.min(z,G),R=Math.max(R,G)}if(R<0||z>this.max[E]-this.min[E])return 0}return 1}}class ss{constructor(n=0,h=0,x=0,E=0){if(isNaN(n)||n<0||isNaN(h)||h<0||isNaN(x)||x<0||isNaN(E)||E<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=h,this.left=x,this.right=E}interpolate(n,h,x){return h.top!=null&&n.top!=null&&(this.top=g.number(n.top,h.top,x)),h.bottom!=null&&n.bottom!=null&&(this.bottom=g.number(n.bottom,h.bottom,x)),h.left!=null&&n.left!=null&&(this.left=g.number(n.left,h.left,x)),h.right!=null&&n.right!=null&&(this.right=g.number(n.right,h.right,x)),this}getCenter(n,h){const x=g.clamp((this.left+n-this.right)/2,0,n),E=g.clamp((this.top+h-this.bottom)/2,0,h);return new g.pointGeometry(x,E)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new ss(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class jo{constructor(n,h,x,E,z){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=z===void 0||!!z,this._minZoom=n||0,this._maxZoom=h||22,this._minPitch=x==null?0:x,this._maxPitch=E==null?60:E,this.setMaxBounds(),this.width=0,this.height=0,this._center=new g.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ss,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const n=new jo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return n.tileSize=this.tileSize,n.latRange=this.latRange,n.width=this.width,n.height=this.height,n._center=this._center,n.zoom=this.zoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._calcMatrices(),n}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new g.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(n){const h=-g.wrap(n,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=function(){var x=new g.ARRAY_TYPE(4);return g.ARRAY_TYPE!=Float32Array&&(x[1]=0,x[2]=0),x[0]=1,x[3]=1,x}(),function(x,E,z){var R=E[0],V=E[1],G=E[2],K=E[3],Q=Math.sin(z),ae=Math.cos(z);x[0]=R*ae+G*Q,x[1]=V*ae+K*Q,x[2]=R*-Q+G*ae,x[3]=V*-Q+K*ae}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const h=g.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=n/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(n){const h=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.scale=this.zoomScale(h),this.tileZoom=Math.floor(h),this.zoomFraction=h-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,h,x){this._unmodified=!1,this._edgeInsets.interpolate(n,h,x),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const h=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(n){const h=[new g.UnwrappedTileID(0,n)];if(this._renderWorldCopies){const x=this.pointCoordinate(new g.pointGeometry(0,0)),E=this.pointCoordinate(new g.pointGeometry(this.width,0)),z=this.pointCoordinate(new g.pointGeometry(this.width,this.height)),R=this.pointCoordinate(new g.pointGeometry(0,this.height)),V=Math.floor(Math.min(x.x,E.x,z.x,R.x)),G=Math.floor(Math.max(x.x,E.x,z.x,R.x)),K=1;for(let Q=V-K;Q<=G+K;Q++)Q!==0&&h.push(new g.UnwrappedTileID(Q,n))}return h}coveringTiles(n){let h=this.coveringZoomLevel(n);const x=h;if(n.minzoom!==void 0&&h<n.minzoom)return[];n.maxzoom!==void 0&&h>n.maxzoom&&(h=n.maxzoom);const E=g.MercatorCoordinate.fromLngLat(this.center),z=Math.pow(2,h),R=[z*E.x,z*E.y,0],V=rl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h);let G=n.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(G=h);const K=be=>({aabb:new nl([be*z,0,0],[(be+1)*z,z,0]),zoom:0,x:0,y:0,wrap:be,fullyVisible:!1}),Q=[],ae=[],_e=h,Le=n.reparseOverscaled?x:h;if(this._renderWorldCopies)for(let be=1;be<=3;be++)Q.push(K(-be)),Q.push(K(be));for(Q.push(K(0));Q.length>0;){const be=Q.pop(),Me=be.x,qe=be.y;let Ne=be.fullyVisible;if(!Ne){const ot=be.aabb.intersects(V);if(ot===0)continue;Ne=ot===2}const Ke=be.aabb.distanceX(R),Ze=be.aabb.distanceY(R),ut=Math.max(Math.abs(Ke),Math.abs(Ze)),rt=3+(1<<_e-be.zoom)-2;if(be.zoom===_e||ut>rt&&be.zoom>=G)ae.push({tileID:new g.OverscaledTileID(be.zoom===_e?Le:be.zoom,be.wrap,be.zoom,Me,qe),distanceSq:Wt([R[0]-.5-Me,R[1]-.5-qe])});else for(let ot=0;ot<4;ot++){const yt=(Me<<1)+ot%2,Et=(qe<<1)+(ot>>1);Q.push({aabb:be.aabb.quadrant(ot),zoom:be.zoom+1,x:yt,y:Et,wrap:be.wrap,fullyVisible:Ne})}}return ae.sort((be,Me)=>be.distanceSq-Me.distanceSq).map(be=>be.tileID)}resize(n,h){this.width=n,this.height=h,this.pixelsToGLUnits=[2/n,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const h=g.clamp(n.lat,-this.maxValidLatitude,this.maxValidLatitude);return new g.pointGeometry(g.mercatorXfromLng(n.lng)*this.worldSize,g.mercatorYfromLat(h)*this.worldSize)}unproject(n){return new g.MercatorCoordinate(n.x/this.worldSize,n.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}setLocationAtPoint(n,h){const x=this.pointCoordinate(h),E=this.pointCoordinate(this.centerPoint),z=this.locationCoordinate(n),R=new g.MercatorCoordinate(z.x-(x.x-E.x),z.y-(x.y-E.y));this.center=this.coordinateLocation(R),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(n){return this.coordinatePoint(this.locationCoordinate(n))}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}locationCoordinate(n){return g.MercatorCoordinate.fromLngLat(n)}coordinateLocation(n){return n.toLngLat()}pointCoordinate(n){const h=[n.x,n.y,0,1],x=[n.x,n.y,1,1];g.transformMat4(h,h,this.pixelMatrixInverse),g.transformMat4(x,x,this.pixelMatrixInverse);const E=h[3],z=x[3],R=h[1]/E,V=x[1]/z,G=h[2]/E,K=x[2]/z,Q=G===K?0:(0-G)/(K-G);return new g.MercatorCoordinate(g.number(h[0]/E,x[0]/z,Q)/this.worldSize,g.number(R,V,Q)/this.worldSize)}coordinatePoint(n){const h=[n.x*this.worldSize,n.y*this.worldSize,0,1];return g.transformMat4(h,h,this.pixelMatrix),new g.pointGeometry(h[0]/h[3],h[1]/h[3])}getBounds(){return new g.LngLatBounds().extend(this.pointLocation(new g.pointGeometry(0,0))).extend(this.pointLocation(new g.pointGeometry(this.width,0))).extend(this.pointLocation(new g.pointGeometry(this.width,this.height))).extend(this.pointLocation(new g.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new g.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}setMaxBounds(n){n?(this.lngRange=[n.getWest(),n.getEast()],this.latRange=[n.getSouth(),n.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(n,h=!1){const x=n.key,E=h?this._alignedPosMatrixCache:this._posMatrixCache;if(E[x])return E[x];const z=n.canonical,R=this.worldSize/this.zoomScale(z.z),V=z.x+Math.pow(2,z.z)*n.wrap,G=g.identity(new Float64Array(16));return g.translate(G,G,[V*R,z.y*R,0]),g.scale(G,G,[R/g.EXTENT,R/g.EXTENT,1]),g.multiply(G,h?this.alignedProjMatrix:this.projMatrix,G),E[x]=new Float32Array(G),E[x]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let n,h,x,E,z=-90,R=90,V=-180,G=180;const K=this.size,Q=this._unmodified;if(this.latRange){const Le=this.latRange;z=g.mercatorYfromLat(Le[1])*this.worldSize,R=g.mercatorYfromLat(Le[0])*this.worldSize,n=R-z<K.y?K.y/(R-z):0}if(this.lngRange){const Le=this.lngRange;V=g.mercatorXfromLng(Le[0])*this.worldSize,G=g.mercatorXfromLng(Le[1])*this.worldSize,h=G-V<K.x?K.x/(G-V):0}const ae=this.point,_e=Math.max(h||0,n||0);if(_e)return this.center=this.unproject(new g.pointGeometry(h?(G+V)/2:ae.x,n?(R+z)/2:ae.y)),this.zoom+=this.scaleZoom(_e),this._unmodified=Q,void(this._constraining=!1);if(this.latRange){const Le=ae.y,be=K.y/2;Le-be<z&&(E=z+be),Le+be>R&&(E=R-be)}if(this.lngRange){const Le=ae.x,be=K.x/2;Le-be<V&&(x=V+be),Le+be>G&&(x=G-be)}x===void 0&&E===void 0||(this.center=this.unproject(new g.pointGeometry(x!==void 0?x:ae.x,E!==void 0?E:ae.y))),this._unmodified=Q,this._constraining=!1}_calcMatrices(){if(!this.height)return;const n=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const h=Math.PI/2+this._pitch,x=this._fov*(.5+n.y/this.height),E=Math.sin(x)*this.cameraToCenterDistance/Math.sin(g.clamp(Math.PI-h-x,.01,Math.PI-.01)),z=this.point,R=z.x,V=z.y,G=1.01*(Math.cos(Math.PI/2-this._pitch)*E+this.cameraToCenterDistance),K=this.height/50;let Q=new Float64Array(16);g.perspective(Q,this._fov,this.width/this.height,K,G),Q[8]=2*-n.x/this.width,Q[9]=2*n.y/this.height,g.scale(Q,Q,[1,-1,1]),g.translate(Q,Q,[0,0,-this.cameraToCenterDistance]),g.rotateX(Q,Q,this._pitch),g.rotateZ(Q,Q,this.angle),g.translate(Q,Q,[-R,-V,0]),this.mercatorMatrix=g.scale([],Q,[this.worldSize,this.worldSize,this.worldSize]),g.scale(Q,Q,[1,1,g.mercatorZfromAltitude(1,this.center.lat)*this.worldSize]),this.projMatrix=Q,this.invProjMatrix=g.invert([],this.projMatrix);const ae=this.width%2/2,_e=this.height%2/2,Le=Math.cos(this.angle),be=Math.sin(this.angle),Me=R-Math.round(R)+Le*ae+be*_e,qe=V-Math.round(V)+Le*_e+be*ae,Ne=new Float64Array(Q);if(g.translate(Ne,Ne,[Me>.5?Me-1:Me,qe>.5?qe-1:qe,0]),this.alignedProjMatrix=Ne,Q=g.create(),g.scale(Q,Q,[this.width/2,-this.height/2,1]),g.translate(Q,Q,[1,-1,0]),this.labelPlaneMatrix=Q,Q=g.create(),g.scale(Q,Q,[1,-1,1]),g.translate(Q,Q,[-1,-1,0]),g.scale(Q,Q,[2/this.width,2/this.height,1]),this.glCoordMatrix=Q,this.pixelMatrix=g.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),Q=g.invert(new Float64Array(16),this.pixelMatrix),!Q)throw new Error("failed to invert matrix");this.pixelMatrixInverse=Q,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const n=this.pointCoordinate(new g.pointGeometry(0,0)),h=[n.x*this.worldSize,n.y*this.worldSize,0,1];return g.transformMat4(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new g.pointGeometry(0,n))}getCameraQueryGeometry(n){const h=this.getCameraPoint();if(n.length===1)return[n[0],h];{let x=h.x,E=h.y,z=h.x,R=h.y;for(const V of n)x=Math.min(x,V.x),E=Math.min(E,V.y),z=Math.max(z,V.x),R=Math.max(R,V.y);return[new g.pointGeometry(x,E),new g.pointGeometry(z,E),new g.pointGeometry(z,R),new g.pointGeometry(x,R),new g.pointGeometry(x,E)]}}}class Cs{constructor(n){this._hashName=n&&encodeURIComponent(n),g.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(h,x){let E=!1,z=null;const R=()=>{z=null,E&&(h(),z=setTimeout(R,300),E=!1)};return()=>(E=!0,z||R(),z)}(this._updateHashUnthrottled.bind(this))}addTo(n){return this._map=n,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(n){const h=this._map.getCenter(),x=Math.round(100*this._map.getZoom())/100,E=Math.ceil((x*Math.LN2+Math.log(512/360/.5))/Math.LN10),z=Math.pow(10,E),R=Math.round(h.lng*z)/z,V=Math.round(h.lat*z)/z,G=this._map.getBearing(),K=this._map.getPitch();let Q="";if(Q+=n?`/${R}/${V}/${x}`:`${x}/${V}/${R}`,(G||K)&&(Q+="/"+Math.round(10*G)/10),K&&(Q+=`/${Math.round(K)}`),this._hashName){const ae=this._hashName;let _e=!1;const Le=window.location.hash.slice(1).split("&").map(be=>{const Me=be.split("=")[0];return Me===ae?(_e=!0,`${Me}=${Q}`):be}).filter(be=>be);return _e||Le.push(`${ae}=${Q}`),`#${Le.join("&")}`}return`#${Q}`}_getCurrentHash(){const n=window.location.hash.replace("#","");if(this._hashName){let h;return n.split("&").map(x=>x.split("=")).forEach(x=>{x[0]===this._hashName&&(h=x)}),(h&&h[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._getCurrentHash();if(n.length>=3&&!n.some(h=>isNaN(h))){const h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:h,pitch:+(n[4]||0)}),!0}return!1}_updateHashUnthrottled(){const n=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,n)}catch{}}}const ja={linearity:.3,easing:g.bezier(0,0,.3,1)},Bl=g.extend({deceleration:2500,maxSpeed:1400},ja),ol=g.extend({deceleration:20,maxSpeed:1400},ja),Ju=g.extend({deceleration:1e3,maxSpeed:360},ja),wa=g.extend({deceleration:1e3,maxSpeed:90},ja);class Ol{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:g.exported.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,h=g.exported.now();for(;n.length>0&&h-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new g.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:z}of this._inertiaBuffer)h.zoom+=z.zoomDelta||0,h.bearing+=z.bearingDelta||0,h.pitch+=z.pitchDelta||0,z.panDelta&&h.pan._add(z.panDelta),z.around&&(h.around=z.around),z.pinchAround&&(h.pinchAround=z.pinchAround);const x=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,E={};if(h.pan.mag()){const z=Ps(h.pan.mag(),x,g.extend({},Bl,n||{}));E.offset=h.pan.mult(z.amount/h.pan.mag()),E.center=this._map.transform.center,zs(E,z)}if(h.zoom){const z=Ps(h.zoom,x,ol);E.zoom=this._map.transform.zoom+z.amount,zs(E,z)}if(h.bearing){const z=Ps(h.bearing,x,Ju);E.bearing=this._map.transform.bearing+g.clamp(z.amount,-179,179),zs(E,z)}if(h.pitch){const z=Ps(h.pitch,x,wa);E.pitch=this._map.transform.pitch+z.amount,zs(E,z)}if(E.zoom||E.bearing){const z=h.pinchAround===void 0?h.around:h.pinchAround;E.around=z?this._map.unproject(z):this._map.getCenter()}return this.clear(),g.extend(E,{noMoveStart:!0})}}function zs(b,n){(!b.duration||b.duration<n.duration)&&(b.duration=n.duration,b.easing=n.easing)}function Ps(b,n,h){const{maxSpeed:x,linearity:E,deceleration:z}=h,R=g.clamp(b*E/(n/1e3),-x,x),V=Math.abs(R)/(z*E);return{easing:h.easing,duration:1e3*V,amount:R*(V/2)}}class jn extends g.Event{constructor(n,h,x,E={}){const z=re.mousePos(h.getCanvasContainer(),x),R=h.unproject(z);super(n,g.extend({point:z,lngLat:R,originalEvent:x},E)),this._defaultPrevented=!1,this.target=h}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class qn extends g.Event{constructor(n,h,x){const E=n==="touchend"?x.changedTouches:x.touches,z=re.touchPos(h.getCanvasContainer(),E),R=z.map(G=>h.unproject(G)),V=z.reduce((G,K,Q,ae)=>G.add(K.div(ae.length)),new g.pointGeometry(0,0));super(n,{points:z,point:V,lngLats:R,lngLat:h.unproject(V),originalEvent:x}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class wu extends g.Event{constructor(n,h,x){super(n,{originalEvent:x}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Ea{constructor(n,h){this._map=n,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(n){return this._firePreventable(new wu(n.type,this._map,n))}mousedown(n,h){return this._mousedownPos=h,this._firePreventable(new jn(n.type,this._map,n))}mouseup(n){this._map.fire(new jn(n.type,this._map,n))}click(n,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new jn(n.type,this._map,n))}dblclick(n){return this._firePreventable(new jn(n.type,this._map,n))}mouseover(n){this._map.fire(new jn(n.type,this._map,n))}mouseout(n){this._map.fire(new jn(n.type,this._map,n))}touchstart(n){return this._firePreventable(new qn(n.type,this._map,n))}touchmove(n){this._map.fire(new qn(n.type,this._map,n))}touchend(n){this._map.fire(new qn(n.type,this._map,n))}touchcancel(n){this._map.fire(new qn(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ks{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(n){this._map.fire(new jn(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new jn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new jn(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ls{constructor(n,h){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,h){this.isEnabled()&&n.shiftKey&&n.button===0&&(re.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(n,h){if(!this._active)return;const x=h;if(this._lastPos.equals(x)||!this._box&&x.dist(this._startPos)<this._clickTolerance)return;const E=this._startPos;this._lastPos=x,this._box||(this._box=re.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const z=Math.min(E.x,x.x),R=Math.max(E.x,x.x),V=Math.min(E.y,x.y),G=Math.max(E.y,x.y);re.setTransform(this._box,`translate(${z}px,${V}px)`),this._box.style.width=R-z+"px",this._box.style.height=G-V+"px"}mouseupWindow(n,h){if(!this._active||n.button!==0)return;const x=this._startPos,E=h;if(this.reset(),re.suppressClick(),x.x!==E.x||x.y!==E.y)return this._map.fire(new g.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:z=>z.fitScreenCoordinates(x,E,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",n)}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(re.remove(this._box),this._box=null),re.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(n,h){return this._map.fire(new g.Event(n,{originalEvent:h}))}}function To(b,n){const h={};for(let x=0;x<b.length;x++)h[b[x].identifier]=n[x];return h}class _r{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(n,h,x){(this.centroid||x.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=n.timeStamp),x.length===this.numTouches&&(this.centroid=function(E){const z=new g.pointGeometry(0,0);for(const R of E)z._add(R);return z.div(E.length)}(h),this.touches=To(x,h)))}touchmove(n,h,x){if(this.aborted||!this.centroid)return;const E=To(x,h);for(const z in this.touches){const R=this.touches[z],V=E[z];(!V||V.dist(R)>30)&&(this.aborted=!0)}}touchend(n,h,x){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),x.length===0){const E=!this.aborted&&this.centroid;if(this.reset(),E)return E}}}class Ms{constructor(n){this.singleTap=new _r(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(n,h,x){this.singleTap.touchstart(n,h,x)}touchmove(n,h,x){this.singleTap.touchmove(n,h,x)}touchend(n,h,x){const E=this.singleTap.touchend(n,h,x);if(E){const z=n.timeStamp-this.lastTime<500,R=!this.lastTap||this.lastTap.dist(E)<30;if(z&&R||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=E,this.count===this.numTaps)return this.reset(),E}}}class us{constructor(){this._zoomIn=new Ms({numTouches:1,numTaps:2}),this._zoomOut=new Ms({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,h,x){this._zoomIn.touchstart(n,h,x),this._zoomOut.touchstart(n,h,x)}touchmove(n,h,x){this._zoomIn.touchmove(n,h,x),this._zoomOut.touchmove(n,h,x)}touchend(n,h,x){const E=this._zoomIn.touchend(n,h,x),z=this._zoomOut.touchend(n,h,x);return E?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:R.getZoom()+1,around:R.unproject(E)},{originalEvent:n})}):z?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:R.getZoom()-1,around:R.unproject(z)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Sa={0:1,2:2};class Ii{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(n,h){return!1}_move(n,h){return{}}mousedown(n,h){if(this._lastPoint)return;const x=re.mouseButton(n);this._correctButton(n,x)&&(this._lastPoint=h,this._eventButton=x)}mousemoveWindow(n,h){const x=this._lastPoint;if(x){if(n.preventDefault(),function(E,z){const R=Sa[z];return E.buttons===void 0||(E.buttons&R)!==R}(n,this._eventButton))this.reset();else if(this._moved||!(h.dist(x)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(x,h)}}mouseupWindow(n){this._lastPoint&&re.mouseButton(n)===this._eventButton&&(this._moved&&re.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ji extends Ii{mousedown(n,h){super.mousedown(n,h),this._lastPoint&&(this._active=!0)}_correctButton(n,h){return h===0&&!n.ctrlKey}_move(n,h){return{around:h,panDelta:h.sub(n)}}}class Lt extends Ii{_correctButton(n,h){return h===0&&n.ctrlKey||h===2}_move(n,h){const x=.8*(h.x-n.x);if(x)return this._active=!0,{bearingDelta:x}}contextmenu(n){n.preventDefault()}}class cs extends Ii{_correctButton(n,h){return h===0&&n.ctrlKey||h===2}_move(n,h){const x=-.5*(h.y-n.y);if(x)return this._active=!0,{pitchDelta:x}}contextmenu(n){n.preventDefault()}}class sa{constructor(n){this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new g.pointGeometry(0,0)}touchstart(n,h,x){return this._calculateTransform(n,h,x)}touchmove(n,h,x){if(this._active&&!(x.length<this._minTouches))return n.preventDefault(),this._calculateTransform(n,h,x)}touchend(n,h,x){this._calculateTransform(n,h,x),this._active&&x.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,h,x){x.length>0&&(this._active=!0);const E=To(x,h),z=new g.pointGeometry(0,0),R=new g.pointGeometry(0,0);let V=0;for(const K in E){const Q=E[K],ae=this._touches[K];ae&&(z._add(Q),R._add(Q.sub(ae)),V++,E[K]=Q)}if(this._touches=E,V<this._minTouches||!R.mag())return;const G=R.div(V);return this._sum._add(G),this._sum.mag()<this._clickTolerance?void 0:{around:z.div(V),panDelta:G}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(n){}_move(n,h,x){return{}}touchstart(n,h,x){this._firstTwoTouches||x.length<2||(this._firstTwoTouches=[x[0].identifier,x[1].identifier],this._start([h[0],h[1]]))}touchmove(n,h,x){if(!this._firstTwoTouches)return;n.preventDefault();const[E,z]=this._firstTwoTouches,R=al(x,h,E),V=al(x,h,z);if(!R||!V)return;const G=this._aroundCenter?null:R.add(V).div(2);return this._move([R,V],G,n)}touchend(n,h,x){if(!this._firstTwoTouches)return;const[E,z]=this._firstTwoTouches,R=al(x,h,E),V=al(x,h,z);R&&V||(this._active&&re.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function al(b,n,h){for(let x=0;x<b.length;x++)if(b[x].identifier===h)return n[x]}function Vt(b,n){return Math.log(b/n)/Math.LN2}class hs extends qo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,h){const x=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(Vt(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Vt(this._distance,x),pinchAround:h}}}function Ls(b,n){return 180*b.angleWith(n)/Math.PI}class Ta extends qo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,h){const x=this._vector;if(this._vector=n[0].sub(n[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ls(this._vector,x),pinchAround:h}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const h=25/(Math.PI*this._minDiameter)*360,x=Ls(n,this._startVector);return Math.abs(x)<h}}function Er(b){return Math.abs(b.y)>Math.abs(b.x)}class Ds extends qo{reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(n){this._lastPoints=n,Er(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,h,x){const E=n[0].sub(this._lastPoints[0]),z=n[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(E,z,x.timeStamp),this._valid)return this._lastPoints=n,this._active=!0,{pitchDelta:(E.y+z.y)/2*-.5}}gestureBeginsVertically(n,h,x){if(this._valid!==void 0)return this._valid;const E=n.mag()>=2,z=h.mag()>=2;if(!E&&!z)return;if(!E||!z)return this._firstMove===void 0&&(this._firstMove=x),x-this._firstMove<100&&void 0;const R=n.y>0==h.y>0;return Er(n)&&Er(h)&&R}}const Eu={panStep:100,bearingStep:15,pitchStep:10};class qr{constructor(){const n=Eu;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let h=0,x=0,E=0,z=0,R=0;switch(n.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:n.shiftKey?x=-1:(n.preventDefault(),z=-1);break;case 39:n.shiftKey?x=1:(n.preventDefault(),z=1);break;case 38:n.shiftKey?E=1:(n.preventDefault(),R=-1);break;case 40:n.shiftKey?E=-1:(n.preventDefault(),R=1);break;default:return}return this._rotationDisabled&&(x=0,E=0),{cameraAnimation:V=>{const G=V.getZoom();V.easeTo({duration:300,easeId:"keyboardHandler",easing:jt,zoom:h?Math.round(G)+h*(n.shiftKey?2:1):G,bearing:V.getBearing()+x*this._bearingStep,pitch:V.getPitch()+E*this._pitchStep,offset:[-z*this._panStep,-R*this._panStep],center:V.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function jt(b){return b*(2-b)}const Dn=4.000244140625;class Rs{constructor(n,h){this._map=n,this._el=n.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,g.bindAll(["_onTimeout"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=n&&n.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(n){if(!this.isEnabled())return;let h=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const x=g.exported.now(),E=x-(this._lastWheelEventTime||0);this._lastWheelEventTime=x,h!==0&&h%Dn==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":E>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(E*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),n.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=n,this._delta-=h,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=re.mousePos(this._el,n);this._around=g.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(h)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;if(this._delta!==0){const V=this._type==="wheel"&&Math.abs(this._delta)>Dn?this._wheelZoomRate:this._defaultZoomRate;let G=2/(1+Math.exp(-Math.abs(this._delta*V)));this._delta<0&&G!==0&&(G=1/G);const K=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):n.scale;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(K*G))),this._type==="wheel"&&(this._startZoom=n.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:n.zoom,x=this._startZoom,E=this._easing;let z,R=!1;if(this._type==="wheel"&&x&&E){const V=Math.min((g.exported.now()-this._lastWheelEventTime)/200,1),G=E(V);z=g.number(x,h,G),V<1?this._frameId||(this._frameId=!0):R=!0}else z=h,R=!0;return this._active=!0,R&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!R,zoomDelta:z-n.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let h=g.ease;if(this._prevEase){const x=this._prevEase,E=(g.exported.now()-x.start)/x.duration,z=x.easing(E+.01)-x.easing(E),R=.27/Math.sqrt(z*z+1e-4)*.01,V=Math.sqrt(.0729-R*R);h=g.bezier(R,V,.25,1)}return this._prevEase={start:g.exported.now(),duration:n,easing:h},h}reset(){this._active=!1}}class qa{constructor(n,h){this._clickZoom=n,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ao{constructor(){this.reset()}reset(){this._active=!1}dblclick(n,h){return n.preventDefault(),{cameraAnimation:x=>{x.easeTo({duration:300,zoom:x.getZoom()+(n.shiftKey?-1:1),around:x.unproject(h)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vr{constructor(){this._tap=new Ms({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(n,h,x){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?x.length>0&&(this._swipePoint=h[0],this._swipeTouch=x[0].identifier):this._tap.touchstart(n,h,x))}touchmove(n,h,x){if(this._tapTime){if(this._swipePoint){if(x[0].identifier!==this._swipeTouch)return;const E=h[0],z=E.y-this._swipePoint.y;return this._swipePoint=E,n.preventDefault(),this._active=!0,{zoomDelta:z/128}}}else this._tap.touchmove(n,h,x)}touchend(n,h,x){this._tapTime?this._swipePoint&&x.length===0&&this.reset():this._tap.touchend(n,h,x)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class la{constructor(n,h,x){this._el=n,this._mousePan=h,this._touchPan=x}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ct{constructor(n,h,x){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=h,this._mousePitch=x}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class sl{constructor(n,h,x,E){this._el=n,this._touchZoom=h,this._touchRotate=x,this._tapDragZoom=E,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Aa=b=>b.zoom||b.drag||b.pitch||b.rotate;class ll extends g.Event{}function Jn(b){return b.panDelta&&b.panDelta.mag()||b.zoomDelta||b.bearingDelta||b.pitchDelta}class Sr{constructor(n,h){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ol(n),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h),g.bindAll(["handleEvent","handleWindowEvent"],this);const x=this._el;this._listeners=[[x,"touchstart",{passive:!0}],[x,"touchmove",{passive:!1}],[x,"touchend",void 0],[x,"touchcancel",void 0],[x,"mousedown",void 0],[x,"mousemove",void 0],[x,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[x,"mouseover",void 0],[x,"mouseout",void 0],[x,"dblclick",void 0],[x,"click",void 0],[x,"keydown",{capture:!1}],[x,"keyup",void 0],[x,"wheel",{passive:!1}],[x,"contextmenu",void 0],[window,"blur",void 0]];for(const[E,z,R]of this._listeners)re.addEventListener(E,z,E===document?this.handleWindowEvent:this.handleEvent,R)}destroy(){for(const[n,h,x]of this._listeners)re.removeEventListener(n,h,n===document?this.handleWindowEvent:this.handleEvent,x)}_addDefaultHandlers(n){const h=this._map,x=h.getCanvasContainer();this._add("mapEvent",new Ea(h,n));const E=h.boxZoom=new ls(h,n);this._add("boxZoom",E);const z=new us,R=new Ao;h.doubleClickZoom=new qa(R,z),this._add("tapZoom",z),this._add("clickZoom",R);const V=new vr;this._add("tapDragZoom",V);const G=h.touchPitch=new Ds;this._add("touchPitch",G);const K=new Lt(n),Q=new cs(n);h.dragRotate=new Ct(n,K,Q),this._add("mouseRotate",K,["mousePitch"]),this._add("mousePitch",Q,["mouseRotate"]);const ae=new Ji(n),_e=new sa(n);h.dragPan=new la(x,ae,_e),this._add("mousePan",ae),this._add("touchPan",_e,["touchZoom","touchRotate"]);const Le=new Ta,be=new hs;h.touchZoomRotate=new sl(x,be,Le,V),this._add("touchRotate",Le,["touchPan","touchZoom"]),this._add("touchZoom",be,["touchPan","touchRotate"]);const Me=h.scrollZoom=new Rs(h,this);this._add("scrollZoom",Me,["mousePan"]);const qe=h.keyboard=new qr;this._add("keyboard",qe),this._add("blockableMapEvent",new ks(h));for(const Ne of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[Ne]&&h[Ne].enable(n[Ne])}_add(n,h,x){this._handlers.push({handlerName:n,handler:h,allowed:x}),this._handlersById[n]=h}stop(n){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Aa(this._eventsInProgress))||this.isZooming()}_blockedByActive(n,h,x){for(const E in n)if(E!==x&&(!h||h.indexOf(E)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const h=[];for(const x of n)this._el.contains(x.target)&&h.push(x);return h}handleEvent(n,h){if(n.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const x=n.type==="renderFrame"?void 0:n,E={needsRenderFrame:!1},z={},R={},V=n.touches,G=V?this._getMapTouches(V):void 0,K=G?re.touchPos(this._el,G):re.mousePos(this._el,n);for(const{handlerName:_e,handler:Le,allowed:be}of this._handlers){if(!Le.isEnabled())continue;let Me;this._blockedByActive(R,be,_e)?Le.reset():Le[h||n.type]&&(Me=Le[h||n.type](n,K,G),this.mergeHandlerResult(E,z,Me,_e,x),Me&&Me.needsRenderFrame&&this._triggerRenderFrame()),(Me||Le.isActive())&&(R[_e]=Le)}const Q={};for(const _e in this._previousActiveHandlers)R[_e]||(Q[_e]=x);this._previousActiveHandlers=R,(Object.keys(Q).length||Jn(E))&&(this._changes.push([E,z,Q]),this._triggerRenderFrame()),(Object.keys(R).length||Jn(E))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ae}=E;ae&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ae(this._map))}mergeHandlerResult(n,h,x,E,z){if(!x)return;g.extend(n,x);const R={handlerName:E,originalEvent:x.originalEvent||z};x.zoomDelta!==void 0&&(h.zoom=R),x.panDelta!==void 0&&(h.drag=R),x.pitchDelta!==void 0&&(h.pitch=R),x.bearingDelta!==void 0&&(h.rotate=R)}_applyChanges(){const n={},h={},x={};for(const[E,z,R]of this._changes)E.panDelta&&(n.panDelta=(n.panDelta||new g.pointGeometry(0,0))._add(E.panDelta)),E.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+E.zoomDelta),E.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+E.bearingDelta),E.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+E.pitchDelta),E.around!==void 0&&(n.around=E.around),E.pinchAround!==void 0&&(n.pinchAround=E.pinchAround),E.noInertia&&(n.noInertia=E.noInertia),g.extend(h,z),g.extend(x,R);this._updateMapTransform(n,h,x),this._changes=[]}_updateMapTransform(n,h,x){const E=this._map,z=E.transform;if(!Jn(n))return this._fireEvents(h,x,!0);let{panDelta:R,zoomDelta:V,bearingDelta:G,pitchDelta:K,around:Q,pinchAround:ae}=n;ae!==void 0&&(Q=ae),E._stop(!0),Q=Q||E.transform.centerPoint;const _e=z.pointLocation(R?Q.sub(R):Q);G&&(z.bearing+=G),K&&(z.pitch+=K),V&&(z.zoom+=V),z.setLocationAtPoint(_e,Q),this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(h,x,!0)}_fireEvents(n,h,x){const E=Aa(this._eventsInProgress),z=Aa(n),R={};for(const Q in n){const{originalEvent:ae}=n[Q];this._eventsInProgress[Q]||(R[`${Q}start`]=ae),this._eventsInProgress[Q]=n[Q]}!E&&z&&this._fireEvent("movestart",z.originalEvent);for(const Q in R)this._fireEvent(Q,R[Q]);z&&this._fireEvent("move",z.originalEvent);for(const Q in n){const{originalEvent:ae}=n[Q];this._fireEvent(Q,ae)}const V={};let G;for(const Q in this._eventsInProgress){const{handlerName:ae,originalEvent:_e}=this._eventsInProgress[Q];this._handlersById[ae].isActive()||(delete this._eventsInProgress[Q],G=h[ae]||_e,V[`${Q}end`]=G)}for(const Q in V)this._fireEvent(Q,V[Q]);const K=Aa(this._eventsInProgress);if(x&&(E||z)&&!K){this._updatingCamera=!0;const Q=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ae=_e=>_e!==0&&-this._bearingSnap<_e&&_e<this._bearingSnap;Q?(ae(Q.bearing||this._map.getBearing())&&(Q.bearing=0),this._map.easeTo(Q,{originalEvent:G})):(this._map.fire(new g.Event("moveend",{originalEvent:G})),ae(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,h){this._map.fire(new g.Event(n,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{delete this._frameId,this.handleEvent(new ll("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const mr={extend:(b,...n)=>g.extend(b,...n),run(b){b()},logToElement(b,n=!1,h="log"){const x=window.document.getElementById(h);x&&(n&&(x.innerHTML=""),x.innerHTML+=`<br>${b}`)}};class ps extends g.Evented{constructor(n,h){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=h.bearingSnap,g.bindAll(["_renderFrameCallback"],this)}getCenter(){return new g.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,h){return this.jumpTo({center:n},h)}panBy(n,h,x){return n=g.pointGeometry.convert(n).mult(-1),this.panTo(this.transform.center,g.extend({offset:n},h),x)}panTo(n,h,x){return this.easeTo(g.extend({center:n},h),x)}getZoom(){return this.transform.zoom}setZoom(n,h){return this.jumpTo({zoom:n},h),this}zoomTo(n,h,x){return this.easeTo(g.extend({zoom:n},h),x)}zoomIn(n,h){return this.zoomTo(this.getZoom()+1,n,h),this}zoomOut(n,h){return this.zoomTo(this.getZoom()-1,n,h),this}getBearing(){return this.transform.bearing}setBearing(n,h){return this.jumpTo({bearing:n},h),this}getPadding(){return this.transform.padding}setPadding(n,h){return this.jumpTo({padding:n},h),this}rotateTo(n,h,x){return this.easeTo(g.extend({bearing:n},h),x)}resetNorth(n,h){return this.rotateTo(0,g.extend({duration:1e3},n),h),this}resetNorthPitch(n,h){return this.easeTo(g.extend({bearing:0,pitch:0,duration:1e3},n),h),this}snapToNorth(n,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,h):this}getPitch(){return this.transform.pitch}setPitch(n,h){return this.jumpTo({pitch:n},h),this}cameraForBounds(n,h){n=g.LngLatBounds.convert(n);const x=h&&h.bearing||0;return this._cameraForBoxAndBearing(n.getNorthWest(),n.getSouthEast(),x,h)}_cameraForBoxAndBearing(n,h,x,E){const z={top:0,bottom:0,right:0,left:0};if(typeof(E=g.extend({padding:z,offset:[0,0],maxZoom:this.transform.maxZoom},E)).padding=="number"){const rt=E.padding;E.padding={top:rt,bottom:rt,right:rt,left:rt}}E.padding=g.extend(z,E.padding);const R=this.transform,V=R.padding,G=R.project(g.LngLat.convert(n)),K=R.project(g.LngLat.convert(h)),Q=G.rotate(-x*Math.PI/180),ae=K.rotate(-x*Math.PI/180),_e=new g.pointGeometry(Math.max(Q.x,ae.x),Math.max(Q.y,ae.y)),Le=new g.pointGeometry(Math.min(Q.x,ae.x),Math.min(Q.y,ae.y)),be=_e.sub(Le),Me=(R.width-(V.left+V.right+E.padding.left+E.padding.right))/be.x,qe=(R.height-(V.top+V.bottom+E.padding.top+E.padding.bottom))/be.y;if(qe<0||Me<0)return void g.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Ne=Math.min(R.scaleZoom(R.scale*Math.min(Me,qe)),E.maxZoom),Ke=g.pointGeometry.convert(E.offset),Ze=new g.pointGeometry((E.padding.left-E.padding.right)/2,(E.padding.top-E.padding.bottom)/2).rotate(x*Math.PI/180),ut=Ke.add(Ze).mult(R.scale/R.zoomScale(Ne));return{center:R.unproject(G.add(K).div(2).sub(ut)),zoom:Ne,bearing:x}}fitBounds(n,h,x){return this._fitInternal(this.cameraForBounds(n,h),h,x)}fitScreenCoordinates(n,h,x,E,z){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(g.pointGeometry.convert(n)),this.transform.pointLocation(g.pointGeometry.convert(h)),x,E),E,z)}_fitInternal(n,h,x){return n?(delete(h=g.extend(n,h)).padding,h.linear?this.easeTo(h,x):this.flyTo(h,x)):this}jumpTo(n,h){this.stop();const x=this.transform;let E=!1,z=!1,R=!1;return"zoom"in n&&x.zoom!==+n.zoom&&(E=!0,x.zoom=+n.zoom),n.center!==void 0&&(x.center=g.LngLat.convert(n.center)),"bearing"in n&&x.bearing!==+n.bearing&&(z=!0,x.bearing=+n.bearing),"pitch"in n&&x.pitch!==+n.pitch&&(R=!0,x.pitch=+n.pitch),n.padding==null||x.isPaddingEqual(n.padding)||(x.padding=n.padding),this.fire(new g.Event("movestart",h)).fire(new g.Event("move",h)),E&&this.fire(new g.Event("zoomstart",h)).fire(new g.Event("zoom",h)).fire(new g.Event("zoomend",h)),z&&this.fire(new g.Event("rotatestart",h)).fire(new g.Event("rotate",h)).fire(new g.Event("rotateend",h)),R&&this.fire(new g.Event("pitchstart",h)).fire(new g.Event("pitch",h)).fire(new g.Event("pitchend",h)),this.fire(new g.Event("moveend",h))}easeTo(n,h){this._stop(!1,n.easeId),((n=g.extend({offset:[0,0],duration:500,easing:g.ease},n)).animate===!1||!n.essential&&g.exported.prefersReducedMotion)&&(n.duration=0);const x=this.transform,E=this.getZoom(),z=this.getBearing(),R=this.getPitch(),V=this.getPadding(),G="zoom"in n?+n.zoom:E,K="bearing"in n?this._normalizeBearing(n.bearing,z):z,Q="pitch"in n?+n.pitch:R,ae="padding"in n?n.padding:x.padding,_e=g.pointGeometry.convert(n.offset);let Le=x.centerPoint.add(_e);const be=x.pointLocation(Le),Me=g.LngLat.convert(n.center||be);this._normalizeCenter(Me);const qe=x.project(be),Ne=x.project(Me).sub(qe),Ke=x.zoomScale(G-E);let Ze,ut;n.around&&(Ze=g.LngLat.convert(n.around),ut=x.locationPoint(Ze));const rt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||G!==E,this._rotating=this._rotating||z!==K,this._pitching=this._pitching||Q!==R,this._padding=!x.isPaddingEqual(ae),this._easeId=n.easeId,this._prepareEase(h,n.noMoveStart,rt),this._ease(ot=>{if(this._zooming&&(x.zoom=g.number(E,G,ot)),this._rotating&&(x.bearing=g.number(z,K,ot)),this._pitching&&(x.pitch=g.number(R,Q,ot)),this._padding&&(x.interpolatePadding(V,ae,ot),Le=x.centerPoint.add(_e)),Ze)x.setLocationAtPoint(Ze,ut);else{const yt=x.zoomScale(x.zoom-E),Et=G>E?Math.min(2,Ke):Math.max(.5,Ke),ct=Math.pow(Et,1-ot),Kt=x.unproject(qe.add(Ne.mult(ot*ct)).mult(yt));x.setLocationAtPoint(x.renderWorldCopies?Kt.wrap():Kt,Le)}this._fireMoveEvents(h)},ot=>{this._afterEase(h,ot)},n),this}_prepareEase(n,h,x={}){this._moving=!0,h||x.moving||this.fire(new g.Event("movestart",n)),this._zooming&&!x.zooming&&this.fire(new g.Event("zoomstart",n)),this._rotating&&!x.rotating&&this.fire(new g.Event("rotatestart",n)),this._pitching&&!x.pitching&&this.fire(new g.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new g.Event("move",n)),this._zooming&&this.fire(new g.Event("zoom",n)),this._rotating&&this.fire(new g.Event("rotate",n)),this._pitching&&this.fire(new g.Event("pitch",n))}_afterEase(n,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const x=this._zooming,E=this._rotating,z=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,x&&this.fire(new g.Event("zoomend",n)),E&&this.fire(new g.Event("rotateend",n)),z&&this.fire(new g.Event("pitchend",n)),this.fire(new g.Event("moveend",n))}flyTo(n,h){if(!n.essential&&g.exported.prefersReducedMotion){const u=g.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(u,h)}this.stop(),n=g.extend({offset:[0,0],speed:1.2,curve:1.42,easing:g.ease},n);const x=this.transform,E=this.getZoom(),z=this.getBearing(),R=this.getPitch(),V=this.getPadding(),G="zoom"in n?g.clamp(+n.zoom,x.minZoom,x.maxZoom):E,K="bearing"in n?this._normalizeBearing(n.bearing,z):z,Q="pitch"in n?+n.pitch:R,ae="padding"in n?n.padding:x.padding,_e=x.zoomScale(G-E),Le=g.pointGeometry.convert(n.offset);let be=x.centerPoint.add(Le);const Me=x.pointLocation(be),qe=g.LngLat.convert(n.center||Me);this._normalizeCenter(qe);const Ne=x.project(Me),Ke=x.project(qe).sub(Ne);let Ze=n.curve;const ut=Math.max(x.width,x.height),rt=ut/_e,ot=Ke.mag();if("minZoom"in n){const u=g.clamp(Math.min(n.minZoom,E,G),x.minZoom,x.maxZoom),f=ut/x.zoomScale(u-E);Ze=Math.sqrt(f/ot*2)}const yt=Ze*Ze;function Et(u){const f=(rt*rt-ut*ut+(u?-1:1)*yt*yt*ot*ot)/(2*(u?rt:ut)*yt*ot);return Math.log(Math.sqrt(f*f+1)-f)}function ct(u){return(Math.exp(u)-Math.exp(-u))/2}function Kt(u){return(Math.exp(u)+Math.exp(-u))/2}const Ot=Et(0);let gi=function(u){return Kt(Ot)/Kt(Ot+Ze*u)},s=function(u){return ut*((Kt(Ot)*(ct(f=Ot+Ze*u)/Kt(f))-ct(Ot))/yt)/ot;var f},c=(Et(1)-Ot)/Ze;if(Math.abs(ot)<1e-6||!isFinite(c)){if(Math.abs(ut-rt)<1e-6)return this.easeTo(n,h);const u=rt<ut?-1:1;c=Math.abs(Math.log(rt/ut))/Ze,s=function(){return 0},gi=function(f){return Math.exp(u*Ze*f)}}return n.duration="duration"in n?+n.duration:1e3*c/("screenSpeed"in n?+n.screenSpeed/Ze:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0),this._zooming=!0,this._rotating=z!==K,this._pitching=Q!==R,this._padding=!x.isPaddingEqual(ae),this._prepareEase(h,!1),this._ease(u=>{const f=u*c,T=1/gi(f);x.zoom=u===1?G:E+x.scaleZoom(T),this._rotating&&(x.bearing=g.number(z,K,u)),this._pitching&&(x.pitch=g.number(R,Q,u)),this._padding&&(x.interpolatePadding(V,ae,u),be=x.centerPoint.add(Le));const P=u===1?qe:x.unproject(Ne.add(Ke.mult(s(f))).mult(T));x.setLocationAtPoint(x.renderWorldCopies?P.wrap():P,be),this._fireMoveEvents(h)},()=>this._afterEase(h),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const x=this._onEaseEnd;delete this._onEaseEnd,x.call(this,h)}if(!n){const x=this.handlers;x&&x.stop(!1)}return this}_ease(n,h,x){x.animate===!1||x.duration===0?(n(1),h()):(this._easeStart=g.exported.now(),this._easeOptions=x,this._onEaseFrame=n,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((g.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,h){n=g.wrap(n,-180,180);const x=Math.abs(n-h);return Math.abs(n-360-h)<x&&(n-=360),Math.abs(n+360-h)<x&&(n+=360),n}_normalizeCenter(n){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const x=n.lng-h.center.lng;n.lng+=x>180?-360:x<-180?360:0}}class Rn{constructor(n={}){this.options=n,g.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){return this._map=n,this._compact=this.options&&this.options.compact,this._container=re.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=re.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=re.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){re.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(n,h){const x=this._map._getUIString(`AttributionControl.${h}`);n.title=x,n.setAttribute("aria-label",x)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let n=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=n.concat(this.options.customAttribution.map(E=>typeof E!="string"?"":E)):typeof this.options.customAttribution=="string"&&n.push(this.options.customAttribution)),this._map.style.stylesheet){const E=this._map.style.stylesheet;this.styleOwner=E.owner,this.styleId=E.id}const h=this._map.style.sourceCaches;for(const E in h){const z=h[E];if(z.used){const R=z.getSource();R.attribution&&n.indexOf(R.attribution)<0&&n.push(R.attribution)}}n=n.filter(E=>String(E).trim()),n.sort((E,z)=>E.length-z.length),n=n.filter((E,z)=>{for(let R=z+1;R<n.length;R++)if(n[R].indexOf(E)>=0)return!1;return!0});const x=n.join(" | ");x!==this._attribHTML&&(this._attribHTML=x,n.length?(this._innerContainer.innerHTML=x,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class Go{constructor(n={}){this.options=n,g.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(n){this._map=n,this._compact=this.options&&this.options.compact,this._container=re.create("div","maplibregl-ctrl mapboxgl-ctrl");const h=re.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){re.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const n=this._container.children;if(n.length){const h=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&h.classList.add("maplibregl-compact","mapboxgl-compact"):h.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class Su{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const h=++this._id;return this._queue.push({callback:n,id:h,cancelled:!1}),h}remove(n){const h=this._currentlyRunning,x=h?this._queue.concat(h):this._queue;for(const E of x)if(E.id===n)return void(E.cancelled=!0)}run(n=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const x of h)if(!x.cancelled&&(x.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Bs={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Tu={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},Ro={showCompass:!0,showZoom:!0,visualizePitch:!1};class so{constructor(n,h,x=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new Lt({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,x&&(this.mousePitch=new cs({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),g.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),re.addEventListener(h,"mousedown",this.mousedown),re.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),re.addEventListener(h,"touchmove",this.touchmove),re.addEventListener(h,"touchend",this.touchend),re.addEventListener(h,"touchcancel",this.reset)}down(n,h){this.mouseRotate.mousedown(n,h),this.mousePitch&&this.mousePitch.mousedown(n,h),re.disableDrag()}move(n,h){const x=this.map,E=this.mouseRotate.mousemoveWindow(n,h);if(E&&E.bearingDelta&&x.setBearing(x.getBearing()+E.bearingDelta),this.mousePitch){const z=this.mousePitch.mousemoveWindow(n,h);z&&z.pitchDelta&&x.setPitch(x.getPitch()+z.pitchDelta)}}off(){const n=this.element;re.removeEventListener(n,"mousedown",this.mousedown),re.removeEventListener(n,"touchstart",this.touchstart,{passive:!1}),re.removeEventListener(n,"touchmove",this.touchmove),re.removeEventListener(n,"touchend",this.touchend),re.removeEventListener(n,"touchcancel",this.reset),this.offTemp()}offTemp(){re.enableDrag(),re.removeEventListener(window,"mousemove",this.mousemove),re.removeEventListener(window,"mouseup",this.mouseup)}mousedown(n){this.down(g.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),re.mousePos(this.element,n)),re.addEventListener(window,"mousemove",this.mousemove),re.addEventListener(window,"mouseup",this.mouseup)}mousemove(n){this.move(n,re.mousePos(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=re.touchPos(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=re.touchPos(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Gt(b,n,h){if(b=new g.LngLat(b.lng,b.lat),n){const x=new g.LngLat(b.lng-360,b.lat),E=new g.LngLat(b.lng+360,b.lat),z=h.locationPoint(b).distSqr(n);h.locationPoint(x).distSqr(n)<z?b=x:h.locationPoint(E).distSqr(n)<z&&(b=E)}for(;Math.abs(b.lng-h.center.lng)>180;){const x=h.locationPoint(b);if(x.x>=0&&x.y>=0&&x.x<=h.width&&x.y<=h.height)break;b.lng>h.center.lng?b.lng-=360:b.lng+=360}return b}const At={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function lo(b,n,h){const x=b.classList;for(const E in At)x.remove(`maplibregl-${h}-anchor-${E}`,`mapboxgl-${h}-anchor-${E}`);x.add(`maplibregl-${h}-anchor-${n}`,`mapboxgl-${h}-anchor-${n}`)}class Gn extends g.Evented{constructor(n,h){if(super(),(n instanceof HTMLElement||h)&&(n=g.extend({element:n},h)),g.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment!=="auto"?n.pitchAlignment:this._rotationAlignment,n&&n.element)this._element=n.element,this._offset=g.pointGeometry.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=re.create("div"),this._element.setAttribute("aria-label","Map marker");const x=re.createNS("http://www.w3.org/2000/svg","svg"),E=41,z=27;x.setAttributeNS(null,"display","block"),x.setAttributeNS(null,"height",`${E}px`),x.setAttributeNS(null,"width",`${z}px`),x.setAttributeNS(null,"viewBox",`0 0 ${z} ${E}`);const R=re.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"stroke","none"),R.setAttributeNS(null,"stroke-width","1"),R.setAttributeNS(null,"fill","none"),R.setAttributeNS(null,"fill-rule","evenodd");const V=re.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"fill-rule","nonzero");const G=re.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(3.0, 29.0)"),G.setAttributeNS(null,"fill","#000000");const K=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Ke of K){const Ze=re.createNS("http://www.w3.org/2000/svg","ellipse");Ze.setAttributeNS(null,"opacity","0.04"),Ze.setAttributeNS(null,"cx","10.5"),Ze.setAttributeNS(null,"cy","5.80029008"),Ze.setAttributeNS(null,"rx",Ke.rx),Ze.setAttributeNS(null,"ry",Ke.ry),G.appendChild(Ze)}const Q=re.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"fill",this._color);const ae=re.createNS("http://www.w3.org/2000/svg","path");ae.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Q.appendChild(ae);const _e=re.createNS("http://www.w3.org/2000/svg","g");_e.setAttributeNS(null,"opacity","0.25"),_e.setAttributeNS(null,"fill","#000000");const Le=re.createNS("http://www.w3.org/2000/svg","path");Le.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),_e.appendChild(Le);const be=re.createNS("http://www.w3.org/2000/svg","g");be.setAttributeNS(null,"transform","translate(6.0, 7.0)"),be.setAttributeNS(null,"fill","#FFFFFF");const Me=re.createNS("http://www.w3.org/2000/svg","g");Me.setAttributeNS(null,"transform","translate(8.0, 8.0)");const qe=re.createNS("http://www.w3.org/2000/svg","circle");qe.setAttributeNS(null,"fill","#000000"),qe.setAttributeNS(null,"opacity","0.25"),qe.setAttributeNS(null,"cx","5.5"),qe.setAttributeNS(null,"cy","5.5"),qe.setAttributeNS(null,"r","5.4999962");const Ne=re.createNS("http://www.w3.org/2000/svg","circle");Ne.setAttributeNS(null,"fill","#FFFFFF"),Ne.setAttributeNS(null,"cx","5.5"),Ne.setAttributeNS(null,"cy","5.5"),Ne.setAttributeNS(null,"r","5.4999962"),Me.appendChild(qe),Me.appendChild(Ne),V.appendChild(G),V.appendChild(Q),V.appendChild(_e),V.appendChild(be),V.appendChild(Me),x.appendChild(V),x.setAttributeNS(null,"height",E*this._scale+"px"),x.setAttributeNS(null,"width",z*this._scale+"px"),this._element.appendChild(x),this._offset=g.pointGeometry.convert(n&&n.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()}),lo(this._element,this._anchor,"marker"),this._popup=null}addTo(n){return this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._update),n.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),re.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=g.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const E=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[E,-1*(38.1-13.5+E)],"bottom-right":[-E,-1*(38.1-13.5+E)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(n){const h=n.code,x=n.charCode||n.keyCode;h!=="Space"&&h!=="Enter"&&x!==32&&x!==13||this.togglePopup()}_onMapClick(n){const h=n.originalEvent.target,x=this._element;this._popup&&(h===x||x.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?n.remove():n.addTo(this._map),this):this}_update(n){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Gt(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let x="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?x="rotateX(0deg)":this._pitchAlignment==="map"&&(x=`rotateX(${this._map.getPitch()}deg)`),n&&n.type!=="moveend"||(this._pos=this._pos.round()),re.setTransform(this._element,`${At[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${x} ${h}`)}getOffset(){return this._offset}setOffset(n){return this._offset=g.pointGeometry.convert(n),this._update(),this}_onMove(n){if(!this._isDragging){const h=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new g.Event("dragstart"))),this.fire(new g.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new g.Event("dragend")),this._state="inactive"}_addDragHandler(n){this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(n){return this._draggable=!!n,this._map&&(n?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n&&n!=="auto"?n:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const an={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Tr,uo=0,Cr=!1;const Zn={maxWidth:100,unit:"metric"};function Ia(b,n,h){const x=h&&h.maxWidth||100,E=b._container.clientHeight/2,z=b.unproject([0,E]),R=b.unproject([x,E]),V=z.distanceTo(R);if(h&&h.unit==="imperial"){const G=3.2808*V;G>5280?Pt(n,x,G/5280,b._getUIString("ScaleControl.Miles")):Pt(n,x,G,b._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?Pt(n,x,V/1852,b._getUIString("ScaleControl.NauticalMiles")):V>=1e3?Pt(n,x,V/1e3,b._getUIString("ScaleControl.Kilometers")):Pt(n,x,V,b._getUIString("ScaleControl.Meters"))}function Pt(b,n,h,x){const E=function(z){const R=Math.pow(10,`${Math.floor(z)}`.length-1);let V=z/R;return V=V>=10?10:V>=5?5:V>=3?3:V>=2?2:V>=1?1:function(G){const K=Math.pow(10,Math.ceil(-Math.log(G)/Math.LN10));return Math.round(G*K)/K}(V),R*V}(h);b.style.width=n*(E/h)+"px",b.innerHTML=`${E}&nbsp;${x}`}const zt={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ul=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Yr(b){if(b){if(typeof b=="number"){const n=Math.round(Math.sqrt(.5*Math.pow(b,2)));return{center:new g.pointGeometry(0,0),top:new g.pointGeometry(0,b),"top-left":new g.pointGeometry(n,n),"top-right":new g.pointGeometry(-n,n),bottom:new g.pointGeometry(0,-b),"bottom-left":new g.pointGeometry(n,-n),"bottom-right":new g.pointGeometry(-n,-n),left:new g.pointGeometry(b,0),right:new g.pointGeometry(-b,0)}}if(b instanceof g.pointGeometry||Array.isArray(b)){const n=g.pointGeometry.convert(b);return{center:n,top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{center:g.pointGeometry.convert(b.center||[0,0]),top:g.pointGeometry.convert(b.top||[0,0]),"top-left":g.pointGeometry.convert(b["top-left"]||[0,0]),"top-right":g.pointGeometry.convert(b["top-right"]||[0,0]),bottom:g.pointGeometry.convert(b.bottom||[0,0]),"bottom-left":g.pointGeometry.convert(b["bottom-left"]||[0,0]),"bottom-right":g.pointGeometry.convert(b["bottom-right"]||[0,0]),left:g.pointGeometry.convert(b.left||[0,0]),right:g.pointGeometry.convert(b.right||[0,0])}}return Yr(new g.pointGeometry(0,0))}const Yn={supported:Z,setRTLTextPlugin:g.setRTLTextPlugin,getRTLTextPluginStatus:g.getRTLTextPluginStatus,Map:class extends ps{constructor(b){var n;if(g.PerformanceUtils.mark(g.PerformanceMarkers.create),(b=g.extend({},Tu,b)).minZoom!=null&&b.maxZoom!=null&&b.minZoom>b.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(b.minPitch!=null&&b.maxPitch!=null&&b.minPitch>b.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(b.minPitch!=null&&b.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(b.maxPitch!=null&&b.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new jo(b.minZoom,b.maxZoom,b.minPitch,b.maxPitch,b.renderWorldCopies),{bearingSnap:b.bearingSnap}),this._interactive=b.interactive,this._maxTileCacheSize=b.maxTileCacheSize,this._failIfMajorPerformanceCaveat=b.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=b.preserveDrawingBuffer,this._antialias=b.antialias,this._trackResize=b.trackResize,this._bearingSnap=b.bearingSnap,this._refreshExpiredTiles=b.refreshExpiredTiles,this._fadeDuration=b.fadeDuration,this._crossSourceCollisions=b.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=b.collectResourceTiming,this._renderTaskQueue=new Su,this._controls=[],this._mapId=g.uniqueId(),this._locale=g.extend({},Bs,b.locale),this._clickTolerance=b.clickTolerance,this._pixelRatio=(n=b.pixelRatio)!==null&&n!==void 0?n:devicePixelRatio,this._requestManager=new it(b.transformRequest),typeof b.container=="string"){if(this._container=document.getElementById(b.container),!this._container)throw new Error(`Container '${b.container}' not found.`)}else{if(!(b.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=b.container}if(b.maxBounds&&this.setMaxBounds(b.maxBounds),g.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),typeof window!="undefined"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Sr(this,b),this._hash=b.hash&&new Cs(typeof b.hash=="string"&&b.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:b.center,zoom:b.zoom,bearing:b.bearing,pitch:b.pitch}),b.bounds&&(this.resize(),this.fitBounds(b.bounds,g.extend({},b.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=b.localIdeographFontFamily,b.style&&this.setStyle(b.style,{localIdeographFontFamily:b.localIdeographFontFamily}),b.attributionControl&&this.addControl(new Rn({customAttribution:b.customAttribution})),b.maplibreLogo&&this.addControl(new Go,b.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new g.Event(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new g.Event(`${h.dataType}dataloading`,h))}),this.on("dataabort",h=>{this.fire(new g.Event("sourcedataabort",h))})}_getMapId(){return this._mapId}addControl(b,n){if(n===void 0&&(n=b.getDefaultPosition?b.getDefaultPosition():"top-right"),!b||!b.onAdd)return this.fire(new g.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=b.onAdd(this);this._controls.push(b);const x=this._controlPositions[n];return n.indexOf("bottom")!==-1?x.insertBefore(h,x.firstChild):x.appendChild(h),this}removeControl(b){if(!b||!b.onRemove)return this.fire(new g.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(b);return n>-1&&this._controls.splice(n,1),b.onRemove(this),this}hasControl(b){return this._controls.indexOf(b)>-1}resize(b){const n=this._containerDimensions(),h=n[0],x=n[1];this._resizeCanvas(h,x,this.getPixelRatio()),this.transform.resize(h,x),this.painter.resize(h,x,this.getPixelRatio());const E=!this._moving;return E&&(this.stop(),this.fire(new g.Event("movestart",b)).fire(new g.Event("move",b))),this.fire(new g.Event("resize",b)),E&&this.fire(new g.Event("moveend",b)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(b){const[n,h]=this._containerDimensions();this._pixelRatio=b,this._resizeCanvas(n,h,b),this.painter.resize(n,h,b)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(b){return this.transform.setMaxBounds(g.LngLatBounds.convert(b)),this._update()}setMinZoom(b){if((b=b==null?-2:b)>=-2&&b<=this.transform.maxZoom)return this.transform.minZoom=b,this._update(),this.getZoom()<b&&this.setZoom(b),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(b){if((b=b==null?22:b)>=this.transform.minZoom)return this.transform.maxZoom=b,this._update(),this.getZoom()>b&&this.setZoom(b),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(b){if((b=b==null?0:b)<0)throw new Error("minPitch must be greater than or equal to 0");if(b>=0&&b<=this.transform.maxPitch)return this.transform.minPitch=b,this._update(),this.getPitch()<b&&this.setPitch(b),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(b){if((b=b==null?60:b)>85)throw new Error("maxPitch must be less than or equal to 85");if(b>=this.transform.minPitch)return this.transform.maxPitch=b,this._update(),this.getPitch()>b&&this.setPitch(b),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(b){return this.transform.renderWorldCopies=b,this._update()}project(b){return this.transform.locationPoint(g.LngLat.convert(b))}unproject(b){return this.transform.pointLocation(g.pointGeometry.convert(b))}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(b,n,h){if(b==="mouseenter"||b==="mouseover"){let x=!1;return{layer:n,listener:h,delegates:{mousemove:z=>{const R=this.getLayer(n)?this.queryRenderedFeatures(z.point,{layers:[n]}):[];R.length?x||(x=!0,h.call(this,new jn(b,this,z.originalEvent,{features:R}))):x=!1},mouseout:()=>{x=!1}}}}if(b==="mouseleave"||b==="mouseout"){let x=!1;return{layer:n,listener:h,delegates:{mousemove:R=>{(this.getLayer(n)?this.queryRenderedFeatures(R.point,{layers:[n]}):[]).length?x=!0:x&&(x=!1,h.call(this,new jn(b,this,R.originalEvent)))},mouseout:R=>{x&&(x=!1,h.call(this,new jn(b,this,R.originalEvent)))}}}}{const x=E=>{const z=this.getLayer(n)?this.queryRenderedFeatures(E.point,{layers:[n]}):[];z.length&&(E.features=z,h.call(this,E),delete E.features)};return{layer:n,listener:h,delegates:{[b]:x}}}}on(b,n,h){if(h===void 0)return super.on(b,n);const x=this._createDelegatedListener(b,n,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[b]=this._delegatedListeners[b]||[],this._delegatedListeners[b].push(x);for(const E in x.delegates)this.on(E,x.delegates[E]);return this}once(b,n,h){if(h===void 0)return super.once(b,n);const x=this._createDelegatedListener(b,n,h);for(const E in x.delegates)this.once(E,x.delegates[E]);return this}off(b,n,h){return h===void 0?super.off(b,n):(this._delegatedListeners&&this._delegatedListeners[b]&&(x=>{const E=this._delegatedListeners[b];for(let z=0;z<E.length;z++){const R=E[z];if(R.layer===n&&R.listener===h){for(const V in R.delegates)this.off(V,R.delegates[V]);return E.splice(z,1),this}}})(),this)}queryRenderedFeatures(b,n){if(!this.style)return[];let h;if(n!==void 0||b===void 0||b instanceof g.pointGeometry||Array.isArray(b)||(n=b,b=void 0),n=n||{},(b=b||[[0,0],[this.transform.width,this.transform.height]])instanceof g.pointGeometry||typeof b[0]=="number")h=[g.pointGeometry.convert(b)];else{const x=g.pointGeometry.convert(b[0]),E=g.pointGeometry.convert(b[1]);h=[x,new g.pointGeometry(E.x,x.y),E,new g.pointGeometry(x.x,E.y),x]}return this.style.queryRenderedFeatures(h,n,this.transform)}querySourceFeatures(b,n){return this.style.querySourceFeatures(b,n)}setStyle(b,n){return(n=g.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&b?(this._diffStyle(b,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(b,n))}setTransformRequest(b){return this._requestManager.setTransformRequest(b),this}_getUIString(b){const n=this._locale[b];if(n==null)throw new Error(`Missing UI string '${b}'`);return n}_updateStyle(b,n){return this.style&&(this.style.setEventedParent(null),this.style._remove()),b?(this.style=new Xi(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof b=="string"?this.style.loadURL(b):this.style.loadJSON(b),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Xi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(b,n){if(typeof b=="string"){const h=this._requestManager.transformRequest(b,g.ResourceType.Style);g.getJSON(h,(x,E)=>{x?this.fire(new g.ErrorEvent(x)):E&&this._updateDiff(E,n)})}else typeof b=="object"&&this._updateDiff(b,n)}_updateDiff(b,n){try{this.style.setState(b)&&this._update(!0)}catch(h){g.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(b,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():g.warnOnce("There is no style added to the map.")}addSource(b,n){return this._lazyInitEmptyStyle(),this.style.addSource(b,n),this._update(!0)}isSourceLoaded(b){const n=this.style&&this.style.sourceCaches[b];if(n!==void 0)return n.loaded();this.fire(new g.ErrorEvent(new Error(`There is no source with ID '${b}'`)))}areTilesLoaded(){const b=this.style&&this.style.sourceCaches;for(const n in b){const h=b[n]._tiles;for(const x in h){const E=h[x];if(E.state!=="loaded"&&E.state!=="errored")return!1}}return!0}addSourceType(b,n,h){return this._lazyInitEmptyStyle(),this.style.addSourceType(b,n,h)}removeSource(b){return this.style.removeSource(b),this._update(!0)}getSource(b){return this.style.getSource(b)}addImage(b,n,{pixelRatio:h=1,sdf:x=!1,stretchX:E,stretchY:z,content:R}={}){if(this._lazyInitEmptyStyle(),n instanceof HTMLImageElement||g.isImageBitmap(n)){const{width:V,height:G,data:K}=g.exported.getImageData(n);this.style.addImage(b,{data:new g.RGBAImage({width:V,height:G},K),pixelRatio:h,stretchX:E,stretchY:z,content:R,sdf:x,version:0})}else{if(n.width===void 0||n.height===void 0)return this.fire(new g.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:V,height:G,data:K}=n,Q=n;this.style.addImage(b,{data:new g.RGBAImage({width:V,height:G},new Uint8Array(K)),pixelRatio:h,stretchX:E,stretchY:z,content:R,sdf:x,version:0,userImage:Q}),Q.onAdd&&Q.onAdd(this,b)}}}updateImage(b,n){const h=this.style.getImage(b);if(!h)return this.fire(new g.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const x=n instanceof HTMLImageElement||g.isImageBitmap(n)?g.exported.getImageData(n):n,{width:E,height:z,data:R}=x;if(E===void 0||z===void 0)return this.fire(new g.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(E!==h.data.width||z!==h.data.height)return this.fire(new g.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const V=!(n instanceof HTMLImageElement||g.isImageBitmap(n));h.data.replace(R,V),this.style.updateImage(b,h)}hasImage(b){return b?!!this.style.getImage(b):(this.fire(new g.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(b){this.style.removeImage(b)}loadImage(b,n){g.getImage(this._requestManager.transformRequest(b,g.ResourceType.Image),n)}listImages(){return this.style.listImages()}addLayer(b,n){return this._lazyInitEmptyStyle(),this.style.addLayer(b,n),this._update(!0)}moveLayer(b,n){return this.style.moveLayer(b,n),this._update(!0)}removeLayer(b){return this.style.removeLayer(b),this._update(!0)}getLayer(b){return this.style.getLayer(b)}setLayerZoomRange(b,n,h){return this.style.setLayerZoomRange(b,n,h),this._update(!0)}setFilter(b,n,h={}){return this.style.setFilter(b,n,h),this._update(!0)}getFilter(b){return this.style.getFilter(b)}setPaintProperty(b,n,h,x={}){return this.style.setPaintProperty(b,n,h,x),this._update(!0)}getPaintProperty(b,n){return this.style.getPaintProperty(b,n)}setLayoutProperty(b,n,h,x={}){return this.style.setLayoutProperty(b,n,h,x),this._update(!0)}getLayoutProperty(b,n){return this.style.getLayoutProperty(b,n)}setLight(b,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(b,n),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(b,n){return this.style.setFeatureState(b,n),this._update()}removeFeatureState(b,n){return this.style.removeFeatureState(b,n),this._update()}getFeatureState(b){return this.style.getFeatureState(b)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let b=0,n=0;return this._container&&(b=this._container.clientWidth||400,n=this._container.clientHeight||300),[b,n]}_setupContainer(){const b=this._container;b.classList.add("maplibregl-map","mapboxgl-map");const n=this._canvasContainer=re.create("div","maplibregl-canvas-container mapboxgl-canvas-container",b);this._interactive&&n.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=re.create("canvas","maplibregl-canvas mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const h=this._containerDimensions();this._resizeCanvas(h[0],h[1],this.getPixelRatio());const x=this._controlContainer=re.create("div","maplibregl-control-container mapboxgl-control-container",b),E=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(z=>{E[z]=re.create("div",`maplibregl-ctrl-${z} mapboxgl-ctrl-${z}`,x)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(b,n,h){this._canvas.width=h*b,this._canvas.height=h*n,this._canvas.style.width=`${b}px`,this._canvas.style.height=`${n}px`}_setupPainter(){const b=g.extend({},Z.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl",b)||this._canvas.getContext("experimental-webgl",b);n?(this.painter=new So(n,this.transform),g.exported$1.testSupport(n)):this.fire(new g.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(b){b.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new g.Event("webglcontextlost",{originalEvent:b}))}_contextRestored(b){this._setupPainter(),this.resize(),this._update(),this.fire(new g.Event("webglcontextrestored",{originalEvent:b}))}_onMapScroll(b){if(b.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(b){return this.style?(this._styleDirty=this._styleDirty||b,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(b){return this._update(),this._renderTaskQueue.add(b)}_cancelRenderFrame(b){this._renderTaskQueue.remove(b)}_render(b){let n,h=0;const x=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(n=x.createQueryEXT(),x.beginQueryEXT(x.TIME_ELAPSED_EXT,n),h=g.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(b),this._removed)return;let E=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const R=this.transform.zoom,V=g.exported.now();this.style.zoomHistory.update(R,V);const G=new g.EvaluationParameters(R,{now:V,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),K=G.crossFadingFactor();K===1&&K===this._crossFadingFactor||(E=!0,this._crossFadingFactor=K),this.style.update(G)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new g.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,g.PerformanceUtils.mark(g.PerformanceMarkers.load),this.fire(new g.Event("load"))),this.style&&(this.style.hasTransitions()||E)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const R=g.exported.now()-h;x.endQueryEXT(x.TIME_ELAPSED_EXT,n),setTimeout(()=>{const V=x.getQueryObjectEXT(n,x.QUERY_RESULT_EXT)/1e6;x.deleteQueryEXT(n),this.fire(new g.Event("gpu-timing-frame",{cpuTime:R,gpuTime:V}))},50)}if(this.listens("gpu-timing-layer")){const R=this.painter.collectGpuTimers();setTimeout(()=>{const V=this.painter.queryGpuTimers(R);this.fire(new g.Event("gpu-timing-layer",{layerTimes:V}))},50)}const z=this._sourcesDirty||this._styleDirty||this._placementDirty;return z||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new g.Event("idle")),!this._loaded||this._fullyLoaded||z||(this._fullyLoaded=!0,g.PerformanceUtils.mark(g.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window!="undefined"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const b=this.painter.context.gl.getExtension("WEBGL_lose_context");b&&b.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),re.remove(this._canvasContainer),re.remove(this._controlContainer),this._container.classList.remove("maplibregl-map","mapboxgl-map"),g.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new g.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=g.exported.frame(b=>{g.PerformanceUtils.frame(b),this._frame=null,this._render(b)}))}_onWindowOnline(){this._update()}_onWindowResize(b){this._trackResize&&this.resize({originalEvent:b})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(b){this._showTileBoundaries!==b&&(this._showTileBoundaries=b,this._update())}get showPadding(){return!!this._showPadding}set showPadding(b){this._showPadding!==b&&(this._showPadding=b,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(b){this._showCollisionBoxes!==b&&(this._showCollisionBoxes=b,b?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(b){this._showOverdrawInspector!==b&&(this._showOverdrawInspector=b,this._update())}get repaint(){return!!this._repaint}set repaint(b){this._repaint!==b&&(this._repaint=b,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(b){this._vertices=b,this._update()}_setCacheLimits(b,n){g.setCacheLimits(b,n)}},NavigationControl:class{constructor(b){this.options=g.extend({},Ro,b),this._container=re.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(g.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",n=>this._map.zoomIn({},{originalEvent:n})),re.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",n=>this._map.zoomOut({},{originalEvent:n})),re.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(g.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",n=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:n}):this._map.resetNorth({},{originalEvent:n})}),this._compassIcon=re.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const b=this._map.getZoom(),n=b===this._map.getMaxZoom(),h=b===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const b=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=b}onAdd(b){return this._map=b,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new so(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){re.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(b,n){const h=re.create("button",b,this._container);return h.type="button",h.addEventListener("click",n),h}_setButtonTitle(b,n){const h=this._map._getUIString(`NavigationControl.${n}`);b.title=h,b.setAttribute("aria-label",h)}},GeolocateControl:class extends g.Evented{constructor(b){super(),this.options=g.extend({},an,b),g.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(b){var n;return this._map=b,this._container=re.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),n=this._setupUI,Tr!==void 0?n(Tr):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(h=>{Tr=h.state!=="denied",n(Tr)}):(Tr=!!window.navigator.geolocation,n(Tr)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),re.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,uo=0,Cr=!1}_isOutOfMapMaxBounds(b){const n=this._map.getMaxBounds(),h=b.coords;return n&&(h.longitude<n.getWest()||h.longitude>n.getEast()||h.latitude<n.getSouth()||h.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(b){if(this._map){if(this._isOutOfMapMaxBounds(b))return this._setErrorState(),this.fire(new g.Event("outofmaxbounds",b)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=b,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(b),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(b),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new g.Event("geolocate",b)),this._finish()}}_updateCamera(b){const n=new g.LngLat(b.coords.longitude,b.coords.latitude),h=b.coords.accuracy,x=this._map.getBearing(),E=g.extend({bearing:x},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(h),E,{geolocateSource:!0})}_updateMarker(b){if(b){const n=new g.LngLat(b.coords.longitude,b.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=b.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const b=this._map._container.clientHeight/2,n=this._map.unproject([0,b]),h=this._map.unproject([1,b]),x=n.distanceTo(h),E=Math.ceil(2*this._accuracy/x);this._circleElement.style.width=`${E}px`,this._circleElement.style.height=`${E}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(b){if(this._map){if(this.options.trackUserLocation)if(b.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(b.code===3&&Cr)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new g.Event("error",b)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(b){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=re.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),re.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",b===!1){g.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=re.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new Gn(this._dotElement),this._circleElement=re.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Gn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new g.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return g.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new g.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":uo--,Cr=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new g.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new g.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let b;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),uo++,uo>1?(b={maximumAge:6e5,timeout:0},Cr=!0):(b=this.options.positionOptions,Cr=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,b)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Rn,LogoControl:Go,ScaleControl:class{constructor(b){this.options=g.extend({},Zn,b),g.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Ia(this._map,this._container,this.options)}onAdd(b){return this._map=b,this._container=re.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",b.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){re.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(b){this.options.unit=b,Ia(this._map,this._container,this.options)}},FullscreenControl:class{constructor(b){this._fullscreen=!1,b&&b.container&&(b.container instanceof HTMLElement?this._container=b.container:g.warnOnce("Full screen control 'container' must be a DOM element.")),g.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(b){return this._map=b,this._container||(this._container=this._map.getContainer()),this._controlContainer=re.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",g.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){re.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const b=this._fullscreenButton=re.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);re.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",b).setAttribute("aria-hidden","true"),b.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const b=this._getTitle();this._fullscreenButton.setAttribute("aria-label",b),this._fullscreenButton.title=b}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends g.Evented{constructor(b){super(),this.options=g.extend(Object.create(zt),b),g.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(b){return this._map&&this.remove(),this._map=b,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new g.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&re.remove(this._content),this._container&&(re.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new g.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(b){return this._lngLat=g.LngLat.convert(b),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(b){return this.setDOMContent(document.createTextNode(b))}setHTML(b){const n=document.createDocumentFragment(),h=document.createElement("body");let x;for(h.innerHTML=b;x=h.firstChild,x;)n.appendChild(x);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(b){return this.options.maxWidth=b,this._update(),this}setDOMContent(b){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=re.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(b),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(b){this._container&&this._container.classList.add(b)}removeClassName(b){this._container&&this._container.classList.remove(b)}setOffset(b){return this.options.offset=b,this._update(),this}toggleClassName(b){if(this._container)return this._container.classList.toggle(b)}_createCloseButton(){this.options.closeButton&&(this._closeButton=re.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(b){this._update(b.point)}_onMouseMove(b){this._update(b.point)}_onDrag(b){this._update(b.point)}_update(b){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=re.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=re.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(z=>this._container.classList.add(z)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Gt(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!b))return;const n=this._pos=this._trackPointer&&b?b:this._map.project(this._lngLat);let h=this.options.anchor;const x=Yr(this.options.offset);if(!h){const z=this._container.offsetWidth,R=this._container.offsetHeight;let V;V=n.y+x.bottom.y<R?["top"]:n.y>this._map.transform.height-R?["bottom"]:[],n.x<z/2?V.push("left"):n.x>this._map.transform.width-z/2&&V.push("right"),h=V.length===0?"bottom":V.join("-")}const E=n.add(x[h]).round();re.setTransform(this._container,`${At[h]} translate(${E.x}px,${E.y}px)`),lo(this._container,h,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const b=this._container.querySelector(ul);b&&b.focus()}_onClose(){this.remove()}},Marker:Gn,Style:Xi,LngLat:g.LngLat,LngLatBounds:g.LngLatBounds,Point:g.pointGeometry,MercatorCoordinate:g.MercatorCoordinate,Evented:g.Evented,AJAXError:g.AJAXError,config:g.config,CanvasSource:$r,GeoJSONSource:Vr,ImageSource:cn,RasterDEMTileSource:Dr,RasterTileSource:un,VectorTileSource:Lr,VideoSource:oi,prewarm:function(){Wr().acquire(Sn)},clearPrewarmedResources:function(){const b=vo;b&&(b.isPreloaded()&&b.numActive()===1?(b.release(Sn),vo=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get workerCount(){return ko.workerCount},set workerCount(b){ko.workerCount=b},get maxParallelImageRequests(){return g.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(b){g.config.MAX_PARALLEL_IMAGE_REQUESTS=b},clearStorage(b){g.clearTileCache(b)},workerUrl:"",addProtocol(b,n){g.config.REGISTERED_PROTOCOLS[b]=n},removeProtocol(b){delete g.config.REGISTERED_PROTOCOLS[b]}};return mr.extend(Yn,{isSafari:g.isSafari,getPerformanceMetrics:g.PerformanceUtils.getPerformanceMetrics}),Yn});var m=U;return m})})(th);var fv=th.exports,qh=gv,mv=Object.prototype.hasOwnProperty;function gv(){for(var A={},w=0;w<arguments.length;w++){var C=arguments[w];for(var D in C)mv.call(C,D)&&(A[D]=C[D])}return A}var Cg={exports:{}};(function(A,w){(function(){var C={};A.exports=C,C.simpleFilter=function(D,U){return U.filter(function(H){return C.test(D,H)})},C.test=function(D,U){return C.match(D,U)!==null},C.match=function(D,U,H){H=H||{};var m=0,g=[],Z=U.length,ve=0,he=0,ye=H.pre||"",re=H.post||"",it=H.caseSensitive&&U||U.toLowerCase(),et;D=H.caseSensitive&&D||D.toLowerCase();for(var St=0;St<Z;St++)et=U[St],it[St]===D[m]?(et=ye+et+re,m+=1,he+=1+he):he=0,ve+=he,g[g.length]=et;return m===D.length?(ve=it===D?1/0:ve,{rendered:g.join(""),score:ve}):null},C.filter=function(D,U,H){return!U||U.length===0?[]:typeof D!="string"?U:(H=H||{},U.reduce(function(m,g,Z,ve){var he=g;H.extract&&(he=H.extract(g));var ye=C.match(D,he,H);return ye!=null&&(m[m.length]={string:ye.rendered,score:ye.score,index:Z,original:g}),m},[]).sort(function(m,g){var Z=g.score-m.score;return Z||m.index-g.index}))}})()})(Cg);var Qa=function(A){return this.component=A,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,A.el.parentNode.insertBefore(this.wrapper,A.el.nextSibling),this};Qa.prototype.show=function(){this.element.style.display="block"};Qa.prototype.hide=function(){this.element.style.display="none"};Qa.prototype.add=function(A){this.items.push(A)};Qa.prototype.clear=function(){this.items=[],this.active=0};Qa.prototype.isEmpty=function(){return!this.items.length};Qa.prototype.isVisible=function(){return this.element.style.display==="block"};Qa.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var A=0;A<this.items.length;A++)this.drawItem(this.items[A],this.active===A);this.show()};Qa.prototype.drawItem=function(A,w){var C=document.createElement("li"),D=document.createElement("a");w&&(C.className+=" active"),D.innerHTML=A.string,C.appendChild(D),this.element.appendChild(C),C.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),C.addEventListener("mouseup",function(){this.handleMouseUp.call(this,A)}.bind(this))};Qa.prototype.handleMouseUp=function(A){this.selectingListItem=!1,this.component.value(A.original),this.clear(),this.draw()};Qa.prototype.move=function(A){this.active=A,this.draw()};Qa.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};Qa.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};Qa.prototype.drawError=function(A){var w=document.createElement("li");w.innerHTML=A,this.element.appendChild(w),this.show()};var yv=Qa,_v=qh,vv=Cg.exports,xv=yv,da=function(A,w,C){return C=C||{},this.options=_v({minLength:2,limit:5,filter:!0,hideOnBlur:!0},C),this.el=A,this.data=w||[],this.list=new xv(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(D){this.handleKeyUp(D.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(D){this.handleKeyDown(D)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(D){this.handlePaste(D)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};da.prototype.handleKeyUp=function(A){A===40||A===38||A===27||A===13||A===9||this.handleInputChange(this.el.value)};da.prototype.handleKeyDown=function(A){switch(A.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&A.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};da.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};da.prototype.handlePaste=function(A){if(A.clipboardData)this.handleInputChange(A.clipboardData.getData("Text"));else{var w=this;setTimeout(function(){w.handleInputChange(A.target.value)},100)}};da.prototype.handleInputChange=function(A){if(this.query=this.normalize(A),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates(function(w){for(var C=0;C<w.length&&(this.list.add(w[C]),C!==this.options.limit-1);C++);this.list.draw()}.bind(this))};da.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};da.prototype.update=function(A){this.data=A,this.handleKeyUp()};da.prototype.clear=function(){this.data=[],this.list.clear()};da.prototype.normalize=function(A){return A=A.toLowerCase(),A};da.prototype.match=function(A,w){return A.indexOf(w)>-1};da.prototype.value=function(A){if(this.selected=A,this.el.value=this.getItemValue(A),document.createEvent){var w=document.createEvent("HTMLEvents");w.initEvent("change",!0,!1),this.el.dispatchEvent(w)}else this.el.fireEvent("onchange")};da.prototype.getCandidates=function(A){var w={pre:"<strong>",post:"</strong>",extract:function(D){return this.getItemValue(D)}.bind(this)},C;this.options.filter?(C=vv.filter(this.query,this.data,w),C=C.map(function(D){return{original:D.original,string:this.render(D.original,D.string)}}.bind(this))):C=this.data.map(function(D){var U=this.render(D);return{original:D,string:U}}.bind(this)),A(C)};da.prototype.getItemValue=function(A){return A};da.prototype.render=function(A,w){if(w)return w;for(var C=A.original?this.getItemValue(A.original):this.getItemValue(A),D=this.normalize(C),U=D.lastIndexOf(this.query);U>-1;){var H=U+this.query.length;C=C.slice(0,U)+"<strong>"+C.slice(U,H)+"</strong>"+C.slice(H),U=D.slice(0,U).lastIndexOf(this.query)}return C};da.prototype.renderError=function(A){this.list.drawError(A)};var bv=da,zg=bv,wv=zg;typeof window!="undefined"&&(window.Suggestions=zg);var Ev="Expected a function",ig=0/0,Sv="[object Symbol]",Tv=/^\s+|\s+$/g,Av=/^[-+]0x[0-9a-f]+$/i,Iv=/^0b[01]+$/i,Cv=/^0o[0-7]+$/i,zv=parseInt,Pv=typeof js=="object"&&js&&js.Object===Object&&js,kv=typeof self=="object"&&self&&self.Object===Object&&self,Mv=Pv||kv||Function("return this")(),Lv=Object.prototype,Dv=Lv.toString,Rv=Math.max,Bv=Math.min,Mf=function(){return Mv.Date.now()};function Ov(A,w,C){var D,U,H,m,g,Z,ve=0,he=!1,ye=!1,re=!0;if(typeof A!="function")throw new TypeError(Ev);w=rg(w)||0,$f(C)&&(he=!!C.leading,ye="maxWait"in C,H=ye?Rv(rg(C.maxWait)||0,w):H,re="trailing"in C?!!C.trailing:re);function it(Zt){var si=D,Wi=U;return D=U=void 0,ve=Zt,m=A.apply(Wi,si),m}function et(Zt){return ve=Zt,g=setTimeout(Xt,w),he?it(Zt):m}function St(Zt){var si=Zt-Z,Wi=Zt-ve,Gi=w-si;return ye?Bv(Gi,H-Wi):Gi}function vt(Zt){var si=Zt-Z,Wi=Zt-ve;return Z===void 0||si>=w||si<0||ye&&Wi>=H}function Xt(){var Zt=Mf();if(vt(Zt))return Wt(Zt);g=setTimeout(Xt,St(Zt))}function Wt(Zt){return g=void 0,re&&D?it(Zt):(D=U=void 0,m)}function _t(){g!==void 0&&clearTimeout(g),ve=0,D=Z=U=g=void 0}function ui(){return g===void 0?m:Wt(Mf())}function qt(){var Zt=Mf(),si=vt(Zt);if(D=arguments,U=this,Z=Zt,si){if(g===void 0)return et(Z);if(ye)return g=setTimeout(Xt,w),it(Z)}return g===void 0&&(g=setTimeout(Xt,w)),m}return qt.cancel=_t,qt.flush=ui,qt}function $f(A){var w=typeof A;return!!A&&(w=="object"||w=="function")}function Fv(A){return!!A&&typeof A=="object"}function Uv(A){return typeof A=="symbol"||Fv(A)&&Dv.call(A)==Sv}function rg(A){if(typeof A=="number")return A;if(Uv(A))return ig;if($f(A)){var w=typeof A.valueOf=="function"?A.valueOf():A;A=$f(w)?w+"":w}if(typeof A!="string")return A===0?A:+A;A=A.replace(Tv,"");var C=Iv.test(A);return C||Cv.test(A)?zv(A.slice(2),C?2:8):Av.test(A)?ig:+A}var Vv=Ov,rm={exports:{}},Fh=typeof Reflect=="object"?Reflect:null,ng=Fh&&typeof Fh.apply=="function"?Fh.apply:function(w,C,D){return Function.prototype.apply.call(w,C,D)},vd;Fh&&typeof Fh.ownKeys=="function"?vd=Fh.ownKeys:Object.getOwnPropertySymbols?vd=function(w){return Object.getOwnPropertyNames(w).concat(Object.getOwnPropertySymbols(w))}:vd=function(w){return Object.getOwnPropertyNames(w)};function Nv(A){console&&console.warn&&console.warn(A)}var Pg=Number.isNaN||function(w){return w!==w};function Xr(){Xr.init.call(this)}rm.exports=Xr;rm.exports.once=Zv;Xr.EventEmitter=Xr;Xr.prototype._events=void 0;Xr.prototype._eventsCount=0;Xr.prototype._maxListeners=void 0;var og=10;function zd(A){if(typeof A!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof A)}Object.defineProperty(Xr,"defaultMaxListeners",{enumerable:!0,get:function(){return og},set:function(A){if(typeof A!="number"||A<0||Pg(A))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+A+".");og=A}});Xr.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Xr.prototype.setMaxListeners=function(w){if(typeof w!="number"||w<0||Pg(w))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+w+".");return this._maxListeners=w,this};function kg(A){return A._maxListeners===void 0?Xr.defaultMaxListeners:A._maxListeners}Xr.prototype.getMaxListeners=function(){return kg(this)};Xr.prototype.emit=function(w){for(var C=[],D=1;D<arguments.length;D++)C.push(arguments[D]);var U=w==="error",H=this._events;if(H!==void 0)U=U&&H.error===void 0;else if(!U)return!1;if(U){var m;if(C.length>0&&(m=C[0]),m instanceof Error)throw m;var g=new Error("Unhandled error."+(m?" ("+m.message+")":""));throw g.context=m,g}var Z=H[w];if(Z===void 0)return!1;if(typeof Z=="function")ng(Z,this,C);else for(var ve=Z.length,he=Bg(Z,ve),D=0;D<ve;++D)ng(he[D],this,C);return!0};function Mg(A,w,C,D){var U,H,m;if(zd(C),H=A._events,H===void 0?(H=A._events=Object.create(null),A._eventsCount=0):(H.newListener!==void 0&&(A.emit("newListener",w,C.listener?C.listener:C),H=A._events),m=H[w]),m===void 0)m=H[w]=C,++A._eventsCount;else if(typeof m=="function"?m=H[w]=D?[C,m]:[m,C]:D?m.unshift(C):m.push(C),U=kg(A),U>0&&m.length>U&&!m.warned){m.warned=!0;var g=new Error("Possible EventEmitter memory leak detected. "+m.length+" "+String(w)+" listeners added. Use emitter.setMaxListeners() to increase limit");g.name="MaxListenersExceededWarning",g.emitter=A,g.type=w,g.count=m.length,Nv(g)}return A}Xr.prototype.addListener=function(w,C){return Mg(this,w,C,!1)};Xr.prototype.on=Xr.prototype.addListener;Xr.prototype.prependListener=function(w,C){return Mg(this,w,C,!0)};function jv(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Lg(A,w,C){var D={fired:!1,wrapFn:void 0,target:A,type:w,listener:C},U=jv.bind(D);return U.listener=C,D.wrapFn=U,U}Xr.prototype.once=function(w,C){return zd(C),this.on(w,Lg(this,w,C)),this};Xr.prototype.prependOnceListener=function(w,C){return zd(C),this.prependListener(w,Lg(this,w,C)),this};Xr.prototype.removeListener=function(w,C){var D,U,H,m,g;if(zd(C),U=this._events,U===void 0)return this;if(D=U[w],D===void 0)return this;if(D===C||D.listener===C)--this._eventsCount===0?this._events=Object.create(null):(delete U[w],U.removeListener&&this.emit("removeListener",w,D.listener||C));else if(typeof D!="function"){for(H=-1,m=D.length-1;m>=0;m--)if(D[m]===C||D[m].listener===C){g=D[m].listener,H=m;break}if(H<0)return this;H===0?D.shift():qv(D,H),D.length===1&&(U[w]=D[0]),U.removeListener!==void 0&&this.emit("removeListener",w,g||C)}return this};Xr.prototype.off=Xr.prototype.removeListener;Xr.prototype.removeAllListeners=function(w){var C,D,U;if(D=this._events,D===void 0)return this;if(D.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):D[w]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete D[w]),this;if(arguments.length===0){var H=Object.keys(D),m;for(U=0;U<H.length;++U)m=H[U],m!=="removeListener"&&this.removeAllListeners(m);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(C=D[w],typeof C=="function")this.removeListener(w,C);else if(C!==void 0)for(U=C.length-1;U>=0;U--)this.removeListener(w,C[U]);return this};function Dg(A,w,C){var D=A._events;if(D===void 0)return[];var U=D[w];return U===void 0?[]:typeof U=="function"?C?[U.listener||U]:[U]:C?Gv(U):Bg(U,U.length)}Xr.prototype.listeners=function(w){return Dg(this,w,!0)};Xr.prototype.rawListeners=function(w){return Dg(this,w,!1)};Xr.listenerCount=function(A,w){return typeof A.listenerCount=="function"?A.listenerCount(w):Rg.call(A,w)};Xr.prototype.listenerCount=Rg;function Rg(A){var w=this._events;if(w!==void 0){var C=w[A];if(typeof C=="function")return 1;if(C!==void 0)return C.length}return 0}Xr.prototype.eventNames=function(){return this._eventsCount>0?vd(this._events):[]};function Bg(A,w){for(var C=new Array(w),D=0;D<w;++D)C[D]=A[D];return C}function qv(A,w){for(;w+1<A.length;w++)A[w]=A[w+1];A.pop()}function Gv(A){for(var w=new Array(A.length),C=0;C<w.length;++C)w[C]=A[C].listener||A[C];return w}function Zv(A,w){return new Promise(function(C,D){function U(m){A.removeListener(w,H),D(m)}function H(){typeof A.removeListener=="function"&&A.removeListener("error",U),C([].slice.call(arguments))}Og(A,w,H,{once:!0}),w!=="error"&&Xv(A,U,{once:!0})})}function Xv(A,w,C){typeof A.on=="function"&&Og(A,"error",w,C)}function Og(A,w,C,D){if(typeof A.on=="function")D.once?A.once(w,C):A.on(w,C);else if(typeof A.addEventListener=="function")A.addEventListener(w,function U(H){D.once&&A.removeEventListener(w,U),C(H)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof A)}var $v={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function Hv(A){var w=A.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return w?{key:w[1],value:w[2]}:null}function Wv(A){var w=A.match(/<?([^>]*)>(.*)/);if(!w)return null;var C=w[1],D=w[2].split(";"),U=null,H=D.reduce(function(m,g){var Z=Hv(g);return Z?Z.key==="rel"?(U||(U=Z.value),m):(m[Z.key]=Z.value,m):m},{});return U?{url:C,rel:U,params:H}:null}function Kv(A){return A?A.split(/,\s*</).reduce(function(w,C){var D=Wv(C);if(!D)return w;var U=D.rel.split(/\s+/);return U.forEach(function(H){w[H]||(w[H]={url:D.url,params:D.params})}),w},{}):{}}var Jv=Kv,Yv=Jv;function nm(A,w){this.request=A,this.headers=w.headers,this.rawBody=w.body,this.statusCode=w.statusCode;try{this.body=JSON.parse(w.body||"{}")}catch{this.body=w.body}this.links=Yv(this.headers.link)}nm.prototype.hasNextPage=function(){return!!this.links.next};nm.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var Qv=nm,Pd={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},ag=Pd;function ex(A){var w=A.type||ag.ERROR_HTTP,C;if(A.body)try{C=JSON.parse(A.body)}catch{C=A.body}else C=null;var D=A.message||null;D||(typeof C=="string"?D=C:C&&typeof C.message=="string"?D=C.message:w===ag.ERROR_REQUEST_ABORTED&&(D="Request aborted")),this.message=D,this.type=w,this.statusCode=A.statusCode||null,this.request=A.request,this.body=C}var tx=ex;function ix(A){var w=A.indexOf(":"),C=A.substring(0,w).trim().toLowerCase(),D=A.substring(w+1).trim();return{name:C,value:D}}function rx(A){var w={};return A&&A.trim().split(/[\r|\n]+/).forEach(function(C){var D=ix(C);w[D.name]=D.value}),w}var nx=rx,ox=Qv,sg=tx,Lf=Pd,ax=nx,Sd={};function sx(A){var w=Sd[A.id];!w||(w.abort(),delete Sd[A.id])}function lx(A,w){return new ox(A,{body:w.response,headers:ax(w.getAllResponseHeaders()),statusCode:w.status})}function lg(A){var w=A.total,C=A.loaded,D=100*C/w;return{total:w,transferred:C,percent:D}}function Fg(A,w){return new Promise(function(C,D){w.onprogress=function(m){A.emitter.emit(Lf.EVENT_PROGRESS_DOWNLOAD,lg(m))};var U=A.file;U&&(w.upload.onprogress=function(m){A.emitter.emit(Lf.EVENT_PROGRESS_UPLOAD,lg(m))}),w.onerror=function(m){D(m)},w.onabort=function(){var m=new sg({request:A,type:Lf.ERROR_REQUEST_ABORTED});D(m)},w.onload=function(){if(delete Sd[A.id],w.status<200||w.status>=400){var m=new sg({request:A,body:w.response,statusCode:w.status});D(m);return}C(w)};var H=A.body;typeof H=="string"?w.send(H):H?w.send(JSON.stringify(H)):U?w.send(U):w.send(),Sd[A.id]=w}).then(function(C){return lx(A,C)})}function Ug(A,w){var C=A.url(w),D=new window.XMLHttpRequest;return D.open(A.method,C),Object.keys(A.headers).forEach(function(U){D.setRequestHeader(U,A.headers[U])}),D}function ux(A){return Promise.resolve().then(function(){var w=Ug(A,A.client.accessToken);return Fg(A,w)})}var cx={browserAbort:sx,sendRequestXhr:Fg,browserSend:ux,createRequestXhr:Ug},Hf={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */(function(A,w){(function(C){var D=w,U=A&&A.exports==D&&A,H=typeof js=="object"&&js;(H.global===H||H.window===H)&&(C=H);var m=function(et){this.message=et};m.prototype=new Error,m.prototype.name="InvalidCharacterError";var g=function(et){throw new m(et)},Z="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ve=/[\t\n\f\r ]/g,he=function(et){et=String(et).replace(ve,"");var St=et.length;St%4==0&&(et=et.replace(/==?$/,""),St=et.length),(St%4==1||/[^+a-zA-Z0-9/]/.test(et))&&g("Invalid character: the string to be decoded is not correctly encoded.");for(var vt=0,Xt,Wt,_t="",ui=-1;++ui<St;)Wt=Z.indexOf(et.charAt(ui)),Xt=vt%4?Xt*64+Wt:Wt,vt++%4&&(_t+=String.fromCharCode(255&Xt>>(-2*vt&6)));return _t},ye=function(et){et=String(et),/[^\0-\xFF]/.test(et)&&g("The string to be encoded contains characters outside of the Latin1 range.");for(var St=et.length%3,vt="",Xt=-1,Wt,_t,ui,qt,Zt=et.length-St;++Xt<Zt;)Wt=et.charCodeAt(Xt)<<16,_t=et.charCodeAt(++Xt)<<8,ui=et.charCodeAt(++Xt),qt=Wt+_t+ui,vt+=Z.charAt(qt>>18&63)+Z.charAt(qt>>12&63)+Z.charAt(qt>>6&63)+Z.charAt(qt&63);return St==2?(Wt=et.charCodeAt(Xt)<<8,_t=et.charCodeAt(++Xt),qt=Wt+_t,vt+=Z.charAt(qt>>10)+Z.charAt(qt>>4&63)+Z.charAt(qt<<2&63)+"="):St==1&&(qt=et.charCodeAt(Xt),vt+=Z.charAt(qt>>2)+Z.charAt(qt<<4&63)+"=="),vt},re={encode:ye,decode:he,version:"0.1.0"};if(D&&!D.nodeType)if(U)U.exports=re;else for(var it in re)re.hasOwnProperty(it)&&(D[it]=re[it]);else C.base64=re})(js)})(Hf,Hf.exports);var hx=Hf.exports,Df={};function px(A){if(Df[A])return Df[A];var w=A.split("."),C=w[0],D=w[1];if(!D)throw new Error("Invalid token");var U=dx(D),H={usage:C,user:U.u};return Qc(U,"a")&&(H.authorization=U.a),Qc(U,"exp")&&(H.expires=U.exp*1e3),Qc(U,"iat")&&(H.created=U.iat*1e3),Qc(U,"scopes")&&(H.scopes=U.scopes),Qc(U,"client")&&(H.client=U.client),Qc(U,"ll")&&(H.lastLogin=U.ll),Qc(U,"iu")&&(H.impersonator=U.iu),Df[A]=H,H}function dx(A){try{return JSON.parse(hx.decode(A))}catch{throw new Error("Invalid token")}}function Qc(A,w){return Object.prototype.hasOwnProperty.call(A,w)}var Vg=px,Ng={exports:{}};(function(A){var w=Object.prototype.hasOwnProperty,C="~";function D(){}Object.create&&(D.prototype=Object.create(null),new D().__proto__||(C=!1));function U(Z,ve,he){this.fn=Z,this.context=ve,this.once=he||!1}function H(Z,ve,he,ye,re){if(typeof he!="function")throw new TypeError("The listener must be a function");var it=new U(he,ye||Z,re),et=C?C+ve:ve;return Z._events[et]?Z._events[et].fn?Z._events[et]=[Z._events[et],it]:Z._events[et].push(it):(Z._events[et]=it,Z._eventsCount++),Z}function m(Z,ve){--Z._eventsCount===0?Z._events=new D:delete Z._events[ve]}function g(){this._events=new D,this._eventsCount=0}g.prototype.eventNames=function(){var ve=[],he,ye;if(this._eventsCount===0)return ve;for(ye in he=this._events)w.call(he,ye)&&ve.push(C?ye.slice(1):ye);return Object.getOwnPropertySymbols?ve.concat(Object.getOwnPropertySymbols(he)):ve},g.prototype.listeners=function(ve){var he=C?C+ve:ve,ye=this._events[he];if(!ye)return[];if(ye.fn)return[ye.fn];for(var re=0,it=ye.length,et=new Array(it);re<it;re++)et[re]=ye[re].fn;return et},g.prototype.listenerCount=function(ve){var he=C?C+ve:ve,ye=this._events[he];return ye?ye.fn?1:ye.length:0},g.prototype.emit=function(ve,he,ye,re,it,et){var St=C?C+ve:ve;if(!this._events[St])return!1;var vt=this._events[St],Xt=arguments.length,Wt,_t;if(vt.fn){switch(vt.once&&this.removeListener(ve,vt.fn,void 0,!0),Xt){case 1:return vt.fn.call(vt.context),!0;case 2:return vt.fn.call(vt.context,he),!0;case 3:return vt.fn.call(vt.context,he,ye),!0;case 4:return vt.fn.call(vt.context,he,ye,re),!0;case 5:return vt.fn.call(vt.context,he,ye,re,it),!0;case 6:return vt.fn.call(vt.context,he,ye,re,it,et),!0}for(_t=1,Wt=new Array(Xt-1);_t<Xt;_t++)Wt[_t-1]=arguments[_t];vt.fn.apply(vt.context,Wt)}else{var ui=vt.length,qt;for(_t=0;_t<ui;_t++)switch(vt[_t].once&&this.removeListener(ve,vt[_t].fn,void 0,!0),Xt){case 1:vt[_t].fn.call(vt[_t].context);break;case 2:vt[_t].fn.call(vt[_t].context,he);break;case 3:vt[_t].fn.call(vt[_t].context,he,ye);break;case 4:vt[_t].fn.call(vt[_t].context,he,ye,re);break;default:if(!Wt)for(qt=1,Wt=new Array(Xt-1);qt<Xt;qt++)Wt[qt-1]=arguments[qt];vt[_t].fn.apply(vt[_t].context,Wt)}}return!0},g.prototype.on=function(ve,he,ye){return H(this,ve,he,ye,!1)},g.prototype.once=function(ve,he,ye){return H(this,ve,he,ye,!0)},g.prototype.removeListener=function(ve,he,ye,re){var it=C?C+ve:ve;if(!this._events[it])return this;if(!he)return m(this,it),this;var et=this._events[it];if(et.fn)et.fn===he&&(!re||et.once)&&(!ye||et.context===ye)&&m(this,it);else{for(var St=0,vt=[],Xt=et.length;St<Xt;St++)(et[St].fn!==he||re&&!et[St].once||ye&&et[St].context!==ye)&&vt.push(et[St]);vt.length?this._events[it]=vt.length===1?vt[0]:vt:m(this,it)}return this},g.prototype.removeAllListeners=function(ve){var he;return ve?(he=C?C+ve:ve,this._events[he]&&m(this,he)):(this._events=new D,this._eventsCount=0),this},g.prototype.off=g.prototype.removeListener,g.prototype.addListener=g.prototype.on,g.prefixed=C,g.EventEmitter=g,A.exports=g})(Ng);function fx(A){return A.map(encodeURIComponent).join(",")}function jg(A){return Array.isArray(A)?fx(A):encodeURIComponent(String(A))}function qg(A,w,C){if(C===!1||C===null)return A;var D=/\?/.test(A)?"&":"?",U=encodeURIComponent(w);return C!==void 0&&C!==""&&C!==!0&&(U+="="+jg(C)),""+A+D+U}function mx(A,w){if(!w)return A;var C=A;return Object.keys(w).forEach(function(D){var U=w[D];U!==void 0&&(Array.isArray(U)&&(U=U.filter(function(H){return H!=null}).join(",")),C=qg(C,D,U))}),C}function gx(A,w){if(!w||A.slice(0,4)==="http")return A;var C=A[0]==="/"?"":"/";return""+w.replace(/\/$/,"")+C+A}function yx(A,w){return w?A.replace(/\/:([a-zA-Z0-9]+)/g,function(C,D){var U=w[D];if(U===void 0)throw new Error("Unspecified route parameter "+D);var H=jg(U);return"/"+H}):A}var _x={appendQueryObject:mx,appendQueryParam:qg,prependOrigin:gx,interpolateRouteParams:yx},vx=Vg,om=qh,xx=Ng.exports,fd=_x,ug=Pd,bx=1;function Tc(A,w){if(!A)throw new Error("MapiRequest requires a client");if(!w||!w.path||!w.method)throw new Error("MapiRequest requires an options object with path and method properties");var C={};w.body&&(C["content-type"]="application/json");var D=om(C,w.headers),U=Object.keys(D).reduce(function(H,m){return H[m.toLowerCase()]=D[m],H},{});this.id=bx++,this._options=w,this.emitter=new xx,this.client=A,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=w.path,this.method=w.method,this.origin=w.origin||A.origin,this.query=w.query||{},this.params=w.params||{},this.body=w.body||null,this.file=w.file||null,this.encoding=w.encoding||"utf8",this.sendFileAs=w.sendFileAs||null,this.headers=U}Tc.prototype.url=function(w){var C=fd.prependOrigin(this.path,this.origin);C=fd.appendQueryObject(C,this.query);var D=this.params,U=w==null?this.client.accessToken:w;if(U){C=fd.appendQueryParam(C,"access_token",U);var H=vx(U).user;D=om({ownerId:H},D)}return C=fd.interpolateRouteParams(C,D),C};Tc.prototype.send=function(){var w=this;if(w.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return w.sent=!0,w.client.sendRequest(w).then(function(C){return w.response=C,w.emitter.emit(ug.EVENT_RESPONSE,C),C},function(C){throw w.error=C,w.emitter.emit(ug.EVENT_ERROR,C),C})};Tc.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};Tc.prototype.eachPage=function(w){var C=this;function D(m){function g(){delete C._nextPageRequest;var Z=m.nextPage();Z&&(C._nextPageRequest=Z,H(Z))}w(null,m,g)}function U(m){w(m,null,function(){})}function H(m){m.send().then(D,U)}H(this)};Tc.prototype.clone=function(){return this._extend()};Tc.prototype._extend=function(w){var C=om(this._options,w);return new Tc(this.client,C)};var wx=Tc,Ex=Vg,Sx=wx,Tx=Pd;function Gg(A){if(!A||!A.accessToken)throw new Error("Cannot create a client without an access token");Ex(A.accessToken),this.accessToken=A.accessToken,this.origin=A.origin||Tx.API_ORIGIN}Gg.prototype.createRequest=function(w){return new Sx(this,w)};var Zg=Gg,Xg=cx,$g=Zg;function Vh(A){$g.call(this,A)}Vh.prototype=Object.create($g.prototype);Vh.prototype.constructor=Vh;Vh.prototype.sendRequest=Xg.browserSend;Vh.prototype.abortRequest=Xg.browserAbort;function Ax(A){return new Vh(A)}var Hg=Ax,Ix=Hg,Cx=Ix,zx=Object.prototype.toString,Px=function(A){var w;return zx.call(A)==="[object Object]"&&(w=Object.getPrototypeOf(A),w===null||w===Object.getPrototypeOf({}))},kx=Px,Mx=qh,Wg="value",Rf=`
  `,ln={};ln.assert=function(A,w){return w=w||{},function(C){var D=Ac(A,C);if(!!D){var U=am(D,w);throw w.apiName&&(U=w.apiName+": "+U),new Error(U)}}};ln.shape=function(w){var C=Bx(w);return function(U){var H=Ac(ln.plainObject,U);if(H)return H;for(var m,g,Z=[],ve=0;ve<C.length;ve++)m=C[ve].key,g=C[ve].value,H=Ac(g,U[m]),H&&Z.push([m].concat(H));return Z.length<2?Z[0]:function(he){Z=Z.map(function(it){var et=it[0],St=am(it,he).split(`
`).join(Rf);return"- "+et+": "+St});var ye=he.path.join("."),re=ye===Wg?"":" of "+ye;return"The following properties"+re+" have invalid values:"+Rf+Z.join(Rf)}}};ln.strictShape=function(w){var C=ln.shape(w);return function(U){var H=C(U);if(H)return H;var m=Object.keys(U).reduce(function(g,Z){return w[Z]===void 0&&g.push(Z),g},[]);if(m.length!==0)return function(){return"The following keys are invalid: "+m.join(", ")}}};ln.arrayOf=function(w){return Kg(w)};ln.tuple=function(){var w=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return Kg(w)};function Kg(A){var w=Array.isArray(A),C=function(D){return w?A[D]:A};return function(U){var H=Ac(ln.plainArray,U);if(H)return H;if(w&&U.length!==A.length)return"an array with "+A.length+" items";for(var m=0;m<U.length;m++)if(H=Ac(C(m),U[m]),H)return[m].concat(H)}}ln.required=function(w){function C(D){return D==null?function(U){return Jg(U,Yg(U.path)?"cannot be undefined/null.":"is required.")}:w.apply(this,arguments)}return C.__required=!0,C};ln.oneOfType=function(){var w=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(D){var U=w.map(function(H){return Ac(H,D)}).filter(Boolean);if(U.length===w.length)return U.every(function(H){return H.length===1&&typeof H[0]=="string"})?Lx(U.map(function(H){return H[0]})):U.reduce(function(H,m){return m.length>H.length?m:H})}};ln.equal=function(w){return function(D){if(D!==w)return JSON.stringify(w)}};ln.oneOf=function(){var w=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),C=w.map(function(D){return ln.equal(D)});return ln.oneOfType.apply(this,C)};ln.range=function(w){var C=w[0],D=w[1];return function(H){var m=Ac(ln.number,H);if(m||H<C||H>D)return"number between "+C+" & "+D+" (inclusive)"}};ln.any=function(){};ln.boolean=function(w){if(typeof w!="boolean")return"boolean"};ln.number=function(w){if(typeof w!="number")return"number"};ln.plainArray=function(w){if(!Array.isArray(w))return"array"};ln.plainObject=function(w){if(!kx(w))return"object"};ln.string=function(w){if(typeof w!="string")return"string"};ln.func=function(w){if(typeof w!="function")return"function"};function Ac(A,w){if(!(w==null&&!A.hasOwnProperty("__required"))){var C=A(w);if(C)return Array.isArray(C)?C:[C]}}function am(A,w){var C=A.length,D=A[C-1],U=A.slice(0,C-1);return U.length===0&&(U=[Wg]),w=Mx(w,{path:U}),typeof D=="function"?D(w):Jg(w,Dx(D))}function Lx(A){return A.length<2?A[0]:A.length===2?A.join(" or "):A.slice(0,-1).join(", ")+", or "+A.slice(-1)}function Dx(A){return"must be "+Rx(A)+"."}function Rx(A){return/^an? /.test(A)?A:/^[aeiou]/i.test(A)?"an "+A:/^[a-z]/i.test(A)?"a "+A:A}function Jg(A,w){var C=Yg(A.path),D=A.path.join(".")+" "+w,U=C?"Item at position ":"";return U+D}function Yg(A){return typeof A[A.length-1]=="number"||typeof A[0]=="number"}function Bx(A){return Object.keys(A||{}).map(function(w){return{key:w,value:A[w]}})}ln.validate=Ac;ln.processMessage=am;var Ox=ln,Fx=qh,Uh=Ox;function Ux(A){if(typeof window!="undefined")return A instanceof js.Blob||A instanceof js.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof A=="string"||A.pipe!==void 0))return"Filename or Readable stream"}function Vx(A,w){return Uh.assert(Uh.strictShape(A),w)}function Nx(A){var w="date";if(typeof A=="boolean")return w;try{var C=new Date(A);if(C.getTime&&isNaN(C.getTime()))return w}catch{return w}}function jx(A){return Uh.tuple(Uh.number,Uh.number)(A)}var qx=Fx(Uh,{file:Ux,date:Nx,coordinates:jx,assertShape:Vx});function Gx(A,w){var C=function(D,U){return w.indexOf(D)!==-1&&U!==void 0};return typeof w=="function"&&(C=w),Object.keys(A).filter(function(D){return C(D,A[D])}).reduce(function(D,U){return D[U]=A[U],D},{})}var Zx=Gx;function Xx(A,w){return Object.keys(A).reduce(function(C,D){return C[D]=w(D,A[D]),C},{})}var $x=Xx,Hx=$x;function Wx(A){return Hx(A,function(w,C){return typeof C=="boolean"?JSON.stringify(C):C})}var Kx=Wx,Jx=Zg,Yx=Hg;function Qx(A){return function(w){var C;Jx.prototype.isPrototypeOf(w)?C=w:C=Yx(w);var D=Object.create(A);return D.client=C,D}}var e0=Qx,Qg=qh,fr=qx,Td=Zx,ey=Kx,t0=e0,sm={},ty=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];sm.forwardGeocode=function(A){fr.assertShape({query:fr.required(fr.string),mode:fr.oneOf("mapbox.places","mapbox.places-permanent"),countries:fr.arrayOf(fr.string),proximity:fr.oneOf(fr.coordinates,"ip"),types:fr.arrayOf(fr.oneOf(ty)),autocomplete:fr.boolean,bbox:fr.arrayOf(fr.number),limit:fr.number,language:fr.arrayOf(fr.string),routing:fr.boolean,fuzzyMatch:fr.boolean,worldview:fr.string})(A),A.mode=A.mode||"mapbox.places";var w=ey(Qg({country:A.countries},Td(A,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:Td(A,["mode","query"]),query:w})};sm.reverseGeocode=function(A){fr.assertShape({query:fr.required(fr.coordinates),mode:fr.oneOf("mapbox.places","mapbox.places-permanent"),countries:fr.arrayOf(fr.string),types:fr.arrayOf(fr.oneOf(ty)),bbox:fr.arrayOf(fr.number),limit:fr.number,language:fr.arrayOf(fr.string),reverseMode:fr.oneOf("distance","score"),routing:fr.boolean,worldview:fr.string})(A),A.mode=A.mode||"mapbox.places";var w=ey(Qg({country:A.countries},Td(A,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:Td(A,["mode","query"]),query:w})};var i0=t0(sm);let r0="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",iy=A=>crypto.getRandomValues(new Uint8Array(A)),ry=(A,w,C)=>{let D=(2<<Math.log(A.length-1)/Math.LN2)-1,U=-~(1.6*D*w/A.length);return(H=w)=>{let m="";for(;;){let g=C(U),Z=U;for(;Z--;)if(m+=A[g[Z]&D]||"",m.length===H)return m}}},n0=(A,w=21)=>ry(A,w,iy),o0=(A=21)=>{let w="",C=crypto.getRandomValues(new Uint8Array(A));for(;A--;){let D=C[A]&63;D<36?w+=D.toString(36):D<62?w+=(D-26).toString(36).toUpperCase():D<63?w+="_":w+="-"}return w};var a0=Object.freeze(Object.defineProperty({__proto__:null,nanoid:o0,customAlphabet:n0,customRandom:ry,urlAlphabet:r0,random:iy},Symbol.toStringTag,{value:"Module"})),s0=dv(a0),l0=s0.nanoid;function ny(A){this.origin=A.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=A.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=A,this.send=this.send.bind(this),this.countries=A.countries?A.countries.split(","):null,this.types=A.types?A.types.split(","):null,this.bbox=A.bbox?A.bbox:null,this.language=A.language?A.language.split(","):null,this.limit=A.limit?+A.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(A),this.eventQueue=new Array,this.flushInterval=A.flushInterval||1e3,this.maxQueueSize=A.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}ny.prototype={select:function(A,w){var C=this.getSelectedIndex(A,w),D=this.getEventPayload("search.select",w);if(D.resultIndex=C,D.resultPlaceName=A.place_name,D.resultId=A.id,!(C===this.lastSentIndex&&D.queryString===this.lastSentInput||C==-1)&&(this.lastSentIndex=C,this.lastSentInput=D.queryString,!!D.queryString))return this.push(D)},start:function(A){var w=this.getEventPayload("search.start",A);if(!!w.queryString)return this.push(w)},keyevent:function(A,w){if(!!A.key&&!(A.metaKey||[9,27,37,39,13,38,40].indexOf(A.keyCode)!==-1)){var C=this.getEventPayload("search.keystroke",w);if(C.lastAction=A.key,!!C.queryString)return this.push(C)}},send:function(A,w){if(!this.enableEventLogging)return w?w():void 0;var C=this.getRequestOptions(A);this.request(C,function(D){if(D)return this.handleError(D,w);if(w)return w()}.bind(this))},getRequestOptions:function(A){Array.isArray(A)||(A=[A]);var w={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(A)};return w},getEventPayload:function(A,w){var C;w.options.proximity?typeof w.options.proximity=="object"?C=[w.options.proximity.longitude,w.options.proximity.latitude]:w.options.proximity==="ip"?C=[999,999]:C=w.options.proximity:C=null;var D=w._map?w._map.getZoom():void 0,U={event:A,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:w.options.autocomplete,fuzzyMatch:w.options.fuzzyMatch,proximity:C,limit:w.options.limit,routing:w.options.routing,worldview:w.options.worldview,mapZoom:D,keyboardLocale:this.locale};return A==="search.select"?U.queryString=w.inputString:A!="search.select"&&w._inputEl?U.queryString=w._inputEl.value:U.queryString=w.inputString,U},request:function(A,w){var C=new XMLHttpRequest;C.onreadystatechange=function(){if(this.readyState==4)return this.status==204?w(null):w(this.statusText)},C.open(A.method,A.host+"/"+A.path,!0);for(var D in A.headers){var U=A.headers[D];C.setRequestHeader(D,U)}C.send(A.body)},handleError:function(A,w){if(w)return w(A)},generateSessionID:function(){return l0()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(A,w){if(!!w._typeahead){var C=w._typeahead.data,D=A.id,U=C.map(function(m){return m.id}),H=U.indexOf(D);return H}},shouldEnableLogging:function(A){return!(A.enableEventLogging===!1||A.origin&&A.origin.indexOf("api.mapbox.com")==-1||A.localGeocoder||A.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(A,w){this.eventQueue.push(A),(this.eventQueue.length>=this.maxQueueSize||w)&&this.flush()},remove:function(){this.flush()}};var u0=ny,c0={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"\u05DC\u05D7\u05E4\u05E9",ja:"\u30B5\u30FC\u30C1",lv:"Mekl\u0113t",pt:"Procurar",sr:"\u041F\u0440\u0435\u0442\u0440\u0430\u0433\u0430",zh:"\u641C\u7D22",cs:"Vyhled\xE1v\xE1n\xED",hu:"Keres\xE9s",ka:"\u10EB\u10D8\u10D4\u10D1\u10D0",nb:"S\xF8ke",sk:"Vyh\u013Ead\xE1vanie",th:"\u0E04\u0E49\u0E19\u0E2B\u0E32",fi:"Hae",is:"Leita",ko:"\uC218\uC0C9",pl:"Szukaj",sl:"Iskanje",fa:"\u062C\u0633\u062A\u062C\u0648",ru:"\u041F\u043E\u0438\u0441\u043A"},h0={placeholder:c0},oy={exports:{}};(function(A){(function(w,C,D){A.exports?A.exports=D():w[C]=D()})(js,"subtag",function(){var w="",C=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function D(Z){return Z.match(C)||[]}function U(Z){return D(Z).filter(function(ve,he){return ve&&he})}function H(Z){return Z=D(Z),{language:Z[1]||w,extlang:Z[2]||w,script:Z[3]||w,region:Z[4]||w}}function m(Z,ve,he){Object.defineProperty(Z,ve,{value:he,enumerable:!0})}function g(Z,ve,he){function ye(re){return D(re)[Z]||w}m(ye,"pattern",ve),m(H,he,ye)}return g(1,/^[a-zA-Z]{2,3}$/,"language"),g(2,/^[a-zA-Z]{3}$/,"extlang"),g(3,/^[a-zA-Z]{4}$/,"script"),g(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),m(H,"split",U),H})})(oy);function ay(){}ay.prototype={isSupport:function(){return Boolean(window.navigator.geolocation)},getCurrentPosition:function(){const A={enableHighAccuracy:!0};return new Promise(function(w,C){window.navigator.geolocation.getCurrentPosition(w,C,A)})}};var p0=ay;function d0(A,w){const C=sy(A),D=["address","street","place","country"];var U;if(typeof w=="function")return w(C);const H=D.indexOf(w);return H===-1?U=D:U=D.slice(H),U.reduce(function(m,g){return C[g]?(m!==""&&(m=m+", "),m+C[g]):m},"")}function sy(A){const w=A.address||"",C=A.text||"",D=A.place_name||"",H={address:D.split(",")[0],houseNumber:w,street:C,placeName:D};return A.context.forEach(function(m){const g=m.id.split(".")[0];H[g]=m.text}),H}var f0={transformFeatureToGeolocationText:d0,getAddressInfo:sy},m0=wv,g0=Vv,eh=qh,y0=rm.exports.EventEmitter,cg=$v,Bf=Cx,Of=i0,_0=u0,v0=h0,x0=oy.exports,b0=p0,w0=f0;const wc={FORWARD:0,LOCAL:1,REVERSE:2};function E0(){var A=document.createElement("div");return A.className="mapboxgl-ctrl-geocoder--powered-by",A.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',A}function ly(A){this._eventEmitter=new y0,this.options=eh({},this.options,A),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new b0}ly.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(A){return A.place_name},render:function(A){var w=A.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+w[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+w.splice(1,w.length).join(",")+"</div></div>"}},addTo:function(A){function w(C,D){if(!document.body.contains(D))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const U=C.onAdd();D.appendChild(U)}if(A._controlContainer)A.addControl(this);else if(A instanceof HTMLElement)w(this,A);else if(typeof A=="string"){const C=document.querySelectorAll(A);if(C.length===0)throw new Error("Element ",A,"not found.");if(C.length>1)throw new Error("Geocoder can only be added to a single html element");w(this,C[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(A){if(A&&typeof A!="string"&&(this._map=A),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=Of(Bf({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new _0(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var w=this.container=document.createElement("div");w.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var C=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",g0(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(ve){this.eventManager.keyevent(ve,this)}.bind(this));var D=document.createElement("div");D.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var U=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(U),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),D.appendChild(this._clearEl),D.appendChild(this._loadingEl),w.appendChild(C),w.appendChild(this._inputEl),w.appendChild(D),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var H=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(H),D.appendChild(this._geolocateEl),this._showGeolocateButton()}var m=this._typeahead=new m0(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),m.getItemValue=this.options.getItemValue;var g=m.list.draw,Z=this._footerNode=E0();return m.list.draw=function(){g.call(this),Z.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),Z.addEventListener("mouseup",function(){this.selectingListItem=!1}.bind(this)),this.element.appendChild(Z)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),w},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then(function(A){this._hideLoadingIcon();const w={geometry:{type:"Point",coordinates:[A.coords.longitude,A.coords.latitude]}};this._handleMarker(w),this._fly(w),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(w),this._showClearButton(),this.fresh=!1;const C={limit:1,language:[this.options.language],query:w.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const D=w.geometry.coordinates[0]+","+w.geometry.coordinates[1];this._setInputValue(D),this._eventEmitter.emit("result",{result:w})}else this.geocoderService.reverseGeocode(C).send().then(function(D){const U=D.body.features[0];if(U){const H=w0.transformFeatureToGeolocationText(U,this.options.addressAccuracy);this._setInputValue(H),U.user_coordinates=w.geometry.coordinates,this._eventEmitter.emit("result",{result:U})}else this._eventEmitter.emit("result",{result:{user_coordinates:w.geometry.coordinates}})}.bind(this))}.bind(this)).catch(function(A){A.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}.bind(this))},createIcon:function(A,w){var C=document.createElementNS("http://www.w3.org/2000/svg","svg");return C.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+A),C.setAttribute("viewBox","0 0 18 18"),C.setAttribute("xml:space","preserve"),C.setAttribute("width",18),C.setAttribute("height",18),C.innerHTML=w,C},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(A){this._inputEl.value=A,setTimeout(function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}.bind(this),1)},_onPaste:function(A){var w=(A.clipboardData||window.clipboardData).getData("text");w.length>=this.options.minLength&&this._geocode(w)},_onKeyDown:function(A){var w=27,C=9;if(A.keyCode===w&&this.options.clearAndBlurOnEsc)return this._clear(A),this._inputEl.blur();var D=A.target&&A.target.shadowRoot?A.target.shadowRoot.activeElement:A.target,U=D?D.value:"";if(!U)return this.fresh=!0,A.keyCode!==C&&this.clear(A),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(A.metaKey||[C,w,37,39,13,38,40].indexOf(A.keyCode)!==-1)&&D.value.length>=this.options.minLength&&this._geocode(D.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(A){this.options.clearOnBlur&&this._clearOnBlur(A),this.options.collapsed&&this._collapse()},_onChange:function(){var A=this._typeahead.selected;A&&JSON.stringify(A)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(A),this.options.marker&&this._mapboxgl&&this._handleMarker(A),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(A),this._eventEmitter.emit("result",{result:A}),this.eventManager.select(A,this))},_fly:function(A){var w;if(A.properties&&cg[A.properties.short_code])w=eh({},this.options.flyTo),this._map&&this._map.fitBounds(cg[A.properties.short_code].bbox,w);else if(A.bbox){var C=A.bbox;w=eh({},this.options.flyTo),this._map&&this._map.fitBounds([[C[0],C[1]],[C[2],C[3]]],w)}else{var D={zoom:this.options.zoom};w=eh({},D,this.options.flyTo),A.center?w.center=A.center:A.geometry&&A.geometry.type&&A.geometry.type==="Point"&&A.geometry.coordinates&&(w.center=A.geometry.coordinates),this._map&&this._map.flyTo(w)}},_requestType:function(A,w){var C;const D=/^[ ]*(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/;return A.localGeocoderOnly?C=wc.LOCAL:A.reverseGeocode&&D.test(w)?C=wc.REVERSE:C=wc.FORWARD,C},_setupConfig:function(A,w){const C=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],D=/[\s,]+/;var U=this,H=C.reduce(function(g,Z){if(U.options[Z]===void 0||U.options[Z]===null)return g;["countries","types","language"].indexOf(Z)>-1?g[Z]=U.options[Z].split(D):g[Z]=U.options[Z];const ve=typeof U.options[Z].longitude=="number"&&typeof U.options[Z].latitude=="number";if(Z==="proximity"&&ve){const he=U.options[Z].longitude,ye=U.options[Z].latitude;g[Z]=[he,ye]}return g},{});switch(A){case wc.REVERSE:{var m=w.split(D).map(function(g){return parseFloat(g,10)});U.options.flipCoordinates||m.reverse(),H.types&&H.types[0],H=eh(H,{query:m,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(g){g in H&&delete H[g]})}break;case wc.FORWARD:/^[ ]*(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)*[ ]*$/.test(w)&&(w=w.replace(/,/g," ")),H=eh(H,{query:w});break}return H},_geocode:function(A){this.inputString=A,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:A});const w=this._requestType(this.options,A),C=this._setupConfig(w,A);var D;switch(w){case wc.LOCAL:D=Promise.resolve();break;case wc.FORWARD:D=this.geocoderService.forwardGeocode(C).send();break;case wc.REVERSE:D=this.geocoderService.reverseGeocode(C).send();break}var U=this.options.localGeocoder?this.options.localGeocoder(A)||[]:[],H=[],m=null;return D.catch(function(g){m=g}.bind(this)).then(function(g){this._hideLoadingIcon();var Z={};return g?g.statusCode=="200"&&(Z=g.body,Z.request=g.request,Z.headers=g.headers):Z={type:"FeatureCollection",features:[]},Z.config=C,this.fresh&&(this.eventManager.start(this),this.fresh=!1),Z.features=Z.features?U.concat(Z.features):U,this.options.externalGeocoder?(H=this.options.externalGeocoder(A,Z.features)||Promise.resolve([]),H.then(function(ve){return Z.features=Z.features?ve.concat(Z.features):ve,Z},function(){return Z})):Z}.bind(this)).then(function(g){if(m)throw m;this.options.filter&&g.features.length&&(g.features=g.features.filter(this.options.filter)),g.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",g),this._typeahead.update(g.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",g))}.bind(this)).catch(function(g){this._hideLoadingIcon(),this._hideAttribution(),U.length&&this.options.localGeocoder||H.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(U)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:U}),this._eventEmitter.emit("error",{error:g})}.bind(this)),D},_clear:function(A){A&&A.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(A){this._clear(A),this._inputEl.focus()},_clearOnBlur:function(A){var w=this;A.relatedTarget&&w._clear(A)},_onQueryResult:function(A){var w=A.body;if(!!w.features.length){var C=w.features[0];this._typeahead.selected=C,this._inputEl.value=C.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var A=this._map.getCenter().wrap();this.setProximity({longitude:A.lng,latitude:A.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(A){return this._geocode(A).then(this._onQueryResult),this},_renderError:function(){var A="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(A)},_renderLocationError:function(){var A="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(A)},_renderNoResults:function(){var A="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(A)},_renderUserDeniedGeolocationError:function(){var A="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(A)},_renderMessage:function(A){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(A)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var A=this.options.language.split(",")[0],w=x0.language(A),C=v0.placeholder[w];if(C)return C}return"Search"},setInput:function(A){return this._inputEl.value=A,this._typeahead.selected=null,this._typeahead.clear(),A.length>=this.options.minLength&&this._geocode(A),this},setProximity:function(A,w=!0){return this.options.proximity=A,w&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(A){return A&&typeof A=="function"&&(this._typeahead.render=A),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(A){var w=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=A||this.options.language||w,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(A){return this.options.zoom=A,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(A){return this.options.flyTo=A,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(A){return this.placeholder=A||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(A){return this.options.bbox=A,this},getCountries:function(){return this.options.countries},setCountries:function(A){return this.options.countries=A,this},getTypes:function(){return this.options.types},setTypes:function(A){return this.options.types=A,this},getMinLength:function(){return this.options.minLength},setMinLength:function(A){return this.options.minLength=A,this._typeahead&&(this._typeahead.options.minLength=A),this},getLimit:function(){return this.options.limit},setLimit:function(A){return this.options.limit=A,this._typeahead&&(this._typeahead.options.limit=A),this},getFilter:function(){return this.options.filter},setFilter:function(A){return this.options.filter=A,this},setOrigin:function(A){return this.options.origin=A,this.geocoderService=Of(Bf({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(A){return this.options.accessToken=A,this.geocoderService=Of(Bf({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(A){return this.options.autocomplete=A,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(A){return this.options.fuzzyMatch=A,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(A){return this.options.routing=A,this},getRouting:function(){return this.options.routing},setWorldview:function(A){return this.options.worldview=A,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(A){if(!!this._map){this._removeMarker();var w={color:"#4668F2"},C=eh({},w,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(C),A.center?this.mapMarker.setLngLat(A.center).addTo(this._map):A.geometry&&A.geometry.type&&A.geometry.type==="Point"&&A.geometry.coordinates&&this.mapMarker.setLngLat(A.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(A,w){return this._eventEmitter.on(A,w),this},off:function(A,w){return this._eventEmitter.removeListener(A,w),this.eventManager.remove(),this}};var S0=ly,uy={};Object.defineProperty(uy,"__esModule",{value:!0});class Sc{constructor(w,C){this.areas=w||Sc.DEFAULT_AREAS,this.limit_no_areas=C||Sc.DEFAULT_NO_AREAS,this.onDocumentClick=this.onDocumentClick.bind(this)}getDefaultPosition(){return"top-right"}onAdd(w){this.map=w;const C=this;if(this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("mapboxgl-ctrl"),this.controlContainer.classList.add("mapboxgl-ctrl-group"),this.areas.length<=this.limit_no_areas){this.mapAreaContainer=document.createElement("div"),this.areaButton=document.createElement("button"),this.mapAreaContainer.classList.add("mapboxgl-area-list");for(const D of this.areas){const U=document.createElement("button");U.innerText=D.title,U.classList.add(D.title.replace(/[^a-z0-9-]/gi,"_")),U.value=JSON.stringify({center:D.latlng,zoom:D.zoom}),U.addEventListener("click",H=>{const m=H.srcElement;this.map.jumpTo(JSON.parse(m.value)),this.mapAreaContainer.style.display="none",this.areaButton.style.display="block";const g=this.mapAreaContainer.getElementsByClassName("active");for(;g[0];)g[0].classList.remove("active");m.classList.add("active")}),D.title===Sc.DEFAULT_AREA&&U.classList.add("active"),this.mapAreaContainer.appendChild(U)}this.areaButton.classList.add("mapboxgl-ctrl-icon"),this.areaButton.classList.add("mapboxgl-area-switcher"),this.areaButton.addEventListener("click",()=>{this.areaButton.style.display="none",this.mapAreaContainer.style.display="block"}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.areaButton),this.controlContainer.appendChild(this.mapAreaContainer)}else this.controlContainer.classList.add("mapboxgl-ctrl-area-switch"),this.select=document.createElement("select"),this.select.setAttribute("type","select"),this.select.addEventListener("change",function(D){!D.target||C.map.flyTo(JSON.parse(D.target[this.selectedIndex].value))}),this.controlContainer.appendChild(this.select),this.areas.forEach(function(D){var U=document.createElement("option");U.setAttribute("type","option"),U.text=D.title,U.value=JSON.stringify({center:D.latlng,zoom:D.zoom}),C.select.appendChild(U)});return this.controlContainer}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.areaButton||(this.areaButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.map=void 0)}onDocumentClick(w){this.controlContainer&&!this.controlContainer.contains(w.target)&&this.mapAreaContainer&&this.areaButton&&(this.mapAreaContainer.style.display="none",this.areaButton.style.display="block")}}var T0=uy.default=Sc;Sc.DEFAULT_AREA="Narok";Sc.DEFAULT_AREAS=[{title:"Narok",latlng:[35.86974,-1.08707],zoom:13},{title:"Nairobi",latlng:[36.8034,-1.2809],zoom:11},{title:"Mombasa",latlng:[39.65449,-4.05099],zoom:12}];Sc.DEFAULT_NO_AREAS=5;var cy={},lm={exports:{}};(function(A,w){(function(C,D){A.exports=D()})(js,function(){var C,D,U;function H(m,g){if(!C)C=g;else if(!D)D=g;else{var Z="var sharedChunk = {}; ("+C+")(sharedChunk); ("+D+")(sharedChunk);",ve={};C(ve),U=g(ve),typeof window!="undefined"&&(U.workerUrl=window.URL.createObjectURL(new Blob([Z],{type:"text/javascript"})))}}return H(["exports"],function(m){function g(e,r){return e(r={exports:{}},r.exports),r.exports}var Z=ve;function ve(e,r,a,d){this.cx=3*e,this.bx=3*(a-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(d-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=d,this.p2x=a,this.p2y=d}ve.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},ve.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},ve.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},ve.prototype.solveCurveX=function(e,r){var a,d,_,S,i;for(r===void 0&&(r=1e-6),_=e,i=0;i<8;i++){if(S=this.sampleCurveX(_)-e,Math.abs(S)<r)return _;var t=this.sampleCurveDerivativeX(_);if(Math.abs(t)<1e-6)break;_-=S/t}if((_=e)<(a=0))return a;if(_>(d=1))return d;for(;a<d;){if(S=this.sampleCurveX(_),Math.abs(S-e)<r)return _;e>S?a=_:d=_,_=.5*(d-a)+a}return _},ve.prototype.solve=function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))};var he=ye;function ye(e,r){this.x=e,this.y=r}ye.prototype={clone:function(){return new ye(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,r){return this.clone()._rotateAround(e,r)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var r=e.x-this.x,a=e.y-this.y;return r*r+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,r){return Math.atan2(this.x*r-this.y*e,this.x*e+this.y*r)},_matMult:function(e){var r=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=r,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var r=Math.cos(e),a=Math.sin(e),d=a*this.x+r*this.y;return this.x=r*this.x-a*this.y,this.y=d,this},_rotateAround:function(e,r){var a=Math.cos(e),d=Math.sin(e),_=r.y+d*(this.x-r.x)+a*(this.y-r.y);return this.x=r.x+a*(this.x-r.x)-d*(this.y-r.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ye.convert=function(e){return e instanceof ye?e:Array.isArray(e)?new ye(e[0],e[1]):e};var re=typeof self!="undefined"?self:{},it=Math.pow(2,53)-1;function et(e,r,a,d){var _=new Z(e,r,a,d);return function(S){return _.solve(S)}}var St=et(.25,.1,.25,1);function vt(e,r,a){return Math.min(a,Math.max(r,e))}function Xt(e,r,a){var d=a-r,_=((e-r)%d+d)%d+r;return _===r?a:_}function Wt(e){for(var r=[],a=arguments.length-1;a-- >0;)r[a]=arguments[a+1];for(var d=0,_=r;d<_.length;d+=1){var S=_[d];for(var i in S)e[i]=S[i]}return e}var _t=1;function ui(){return _t++}function qt(){return function e(r){return r?(r^16*Math.random()>>r/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function Zt(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function si(e,r){e.forEach(function(a){r[a]&&(r[a]=r[a].bind(r))})}function Wi(e,r){return e.indexOf(r,e.length-r.length)!==-1}function Gi(e,r,a){var d={};for(var _ in e)d[_]=r.call(a||this,e[_],_,e);return d}function Zi(e,r,a){var d={};for(var _ in e)r.call(a||this,e[_],_,e)&&(d[_]=e[_]);return d}function Ki(e){return Array.isArray(e)?e.map(Ki):typeof e=="object"&&e?Gi(e,Ki):e}var Mr={};function Oi(e){Mr[e]||(typeof console!="undefined"&&console.warn(e),Mr[e]=!0)}function hr(e,r,a){return(a.y-e.y)*(r.x-e.x)>(r.y-e.y)*(a.x-e.x)}function eo(e){for(var r=0,a=0,d=e.length,_=d-1,S=void 0,i=void 0;a<d;_=a++)r+=((i=e[_]).x-(S=e[a]).x)*(S.y+i.y);return r}function ii(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Lr(e){var r={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(d,_,S,i){var t=S||i;return r[_]=!t||t.toLowerCase(),""}),r["max-age"]){var a=parseInt(r["max-age"],10);isNaN(a)?delete r["max-age"]:r["max-age"]=a}return r}var un=null;function Fn(e){if(un==null){var r=e.navigator?e.navigator.userAgent:null;un=!!e.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return un}function Dr(e){try{var r=re[e];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch{return!1}}var Vr,nn,cn,oi,$r=re.performance&&re.performance.now?re.performance.now.bind(re.performance):Date.now.bind(Date),Hr=re.requestAnimationFrame||re.mozRequestAnimationFrame||re.webkitRequestAnimationFrame||re.msRequestAnimationFrame,wr=re.cancelAnimationFrame||re.mozCancelAnimationFrame||re.webkitCancelAnimationFrame||re.msCancelAnimationFrame,hn={now:$r,frame:function(e){var r=Hr(e);return{cancel:function(){return wr(r)}}},getImageData:function(e,r){r===void 0&&(r=0);var a=re.document.createElement("canvas"),d=a.getContext("2d");if(!d)throw new Error("failed to create canvas 2d context");return a.width=e.width,a.height=e.height,d.drawImage(e,0,0,e.width,e.height),d.getImageData(-r,-r,e.width+2*r,e.height+2*r)},resolveURL:function(e){return Vr||(Vr=re.document.createElement("a")),Vr.href=e,Vr.href},hardwareConcurrency:re.navigator&&re.navigator.hardwareConcurrency||4,get devicePixelRatio(){return re.devicePixelRatio},get prefersReducedMotion(){return!!re.matchMedia&&(nn==null&&(nn=re.matchMedia("(prefers-reduced-motion: reduce)")),nn.matches)}},Fi={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Ut={supported:!1,testSupport:function(e){!Nr&&oi&&(to?ci(e):cn=e)}},Nr=!1,to=!1;function ci(e){var r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,oi),e.isContextLost())return;Ut.supported=!0}catch{}e.deleteTexture(r),Nr=!0}re.document&&((oi=re.document.createElement("img")).onload=function(){cn&&ci(cn),cn=null,to=!0},oi.onerror=function(){Nr=!0,cn=null},oi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Hn="01",pn=function(e,r){this._transformRequestFn=e,this._customAccessToken=r,this._createSkuToken()};function Sn(e){return e.indexOf("mapbox:")===0}pn.prototype._createSkuToken=function(){var e=function(){for(var r="",a=0;a<10;a++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Hn,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt},pn.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},pn.prototype.transformRequest=function(e,r){return this._transformRequestFn&&this._transformRequestFn(e,r)||{url:e}},pn.prototype.normalizeStyleURL=function(e,r){if(!Sn(e))return e;var a=Wr(e);return a.path="/styles/v1"+a.path,this._makeAPIURL(a,this._customAccessToken||r)},pn.prototype.normalizeGlyphsURL=function(e,r){if(!Sn(e))return e;var a=Wr(e);return a.path="/fonts/v1"+a.path,this._makeAPIURL(a,this._customAccessToken||r)},pn.prototype.normalizeSourceURL=function(e,r){if(!Sn(e))return e;var a=Wr(e);return a.path="/v4/"+a.authority+".json",a.params.push("secure"),this._makeAPIURL(a,this._customAccessToken||r)},pn.prototype.normalizeSpriteURL=function(e,r,a,d){var _=Wr(e);return Sn(e)?(_.path="/styles/v1"+_.path+"/sprite"+r+a,this._makeAPIURL(_,this._customAccessToken||d)):(_.path+=""+r+a,Un(_))},pn.prototype.normalizeTileURL=function(e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!Sn(e))return e;var a=Wr(e);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,(hn.devicePixelRatio>=2||r===512?"@2x":"")+(Ut.supported?".webp":"$1")),a.path=a.path.replace(/^.+\/v4\//,"/"),a.path="/v4"+a.path;var d=this._customAccessToken||function(_){for(var S=0,i=_;S<i.length;S+=1){var t=i[S].match(/^access_token=(.*)$/);if(t)return t[1]}return null}(a.params)||Fi.ACCESS_TOKEN;return Fi.REQUIRE_ACCESS_TOKEN&&d&&this._skuToken&&a.params.push("sku="+this._skuToken),this._makeAPIURL(a,d)},pn.prototype.canonicalizeTileURL=function(e,r){var a=Wr(e);if(!a.path.match(/(^\/v4\/)/)||!a.path.match(/\.[\w]+$/))return e;var d="mapbox://tiles/";d+=a.path.replace("/v4/","");var _=a.params;return r&&(_=_.filter(function(S){return!S.match(/^access_token=/)})),_.length&&(d+="?"+_.join("&")),d},pn.prototype.canonicalizeTileset=function(e,r){for(var a=!!r&&Sn(r),d=[],_=0,S=e.tiles||[];_<S.length;_+=1){var i=S[_];io(i)?d.push(this.canonicalizeTileURL(i,a)):d.push(i)}return d},pn.prototype._makeAPIURL=function(e,r){var a="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",d=Wr(Fi.API_URL);if(e.protocol=d.protocol,e.authority=d.authority,e.protocol==="http"){var _=e.params.indexOf("secure");_>=0&&e.params.splice(_,1)}if(d.path!=="/"&&(e.path=""+d.path+e.path),!Fi.REQUIRE_ACCESS_TOKEN)return Un(e);if(!(r=r||Fi.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+a);if(r[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+a);return e.params=e.params.filter(function(S){return S.indexOf("access_token")===-1}),e.params.push("access_token="+r),Un(e)};var ko=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function io(e){return ko.test(e)}var vo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Wr(e){var r=e.match(vo);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function Un(e){var r=e.params.length?"?"+e.params.join("&"):"";return e.protocol+"://"+e.authority+e.path+r}function Yo(e){if(!e)return null;var r=e.split(".");if(!r||r.length!==3)return null;try{return JSON.parse(decodeURIComponent(re.atob(r[1]).split("").map(function(a){return"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch{return null}}var wi=function(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};wi.prototype.getStorageKey=function(e){var r,a=Yo(Fi.ACCESS_TOKEN);return r=a&&a.u?re.btoa(encodeURIComponent(a.u).replace(/%([0-9A-F]{2})/g,function(d,_){return String.fromCharCode(Number("0x"+_))})):Fi.ACCESS_TOKEN||"",e?"mapbox.eventData."+e+":"+r:"mapbox.eventData:"+r},wi.prototype.fetchEventData=function(){var e=Dr("localStorage"),r=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{var d=re.localStorage.getItem(r);d&&(this.eventData=JSON.parse(d));var _=re.localStorage.getItem(a);_&&(this.anonId=_)}catch{Oi("Unable to read from LocalStorage")}},wi.prototype.saveEventData=function(){var e=Dr("localStorage"),r=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{re.localStorage.setItem(a,this.anonId),Object.keys(this.eventData).length>=1&&re.localStorage.setItem(r,JSON.stringify(this.eventData))}catch{Oi("Unable to write to LocalStorage")}},wi.prototype.processRequests=function(e){},wi.prototype.postEvent=function(e,r,a,d){var _=this;if(Fi.EVENTS_URL){var S=Wr(Fi.EVENTS_URL);S.params.push("access_token="+(d||Fi.ACCESS_TOKEN||""));var i={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:Hn,userId:this.anonId},t=r?Wt(i,r):i,o={url:Un(S),headers:{"Content-Type":"text/plain"},body:JSON.stringify([t])};this.pendingRequest=ar(o,function(l){_.pendingRequest=null,a(l),_.saveEventData(),_.processRequests(d)})}},wi.prototype.queueRequest=function(e,r){this.queue.push(e),this.processRequests(r)};var Tn,ro,kn=function(e){function r(){e.call(this,"map.load"),this.success={},this.skuToken=""}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.postMapLoadEvent=function(a,d,_,S){this.skuToken=_,(Fi.EVENTS_URL&&S||Fi.ACCESS_TOKEN&&Array.isArray(a)&&a.some(function(i){return Sn(i)||io(i)}))&&this.queueRequest({id:d,timestamp:Date.now()},S)},r.prototype.processRequests=function(a){var d=this;if(!this.pendingRequest&&this.queue.length!==0){var _=this.queue.shift(),S=_.id,i=_.timestamp;S&&this.success[S]||(this.anonId||this.fetchEventData(),Zt(this.anonId)||(this.anonId=qt()),this.postEvent(i,{skuToken:this.skuToken},function(t){t||S&&(d.success[S]=!0)},a))}},r}(wi),Ma=new(function(e){function r(a){e.call(this,"appUserTurnstile"),this._customAccessToken=a}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.postTurnstileEvent=function(a,d){Fi.EVENTS_URL&&Fi.ACCESS_TOKEN&&Array.isArray(a)&&a.some(function(_){return Sn(_)||io(_)})&&this.queueRequest(Date.now(),d)},r.prototype.processRequests=function(a){var d=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var _=Yo(Fi.ACCESS_TOKEN),S=_?_.u:Fi.ACCESS_TOKEN,i=S!==this.eventData.tokenU;Zt(this.anonId)||(this.anonId=qt(),i=!0);var t=this.queue.shift();if(this.eventData.lastSuccess){var o=new Date(this.eventData.lastSuccess),l=new Date(t),p=(t-this.eventData.lastSuccess)/864e5;i=i||p>=1||p<-1||o.getDate()!==l.getDate()}else i=!0;if(!i)return this.processRequests();this.postEvent(t,{"enabled.telemetry":!1},function(y){y||(d.eventData.lastSuccess=t,d.eventData.tokenU=S)},a)}},r}(wi)),st=Ma.postTurnstileEvent.bind(Ma),Rt=new kn,Vo=Rt.postMapLoadEvent.bind(Rt),no=500,or=50;function Mn(){re.caches&&!Tn&&(Tn=re.caches.open("mapbox-tiles"))}function dn(e){var r=e.indexOf("?");return r<0?e:e.slice(0,r)}var xo,ur=1/0;function kt(){return xo==null&&(xo=re.OffscreenCanvas&&new re.OffscreenCanvas(1,1).getContext("2d")&&typeof re.createImageBitmap=="function"),xo}var zi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(zi);var Ei=function(e){function r(a,d,_){d===401&&io(_)&&(a+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),e.call(this,a),this.status=d,this.url=_,this.name=this.constructor.name,this.message=a}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},r}(Error),Kr=ii()?function(){return self.worker&&self.worker.referrer}:function(){return(re.location.protocol==="blob:"?re.parent:re).location.href},fn,yi,Mo=function(e,r){if(!(/^file:/.test(a=e.url)||/^file:/.test(Kr())&&!/^\w+:/.test(a))){if(re.fetch&&re.Request&&re.AbortController&&re.Request.prototype.hasOwnProperty("signal"))return function(d,_){var S,i=new re.AbortController,t=new re.Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,referrer:Kr(),signal:i.signal}),o=!1,l=!1,p=(S=t.url).indexOf("sku=")>0&&io(S);d.type==="json"&&t.headers.set("Accept","application/json");var y=function(I,k,L){if(!l){if(I&&I.message!=="SecurityError"&&Oi(I),k&&L)return v(k);var O=Date.now();re.fetch(t).then(function(B){if(B.ok){var q=p?B.clone():null;return v(B,q,O)}return _(new Ei(B.statusText,B.status,d.url))}).catch(function(B){B.code!==20&&_(new Error(B.message))})}},v=function(I,k,L){(d.type==="arrayBuffer"?I.arrayBuffer():d.type==="json"?I.json():I.text()).then(function(O){l||(k&&L&&function(B,q,$){if(Mn(),Tn){var W={status:q.status,statusText:q.statusText,headers:new re.Headers};q.headers.forEach(function(ue,Ie){return W.headers.set(Ie,ue)});var ne=Lr(q.headers.get("Cache-Control")||"");ne["no-store"]||(ne["max-age"]&&W.headers.set("Expires",new Date($+1e3*ne["max-age"]).toUTCString()),new Date(W.headers.get("Expires")).getTime()-$<42e4||function(ue,Ie){if(ro===void 0)try{new Response(new ReadableStream),ro=!0}catch{ro=!1}ro?Ie(ue.body):ue.blob().then(Ie)}(q,function(ue){var Ie=new re.Response(ue,W);Mn(),Tn&&Tn.then(function(De){return De.put(dn(B.url),Ie)}).catch(function(De){return Oi(De.message)})}))}}(t,k,L),o=!0,_(null,O,I.headers.get("Cache-Control"),I.headers.get("Expires")))}).catch(function(O){l||_(new Error(O.message))})};return p?function(I,k){if(Mn(),!Tn)return k(null);var L=dn(I.url);Tn.then(function(O){O.match(L).then(function(B){var q=function($){if(!$)return!1;var W=new Date($.headers.get("Expires")||0),ne=Lr($.headers.get("Cache-Control")||"");return W>Date.now()&&!ne["no-cache"]}(B);O.delete(L),q&&O.put(L,B.clone()),k(null,B,q)}).catch(k)}).catch(k)}(t,y):y(null,null),{cancel:function(){l=!0,o||i.abort()}}}(e,r);if(ii()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,r,void 0,!0)}var a;return function(d,_){var S=new re.XMLHttpRequest;for(var i in S.open(d.method||"GET",d.url,!0),d.type==="arrayBuffer"&&(S.responseType="arraybuffer"),d.headers)S.setRequestHeader(i,d.headers[i]);return d.type==="json"&&(S.responseType="text",S.setRequestHeader("Accept","application/json")),S.withCredentials=d.credentials==="include",S.onerror=function(){_(new Error(S.statusText))},S.onload=function(){if((S.status>=200&&S.status<300||S.status===0)&&S.response!==null){var t=S.response;if(d.type==="json")try{t=JSON.parse(S.response)}catch(o){return _(o)}_(null,t,S.getResponseHeader("Cache-Control"),S.getResponseHeader("Expires"))}else _(new Ei(S.statusText,S.status,d.url))},S.send(d.body),{cancel:function(){return S.abort()}}}(e,r)},Wn=function(e,r){return Mo(Wt(e,{type:"arrayBuffer"}),r)},ar=function(e,r){return Mo(Wt(e,{method:"POST"}),r)},J="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";fn=[],yi=0;var te=function(e,r){if(Ut.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),yi>=Fi.MAX_PARALLEL_IMAGE_REQUESTS){var a={requestParameters:e,callback:r,cancelled:!1,cancel:function(){this.cancelled=!0}};return fn.push(a),a}yi++;var d=!1,_=function(){if(!d)for(d=!0,yi--;fn.length&&yi<Fi.MAX_PARALLEL_IMAGE_REQUESTS;){var i=fn.shift();i.cancelled||(i.cancel=te(i.requestParameters,i.callback).cancel)}},S=Wn(e,function(i,t,o,l){_(),i?r(i):t&&(kt()?function(p,y){var v=new re.Blob([new Uint8Array(p)],{type:"image/png"});re.createImageBitmap(v).then(function(I){y(null,I)}).catch(function(I){y(new Error("Could not load image because of "+I.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(t,r):function(p,y,v,I){var k=new re.Image,L=re.URL;k.onload=function(){y(null,k),L.revokeObjectURL(k.src),k.onload=null,re.requestAnimationFrame(function(){k.src=J})},k.onerror=function(){return y(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var O=new re.Blob([new Uint8Array(p)],{type:"image/png"});k.cacheControl=v,k.expires=I,k.src=p.byteLength?L.createObjectURL(O):J}(t,r,o,l))});return{cancel:function(){S.cancel(),_()}}};function oe(e,r,a){a[e]&&a[e].indexOf(r)!==-1||(a[e]=a[e]||[],a[e].push(r))}function me(e,r,a){if(a&&a[e]){var d=a[e].indexOf(r);d!==-1&&a[e].splice(d,1)}}var Te=function(e,r){r===void 0&&(r={}),Wt(this,r),this.type=e},Re=function(e){function r(a,d){d===void 0&&(d={}),e.call(this,"error",Wt({error:a},d))}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r}(Te),Oe=function(){};Oe.prototype.on=function(e,r){return this._listeners=this._listeners||{},oe(e,r,this._listeners),this},Oe.prototype.off=function(e,r){return me(e,r,this._listeners),me(e,r,this._oneTimeListeners),this},Oe.prototype.once=function(e,r){return this._oneTimeListeners=this._oneTimeListeners||{},oe(e,r,this._oneTimeListeners),this},Oe.prototype.fire=function(e,r){typeof e=="string"&&(e=new Te(e,r||{}));var a=e.type;if(this.listens(a)){e.target=this;for(var d=0,_=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];d<_.length;d+=1)_[d].call(this,e);for(var S=0,i=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];S<i.length;S+=1){var t=i[S];me(a,t,this._oneTimeListeners),t.call(this,e)}var o=this._eventedParent;o&&(Wt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),o.fire(e))}else e instanceof Re&&console.error(e.error);return this},Oe.prototype.listens=function(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)},Oe.prototype.setEventedParent=function(e,r){return this._eventedParent=e,this._eventedParentData=r,this};var fe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Pe=function(e,r,a,d){this.message=(e?e+": ":"")+a,d&&(this.identifier=d),r!=null&&r.__line__&&(this.line=r.__line__)};function Xe(e){var r=e.value;return r?[new Pe(e.key,r,"constants have been deprecated as of v8")]:[]}function ie(e){for(var r=[],a=arguments.length-1;a-- >0;)r[a]=arguments[a+1];for(var d=0,_=r;d<_.length;d+=1){var S=_[d];for(var i in S)e[i]=S[i]}return e}function N(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function j(e){if(Array.isArray(e))return e.map(j);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){var r={};for(var a in e)r[a]=j(e[a]);return r}return N(e)}var ee=function(e){function r(a,d){e.call(this,d),this.message=d,this.key=a}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r}(Error),se=function(e,r){r===void 0&&(r=[]),this.parent=e,this.bindings={};for(var a=0,d=r;a<d.length;a+=1){var _=d[a];this.bindings[_[0]]=_[1]}};se.prototype.concat=function(e){return new se(this,e)},se.prototype.get=function(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(e+" not found in scope.")},se.prototype.has=function(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)};var ge={kind:"null"},pe={kind:"number"},Ee={kind:"string"},we={kind:"boolean"},Se={kind:"color"},$e={kind:"object"},je={kind:"value"},He={kind:"collator"},Tt={kind:"formatted"},ft={kind:"resolvedImage"};function wt(e,r){return{kind:"array",itemType:e,N:r}}function It(e){if(e.kind==="array"){var r=It(e.itemType);return typeof e.N=="number"?"array<"+r+", "+e.N+">":e.itemType.kind==="value"?"array":"array<"+r+">"}return e.kind}var xi=[ge,pe,Ee,we,Se,Tt,$e,wt(je),ft];function Qt(e,r){if(r.kind==="error")return null;if(e.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!Qt(e.itemType,r.itemType))&&(typeof e.N!="number"||e.N===r.N))return null}else{if(e.kind===r.kind)return null;if(e.kind==="value"){for(var a=0,d=xi;a<d.length;a+=1)if(!Qt(d[a],r))return null}}return"Expected "+It(e)+" but found "+It(r)+" instead."}function ni(e,r){return r.some(function(a){return a.kind===e.kind})}function $t(e,r){return r.some(function(a){return a==="null"?e===null:a==="array"?Array.isArray(e):a==="object"?e&&!Array.isArray(e)&&typeof e=="object":a===typeof e})}var Mt=g(function(e,r){var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function d(t){return(t=Math.round(t))<0?0:t>255?255:t}function _(t){return d(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function S(t){return(o=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:o>1?1:o;var o}function i(t,o,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?t+(o-t)*l*6:2*l<1?o:3*l<2?t+(o-t)*(2/3-l)*6:t}try{r.parseCSSColor=function(t){var o,l=t.replace(/ /g,"").toLowerCase();if(l in a)return a[l].slice();if(l[0]==="#")return l.length===4?(o=parseInt(l.substr(1),16))>=0&&o<=4095?[(3840&o)>>4|(3840&o)>>8,240&o|(240&o)>>4,15&o|(15&o)<<4,1]:null:l.length===7&&(o=parseInt(l.substr(1),16))>=0&&o<=16777215?[(16711680&o)>>16,(65280&o)>>8,255&o,1]:null;var p=l.indexOf("("),y=l.indexOf(")");if(p!==-1&&y+1===l.length){var v=l.substr(0,p),I=l.substr(p+1,y-(p+1)).split(","),k=1;switch(v){case"rgba":if(I.length!==4)return null;k=S(I.pop());case"rgb":return I.length!==3?null:[_(I[0]),_(I[1]),_(I[2]),k];case"hsla":if(I.length!==4)return null;k=S(I.pop());case"hsl":if(I.length!==3)return null;var L=(parseFloat(I[0])%360+360)%360/360,O=S(I[1]),B=S(I[2]),q=B<=.5?B*(O+1):B+O-B*O,$=2*B-q;return[d(255*i($,q,L+1/3)),d(255*i($,q,L)),d(255*i($,q,L-1/3)),k];default:return null}}return null}}catch{}}).parseCSSColor,di=function(e,r,a,d){d===void 0&&(d=1),this.r=e,this.g=r,this.b=a,this.a=d};di.parse=function(e){if(e){if(e instanceof di)return e;if(typeof e=="string"){var r=Mt(e);if(r)return new di(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3])}}},di.prototype.toString=function(){var e=this.toArray(),r=e[1],a=e[2],d=e[3];return"rgba("+Math.round(e[0])+","+Math.round(r)+","+Math.round(a)+","+d+")"},di.prototype.toArray=function(){var e=this.a;return e===0?[0,0,0,0]:[255*this.r/e,255*this.g/e,255*this.b/e,e]},di.black=new di(0,0,0,1),di.white=new di(1,1,1,1),di.transparent=new di(0,0,0,0),di.red=new di(1,0,0,1);var qi=function(e,r,a){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};qi.prototype.compare=function(e,r){return this.collator.compare(e,r)},qi.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var jr=function(e,r,a,d,_){this.text=e,this.image=r,this.scale=a,this.fontStack=d,this.textColor=_},Xi=function(e){this.sections=e};Xi.fromString=function(e){return new Xi([new jr(e,null,null,null,null)])},Xi.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(e){return e.text.length!==0||e.image&&e.image.name.length!==0})},Xi.factory=function(e){return e instanceof Xi?e:Xi.fromString(e)},Xi.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(e){return e.text}).join("")},Xi.prototype.serialize=function(){for(var e=["format"],r=0,a=this.sections;r<a.length;r+=1){var d=a[r];if(d.image)e.push(["image",d.image.name]);else{e.push(d.text);var _={};d.fontStack&&(_["text-font"]=["literal",d.fontStack.split(",")]),d.scale&&(_["font-scale"]=d.scale),d.textColor&&(_["text-color"]=["rgba"].concat(d.textColor.toArray())),e.push(_)}}return e};var Ln=function(e){this.name=e.name,this.available=e.available};function Gs(e,r,a,d){return typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof a=="number"&&a>=0&&a<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:"Invalid rgba value ["+[e,r,a,d].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof d=="number"?[e,r,a,d]:[e,r,a]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function tr(e){if(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||e instanceof di||e instanceof qi||e instanceof Xi||e instanceof Ln)return!0;if(Array.isArray(e)){for(var r=0,a=e;r<a.length;r+=1)if(!tr(a[r]))return!1;return!0}if(typeof e=="object"){for(var d in e)if(!tr(e[d]))return!1;return!0}return!1}function Rr(e){if(e===null)return ge;if(typeof e=="string")return Ee;if(typeof e=="boolean")return we;if(typeof e=="number")return pe;if(e instanceof di)return Se;if(e instanceof qi)return He;if(e instanceof Xi)return Tt;if(e instanceof Ln)return ft;if(Array.isArray(e)){for(var r,a=e.length,d=0,_=e;d<_.length;d+=1){var S=Rr(_[d]);if(r){if(r===S)continue;r=je;break}r=S}return wt(r||je,a)}return $e}function es(e){var r=typeof e;return e===null?"":r==="string"||r==="number"||r==="boolean"?String(e):e instanceof di||e instanceof Xi||e instanceof Ln?e.toString():JSON.stringify(e)}Ln.prototype.toString=function(){return this.name},Ln.fromString=function(e){return e?new Ln({name:e,available:!1}):null},Ln.prototype.serialize=function(){return["image",this.name]};var Vn=function(e,r){this.type=e,this.value=r};Vn.parse=function(e,r){if(e.length!==2)return r.error("'literal' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(!tr(e[1]))return r.error("invalid value");var a=e[1],d=Rr(a),_=r.expectedType;return d.kind!=="array"||d.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(d=_),new Vn(d,a)},Vn.prototype.evaluate=function(){return this.value},Vn.prototype.eachChild=function(){},Vn.prototype.outputDefined=function(){return!0},Vn.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof di?["rgba"].concat(this.value.toArray()):this.value instanceof Xi?this.value.serialize():this.value};var Jr=function(e){this.name="ExpressionEvaluationError",this.message=e};Jr.prototype.toJSON=function(){return this.message};var bo={string:Ee,number:pe,boolean:we,object:$e},pr=function(e,r){this.type=e,this.args=r};pr.parse=function(e,r){if(e.length<2)return r.error("Expected at least one argument.");var a,d=1,_=e[0];if(_==="array"){var S,i;if(e.length>2){var t=e[1];if(typeof t!="string"||!(t in bo)||t==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);S=bo[t],d++}else S=je;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);i=e[2],d++}a=wt(S,i)}else a=bo[_];for(var o=[];d<e.length;d++){var l=r.parse(e[d],d,je);if(!l)return null;o.push(l)}return new pr(a,o)},pr.prototype.evaluate=function(e){for(var r=0;r<this.args.length;r++){var a=this.args[r].evaluate(e);if(!Qt(this.type,Rr(a)))return a;if(r===this.args.length-1)throw new Jr("Expected value to be of type "+It(this.type)+", but found "+It(Rr(a))+" instead.")}return null},pr.prototype.eachChild=function(e){this.args.forEach(e)},pr.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},pr.prototype.serialize=function(){var e=this.type,r=[e.kind];if(e.kind==="array"){var a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){r.push(a.kind);var d=e.N;(typeof d=="number"||this.args.length>1)&&r.push(d)}}return r.concat(this.args.map(function(_){return _.serialize()}))};var wo=function(e){this.type=Tt,this.sections=e};wo.parse=function(e,r){if(e.length<2)return r.error("Expected at least one argument.");var a=e[1];if(!Array.isArray(a)&&typeof a=="object")return r.error("First argument must be an image or text section.");for(var d=[],_=!1,S=1;S<=e.length-1;++S){var i=e[S];if(_&&typeof i=="object"&&!Array.isArray(i)){_=!1;var t=null;if(i["font-scale"]&&!(t=r.parse(i["font-scale"],1,pe)))return null;var o=null;if(i["text-font"]&&!(o=r.parse(i["text-font"],1,wt(Ee))))return null;var l=null;if(i["text-color"]&&!(l=r.parse(i["text-color"],1,Se)))return null;var p=d[d.length-1];p.scale=t,p.font=o,p.textColor=l}else{var y=r.parse(e[S],1,je);if(!y)return null;var v=y.type.kind;if(v!=="string"&&v!=="value"&&v!=="null"&&v!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,d.push({content:y,scale:null,font:null,textColor:null})}}return new wo(d)},wo.prototype.evaluate=function(e){return new Xi(this.sections.map(function(r){var a=r.content.evaluate(e);return Rr(a)===ft?new jr("",a,null,null,null):new jr(es(a),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))},wo.prototype.eachChild=function(e){for(var r=0,a=this.sections;r<a.length;r+=1){var d=a[r];e(d.content),d.scale&&e(d.scale),d.font&&e(d.font),d.textColor&&e(d.textColor)}},wo.prototype.outputDefined=function(){return!1},wo.prototype.serialize=function(){for(var e=["format"],r=0,a=this.sections;r<a.length;r+=1){var d=a[r];e.push(d.content.serialize());var _={};d.scale&&(_["font-scale"]=d.scale.serialize()),d.font&&(_["text-font"]=d.font.serialize()),d.textColor&&(_["text-color"]=d.textColor.serialize()),e.push(_)}return e};var Kn=function(e){this.type=ft,this.input=e};Kn.parse=function(e,r){if(e.length!==2)return r.error("Expected two arguments.");var a=r.parse(e[1],1,Ee);return a?new Kn(a):r.error("No image name provided.")},Kn.prototype.evaluate=function(e){var r=this.input.evaluate(e),a=Ln.fromString(r);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(r)>-1),a},Kn.prototype.eachChild=function(e){e(this.input)},Kn.prototype.outputDefined=function(){return!1},Kn.prototype.serialize=function(){return["image",this.input.serialize()]};var du={"to-boolean":we,"to-color":Se,"to-number":pe,"to-string":Ee},Eo=function(e,r){this.type=e,this.args=r};Eo.parse=function(e,r){if(e.length<2)return r.error("Expected at least one argument.");var a=e[0];if((a==="to-boolean"||a==="to-string")&&e.length!==2)return r.error("Expected one argument.");for(var d=du[a],_=[],S=1;S<e.length;S++){var i=r.parse(e[S],S,je);if(!i)return null;_.push(i)}return new Eo(d,_)},Eo.prototype.evaluate=function(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){for(var r,a,d=0,_=this.args;d<_.length;d+=1){if(a=null,(r=_[d].evaluate(e))instanceof di)return r;if(typeof r=="string"){var S=e.parseColor(r);if(S)return S}else if(Array.isArray(r)&&!(a=r.length<3||r.length>4?"Invalid rbga value "+JSON.stringify(r)+": expected an array containing either three or four numeric values.":Gs(r[0],r[1],r[2],r[3])))return new di(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Jr(a||"Could not parse color from value '"+(typeof r=="string"?r:String(JSON.stringify(r)))+"'")}if(this.type.kind==="number"){for(var i=null,t=0,o=this.args;t<o.length;t+=1){if((i=o[t].evaluate(e))===null)return 0;var l=Number(i);if(!isNaN(l))return l}throw new Jr("Could not convert "+JSON.stringify(i)+" to number.")}return this.type.kind==="formatted"?Xi.fromString(es(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Ln.fromString(es(this.args[0].evaluate(e))):es(this.args[0].evaluate(e))},Eo.prototype.eachChild=function(e){this.args.forEach(e)},Eo.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},Eo.prototype.serialize=function(){if(this.type.kind==="formatted")return new wo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Kn(this.args[0]).serialize();var e=["to-"+this.type.kind];return this.eachChild(function(r){e.push(r.serialize())}),e};var ts=["Unknown","Point","LineString","Polygon"],Lo=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Lo.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Lo.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?ts[this.feature.type]:this.feature.type:null},Lo.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Lo.prototype.canonicalID=function(){return this.canonical},Lo.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Lo.prototype.parseColor=function(e){var r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=di.parse(e)),r};var Br=function(e,r,a,d){this.name=e,this.type=r,this._evaluate=a,this.args=d};Br.prototype.evaluate=function(e){return this._evaluate(e,this.args)},Br.prototype.eachChild=function(e){this.args.forEach(e)},Br.prototype.outputDefined=function(){return!1},Br.prototype.serialize=function(){return[this.name].concat(this.args.map(function(e){return e.serialize()}))},Br.parse=function(e,r){var a,d=e[0],_=Br.definitions[d];if(!_)return r.error('Unknown expression "'+d+'". If you wanted a literal array, use ["literal", [...]].',0);for(var S=Array.isArray(_)?_[0]:_.type,i=Array.isArray(_)?[[_[1],_[2]]]:_.overloads,t=i.filter(function(We){var Ve=We[0];return!Array.isArray(Ve)||Ve.length===e.length-1}),o=null,l=0,p=t;l<p.length;l+=1){var y=p[l],v=y[0],I=y[1];o=new Da(r.registry,r.path,null,r.scope);for(var k=[],L=!1,O=1;O<e.length;O++){var B=e[O],q=Array.isArray(v)?v[O-1]:v.type,$=o.parse(B,1+k.length,q);if(!$){L=!0;break}k.push($)}if(!L)if(Array.isArray(v)&&v.length!==k.length)o.error("Expected "+v.length+" arguments, but found "+k.length+" instead.");else{for(var W=0;W<k.length;W++){var ne=Array.isArray(v)?v[W]:v.type,ue=k[W];o.concat(W+1).checkSubtype(ne,ue.type)}if(o.errors.length===0)return new Br(d,S,I,k)}}if(t.length===1)(a=r.errors).push.apply(a,o.errors);else{for(var Ie=(t.length?t:i).map(function(We){var Ve;return Ve=We[0],Array.isArray(Ve)?"("+Ve.map(It).join(", ")+")":"("+It(Ve.type)+"...)"}).join(" | "),De=[],Fe=1;Fe<e.length;Fe++){var Ue=r.parse(e[Fe],1+De.length);if(!Ue)return null;De.push(It(Ue.type))}r.error("Expected arguments of type "+Ie+", but found ("+De.join(", ")+") instead.")}return null},Br.register=function(e,r){for(var a in Br.definitions=r,r)e[a]=Br};var oo=function(e,r,a){this.type=He,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=r};function mn(e,r){e[0]=Math.min(e[0],r[0]),e[1]=Math.min(e[1],r[1]),e[2]=Math.max(e[2],r[0]),e[3]=Math.max(e[3],r[1])}function Qo(e,r){return!(e[0]<=r[0]||e[2]>=r[2]||e[1]<=r[1]||e[3]>=r[3])}function Zs(e,r){var a=(180+e[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,_=Math.pow(2,r.z);return[Math.round(a*_*8192),Math.round(d*_*8192)]}function Il(e,r,a){return r[1]>e[1]!=a[1]>e[1]&&e[0]<(a[0]-r[0])*(e[1]-r[1])/(a[1]-r[1])+r[0]}function is(e,r){for(var a,d,_,S,i,t,o,l=!1,p=0,y=r.length;p<y;p++)for(var v=r[p],I=0,k=v.length;I<k-1;I++){if((S=(a=e)[0]-(d=v[I])[0])*(o=a[1]-(_=v[I+1])[1])-(t=a[0]-_[0])*(i=a[1]-d[1])==0&&S*t<=0&&i*o<=0)return!1;Il(e,v[I],v[I+1])&&(l=!l)}return l}function on(e,r){for(var a=0;a<r.length;a++)if(is(e,r[a]))return!0;return!1}function Ss(e,r,a,d){var _=d[0]-a[0],S=d[1]-a[1],i=(e[0]-a[0])*S-_*(e[1]-a[1]),t=(r[0]-a[0])*S-_*(r[1]-a[1]);return i>0&&t<0||i<0&&t>0}function fu(e,r,a){for(var d=0,_=a;d<_.length;d+=1)for(var S=_[d],i=0;i<S.length-1;++i)if((y=[(p=S[i+1])[0]-(l=S[i])[0],p[1]-l[1]])[0]*(v=[(o=r)[0]-(t=e)[0],o[1]-t[1]])[1]-y[1]*v[0]!=0&&Ss(t,o,l,p)&&Ss(l,p,t,o))return!0;var t,o,l,p,y,v;return!1}function mu(e,r){for(var a=0;a<e.length;++a)if(!is(e[a],r))return!1;for(var d=0;d<e.length-1;++d)if(fu(e[d],e[d+1],r))return!1;return!0}function gu(e,r){for(var a=0;a<r.length;a++)if(mu(e,r[a]))return!0;return!1}function fa(e,r,a){for(var d=[],_=0;_<e.length;_++){for(var S=[],i=0;i<e[_].length;i++){var t=Zs(e[_][i],a);mn(r,t),S.push(t)}d.push(S)}return d}function Xs(e,r,a){for(var d=[],_=0;_<e.length;_++){var S=fa(e[_],r,a);d.push(S)}return d}function $s(e,r,a,d){if(e[0]<a[0]||e[0]>a[2]){var _=.5*d,S=e[0]-a[0]>_?-d:a[0]-e[0]>_?d:0;S===0&&(S=e[0]-a[2]>_?-d:a[2]-e[0]>_?d:0),e[0]+=S}mn(r,e)}function $u(e,r,a,d){for(var _=8192*Math.pow(2,d.z),S=[8192*d.x,8192*d.y],i=[],t=0,o=e;t<o.length;t+=1)for(var l=0,p=o[t];l<p.length;l+=1){var y=p[l],v=[y.x+S[0],y.y+S[1]];$s(v,r,a,_),i.push(v)}return i}function Ts(e,r,a,d){for(var _,S=8192*Math.pow(2,d.z),i=[8192*d.x,8192*d.y],t=[],o=0,l=e;o<l.length;o+=1){for(var p=[],y=0,v=l[o];y<v.length;y+=1){var I=v[y],k=[I.x+i[0],I.y+i[1]];mn(r,k),p.push(k)}t.push(p)}if(r[2]-r[0]<=S/2){(_=r)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(var L=0,O=t;L<O.length;L+=1)for(var B=0,q=O[L];B<q.length;B+=1)$s(q[B],r,a,S)}return t}oo.parse=function(e,r){if(e.length!==2)return r.error("Expected one argument.");var a=e[1];if(typeof a!="object"||Array.isArray(a))return r.error("Collator options argument must be an object.");var d=r.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,we);if(!d)return null;var _=r.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,we);if(!_)return null;var S=null;return a.locale&&!(S=r.parse(a.locale,1,Ee))?null:new oo(d,_,S)},oo.prototype.evaluate=function(e){return new qi(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)},oo.prototype.eachChild=function(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)},oo.prototype.outputDefined=function(){return!1},oo.prototype.serialize=function(){var e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]};var ao=function(e,r){this.type=we,this.geojson=e,this.geometries=r};function ea(e){if(e instanceof Br&&(e.name==="get"&&e.args.length===1||e.name==="feature-state"||e.name==="has"&&e.args.length===1||e.name==="properties"||e.name==="geometry-type"||e.name==="id"||/^filter-/.test(e.name))||e instanceof ao)return!1;var r=!0;return e.eachChild(function(a){r&&!ea(a)&&(r=!1)}),r}function ta(e){if(e instanceof Br&&e.name==="feature-state")return!1;var r=!0;return e.eachChild(function(a){r&&!ta(a)&&(r=!1)}),r}function La(e,r){if(e instanceof Br&&r.indexOf(e.name)>=0)return!1;var a=!0;return e.eachChild(function(d){a&&!La(d,r)&&(a=!1)}),a}ao.parse=function(e,r){if(e.length!==2)return r.error("'within' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(tr(e[1])){var a=e[1];if(a.type==="FeatureCollection")for(var d=0;d<a.features.length;++d){var _=a.features[d].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new ao(a,a.features[d].geometry)}else if(a.type==="Feature"){var S=a.geometry.type;if(S==="Polygon"||S==="MultiPolygon")return new ao(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new ao(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")},ao.prototype.evaluate=function(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,a){var d=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],S=r.canonicalID();if(a.type==="Polygon"){var i=fa(a.coordinates,_,S),t=$u(r.geometry(),d,_,S);if(!Qo(d,_))return!1;for(var o=0,l=t;o<l.length;o+=1)if(!is(l[o],i))return!1}if(a.type==="MultiPolygon"){var p=Xs(a.coordinates,_,S),y=$u(r.geometry(),d,_,S);if(!Qo(d,_))return!1;for(var v=0,I=y;v<I.length;v+=1)if(!on(I[v],p))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,a){var d=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],S=r.canonicalID();if(a.type==="Polygon"){var i=fa(a.coordinates,_,S),t=Ts(r.geometry(),d,_,S);if(!Qo(d,_))return!1;for(var o=0,l=t;o<l.length;o+=1)if(!mu(l[o],i))return!1}if(a.type==="MultiPolygon"){var p=Xs(a.coordinates,_,S),y=Ts(r.geometry(),d,_,S);if(!Qo(d,_))return!1;for(var v=0,I=y;v<I.length;v+=1)if(!gu(I[v],p))return!1}return!0}(e,this.geometries)}return!1},ao.prototype.eachChild=function(){},ao.prototype.outputDefined=function(){return!0},ao.prototype.serialize=function(){return["within",this.geojson]};var Ri=function(e,r){this.type=r.type,this.name=e,this.boundExpression=r};Ri.parse=function(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");var a=e[1];return r.scope.has(a)?new Ri(a,r.scope.get(a)):r.error('Unknown variable "'+a+'". Make sure "'+a+'" has been bound in an enclosing "let" expression before using it.',1)},Ri.prototype.evaluate=function(e){return this.boundExpression.evaluate(e)},Ri.prototype.eachChild=function(){},Ri.prototype.outputDefined=function(){return!1},Ri.prototype.serialize=function(){return["var",this.name]};var Da=function(e,r,a,d,_){r===void 0&&(r=[]),d===void 0&&(d=new se),_===void 0&&(_=[]),this.registry=e,this.path=r,this.key=r.map(function(S){return"["+S+"]"}).join(""),this.scope=d,this.errors=_,this.expectedType=a};function Ra(e,r){for(var a,d=e.length-1,_=0,S=d,i=0;_<=S;)if((a=e[i=Math.floor((_+S)/2)])<=r){if(i===d||r<e[i+1])return i;_=i+1}else{if(!(a>r))throw new Jr("Input is not a number.");S=i-1}return 0}Da.prototype.parse=function(e,r,a,d,_){return _===void 0&&(_={}),r?this.concat(r,a,d)._parse(e,_):this._parse(e,_)},Da.prototype._parse=function(e,r){function a(l,p,y){return y==="assert"?new pr(p,[l]):y==="coerce"?new Eo(p,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var d=e[0];if(typeof d!="string")return this.error("Expression name must be a string, but found "+typeof d+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var _=this.registry[d];if(_){var S=_.parse(e,this);if(!S)return null;if(this.expectedType){var i=this.expectedType,t=S.type;if(i.kind!=="string"&&i.kind!=="number"&&i.kind!=="boolean"&&i.kind!=="object"&&i.kind!=="array"||t.kind!=="value")if(i.kind!=="color"&&i.kind!=="formatted"&&i.kind!=="resolvedImage"||t.kind!=="value"&&t.kind!=="string"){if(this.checkSubtype(i,t))return null}else S=a(S,i,r.typeAnnotation||"coerce");else S=a(S,i,r.typeAnnotation||"assert")}if(!(S instanceof Vn)&&S.type.kind!=="resolvedImage"&&function l(p){if(p instanceof Ri)return l(p.boundExpression);if(p instanceof Br&&p.name==="error"||p instanceof oo||p instanceof ao)return!1;var y=p instanceof Eo||p instanceof pr,v=!0;return p.eachChild(function(I){v=y?v&&l(I):v&&I instanceof Vn}),!!v&&ea(p)&&La(p,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(S)){var o=new Lo;try{S=new Vn(S.type,S.evaluate(o))}catch(l){return this.error(l.message),null}}return S}return this.error('Unknown expression "'+d+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof e+" instead.")},Da.prototype.concat=function(e,r,a){var d=typeof e=="number"?this.path.concat(e):this.path,_=a?this.scope.concat(a):this.scope;return new Da(this.registry,d,r||null,_,this.errors)},Da.prototype.error=function(e){for(var r=[],a=arguments.length-1;a-- >0;)r[a]=arguments[a+1];var d=""+this.key+r.map(function(_){return"["+_+"]"}).join("");this.errors.push(new ee(d,e))},Da.prototype.checkSubtype=function(e,r){var a=Qt(e,r);return a&&this.error(a),a};var An=function(e,r,a){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(var d=0,_=a;d<_.length;d+=1){var S=_[d],i=S[1];this.labels.push(S[0]),this.outputs.push(i)}};function Or(e,r,a){return e*(1-a)+r*a}An.parse=function(e,r){if(e.length-1<4)return r.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");var a=r.parse(e[1],1,pe);if(!a)return null;var d=[],_=null;r.expectedType&&r.expectedType.kind!=="value"&&(_=r.expectedType);for(var S=1;S<e.length;S+=2){var i=S===1?-1/0:e[S],t=e[S+1],o=S,l=S+1;if(typeof i!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',o);if(d.length&&d[d.length-1][0]>=i)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',o);var p=r.parse(t,l,_);if(!p)return null;_=_||p.type,d.push([i,p])}return new An(_,a,d)},An.prototype.evaluate=function(e){var r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);var d=this.input.evaluate(e);if(d<=r[0])return a[0].evaluate(e);var _=r.length;return d>=r[_-1]?a[_-1].evaluate(e):a[Ra(r,d)].evaluate(e)},An.prototype.eachChild=function(e){e(this.input);for(var r=0,a=this.outputs;r<a.length;r+=1)e(a[r])},An.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},An.prototype.serialize=function(){for(var e=["step",this.input.serialize()],r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e};var In=Object.freeze({__proto__:null,number:Or,color:function(e,r,a){return new di(Or(e.r,r.r,a),Or(e.g,r.g,a),Or(e.b,r.b,a),Or(e.a,r.a,a))},array:function(e,r,a){return e.map(function(d,_){return Or(d,r[_],a)})}}),Cl=6/29*3*(6/29),zl=Math.PI/180,Pl=180/Math.PI;function Hs(e){return e>.008856451679035631?Math.pow(e,1/3):e/Cl+4/29}function Ws(e){return e>6/29?e*e*e:Cl*(e-4/29)}function As(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Ks(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function kl(e){var r=Ks(e.r),a=Ks(e.g),d=Ks(e.b),_=Hs((.4124564*r+.3575761*a+.1804375*d)/.95047),S=Hs((.2126729*r+.7151522*a+.072175*d)/1);return{l:116*S-16,a:500*(_-S),b:200*(S-Hs((.0193339*r+.119192*a+.9503041*d)/1.08883)),alpha:e.a}}function Js(e){var r=(e.l+16)/116,a=isNaN(e.a)?r:r+e.a/500,d=isNaN(e.b)?r:r-e.b/200;return r=1*Ws(r),a=.95047*Ws(a),d=1.08883*Ws(d),new di(As(3.2404542*a-1.5371385*r-.4985314*d),As(-.969266*a+1.8760108*r+.041556*d),As(.0556434*a-.2040259*r+1.0572252*d),e.alpha)}function Hu(e,r,a){var d=r-e;return e+a*(d>180||d<-180?d-360*Math.round(d/360):d)}var Is={forward:kl,reverse:Js,interpolate:function(e,r,a){return{l:Or(e.l,r.l,a),a:Or(e.a,r.a,a),b:Or(e.b,r.b,a),alpha:Or(e.alpha,r.alpha,a)}}},ia={forward:function(e){var r=kl(e),a=r.l,d=r.a,_=r.b,S=Math.atan2(_,d)*Pl;return{h:S<0?S+360:S,c:Math.sqrt(d*d+_*_),l:a,alpha:e.a}},reverse:function(e){var r=e.h*zl,a=e.c;return Js({l:e.l,a:Math.cos(r)*a,b:Math.sin(r)*a,alpha:e.alpha})},interpolate:function(e,r,a){return{h:Hu(e.h,r.h,a),c:Or(e.c,r.c,a),l:Or(e.l,r.l,a),alpha:Or(e.alpha,r.alpha,a)}}},Wu=Object.freeze({__proto__:null,lab:Is,hcl:ia}),Cn=function(e,r,a,d,_){this.type=e,this.operator=r,this.interpolation=a,this.input=d,this.labels=[],this.outputs=[];for(var S=0,i=_;S<i.length;S+=1){var t=i[S],o=t[1];this.labels.push(t[0]),this.outputs.push(o)}};function yu(e,r,a,d){var _=d-a,S=e-a;return _===0?0:r===1?S/_:(Math.pow(r,S)-1)/(Math.pow(r,_)-1)}Cn.interpolationFactor=function(e,r,a,d){var _=0;if(e.name==="exponential")_=yu(r,e.base,a,d);else if(e.name==="linear")_=yu(r,1,a,d);else if(e.name==="cubic-bezier"){var S=e.controlPoints;_=new Z(S[0],S[1],S[2],S[3]).solve(yu(r,1,a,d))}return _},Cn.parse=function(e,r){var a=e[0],d=e[1],_=e[2],S=e.slice(3);if(!Array.isArray(d)||d.length===0)return r.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){var i=d[1];if(typeof i!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:i}}else{if(d[0]!=="cubic-bezier")return r.error("Unknown interpolation type "+String(d[0]),1,0);var t=d.slice(1);if(t.length!==4||t.some(function(O){return typeof O!="number"||O<0||O>1}))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:t}}if(e.length-1<4)return r.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(!(_=r.parse(_,2,pe)))return null;var o=[],l=null;a==="interpolate-hcl"||a==="interpolate-lab"?l=Se:r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);for(var p=0;p<S.length;p+=2){var y=S[p],v=S[p+1],I=p+3,k=p+4;if(typeof y!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(o.length&&o[o.length-1][0]>=y)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',I);var L=r.parse(v,k,l);if(!L)return null;l=l||L.type,o.push([y,L])}return l.kind==="number"||l.kind==="color"||l.kind==="array"&&l.itemType.kind==="number"&&typeof l.N=="number"?new Cn(l,a,d,_,o):r.error("Type "+It(l)+" is not interpolatable.")},Cn.prototype.evaluate=function(e){var r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);var d=this.input.evaluate(e);if(d<=r[0])return a[0].evaluate(e);var _=r.length;if(d>=r[_-1])return a[_-1].evaluate(e);var S=Ra(r,d),i=Cn.interpolationFactor(this.interpolation,d,r[S],r[S+1]),t=a[S].evaluate(e),o=a[S+1].evaluate(e);return this.operator==="interpolate"?In[this.type.kind.toLowerCase()](t,o,i):this.operator==="interpolate-hcl"?ia.reverse(ia.interpolate(ia.forward(t),ia.forward(o),i)):Is.reverse(Is.interpolate(Is.forward(t),Is.forward(o),i))},Cn.prototype.eachChild=function(e){e(this.input);for(var r=0,a=this.outputs;r<a.length;r+=1)e(a[r])},Cn.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},Cn.prototype.serialize=function(){var e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var r=[this.operator,e,this.input.serialize()],a=0;a<this.labels.length;a++)r.push(this.labels[a],this.outputs[a].serialize());return r};var Ba=function(e,r){this.type=e,this.args=r};Ba.parse=function(e,r){if(e.length<2)return r.error("Expectected at least one argument.");var a=null,d=r.expectedType;d&&d.kind!=="value"&&(a=d);for(var _=[],S=0,i=e.slice(1);S<i.length;S+=1){var t=r.parse(i[S],1+_.length,a,void 0,{typeAnnotation:"omit"});if(!t)return null;a=a||t.type,_.push(t)}var o=d&&_.some(function(l){return Qt(d,l.type)});return new Ba(o?je:a,_)},Ba.prototype.evaluate=function(e){for(var r,a=null,d=0,_=0,S=this.args;_<S.length&&(d++,(a=S[_].evaluate(e))&&a instanceof Ln&&!a.available&&(r||(r=a.name),a=null,d===this.args.length&&(a=r)),a===null);_+=1);return a},Ba.prototype.eachChild=function(e){this.args.forEach(e)},Ba.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},Ba.prototype.serialize=function(){var e=["coalesce"];return this.eachChild(function(r){e.push(r.serialize())}),e};var Oa=function(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r};Oa.prototype.evaluate=function(e){return this.result.evaluate(e)},Oa.prototype.eachChild=function(e){for(var r=0,a=this.bindings;r<a.length;r+=1)e(a[r][1]);e(this.result)},Oa.parse=function(e,r){if(e.length<4)return r.error("Expected at least 3 arguments, but found "+(e.length-1)+" instead.");for(var a=[],d=1;d<e.length-1;d+=2){var _=e[d];if(typeof _!="string")return r.error("Expected string, but found "+typeof _+" instead.",d);if(/[^a-zA-Z0-9_]/.test(_))return r.error("Variable names must contain only alphanumeric characters or '_'.",d);var S=r.parse(e[d+1],d+1);if(!S)return null;a.push([_,S])}var i=r.parse(e[e.length-1],e.length-1,r.expectedType,a);return i?new Oa(a,i):null},Oa.prototype.outputDefined=function(){return this.result.outputDefined()},Oa.prototype.serialize=function(){for(var e=["let"],r=0,a=this.bindings;r<a.length;r+=1){var d=a[r];e.push(d[0],d[1].serialize())}return e.push(this.result.serialize()),e};var rs=function(e,r,a){this.type=e,this.index=r,this.input=a};rs.parse=function(e,r){if(e.length!==3)return r.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var a=r.parse(e[1],1,pe),d=r.parse(e[2],2,wt(r.expectedType||je));return a&&d?new rs(d.type.itemType,a,d):null},rs.prototype.evaluate=function(e){var r=this.index.evaluate(e),a=this.input.evaluate(e);if(r<0)throw new Jr("Array index out of bounds: "+r+" < 0.");if(r>=a.length)throw new Jr("Array index out of bounds: "+r+" > "+(a.length-1)+".");if(r!==Math.floor(r))throw new Jr("Array index must be an integer, but found "+r+" instead.");return a[r]},rs.prototype.eachChild=function(e){e(this.index),e(this.input)},rs.prototype.outputDefined=function(){return!1},rs.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var ma=function(e,r){this.type=we,this.needle=e,this.haystack=r};ma.parse=function(e,r){if(e.length!==3)return r.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var a=r.parse(e[1],1,je),d=r.parse(e[2],2,je);return a&&d?ni(a.type,[we,Ee,pe,ge,je])?new ma(a,d):r.error("Expected first argument to be of type boolean, string, number or null, but found "+It(a.type)+" instead"):null},ma.prototype.evaluate=function(e){var r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!a)return!1;if(!$t(r,["boolean","string","number","null"]))throw new Jr("Expected first argument to be of type boolean, string, number or null, but found "+It(Rr(r))+" instead.");if(!$t(a,["string","array"]))throw new Jr("Expected second argument to be of type array or string, but found "+It(Rr(a))+" instead.");return a.indexOf(r)>=0},ma.prototype.eachChild=function(e){e(this.needle),e(this.haystack)},ma.prototype.outputDefined=function(){return!0},ma.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var ra=function(e,r,a){this.type=pe,this.needle=e,this.haystack=r,this.fromIndex=a};ra.parse=function(e,r){if(e.length<=2||e.length>=5)return r.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var a=r.parse(e[1],1,je),d=r.parse(e[2],2,je);if(!a||!d)return null;if(!ni(a.type,[we,Ee,pe,ge,je]))return r.error("Expected first argument to be of type boolean, string, number or null, but found "+It(a.type)+" instead");if(e.length===4){var _=r.parse(e[3],3,pe);return _?new ra(a,d,_):null}return new ra(a,d)},ra.prototype.evaluate=function(e){var r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!$t(r,["boolean","string","number","null"]))throw new Jr("Expected first argument to be of type boolean, string, number or null, but found "+It(Rr(r))+" instead.");if(!$t(a,["string","array"]))throw new Jr("Expected second argument to be of type array or string, but found "+It(Rr(a))+" instead.");if(this.fromIndex){var d=this.fromIndex.evaluate(e);return a.indexOf(r,d)}return a.indexOf(r)},ra.prototype.eachChild=function(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)},ra.prototype.outputDefined=function(){return!1},ra.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Do=function(e,r,a,d,_,S){this.inputType=e,this.type=r,this.input=a,this.cases=d,this.outputs=_,this.otherwise=S};Do.parse=function(e,r){if(e.length<5)return r.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if(e.length%2!=1)return r.error("Expected an even number of arguments.");var a,d;r.expectedType&&r.expectedType.kind!=="value"&&(d=r.expectedType);for(var _={},S=[],i=2;i<e.length-1;i+=2){var t=e[i],o=e[i+1];Array.isArray(t)||(t=[t]);var l=r.concat(i);if(t.length===0)return l.error("Expected at least one branch label.");for(var p=0,y=t;p<y.length;p+=1){var v=y[p];if(typeof v!="number"&&typeof v!="string")return l.error("Branch labels must be numbers or strings.");if(typeof v=="number"&&Math.abs(v)>Number.MAX_SAFE_INTEGER)return l.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof v=="number"&&Math.floor(v)!==v)return l.error("Numeric branch labels must be integer values.");if(a){if(l.checkSubtype(a,Rr(v)))return null}else a=Rr(v);if(_[String(v)]!==void 0)return l.error("Branch labels must be unique.");_[String(v)]=S.length}var I=r.parse(o,i,d);if(!I)return null;d=d||I.type,S.push(I)}var k=r.parse(e[1],1,je);if(!k)return null;var L=r.parse(e[e.length-1],e.length-1,d);return L?k.type.kind!=="value"&&r.concat(1).checkSubtype(a,k.type)?null:new Do(a,d,k,_,S,L):null},Do.prototype.evaluate=function(e){var r=this.input.evaluate(e);return(Rr(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)},Do.prototype.eachChild=function(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)},Do.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})&&this.otherwise.outputDefined()},Do.prototype.serialize=function(){for(var e=this,r=["match",this.input.serialize()],a=[],d={},_=0,S=Object.keys(this.cases).sort();_<S.length;_+=1){var i=S[_];(y=d[this.cases[i]])===void 0?(d[this.cases[i]]=a.length,a.push([this.cases[i],[i]])):a[y][1].push(i)}for(var t=function(I){return e.inputType.kind==="number"?Number(I):I},o=0,l=a;o<l.length;o+=1){var p=l[o],y=p[0],v=p[1];r.push(v.length===1?t(v[0]):v.map(t)),r.push(this.outputs[outputIndex$1].serialize())}return r.push(this.otherwise.serialize()),r};var Fa=function(e,r,a){this.type=e,this.branches=r,this.otherwise=a};Fa.parse=function(e,r){if(e.length<4)return r.error("Expected at least 3 arguments, but found only "+(e.length-1)+".");if(e.length%2!=0)return r.error("Expected an odd number of arguments.");var a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);for(var d=[],_=1;_<e.length-1;_+=2){var S=r.parse(e[_],_,we);if(!S)return null;var i=r.parse(e[_+1],_+1,a);if(!i)return null;d.push([S,i]),a=a||i.type}var t=r.parse(e[e.length-1],e.length-1,a);return t?new Fa(a,d,t):null},Fa.prototype.evaluate=function(e){for(var r=0,a=this.branches;r<a.length;r+=1){var d=a[r],_=d[1];if(d[0].evaluate(e))return _.evaluate(e)}return this.otherwise.evaluate(e)},Fa.prototype.eachChild=function(e){for(var r=0,a=this.branches;r<a.length;r+=1){var d=a[r],_=d[1];e(d[0]),e(_)}e(this.otherwise)},Fa.prototype.outputDefined=function(){return this.branches.every(function(e){return e[1].outputDefined()})&&this.otherwise.outputDefined()},Fa.prototype.serialize=function(){var e=["case"];return this.eachChild(function(r){e.push(r.serialize())}),e};var ga=function(e,r,a,d){this.type=e,this.input=r,this.beginIndex=a,this.endIndex=d};function Ml(e,r){return e==="=="||e==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function Ua(e,r,a,d){return d.compare(r,a)===0}function ir(e,r,a){var d=e!=="=="&&e!=="!=";return function(){function _(S,i,t){this.type=we,this.lhs=S,this.rhs=i,this.collator=t,this.hasUntypedArgument=S.type.kind==="value"||i.type.kind==="value"}return _.parse=function(S,i){if(S.length!==3&&S.length!==4)return i.error("Expected two or three arguments.");var t=S[0],o=i.parse(S[1],1,je);if(!o)return null;if(!Ml(t,o.type))return i.concat(1).error('"'+t+`" comparisons are not supported for type '`+It(o.type)+"'.");var l=i.parse(S[2],2,je);if(!l)return null;if(!Ml(t,l.type))return i.concat(2).error('"'+t+`" comparisons are not supported for type '`+It(l.type)+"'.");if(o.type.kind!==l.type.kind&&o.type.kind!=="value"&&l.type.kind!=="value")return i.error("Cannot compare types '"+It(o.type)+"' and '"+It(l.type)+"'.");d&&(o.type.kind==="value"&&l.type.kind!=="value"?o=new pr(l.type,[o]):o.type.kind!=="value"&&l.type.kind==="value"&&(l=new pr(o.type,[l])));var p=null;if(S.length===4){if(o.type.kind!=="string"&&l.type.kind!=="string"&&o.type.kind!=="value"&&l.type.kind!=="value")return i.error("Cannot use collator to compare non-string types.");if(!(p=i.parse(S[3],3,He)))return null}return new _(o,l,p)},_.prototype.evaluate=function(S){var i=this.lhs.evaluate(S),t=this.rhs.evaluate(S);if(d&&this.hasUntypedArgument){var o=Rr(i),l=Rr(t);if(o.kind!==l.kind||o.kind!=="string"&&o.kind!=="number")throw new Jr('Expected arguments for "'+e+'" to be (string, string) or (number, number), but found ('+o.kind+", "+l.kind+") instead.")}if(this.collator&&!d&&this.hasUntypedArgument){var p=Rr(i),y=Rr(t);if(p.kind!=="string"||y.kind!=="string")return r(S,i,t)}return this.collator?a(S,i,t,this.collator.evaluate(S)):r(S,i,t)},_.prototype.eachChild=function(S){S(this.lhs),S(this.rhs),this.collator&&S(this.collator)},_.prototype.outputDefined=function(){return!0},_.prototype.serialize=function(){var S=[e];return this.eachChild(function(i){S.push(i.serialize())}),S},_}()}ga.parse=function(e,r){if(e.length<=2||e.length>=5)return r.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var a=r.parse(e[1],1,je),d=r.parse(e[2],2,pe);if(!a||!d)return null;if(!ni(a.type,[wt(je),Ee,je]))return r.error("Expected first argument to be of type array or string, but found "+It(a.type)+" instead");if(e.length===4){var _=r.parse(e[3],3,pe);return _?new ga(a.type,a,d,_):null}return new ga(a.type,a,d)},ga.prototype.evaluate=function(e){var r=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!$t(r,["string","array"]))throw new Jr("Expected first argument to be of type array or string, but found "+It(Rr(r))+" instead.");if(this.endIndex){var d=this.endIndex.evaluate(e);return r.slice(a,d)}return r.slice(a)},ga.prototype.eachChild=function(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)},ga.prototype.outputDefined=function(){return!1},ga.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var ns=ir("==",function(e,r,a){return r===a},Ua),ya=ir("!=",function(e,r,a){return r!==a},function(e,r,a,d){return!Ua(0,r,a,d)}),_u=ir("<",function(e,r,a){return r<a},function(e,r,a,d){return d.compare(r,a)<0}),Ll=ir(">",function(e,r,a){return r>a},function(e,r,a,d){return d.compare(r,a)>0}),Si=ir("<=",function(e,r,a){return r<=a},function(e,r,a,d){return d.compare(r,a)<=0}),Ys=ir(">=",function(e,r,a){return r>=a},function(e,r,a,d){return d.compare(r,a)>=0}),Ni=function(e,r,a,d,_){this.type=Ee,this.number=e,this.locale=r,this.currency=a,this.minFractionDigits=d,this.maxFractionDigits=_};Ni.parse=function(e,r){if(e.length!==3)return r.error("Expected two arguments.");var a=r.parse(e[1],1,pe);if(!a)return null;var d=e[2];if(typeof d!="object"||Array.isArray(d))return r.error("NumberFormat options argument must be an object.");var _=null;if(d.locale&&!(_=r.parse(d.locale,1,Ee)))return null;var S=null;if(d.currency&&!(S=r.parse(d.currency,1,Ee)))return null;var i=null;if(d["min-fraction-digits"]&&!(i=r.parse(d["min-fraction-digits"],1,pe)))return null;var t=null;return d["max-fraction-digits"]&&!(t=r.parse(d["max-fraction-digits"],1,pe))?null:new Ni(a,_,S,i,t)},Ni.prototype.evaluate=function(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))},Ni.prototype.eachChild=function(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)},Ni.prototype.outputDefined=function(){return!1},Ni.prototype.serialize=function(){var e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]};var No=function(e){this.type=pe,this.input=e};No.parse=function(e,r){if(e.length!==2)return r.error("Expected 1 argument, but found "+(e.length-1)+" instead.");var a=r.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?r.error("Expected argument of type string or array, but found "+It(a.type)+" instead."):new No(a):null},No.prototype.evaluate=function(e){var r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Jr("Expected value to be of type string or array, but found "+It(Rr(r))+" instead.")},No.prototype.eachChild=function(e){e(this.input)},No.prototype.outputDefined=function(){return!1},No.prototype.serialize=function(){var e=["length"];return this.eachChild(function(r){e.push(r.serialize())}),e};var sr={"==":ns,"!=":ya,">":Ll,"<":_u,">=":Ys,"<=":Si,array:pr,at:rs,boolean:pr,case:Fa,coalesce:Ba,collator:oo,format:wo,image:Kn,in:ma,"index-of":ra,interpolate:Cn,"interpolate-hcl":Cn,"interpolate-lab":Cn,length:No,let:Oa,literal:Vn,match:Do,number:pr,"number-format":Ni,object:pr,slice:ga,step:An,string:pr,"to-boolean":Eo,"to-color":Eo,"to-number":Eo,"to-string":Eo,var:Ri,within:ao};function Fr(e,r){var a=r[0],d=r[1],_=r[2],S=r[3];a=a.evaluate(e),d=d.evaluate(e),_=_.evaluate(e);var i=S?S.evaluate(e):1,t=Gs(a,d,_,i);if(t)throw new Jr(t);return new di(a/255*i,d/255*i,_/255*i,i)}function Qs(e,r){return e in r}function el(e,r){var a=r[e];return a===void 0?null:a}function os(e){return{type:e}}function Dl(e){return{result:"success",value:e}}function na(e){return{result:"error",value:e}}function oa(e){return e["property-type"]==="data-driven"||e["property-type"]==="cross-faded-data-driven"}function tl(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Va(e){return!!e.expression&&e.expression.interpolated}function lr(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":e===null?"null":typeof e}function _a(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function Rl(e){return e}function Nn(e,r,a){return e!==void 0?e:r!==void 0?r:a!==void 0?a:void 0}function vu(e,r,a,d,_){return Nn(typeof a===_?d[a]:void 0,e.default,r.default)}function Ku(e,r,a){if(lr(a)!=="number")return Nn(e.default,r.default);var d=e.stops.length;if(d===1||a<=e.stops[0][0])return e.stops[0][1];if(a>=e.stops[d-1][0])return e.stops[d-1][1];var _=Ra(e.stops.map(function(S){return S[0]}),a);return e.stops[_][1]}function xu(e,r,a){var d=e.base!==void 0?e.base:1;if(lr(a)!=="number")return Nn(e.default,r.default);var _=e.stops.length;if(_===1||a<=e.stops[0][0])return e.stops[0][1];if(a>=e.stops[_-1][0])return e.stops[_-1][1];var S=Ra(e.stops.map(function(y){return y[0]}),a),i=function(y,v,I,k){var L=k-I,O=y-I;return L===0?0:v===1?O/L:(Math.pow(v,O)-1)/(Math.pow(v,L)-1)}(a,d,e.stops[S][0],e.stops[S+1][0]),t=e.stops[S][1],o=e.stops[S+1][1],l=In[r.type]||Rl;if(e.colorSpace&&e.colorSpace!=="rgb"){var p=Wu[e.colorSpace];l=function(y,v){return p.reverse(p.interpolate(p.forward(y),p.forward(v),i))}}return typeof t.evaluate=="function"?{evaluate:function(){for(var y=[],v=arguments.length;v--;)y[v]=arguments[v];var I=t.evaluate.apply(void 0,y),k=o.evaluate.apply(void 0,y);if(I!==void 0&&k!==void 0)return l(I,k,i)}}:l(t,o,i)}function va(e,r,a){return r.type==="color"?a=di.parse(a):r.type==="formatted"?a=Xi.fromString(a.toString()):r.type==="resolvedImage"?a=Ln.fromString(a.toString()):lr(a)===r.type||r.type==="enum"&&r.values[a]||(a=void 0),Nn(a,e.default,r.default)}Br.register(sr,{error:[{kind:"error"},[Ee],function(e,r){throw new Jr(r[0].evaluate(e))}],typeof:[Ee,[je],function(e,r){return It(Rr(r[0].evaluate(e)))}],"to-rgba":[wt(pe,4),[Se],function(e,r){return r[0].evaluate(e).toArray()}],rgb:[Se,[pe,pe,pe],Fr],rgba:[Se,[pe,pe,pe,pe],Fr],has:{type:we,overloads:[[[Ee],function(e,r){return Qs(r[0].evaluate(e),e.properties())}],[[Ee,$e],function(e,r){var a=r[1];return Qs(r[0].evaluate(e),a.evaluate(e))}]]},get:{type:je,overloads:[[[Ee],function(e,r){return el(r[0].evaluate(e),e.properties())}],[[Ee,$e],function(e,r){var a=r[1];return el(r[0].evaluate(e),a.evaluate(e))}]]},"feature-state":[je,[Ee],function(e,r){return el(r[0].evaluate(e),e.featureState||{})}],properties:[$e,[],function(e){return e.properties()}],"geometry-type":[Ee,[],function(e){return e.geometryType()}],id:[je,[],function(e){return e.id()}],zoom:[pe,[],function(e){return e.globals.zoom}],"heatmap-density":[pe,[],function(e){return e.globals.heatmapDensity||0}],"line-progress":[pe,[],function(e){return e.globals.lineProgress||0}],accumulated:[je,[],function(e){return e.globals.accumulated===void 0?null:e.globals.accumulated}],"+":[pe,os(pe),function(e,r){for(var a=0,d=0,_=r;d<_.length;d+=1)a+=_[d].evaluate(e);return a}],"*":[pe,os(pe),function(e,r){for(var a=1,d=0,_=r;d<_.length;d+=1)a*=_[d].evaluate(e);return a}],"-":{type:pe,overloads:[[[pe,pe],function(e,r){var a=r[1];return r[0].evaluate(e)-a.evaluate(e)}],[[pe],function(e,r){return-r[0].evaluate(e)}]]},"/":[pe,[pe,pe],function(e,r){var a=r[1];return r[0].evaluate(e)/a.evaluate(e)}],"%":[pe,[pe,pe],function(e,r){var a=r[1];return r[0].evaluate(e)%a.evaluate(e)}],ln2:[pe,[],function(){return Math.LN2}],pi:[pe,[],function(){return Math.PI}],e:[pe,[],function(){return Math.E}],"^":[pe,[pe,pe],function(e,r){var a=r[1];return Math.pow(r[0].evaluate(e),a.evaluate(e))}],sqrt:[pe,[pe],function(e,r){return Math.sqrt(r[0].evaluate(e))}],log10:[pe,[pe],function(e,r){return Math.log(r[0].evaluate(e))/Math.LN10}],ln:[pe,[pe],function(e,r){return Math.log(r[0].evaluate(e))}],log2:[pe,[pe],function(e,r){return Math.log(r[0].evaluate(e))/Math.LN2}],sin:[pe,[pe],function(e,r){return Math.sin(r[0].evaluate(e))}],cos:[pe,[pe],function(e,r){return Math.cos(r[0].evaluate(e))}],tan:[pe,[pe],function(e,r){return Math.tan(r[0].evaluate(e))}],asin:[pe,[pe],function(e,r){return Math.asin(r[0].evaluate(e))}],acos:[pe,[pe],function(e,r){return Math.acos(r[0].evaluate(e))}],atan:[pe,[pe],function(e,r){return Math.atan(r[0].evaluate(e))}],min:[pe,os(pe),function(e,r){return Math.min.apply(Math,r.map(function(a){return a.evaluate(e)}))}],max:[pe,os(pe),function(e,r){return Math.max.apply(Math,r.map(function(a){return a.evaluate(e)}))}],abs:[pe,[pe],function(e,r){return Math.abs(r[0].evaluate(e))}],round:[pe,[pe],function(e,r){var a=r[0].evaluate(e);return a<0?-Math.round(-a):Math.round(a)}],floor:[pe,[pe],function(e,r){return Math.floor(r[0].evaluate(e))}],ceil:[pe,[pe],function(e,r){return Math.ceil(r[0].evaluate(e))}],"filter-==":[we,[Ee,je],function(e,r){var a=r[0],d=r[1];return e.properties()[a.value]===d.value}],"filter-id-==":[we,[je],function(e,r){var a=r[0];return e.id()===a.value}],"filter-type-==":[we,[Ee],function(e,r){var a=r[0];return e.geometryType()===a.value}],"filter-<":[we,[Ee,je],function(e,r){var a=r[0],d=r[1],_=e.properties()[a.value],S=d.value;return typeof _==typeof S&&_<S}],"filter-id-<":[we,[je],function(e,r){var a=r[0],d=e.id(),_=a.value;return typeof d==typeof _&&d<_}],"filter->":[we,[Ee,je],function(e,r){var a=r[0],d=r[1],_=e.properties()[a.value],S=d.value;return typeof _==typeof S&&_>S}],"filter-id->":[we,[je],function(e,r){var a=r[0],d=e.id(),_=a.value;return typeof d==typeof _&&d>_}],"filter-<=":[we,[Ee,je],function(e,r){var a=r[0],d=r[1],_=e.properties()[a.value],S=d.value;return typeof _==typeof S&&_<=S}],"filter-id-<=":[we,[je],function(e,r){var a=r[0],d=e.id(),_=a.value;return typeof d==typeof _&&d<=_}],"filter->=":[we,[Ee,je],function(e,r){var a=r[0],d=r[1],_=e.properties()[a.value],S=d.value;return typeof _==typeof S&&_>=S}],"filter-id->=":[we,[je],function(e,r){var a=r[0],d=e.id(),_=a.value;return typeof d==typeof _&&d>=_}],"filter-has":[we,[je],function(e,r){return r[0].value in e.properties()}],"filter-has-id":[we,[],function(e){return e.id()!==null&&e.id()!==void 0}],"filter-type-in":[we,[wt(Ee)],function(e,r){return r[0].value.indexOf(e.geometryType())>=0}],"filter-id-in":[we,[wt(je)],function(e,r){return r[0].value.indexOf(e.id())>=0}],"filter-in-small":[we,[Ee,wt(je)],function(e,r){var a=r[0];return r[1].value.indexOf(e.properties()[a.value])>=0}],"filter-in-large":[we,[Ee,wt(je)],function(e,r){var a=r[0],d=r[1];return function(_,S,i,t){for(;i<=t;){var o=i+t>>1;if(S[o]===_)return!0;S[o]>_?t=o-1:i=o+1}return!1}(e.properties()[a.value],d.value,0,d.value.length-1)}],all:{type:we,overloads:[[[we,we],function(e,r){var a=r[1];return r[0].evaluate(e)&&a.evaluate(e)}],[os(we),function(e,r){for(var a=0,d=r;a<d.length;a+=1)if(!d[a].evaluate(e))return!1;return!0}]]},any:{type:we,overloads:[[[we,we],function(e,r){var a=r[1];return r[0].evaluate(e)||a.evaluate(e)}],[os(we),function(e,r){for(var a=0,d=r;a<d.length;a+=1)if(d[a].evaluate(e))return!0;return!1}]]},"!":[we,[we],function(e,r){return!r[0].evaluate(e)}],"is-supported-script":[we,[Ee],function(e,r){var a=e.globals&&e.globals.isSupportedScript;return!a||a(r[0].evaluate(e))}],upcase:[Ee,[Ee],function(e,r){return r[0].evaluate(e).toUpperCase()}],downcase:[Ee,[Ee],function(e,r){return r[0].evaluate(e).toLowerCase()}],concat:[Ee,os(je),function(e,r){return r.map(function(a){return es(a.evaluate(e))}).join("")}],"resolved-locale":[Ee,[He],function(e,r){return r[0].evaluate(e).resolvedLocale()}]});var xa=function(e,r){this.expression=e,this._warningHistory={},this._evaluator=new Lo,this._defaultValue=r?function(a){return a.type==="color"&&_a(a.default)?new di(0,0,0,0):a.type==="color"?di.parse(a.default)||null:a.default===void 0?null:a.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null};function as(e){return Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0]in sr}function il(e,r){var a=new Da(sr,[],r?function(_){var S={color:Se,string:Ee,number:pe,enum:Ee,boolean:we,formatted:Tt,resolvedImage:ft};return _.type==="array"?wt(S[_.value]||je,_.length):S[_.type]}(r):void 0),d=a.parse(e,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?Dl(new xa(d,r)):na(a.errors)}xa.prototype.evaluateWithoutErrorHandling=function(e,r,a,d,_,S){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=d,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=S,this.expression.evaluate(this._evaluator)},xa.prototype.evaluate=function(e,r,a,d,_,S){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=d,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=S||null;try{var i=this.expression.evaluate(this._evaluator);if(i==null||typeof i=="number"&&i!=i)return this._defaultValue;if(this._enumValues&&!(i in this._enumValues))throw new Jr("Expected value to be one of "+Object.keys(this._enumValues).map(function(t){return JSON.stringify(t)}).join(", ")+", but found "+JSON.stringify(i)+" instead.");return i}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,typeof console!="undefined"&&console.warn(t.message)),this._defaultValue}};var Na=function(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!ta(r.expression)};Na.prototype.evaluateWithoutErrorHandling=function(e,r,a,d,_,S){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,d,_,S)},Na.prototype.evaluate=function(e,r,a,d,_,S){return this._styleExpression.evaluate(e,r,a,d,_,S)};var ba=function(e,r,a,d){this.kind=e,this.zoomStops=a,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!ta(r.expression),this.interpolationType=d};function bu(e,r){if((e=il(e,r)).result==="error")return e;var a=e.value.expression,d=ea(a);if(!d&&!oa(r))return na([new ee("","data expressions not supported")]);var _=La(a,["zoom"]);if(!_&&!tl(r))return na([new ee("","zoom expressions not supported")]);var S=function i(t){var o=null;if(t instanceof Oa)o=i(t.result);else if(t instanceof Ba)for(var l=0,p=t.args;l<p.length&&!(o=i(p[l]));l+=1);else(t instanceof An||t instanceof Cn)&&t.input instanceof Br&&t.input.name==="zoom"&&(o=t);return o instanceof ee||t.eachChild(function(y){var v=i(y);v instanceof ee?o=v:!o&&v?o=new ee("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&v&&o!==v&&(o=new ee("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}(a);return S||_?S instanceof ee?na([S]):S instanceof Cn&&!Va(r)?na([new ee("",'"interpolate" expressions cannot be used with this property')]):Dl(S?new ba(d?"camera":"composite",e.value,S.labels,S instanceof Cn?S.interpolation:void 0):new Na(d?"constant":"source",e.value)):na([new ee("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}ba.prototype.evaluateWithoutErrorHandling=function(e,r,a,d,_,S){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,d,_,S)},ba.prototype.evaluate=function(e,r,a,d,_,S){return this._styleExpression.evaluate(e,r,a,d,_,S)},ba.prototype.interpolationFactor=function(e,r,a){return this.interpolationType?Cn.interpolationFactor(this.interpolationType,e,r,a):0};var aa=function(e,r){this._parameters=e,this._specification=r,ie(this,function a(d,_){var S,i,t,o=_.type==="color",l=d.stops&&typeof d.stops[0][0]=="object",p=l||!(l||d.property!==void 0),y=d.type||(Va(_)?"exponential":"interval");if(o&&((d=ie({},d)).stops&&(d.stops=d.stops.map(function(Ue){return[Ue[0],di.parse(Ue[1])]})),d.default=di.parse(d.default?d.default:_.default)),d.colorSpace&&d.colorSpace!=="rgb"&&!Wu[d.colorSpace])throw new Error("Unknown color space: "+d.colorSpace);if(y==="exponential")S=xu;else if(y==="interval")S=Ku;else if(y==="categorical"){S=vu,i=Object.create(null);for(var v=0,I=d.stops;v<I.length;v+=1){var k=I[v];i[k[0]]=k[1]}t=typeof d.stops[0][0]}else{if(y!=="identity")throw new Error('Unknown function type "'+y+'"');S=va}if(l){for(var L={},O=[],B=0;B<d.stops.length;B++){var q=d.stops[B],$=q[0].zoom;L[$]===void 0&&(L[$]={zoom:$,type:d.type,property:d.property,default:d.default,stops:[]},O.push($)),L[$].stops.push([q[0].value,q[1]])}for(var W=[],ne=0,ue=O;ne<ue.length;ne+=1){var Ie=ue[ne];W.push([L[Ie].zoom,a(L[Ie],_)])}var De={name:"linear"};return{kind:"composite",interpolationType:De,interpolationFactor:Cn.interpolationFactor.bind(void 0,De),zoomStops:W.map(function(Ue){return Ue[0]}),evaluate:function(Ue,We){var Ve=Ue.zoom;return xu({stops:W,base:d.base},_,Ve).evaluate(Ve,We)}}}if(p){var Fe=y==="exponential"?{name:"exponential",base:d.base!==void 0?d.base:1}:null;return{kind:"camera",interpolationType:Fe,interpolationFactor:Cn.interpolationFactor.bind(void 0,Fe),zoomStops:d.stops.map(function(Ue){return Ue[0]}),evaluate:function(Ue){return S(d,_,Ue.zoom,i,t)}}}return{kind:"source",evaluate:function(Ue,We){var Ve=We&&We.properties?We.properties[d.property]:void 0;return Ve===void 0?Nn(d.default,_.default):S(d,_,Ve,i,t)}}}(this._parameters,this._specification))};function So(e){var r=e.key,a=e.value,d=e.valueSpec||{},_=e.objectElementValidators||{},S=e.style,i=e.styleSpec,t=[],o=lr(a);if(o!=="object")return[new Pe(r,a,"object expected, "+o+" found")];for(var l in a){var p=l.split(".")[0],y=d[p]||d["*"],v=void 0;if(_[p])v=_[p];else if(d[p])v=Ii;else if(_["*"])v=_["*"];else{if(!d["*"]){t.push(new Pe(r,a[l],'unknown property "'+l+'"'));continue}v=Ii}t=t.concat(v({key:(r&&r+".")+l,value:a[l],valueSpec:y,style:S,styleSpec:i,object:a,objectKey:l},a))}for(var I in d)_[I]||d[I].required&&d[I].default===void 0&&a[I]===void 0&&t.push(new Pe(r,a,'missing required property "'+I+'"'));return t}function rl(e){var r=e.value,a=e.valueSpec,d=e.style,_=e.styleSpec,S=e.key,i=e.arrayElementValidator||Ii;if(lr(r)!=="array")return[new Pe(S,r,"array expected, "+lr(r)+" found")];if(a.length&&r.length!==a.length)return[new Pe(S,r,"array length "+a.length+" expected, length "+r.length+" found")];if(a["min-length"]&&r.length<a["min-length"])return[new Pe(S,r,"array length at least "+a["min-length"]+" expected, length "+r.length+" found")];var t={type:a.value,values:a.values};_.$version<7&&(t.function=a.function),lr(a.value)==="object"&&(t=a.value);for(var o=[],l=0;l<r.length;l++)o=o.concat(i({array:r,arrayIndex:l,value:r[l],valueSpec:t,style:d,styleSpec:_,key:S+"["+l+"]"}));return o}function nl(e){var r=e.key,a=e.value,d=e.valueSpec,_=lr(a);return _==="number"&&a!=a&&(_="NaN"),_!=="number"?[new Pe(r,a,"number expected, "+_+" found")]:"minimum"in d&&a<d.minimum?[new Pe(r,a,a+" is less than the minimum value "+d.minimum)]:"maximum"in d&&a>d.maximum?[new Pe(r,a,a+" is greater than the maximum value "+d.maximum)]:[]}function ss(e){var r,a,d,_=e.valueSpec,S=N(e.value.type),i={},t=S!=="categorical"&&e.value.property===void 0,o=!t,l=lr(e.value.stops)==="array"&&lr(e.value.stops[0])==="array"&&lr(e.value.stops[0][0])==="object",p=So({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(I){if(S==="identity")return[new Pe(I.key,I.value,'identity function may not have a "stops" property')];var k=[],L=I.value;return k=k.concat(rl({key:I.key,value:L,valueSpec:I.valueSpec,style:I.style,styleSpec:I.styleSpec,arrayElementValidator:y})),lr(L)==="array"&&L.length===0&&k.push(new Pe(I.key,L,"array must have at least one stop")),k},default:function(I){return Ii({key:I.key,value:I.value,valueSpec:_,style:I.style,styleSpec:I.styleSpec})}}});return S==="identity"&&t&&p.push(new Pe(e.key,e.value,'missing required property "property"')),S==="identity"||e.value.stops||p.push(new Pe(e.key,e.value,'missing required property "stops"')),S==="exponential"&&e.valueSpec.expression&&!Va(e.valueSpec)&&p.push(new Pe(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(o&&!oa(e.valueSpec)?p.push(new Pe(e.key,e.value,"property functions not supported")):t&&!tl(e.valueSpec)&&p.push(new Pe(e.key,e.value,"zoom functions not supported"))),S!=="categorical"&&!l||e.value.property!==void 0||p.push(new Pe(e.key,e.value,'"property" property is required')),p;function y(I){var k=[],L=I.value,O=I.key;if(lr(L)!=="array")return[new Pe(O,L,"array expected, "+lr(L)+" found")];if(L.length!==2)return[new Pe(O,L,"array length 2 expected, length "+L.length+" found")];if(l){if(lr(L[0])!=="object")return[new Pe(O,L,"object expected, "+lr(L[0])+" found")];if(L[0].zoom===void 0)return[new Pe(O,L,"object stop key must have zoom")];if(L[0].value===void 0)return[new Pe(O,L,"object stop key must have value")];if(d&&d>N(L[0].zoom))return[new Pe(O,L[0].zoom,"stop zoom values must appear in ascending order")];N(L[0].zoom)!==d&&(d=N(L[0].zoom),a=void 0,i={}),k=k.concat(So({key:O+"[0]",value:L[0],valueSpec:{zoom:{}},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{zoom:nl,value:v}}))}else k=k.concat(v({key:O+"[0]",value:L[0],valueSpec:{},style:I.style,styleSpec:I.styleSpec},L));return as(j(L[1]))?k.concat([new Pe(O+"[1]",L[1],"expressions are not allowed in function stops.")]):k.concat(Ii({key:O+"[1]",value:L[1],valueSpec:_,style:I.style,styleSpec:I.styleSpec}))}function v(I,k){var L=lr(I.value),O=N(I.value),B=I.value!==null?I.value:k;if(r){if(L!==r)return[new Pe(I.key,B,L+" stop domain type must match previous stop domain type "+r)]}else r=L;if(L!=="number"&&L!=="string"&&L!=="boolean")return[new Pe(I.key,B,"stop domain value must be a number, string, or boolean")];if(L!=="number"&&S!=="categorical"){var q="number expected, "+L+" found";return oa(_)&&S===void 0&&(q+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Pe(I.key,B,q)]}return S!=="categorical"||L!=="number"||isFinite(O)&&Math.floor(O)===O?S!=="categorical"&&L==="number"&&a!==void 0&&O<a?[new Pe(I.key,B,"stop domain values must appear in ascending order")]:(a=O,S==="categorical"&&O in i?[new Pe(I.key,B,"stop domain values must be unique")]:(i[O]=!0,[])):[new Pe(I.key,B,"integer expected, found "+O)]}}function jo(e){var r=(e.expressionContext==="property"?bu:il)(j(e.value),e.valueSpec);if(r.result==="error")return r.value.map(function(d){return new Pe(""+e.key+d.key,e.value,d.message)});var a=r.value.expression||r.value._styleExpression.expression;if(e.expressionContext==="property"&&e.propertyKey==="text-font"&&!a.outputDefined())return[new Pe(e.key,e.value,'Invalid data expression for "'+e.propertyKey+'". Output values must be contained as literals within the expression.')];if(e.expressionContext==="property"&&e.propertyType==="layout"&&!ta(a))return[new Pe(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if(e.expressionContext==="filter"&&!ta(a))return[new Pe(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&e.expressionContext.indexOf("cluster")===0){if(!La(a,["zoom","feature-state"]))return[new Pe(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(e.expressionContext==="cluster-initial"&&!ea(a))return[new Pe(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Cs(e){var r=e.key,a=e.value,d=e.valueSpec,_=[];return Array.isArray(d.values)?d.values.indexOf(N(a))===-1&&_.push(new Pe(r,a,"expected one of ["+d.values.join(", ")+"], "+JSON.stringify(a)+" found")):Object.keys(d.values).indexOf(N(a))===-1&&_.push(new Pe(r,a,"expected one of ["+Object.keys(d.values).join(", ")+"], "+JSON.stringify(a)+" found")),_}function ja(e){if(e===!0||e===!1)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case"has":return e.length>=2&&e[1]!=="$id"&&e[1]!=="$type";case"in":return e.length>=3&&(typeof e[1]!="string"||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(var r=0,a=e.slice(1);r<a.length;r+=1){var d=a[r];if(!ja(d)&&typeof d!="boolean")return!1}return!0;default:return!0}}aa.deserialize=function(e){return new aa(e._parameters,e._specification)},aa.serialize=function(e){return{_parameters:e._parameters,_specification:e._specification}};var Bl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ol(e){if(e==null)return{filter:function(){return!0},needGeometry:!1};ja(e)||(e=wa(e));var r=il(e,Bl);if(r.result==="error")throw new Error(r.value.map(function(a){return a.key+": "+a.message}).join(", "));return{filter:function(a,d,_){return r.value.evaluate(a,d,{},_)},needGeometry:function a(d){if(!Array.isArray(d))return!1;if(d[0]==="within")return!0;for(var _=1;_<d.length;_++)if(a(d[_]))return!0;return!1}(e)}}function Ju(e,r){return e<r?-1:e>r?1:0}function wa(e){if(!e)return!0;var r,a=e[0];return e.length<=1?a!=="any":a==="=="?Ol(e[1],e[2],"=="):a==="!="?jn(Ol(e[1],e[2],"==")):a==="<"||a===">"||a==="<="||a===">="?Ol(e[1],e[2],a):a==="any"?(r=e.slice(1),["any"].concat(r.map(wa))):a==="all"?["all"].concat(e.slice(1).map(wa)):a==="none"?["all"].concat(e.slice(1).map(wa).map(jn)):a==="in"?zs(e[1],e.slice(2)):a==="!in"?jn(zs(e[1],e.slice(2))):a==="has"?Ps(e[1]):a==="!has"?jn(Ps(e[1])):a!=="within"||e}function Ol(e,r,a){switch(e){case"$type":return["filter-type-"+a,r];case"$id":return["filter-id-"+a,r];default:return["filter-"+a,e,r]}}function zs(e,r){if(r.length===0)return!1;switch(e){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(function(a){return typeof a!=typeof r[0]})?["filter-in-large",e,["literal",r.sort(Ju)]]:["filter-in-small",e,["literal",r]]}}function Ps(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function jn(e){return["!",e]}function qn(e){return ja(j(e.value))?jo(ie({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function r(a){var d=a.value,_=a.key;if(lr(d)!=="array")return[new Pe(_,d,"array expected, "+lr(d)+" found")];var S,i=a.styleSpec,t=[];if(d.length<1)return[new Pe(_,d,"filter array must have at least 1 element")];switch(t=t.concat(Cs({key:_+"[0]",value:d[0],valueSpec:i.filter_operator,style:a.style,styleSpec:a.styleSpec})),N(d[0])){case"<":case"<=":case">":case">=":d.length>=2&&N(d[1])==="$type"&&t.push(new Pe(_,d,'"$type" cannot be use with operator "'+d[0]+'"'));case"==":case"!=":d.length!==3&&t.push(new Pe(_,d,'filter array for operator "'+d[0]+'" must have 3 elements'));case"in":case"!in":d.length>=2&&(S=lr(d[1]))!=="string"&&t.push(new Pe(_+"[1]",d[1],"string expected, "+S+" found"));for(var o=2;o<d.length;o++)S=lr(d[o]),N(d[1])==="$type"?t=t.concat(Cs({key:_+"["+o+"]",value:d[o],valueSpec:i.geometry_type,style:a.style,styleSpec:a.styleSpec})):S!=="string"&&S!=="number"&&S!=="boolean"&&t.push(new Pe(_+"["+o+"]",d[o],"string, number, or boolean expected, "+S+" found"));break;case"any":case"all":case"none":for(var l=1;l<d.length;l++)t=t.concat(r({key:_+"["+l+"]",value:d[l],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":S=lr(d[1]),d.length!==2?t.push(new Pe(_,d,'filter array for "'+d[0]+'" operator must have 2 elements')):S!=="string"&&t.push(new Pe(_+"[1]",d[1],"string expected, "+S+" found"));break;case"within":S=lr(d[1]),d.length!==2?t.push(new Pe(_,d,'filter array for "'+d[0]+'" operator must have 2 elements')):S!=="object"&&t.push(new Pe(_+"[1]",d[1],"object expected, "+S+" found"))}return t}(e)}function wu(e,r){var a=e.key,d=e.style,_=e.styleSpec,S=e.value,i=e.objectKey,t=_[r+"_"+e.layerType];if(!t)return[];var o=i.match(/^(.*)-transition$/);if(r==="paint"&&o&&t[o[1]]&&t[o[1]].transition)return Ii({key:a,value:S,valueSpec:_.transition,style:d,styleSpec:_});var l,p=e.valueSpec||t[i];if(!p)return[new Pe(a,S,'unknown property "'+i+'"')];if(lr(S)==="string"&&oa(p)&&!p.tokens&&(l=/^{([^}]+)}$/.exec(S)))return[new Pe(a,S,'"'+i+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(l[1])+" }`.")];var y=[];return e.layerType==="symbol"&&(i==="text-field"&&d&&!d.glyphs&&y.push(new Pe(a,S,'use of "text-field" requires a style "glyphs" property')),i==="text-font"&&_a(j(S))&&N(S.type)==="identity"&&y.push(new Pe(a,S,'"text-font" does not support identity functions'))),y.concat(Ii({key:e.key,value:S,valueSpec:p,style:d,styleSpec:_,expressionContext:"property",propertyType:r,propertyKey:i}))}function Ea(e){return wu(e,"paint")}function ks(e){return wu(e,"layout")}function ls(e){var r=[],a=e.value,d=e.key,_=e.style,S=e.styleSpec;a.type||a.ref||r.push(new Pe(d,a,'either "type" or "ref" is required'));var i,t=N(a.type),o=N(a.ref);if(a.id)for(var l=N(a.id),p=0;p<e.arrayIndex;p++){var y=_.layers[p];N(y.id)===l&&r.push(new Pe(d,a.id,'duplicate layer id "'+a.id+'", previously used at line '+y.id.__line__))}if("ref"in a)["type","source","source-layer","filter","layout"].forEach(function(k){k in a&&r.push(new Pe(d,a[k],'"'+k+'" is prohibited for ref layers'))}),_.layers.forEach(function(k){N(k.id)===o&&(i=k)}),i?i.ref?r.push(new Pe(d,a.ref,"ref cannot reference another ref layer")):t=N(i.type):r.push(new Pe(d,a.ref,'ref layer "'+o+'" not found'));else if(t!=="background")if(a.source){var v=_.sources&&_.sources[a.source],I=v&&N(v.type);v?I==="vector"&&t==="raster"?r.push(new Pe(d,a.source,'layer "'+a.id+'" requires a raster source')):I==="raster"&&t!=="raster"?r.push(new Pe(d,a.source,'layer "'+a.id+'" requires a vector source')):I!=="vector"||a["source-layer"]?I==="raster-dem"&&t!=="hillshade"?r.push(new Pe(d,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):t!=="line"||!a.paint||!a.paint["line-gradient"]||I==="geojson"&&v.lineMetrics||r.push(new Pe(d,a,'layer "'+a.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):r.push(new Pe(d,a,'layer "'+a.id+'" must specify a "source-layer"')):r.push(new Pe(d,a.source,'source "'+a.source+'" not found'))}else r.push(new Pe(d,a,'missing required property "source"'));return r=r.concat(So({key:d,value:a,valueSpec:S.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Ii({key:d+".type",value:a.type,valueSpec:S.layer.type,style:e.style,styleSpec:e.styleSpec,object:a,objectKey:"type"})},filter:qn,layout:function(k){return So({layer:a,key:k.key,value:k.value,style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":function(L){return ks(ie({layerType:t},L))}}})},paint:function(k){return So({layer:a,key:k.key,value:k.value,style:k.style,styleSpec:k.styleSpec,objectElementValidators:{"*":function(L){return Ea(ie({layerType:t},L))}}})}}}))}function To(e){var r=e.value,a=e.key,d=lr(r);return d!=="string"?[new Pe(a,r,"string expected, "+d+" found")]:[]}var _r={promoteId:function(e){var r=e.key,a=e.value;if(lr(a)==="string")return To({key:r,value:a});var d=[];for(var _ in a)d.push.apply(d,To({key:r+"."+_,value:a[_]}));return d}};function Ms(e){var r=e.value,a=e.key,d=e.styleSpec,_=e.style;if(!r.type)return[new Pe(a,r,'"type" is required')];var S,i=N(r.type);switch(i){case"vector":case"raster":case"raster-dem":return So({key:a,value:r,valueSpec:d["source_"+i.replace("-","_")],style:e.style,styleSpec:d,objectElementValidators:_r});case"geojson":if(S=So({key:a,value:r,valueSpec:d.source_geojson,style:_,styleSpec:d,objectElementValidators:_r}),r.cluster)for(var t in r.clusterProperties){var o=r.clusterProperties[t],l=o[0],p=typeof l=="string"?[l,["accumulated"],["get",t]]:l;S.push.apply(S,jo({key:a+"."+t+".map",value:o[1],expressionContext:"cluster-map"})),S.push.apply(S,jo({key:a+"."+t+".reduce",value:p,expressionContext:"cluster-reduce"}))}return S;case"video":return So({key:a,value:r,valueSpec:d.source_video,style:_,styleSpec:d});case"image":return So({key:a,value:r,valueSpec:d.source_image,style:_,styleSpec:d});case"canvas":return[new Pe(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Cs({key:a+".type",value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:_,styleSpec:d})}}function us(e){var r=e.value,a=e.styleSpec,d=a.light,_=e.style,S=[],i=lr(r);if(r===void 0)return S;if(i!=="object")return S.concat([new Pe("light",r,"object expected, "+i+" found")]);for(var t in r){var o=t.match(/^(.*)-transition$/);S=S.concat(o&&d[o[1]]&&d[o[1]].transition?Ii({key:t,value:r[t],valueSpec:a.transition,style:_,styleSpec:a}):d[t]?Ii({key:t,value:r[t],valueSpec:d[t],style:_,styleSpec:a}):[new Pe(t,r[t],'unknown property "'+t+'"')])}return S}var Sa={"*":function(){return[]},array:rl,boolean:function(e){var r=e.value,a=e.key,d=lr(r);return d!=="boolean"?[new Pe(a,r,"boolean expected, "+d+" found")]:[]},number:nl,color:function(e){var r=e.key,a=e.value,d=lr(a);return d!=="string"?[new Pe(r,a,"color expected, "+d+" found")]:Mt(a)===null?[new Pe(r,a,'color expected, "'+a+'" found')]:[]},constants:Xe,enum:Cs,filter:qn,function:ss,layer:ls,object:So,source:Ms,light:us,string:To,formatted:function(e){return To(e).length===0?[]:jo(e)},resolvedImage:function(e){return To(e).length===0?[]:jo(e)}};function Ii(e){var r=e.value,a=e.valueSpec,d=e.styleSpec;return a.expression&&_a(N(r))?ss(e):a.expression&&as(j(r))?jo(e):a.type&&Sa[a.type]?Sa[a.type](e):So(ie({},e,{valueSpec:a.type?d[a.type]:a}))}function Ji(e){var r=e.value,a=e.key,d=To(e);return d.length||(r.indexOf("{fontstack}")===-1&&d.push(new Pe(a,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&d.push(new Pe(a,r,'"glyphs" url must include a "{range}" token'))),d}function Lt(e,r){r===void 0&&(r=fe);var a=[];return a=a.concat(Ii({key:"",value:e,valueSpec:r.$root,styleSpec:r,style:e,objectElementValidators:{glyphs:Ji,"*":function(){return[]}}})),e.constants&&(a=a.concat(Xe({key:"constants",value:e.constants,style:e,styleSpec:r}))),cs(a)}function cs(e){return[].concat(e).sort(function(r,a){return r.line-a.line})}function sa(e){return function(){for(var r=[],a=arguments.length;a--;)r[a]=arguments[a];return cs(e.apply(this,r))}}Lt.source=sa(Ms),Lt.light=sa(us),Lt.layer=sa(ls),Lt.filter=sa(qn),Lt.paintProperty=sa(Ea),Lt.layoutProperty=sa(ks);var qo=Lt,al=qo.light,Vt=qo.paintProperty,hs=qo.layoutProperty;function Ls(e,r){var a=!1;if(r&&r.length)for(var d=0,_=r;d<_.length;d+=1)e.fire(new Re(new Error(_[d].message))),a=!0;return a}var Ta=Er;function Er(e,r,a){var d=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var _=new Int32Array(this.arrayBuffer);e=_[0],this.d=(r=_[1])+2*(a=_[2]);for(var S=0;S<this.d*this.d;S++){var i=_[3+S],t=_[3+S+1];d.push(i===t?null:_.subarray(i,t))}var o=_[3+d.length+1];this.keys=_.subarray(_[3+d.length],o),this.bboxes=_.subarray(o),this.insert=this._insertReadonly}else{this.d=r+2*a;for(var l=0;l<this.d*this.d;l++)d.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=a,this.scale=r/e,this.uid=0;var p=a/r*e;this.min=-p,this.max=e+p}Er.prototype.insert=function(e,r,a,d,_){this._forEachCell(r,a,d,_,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(d),this.bboxes.push(_)},Er.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Er.prototype._insertCell=function(e,r,a,d,_,S){this.cells[_].push(S)},Er.prototype.query=function(e,r,a,d,_){var S=this.min,i=this.max;if(e<=S&&r<=S&&i<=a&&i<=d&&!_)return Array.prototype.slice.call(this.keys);var t=[];return this._forEachCell(e,r,a,d,this._queryCell,t,{},_),t},Er.prototype._queryCell=function(e,r,a,d,_,S,i,t){var o=this.cells[_];if(o!==null)for(var l=this.keys,p=this.bboxes,y=0;y<o.length;y++){var v=o[y];if(i[v]===void 0){var I=4*v;(t?t(p[I+0],p[I+1],p[I+2],p[I+3]):e<=p[I+2]&&r<=p[I+3]&&a>=p[I+0]&&d>=p[I+1])?(i[v]=!0,S.push(l[v])):i[v]=!1}}},Er.prototype._forEachCell=function(e,r,a,d,_,S,i,t){for(var o=this._convertToCellCoord(e),l=this._convertToCellCoord(r),p=this._convertToCellCoord(a),y=this._convertToCellCoord(d),v=o;v<=p;v++)for(var I=l;I<=y;I++){var k=this.d*I+v;if((!t||t(this._convertFromCellCoord(v),this._convertFromCellCoord(I),this._convertFromCellCoord(v+1),this._convertFromCellCoord(I+1)))&&_.call(this,e,r,a,d,k,S,i,t))return}},Er.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},Er.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},Er.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,r=3+this.cells.length+1+1,a=0,d=0;d<this.cells.length;d++)a+=this.cells[d].length;var _=new Int32Array(r+a+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var S=r,i=0;i<e.length;i++){var t=e[i];_[3+i]=S,_.set(t,S),S+=t.length}return _[3+e.length]=S,_.set(this.keys,S),_[3+e.length+1]=S+=this.keys.length,_.set(this.bboxes,S),S+=this.bboxes.length,_.buffer};var Ds=re.ImageData,Eu=re.ImageBitmap,qr={};function jt(e,r,a){a===void 0&&(a={}),Object.defineProperty(r,"_classRegistryKey",{value:e,writeable:!1}),qr[e]={klass:r,omit:a.omit||[],shallow:a.shallow||[]}}for(var Dn in jt("Object",Object),Ta.serialize=function(e,r){var a=e.toArrayBuffer();return r&&r.push(a),{buffer:a}},Ta.deserialize=function(e){return new Ta(e.buffer)},jt("Grid",Ta),jt("Color",di),jt("Error",Error),jt("ResolvedImage",Ln),jt("StylePropertyFunction",aa),jt("StyleExpression",xa,{omit:["_evaluator"]}),jt("ZoomDependentExpression",ba),jt("ZoomConstantExpression",Na),jt("CompoundExpression",Br,{omit:["_evaluate"]}),sr)sr[Dn]._classRegistryKey||jt("Expression_"+Dn,sr[Dn]);function Rs(e){return e&&typeof ArrayBuffer!="undefined"&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name==="ArrayBuffer")}function qa(e){return Eu&&e instanceof Eu}function Ao(e,r){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(Rs(e)||qa(e))return r&&r.push(e),e;if(ArrayBuffer.isView(e)){var a=e;return r&&r.push(a.buffer),a}if(e instanceof Ds)return r&&r.push(e.data.buffer),e;if(Array.isArray(e)){for(var d=[],_=0,S=e;_<S.length;_+=1)d.push(Ao(S[_],r));return d}if(typeof e=="object"){var i=e.constructor,t=i._classRegistryKey;if(!t)throw new Error("can't serialize object of unregistered class");var o=i.serialize?i.serialize(e,r):{};if(!i.serialize){for(var l in e)if(e.hasOwnProperty(l)&&!(qr[t].omit.indexOf(l)>=0)){var p=e[l];o[l]=qr[t].shallow.indexOf(l)>=0?p:Ao(p,r)}e instanceof Error&&(o.message=e.message)}if(o.$name)throw new Error("$name property is reserved for worker serialization logic.");return t!=="Object"&&(o.$name=t),o}throw new Error("can't serialize object of type "+typeof e)}function vr(e){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||Rs(e)||qa(e)||ArrayBuffer.isView(e)||e instanceof Ds)return e;if(Array.isArray(e))return e.map(vr);if(typeof e=="object"){var r=e.$name||"Object",a=qr[r].klass;if(!a)throw new Error("can't deserialize unregistered class "+r);if(a.deserialize)return a.deserialize(e);for(var d=Object.create(a.prototype),_=0,S=Object.keys(e);_<S.length;_+=1){var i=S[_];if(i!=="$name"){var t=e[i];d[i]=qr[r].shallow.indexOf(i)>=0?t:vr(t)}}return d}throw new Error("can't deserialize object of type "+typeof e)}var la=function(){this.first=!0};la.prototype.update=function(e,r){var a=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=a,!0))};var Ct={"Latin-1 Supplement":function(e){return e>=128&&e<=255},Arabic:function(e){return e>=1536&&e<=1791},"Arabic Supplement":function(e){return e>=1872&&e<=1919},"Arabic Extended-A":function(e){return e>=2208&&e<=2303},"Hangul Jamo":function(e){return e>=4352&&e<=4607},"Unified Canadian Aboriginal Syllabics":function(e){return e>=5120&&e<=5759},Khmer:function(e){return e>=6016&&e<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(e){return e>=6320&&e<=6399},"General Punctuation":function(e){return e>=8192&&e<=8303},"Letterlike Symbols":function(e){return e>=8448&&e<=8527},"Number Forms":function(e){return e>=8528&&e<=8591},"Miscellaneous Technical":function(e){return e>=8960&&e<=9215},"Control Pictures":function(e){return e>=9216&&e<=9279},"Optical Character Recognition":function(e){return e>=9280&&e<=9311},"Enclosed Alphanumerics":function(e){return e>=9312&&e<=9471},"Geometric Shapes":function(e){return e>=9632&&e<=9727},"Miscellaneous Symbols":function(e){return e>=9728&&e<=9983},"Miscellaneous Symbols and Arrows":function(e){return e>=11008&&e<=11263},"CJK Radicals Supplement":function(e){return e>=11904&&e<=12031},"Kangxi Radicals":function(e){return e>=12032&&e<=12255},"Ideographic Description Characters":function(e){return e>=12272&&e<=12287},"CJK Symbols and Punctuation":function(e){return e>=12288&&e<=12351},Hiragana:function(e){return e>=12352&&e<=12447},Katakana:function(e){return e>=12448&&e<=12543},Bopomofo:function(e){return e>=12544&&e<=12591},"Hangul Compatibility Jamo":function(e){return e>=12592&&e<=12687},Kanbun:function(e){return e>=12688&&e<=12703},"Bopomofo Extended":function(e){return e>=12704&&e<=12735},"CJK Strokes":function(e){return e>=12736&&e<=12783},"Katakana Phonetic Extensions":function(e){return e>=12784&&e<=12799},"Enclosed CJK Letters and Months":function(e){return e>=12800&&e<=13055},"CJK Compatibility":function(e){return e>=13056&&e<=13311},"CJK Unified Ideographs Extension A":function(e){return e>=13312&&e<=19903},"Yijing Hexagram Symbols":function(e){return e>=19904&&e<=19967},"CJK Unified Ideographs":function(e){return e>=19968&&e<=40959},"Yi Syllables":function(e){return e>=40960&&e<=42127},"Yi Radicals":function(e){return e>=42128&&e<=42191},"Hangul Jamo Extended-A":function(e){return e>=43360&&e<=43391},"Hangul Syllables":function(e){return e>=44032&&e<=55215},"Hangul Jamo Extended-B":function(e){return e>=55216&&e<=55295},"Private Use Area":function(e){return e>=57344&&e<=63743},"CJK Compatibility Ideographs":function(e){return e>=63744&&e<=64255},"Arabic Presentation Forms-A":function(e){return e>=64336&&e<=65023},"Vertical Forms":function(e){return e>=65040&&e<=65055},"CJK Compatibility Forms":function(e){return e>=65072&&e<=65103},"Small Form Variants":function(e){return e>=65104&&e<=65135},"Arabic Presentation Forms-B":function(e){return e>=65136&&e<=65279},"Halfwidth and Fullwidth Forms":function(e){return e>=65280&&e<=65519}};function sl(e){for(var r=0,a=e;r<a.length;r+=1)if(Aa(a[r].charCodeAt(0)))return!0;return!1}function Aa(e){return!(e!==746&&e!==747&&(e<4352||!(Ct["Bopomofo Extended"](e)||Ct.Bopomofo(e)||Ct["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||Ct["CJK Compatibility Ideographs"](e)||Ct["CJK Compatibility"](e)||Ct["CJK Radicals Supplement"](e)||Ct["CJK Strokes"](e)||!(!Ct["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||e===12336)||Ct["CJK Unified Ideographs Extension A"](e)||Ct["CJK Unified Ideographs"](e)||Ct["Enclosed CJK Letters and Months"](e)||Ct["Hangul Compatibility Jamo"](e)||Ct["Hangul Jamo Extended-A"](e)||Ct["Hangul Jamo Extended-B"](e)||Ct["Hangul Jamo"](e)||Ct["Hangul Syllables"](e)||Ct.Hiragana(e)||Ct["Ideographic Description Characters"](e)||Ct.Kanbun(e)||Ct["Kangxi Radicals"](e)||Ct["Katakana Phonetic Extensions"](e)||Ct.Katakana(e)&&e!==12540||!(!Ct["Halfwidth and Fullwidth Forms"](e)||e===65288||e===65289||e===65293||e>=65306&&e<=65310||e===65339||e===65341||e===65343||e>=65371&&e<=65503||e===65507||e>=65512&&e<=65519)||!(!Ct["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||Ct["Unified Canadian Aboriginal Syllabics"](e)||Ct["Unified Canadian Aboriginal Syllabics Extended"](e)||Ct["Vertical Forms"](e)||Ct["Yijing Hexagram Symbols"](e)||Ct["Yi Syllables"](e)||Ct["Yi Radicals"](e))))}function ll(e){return!(Aa(e)||function(r){return!!(Ct["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||Ct["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||Ct["Letterlike Symbols"](r)||Ct["Number Forms"](r)||Ct["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||Ct["Control Pictures"](r)&&r!==9251||Ct["Optical Character Recognition"](r)||Ct["Enclosed Alphanumerics"](r)||Ct["Geometric Shapes"](r)||Ct["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||Ct["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||Ct["CJK Symbols and Punctuation"](r)||Ct.Katakana(r)||Ct["Private Use Area"](r)||Ct["CJK Compatibility Forms"](r)||Ct["Small Form Variants"](r)||Ct["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)}(e))}function Jn(e){return e>=1424&&e<=2303||Ct["Arabic Presentation Forms-A"](e)||Ct["Arabic Presentation Forms-B"](e)}function Sr(e,r){return!(!r&&Jn(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||Ct.Khmer(e))}function mr(e){for(var r=0,a=e;r<a.length;r+=1)if(Jn(a[r].charCodeAt(0)))return!0;return!1}var ps=null,Rn="unavailable",Go=null,Su=function(e){e&&typeof e=="string"&&e.indexOf("NetworkError")>-1&&(Rn="error"),ps&&ps(e)};function Bs(){Tu.fire(new Te("pluginStateChange",{pluginStatus:Rn,pluginURL:Go}))}var Tu=new Oe,Ro=function(){return Rn},so=function(){if(Rn!=="deferred"||!Go)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Rn="loading",Bs(),Go&&Wn({url:Go},function(e){e?Su(e):(Rn="loaded",Bs())})},Gt={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Rn==="loaded"||Gt.applyArabicShaping!=null},isLoading:function(){return Rn==="loading"},setState:function(e){Rn=e.pluginStatus,Go=e.pluginURL},isParsed:function(){return Gt.applyArabicShaping!=null&&Gt.processBidirectionalText!=null&&Gt.processStyledBidirectionalText!=null},getPluginURL:function(){return Go}},At=function(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new la,this.transition={})};At.prototype.isSupportedScript=function(e){return function(r,a){for(var d=0,_=r;d<_.length;d+=1)if(!Sr(_[d].charCodeAt(0),a))return!1;return!0}(e,Gt.isLoaded())},At.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},At.prototype.getCrossfadeParameters=function(){var e=this.zoom,r=e-Math.floor(e),a=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*r}};var lo=function(e,r){this.property=e,this.value=r,this.expression=function(a,d){if(_a(a))return new aa(a,d);if(as(a)){var _=bu(a,d);if(_.result==="error")throw new Error(_.value.map(function(i){return i.key+": "+i.message}).join(", "));return _.value}var S=a;return typeof a=="string"&&d.type==="color"&&(S=di.parse(a)),{kind:"constant",evaluate:function(){return S}}}(r===void 0?e.specification.default:r,e.specification)};lo.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},lo.prototype.possiblyEvaluate=function(e,r,a){return this.property.possiblyEvaluate(this,e,r,a)};var Gn=function(e){this.property=e,this.value=new lo(e,void 0)};Gn.prototype.transitioned=function(e,r){return new Tr(this.property,this.value,r,Wt({},e.transition,this.transition),e.now)},Gn.prototype.untransitioned=function(){return new Tr(this.property,this.value,null,{},0)};var an=function(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)};an.prototype.getValue=function(e){return Ki(this._values[e].value.value)},an.prototype.setValue=function(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Gn(this._values[e].property)),this._values[e].value=new lo(this._values[e].property,r===null?void 0:Ki(r))},an.prototype.getTransition=function(e){return Ki(this._values[e].transition)},an.prototype.setTransition=function(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Gn(this._values[e].property)),this._values[e].transition=Ki(r)||void 0},an.prototype.serialize=function(){for(var e={},r=0,a=Object.keys(this._values);r<a.length;r+=1){var d=a[r],_=this.getValue(d);_!==void 0&&(e[d]=_);var S=this.getTransition(d);S!==void 0&&(e[d+"-transition"]=S)}return e},an.prototype.transitioned=function(e,r){for(var a=new uo(this._properties),d=0,_=Object.keys(this._values);d<_.length;d+=1){var S=_[d];a._values[S]=this._values[S].transitioned(e,r._values[S])}return a},an.prototype.untransitioned=function(){for(var e=new uo(this._properties),r=0,a=Object.keys(this._values);r<a.length;r+=1){var d=a[r];e._values[d]=this._values[d].untransitioned()}return e};var Tr=function(e,r,a,d,_){this.property=e,this.value=r,this.begin=_+d.delay||0,this.end=this.begin+d.duration||0,e.specification.transition&&(d.delay||d.duration)&&(this.prior=a)};Tr.prototype.possiblyEvaluate=function(e,r,a){var d=e.now||0,_=this.value.possiblyEvaluate(e,r,a),S=this.prior;if(S){if(d>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(d<this.begin)return S.possiblyEvaluate(e,r,a);var i=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(S.possiblyEvaluate(e,r,a),_,function(t){if(t<=0)return 0;if(t>=1)return 1;var o=t*t,l=o*t;return 4*(t<.5?l:3*(t-o)+l-.75)}(i))}return _};var uo=function(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)};uo.prototype.possiblyEvaluate=function(e,r,a){for(var d=new Ia(this._properties),_=0,S=Object.keys(this._values);_<S.length;_+=1){var i=S[_];d._values[i]=this._values[i].possiblyEvaluate(e,r,a)}return d},uo.prototype.hasTransition=function(){for(var e=0,r=Object.keys(this._values);e<r.length;e+=1)if(this._values[r[e]].prior)return!0;return!1};var Cr=function(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)};Cr.prototype.getValue=function(e){return Ki(this._values[e].value)},Cr.prototype.setValue=function(e,r){this._values[e]=new lo(this._values[e].property,r===null?void 0:Ki(r))},Cr.prototype.serialize=function(){for(var e={},r=0,a=Object.keys(this._values);r<a.length;r+=1){var d=a[r],_=this.getValue(d);_!==void 0&&(e[d]=_)}return e},Cr.prototype.possiblyEvaluate=function(e,r,a){for(var d=new Ia(this._properties),_=0,S=Object.keys(this._values);_<S.length;_+=1){var i=S[_];d._values[i]=this._values[i].possiblyEvaluate(e,r,a)}return d};var Zn=function(e,r,a){this.property=e,this.value=r,this.parameters=a};Zn.prototype.isConstant=function(){return this.value.kind==="constant"},Zn.prototype.constantOr=function(e){return this.value.kind==="constant"?this.value.value:e},Zn.prototype.evaluate=function(e,r,a,d){return this.property.evaluate(this.value,this.parameters,e,r,a,d)};var Ia=function(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)};Ia.prototype.get=function(e){return this._values[e]};var Pt=function(e){this.specification=e};Pt.prototype.possiblyEvaluate=function(e,r){return e.expression.evaluate(r)},Pt.prototype.interpolate=function(e,r,a){var d=In[this.specification.type];return d?d(e,r,a):e};var zt=function(e,r){this.specification=e,this.overrides=r};zt.prototype.possiblyEvaluate=function(e,r,a,d){return new Zn(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},a,d)}:e.expression,r)},zt.prototype.interpolate=function(e,r,a){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new Zn(this,{kind:"constant",value:void 0},e.parameters);var d=In[this.specification.type];return d?new Zn(this,{kind:"constant",value:d(e.value.value,r.value.value,a)},e.parameters):e},zt.prototype.evaluate=function(e,r,a,d,_,S){return e.kind==="constant"?e.value:e.evaluate(r,a,d,_,S)};var ul=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.possiblyEvaluate=function(a,d,_,S){if(a.value===void 0)return new Zn(this,{kind:"constant",value:void 0},d);if(a.expression.kind==="constant"){var i=a.expression.evaluate(d,null,{},_,S),t=a.property.specification.type==="resolvedImage"&&typeof i!="string"?i.name:i,o=this._calculate(t,t,t,d);return new Zn(this,{kind:"constant",value:o},d)}if(a.expression.kind==="camera"){var l=this._calculate(a.expression.evaluate({zoom:d.zoom-1}),a.expression.evaluate({zoom:d.zoom}),a.expression.evaluate({zoom:d.zoom+1}),d);return new Zn(this,{kind:"constant",value:l},d)}return new Zn(this,a.expression,d)},r.prototype.evaluate=function(a,d,_,S,i,t){if(a.kind==="source"){var o=a.evaluate(d,_,S,i,t);return this._calculate(o,o,o,d)}return a.kind==="composite"?this._calculate(a.evaluate({zoom:Math.floor(d.zoom)-1},_,S),a.evaluate({zoom:Math.floor(d.zoom)},_,S),a.evaluate({zoom:Math.floor(d.zoom)+1},_,S),d):a.value},r.prototype._calculate=function(a,d,_,S){return S.zoom>S.zoomHistory.lastIntegerZoom?{from:a,to:d}:{from:_,to:d}},r.prototype.interpolate=function(a){return a},r}(zt),Yr=function(e){this.specification=e};Yr.prototype.possiblyEvaluate=function(e,r,a,d){if(e.value!==void 0){if(e.expression.kind==="constant"){var _=e.expression.evaluate(r,null,{},a,d);return this._calculate(_,_,_,r)}return this._calculate(e.expression.evaluate(new At(Math.floor(r.zoom-1),r)),e.expression.evaluate(new At(Math.floor(r.zoom),r)),e.expression.evaluate(new At(Math.floor(r.zoom+1),r)),r)}},Yr.prototype._calculate=function(e,r,a,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:a,to:r}},Yr.prototype.interpolate=function(e){return e};var Yn=function(e){this.specification=e};Yn.prototype.possiblyEvaluate=function(e,r,a,d){return!!e.expression.evaluate(r,null,{},a,d)},Yn.prototype.interpolate=function(){return!1};var b=function(e){for(var r in this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],e){var a=e[r];a.specification.overridable&&this.overridableProperties.push(r);var d=this.defaultPropertyValues[r]=new lo(a,void 0),_=this.defaultTransitionablePropertyValues[r]=new Gn(a);this.defaultTransitioningPropertyValues[r]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=d.possiblyEvaluate({})}};jt("DataDrivenProperty",zt),jt("DataConstantProperty",Pt),jt("CrossFadedDataDrivenProperty",ul),jt("CrossFadedProperty",Yr),jt("ColorRampProperty",Yn);var n=function(e){function r(a,d){if(e.call(this),this.id=a.id,this.type=a.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},a.type!=="custom"&&(this.metadata=(a=a).metadata,this.minzoom=a.minzoom,this.maxzoom=a.maxzoom,a.type!=="background"&&(this.source=a.source,this.sourceLayer=a["source-layer"],this.filter=a.filter),d.layout&&(this._unevaluatedLayout=new Cr(d.layout)),d.paint)){for(var _ in this._transitionablePaint=new an(d.paint),a.paint)this.setPaintProperty(_,a.paint[_],{validate:!1});for(var S in a.layout)this.setLayoutProperty(S,a.layout[S],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ia(d.paint)}}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},r.prototype.getLayoutProperty=function(a){return a==="visibility"?this.visibility:this._unevaluatedLayout.getValue(a)},r.prototype.setLayoutProperty=function(a,d,_){_===void 0&&(_={}),d!=null&&this._validate(hs,"layers."+this.id+".layout."+a,a,d,_)||(a!=="visibility"?this._unevaluatedLayout.setValue(a,d):this.visibility=d)},r.prototype.getPaintProperty=function(a){return Wi(a,"-transition")?this._transitionablePaint.getTransition(a.slice(0,-11)):this._transitionablePaint.getValue(a)},r.prototype.setPaintProperty=function(a,d,_){if(_===void 0&&(_={}),d!=null&&this._validate(Vt,"layers."+this.id+".paint."+a,a,d,_))return!1;if(Wi(a,"-transition"))return this._transitionablePaint.setTransition(a.slice(0,-11),d||void 0),!1;var S=this._transitionablePaint._values[a],i=S.property.specification["property-type"]==="cross-faded-data-driven",t=S.value.isDataDriven(),o=S.value;this._transitionablePaint.setValue(a,d),this._handleSpecialPaintPropertyUpdate(a);var l=this._transitionablePaint._values[a].value;return l.isDataDriven()||t||i||this._handleOverridablePaintPropertyUpdate(a,o,l)},r.prototype._handleSpecialPaintPropertyUpdate=function(a){},r.prototype._handleOverridablePaintPropertyUpdate=function(a,d,_){return!1},r.prototype.isHidden=function(a){return!!(this.minzoom&&a<this.minzoom)||!!(this.maxzoom&&a>=this.maxzoom)||this.visibility==="none"},r.prototype.updateTransitions=function(a){this._transitioningPaint=this._transitionablePaint.transitioned(a,this._transitioningPaint)},r.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},r.prototype.recalculate=function(a,d){a.getCrossfadeParameters&&(this._crossfadeParameters=a.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(a,void 0,d)),this.paint=this._transitioningPaint.possiblyEvaluate(a,void 0,d)},r.prototype.serialize=function(){var a={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(a.layout=a.layout||{},a.layout.visibility=this.visibility),Zi(a,function(d,_){return!(d===void 0||_==="layout"&&!Object.keys(d).length||_==="paint"&&!Object.keys(d).length)})},r.prototype._validate=function(a,d,_,S,i){return i===void 0&&(i={}),(!i||i.validate!==!1)&&Ls(this,a.call(qo,{key:d,layerType:this.type,objectKey:_,value:S,styleSpec:fe,style:{glyphs:!0,sprite:!0}}))},r.prototype.is3D=function(){return!1},r.prototype.isTileClipped=function(){return!1},r.prototype.hasOffscreenPass=function(){return!1},r.prototype.resize=function(){},r.prototype.isStateDependent=function(){for(var a in this.paint._values){var d=this.paint.get(a);if(d instanceof Zn&&oa(d.property.specification)&&(d.value.kind==="source"||d.value.kind==="composite")&&d.value.isStateDependent)return!0}return!1},r}(Oe),h={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},x=function(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},E=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function z(e,r){r===void 0&&(r=1);var a=0,d=0;return{members:e.map(function(_){var S=h[_.type].BYTES_PER_ELEMENT,i=a=R(a,Math.max(r,S)),t=_.components||1;return d=Math.max(d,S),a+=S*t,{name:_.name,type:_.type,components:t,offset:i}}),size:R(a,Math.max(d,r)),alignment:r}}function R(e,r){return Math.ceil(e/r)*r}E.serialize=function(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}},E.deserialize=function(e){var r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r},E.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},E.prototype.clear=function(){this.length=0},E.prototype.resize=function(e){this.reserve(e),this.length=e},E.prototype.reserve=function(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}},E.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var V=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d){var _=this.length;return this.resize(_+1),this.emplace(_,a,d)},r.prototype.emplace=function(a,d,_){var S=2*a;return this.int16[S+0]=d,this.int16[S+1]=_,a},r}(E);V.prototype.bytesPerElement=4,jt("StructArrayLayout2i4",V);var G=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d,_,S){var i=this.length;return this.resize(i+1),this.emplace(i,a,d,_,S)},r.prototype.emplace=function(a,d,_,S,i){var t=4*a;return this.int16[t+0]=d,this.int16[t+1]=_,this.int16[t+2]=S,this.int16[t+3]=i,a},r}(E);G.prototype.bytesPerElement=8,jt("StructArrayLayout4i8",G);var K=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d,_,S,i,t){var o=this.length;return this.resize(o+1),this.emplace(o,a,d,_,S,i,t)},r.prototype.emplace=function(a,d,_,S,i,t,o){var l=6*a;return this.int16[l+0]=d,this.int16[l+1]=_,this.int16[l+2]=S,this.int16[l+3]=i,this.int16[l+4]=t,this.int16[l+5]=o,a},r}(E);K.prototype.bytesPerElement=12,jt("StructArrayLayout2i4i12",K);var Q=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d,_,S,i,t){var o=this.length;return this.resize(o+1),this.emplace(o,a,d,_,S,i,t)},r.prototype.emplace=function(a,d,_,S,i,t,o){var l=4*a,p=8*a;return this.int16[l+0]=d,this.int16[l+1]=_,this.uint8[p+4]=S,this.uint8[p+5]=i,this.uint8[p+6]=t,this.uint8[p+7]=o,a},r}(E);Q.prototype.bytesPerElement=8,jt("StructArrayLayout2i4ub8",Q);var ae=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d){var _=this.length;return this.resize(_+1),this.emplace(_,a,d)},r.prototype.emplace=function(a,d,_){var S=2*a;return this.float32[S+0]=d,this.float32[S+1]=_,a},r}(E);ae.prototype.bytesPerElement=8,jt("StructArrayLayout2f8",ae);var _e=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d,_,S,i,t,o,l,p,y){var v=this.length;return this.resize(v+1),this.emplace(v,a,d,_,S,i,t,o,l,p,y)},r.prototype.emplace=function(a,d,_,S,i,t,o,l,p,y,v){var I=10*a;return this.uint16[I+0]=d,this.uint16[I+1]=_,this.uint16[I+2]=S,this.uint16[I+3]=i,this.uint16[I+4]=t,this.uint16[I+5]=o,this.uint16[I+6]=l,this.uint16[I+7]=p,this.uint16[I+8]=y,this.uint16[I+9]=v,a},r}(E);_e.prototype.bytesPerElement=20,jt("StructArrayLayout10ui20",_e);var Le=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d,_,S,i,t,o,l,p,y,v,I){var k=this.length;return this.resize(k+1),this.emplace(k,a,d,_,S,i,t,o,l,p,y,v,I)},r.prototype.emplace=function(a,d,_,S,i,t,o,l,p,y,v,I,k){var L=12*a;return this.int16[L+0]=d,this.int16[L+1]=_,this.int16[L+2]=S,this.int16[L+3]=i,this.uint16[L+4]=t,this.uint16[L+5]=o,this.uint16[L+6]=l,this.uint16[L+7]=p,this.int16[L+8]=y,this.int16[L+9]=v,this.int16[L+10]=I,this.int16[L+11]=k,a},r}(E);Le.prototype.bytesPerElement=24,jt("StructArrayLayout4i4ui4i24",Le);var be=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d,_){var S=this.length;return this.resize(S+1),this.emplace(S,a,d,_)},r.prototype.emplace=function(a,d,_,S){var i=3*a;return this.float32[i+0]=d,this.float32[i+1]=_,this.float32[i+2]=S,a},r}(E);be.prototype.bytesPerElement=12,jt("StructArrayLayout3f12",be);var Me=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a){var d=this.length;return this.resize(d+1),this.emplace(d,a)},r.prototype.emplace=function(a,d){return this.uint32[1*a+0]=d,a},r}(E);Me.prototype.bytesPerElement=4,jt("StructArrayLayout1ul4",Me);var qe=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d,_,S,i,t,o,l,p){var y=this.length;return this.resize(y+1),this.emplace(y,a,d,_,S,i,t,o,l,p)},r.prototype.emplace=function(a,d,_,S,i,t,o,l,p,y){var v=10*a,I=5*a;return this.int16[v+0]=d,this.int16[v+1]=_,this.int16[v+2]=S,this.int16[v+3]=i,this.int16[v+4]=t,this.int16[v+5]=o,this.uint32[I+3]=l,this.uint16[v+8]=p,this.uint16[v+9]=y,a},r}(E);qe.prototype.bytesPerElement=20,jt("StructArrayLayout6i1ul2ui20",qe);var Ne=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d,_,S,i,t){var o=this.length;return this.resize(o+1),this.emplace(o,a,d,_,S,i,t)},r.prototype.emplace=function(a,d,_,S,i,t,o){var l=6*a;return this.int16[l+0]=d,this.int16[l+1]=_,this.int16[l+2]=S,this.int16[l+3]=i,this.int16[l+4]=t,this.int16[l+5]=o,a},r}(E);Ne.prototype.bytesPerElement=12,jt("StructArrayLayout2i2i2i12",Ne);var Ke=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d,_,S,i){var t=this.length;return this.resize(t+1),this.emplace(t,a,d,_,S,i)},r.prototype.emplace=function(a,d,_,S,i,t){var o=4*a,l=8*a;return this.float32[o+0]=d,this.float32[o+1]=_,this.float32[o+2]=S,this.int16[l+6]=i,this.int16[l+7]=t,a},r}(E);Ke.prototype.bytesPerElement=16,jt("StructArrayLayout2f1f2i16",Ke);var Ze=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d,_,S){var i=this.length;return this.resize(i+1),this.emplace(i,a,d,_,S)},r.prototype.emplace=function(a,d,_,S,i){var t=12*a,o=3*a;return this.uint8[t+0]=d,this.uint8[t+1]=_,this.float32[o+1]=S,this.float32[o+2]=i,a},r}(E);Ze.prototype.bytesPerElement=12,jt("StructArrayLayout2ub2f12",Ze);var ut=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d,_){var S=this.length;return this.resize(S+1),this.emplace(S,a,d,_)},r.prototype.emplace=function(a,d,_,S){var i=3*a;return this.uint16[i+0]=d,this.uint16[i+1]=_,this.uint16[i+2]=S,a},r}(E);ut.prototype.bytesPerElement=6,jt("StructArrayLayout3ui6",ut);var rt=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d,_,S,i,t,o,l,p,y,v,I,k,L,O,B,q){var $=this.length;return this.resize($+1),this.emplace($,a,d,_,S,i,t,o,l,p,y,v,I,k,L,O,B,q)},r.prototype.emplace=function(a,d,_,S,i,t,o,l,p,y,v,I,k,L,O,B,q,$){var W=24*a,ne=12*a,ue=48*a;return this.int16[W+0]=d,this.int16[W+1]=_,this.uint16[W+2]=S,this.uint16[W+3]=i,this.uint32[ne+2]=t,this.uint32[ne+3]=o,this.uint32[ne+4]=l,this.uint16[W+10]=p,this.uint16[W+11]=y,this.uint16[W+12]=v,this.float32[ne+7]=I,this.float32[ne+8]=k,this.uint8[ue+36]=L,this.uint8[ue+37]=O,this.uint8[ue+38]=B,this.uint32[ne+10]=q,this.int16[W+22]=$,a},r}(E);rt.prototype.bytesPerElement=48,jt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",rt);var ot=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d,_,S,i,t,o,l,p,y,v,I,k,L,O,B,q,$,W,ne,ue,Ie,De,Fe,Ue,We,Ve,mt){var dt=this.length;return this.resize(dt+1),this.emplace(dt,a,d,_,S,i,t,o,l,p,y,v,I,k,L,O,B,q,$,W,ne,ue,Ie,De,Fe,Ue,We,Ve,mt)},r.prototype.emplace=function(a,d,_,S,i,t,o,l,p,y,v,I,k,L,O,B,q,$,W,ne,ue,Ie,De,Fe,Ue,We,Ve,mt,dt){var tt=34*a,pt=17*a;return this.int16[tt+0]=d,this.int16[tt+1]=_,this.int16[tt+2]=S,this.int16[tt+3]=i,this.int16[tt+4]=t,this.int16[tt+5]=o,this.int16[tt+6]=l,this.int16[tt+7]=p,this.uint16[tt+8]=y,this.uint16[tt+9]=v,this.uint16[tt+10]=I,this.uint16[tt+11]=k,this.uint16[tt+12]=L,this.uint16[tt+13]=O,this.uint16[tt+14]=B,this.uint16[tt+15]=q,this.uint16[tt+16]=$,this.uint16[tt+17]=W,this.uint16[tt+18]=ne,this.uint16[tt+19]=ue,this.uint16[tt+20]=Ie,this.uint16[tt+21]=De,this.uint16[tt+22]=Fe,this.uint32[pt+12]=Ue,this.float32[pt+13]=We,this.float32[pt+14]=Ve,this.float32[pt+15]=mt,this.float32[pt+16]=dt,a},r}(E);ot.prototype.bytesPerElement=68,jt("StructArrayLayout8i15ui1ul4f68",ot);var yt=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a){var d=this.length;return this.resize(d+1),this.emplace(d,a)},r.prototype.emplace=function(a,d){return this.float32[1*a+0]=d,a},r}(E);yt.prototype.bytesPerElement=4,jt("StructArrayLayout1f4",yt);var Et=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d,_){var S=this.length;return this.resize(S+1),this.emplace(S,a,d,_)},r.prototype.emplace=function(a,d,_,S){var i=3*a;return this.int16[i+0]=d,this.int16[i+1]=_,this.int16[i+2]=S,a},r}(E);Et.prototype.bytesPerElement=6,jt("StructArrayLayout3i6",Et);var ct=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d,_){var S=this.length;return this.resize(S+1),this.emplace(S,a,d,_)},r.prototype.emplace=function(a,d,_,S){var i=4*a;return this.uint32[2*a+0]=d,this.uint16[i+2]=_,this.uint16[i+3]=S,a},r}(E);ct.prototype.bytesPerElement=8,jt("StructArrayLayout1ul2ui8",ct);var Kt=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d){var _=this.length;return this.resize(_+1),this.emplace(_,a,d)},r.prototype.emplace=function(a,d,_){var S=2*a;return this.uint16[S+0]=d,this.uint16[S+1]=_,a},r}(E);Kt.prototype.bytesPerElement=4,jt("StructArrayLayout2ui4",Kt);var Ot=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a){var d=this.length;return this.resize(d+1),this.emplace(d,a)},r.prototype.emplace=function(a,d){return this.uint16[1*a+0]=d,a},r}(E);Ot.prototype.bytesPerElement=2,jt("StructArrayLayout1ui2",Ot);var gi=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d,_,S){var i=this.length;return this.resize(i+1),this.emplace(i,a,d,_,S)},r.prototype.emplace=function(a,d,_,S,i){var t=4*a;return this.float32[t+0]=d,this.float32[t+1]=_,this.float32[t+2]=S,this.float32[t+3]=i,a},r}(E);gi.prototype.bytesPerElement=16,jt("StructArrayLayout4f16",gi);var s=function(e){function r(){e.apply(this,arguments)}e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r;var a={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return a.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},a.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},a.x1.get=function(){return this._structArray.int16[this._pos2+2]},a.y1.get=function(){return this._structArray.int16[this._pos2+3]},a.x2.get=function(){return this._structArray.int16[this._pos2+4]},a.y2.get=function(){return this._structArray.int16[this._pos2+5]},a.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},a.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},a.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},a.anchorPoint.get=function(){return new he(this.anchorPointX,this.anchorPointY)},Object.defineProperties(r.prototype,a),r}(x);s.prototype.size=20;var c=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.get=function(a){return new s(this,a)},r}(qe);jt("CollisionBoxArray",c);var u=function(e){function r(){e.apply(this,arguments)}e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r;var a={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return a.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},a.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},a.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},a.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},a.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},a.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},a.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},a.segment.get=function(){return this._structArray.uint16[this._pos2+10]},a.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},a.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},a.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},a.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},a.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},a.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},a.placedOrientation.set=function(d){this._structArray.uint8[this._pos1+37]=d},a.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},a.hidden.set=function(d){this._structArray.uint8[this._pos1+38]=d},a.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},a.crossTileID.set=function(d){this._structArray.uint32[this._pos4+10]=d},a.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(r.prototype,a),r}(x);u.prototype.size=48;var f=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.get=function(a){return new u(this,a)},r}(rt);jt("PlacedSymbolArray",f);var T=function(e){function r(){e.apply(this,arguments)}e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r;var a={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return a.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},a.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},a.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},a.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},a.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},a.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},a.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},a.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},a.key.get=function(){return this._structArray.uint16[this._pos2+8]},a.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},a.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},a.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},a.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},a.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},a.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},a.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},a.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},a.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},a.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},a.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},a.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},a.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},a.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},a.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},a.crossTileID.set=function(d){this._structArray.uint32[this._pos4+12]=d},a.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},a.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},a.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},a.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(r.prototype,a),r}(x);T.prototype.size=68;var P=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.get=function(a){return new T(this,a)},r}(ot);jt("SymbolInstanceArray",P);var M=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.getoffsetX=function(a){return this.float32[1*a+0]},r}(yt);jt("GlyphOffsetArray",M);var F=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.getx=function(a){return this.int16[3*a+0]},r.prototype.gety=function(a){return this.int16[3*a+1]},r.prototype.gettileUnitDistanceFromAnchor=function(a){return this.int16[3*a+2]},r}(Et);jt("SymbolLineVertexArray",F);var X=function(e){function r(){e.apply(this,arguments)}e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r;var a={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return a.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},a.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},a.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(r.prototype,a),r}(x);X.prototype.size=8;var Y=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.get=function(a){return new X(this,a)},r}(ct);jt("FeatureIndexArray",Y);var le=z([{name:"a_pos",components:2,type:"Int16"}],4).members,ce=function(e){e===void 0&&(e=[]),this.segments=e};function de(e,r){return 256*(e=vt(Math.floor(e),0,255))+vt(Math.floor(r),0,255)}ce.prototype.prepareSegment=function(e,r,a,d){var _=this.segments[this.segments.length-1];return e>ce.MAX_VERTEX_ARRAY_LENGTH&&Oi("Max vertices per segment is "+ce.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+e),(!_||_.vertexLength+e>ce.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==d)&&(_={vertexOffset:r.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},d!==void 0&&(_.sortKey=d),this.segments.push(_)),_},ce.prototype.get=function(){return this.segments},ce.prototype.destroy=function(){for(var e=0,r=this.segments;e<r.length;e+=1){var a=r[e];for(var d in a.vaos)a.vaos[d].destroy()}},ce.simpleSegment=function(e,r,a,d){return new ce([{vertexOffset:e,primitiveOffset:r,vertexLength:a,primitiveLength:d,vaos:{},sortKey:0}])},ce.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,jt("SegmentVector",ce);var Ce=z([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Ae=g(function(e){e.exports=function(r,a){var d,_,S,i,t,o,l,p;for(_=r.length-(d=3&r.length),S=a,t=3432918353,o=461845907,p=0;p<_;)l=255&r.charCodeAt(p)|(255&r.charCodeAt(++p))<<8|(255&r.charCodeAt(++p))<<16|(255&r.charCodeAt(++p))<<24,++p,S=27492+(65535&(i=5*(65535&(S=(S^=l=(65535&(l=(l=(65535&l)*t+(((l>>>16)*t&65535)<<16)&4294967295)<<15|l>>>17))*o+(((l>>>16)*o&65535)<<16)&4294967295)<<13|S>>>19))+((5*(S>>>16)&65535)<<16)&4294967295))+((58964+(i>>>16)&65535)<<16);switch(l=0,d){case 3:l^=(255&r.charCodeAt(p+2))<<16;case 2:l^=(255&r.charCodeAt(p+1))<<8;case 1:S^=l=(65535&(l=(l=(65535&(l^=255&r.charCodeAt(p)))*t+(((l>>>16)*t&65535)<<16)&4294967295)<<15|l>>>17))*o+(((l>>>16)*o&65535)<<16)&4294967295}return S^=r.length,S=2246822507*(65535&(S^=S>>>16))+((2246822507*(S>>>16)&65535)<<16)&4294967295,S=3266489909*(65535&(S^=S>>>13))+((3266489909*(S>>>16)&65535)<<16)&4294967295,(S^=S>>>16)>>>0}}),ke=g(function(e){e.exports=function(r,a){for(var d,_=r.length,S=a^_,i=0;_>=4;)d=1540483477*(65535&(d=255&r.charCodeAt(i)|(255&r.charCodeAt(++i))<<8|(255&r.charCodeAt(++i))<<16|(255&r.charCodeAt(++i))<<24))+((1540483477*(d>>>16)&65535)<<16),S=1540483477*(65535&S)+((1540483477*(S>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),_-=4,++i;switch(_){case 3:S^=(255&r.charCodeAt(i+2))<<16;case 2:S^=(255&r.charCodeAt(i+1))<<8;case 1:S=1540483477*(65535&(S^=255&r.charCodeAt(i)))+((1540483477*(S>>>16)&65535)<<16)}return S=1540483477*(65535&(S^=S>>>13))+((1540483477*(S>>>16)&65535)<<16),(S^=S>>>15)>>>0}}),xe=Ae,ze=ke;xe.murmur3=Ae,xe.murmur2=ze;var Be=function(){this.ids=[],this.positions=[],this.indexed=!1};Be.prototype.add=function(e,r,a,d){this.ids.push(Je(e)),this.positions.push(r,a,d)},Be.prototype.getPositions=function(e){for(var r=Je(e),a=0,d=this.ids.length-1;a<d;){var _=a+d>>1;this.ids[_]>=r?d=_:a=_+1}for(var S=[];this.ids[a]===r;)S.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return S},Be.serialize=function(e,r){var a=new Float64Array(e.ids),d=new Uint32Array(e.positions);return function _(S,i,t,o){for(;t<o;){for(var l=S[t+o>>1],p=t-1,y=o+1;;){do p++;while(S[p]<l);do y--;while(S[y]>l);if(p>=y)break;Ye(S,p,y),Ye(i,3*p,3*y),Ye(i,3*p+1,3*y+1),Ye(i,3*p+2,3*y+2)}y-t<o-y?(_(S,i,t,y),t=y+1):(_(S,i,y+1,o),o=y)}}(a,d,0,a.length-1),r&&r.push(a.buffer,d.buffer),{ids:a,positions:d}},Be.deserialize=function(e){var r=new Be;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r};var Ge=Math.pow(2,53)-1;function Je(e){var r=+e;return!isNaN(r)&&r<=Ge?r:xe(String(e))}function Ye(e,r,a){var d=e[r];e[r]=e[a],e[a]=d}jt("FeaturePositionMap",Be);var Qe=function(e,r){this.gl=e.gl,this.location=r},ht=function(e){function r(a,d){e.call(this,a,d),this.current=0}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.set=function(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))},r}(Qe),bt=function(e){function r(a,d){e.call(this,a,d),this.current=0}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.set=function(a){this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))},r}(Qe),xt=function(e){function r(a,d){e.call(this,a,d),this.current=[0,0]}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.set=function(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))},r}(Qe),Dt=function(e){function r(a,d){e.call(this,a,d),this.current=[0,0,0]}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.set=function(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))},r}(Qe),Yt=function(e){function r(a,d){e.call(this,a,d),this.current=[0,0,0,0]}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.set=function(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3]))},r}(Qe),ti=function(e){function r(a,d){e.call(this,a,d),this.current=di.transparent}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.set=function(a){a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a))},r}(Qe),Jt=new Float32Array(16),Mi=function(e){function r(a,d){e.call(this,a,d),this.current=Jt}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.set=function(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(var d=1;d<16;d++)if(a[d]!==this.current[d]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}},r}(Qe);function Nt(e){return[de(255*e.r,255*e.g),de(255*e.b,255*e.a)]}var fi=function(e,r,a){this.value=e,this.uniformNames=r.map(function(d){return"u_"+d}),this.type=a};fi.prototype.setUniform=function(e,r,a){e.set(a.constantOr(this.value))},fi.prototype.getBinding=function(e,r,a){return this.type==="color"?new ti(e,r):new bt(e,r)};var Ci=function(e,r){this.uniformNames=r.map(function(a){return"u_"+a}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Ci.prototype.setConstantPatternPositions=function(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr},Ci.prototype.setUniform=function(e,r,a,d){var _=d==="u_pattern_to"?this.patternTo:d==="u_pattern_from"?this.patternFrom:d==="u_pixel_ratio_to"?this.pixelRatioTo:d==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&e.set(_)},Ci.prototype.getBinding=function(e,r,a){return a.substr(0,9)==="u_pattern"?new Yt(e,r):new bt(e,r)};var pi=function(e,r,a,d){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map(function(_){return{name:"a_"+_,type:"Float32",components:a==="color"?2:1,offset:0}}),this.paintVertexArray=new d};pi.prototype.populatePaintArray=function(e,r,a,d,_){var S=this.paintVertexArray.length,i=this.expression.evaluate(new At(0),r,{},d,[],_);this.paintVertexArray.resize(e),this._setPaintValue(S,e,i)},pi.prototype.updatePaintArray=function(e,r,a,d){var _=this.expression.evaluate({zoom:0},a,d);this._setPaintValue(e,r,_)},pi.prototype._setPaintValue=function(e,r,a){if(this.type==="color")for(var d=Nt(a),_=e;_<r;_++)this.paintVertexArray.emplace(_,d[0],d[1]);else{for(var S=e;S<r;S++)this.paintVertexArray.emplace(S,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}},pi.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},pi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var li=function(e,r,a,d,_,S){this.expression=e,this.uniformNames=r.map(function(i){return"u_"+i+"_t"}),this.type=a,this.useIntegerZoom=d,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=r.map(function(i){return{name:"a_"+i,type:"Float32",components:a==="color"?4:2,offset:0}}),this.paintVertexArray=new S};li.prototype.populatePaintArray=function(e,r,a,d,_){var S=this.expression.evaluate(new At(this.zoom),r,{},d,[],_),i=this.expression.evaluate(new At(this.zoom+1),r,{},d,[],_),t=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(t,e,S,i)},li.prototype.updatePaintArray=function(e,r,a,d){var _=this.expression.evaluate({zoom:this.zoom},a,d),S=this.expression.evaluate({zoom:this.zoom+1},a,d);this._setPaintValue(e,r,_,S)},li.prototype._setPaintValue=function(e,r,a,d){if(this.type==="color")for(var _=Nt(a),S=Nt(d),i=e;i<r;i++)this.paintVertexArray.emplace(i,_[0],_[1],S[0],S[1]);else{for(var t=e;t<r;t++)this.paintVertexArray.emplace(t,a,d);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(d))}},li.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},li.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},li.prototype.setUniform=function(e,r){var a=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,d=vt(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);e.set(d)},li.prototype.getBinding=function(e,r,a){return new bt(e,r)};var _i=function(e,r,a,d,_,S){this.expression=e,this.type=r,this.useIntegerZoom=a,this.zoom=d,this.layerId=S,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _};_i.prototype.populatePaintArray=function(e,r,a){var d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(d,e,r.patterns&&r.patterns[this.layerId],a)},_i.prototype.updatePaintArray=function(e,r,a,d,_){this._setPaintValues(e,r,a.patterns&&a.patterns[this.layerId],_)},_i.prototype._setPaintValues=function(e,r,a,d){if(d&&a){var _=d[a.min],S=d[a.mid],i=d[a.max];if(_&&S&&i)for(var t=e;t<r;t++)this.zoomInPaintVertexArray.emplace(t,S.tl[0],S.tl[1],S.br[0],S.br[1],_.tl[0],_.tl[1],_.br[0],_.br[1],S.pixelRatio,_.pixelRatio),this.zoomOutPaintVertexArray.emplace(t,S.tl[0],S.tl[1],S.br[0],S.br[1],i.tl[0],i.tl[1],i.br[0],i.br[1],S.pixelRatio,i.pixelRatio)}},_i.prototype.upload=function(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Ce.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Ce.members,this.expression.isStateDependent))},_i.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var ri=function(e,r,a){this.binders={},this._buffers=[];var d=[];for(var _ in e.paint._values)if(a(_)){var S=e.paint.get(_);if(S instanceof Zn&&oa(S.property.specification)){var i=Ar(_,e.type),t=S.value,o=S.property.specification.type,l=S.property.useIntegerZoom,p=S.property.specification["property-type"],y=p==="cross-faded"||p==="cross-faded-data-driven";if(t.kind==="constant")this.binders[_]=y?new Ci(t.value,i):new fi(t.value,i,o),d.push("/u_"+_);else if(t.kind==="source"||y){var v=Ur(_,o,"source");this.binders[_]=y?new _i(t,o,l,r,v,e.id):new pi(t,i,o,v),d.push("/a_"+_)}else{var I=Ur(_,o,"composite");this.binders[_]=new li(t,i,o,l,r,I),d.push("/z_"+_)}}}this.cacheKey=d.sort().join("")};ri.prototype.getMaxValue=function(e){var r=this.binders[e];return r instanceof pi||r instanceof li?r.maxValue:0},ri.prototype.populatePaintArrays=function(e,r,a,d,_){for(var S in this.binders){var i=this.binders[S];(i instanceof pi||i instanceof li||i instanceof _i)&&i.populatePaintArray(e,r,a,d,_)}},ri.prototype.setConstantPatternPositions=function(e,r){for(var a in this.binders){var d=this.binders[a];d instanceof Ci&&d.setConstantPatternPositions(e,r)}},ri.prototype.updatePaintArrays=function(e,r,a,d,_){var S=!1;for(var i in e)for(var t=0,o=r.getPositions(i);t<o.length;t+=1){var l=o[t],p=a.feature(l.index);for(var y in this.binders){var v=this.binders[y];if((v instanceof pi||v instanceof li||v instanceof _i)&&v.expression.isStateDependent===!0){var I=d.paint.get(y);v.expression=I.value,v.updatePaintArray(l.start,l.end,p,e[i],_),S=!0}}}return S},ri.prototype.defines=function(){var e=[];for(var r in this.binders){var a=this.binders[r];(a instanceof fi||a instanceof Ci)&&e.push.apply(e,a.uniformNames.map(function(d){return"#define HAS_UNIFORM_"+d}))}return e},ri.prototype.getBinderAttributes=function(){var e=[];for(var r in this.binders){var a=this.binders[r];if(a instanceof pi||a instanceof li)for(var d=0;d<a.paintVertexAttributes.length;d++)e.push(a.paintVertexAttributes[d].name);else if(a instanceof _i)for(var _=0;_<Ce.members.length;_++)e.push(Ce.members[_].name)}return e},ri.prototype.getBinderUniforms=function(){var e=[];for(var r in this.binders){var a=this.binders[r];if(a instanceof fi||a instanceof Ci||a instanceof li)for(var d=0,_=a.uniformNames;d<_.length;d+=1)e.push(_[d])}return e},ri.prototype.getPaintVertexBuffers=function(){return this._buffers},ri.prototype.getUniforms=function(e,r){var a=[];for(var d in this.binders){var _=this.binders[d];if(_ instanceof fi||_ instanceof Ci||_ instanceof li)for(var S=0,i=_.uniformNames;S<i.length;S+=1){var t=i[S];if(r[t]){var o=_.getBinding(e,r[t],t);a.push({name:t,property:d,binding:o})}}}return a},ri.prototype.setUniforms=function(e,r,a,d){for(var _=0,S=r;_<S.length;_+=1){var i=S[_],t=i.name,o=i.property;this.binders[o].setUniform(i.binding,d,a.get(o),t)}},ri.prototype.updatePaintBuffers=function(e){for(var r in this._buffers=[],this.binders){var a=this.binders[r];if(e&&a instanceof _i){var d=e.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(a instanceof pi||a instanceof li)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}},ri.prototype.upload=function(e){for(var r in this.binders){var a=this.binders[r];(a instanceof pi||a instanceof li||a instanceof _i)&&a.upload(e)}this.updatePaintBuffers()},ri.prototype.destroy=function(){for(var e in this.binders){var r=this.binders[e];(r instanceof pi||r instanceof li||r instanceof _i)&&r.destroy()}};var ei=function(e,r,a){a===void 0&&(a=function(){return!0}),this.programConfigurations={};for(var d=0,_=e;d<_.length;d+=1){var S=_[d];this.programConfigurations[S.id]=new ri(S,r,a)}this.needsUpload=!1,this._featureMap=new Be,this._bufferOffset=0};function Ar(e,r){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace(r+"-","").replace(/-/g,"_")]}function Ur(e,r,a){var d={color:{source:ae,composite:gi},number:{source:yt,composite:ae}},_=function(S){return{"line-pattern":{source:_e,composite:_e},"fill-pattern":{source:_e,composite:_e},"fill-extrusion-pattern":{source:_e,composite:_e}}[S]}(e);return _&&_[a]||d[r][a]}ei.prototype.populatePaintArrays=function(e,r,a,d,_,S){for(var i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(e,r,d,_,S);r.id!==void 0&&this._featureMap.add(r.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0},ei.prototype.updatePaintArrays=function(e,r,a,d){for(var _=0,S=a;_<S.length;_+=1){var i=S[_];this.needsUpload=this.programConfigurations[i.id].updatePaintArrays(e,this._featureMap,r,i,d)||this.needsUpload}},ei.prototype.get=function(e){return this.programConfigurations[e]},ei.prototype.upload=function(e){if(this.needsUpload){for(var r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}},ei.prototype.destroy=function(){for(var e in this.programConfigurations)this.programConfigurations[e].destroy()},jt("ConstantBinder",fi),jt("CrossFadedConstantBinder",Ci),jt("SourceExpressionBinder",pi),jt("CrossFadedCompositeBinder",_i),jt("CompositeExpressionBinder",li),jt("ProgramConfiguration",ri,{omit:["_buffers"]}),jt("ProgramConfigurationSet",ei);var Qr=Math.pow(2,14)-1,Bn=-Qr-1;function zr(e){for(var r=8192/e.extent,a=e.loadGeometry(),d=0;d<a.length;d++)for(var _=a[d],S=0;S<_.length;S++){var i=_[S],t=Math.round(i.x*r),o=Math.round(i.y*r);i.x=vt(t,Bn,Qr),i.y=vt(o,Bn,Qr),(t<i.x||t>i.x+1||o<i.y||o>i.y+1)&&Oi("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return a}function Di(e,r){return{type:e.type,id:e.id,properties:e.properties,geometry:r?zr(e):[]}}function co(e,r,a,d,_){e.emplaceBack(2*r+(d+1)/2,2*a+(_+1)/2)}var Qn=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(r){return r.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new V,this.indexArray=new ut,this.segments=new ce,this.programConfigurations=new ei(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(function(r){return r.isStateDependent()}).map(function(r){return r.id})};function Bo(e,r){for(var a=0;a<e.length;a++)if(Ga(r,e[a]))return!0;for(var d=0;d<r.length;d++)if(Ga(e,r[d]))return!0;return!!Fl(e,r)}function gn(e,r,a){return!!Ga(e,r)||!!ds(r,e,a)}function Oo(e,r){if(e.length===1)return cl(r,e[0]);for(var a=0;a<r.length;a++)for(var d=r[a],_=0;_<d.length;_++)if(Ga(e,d[_]))return!0;for(var S=0;S<e.length;S++)if(cl(r,e[S]))return!0;for(var i=0;i<r.length;i++)if(Fl(e,r[i]))return!0;return!1}function Fo(e,r,a){if(e.length>1){if(Fl(e,r))return!0;for(var d=0;d<r.length;d++)if(ds(r[d],e,a))return!0}for(var _=0;_<e.length;_++)if(ds(e[_],r,a))return!0;return!1}function Fl(e,r){if(e.length===0||r.length===0)return!1;for(var a=0;a<e.length-1;a++)for(var d=e[a],_=e[a+1],S=0;S<r.length-1;S++)if(Ul(d,_,r[S],r[S+1]))return!0;return!1}function Ul(e,r,a,d){return hr(e,a,d)!==hr(r,a,d)&&hr(e,r,a)!==hr(e,r,d)}function ds(e,r,a){var d=a*a;if(r.length===1)return e.distSqr(r[0])<d;for(var _=1;_<r.length;_++)if(Vl(e,r[_-1],r[_])<d)return!0;return!1}function Vl(e,r,a){var d=r.distSqr(a);if(d===0)return e.distSqr(r);var _=((e.x-r.x)*(a.x-r.x)+(e.y-r.y)*(a.y-r.y))/d;return e.distSqr(_<0?r:_>1?a:a.sub(r)._mult(_)._add(r))}function cl(e,r){for(var a,d,_,S=!1,i=0;i<e.length;i++)for(var t=0,o=(a=e[i]).length-1;t<a.length;o=t++)(d=a[t]).y>r.y!=(_=a[o]).y>r.y&&r.x<(_.x-d.x)*(r.y-d.y)/(_.y-d.y)+d.x&&(S=!S);return S}function Ga(e,r){for(var a=!1,d=0,_=e.length-1;d<e.length;_=d++){var S=e[d],i=e[_];S.y>r.y!=i.y>r.y&&r.x<(i.x-S.x)*(r.y-S.y)/(i.y-S.y)+S.x&&(a=!a)}return a}function hl(e,r,a){var d=a[0],_=a[2];if(e.x<d.x&&r.x<d.x||e.x>_.x&&r.x>_.x||e.y<d.y&&r.y<d.y||e.y>_.y&&r.y>_.y)return!1;var S=hr(e,r,a[0]);return S!==hr(e,r,a[1])||S!==hr(e,r,a[2])||S!==hr(e,r,a[3])}function Ca(e,r,a){var d=r.paint.get(e).value;return d.kind==="constant"?d.value:a.programConfigurations.get(r.id).getMaxValue(e)}function yn(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Uo(e,r,a,d,_){if(!r[0]&&!r[1])return e;var S=he.convert(r)._mult(_);a==="viewport"&&S._rotate(-d);for(var i=[],t=0;t<e.length;t++)i.push(e[t].sub(S));return i}Qn.prototype.populate=function(e,r,a){var d=this.layers[0],_=[],S=null;d.type==="circle"&&(S=d.layout.get("circle-sort-key"));for(var i=0,t=e;i<t.length;i+=1){var o=t[i],l=o.feature,p=o.id,y=o.index,v=o.sourceLayerIndex,I=this.layers[0]._featureFilter.needGeometry,k=Di(l,I);if(this.layers[0]._featureFilter.filter(new At(this.zoom),k,a)){var L=S?S.evaluate(k,{},a):void 0,O={id:p,properties:l.properties,type:l.type,sourceLayerIndex:v,index:y,geometry:I?k.geometry:zr(l),patterns:{},sortKey:L};_.push(O)}}S&&_.sort(function(De,Fe){return De.sortKey-Fe.sortKey});for(var B=0,q=_;B<q.length;B+=1){var $=q[B],W=$.geometry,ne=$.index,ue=$.sourceLayerIndex,Ie=e[ne].feature;this.addFeature($,W,ne,a),r.featureIndex.insert(Ie,W,ne,ue,this.index)}},Qn.prototype.update=function(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)},Qn.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Qn.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Qn.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,le),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Qn.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Qn.prototype.addFeature=function(e,r,a,d){for(var _=0,S=r;_<S.length;_+=1)for(var i=0,t=S[_];i<t.length;i+=1){var o=t[i],l=o.x,p=o.y;if(!(l<0||l>=8192||p<0||p>=8192)){var y=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),v=y.vertexLength;co(this.layoutVertexArray,l,p,-1,-1),co(this.layoutVertexArray,l,p,1,-1),co(this.layoutVertexArray,l,p,1,1),co(this.layoutVertexArray,l,p,-1,1),this.indexArray.emplaceBack(v,v+1,v+2),this.indexArray.emplaceBack(v,v+3,v+2),y.vertexLength+=4,y.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},d)},jt("CircleBucket",Qn,{omit:["layers"]});var Os=new b({"circle-sort-key":new zt(fe.layout_circle["circle-sort-key"])}),za={paint:new b({"circle-radius":new zt(fe.paint_circle["circle-radius"]),"circle-color":new zt(fe.paint_circle["circle-color"]),"circle-blur":new zt(fe.paint_circle["circle-blur"]),"circle-opacity":new zt(fe.paint_circle["circle-opacity"]),"circle-translate":new Pt(fe.paint_circle["circle-translate"]),"circle-translate-anchor":new Pt(fe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Pt(fe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Pt(fe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new zt(fe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new zt(fe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new zt(fe.paint_circle["circle-stroke-opacity"])}),layout:Os},ji=typeof Float32Array!="undefined"?Float32Array:Array;function ho(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Io(e,r,a){var d=r[0],_=r[1],S=r[2],i=r[3],t=r[4],o=r[5],l=r[6],p=r[7],y=r[8],v=r[9],I=r[10],k=r[11],L=r[12],O=r[13],B=r[14],q=r[15],$=a[0],W=a[1],ne=a[2],ue=a[3];return e[0]=$*d+W*t+ne*y+ue*L,e[1]=$*_+W*o+ne*v+ue*O,e[2]=$*S+W*l+ne*I+ue*B,e[3]=$*i+W*p+ne*k+ue*q,e[4]=($=a[4])*d+(W=a[5])*t+(ne=a[6])*y+(ue=a[7])*L,e[5]=$*_+W*o+ne*v+ue*O,e[6]=$*S+W*l+ne*I+ue*B,e[7]=$*i+W*p+ne*k+ue*q,e[8]=($=a[8])*d+(W=a[9])*t+(ne=a[10])*y+(ue=a[11])*L,e[9]=$*_+W*o+ne*v+ue*O,e[10]=$*S+W*l+ne*I+ue*B,e[11]=$*i+W*p+ne*k+ue*q,e[12]=($=a[12])*d+(W=a[13])*t+(ne=a[14])*y+(ue=a[15])*L,e[13]=$*_+W*o+ne*v+ue*O,e[14]=$*S+W*l+ne*I+ue*B,e[15]=$*i+W*p+ne*k+ue*q,e}Math.hypot||(Math.hypot=function(){for(var e=arguments,r=0,a=arguments.length;a--;)r+=e[a]*e[a];return Math.sqrt(r)});var pl,Nl=Io;function jl(e,r,a){var d=r[0],_=r[1],S=r[2],i=r[3];return e[0]=a[0]*d+a[4]*_+a[8]*S+a[12]*i,e[1]=a[1]*d+a[5]*_+a[9]*S+a[13]*i,e[2]=a[2]*d+a[6]*_+a[10]*S+a[14]*i,e[3]=a[3]*d+a[7]*_+a[11]*S+a[15]*i,e}pl=new ji(3),ji!=Float32Array&&(pl[0]=0,pl[1]=0,pl[2]=0),function(){var e=new ji(4);ji!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}();var lh=(function(){var e=new ji(2);ji!=Float32Array&&(e[0]=0,e[1]=0)}(),function(e){function r(a){e.call(this,a,za)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.createBucket=function(a){return new Qn(a)},r.prototype.queryRadius=function(a){var d=a;return Ca("circle-radius",this,d)+Ca("circle-stroke-width",this,d)+yn(this.paint.get("circle-translate"))},r.prototype.queryIntersectsFeature=function(a,d,_,S,i,t,o,l){for(var p=Uo(a,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),t.angle,o),y=this.paint.get("circle-radius").evaluate(d,_)+this.paint.get("circle-stroke-width").evaluate(d,_),v=this.paint.get("circle-pitch-alignment")==="map",I=v?p:function(Ie,De){return Ie.map(function(Fe){return fs(Fe,De)})}(p,l),k=v?y*o:y,L=0,O=S;L<O.length;L+=1)for(var B=0,q=O[L];B<q.length;B+=1){var $=q[B],W=v?$:fs($,l),ne=k,ue=jl([],[$.x,$.y,0,1],l);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ne*=ue[3]/t.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ne*=t.cameraToCenterDistance/ue[3]),gn(I,W,ne))return!0}return!1},r}(n));function fs(e,r){var a=jl([],[e.x,e.y,0,1],r);return new he(a[0]/a[3],a[1]/a[3])}var uh=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r}(Qn);function ms(e,r,a,d){var _=r.width,S=r.height;if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==_*S*a)throw new RangeError("mismatched image size")}else d=new Uint8Array(_*S*a);return e.width=_,e.height=S,e.data=d,e}function Au(e,r,a){var d=r.width,_=r.height;if(d!==e.width||_!==e.height){var S=ms({},{width:d,height:_},a);ch(e,S,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,d),height:Math.min(e.height,_)},a),e.width=d,e.height=_,e.data=S.data}}function ch(e,r,a,d,_,S){if(_.width===0||_.height===0)return r;if(_.width>e.width||_.height>e.height||a.x>e.width-_.width||a.y>e.height-_.height)throw new RangeError("out of range source coordinates for image copy");if(_.width>r.width||_.height>r.height||d.x>r.width-_.width||d.y>r.height-_.height)throw new RangeError("out of range destination coordinates for image copy");for(var i=e.data,t=r.data,o=0;o<_.height;o++)for(var l=((a.y+o)*e.width+a.x)*S,p=((d.y+o)*r.width+d.x)*S,y=0;y<_.width*S;y++)t[p+y]=i[l+y];return r}jt("HeatmapBucket",uh,{omit:["layers"]});var Iu=function(e,r){ms(this,e,1,r)};Iu.prototype.resize=function(e){Au(this,e,1)},Iu.prototype.clone=function(){return new Iu({width:this.width,height:this.height},new Uint8Array(this.data))},Iu.copy=function(e,r,a,d,_){ch(e,r,a,d,_,1)};var po=function(e,r){ms(this,e,4,r)};po.prototype.resize=function(e){Au(this,e,4)},po.prototype.replace=function(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e},po.prototype.clone=function(){return new po({width:this.width,height:this.height},new Uint8Array(this.data))},po.copy=function(e,r,a,d,_){ch(e,r,a,d,_,4)},jt("AlphaImage",Iu),jt("RGBAImage",po);var Ip={paint:new b({"heatmap-radius":new zt(fe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new zt(fe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Pt(fe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Yn(fe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Pt(fe.paint_heatmap["heatmap-opacity"])})};function hh(e){var r={},a=e.resolution||256,d=e.clips?e.clips.length:1,_=e.image||new po({width:a,height:d}),S=function(k,L,O){r[e.evaluationKey]=O;var B=e.expression.evaluate(r);_.data[k+L+0]=Math.floor(255*B.r/B.a),_.data[k+L+1]=Math.floor(255*B.g/B.a),_.data[k+L+2]=Math.floor(255*B.b/B.a),_.data[k+L+3]=Math.floor(255*B.a)};if(e.clips)for(var i=0,t=0;i<d;++i,t+=4*a)for(var o=0,l=0;o<a;o++,l+=4){var p=o/(a-1),y=e.clips[i];S(t,l,y.start*(1-p)+y.end*p)}else for(var v=0,I=0;v<a;v++,I+=4)S(0,I,v/(a-1));return _}var Ic=function(e){function r(a){e.call(this,a,Ip),this._updateColorRamp()}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.createBucket=function(a){return new uh(a)},r.prototype._handleSpecialPaintPropertyUpdate=function(a){a==="heatmap-color"&&this._updateColorRamp()},r.prototype._updateColorRamp=function(){this.colorRamp=hh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},r.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},r.prototype.queryRadius=function(){return 0},r.prototype.queryIntersectsFeature=function(){return!1},r.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},r}(n),Pa={paint:new b({"hillshade-illumination-direction":new Pt(fe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Pt(fe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Pt(fe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Pt(fe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Pt(fe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Pt(fe.paint_hillshade["hillshade-accent-color"])})},Cp=function(e){function r(a){e.call(this,a,Pa)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},r}(n),Bd=z([{name:"a_pos",components:2,type:"Int16"}],4).members,Gh=Yu,Od=Yu;function Yu(e,r,a){a=a||2;var d,_,S,i,t,o,l,p=r&&r.length,y=p?r[0]*a:e.length,v=Cc(e,0,y,a,!0),I=[];if(!v||v.next===v.prev)return I;if(p&&(v=function(L,O,B,q){var $,W,ne,ue=[];for($=0,W=O.length;$<W;$++)(ne=Cc(L,O[$]*q,$<W-1?O[$+1]*q:L.length,q,!1))===ne.next&&(ne.steiner=!0),ue.push(Xh(ne));for(ue.sort(Nd),$=0;$<ue.length;$++)jd(ue[$],B),B=dl(B,B.next);return B}(e,r,v,a)),e.length>80*a){d=S=e[0],_=i=e[1];for(var k=a;k<y;k+=a)(t=e[k])<d&&(d=t),(o=e[k+1])<_&&(_=o),t>S&&(S=t),o>i&&(i=o);l=(l=Math.max(S-d,i-_))!==0?1/l:0}return Za(v,I,a,d,_,l),I}function Cc(e,r,a,d,_){var S,i;if(_===Mc(e,r,a,d)>0)for(S=r;S<a;S+=d)i=$h(S,e[S],e[S+1],i);else for(S=a-d;S>=r;S-=d)i=$h(S,e[S],e[S+1],i);return i&&Gr(i,i.next)&&(ic(i),i=i.next),i}function dl(e,r){if(!e)return e;r||(r=e);var a,d=e;do if(a=!1,d.steiner||!Gr(d,d.next)&&_n(d.prev,d,d.next)!==0)d=d.next;else{if(ic(d),(d=r=d.prev)===d.next)break;a=!0}while(a||d!==r);return r}function Za(e,r,a,d,_,S,i){if(e){!i&&S&&function(p,y,v,I){var k=p;do k.z===null&&(k.z=Zh(k.x,k.y,y,v,I)),k.prevZ=k.prev,k.nextZ=k.next,k=k.next;while(k!==p);k.prevZ.nextZ=null,k.prevZ=null,function(L){var O,B,q,$,W,ne,ue,Ie,De=1;do{for(B=L,L=null,W=null,ne=0;B;){for(ne++,q=B,ue=0,O=0;O<De&&(ue++,q=q.nextZ);O++);for(Ie=De;ue>0||Ie>0&&q;)ue!==0&&(Ie===0||!q||B.z<=q.z)?($=B,B=B.nextZ,ue--):($=q,q=q.nextZ,Ie--),W?W.nextZ=$:L=$,$.prevZ=W,W=$;B=q}W.nextZ=null,De*=2}while(ne>1)}(k)}(e,d,_,S);for(var t,o,l=e;e.prev!==e.next;)if(t=e.prev,o=e.next,S?Fd(e,d,_,S):zc(e))r.push(t.i/a),r.push(e.i/a),r.push(o.i/a),ic(e),e=o.next,l=o.next;else if((e=o)===l){i?i===1?Za(e=Ud(dl(e),r,a),r,a,d,_,S,2):i===2&&Vd(e,r,a,d,_,S):Za(dl(e),r,a,d,_,S,1);break}}}function zc(e){var r=e.prev,a=e,d=e.next;if(_n(r,a,d)>=0)return!1;for(var _=e.next.next;_!==e.prev;){if(Qu(r.x,r.y,a.x,a.y,d.x,d.y,_.x,_.y)&&_n(_.prev,_,_.next)>=0)return!1;_=_.next}return!0}function Fd(e,r,a,d){var _=e.prev,S=e,i=e.next;if(_n(_,S,i)>=0)return!1;for(var t=_.x>S.x?_.x>i.x?_.x:i.x:S.x>i.x?S.x:i.x,o=_.y>S.y?_.y>i.y?_.y:i.y:S.y>i.y?S.y:i.y,l=Zh(_.x<S.x?_.x<i.x?_.x:i.x:S.x<i.x?S.x:i.x,_.y<S.y?_.y<i.y?_.y:i.y:S.y<i.y?S.y:i.y,r,a,d),p=Zh(t,o,r,a,d),y=e.prevZ,v=e.nextZ;y&&y.z>=l&&v&&v.z<=p;){if(y!==e.prev&&y!==e.next&&Qu(_.x,_.y,S.x,S.y,i.x,i.y,y.x,y.y)&&_n(y.prev,y,y.next)>=0||(y=y.prevZ,v!==e.prev&&v!==e.next&&Qu(_.x,_.y,S.x,S.y,i.x,i.y,v.x,v.y)&&_n(v.prev,v,v.next)>=0))return!1;v=v.nextZ}for(;y&&y.z>=l;){if(y!==e.prev&&y!==e.next&&Qu(_.x,_.y,S.x,S.y,i.x,i.y,y.x,y.y)&&_n(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;v&&v.z<=p;){if(v!==e.prev&&v!==e.next&&Qu(_.x,_.y,S.x,S.y,i.x,i.y,v.x,v.y)&&_n(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function Ud(e,r,a){var d=e;do{var _=d.prev,S=d.next.next;!Gr(_,S)&&Pc(_,d,d.next,S)&&ql(_,S)&&ql(S,_)&&(r.push(_.i/a),r.push(d.i/a),r.push(S.i/a),ic(d),ic(d.next),d=e=S),d=d.next}while(d!==e);return dl(d)}function Vd(e,r,a,d,_,S){var i=e;do{for(var t=i.next.next;t!==i.prev;){if(i.i!==t.i&&ec(i,t)){var o=tc(i,t);return i=dl(i,i.next),o=dl(o,o.next),Za(i,r,a,d,_,S),void Za(o,r,a,d,_,S)}t=t.next}i=i.next}while(i!==e)}function Nd(e,r){return e.x-r.x}function jd(e,r){if(r=function(d,_){var S,i=_,t=d.x,o=d.y,l=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var p=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(p<=t&&p>l){if(l=p,p===t){if(o===i.y)return i;if(o===i.next.y)return i.next}S=i.x<i.next.x?i:i.next}}i=i.next}while(i!==_);if(!S)return null;if(t===l)return S;var y,v=S,I=S.x,k=S.y,L=1/0;i=S;do t>=i.x&&i.x>=I&&t!==i.x&&Qu(o<k?t:l,o,I,k,o<k?l:t,o,i.x,i.y)&&(y=Math.abs(o-i.y)/(t-i.x),ql(i,d)&&(y<L||y===L&&(i.x>S.x||i.x===S.x&&qd(S,i)))&&(S=i,L=y)),i=i.next;while(i!==v);return S}(e,r)){var a=tc(r,e);dl(r,r.next),dl(a,a.next)}}function qd(e,r){return _n(e.prev,e,r.prev)<0&&_n(r.next,e,e.next)<0}function Zh(e,r,a,d,_){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-a)*_)|e<<8))|e<<4))|e<<2))|e<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-d)*_)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function Xh(e){var r=e,a=e;do(r.x<a.x||r.x===a.x&&r.y<a.y)&&(a=r),r=r.next;while(r!==e);return a}function Qu(e,r,a,d,_,S,i,t){return(_-i)*(r-t)-(e-i)*(S-t)>=0&&(e-i)*(d-t)-(a-i)*(r-t)>=0&&(a-i)*(S-t)-(_-i)*(d-t)>=0}function ec(e,r){return e.next.i!==r.i&&e.prev.i!==r.i&&!function(a,d){var _=a;do{if(_.i!==a.i&&_.next.i!==a.i&&_.i!==d.i&&_.next.i!==d.i&&Pc(_,_.next,a,d))return!0;_=_.next}while(_!==a);return!1}(e,r)&&(ql(e,r)&&ql(r,e)&&function(a,d){var _=a,S=!1,i=(a.x+d.x)/2,t=(a.y+d.y)/2;do _.y>t!=_.next.y>t&&_.next.y!==_.y&&i<(_.next.x-_.x)*(t-_.y)/(_.next.y-_.y)+_.x&&(S=!S),_=_.next;while(_!==a);return S}(e,r)&&(_n(e.prev,e,r.prev)||_n(e,r.prev,r))||Gr(e,r)&&_n(e.prev,e,e.next)>0&&_n(r.prev,r,r.next)>0)}function _n(e,r,a){return(r.y-e.y)*(a.x-r.x)-(r.x-e.x)*(a.y-r.y)}function Gr(e,r){return e.x===r.x&&e.y===r.y}function Pc(e,r,a,d){var _=Cu(_n(e,r,a)),S=Cu(_n(e,r,d)),i=Cu(_n(a,d,e)),t=Cu(_n(a,d,r));return _!==S&&i!==t||!(_!==0||!kc(e,a,r))||!(S!==0||!kc(e,d,r))||!(i!==0||!kc(a,e,d))||!(t!==0||!kc(a,r,d))}function kc(e,r,a){return r.x<=Math.max(e.x,a.x)&&r.x>=Math.min(e.x,a.x)&&r.y<=Math.max(e.y,a.y)&&r.y>=Math.min(e.y,a.y)}function Cu(e){return e>0?1:e<0?-1:0}function ql(e,r){return _n(e.prev,e,e.next)<0?_n(e,r,e.next)>=0&&_n(e,e.prev,r)>=0:_n(e,r,e.prev)<0||_n(e,e.next,r)<0}function tc(e,r){var a=new zu(e.i,e.x,e.y),d=new zu(r.i,r.x,r.y),_=e.next,S=r.prev;return e.next=r,r.prev=e,a.next=_,_.prev=a,d.next=a,a.prev=d,S.next=d,d.prev=S,d}function $h(e,r,a,d){var _=new zu(e,r,a);return d?(_.next=d.next,_.prev=d,d.next.prev=_,d.next=_):(_.prev=_,_.next=_),_}function ic(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function zu(e,r,a){this.i=e,this.x=r,this.y=a,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Mc(e,r,a,d){for(var _=0,S=r,i=a-d;S<a;S+=d)_+=(e[i]-e[S])*(e[S+1]+e[i+1]),i=S;return _}function Hh(e,r,a,d,_){(function S(i,t,o,l,p){for(;l>o;){if(l-o>600){var y=l-o+1,v=t-o+1,I=Math.log(y),k=.5*Math.exp(2*I/3),L=.5*Math.sqrt(I*k*(y-k)/y)*(v-y/2<0?-1:1);S(i,t,Math.max(o,Math.floor(t-v*k/y+L)),Math.min(l,Math.floor(t+(y-v)*k/y+L)),p)}var O=i[t],B=o,q=l;for(rc(i,o,t),p(i[l],O)>0&&rc(i,o,l);B<q;){for(rc(i,B,q),B++,q--;p(i[B],O)<0;)B++;for(;p(i[q],O)>0;)q--}p(i[o],O)===0?rc(i,o,q):rc(i,++q,l),q<=t&&(o=q+1),t<=q&&(l=q-1)}})(e,r,a||0,d||e.length-1,_||Gd)}function rc(e,r,a){var d=e[r];e[r]=e[a],e[a]=d}function Gd(e,r){return e<r?-1:e>r?1:0}function ph(e,r){var a=e.length;if(a<=1)return[e];for(var d,_,S=[],i=0;i<a;i++){var t=eo(e[i]);t!==0&&(e[i].area=Math.abs(t),_===void 0&&(_=t<0),_===t<0?(d&&S.push(d),d=[e[i]]):d.push(e[i]))}if(d&&S.push(d),r>1)for(var o=0;o<S.length;o++)S[o].length<=r||(Hh(S[o],r,1,S[o].length-1,Lc),S[o]=S[o].slice(0,r));return S}function Lc(e,r){return r.area-e.area}function Wh(e,r,a){for(var d=a.patternDependencies,_=!1,S=0,i=r;S<i.length;S+=1){var t=i[S].paint.get(e+"-pattern");t.isConstant()||(_=!0);var o=t.constantOr(null);o&&(_=!0,d[o.to]=!0,d[o.from]=!0)}return _}function Dc(e,r,a,d,_){for(var S=_.patternDependencies,i=0,t=r;i<t.length;i+=1){var o=t[i],l=o.paint.get(e+"-pattern").value;if(l.kind!=="constant"){var p=l.evaluate({zoom:d-1},a,{},_.availableImages),y=l.evaluate({zoom:d},a,{},_.availableImages),v=l.evaluate({zoom:d+1},a,{},_.availableImages);y=y&&y.name?y.name:y,v=v&&v.name?v.name:v,S[p=p&&p.name?p.name:p]=!0,S[y]=!0,S[v]=!0,a.patterns[o.id]={min:p,mid:y,max:v}}}return a}Yu.deviation=function(e,r,a,d){var _=r&&r.length,S=Math.abs(Mc(e,0,_?r[0]*a:e.length,a));if(_)for(var i=0,t=r.length;i<t;i++)S-=Math.abs(Mc(e,r[i]*a,i<t-1?r[i+1]*a:e.length,a));var o=0;for(i=0;i<d.length;i+=3){var l=d[i]*a,p=d[i+1]*a,y=d[i+2]*a;o+=Math.abs((e[l]-e[y])*(e[p+1]-e[l+1])-(e[l]-e[p])*(e[y+1]-e[l+1]))}return S===0&&o===0?0:Math.abs((o-S)/S)},Yu.flatten=function(e){for(var r=e[0][0].length,a={vertices:[],holes:[],dimensions:r},d=0,_=0;_<e.length;_++){for(var S=0;S<e[_].length;S++)for(var i=0;i<r;i++)a.vertices.push(e[_][S][i]);_>0&&a.holes.push(d+=e[_-1].length)}return a},Gh.default=Od;var gs=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(r){return r.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new V,this.indexArray=new ut,this.indexArray2=new Kt,this.programConfigurations=new ei(e.layers,e.zoom),this.segments=new ce,this.segments2=new ce,this.stateDependentLayerIds=this.layers.filter(function(r){return r.isStateDependent()}).map(function(r){return r.id})};gs.prototype.populate=function(e,r,a){this.hasPattern=Wh("fill",this.layers,r);for(var d=this.layers[0].layout.get("fill-sort-key"),_=[],S=0,i=e;S<i.length;S+=1){var t=i[S],o=t.feature,l=t.id,p=t.index,y=t.sourceLayerIndex,v=this.layers[0]._featureFilter.needGeometry,I=Di(o,v);if(this.layers[0]._featureFilter.filter(new At(this.zoom),I,a)){var k=d?d.evaluate(I,{},a,r.availableImages):void 0,L={id:l,properties:o.properties,type:o.type,sourceLayerIndex:y,index:p,geometry:v?I.geometry:zr(o),patterns:{},sortKey:k};_.push(L)}}d&&_.sort(function(Ie,De){return Ie.sortKey-De.sortKey});for(var O=0,B=_;O<B.length;O+=1){var q=B[O],$=q.geometry,W=q.index,ne=q.sourceLayerIndex;if(this.hasPattern){var ue=Dc("fill",this.layers,q,this.zoom,r);this.patternFeatures.push(ue)}else this.addFeature(q,$,W,a,{});r.featureIndex.insert(e[W].feature,$,W,ne,this.index)}},gs.prototype.update=function(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)},gs.prototype.addFeatures=function(e,r,a){for(var d=0,_=this.patternFeatures;d<_.length;d+=1){var S=_[d];this.addFeature(S,S.geometry,S.index,r,a)}},gs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},gs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},gs.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Bd),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0},gs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},gs.prototype.addFeature=function(e,r,a,d,_){for(var S=0,i=ph(r,500);S<i.length;S+=1){for(var t=i[S],o=0,l=0,p=t;l<p.length;l+=1)o+=p[l].length;for(var y=this.segments.prepareSegment(o,this.layoutVertexArray,this.indexArray),v=y.vertexLength,I=[],k=[],L=0,O=t;L<O.length;L+=1){var B=O[L];if(B.length!==0){B!==t[0]&&k.push(I.length/2);var q=this.segments2.prepareSegment(B.length,this.layoutVertexArray,this.indexArray2),$=q.vertexLength;this.layoutVertexArray.emplaceBack(B[0].x,B[0].y),this.indexArray2.emplaceBack($+B.length-1,$),I.push(B[0].x),I.push(B[0].y);for(var W=1;W<B.length;W++)this.layoutVertexArray.emplaceBack(B[W].x,B[W].y),this.indexArray2.emplaceBack($+W-1,$+W),I.push(B[W].x),I.push(B[W].y);q.vertexLength+=B.length,q.primitiveLength+=B.length}}for(var ne=Gh(I,k),ue=0;ue<ne.length;ue+=3)this.indexArray.emplaceBack(v+ne[ue],v+ne[ue+1],v+ne[ue+2]);y.vertexLength+=o,y.primitiveLength+=ne.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,_,d)},jt("FillBucket",gs,{omit:["layers","patternFeatures"]});var Kh=new b({"fill-sort-key":new zt(fe.layout_fill["fill-sort-key"])}),Jh={paint:new b({"fill-antialias":new Pt(fe.paint_fill["fill-antialias"]),"fill-opacity":new zt(fe.paint_fill["fill-opacity"]),"fill-color":new zt(fe.paint_fill["fill-color"]),"fill-outline-color":new zt(fe.paint_fill["fill-outline-color"]),"fill-translate":new Pt(fe.paint_fill["fill-translate"]),"fill-translate-anchor":new Pt(fe.paint_fill["fill-translate-anchor"]),"fill-pattern":new ul(fe.paint_fill["fill-pattern"])}),layout:Kh},Yh=function(e){function r(a){e.call(this,a,Jh)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.recalculate=function(a,d){e.prototype.recalculate.call(this,a,d);var _=this.paint._values["fill-outline-color"];_.value.kind==="constant"&&_.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},r.prototype.createBucket=function(a){return new gs(a)},r.prototype.queryRadius=function(){return yn(this.paint.get("fill-translate"))},r.prototype.queryIntersectsFeature=function(a,d,_,S,i,t,o){return Oo(Uo(a,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),t.angle,o),S)},r.prototype.isTileClipped=function(){return!0},r}(n),Zd=z([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,zp=nc;function nc(e,r,a,d,_){this.properties={},this.extent=a,this.type=0,this._pbf=e,this._geometry=-1,this._keys=d,this._values=_,e.readFields(Xd,this,r)}function Xd(e,r,a){e==1?r.id=a.readVarint():e==2?function(d,_){for(var S=d.readVarint()+d.pos;d.pos<S;){var i=_._keys[d.readVarint()],t=_._values[d.readVarint()];_.properties[i]=t}}(a,r):e==3?r.type=a.readVarint():e==4&&(r._geometry=a.pos)}function Gl(e){for(var r,a,d=0,_=0,S=e.length,i=S-1;_<S;i=_++)d+=((a=e[i]).x-(r=e[_]).x)*(r.y+a.y);return d}nc.types=["Unknown","Point","LineString","Polygon"],nc.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var r,a=e.readVarint()+e.pos,d=1,_=0,S=0,i=0,t=[];e.pos<a;){if(_<=0){var o=e.readVarint();d=7&o,_=o>>3}if(_--,d===1||d===2)S+=e.readSVarint(),i+=e.readSVarint(),d===1&&(r&&t.push(r),r=[]),r.push(new he(S,i));else{if(d!==7)throw new Error("unknown command "+d);r&&r.push(r[0].clone())}}return r&&t.push(r),t},nc.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var r=e.readVarint()+e.pos,a=1,d=0,_=0,S=0,i=1/0,t=-1/0,o=1/0,l=-1/0;e.pos<r;){if(d<=0){var p=e.readVarint();a=7&p,d=p>>3}if(d--,a===1||a===2)(_+=e.readSVarint())<i&&(i=_),_>t&&(t=_),(S+=e.readSVarint())<o&&(o=S),S>l&&(l=S);else if(a!==7)throw new Error("unknown command "+a)}return[i,o,t,l]},nc.prototype.toGeoJSON=function(e,r,a){var d,_,S=this.extent*Math.pow(2,a),i=this.extent*e,t=this.extent*r,o=this.loadGeometry(),l=nc.types[this.type];function p(I){for(var k=0;k<I.length;k++){var L=I[k];I[k]=[360*(L.x+i)/S-180,360/Math.PI*Math.atan(Math.exp((180-360*(L.y+t)/S)*Math.PI/180))-90]}}switch(this.type){case 1:var y=[];for(d=0;d<o.length;d++)y[d]=o[d][0];p(o=y);break;case 2:for(d=0;d<o.length;d++)p(o[d]);break;case 3:for(o=function(I){var k=I.length;if(k<=1)return[I];for(var L,O,B=[],q=0;q<k;q++){var $=Gl(I[q]);$!==0&&(O===void 0&&(O=$<0),O===$<0?(L&&B.push(L),L=[I[q]]):L.push(I[q]))}return L&&B.push(L),B}(o),d=0;d<o.length;d++)for(_=0;_<o[d].length;_++)p(o[d][_])}o.length===1?o=o[0]:l="Multi"+l;var v={type:"Feature",geometry:{type:l,coordinates:o},properties:this.properties};return"id"in this&&(v.id=this.id),v};var Pp=Qh;function Qh(e,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(oc,this,r),this.length=this._features.length}function oc(e,r,a){e===15?r.version=a.readVarint():e===1?r.name=a.readString():e===5?r.extent=a.readVarint():e===2?r._features.push(a.pos):e===3?r._keys.push(a.readString()):e===4&&r._values.push(function(d){for(var _=null,S=d.readVarint()+d.pos;d.pos<S;){var i=d.readVarint()>>3;_=i===1?d.readString():i===2?d.readFloat():i===3?d.readDouble():i===4?d.readVarint64():i===5?d.readVarint():i===6?d.readSVarint():i===7?d.readBoolean():null}return _}(a))}function $d(e,r,a){if(e===3){var d=new Pp(a,a.readVarint()+a.pos);d.length&&(r[d.name]=d)}}Qh.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var r=this._pbf.readVarint()+this._pbf.pos;return new zp(this._pbf,r,this.extent,this._keys,this._values)};var ac={VectorTile:function(e,r){this.layers=e.readFields($d,{},r)},VectorTileFeature:zp,VectorTileLayer:Pp},Hd=ac.VectorTileFeature.types,dh=Math.pow(2,13);function sc(e,r,a,d,_,S,i,t){e.emplaceBack(r,a,2*Math.floor(d*dh)+i,_*dh*2,S*dh*2,Math.round(t))}var ys=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(r){return r.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new K,this.indexArray=new ut,this.programConfigurations=new ei(e.layers,e.zoom),this.segments=new ce,this.stateDependentLayerIds=this.layers.filter(function(r){return r.isStateDependent()}).map(function(r){return r.id})};function Wd(e,r){return e.x===r.x&&(e.x<0||e.x>8192)||e.y===r.y&&(e.y<0||e.y>8192)}ys.prototype.populate=function(e,r,a){this.features=[],this.hasPattern=Wh("fill-extrusion",this.layers,r);for(var d=0,_=e;d<_.length;d+=1){var S=_[d],i=S.feature,t=S.id,o=S.index,l=S.sourceLayerIndex,p=this.layers[0]._featureFilter.needGeometry,y=Di(i,p);if(this.layers[0]._featureFilter.filter(new At(this.zoom),y,a)){var v={id:t,sourceLayerIndex:l,index:o,geometry:p?y.geometry:zr(i),properties:i.properties,type:i.type,patterns:{}};this.hasPattern?this.features.push(Dc("fill-extrusion",this.layers,v,this.zoom,r)):this.addFeature(v,v.geometry,o,a,{}),r.featureIndex.insert(i,v.geometry,o,l,this.index,!0)}}},ys.prototype.addFeatures=function(e,r,a){for(var d=0,_=this.features;d<_.length;d+=1){var S=_[d];this.addFeature(S,S.geometry,S.index,r,a)}},ys.prototype.update=function(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)},ys.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ys.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ys.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Zd),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},ys.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ys.prototype.addFeature=function(e,r,a,d,_){for(var S=0,i=ph(r,500);S<i.length;S+=1){for(var t=i[S],o=0,l=0,p=t;l<p.length;l+=1)o+=p[l].length;for(var y=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),v=0,I=t;v<I.length;v+=1){var k=I[v];if(k.length!==0&&!((pt=k).every(function(at){return at.x<0})||pt.every(function(at){return at.x>8192})||pt.every(function(at){return at.y<0})||pt.every(function(at){return at.y>8192})))for(var L=0,O=0;O<k.length;O++){var B=k[O];if(O>=1){var q=k[O-1];if(!Wd(B,q)){y.vertexLength+4>ce.MAX_VERTEX_ARRAY_LENGTH&&(y=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var $=B.sub(q)._perp()._unit(),W=q.dist(B);L+W>32768&&(L=0),sc(this.layoutVertexArray,B.x,B.y,$.x,$.y,0,0,L),sc(this.layoutVertexArray,B.x,B.y,$.x,$.y,0,1,L),sc(this.layoutVertexArray,q.x,q.y,$.x,$.y,0,0,L+=W),sc(this.layoutVertexArray,q.x,q.y,$.x,$.y,0,1,L);var ne=y.vertexLength;this.indexArray.emplaceBack(ne,ne+2,ne+1),this.indexArray.emplaceBack(ne+1,ne+2,ne+3),y.vertexLength+=4,y.primitiveLength+=2}}}}if(y.vertexLength+o>ce.MAX_VERTEX_ARRAY_LENGTH&&(y=this.segments.prepareSegment(o,this.layoutVertexArray,this.indexArray)),Hd[e.type]==="Polygon"){for(var ue=[],Ie=[],De=y.vertexLength,Fe=0,Ue=t;Fe<Ue.length;Fe+=1){var We=Ue[Fe];if(We.length!==0){We!==t[0]&&Ie.push(ue.length/2);for(var Ve=0;Ve<We.length;Ve++){var mt=We[Ve];sc(this.layoutVertexArray,mt.x,mt.y,0,0,1,1,0),ue.push(mt.x),ue.push(mt.y)}}}for(var dt=Gh(ue,Ie),tt=0;tt<dt.length;tt+=3)this.indexArray.emplaceBack(De+dt[tt],De+dt[tt+2],De+dt[tt+1]);y.primitiveLength+=dt.length/3,y.vertexLength+=o}}var pt;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,_,d)},jt("FillExtrusionBucket",ys,{omit:["layers","features"]});var Kd={paint:new b({"fill-extrusion-opacity":new Pt(fe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new zt(fe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Pt(fe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Pt(fe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ul(fe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new zt(fe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new zt(fe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Pt(fe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Jd=function(e){function r(a){e.call(this,a,Kd)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.createBucket=function(a){return new ys(a)},r.prototype.queryRadius=function(){return yn(this.paint.get("fill-extrusion-translate"))},r.prototype.is3D=function(){return!0},r.prototype.queryIntersectsFeature=function(a,d,_,S,i,t,o,l){var p=Uo(a,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),t.angle,o),y=this.paint.get("fill-extrusion-height").evaluate(d,_),v=this.paint.get("fill-extrusion-base").evaluate(d,_),I=function(L,O,B,q){for(var $=[],W=0,ne=L;W<ne.length;W+=1){var ue=ne[W],Ie=[ue.x,ue.y,0,1];jl(Ie,Ie,O),$.push(new he(Ie[0]/Ie[3],Ie[1]/Ie[3]))}return $}(p,l),k=function(L,O,B,q){for(var $=[],W=[],ne=q[8]*O,ue=q[9]*O,Ie=q[10]*O,De=q[11]*O,Fe=q[8]*B,Ue=q[9]*B,We=q[10]*B,Ve=q[11]*B,mt=0,dt=L;mt<dt.length;mt+=1){for(var tt=[],pt=[],at=0,gt=dt[mt];at<gt.length;at+=1){var nt=gt[at],lt=nt.x,Ft=nt.y,Bt=q[0]*lt+q[4]*Ft+q[12],ai=q[1]*lt+q[5]*Ft+q[13],hi=q[2]*lt+q[6]*Ft+q[14],Ti=q[3]*lt+q[7]*Ft+q[15],Li=hi+Ie,$i=Ti+De,Hi=Bt+Fe,Ui=ai+Ue,Qi=hi+We,Vi=Ti+Ve,er=new he((Bt+ne)/$i,(ai+ue)/$i);er.z=Li/$i,tt.push(er);var mi=new he(Hi/Vi,Ui/Vi);mi.z=Qi/Vi,pt.push(mi)}$.push(tt),W.push(pt)}return[$,W]}(S,v,y,l);return function(L,O,B){var q=1/0;Oo(B,O)&&(q=lc(B,O[0]));for(var $=0;$<O.length;$++)for(var W=O[$],ne=L[$],ue=0;ue<W.length-1;ue++){var Ie=W[ue],De=[Ie,W[ue+1],ne[ue+1],ne[ue],Ie];Bo(B,De)&&(q=Math.min(q,lc(B,De)))}return q!==1/0&&q}(k[0],k[1],I)},r}(n);function Pu(e,r){return e.x*r.x+e.y*r.y}function lc(e,r){if(e.length===1){for(var a,d=0,_=r[d++];!a||_.equals(a);)if(!(a=r[d++]))return 1/0;for(;d<r.length;d++){var S=r[d],i=e[0],t=a.sub(_),o=S.sub(_),l=i.sub(_),p=Pu(t,t),y=Pu(t,o),v=Pu(o,o),I=Pu(l,t),k=Pu(l,o),L=p*v-y*y,O=(v*I-y*k)/L,B=(p*k-y*I)/L,q=_.z*(1-O-B)+a.z*O+S.z*B;if(isFinite(q))return q}return 1/0}for(var $=1/0,W=0,ne=r;W<ne.length;W+=1)$=Math.min($,ne[W].z);return $}var ep=z([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Yd=z([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Qd=ac.VectorTileFeature.types,ef=Math.cos(Math.PI/180*37.5),uc=Math.pow(2,14)/.5,fo=function(e){var r=this;this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(a){r.gradients[a.id]={}}),this.layoutVertexArray=new Q,this.layoutVertexArray2=new ae,this.indexArray=new ut,this.programConfigurations=new ei(e.layers,e.zoom),this.segments=new ce,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};fo.prototype.populate=function(e,r,a){this.hasPattern=Wh("line",this.layers,r);for(var d=this.layers[0].layout.get("line-sort-key"),_=[],S=0,i=e;S<i.length;S+=1){var t=i[S],o=t.feature,l=t.id,p=t.index,y=t.sourceLayerIndex,v=this.layers[0]._featureFilter.needGeometry,I=Di(o,v);if(this.layers[0]._featureFilter.filter(new At(this.zoom),I,a)){var k=d?d.evaluate(I,{},a):void 0,L={id:l,properties:o.properties,type:o.type,sourceLayerIndex:y,index:p,geometry:v?I.geometry:zr(o),patterns:{},sortKey:k};_.push(L)}}d&&_.sort(function(Ie,De){return Ie.sortKey-De.sortKey});for(var O=0,B=_;O<B.length;O+=1){var q=B[O],$=q.geometry,W=q.index,ne=q.sourceLayerIndex;if(this.hasPattern){var ue=Dc("line",this.layers,q,this.zoom,r);this.patternFeatures.push(ue)}else this.addFeature(q,$,W,a,{});r.featureIndex.insert(e[W].feature,$,W,ne,this.index)}},fo.prototype.update=function(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)},fo.prototype.addFeatures=function(e,r,a){for(var d=0,_=this.patternFeatures;d<_.length;d+=1){var S=_[d];this.addFeature(S,S.geometry,S.index,r,a)}},fo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},fo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},fo.prototype.upload=function(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Yd)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ep),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},fo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},fo.prototype.lineFeatureClips=function(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}},fo.prototype.addFeature=function(e,r,a,d,_){var S=this.layers[0].layout,i=S.get("line-join").evaluate(e,{}),t=S.get("line-cap"),o=S.get("line-miter-limit"),l=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(var p=0,y=r;p<y.length;p+=1)this.addLine(y[p],e,i,t,o,l);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,_,d)},fo.prototype.addLine=function(e,r,a,d,_,S){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var i=0;i<e.length-1;i++)this.totalDistance+=e[i].dist(e[i+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var t=Qd[r.type]==="Polygon",o=e.length;o>=2&&e[o-1].equals(e[o-2]);)o--;for(var l=0;l<o-1&&e[l].equals(e[l+1]);)l++;if(!(o<(t?3:2))){a==="bevel"&&(_=1.05);var p,y=this.overscaling<=16?122880/(512*this.overscaling):0,v=this.segments.prepareSegment(10*o,this.layoutVertexArray,this.indexArray),I=void 0,k=void 0,L=void 0,O=void 0;this.e1=this.e2=-1,t&&(O=e[l].sub(p=e[o-2])._unit()._perp());for(var B=l;B<o;B++)if(!(k=B===o-1?t?e[l+1]:void 0:e[B+1])||!e[B].equals(k)){O&&(L=O),p&&(I=p),p=e[B],O=k?k.sub(p)._unit()._perp():L;var q=(L=L||O).add(O);q.x===0&&q.y===0||q._unit();var $=L.x*O.x+L.y*O.y,W=q.x*O.x+q.y*O.y,ne=W!==0?1/W:1/0,ue=2*Math.sqrt(2-2*W),Ie=W<ef&&I&&k,De=L.x*O.y-L.y*O.x>0;if(Ie&&B>l){var Fe=p.dist(I);if(Fe>2*y){var Ue=p.sub(p.sub(I)._mult(y/Fe)._round());this.updateDistance(I,Ue),this.addCurrentVertex(Ue,L,0,0,v),I=Ue}}var We=I&&k,Ve=We?a:t?"butt":d;if(We&&Ve==="round"&&(ne<S?Ve="miter":ne<=2&&(Ve="fakeround")),Ve==="miter"&&ne>_&&(Ve="bevel"),Ve==="bevel"&&(ne>2&&(Ve="flipbevel"),ne<_&&(Ve="miter")),I&&this.updateDistance(I,p),Ve==="miter")q._mult(ne),this.addCurrentVertex(p,q,0,0,v);else if(Ve==="flipbevel"){if(ne>100)q=O.mult(-1);else{var mt=ne*L.add(O).mag()/L.sub(O).mag();q._perp()._mult(mt*(De?-1:1))}this.addCurrentVertex(p,q,0,0,v),this.addCurrentVertex(p,q.mult(-1),0,0,v)}else if(Ve==="bevel"||Ve==="fakeround"){var dt=-Math.sqrt(ne*ne-1),tt=De?dt:0,pt=De?0:dt;if(I&&this.addCurrentVertex(p,L,tt,pt,v),Ve==="fakeround")for(var at=Math.round(180*ue/Math.PI/20),gt=1;gt<at;gt++){var nt=gt/at;if(nt!==.5){var lt=nt-.5;nt+=nt*lt*(nt-1)*((1.0904+$*($*(3.55645-1.43519*$)-3.2452))*lt*lt+(.848013+$*(.215638*$-1.06021)))}var Ft=O.sub(L)._mult(nt)._add(L)._unit()._mult(De?-1:1);this.addHalfVertex(p,Ft.x,Ft.y,!1,De,0,v)}k&&this.addCurrentVertex(p,O,-tt,-pt,v)}else if(Ve==="butt")this.addCurrentVertex(p,q,0,0,v);else if(Ve==="square"){var Bt=I?1:-1;this.addCurrentVertex(p,q,Bt,Bt,v)}else Ve==="round"&&(I&&(this.addCurrentVertex(p,L,0,0,v),this.addCurrentVertex(p,L,1,1,v,!0)),k&&(this.addCurrentVertex(p,O,-1,-1,v,!0),this.addCurrentVertex(p,O,0,0,v)));if(Ie&&B<o-1){var ai=p.dist(k);if(ai>2*y){var hi=p.add(k.sub(p)._mult(y/ai)._round());this.updateDistance(p,hi),this.addCurrentVertex(hi,O,0,0,v),p=hi}}}}},fo.prototype.addCurrentVertex=function(e,r,a,d,_,S){S===void 0&&(S=!1);var i=r.y*d-r.x,t=-r.y-r.x*d;this.addHalfVertex(e,r.x+r.y*a,r.y-r.x*a,S,!1,a,_),this.addHalfVertex(e,i,t,S,!0,-d,_),this.distance>uc/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,r,a,d,_,S))},fo.prototype.addHalfVertex=function(e,r,a,d,_,S,i){var t=.5*(this.lineClips?this.scaledDistance*(uc-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e.x<<1)+(d?1:0),(e.y<<1)+(_?1:0),Math.round(63*r)+128,Math.round(63*a)+128,1+(S===0?0:S<0?-1:1)|(63&t)<<2,t>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var o=i.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,o),i.primitiveLength++),_?this.e2=o:this.e1=o},fo.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},fo.prototype.updateDistance=function(e,r){this.distance+=e.dist(r),this.updateScaledDistance()},jt("LineBucket",fo,{omit:["layers","patternFeatures"]});var tf=new b({"line-cap":new Pt(fe.layout_line["line-cap"]),"line-join":new zt(fe.layout_line["line-join"]),"line-miter-limit":new Pt(fe.layout_line["line-miter-limit"]),"line-round-limit":new Pt(fe.layout_line["line-round-limit"]),"line-sort-key":new zt(fe.layout_line["line-sort-key"])}),kp={paint:new b({"line-opacity":new zt(fe.paint_line["line-opacity"]),"line-color":new zt(fe.paint_line["line-color"]),"line-translate":new Pt(fe.paint_line["line-translate"]),"line-translate-anchor":new Pt(fe.paint_line["line-translate-anchor"]),"line-width":new zt(fe.paint_line["line-width"]),"line-gap-width":new zt(fe.paint_line["line-gap-width"]),"line-offset":new zt(fe.paint_line["line-offset"]),"line-blur":new zt(fe.paint_line["line-blur"]),"line-dasharray":new Yr(fe.paint_line["line-dasharray"]),"line-pattern":new ul(fe.paint_line["line-pattern"]),"line-gradient":new Yn(fe.paint_line["line-gradient"])}),layout:tf},Mp=new(function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.possiblyEvaluate=function(a,d){return d=new At(Math.floor(d.zoom),{now:d.now,fadeDuration:d.fadeDuration,zoomHistory:d.zoomHistory,transition:d.transition}),e.prototype.possiblyEvaluate.call(this,a,d)},r.prototype.evaluate=function(a,d,_,S){return d=Wt({},d,{zoom:Math.floor(d.zoom)}),e.prototype.evaluate.call(this,a,d,_,S)},r}(zt))(kp.paint.properties["line-width"].specification);Mp.useIntegerZoom=!0;var rf=function(e){function r(a){e.call(this,a,kp),this.gradientVersion=0}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._handleSpecialPaintPropertyUpdate=function(a){a==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof An,this.gradientVersion=(this.gradientVersion+1)%it)},r.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},r.prototype.recalculate=function(a,d){e.prototype.recalculate.call(this,a,d),this.paint._values["line-floorwidth"]=Mp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)},r.prototype.createBucket=function(a){return new fo(a)},r.prototype.queryRadius=function(a){var d=a,_=Lp(Ca("line-width",this,d),Ca("line-gap-width",this,d)),S=Ca("line-offset",this,d);return _/2+Math.abs(S)+yn(this.paint.get("line-translate"))},r.prototype.queryIntersectsFeature=function(a,d,_,S,i,t,o){var l=Uo(a,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),t.angle,o),p=o/2*Lp(this.paint.get("line-width").evaluate(d,_),this.paint.get("line-gap-width").evaluate(d,_)),y=this.paint.get("line-offset").evaluate(d,_);return y&&(S=function(v,I){for(var k=[],L=new he(0,0),O=0;O<v.length;O++){for(var B=v[O],q=[],$=0;$<B.length;$++){var W=B[$],ne=B[$+1],ue=$===0?L:W.sub(B[$-1])._unit()._perp(),Ie=$===B.length-1?L:ne.sub(W)._unit()._perp(),De=ue._add(Ie)._unit();De._mult(1/(De.x*Ie.x+De.y*Ie.y)),q.push(De._mult(I)._add(W))}k.push(q)}return k}(S,y*o)),function(v,I,k){for(var L=0;L<I.length;L++){var O=I[L];if(v.length>=3){for(var B=0;B<O.length;B++)if(Ga(v,O[B]))return!0}if(Fo(v,O,k))return!0}return!1}(l,S,p)},r.prototype.isTileClipped=function(){return!0},r}(n);function Lp(e,r){return r>0?r+2*e:e}var nf=z([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Dp=z([{name:"a_projected_pos",components:3,type:"Float32"}],4),tp=(z([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),z([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Rp=(z([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),z([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Bp=z([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Op(e,r,a){return e.sections.forEach(function(d){d.text=function(_,S,i){var t=S.layout.get("text-transform").evaluate(i,{});return t==="uppercase"?_=_.toLocaleUpperCase():t==="lowercase"&&(_=_.toLocaleLowerCase()),Gt.applyArabicShaping&&(_=Gt.applyArabicShaping(_)),_}(d.text,r,a)}),e}z([{name:"triangle",components:3,type:"Uint16"}]),z([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),z([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),z([{type:"Float32",name:"offsetX"}]),z([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var cc={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Fp=function(e,r,a,d,_){var S,i,t=8*_-d-1,o=(1<<t)-1,l=o>>1,p=-7,y=a?_-1:0,v=a?-1:1,I=e[r+y];for(y+=v,S=I&(1<<-p)-1,I>>=-p,p+=t;p>0;S=256*S+e[r+y],y+=v,p-=8);for(i=S&(1<<-p)-1,S>>=-p,p+=d;p>0;i=256*i+e[r+y],y+=v,p-=8);if(S===0)S=1-l;else{if(S===o)return i?NaN:1/0*(I?-1:1);i+=Math.pow(2,d),S-=l}return(I?-1:1)*i*Math.pow(2,S-d)},Up=function(e,r,a,d,_,S){var i,t,o,l=8*S-_-1,p=(1<<l)-1,y=p>>1,v=_===23?Math.pow(2,-24)-Math.pow(2,-77):0,I=d?0:S-1,k=d?1:-1,L=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(t=isNaN(r)?1:0,i=p):(i=Math.floor(Math.log(r)/Math.LN2),r*(o=Math.pow(2,-i))<1&&(i--,o*=2),(r+=i+y>=1?v/o:v*Math.pow(2,1-y))*o>=2&&(i++,o/=2),i+y>=p?(t=0,i=p):i+y>=1?(t=(r*o-1)*Math.pow(2,_),i+=y):(t=r*Math.pow(2,y-1)*Math.pow(2,_),i=0));_>=8;e[a+I]=255&t,I+=k,t/=256,_-=8);for(i=i<<_|t,l+=_;l>0;e[a+I]=255&i,I+=k,i/=256,l-=8);e[a+I-k]|=128*L},fh=gr;function gr(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}gr.Varint=0,gr.Fixed64=1,gr.Bytes=2,gr.Fixed32=5;var Vp=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function fl(e){return e.type===gr.Bytes?e.readVarint()+e.pos:e.pos+1}function Fs(e,r,a){return a?4294967296*r+(e>>>0):4294967296*(r>>>0)+(e>>>0)}function Xn(e,r,a){var d=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));a.realloc(d);for(var _=a.pos-1;_>=e;_--)a.buf[_+d]=a.buf[_]}function ip(e,r){for(var a=0;a<e.length;a++)r.writeVarint(e[a])}function Np(e,r){for(var a=0;a<e.length;a++)r.writeSVarint(e[a])}function jp(e,r){for(var a=0;a<e.length;a++)r.writeFloat(e[a])}function xr(e,r){for(var a=0;a<e.length;a++)r.writeDouble(e[a])}function Zl(e,r){for(var a=0;a<e.length;a++)r.writeBoolean(e[a])}function rp(e,r){for(var a=0;a<e.length;a++)r.writeFixed32(e[a])}function qp(e,r){for(var a=0;a<e.length;a++)r.writeSFixed32(e[a])}function Gp(e,r){for(var a=0;a<e.length;a++)r.writeFixed64(e[a])}function ml(e,r){for(var a=0;a<e.length;a++)r.writeSFixed64(e[a])}function gl(e,r){return(e[r]|e[r+1]<<8|e[r+2]<<16)+16777216*e[r+3]}function ku(e,r,a){e[a]=r,e[a+1]=r>>>8,e[a+2]=r>>>16,e[a+3]=r>>>24}function Zp(e,r){return(e[r]|e[r+1]<<8|e[r+2]<<16)+(e[r+3]<<24)}function of(e,r,a){e===1&&a.readMessage(af,r)}function af(e,r,a){if(e===3){var d=a.readMessage(sf,{}),_=d.width,S=d.height,i=d.left,t=d.top,o=d.advance;r.push({id:d.id,bitmap:new Iu({width:_+6,height:S+6},d.bitmap),metrics:{width:_,height:S,left:i,top:t,advance:o}})}}function sf(e,r,a){e===1?r.id=a.readVarint():e===2?r.bitmap=a.readBytes():e===3?r.width=a.readVarint():e===4?r.height=a.readVarint():e===5?r.left=a.readSVarint():e===6?r.top=a.readSVarint():e===7&&(r.advance=a.readVarint())}function Xp(e){for(var r=0,a=0,d=0,_=e;d<_.length;d+=1){var S=_[d];r+=S.w*S.h,a=Math.max(a,S.w)}e.sort(function(L,O){return O.h-L.h});for(var i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),a),h:1/0}],t=0,o=0,l=0,p=e;l<p.length;l+=1)for(var y=p[l],v=i.length-1;v>=0;v--){var I=i[v];if(!(y.w>I.w||y.h>I.h)){if(y.x=I.x,y.y=I.y,o=Math.max(o,y.y+y.h),t=Math.max(t,y.x+y.w),y.w===I.w&&y.h===I.h){var k=i.pop();v<i.length&&(i[v]=k)}else y.h===I.h?(I.x+=y.w,I.w-=y.w):y.w===I.w?(I.y+=y.h,I.h-=y.h):(i.push({x:I.x+y.w,y:I.y,w:I.w-y.w,h:y.h}),I.y+=y.h,I.h-=y.h);break}}return{w:t,h:o,fill:r/(t*o)||0}}gr.prototype={destroy:function(){this.buf=null},readFields:function(e,r,a){for(a=a||this.length;this.pos<a;){var d=this.readVarint(),_=d>>3,S=this.pos;this.type=7&d,e(_,r,this),this.pos===S&&this.skip(d)}return r},readMessage:function(e,r){return this.readFields(e,r,this.readVarint()+this.pos)},readFixed32:function(){var e=gl(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=Zp(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=gl(this.buf,this.pos)+4294967296*gl(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=gl(this.buf,this.pos)+4294967296*Zp(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=Fp(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Fp(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var r,a,d=this.buf;return r=127&(a=d[this.pos++]),a<128?r:(r|=(127&(a=d[this.pos++]))<<7,a<128?r:(r|=(127&(a=d[this.pos++]))<<14,a<128?r:(r|=(127&(a=d[this.pos++]))<<21,a<128?r:function(_,S,i){var t,o,l=i.buf;if(t=(112&(o=l[i.pos++]))>>4,o<128||(t|=(127&(o=l[i.pos++]))<<3,o<128)||(t|=(127&(o=l[i.pos++]))<<10,o<128)||(t|=(127&(o=l[i.pos++]))<<17,o<128)||(t|=(127&(o=l[i.pos++]))<<24,o<128)||(t|=(1&(o=l[i.pos++]))<<31,o<128))return Fs(_,t,S);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(a=d[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,r=this.pos;return this.pos=e,e-r>=12&&Vp?function(a,d,_){return Vp.decode(a.subarray(d,_))}(this.buf,r,e):function(a,d,_){for(var S="",i=d;i<_;){var t,o,l,p=a[i],y=null,v=p>239?4:p>223?3:p>191?2:1;if(i+v>_)break;v===1?p<128&&(y=p):v===2?(192&(t=a[i+1]))==128&&(y=(31&p)<<6|63&t)<=127&&(y=null):v===3?(o=a[i+2],(192&(t=a[i+1]))==128&&(192&o)==128&&((y=(15&p)<<12|(63&t)<<6|63&o)<=2047||y>=55296&&y<=57343)&&(y=null)):v===4&&(o=a[i+2],l=a[i+3],(192&(t=a[i+1]))==128&&(192&o)==128&&(192&l)==128&&((y=(15&p)<<18|(63&t)<<12|(63&o)<<6|63&l)<=65535||y>=1114112)&&(y=null)),y===null?(y=65533,v=1):y>65535&&(y-=65536,S+=String.fromCharCode(y>>>10&1023|55296),y=56320|1023&y),S+=String.fromCharCode(y),i+=v}return S}(this.buf,r,e)},readBytes:function(){var e=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,e);return this.pos=e,r},readPackedVarint:function(e,r){if(this.type!==gr.Bytes)return e.push(this.readVarint(r));var a=fl(this);for(e=e||[];this.pos<a;)e.push(this.readVarint(r));return e},readPackedSVarint:function(e){if(this.type!==gr.Bytes)return e.push(this.readSVarint());var r=fl(this);for(e=e||[];this.pos<r;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==gr.Bytes)return e.push(this.readBoolean());var r=fl(this);for(e=e||[];this.pos<r;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==gr.Bytes)return e.push(this.readFloat());var r=fl(this);for(e=e||[];this.pos<r;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==gr.Bytes)return e.push(this.readDouble());var r=fl(this);for(e=e||[];this.pos<r;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==gr.Bytes)return e.push(this.readFixed32());var r=fl(this);for(e=e||[];this.pos<r;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==gr.Bytes)return e.push(this.readSFixed32());var r=fl(this);for(e=e||[];this.pos<r;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==gr.Bytes)return e.push(this.readFixed64());var r=fl(this);for(e=e||[];this.pos<r;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==gr.Bytes)return e.push(this.readSFixed64());var r=fl(this);for(e=e||[];this.pos<r;)e.push(this.readSFixed64());return e},skip:function(e){var r=7&e;if(r===gr.Varint)for(;this.buf[this.pos++]>127;);else if(r===gr.Bytes)this.pos=this.readVarint()+this.pos;else if(r===gr.Fixed32)this.pos+=4;else{if(r!==gr.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(e,r){this.writeVarint(e<<3|r)},realloc:function(e){for(var r=this.length||16;r<this.pos+e;)r*=2;if(r!==this.length){var a=new Uint8Array(r);a.set(this.buf),this.buf=a,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),ku(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),ku(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),ku(this.buf,-1&e,this.pos),ku(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),ku(this.buf,-1&e,this.pos),ku(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(r,a){var d,_;if(r>=0?(d=r%4294967296|0,_=r/4294967296|0):(_=~(-r/4294967296),4294967295^(d=~(-r%4294967296))?d=d+1|0:(d=0,_=_+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),function(S,i,t){t.buf[t.pos++]=127&S|128,S>>>=7,t.buf[t.pos++]=127&S|128,S>>>=7,t.buf[t.pos++]=127&S|128,S>>>=7,t.buf[t.pos++]=127&S|128,t.buf[t.pos]=127&(S>>>=7)}(d,0,a),function(S,i){var t=(7&S)<<4;i.buf[i.pos++]|=t|((S>>>=3)?128:0),S&&(i.buf[i.pos++]=127&S|((S>>>=7)?128:0),S&&(i.buf[i.pos++]=127&S|((S>>>=7)?128:0),S&&(i.buf[i.pos++]=127&S|((S>>>=7)?128:0),S&&(i.buf[i.pos++]=127&S|((S>>>=7)?128:0),S&&(i.buf[i.pos++]=127&S)))))}(_,a)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var r=this.pos;this.pos=function(d,_,S){for(var i,t,o=0;o<_.length;o++){if((i=_.charCodeAt(o))>55295&&i<57344){if(!t){i>56319||o+1===_.length?(d[S++]=239,d[S++]=191,d[S++]=189):t=i;continue}if(i<56320){d[S++]=239,d[S++]=191,d[S++]=189,t=i;continue}i=t-55296<<10|i-56320|65536,t=null}else t&&(d[S++]=239,d[S++]=191,d[S++]=189,t=null);i<128?d[S++]=i:(i<2048?d[S++]=i>>6|192:(i<65536?d[S++]=i>>12|224:(d[S++]=i>>18|240,d[S++]=i>>12&63|128),d[S++]=i>>6&63|128),d[S++]=63&i|128)}return S}(this.buf,e,this.pos);var a=this.pos-r;a>=128&&Xn(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeFloat:function(e){this.realloc(4),Up(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),Up(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var r=e.length;this.writeVarint(r),this.realloc(r);for(var a=0;a<r;a++)this.buf[this.pos++]=e[a]},writeRawMessage:function(e,r){this.pos++;var a=this.pos;e(r,this);var d=this.pos-a;d>=128&&Xn(a,d,this),this.pos=a-1,this.writeVarint(d),this.pos+=d},writeMessage:function(e,r,a){this.writeTag(e,gr.Bytes),this.writeRawMessage(r,a)},writePackedVarint:function(e,r){r.length&&this.writeMessage(e,ip,r)},writePackedSVarint:function(e,r){r.length&&this.writeMessage(e,Np,r)},writePackedBoolean:function(e,r){r.length&&this.writeMessage(e,Zl,r)},writePackedFloat:function(e,r){r.length&&this.writeMessage(e,jp,r)},writePackedDouble:function(e,r){r.length&&this.writeMessage(e,xr,r)},writePackedFixed32:function(e,r){r.length&&this.writeMessage(e,rp,r)},writePackedSFixed32:function(e,r){r.length&&this.writeMessage(e,qp,r)},writePackedFixed64:function(e,r){r.length&&this.writeMessage(e,Gp,r)},writePackedSFixed64:function(e,r){r.length&&this.writeMessage(e,ml,r)},writeBytesField:function(e,r){this.writeTag(e,gr.Bytes),this.writeBytes(r)},writeFixed32Field:function(e,r){this.writeTag(e,gr.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(e,r){this.writeTag(e,gr.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(e,r){this.writeTag(e,gr.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(e,r){this.writeTag(e,gr.Fixed64),this.writeSFixed64(r)},writeVarintField:function(e,r){this.writeTag(e,gr.Varint),this.writeVarint(r)},writeSVarintField:function(e,r){this.writeTag(e,gr.Varint),this.writeSVarint(r)},writeStringField:function(e,r){this.writeTag(e,gr.Bytes),this.writeString(r)},writeFloatField:function(e,r){this.writeTag(e,gr.Fixed32),this.writeFloat(r)},writeDoubleField:function(e,r){this.writeTag(e,gr.Fixed64),this.writeDouble(r)},writeBooleanField:function(e,r){this.writeVarintField(e,Boolean(r))}};var mh=function(e,r){var a=r.pixelRatio,d=r.version,_=r.stretchX,S=r.stretchY,i=r.content;this.paddedRect=e,this.pixelRatio=a,this.stretchX=_,this.stretchY=S,this.content=i,this.version=d},Rc={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Rc.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Rc.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Rc.tlbr.get=function(){return this.tl.concat(this.br)},Rc.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(mh.prototype,Rc);var Bc=function(e,r){var a={},d={};this.haveRenderCallbacks=[];var _=[];this.addImages(e,a,_),this.addImages(r,d,_);var S=Xp(_),i=new po({width:S.w||1,height:S.h||1});for(var t in e){var o=e[t],l=a[t].paddedRect;po.copy(o.data,i,{x:0,y:0},{x:l.x+1,y:l.y+1},o.data)}for(var p in r){var y=r[p],v=d[p].paddedRect,I=v.x+1,k=v.y+1,L=y.data.width,O=y.data.height;po.copy(y.data,i,{x:0,y:0},{x:I,y:k},y.data),po.copy(y.data,i,{x:0,y:O-1},{x:I,y:k-1},{width:L,height:1}),po.copy(y.data,i,{x:0,y:0},{x:I,y:k+O},{width:L,height:1}),po.copy(y.data,i,{x:L-1,y:0},{x:I-1,y:k},{width:1,height:O}),po.copy(y.data,i,{x:0,y:0},{x:I+L,y:k},{width:1,height:O})}this.image=i,this.iconPositions=a,this.patternPositions=d};Bc.prototype.addImages=function(e,r,a){for(var d in e){var _=e[d],S={x:0,y:0,w:_.data.width+2,h:_.data.height+2};a.push(S),r[d]=new mh(S,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(d)}},Bc.prototype.patchUpdatedImages=function(e,r){for(var a in e.dispatchRenderCallbacks(this.haveRenderCallbacks),e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),r),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),r)},Bc.prototype.patchUpdatedImage=function(e,r,a){if(e&&r&&e.version!==r.version){e.version=r.version;var d=e.tl;a.update(r.data,void 0,{x:d[0],y:d[1]})}},jt("ImagePosition",mh),jt("ImageAtlas",Bc);var ua={horizontal:1,vertical:2,horizontalOnly:3},yl=function(){this.scale=1,this.fontStack="",this.imageName=null};yl.forText=function(e,r){var a=new yl;return a.scale=e||1,a.fontStack=r,a},yl.forImage=function(e){var r=new yl;return r.imageName=e,r};var vn=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Oc(e,r,a,d,_,S,i,t,o,l,p,y,v,I,k,L){var O,B=vn.fromFeature(e,_);y===ua.vertical&&B.verticalizePunctuation();var q=Gt.processBidirectionalText,$=Gt.processStyledBidirectionalText;if(q&&B.sections.length===1){O=[];for(var W=0,ne=q(B.toString(),hc(B,l,S,r,d,I,k));W<ne.length;W+=1){var ue=ne[W],Ie=new vn;Ie.text=ue,Ie.sections=B.sections;for(var De=0;De<ue.length;De++)Ie.sectionIndex.push(0);O.push(Ie)}}else if($){O=[];for(var Fe=0,Ue=$(B.text,B.sectionIndex,hc(B,l,S,r,d,I,k));Fe<Ue.length;Fe+=1){var We=Ue[Fe],Ve=new vn;Ve.text=We[0],Ve.sectionIndex=We[1],Ve.sections=B.sections,O.push(Ve)}}else O=function(tt,pt){for(var at=[],gt=tt.text,nt=0,lt=0,Ft=pt;lt<Ft.length;lt+=1){var Bt=Ft[lt];at.push(tt.substring(nt,Bt)),nt=Bt}return nt<gt.length&&at.push(tt.substring(nt,gt.length)),at}(B,hc(B,l,S,r,d,I,k));var mt=[],dt={positionedLines:mt,text:B.toString(),top:p[1],bottom:p[1],left:p[0],right:p[0],writingMode:y,iconsInText:!1,verticalizable:!1};return function(tt,pt,at,gt,nt,lt,Ft,Bt,ai,hi,Ti,Li){for(var $i=0,Hi=-17,Ui=0,Qi=0,Vi=Bt==="right"?1:Bt==="left"?0:.5,er=0,mi=0,bi=nt;mi<bi.length;mi+=1){var Ai=bi[mi];Ai.trim();var vi=Ai.getMaxScale(),yr=24*(vi-1),dr={positionedGlyphs:[],lineOffset:0};tt.positionedLines[er]=dr;var Bi=dr.positionedGlyphs,Pi=0;if(Ai.length()){for(var Yi=0;Yi<Ai.length();Yi++){var Ht=Ai.getSection(Yi),bn=Ai.getSectionIndex(Yi),br=Ai.getCharCode(Yi),Zr=0,nr=null,$n=null,Pn=null,ca=24,mo=!(ai===ua.horizontal||!Ti&&!Aa(br)||Ti&&(gh[br]||(Ns=br,Ct.Arabic(Ns)||Ct["Arabic Supplement"](Ns)||Ct["Arabic Extended-A"](Ns)||Ct["Arabic Presentation Forms-A"](Ns)||Ct["Arabic Presentation Forms-B"](Ns))));if(Ht.imageName){var go=gt[Ht.imageName];if(!go)continue;Pn=Ht.imageName,tt.iconsInText=tt.iconsInText||!0,$n=go.paddedRect;var wn=go.displaySize;Ht.scale=24*Ht.scale/Li,Zr=yr+(24-wn[1]*Ht.scale),ca=(nr={width:wn[0],height:wn[1],left:1,top:-3,advance:mo?wn[1]:wn[0]}).advance;var ha=mo?wn[0]*Ht.scale-24*vi:wn[1]*Ht.scale-24*vi;ha>0&&ha>Pi&&(Pi=ha)}else{var Yl=at[Ht.fontStack],Fu=Yl&&Yl[br];if(Fu&&Fu.rect)$n=Fu.rect,nr=Fu.metrics;else{var Uu=pt[Ht.fontStack],_c=Uu&&Uu[br];if(!_c)continue;nr=_c.metrics}Zr=24*(vi-Ht.scale)}mo?(tt.verticalizable=!0,Bi.push({glyph:br,imageName:Pn,x:$i,y:Hi+Zr,vertical:mo,scale:Ht.scale,fontStack:Ht.fontStack,sectionIndex:bn,metrics:nr,rect:$n}),$i+=ca*Ht.scale+hi):(Bi.push({glyph:br,imageName:Pn,x:$i,y:Hi+Zr,vertical:mo,scale:Ht.scale,fontStack:Ht.fontStack,sectionIndex:bn,metrics:nr,rect:$n}),$i+=nr.advance*Ht.scale+hi)}Bi.length!==0&&(Ui=Math.max($i-hi,Ui),pc(Bi,0,Bi.length-1,Vi,Pi)),$i=0;var $a=lt*vi+Pi;dr.lineOffset=Math.max(Pi,yr),Hi+=$a,Qi=Math.max($a,Qi),++er}else Hi+=lt,++er}var Ns,Vu=Hi- -17,Ql=Mu(Ft),bl=Ql.horizontalAlign,vc=Ql.verticalAlign;(function(Ch,zh,$c,Hc,Ph,Wc,Kc,Xo,Nu){var ju,yo=(zh-$c)*Ph;ju=Wc!==Kc?-Xo*Hc- -17:(-Hc*Nu+.5)*Kc;for(var $o=0,wl=Ch;$o<wl.length;$o+=1)for(var _s=0,xc=wl[$o].positionedGlyphs;_s<xc.length;_s+=1){var Ha=xc[_s];Ha.x+=yo,Ha.y+=ju}})(tt.positionedLines,Vi,bl,vc,Ui,Qi,lt,Vu,nt.length),tt.top+=-vc*Vu,tt.bottom=tt.top+Vu,tt.left+=-bl*Ui,tt.right=tt.left+Ui}(dt,r,a,d,O,i,t,o,y,l,v,L),!function(tt){for(var pt=0,at=tt;pt<at.length;pt+=1)if(at[pt].positionedGlyphs.length!==0)return!1;return!0}(mt)&&dt}vn.fromFeature=function(e,r){for(var a=new vn,d=0;d<e.sections.length;d++){var _=e.sections[d];_.image?a.addImageSection(_):a.addTextSection(_,r)}return a},vn.prototype.length=function(){return this.text.length},vn.prototype.getSection=function(e){return this.sections[this.sectionIndex[e]]},vn.prototype.getSectionIndex=function(e){return this.sectionIndex[e]},vn.prototype.getCharCode=function(e){return this.text.charCodeAt(e)},vn.prototype.verticalizePunctuation=function(){this.text=function(e){for(var r="",a=0;a<e.length;a++){var d=e.charCodeAt(a+1)||null,_=e.charCodeAt(a-1)||null;r+=d&&ll(d)&&!cc[e[a+1]]||_&&ll(_)&&!cc[e[a-1]]||!cc[e[a]]?e[a]:cc[e[a]]}return r}(this.text)},vn.prototype.trim=function(){for(var e=0,r=0;r<this.text.length&&gh[this.text.charCodeAt(r)];r++)e++;for(var a=this.text.length,d=this.text.length-1;d>=0&&d>=e&&gh[this.text.charCodeAt(d)];d--)a--;this.text=this.text.substring(e,a),this.sectionIndex=this.sectionIndex.slice(e,a)},vn.prototype.substring=function(e,r){var a=new vn;return a.text=this.text.substring(e,r),a.sectionIndex=this.sectionIndex.slice(e,r),a.sections=this.sections,a},vn.prototype.toString=function(){return this.text},vn.prototype.getMaxScale=function(){var e=this;return this.sectionIndex.reduce(function(r,a){return Math.max(r,e.sections[a].scale)},0)},vn.prototype.addTextSection=function(e,r){this.text+=e.text,this.sections.push(yl.forText(e.scale,e.fontStack||r));for(var a=this.sections.length-1,d=0;d<e.text.length;++d)this.sectionIndex.push(a)},vn.prototype.addImageSection=function(e){var r=e.image?e.image.name:"";if(r.length!==0){var a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(yl.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Oi("Reached maximum number of images 6401")}else Oi("Can't add FormattedSection with an empty image.")},vn.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var gh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Zo={};function $p(e,r,a,d,_,S){if(r.imageName){var i=d[r.imageName];return i?i.displaySize[0]*r.scale*24/S+_:0}var t=a[r.fontStack],o=t&&t[e];return o?o.metrics.advance*r.scale+_:0}function np(e,r,a,d){var _=Math.pow(e-r,2);return d?e<r?_/2:2*_:_+Math.abs(a)*a}function op(e,r,a){var d=0;return e===10&&(d-=1e4),a&&(d+=150),e!==40&&e!==65288||(d+=50),r!==41&&r!==65289||(d+=50),d}function ap(e,r,a,d,_,S){for(var i=null,t=np(r,a,_,S),o=0,l=d;o<l.length;o+=1){var p=l[o],y=np(r-p.x,a,_,S)+p.badness;y<=t&&(i=p,t=y)}return{index:e,x:r,priorBreak:i,badness:t}}function hc(e,r,a,d,_,S,i){if(S!=="point")return[];if(!e)return[];for(var t,o=[],l=function(O,B,q,$,W,ne){for(var ue=0,Ie=0;Ie<O.length();Ie++){var De=O.getSection(Ie);ue+=$p(O.getCharCode(Ie),De,$,W,B,ne)}return ue/Math.max(1,Math.ceil(ue/q))}(e,r,a,d,_,i),p=e.text.indexOf("\u200B")>=0,y=0,v=0;v<e.length();v++){var I=e.getSection(v),k=e.getCharCode(v);if(gh[k]||(y+=$p(k,I,d,_,r,i)),v<e.length()-1){var L=!((t=k)<11904||!(Ct["Bopomofo Extended"](t)||Ct.Bopomofo(t)||Ct["CJK Compatibility Forms"](t)||Ct["CJK Compatibility Ideographs"](t)||Ct["CJK Compatibility"](t)||Ct["CJK Radicals Supplement"](t)||Ct["CJK Strokes"](t)||Ct["CJK Symbols and Punctuation"](t)||Ct["CJK Unified Ideographs Extension A"](t)||Ct["CJK Unified Ideographs"](t)||Ct["Enclosed CJK Letters and Months"](t)||Ct["Halfwidth and Fullwidth Forms"](t)||Ct.Hiragana(t)||Ct["Ideographic Description Characters"](t)||Ct["Kangxi Radicals"](t)||Ct["Katakana Phonetic Extensions"](t)||Ct.Katakana(t)||Ct["Vertical Forms"](t)||Ct["Yi Radicals"](t)||Ct["Yi Syllables"](t)));(Zo[k]||L||I.imageName)&&o.push(ap(v+1,y,l,o,op(k,e.getCharCode(v+1),L&&p),!1))}}return function O(B){return B?O(B.priorBreak).concat(B.index):[]}(ap(e.length(),y,l,o,0,!0))}function Mu(e){var r=.5,a=.5;switch(e){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:r,verticalAlign:a}}function pc(e,r,a,d,_){if(d||_)for(var S=e[a],i=(e[a].x+S.metrics.advance*S.scale)*d,t=r;t<=a;t++)e[t].x-=i,e[t].y+=_}function Fc(e,r,a,d,_,S){var i,t=e.image;if(t.content){var o=t.content,l=t.pixelRatio||1;i=[o[0]/l,o[1]/l,t.displaySize[0]-o[2]/l,t.displaySize[1]-o[3]/l]}var p,y,v,I,k=r.left*S,L=r.right*S;a==="width"||a==="both"?(I=_[0]+k-d[3],y=_[0]+L+d[1]):y=(I=_[0]+(k+L-t.displaySize[0])/2)+t.displaySize[0];var O=r.top*S,B=r.bottom*S;return a==="height"||a==="both"?(p=_[1]+O-d[0],v=_[1]+B+d[2]):v=(p=_[1]+(O+B-t.displaySize[1])/2)+t.displaySize[1],{image:t,top:p,right:y,bottom:v,left:I,collisionPadding:i}}Zo[10]=!0,Zo[32]=!0,Zo[38]=!0,Zo[40]=!0,Zo[41]=!0,Zo[43]=!0,Zo[45]=!0,Zo[47]=!0,Zo[173]=!0,Zo[183]=!0,Zo[8203]=!0,Zo[8208]=!0,Zo[8211]=!0,Zo[8231]=!0;var _l=function(e){function r(a,d,_,S){e.call(this,a,d),this.angle=_,S!==void 0&&(this.segment=S)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.clone=function(){return new r(this.x,this.y,this.angle,this.segment)},r}(he);function sp(e,r){var a=r.expression;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new At(e+1))};if(a.kind==="source")return{kind:"source"};for(var d=a.zoomStops,_=a.interpolationType,S=0;S<d.length&&d[S]<=e;)S++;for(var i=S=Math.max(0,S-1);i<d.length&&d[i]<e+1;)i++;i=Math.min(d.length-1,i);var t=d[S],o=d[i];return a.kind==="composite"?{kind:"composite",minZoom:t,maxZoom:o,interpolationType:_}:{kind:"camera",minZoom:t,maxZoom:o,minSize:a.evaluate(new At(t)),maxSize:a.evaluate(new At(o)),interpolationType:_}}function lp(e,r,a){var d=r.uSize,_=a.lowerSize;return e.kind==="source"?_/128:e.kind==="composite"?Or(_/128,a.upperSize/128,r.uSizeT):d}function up(e,r){var a=0,d=0;if(e.kind==="constant")d=e.layoutSize;else if(e.kind!=="source"){var _=e.interpolationType,S=_?vt(Cn.interpolationFactor(_,r,e.minZoom,e.maxZoom),0,1):0;e.kind==="camera"?d=Or(e.minSize,e.maxSize,S):a=S}return{uSizeT:a,uSize:d}}jt("Anchor",_l);var lf=Object.freeze({__proto__:null,getSizeData:sp,evaluateSizeForFeature:lp,evaluateSizeForZoom:up,SIZE_PACK_FACTOR:128});function cp(e,r,a,d,_){if(r.segment===void 0)return!0;for(var S=r,i=r.segment+1,t=0;t>-a/2;){if(--i<0)return!1;t-=e[i].dist(S),S=e[i]}t+=e[i].dist(e[i+1]),i++;for(var o=[],l=0;t<a/2;){var p=e[i],y=e[i+1];if(!y)return!1;var v=e[i-1].angleTo(p)-p.angleTo(y);for(v=Math.abs((v+3*Math.PI)%(2*Math.PI)-Math.PI),o.push({distance:t,angleDelta:v}),l+=v;t-o[0].distance>d;)l-=o.shift().angleDelta;if(l>_)return!1;i++,t+=p.dist(y)}return!0}function hp(e){for(var r=0,a=0;a<e.length-1;a++)r+=e[a].dist(e[a+1]);return r}function yh(e,r,a){return e?.6*r*a:0}function _h(e,r){return Math.max(e?e.right-e.left:0,r?r.right-r.left:0)}function uf(e,r,a,d,_,S){for(var i=yh(a,_,S),t=_h(a,d)*S,o=0,l=hp(e)/2,p=0;p<e.length-1;p++){var y=e[p],v=e[p+1],I=y.dist(v);if(o+I>l){var k=(l-o)/I,L=Or(y.x,v.x,k),O=Or(y.y,v.y,k),B=new _l(L,O,v.angleTo(y),p);return B._round(),!i||cp(e,B,t,i,r)?B:void 0}o+=I}}function cf(e,r,a,d,_,S,i,t,o){var l=yh(d,S,i),p=_h(d,_),y=p*i,v=e[0].x===0||e[0].x===o||e[0].y===0||e[0].y===o;return r-y<r/4&&(r=y+r/4),function I(k,L,O,B,q,$,W,ne,ue){for(var Ie=$/2,De=hp(k),Fe=0,Ue=L-O,We=[],Ve=0;Ve<k.length-1;Ve++){for(var mt=k[Ve],dt=k[Ve+1],tt=mt.dist(dt),pt=dt.angleTo(mt);Ue+O<Fe+tt;){var at=((Ue+=O)-Fe)/tt,gt=Or(mt.x,dt.x,at),nt=Or(mt.y,dt.y,at);if(gt>=0&&gt<ue&&nt>=0&&nt<ue&&Ue-Ie>=0&&Ue+Ie<=De){var lt=new _l(gt,nt,pt,Ve);lt._round(),B&&!cp(k,lt,$,B,q)||We.push(lt)}}Fe+=tt}return ne||We.length||W||(We=I(k,Fe/2,O,B,q,$,W,!0,ue)),We}(e,v?r/2*t%r:(p/2+2*S)*i*t%r,r,l,a,y,v,!1,o)}function pp(e,r,a,d,_){for(var S=[],i=0;i<e.length;i++)for(var t=e[i],o=void 0,l=0;l<t.length-1;l++){var p=t[l],y=t[l+1];p.x<r&&y.x<r||(p.x<r?p=new he(r,p.y+(r-p.x)/(y.x-p.x)*(y.y-p.y))._round():y.x<r&&(y=new he(r,p.y+(r-p.x)/(y.x-p.x)*(y.y-p.y))._round()),p.y<a&&y.y<a||(p.y<a?p=new he(p.x+(a-p.y)/(y.y-p.y)*(y.x-p.x),a)._round():y.y<a&&(y=new he(p.x+(a-p.y)/(y.y-p.y)*(y.x-p.x),a)._round()),p.x>=d&&y.x>=d||(p.x>=d?p=new he(d,p.y+(d-p.x)/(y.x-p.x)*(y.y-p.y))._round():y.x>=d&&(y=new he(d,p.y+(d-p.x)/(y.x-p.x)*(y.y-p.y))._round()),p.y>=_&&y.y>=_||(p.y>=_?p=new he(p.x+(_-p.y)/(y.y-p.y)*(y.x-p.x),_)._round():y.y>=_&&(y=new he(p.x+(_-p.y)/(y.y-p.y)*(y.x-p.x),_)._round()),o&&p.equals(o[o.length-1])||S.push(o=[p]),o.push(y)))))}return S}function Us(e,r,a,d){var _=[],S=e.image,i=S.pixelRatio,t=S.paddedRect.w-2,o=S.paddedRect.h-2,l=e.right-e.left,p=e.bottom-e.top,y=S.stretchX||[[0,t]],v=S.stretchY||[[0,o]],I=function(gt,nt){return gt+nt[1]-nt[0]},k=y.reduce(I,0),L=v.reduce(I,0),O=t-k,B=o-L,q=0,$=k,W=0,ne=L,ue=0,Ie=O,De=0,Fe=B;if(S.content&&d){var Ue=S.content;q=Uc(y,0,Ue[0]),W=Uc(v,0,Ue[1]),$=Uc(y,Ue[0],Ue[2]),ne=Uc(v,Ue[1],Ue[3]),ue=Ue[0]-q,De=Ue[1]-W,Ie=Ue[2]-Ue[0]-$,Fe=Ue[3]-Ue[1]-ne}var We=function(gt,nt,lt,Ft){var Bt=Vc(gt.stretch-q,$,l,e.left),ai=Nc(gt.fixed-ue,Ie,gt.stretch,k),hi=Vc(nt.stretch-W,ne,p,e.top),Ti=Nc(nt.fixed-De,Fe,nt.stretch,L),Li=Vc(lt.stretch-q,$,l,e.left),$i=Nc(lt.fixed-ue,Ie,lt.stretch,k),Hi=Vc(Ft.stretch-W,ne,p,e.top),Ui=Nc(Ft.fixed-De,Fe,Ft.stretch,L),Qi=new he(Bt,hi),Vi=new he(Li,hi),er=new he(Li,Hi),mi=new he(Bt,Hi),bi=new he(ai/i,Ti/i),Ai=new he($i/i,Ui/i),vi=r*Math.PI/180;if(vi){var yr=Math.sin(vi),dr=Math.cos(vi),Bi=[dr,-yr,yr,dr];Qi._matMult(Bi),Vi._matMult(Bi),mi._matMult(Bi),er._matMult(Bi)}var Pi=gt.stretch+gt.fixed,Yi=nt.stretch+nt.fixed;return{tl:Qi,tr:Vi,bl:mi,br:er,tex:{x:S.paddedRect.x+1+Pi,y:S.paddedRect.y+1+Yi,w:lt.stretch+lt.fixed-Pi,h:Ft.stretch+Ft.fixed-Yi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:bi,pixelOffsetBR:Ai,minFontScaleX:Ie/i/l,minFontScaleY:Fe/i/p,isSDF:a}};if(d&&(S.stretchX||S.stretchY))for(var Ve=vl(y,O,k),mt=vl(v,B,L),dt=0;dt<Ve.length-1;dt++)for(var tt=Ve[dt],pt=Ve[dt+1],at=0;at<mt.length-1;at++)_.push(We(tt,mt[at],pt,mt[at+1]));else _.push(We({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:t+1},{fixed:0,stretch:o+1}));return _}function Uc(e,r,a){for(var d=0,_=0,S=e;_<S.length;_+=1){var i=S[_];d+=Math.max(r,Math.min(a,i[1]))-Math.max(r,Math.min(a,i[0]))}return d}function vl(e,r,a){for(var d=[{fixed:-1,stretch:0}],_=0,S=e;_<S.length;_+=1){var i=S[_],t=i[0],o=i[1],l=d[d.length-1];d.push({fixed:t-l.stretch,stretch:l.stretch}),d.push({fixed:t-l.stretch,stretch:l.stretch+(o-t)})}return d.push({fixed:r+1,stretch:a}),d}function Vc(e,r,a,d){return e/r*a+d}function Nc(e,r,a,d){return e-r*a/d}var jc=function(e,r,a,d,_,S,i,t,o,l){if(this.boxStartIndex=e.length,o){var p=S.top,y=S.bottom,v=S.collisionPadding;v&&(p-=v[1],y+=v[3]);var I=y-p;I>0&&(I=Math.max(10,I),this.circleDiameter=I)}else{var k=S.top*i-t,L=S.bottom*i+t,O=S.left*i-t,B=S.right*i+t,q=S.collisionPadding;if(q&&(O-=q[0]*i,k-=q[1]*i,B+=q[2]*i,L+=q[3]*i),l){var $=new he(O,k),W=new he(B,k),ne=new he(O,L),ue=new he(B,L),Ie=l*Math.PI/180;$._rotate(Ie),W._rotate(Ie),ne._rotate(Ie),ue._rotate(Ie),O=Math.min($.x,W.x,ne.x,ue.x),B=Math.max($.x,W.x,ne.x,ue.x),k=Math.min($.y,W.y,ne.y,ue.y),L=Math.max($.y,W.y,ne.y,ue.y)}e.emplaceBack(r.x,r.y,O,k,B,L,a,d,_)}this.boxEndIndex=e.length},Lu=function(e,r){if(e===void 0&&(e=[]),r===void 0&&(r=hf),this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(var a=(this.length>>1)-1;a>=0;a--)this._down(a)};function hf(e,r){return e<r?-1:e>r?1:0}function pf(e,r,a){r===void 0&&(r=1),a===void 0&&(a=!1);for(var d=1/0,_=1/0,S=-1/0,i=-1/0,t=e[0],o=0;o<t.length;o++){var l=t[o];(!o||l.x<d)&&(d=l.x),(!o||l.y<_)&&(_=l.y),(!o||l.x>S)&&(S=l.x),(!o||l.y>i)&&(i=l.y)}var p=Math.min(S-d,i-_),y=p/2,v=new Lu([],Hp);if(p===0)return new he(d,_);for(var I=d;I<S;I+=p)for(var k=_;k<i;k+=p)v.push(new Du(I+y,k+y,y,e));for(var L=function(q){for(var $=0,W=0,ne=0,ue=q[0],Ie=0,De=ue.length,Fe=De-1;Ie<De;Fe=Ie++){var Ue=ue[Ie],We=ue[Fe],Ve=Ue.x*We.y-We.x*Ue.y;W+=(Ue.x+We.x)*Ve,ne+=(Ue.y+We.y)*Ve,$+=3*Ve}return new Du(W/$,ne/$,0,q)}(e),O=v.length;v.length;){var B=v.pop();(B.d>L.d||!L.d)&&(L=B,a&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,O)),B.max-L.d<=r||(v.push(new Du(B.p.x-(y=B.h/2),B.p.y-y,y,e)),v.push(new Du(B.p.x+y,B.p.y-y,y,e)),v.push(new Du(B.p.x-y,B.p.y+y,y,e)),v.push(new Du(B.p.x+y,B.p.y+y,y,e)),O+=4)}return a&&(console.log("num probes: "+O),console.log("best distance: "+L.d)),L.p}function Hp(e,r){return r.max-e.max}function Du(e,r,a,d){this.p=new he(e,r),this.h=a,this.d=function(_,S){for(var i=!1,t=1/0,o=0;o<S.length;o++)for(var l=S[o],p=0,y=l.length,v=y-1;p<y;v=p++){var I=l[p],k=l[v];I.y>_.y!=k.y>_.y&&_.x<(k.x-I.x)*(_.y-I.y)/(k.y-I.y)+I.x&&(i=!i),t=Math.min(t,Vl(_,I,k))}return(i?1:-1)*Math.sqrt(t)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}Lu.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},Lu.prototype.pop=function(){if(this.length!==0){var e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}},Lu.prototype.peek=function(){return this.data[0]},Lu.prototype._up=function(e){for(var r=this.data,a=this.compare,d=r[e];e>0;){var _=e-1>>1,S=r[_];if(a(d,S)>=0)break;r[e]=S,e=_}r[e]=d},Lu.prototype._down=function(e){for(var r=this.data,a=this.compare,d=this.length>>1,_=r[e];e<d;){var S=1+(e<<1),i=r[S],t=S+1;if(t<this.length&&a(r[t],i)<0&&(S=t,i=r[t]),a(i,_)>=0)break;r[e]=i,e=S}r[e]=_};var vh=Number.POSITIVE_INFINITY;function qc(e,r){return r[1]!==vh?function(a,d,_){var S=0,i=0;switch(d=Math.abs(d),_=Math.abs(_),a){case"top-right":case"top-left":case"top":i=_-7;break;case"bottom-right":case"bottom-left":case"bottom":i=7-_}switch(a){case"top-right":case"bottom-right":case"right":S=-d;break;case"top-left":case"bottom-left":case"left":S=d}return[S,i]}(e,r[0],r[1]):function(a,d){var _=0,S=0;d<0&&(d=0);var i=d/Math.sqrt(2);switch(a){case"top-right":case"top-left":S=i-7;break;case"bottom-right":case"bottom-left":S=7-i;break;case"bottom":S=7-d;break;case"top":S=d-7}switch(a){case"top-right":case"bottom-right":_=-i;break;case"top-left":case"bottom-left":_=i;break;case"left":_=d;break;case"right":_=-d}return[_,S]}(e,r[0])}function xh(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Gc(e,r,a,d,_,S,i,t,o,l,p,y,v,I,k){var L=function(W,ne,ue,Ie,De,Fe,Ue,We){for(var Ve=Ie.layout.get("text-rotate").evaluate(Fe,{})*Math.PI/180,mt=[],dt=0,tt=ne.positionedLines;dt<tt.length;dt+=1)for(var pt=tt[dt],at=0,gt=pt.positionedGlyphs;at<gt.length;at+=1){var nt=gt[at];if(nt.rect){var lt=nt.rect||{},Ft=4,Bt=!0,ai=1,hi=0,Ti=(De||We)&&nt.vertical,Li=nt.metrics.advance*nt.scale/2;if(We&&ne.verticalizable&&(hi=pt.lineOffset/2-(nt.imageName?-(24-nt.metrics.width*nt.scale)/2:24*(nt.scale-1))),nt.imageName){var $i=Ue[nt.imageName];Bt=$i.sdf,Ft=1/(ai=$i.pixelRatio)}var Hi=De?[nt.x+Li,nt.y]:[0,0],Ui=De?[0,0]:[nt.x+Li+ue[0],nt.y+ue[1]-hi],Qi=[0,0];Ti&&(Qi=Ui,Ui=[0,0]);var Vi=(nt.metrics.left-Ft)*nt.scale-Li+Ui[0],er=(-nt.metrics.top-Ft)*nt.scale+Ui[1],mi=Vi+lt.w*nt.scale/ai,bi=er+lt.h*nt.scale/ai,Ai=new he(Vi,er),vi=new he(mi,er),yr=new he(Vi,bi),dr=new he(mi,bi);if(Ti){var Bi=new he(-Li,Li- -17),Pi=-Math.PI/2,Yi=12-Li,Ht=new he(22-Yi,-(nt.imageName?Yi:0)),bn=new(Function.prototype.bind.apply(he,[null].concat(Qi)));Ai._rotateAround(Pi,Bi)._add(Ht)._add(bn),vi._rotateAround(Pi,Bi)._add(Ht)._add(bn),yr._rotateAround(Pi,Bi)._add(Ht)._add(bn),dr._rotateAround(Pi,Bi)._add(Ht)._add(bn)}if(Ve){var br=Math.sin(Ve),Zr=Math.cos(Ve),nr=[Zr,-br,br,Zr];Ai._matMult(nr),vi._matMult(nr),yr._matMult(nr),dr._matMult(nr)}var $n=new he(0,0),Pn=new he(0,0);mt.push({tl:Ai,tr:vi,bl:yr,br:dr,tex:lt,writingMode:ne.writingMode,glyphOffset:Hi,sectionIndex:nt.sectionIndex,isSDF:Bt,pixelOffsetTL:$n,pixelOffsetBR:Pn,minFontScaleX:0,minFontScaleY:0})}}return mt}(0,a,t,_,S,i,d,e.allowVerticalPlacement),O=e.textSizeData,B=null;O.kind==="source"?(B=[128*_.layout.get("text-size").evaluate(i,{})])[0]>32640&&Oi(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):O.kind==="composite"&&((B=[128*I.compositeTextSizes[0].evaluate(i,{},k),128*I.compositeTextSizes[1].evaluate(i,{},k)])[0]>32640||B[1]>32640)&&Oi(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),e.addSymbols(e.text,L,B,t,S,i,l,r,o.lineStartIndex,o.lineLength,v,k);for(var q=0,$=p;q<$.length;q+=1)y[$[q]]=e.text.placedSymbolArray.length-1;return 4*L.length}function Zc(e){for(var r in e)return e[r];return null}function bh(e,r,a,d){var _=e.compareText;if(r in _){for(var S=_[r],i=S.length-1;i>=0;i--)if(d.dist(S[i])<a)return!0}else _[r]=[];return _[r].push(d),!1}var df=ac.VectorTileFeature.types,ff=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function wh(e,r,a,d,_,S,i,t,o,l,p,y,v){var I=t?Math.min(32640,Math.round(t[0])):0,k=t?Math.min(32640,Math.round(t[1])):0;e.emplaceBack(r,a,Math.round(32*d),Math.round(32*_),S,i,(I<<1)+(o?1:0),k,16*l,16*p,256*y,256*v)}function dp(e,r,a){e.emplaceBack(r.x,r.y,a),e.emplaceBack(r.x,r.y,a),e.emplaceBack(r.x,r.y,a),e.emplaceBack(r.x,r.y,a)}function dc(e){for(var r=0,a=e.sections;r<a.length;r+=1)if(mr(a[r].text))return!0;return!1}var Xl=function(e){this.layoutVertexArray=new Le,this.indexArray=new ut,this.programConfigurations=e,this.segments=new ce,this.dynamicLayoutVertexArray=new be,this.opacityVertexArray=new Me,this.placedSymbolArray=new f};Xl.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Xl.prototype.upload=function(e,r,a,d){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,nf.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Dp.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,ff,!0),this.opacityVertexBuffer.itemSize=1),(a||d)&&this.programConfigurations.upload(e))},Xl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},jt("SymbolBuffers",Xl);var fc=function(e,r,a){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new a,this.segments=new ce,this.collisionVertexArray=new Ze};fc.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,tp.members,!0)},fc.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},jt("CollisionBuffers",fc);var rr=function(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(S){return S.id}),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ho([]),this.placementViewportMatrix=ho([]);var r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=sp(this.zoom,r["text-size"]),this.iconSizeData=sp(this.zoom,r["icon-size"]);var a=this.layers[0].layout,d=a.get("symbol-sort-key"),_=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&d.constantOr(1)!==void 0,this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(function(S){return ua[S]})),this.stateDependentLayerIds=this.layers.filter(function(S){return S.isStateDependent()}).map(function(S){return S.id}),this.sourceID=e.sourceID};rr.prototype.createArrays=function(){this.text=new Xl(new ei(this.layers,this.zoom,function(e){return/^text/.test(e)})),this.icon=new Xl(new ei(this.layers,this.zoom,function(e){return/^icon/.test(e)})),this.glyphOffsetArray=new M,this.lineVertexArray=new F,this.symbolInstances=new P},rr.prototype.calculateGlyphDependencies=function(e,r,a,d,_){for(var S=0;S<e.length;S++)if(r[e.charCodeAt(S)]=!0,(a||d)&&_){var i=cc[e.charAt(S)];i&&(r[i.charCodeAt(0)]=!0)}},rr.prototype.populate=function(e,r,a){var d=this.layers[0],_=d.layout,S=_.get("text-font"),i=_.get("text-field"),t=_.get("icon-image"),o=(i.value.kind!=="constant"||i.value.value instanceof Xi&&!i.value.value.isEmpty()||i.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),l=t.value.kind!=="constant"||!!t.value.value||Object.keys(t.parameters).length>0,p=_.get("symbol-sort-key");if(this.features=[],o||l){for(var y=r.iconDependencies,v=r.glyphDependencies,I=r.availableImages,k=new At(this.zoom),L=0,O=e;L<O.length;L+=1){var B=O[L],q=B.feature,$=B.id,W=B.index,ne=B.sourceLayerIndex,ue=d._featureFilter.needGeometry,Ie=Di(q,ue);if(d._featureFilter.filter(k,Ie,a)){ue||(Ie.geometry=zr(q));var De=void 0;if(o){var Fe=d.getValueAndResolveTokens("text-field",Ie,a,I),Ue=Xi.factory(Fe);dc(Ue)&&(this.hasRTLText=!0),(!this.hasRTLText||Ro()==="unavailable"||this.hasRTLText&&Gt.isParsed())&&(De=Op(Ue,d,Ie))}var We=void 0;if(l){var Ve=d.getValueAndResolveTokens("icon-image",Ie,a,I);We=Ve instanceof Ln?Ve:Ln.fromString(Ve)}if(De||We){var mt=this.sortFeaturesByKey?p.evaluate(Ie,{},a):void 0;if(this.features.push({id:$,text:De,icon:We,index:W,sourceLayerIndex:ne,geometry:Ie.geometry,properties:q.properties,type:df[q.type],sortKey:mt}),We&&(y[We.name]=!0),De){var dt=S.evaluate(Ie,{},a).join(","),tt=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ua.vertical)>=0;for(var pt=0,at=De.sections;pt<at.length;pt+=1){var gt=at[pt];if(gt.image)y[gt.image.name]=!0;else{var nt=sl(De.toString()),lt=gt.fontStack||dt,Ft=v[lt]=v[lt]||{};this.calculateGlyphDependencies(gt.text,Ft,tt,this.allowVerticalPlacement,nt)}}}}}}_.get("symbol-placement")==="line"&&(this.features=function(Bt){var ai={},hi={},Ti=[],Li=0;function $i(Bi){Ti.push(Bt[Bi]),Li++}function Hi(Bi,Pi,Yi){var Ht=hi[Bi];return delete hi[Bi],hi[Pi]=Ht,Ti[Ht].geometry[0].pop(),Ti[Ht].geometry[0]=Ti[Ht].geometry[0].concat(Yi[0]),Ht}function Ui(Bi,Pi,Yi){var Ht=ai[Pi];return delete ai[Pi],ai[Bi]=Ht,Ti[Ht].geometry[0].shift(),Ti[Ht].geometry[0]=Yi[0].concat(Ti[Ht].geometry[0]),Ht}function Qi(Bi,Pi,Yi){var Ht=Yi?Pi[0][Pi[0].length-1]:Pi[0][0];return Bi+":"+Ht.x+":"+Ht.y}for(var Vi=0;Vi<Bt.length;Vi++){var er=Bt[Vi],mi=er.geometry,bi=er.text?er.text.toString():null;if(bi){var Ai=Qi(bi,mi),vi=Qi(bi,mi,!0);if(Ai in hi&&vi in ai&&hi[Ai]!==ai[vi]){var yr=Ui(Ai,vi,mi),dr=Hi(Ai,vi,Ti[yr].geometry);delete ai[Ai],delete hi[vi],hi[Qi(bi,Ti[dr].geometry,!0)]=dr,Ti[yr].geometry=null}else Ai in hi?Hi(Ai,vi,mi):vi in ai?Ui(Ai,vi,mi):($i(Vi),ai[Ai]=Li-1,hi[vi]=Li-1)}else $i(Vi)}return Ti.filter(function(Bi){return Bi.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Bt,ai){return Bt.sortKey-ai.sortKey})}},rr.prototype.update=function(e,r,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,a),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,a))},rr.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},rr.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},rr.prototype.upload=function(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},rr.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},rr.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},rr.prototype.addToLineVertexArray=function(e,r){var a=this.lineVertexArray.length;if(e.segment!==void 0){for(var d=e.dist(r[e.segment+1]),_=e.dist(r[e.segment]),S={},i=e.segment+1;i<r.length;i++)S[i]={x:r[i].x,y:r[i].y,tileUnitDistanceFromAnchor:d},i<r.length-1&&(d+=r[i+1].dist(r[i]));for(var t=e.segment||0;t>=0;t--)S[t]={x:r[t].x,y:r[t].y,tileUnitDistanceFromAnchor:_},t>0&&(_+=r[t-1].dist(r[t]));for(var o=0;o<r.length;o++){var l=S[o];this.lineVertexArray.emplaceBack(l.x,l.y,l.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}},rr.prototype.addSymbols=function(e,r,a,d,_,S,i,t,o,l,p,y){for(var v=e.indexArray,I=e.layoutVertexArray,k=e.segments.prepareSegment(4*r.length,I,v,this.canOverlap?S.sortKey:void 0),L=this.glyphOffsetArray.length,O=k.vertexLength,B=this.allowVerticalPlacement&&i===ua.vertical?Math.PI/2:0,q=S.text&&S.text.sections,$=0;$<r.length;$++){var W=r[$],ne=W.tl,ue=W.tr,Ie=W.bl,De=W.br,Fe=W.tex,Ue=W.pixelOffsetTL,We=W.pixelOffsetBR,Ve=W.minFontScaleX,mt=W.minFontScaleY,dt=W.glyphOffset,tt=W.isSDF,pt=W.sectionIndex,at=k.vertexLength,gt=dt[1];wh(I,t.x,t.y,ne.x,gt+ne.y,Fe.x,Fe.y,a,tt,Ue.x,Ue.y,Ve,mt),wh(I,t.x,t.y,ue.x,gt+ue.y,Fe.x+Fe.w,Fe.y,a,tt,We.x,Ue.y,Ve,mt),wh(I,t.x,t.y,Ie.x,gt+Ie.y,Fe.x,Fe.y+Fe.h,a,tt,Ue.x,We.y,Ve,mt),wh(I,t.x,t.y,De.x,gt+De.y,Fe.x+Fe.w,Fe.y+Fe.h,a,tt,We.x,We.y,Ve,mt),dp(e.dynamicLayoutVertexArray,t,B),v.emplaceBack(at,at+1,at+2),v.emplaceBack(at+1,at+2,at+3),k.vertexLength+=4,k.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(dt[0]),$!==r.length-1&&pt===r[$+1].sectionIndex||e.programConfigurations.populatePaintArrays(I.length,S,S.index,{},y,q&&q[pt])}e.placedSymbolArray.emplaceBack(t.x,t.y,L,this.glyphOffsetArray.length-L,O,o,l,t.segment,a?a[0]:0,a?a[1]:0,d[0],d[1],i,0,!1,0,p)},rr.prototype._addCollisionDebugVertex=function(e,r,a,d,_,S){return r.emplaceBack(0,0),e.emplaceBack(a.x,a.y,d,_,Math.round(S.x),Math.round(S.y))},rr.prototype.addCollisionDebugVertices=function(e,r,a,d,_,S,i){var t=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),o=t.vertexLength,l=_.layoutVertexArray,p=_.collisionVertexArray,y=i.anchorX,v=i.anchorY;this._addCollisionDebugVertex(l,p,S,y,v,new he(e,r)),this._addCollisionDebugVertex(l,p,S,y,v,new he(a,r)),this._addCollisionDebugVertex(l,p,S,y,v,new he(a,d)),this._addCollisionDebugVertex(l,p,S,y,v,new he(e,d)),t.vertexLength+=4;var I=_.indexArray;I.emplaceBack(o,o+1),I.emplaceBack(o+1,o+2),I.emplaceBack(o+2,o+3),I.emplaceBack(o+3,o),t.primitiveLength+=4},rr.prototype.addDebugCollisionBoxes=function(e,r,a,d){for(var _=e;_<r;_++){var S=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(S.x1,S.y1,S.x2,S.y2,d?this.textCollisionBox:this.iconCollisionBox,S.anchorPoint,a)}},rr.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new fc(Ne,Rp.members,Kt),this.iconCollisionBox=new fc(Ne,Rp.members,Kt);for(var e=0;e<this.symbolInstances.length;e++){var r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}},rr.prototype._deserializeCollisionBoxesForSymbol=function(e,r,a,d,_,S,i,t,o){for(var l={},p=r;p<a;p++){var y=e.get(p);l.textBox={x1:y.x1,y1:y.y1,x2:y.x2,y2:y.y2,anchorPointX:y.anchorPointX,anchorPointY:y.anchorPointY},l.textFeatureIndex=y.featureIndex;break}for(var v=d;v<_;v++){var I=e.get(v);l.verticalTextBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,anchorPointX:I.anchorPointX,anchorPointY:I.anchorPointY},l.verticalTextFeatureIndex=I.featureIndex;break}for(var k=S;k<i;k++){var L=e.get(k);l.iconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},l.iconFeatureIndex=L.featureIndex;break}for(var O=t;O<o;O++){var B=e.get(O);l.verticalIconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},l.verticalIconFeatureIndex=B.featureIndex;break}return l},rr.prototype.deserializeCollisionBoxes=function(e){this.collisionArrays=[];for(var r=0;r<this.symbolInstances.length;r++){var a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}},rr.prototype.hasTextData=function(){return this.text.segments.get().length>0},rr.prototype.hasIconData=function(){return this.icon.segments.get().length>0},rr.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},rr.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},rr.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},rr.prototype.addIndicesForPlacedSymbol=function(e,r){for(var a=e.placedSymbolArray.get(r),d=a.vertexStartIndex+4*a.numGlyphs,_=a.vertexStartIndex;_<d;_+=4)e.indexArray.emplaceBack(_,_+1,_+2),e.indexArray.emplaceBack(_+1,_+2,_+3)},rr.prototype.getSortedSymbolIndexes=function(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var r=Math.sin(e),a=Math.cos(e),d=[],_=[],S=[],i=0;i<this.symbolInstances.length;++i){S.push(i);var t=this.symbolInstances.get(i);d.push(0|Math.round(r*t.anchorX+a*t.anchorY)),_.push(t.featureIndex)}return S.sort(function(o,l){return d[o]-d[l]||_[l]-_[o]}),S},rr.prototype.addToSortKeyRanges=function(e,r){var a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})},rr.prototype.sortFeatures=function(e){var r=this;if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var a=0,d=this.symbolInstanceIndexes;a<d.length;a+=1){var _=this.symbolInstances.get(d[a]);this.featureSortOrder.push(_.featureIndex),[_.rightJustifiedTextSymbolIndex,_.centerJustifiedTextSymbolIndex,_.leftJustifiedTextSymbolIndex].forEach(function(S,i,t){S>=0&&t.indexOf(S)===i&&r.addIndicesForPlacedSymbol(r.text,S)}),_.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,_.verticalPlacedTextSymbolIndex),_.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,_.placedIconSymbolIndex),_.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,_.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},jt("SymbolBucket",rr,{omit:["layers","collisionBoxArray","features","compareText"]}),rr.MAX_GLYPHS=65535,rr.addDynamicAttributes=dp;var mf=new b({"symbol-placement":new Pt(fe.layout_symbol["symbol-placement"]),"symbol-spacing":new Pt(fe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Pt(fe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new zt(fe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Pt(fe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Pt(fe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Pt(fe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Pt(fe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Pt(fe.layout_symbol["icon-rotation-alignment"]),"icon-size":new zt(fe.layout_symbol["icon-size"]),"icon-text-fit":new Pt(fe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Pt(fe.layout_symbol["icon-text-fit-padding"]),"icon-image":new zt(fe.layout_symbol["icon-image"]),"icon-rotate":new zt(fe.layout_symbol["icon-rotate"]),"icon-padding":new Pt(fe.layout_symbol["icon-padding"]),"icon-keep-upright":new Pt(fe.layout_symbol["icon-keep-upright"]),"icon-offset":new zt(fe.layout_symbol["icon-offset"]),"icon-anchor":new zt(fe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Pt(fe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Pt(fe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Pt(fe.layout_symbol["text-rotation-alignment"]),"text-field":new zt(fe.layout_symbol["text-field"]),"text-font":new zt(fe.layout_symbol["text-font"]),"text-size":new zt(fe.layout_symbol["text-size"]),"text-max-width":new zt(fe.layout_symbol["text-max-width"]),"text-line-height":new Pt(fe.layout_symbol["text-line-height"]),"text-letter-spacing":new zt(fe.layout_symbol["text-letter-spacing"]),"text-justify":new zt(fe.layout_symbol["text-justify"]),"text-radial-offset":new zt(fe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Pt(fe.layout_symbol["text-variable-anchor"]),"text-anchor":new zt(fe.layout_symbol["text-anchor"]),"text-max-angle":new Pt(fe.layout_symbol["text-max-angle"]),"text-writing-mode":new Pt(fe.layout_symbol["text-writing-mode"]),"text-rotate":new zt(fe.layout_symbol["text-rotate"]),"text-padding":new Pt(fe.layout_symbol["text-padding"]),"text-keep-upright":new Pt(fe.layout_symbol["text-keep-upright"]),"text-transform":new zt(fe.layout_symbol["text-transform"]),"text-offset":new zt(fe.layout_symbol["text-offset"]),"text-allow-overlap":new Pt(fe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Pt(fe.layout_symbol["text-ignore-placement"]),"text-optional":new Pt(fe.layout_symbol["text-optional"])}),Vs={paint:new b({"icon-opacity":new zt(fe.paint_symbol["icon-opacity"]),"icon-color":new zt(fe.paint_symbol["icon-color"]),"icon-halo-color":new zt(fe.paint_symbol["icon-halo-color"]),"icon-halo-width":new zt(fe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new zt(fe.paint_symbol["icon-halo-blur"]),"icon-translate":new Pt(fe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Pt(fe.paint_symbol["icon-translate-anchor"]),"text-opacity":new zt(fe.paint_symbol["text-opacity"]),"text-color":new zt(fe.paint_symbol["text-color"],{runtimeType:Se,getOverride:function(e){return e.textColor},hasOverride:function(e){return!!e.textColor}}),"text-halo-color":new zt(fe.paint_symbol["text-halo-color"]),"text-halo-width":new zt(fe.paint_symbol["text-halo-width"]),"text-halo-blur":new zt(fe.paint_symbol["text-halo-blur"]),"text-translate":new Pt(fe.paint_symbol["text-translate"]),"text-translate-anchor":new Pt(fe.paint_symbol["text-translate-anchor"])}),layout:mf},Ru=function(e){this.type=e.property.overrides?e.property.overrides.runtimeType:ge,this.defaultValue=e};Ru.prototype.evaluate=function(e){if(e.formattedSection){var r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default},Ru.prototype.eachChild=function(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)},Ru.prototype.outputDefined=function(){return!1},Ru.prototype.serialize=function(){return null},jt("FormatSectionOverride",Ru,{omit:["defaultValue"]});var Wp=function(e){function r(a){e.call(this,a,Vs)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.recalculate=function(a,d){if(e.prototype.recalculate.call(this,a,d),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var _=this.layout.get("text-writing-mode");if(_){for(var S=[],i=0,t=_;i<t.length;i+=1){var o=t[i];S.indexOf(o)<0&&S.push(o)}this.layout._values["text-writing-mode"]=S}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},r.prototype.getValueAndResolveTokens=function(a,d,_,S){var i=this.layout.get(a).evaluate(d,{},_,S),t=this._unevaluatedLayout._values[a];return t.isDataDriven()||as(t.value)||!i?i:function(o,l){return l.replace(/{([^{}]+)}/g,function(p,y){return y in o?String(o[y]):""})}(d.properties,i)},r.prototype.createBucket=function(a){return new rr(a)},r.prototype.queryRadius=function(){return 0},r.prototype.queryIntersectsFeature=function(){return!1},r.prototype._setPaintOverrides=function(){for(var a=0,d=Vs.paint.overridableProperties;a<d.length;a+=1){var _=d[a];if(r.hasPaintOverride(this.layout,_)){var S,i=this.paint.get(_),t=new Ru(i),o=new xa(t,i.property.specification);S=i.value.kind==="constant"||i.value.kind==="source"?new Na("source",o):new ba("composite",o,i.value.zoomStops,i.value._interpolationType),this.paint._values[_]=new Zn(i.property,S,i.parameters)}}},r.prototype._handleOverridablePaintPropertyUpdate=function(a,d,_){return!(!this.layout||d.isDataDriven()||_.isDataDriven())&&r.hasPaintOverride(this.layout,a)},r.hasPaintOverride=function(a,d){var _=a.get("text-field"),S=Vs.paint.properties[d],i=!1,t=function(p){for(var y=0,v=p;y<v.length;y+=1)if(S.overrides&&S.overrides.hasOverride(v[y]))return void(i=!0)};if(_.value.kind==="constant"&&_.value.value instanceof Xi)t(_.value.value.sections);else if(_.value.kind==="source"){var o=function(p){i||(p instanceof Vn&&Rr(p.value)===Tt?t(p.value.sections):p instanceof wo?t(p.sections):p.eachChild(o))},l=_.value;l._styleExpression&&o(l._styleExpression.expression)}return i},r}(n),gf={paint:new b({"background-color":new Pt(fe.paint_background["background-color"]),"background-pattern":new Yr(fe.paint_background["background-pattern"]),"background-opacity":new Pt(fe.paint_background["background-opacity"])})},yf=function(e){function r(a){e.call(this,a,gf)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r}(n),_f={paint:new b({"raster-opacity":new Pt(fe.paint_raster["raster-opacity"]),"raster-hue-rotate":new Pt(fe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Pt(fe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Pt(fe.paint_raster["raster-brightness-max"]),"raster-saturation":new Pt(fe.paint_raster["raster-saturation"]),"raster-contrast":new Pt(fe.paint_raster["raster-contrast"]),"raster-resampling":new Pt(fe.paint_raster["raster-resampling"]),"raster-fade-duration":new Pt(fe.paint_raster["raster-fade-duration"])})},Eh=function(e){function r(a){e.call(this,a,_f)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r}(n),fp=function(e){function r(a){e.call(this,a,{}),this.implementation=a}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},r.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},r.prototype.recalculate=function(){},r.prototype.updateTransitions=function(){},r.prototype.hasTransition=function(){},r.prototype.serialize=function(){},r.prototype.onAdd=function(a){this.implementation.onAdd&&this.implementation.onAdd(a,a.painter.context.gl)},r.prototype.onRemove=function(a){this.implementation.onRemove&&this.implementation.onRemove(a,a.painter.context.gl)},r}(n),vf={circle:lh,heatmap:Ic,hillshade:Cp,fill:Yh,"fill-extrusion":Jd,line:rf,symbol:Wp,background:yf,raster:Eh},Sh=re.HTMLImageElement,Th=re.HTMLCanvasElement,Bu=re.HTMLVideoElement,Kp=re.ImageData,mc=re.ImageBitmap,$l=function(e,r,a,d){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(r,d)};$l.prototype.update=function(e,r,a){var d=e.width,_=e.height,S=!(this.size&&this.size[0]===d&&this.size[1]===_||a),i=this.context,t=i.gl;if(this.useMipmap=Boolean(r&&r.useMipmap),t.bindTexture(t.TEXTURE_2D,this.texture),i.pixelStoreUnpackFlipY.set(!1),i.pixelStoreUnpack.set(1),i.pixelStoreUnpackPremultiplyAlpha.set(this.format===t.RGBA&&(!r||r.premultiply!==!1)),S)this.size=[d,_],e instanceof Sh||e instanceof Th||e instanceof Bu||e instanceof Kp||mc&&e instanceof mc?t.texImage2D(t.TEXTURE_2D,0,this.format,this.format,t.UNSIGNED_BYTE,e):t.texImage2D(t.TEXTURE_2D,0,this.format,d,_,0,this.format,t.UNSIGNED_BYTE,e.data);else{var o=a||{x:0,y:0},l=o.x,p=o.y;e instanceof Sh||e instanceof Th||e instanceof Bu||e instanceof Kp||mc&&e instanceof mc?t.texSubImage2D(t.TEXTURE_2D,0,l,p,t.RGBA,t.UNSIGNED_BYTE,e):t.texSubImage2D(t.TEXTURE_2D,0,l,p,d,_,t.RGBA,t.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&t.generateMipmap(t.TEXTURE_2D)},$l.prototype.bind=function(e,r,a){var d=this.context.gl;d.bindTexture(d.TEXTURE_2D,this.texture),a!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=d.LINEAR),e!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,a||e),this.filter=e),r!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,r),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,r),this.wrap=r)},$l.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},$l.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var gc=function(e){var r=this;this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){r._triggered=!1,r._callback()})};gc.prototype.trigger=function(){var e=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){e._triggered=!1,e._callback()},0))},gc.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Hl=function(e,r,a){this.target=e,this.parent=r,this.mapId=a,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},si(["receive","process"],this),this.invoker=new gc(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=ii()?e:re};function Jp(e,r,a){var d=2*Math.PI*6378137/256/Math.pow(2,a);return[e*d-2*Math.PI*6378137/2,r*d-2*Math.PI*6378137/2]}Hl.prototype.send=function(e,r,a,d,_){var S=this;_===void 0&&(_=!1);var i=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(this.callbacks[i]=a);var t=Fn(this.globalScope)?void 0:[];return this.target.postMessage({id:i,type:e,hasCallback:!!a,targetMapId:d,mustQueue:_,sourceMapId:this.mapId,data:Ao(r,t)},t),{cancel:function(){a&&delete S.callbacks[i],S.target.postMessage({id:i,type:"<cancel>",targetMapId:d,sourceMapId:S.mapId})}}},Hl.prototype.receive=function(e){var r=e.data,a=r.id;if(a&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){delete this.tasks[a];var d=this.cancelCallbacks[a];delete this.cancelCallbacks[a],d&&d()}else ii()||r.mustQueue?(this.tasks[a]=r,this.taskQueue.push(a),this.invoker.trigger()):this.processTask(a,r)},Hl.prototype.process=function(){if(this.taskQueue.length){var e=this.taskQueue.shift(),r=this.tasks[e];delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),r&&this.processTask(e,r)}},Hl.prototype.processTask=function(e,r){var a=this;if(r.type==="<response>"){var d=this.callbacks[e];delete this.callbacks[e],d&&(r.error?d(vr(r.error)):d(null,vr(r.data)))}else{var _=!1,S=Fn(this.globalScope)?void 0:[],i=r.hasCallback?function(p,y){_=!0,delete a.cancelCallbacks[e],a.target.postMessage({id:e,type:"<response>",sourceMapId:a.mapId,error:p?Ao(p):null,data:Ao(y,S)},S)}:function(p){_=!0},t=null,o=vr(r.data);if(this.parent[r.type])t=this.parent[r.type](r.sourceMapId,o,i);else if(this.parent.getWorkerSource){var l=r.type.split(".");t=this.parent.getWorkerSource(r.sourceMapId,l[0],o.source)[l[1]](o,i)}else i(new Error("Could not find function "+r.type));!_&&t&&t.cancel&&(this.cancelCallbacks[e]=t.cancel)}},Hl.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var xn=function(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))};xn.prototype.setNorthEast=function(e){return this._ne=e instanceof Ir?new Ir(e.lng,e.lat):Ir.convert(e),this},xn.prototype.setSouthWest=function(e){return this._sw=e instanceof Ir?new Ir(e.lng,e.lat):Ir.convert(e),this},xn.prototype.extend=function(e){var r,a,d=this._sw,_=this._ne;if(e instanceof Ir)r=e,a=e;else{if(!(e instanceof xn))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(xn.convert(e)):this.extend(Ir.convert(e)):this;if(a=e._ne,!(r=e._sw)||!a)return this}return d||_?(d.lng=Math.min(r.lng,d.lng),d.lat=Math.min(r.lat,d.lat),_.lng=Math.max(a.lng,_.lng),_.lat=Math.max(a.lat,_.lat)):(this._sw=new Ir(r.lng,r.lat),this._ne=new Ir(a.lng,a.lat)),this},xn.prototype.getCenter=function(){return new Ir((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},xn.prototype.getSouthWest=function(){return this._sw},xn.prototype.getNorthEast=function(){return this._ne},xn.prototype.getNorthWest=function(){return new Ir(this.getWest(),this.getNorth())},xn.prototype.getSouthEast=function(){return new Ir(this.getEast(),this.getSouth())},xn.prototype.getWest=function(){return this._sw.lng},xn.prototype.getSouth=function(){return this._sw.lat},xn.prototype.getEast=function(){return this._ne.lng},xn.prototype.getNorth=function(){return this._ne.lat},xn.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},xn.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},xn.prototype.isEmpty=function(){return!(this._sw&&this._ne)},xn.prototype.contains=function(e){var r=Ir.convert(e),a=r.lng,d=r.lat,_=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(_=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&_},xn.convert=function(e){return!e||e instanceof xn?e:new xn(e)};var Ir=function(e,r){if(isNaN(e)||isNaN(r))throw new Error("Invalid LngLat object: ("+e+", "+r+")");if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Ir.prototype.wrap=function(){return new Ir(Xt(this.lng,-180,180),this.lat)},Ir.prototype.toArray=function(){return[this.lng,this.lat]},Ir.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Ir.prototype.distanceTo=function(e){var r=Math.PI/180,a=this.lat*r,d=e.lat*r,_=Math.sin(a)*Math.sin(d)+Math.cos(a)*Math.cos(d)*Math.cos((e.lng-this.lng)*r);return 63710088e-1*Math.acos(Math.min(_,1))},Ir.prototype.toBounds=function(e){e===void 0&&(e=0);var r=360*e/40075017,a=r/Math.cos(Math.PI/180*this.lat);return new xn(new Ir(this.lng-a,this.lat-r),new Ir(this.lng+a,this.lat+r))},Ir.convert=function(e){if(e instanceof Ir)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Ir(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Ir(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Yp=2*Math.PI*63710088e-1;function Qp(e){return Yp*Math.cos(e*Math.PI/180)}function mp(e){return(180+e)/360}function en(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Wl(e,r){return e/Qp(r)}function Ah(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}var Kl=function(e,r,a){a===void 0&&(a=0),this.x=+e,this.y=+r,this.z=+a};Kl.fromLngLat=function(e,r){r===void 0&&(r=0);var a=Ir.convert(e);return new Kl(mp(a.lng),en(a.lat),Wl(r,a.lat))},Kl.prototype.toLngLat=function(){return new Ir(360*this.x-180,Ah(this.y))},Kl.prototype.toAltitude=function(){return this.z*Qp(Ah(this.y))},Kl.prototype.meterInMercatorCoordinateUnits=function(){return 1/Yp*(e=Ah(this.y),1/Math.cos(e*Math.PI/180));var e};var Jl=function(e,r,a){this.z=e,this.x=r,this.y=a,this.key=Ou(0,e,e,r,a)};Jl.prototype.equals=function(e){return this.z===e.z&&this.x===e.x&&this.y===e.y},Jl.prototype.url=function(e,r){var a,d,_,S,i,t=(d=this.y,_=this.z,S=Jp(256*(a=this.x),256*(d=Math.pow(2,_)-d-1),_),i=Jp(256*(a+1),256*(d+1),_),S[0]+","+S[1]+","+i[0]+","+i[1]),o=function(l,p,y){for(var v,I="",k=l;k>0;k--)I+=(p&(v=1<<k-1)?1:0)+(y&v?2:0);return I}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",o).replace("{bbox-epsg-3857}",t)},Jl.prototype.getTilePoint=function(e){var r=Math.pow(2,this.z);return new he(8192*(e.x*r-this.x),8192*(e.y*r-this.y))},Jl.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var gp=function(e,r){this.wrap=e,this.canonical=r,this.key=Ou(e,r.z,r.z,r.x,r.y)},sn=function(e,r,a,d,_){this.overscaledZ=e,this.wrap=r,this.canonical=new Jl(a,+d,+_),this.key=Ou(r,e,a,d,_)};function Ou(e,r,a,d,_){(e*=2)<0&&(e=-1*e-1);var S=1<<a;return(S*S*e+S*_+d).toString(36)+a.toString(36)+r.toString(36)}sn.prototype.equals=function(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)},sn.prototype.scaledTo=function(e){var r=this.canonical.z-e;return e>this.canonical.z?new sn(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new sn(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)},sn.prototype.calculateScaledKey=function(e,r){var a=this.canonical.z-e;return e>this.canonical.z?Ou(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):Ou(this.wrap*+r,e,e,this.canonical.x>>a,this.canonical.y>>a)},sn.prototype.isChildOf=function(e){if(e.wrap!==this.wrap)return!1;var r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r},sn.prototype.children=function(e){if(this.overscaledZ>=e)return[new sn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var r=this.canonical.z+1,a=2*this.canonical.x,d=2*this.canonical.y;return[new sn(r,this.wrap,r,a,d),new sn(r,this.wrap,r,a+1,d),new sn(r,this.wrap,r,a,d+1),new sn(r,this.wrap,r,a+1,d+1)]},sn.prototype.isLessThan=function(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))},sn.prototype.wrapped=function(){return new sn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},sn.prototype.unwrapTo=function(e){return new sn(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)},sn.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},sn.prototype.toUnwrapped=function(){return new gp(this.wrap,this.canonical)},sn.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},sn.prototype.getTilePoint=function(e){return this.canonical.getTilePoint(new Kl(e.x-this.wrap,e.y))},jt("CanonicalTileID",Jl),jt("OverscaledTileID",sn,{omit:["posMatrix"]});var Xa=function(e,r,a){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return Oi('"'+a+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=r.height;var d=this.dim=r.height-2;this.data=new Uint32Array(r.data.buffer),this.encoding=a||"mapbox";for(var _=0;_<d;_++)this.data[this._idx(-1,_)]=this.data[this._idx(0,_)],this.data[this._idx(d,_)]=this.data[this._idx(d-1,_)],this.data[this._idx(_,-1)]=this.data[this._idx(_,0)],this.data[this._idx(_,d)]=this.data[this._idx(_,d-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(d,-1)]=this.data[this._idx(d-1,0)],this.data[this._idx(-1,d)]=this.data[this._idx(0,d-1)],this.data[this._idx(d,d)]=this.data[this._idx(d-1,d-1)]};Xa.prototype.get=function(e,r){var a=new Uint8Array(this.data.buffer),d=4*this._idx(e,r);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(a[d],a[d+1],a[d+2])},Xa.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Xa.prototype._idx=function(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)},Xa.prototype._unpackMapbox=function(e,r,a){return(256*e*256+256*r+a)/10-1e4},Xa.prototype._unpackTerrarium=function(e,r,a){return 256*e+r+a/256-32768},Xa.prototype.getPixels=function(){return new po({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Xa.prototype.backfillBorder=function(e,r,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");var d=r*this.dim,_=r*this.dim+this.dim,S=a*this.dim,i=a*this.dim+this.dim;switch(r){case-1:d=_-1;break;case 1:_=d+1}switch(a){case-1:S=i-1;break;case 1:i=S+1}for(var t=-r*this.dim,o=-a*this.dim,l=S;l<i;l++)for(var p=d;p<_;p++)this.data[this._idx(p,l)]=e.data[this._idx(p+t,l+o)]},jt("DEMData",Xa);var Xc=function(e){this._stringToNumber={},this._numberToString=[];for(var r=0;r<e.length;r++){var a=e[r];this._stringToNumber[a]=r,this._numberToString[r]=a}};Xc.prototype.encode=function(e){return this._stringToNumber[e]},Xc.prototype.decode=function(e){return this._numberToString[e]};var yc=function(e,r,a,d,_){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=a,e._y=d,this.properties=e.properties,this.id=_},Ih={geometry:{configurable:!0}};Ih.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Ih.geometry.set=function(e){this._geometry=e},yc.prototype.toJSON=function(){var e={geometry:this.geometry};for(var r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e},Object.defineProperties(yc.prototype,Ih);var Co=function(){this.state={},this.stateChanges={},this.deletedStates={}};Co.prototype.updateState=function(e,r,a){var d=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][d]=this.stateChanges[e][d]||{},Wt(this.stateChanges[e][d],a),this.deletedStates[e]===null)for(var _ in this.deletedStates[e]={},this.state[e])_!==d&&(this.deletedStates[e][_]=null);else if(this.deletedStates[e]&&this.deletedStates[e][d]===null)for(var S in this.deletedStates[e][d]={},this.state[e][d])a[S]||(this.deletedStates[e][d][S]=null);else for(var i in a)this.deletedStates[e]&&this.deletedStates[e][d]&&this.deletedStates[e][d][i]===null&&delete this.deletedStates[e][d][i]},Co.prototype.removeFeatureState=function(e,r,a){if(this.deletedStates[e]!==null){var d=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&r!==void 0)this.deletedStates[e][d]!==null&&(this.deletedStates[e][d]=this.deletedStates[e][d]||{},this.deletedStates[e][d][a]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][d])for(a in this.deletedStates[e][d]={},this.stateChanges[e][d])this.deletedStates[e][d][a]=null;else this.deletedStates[e][d]=null;else this.deletedStates[e]=null}},Co.prototype.getState=function(e,r){var a=String(r),d=Wt({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){var _=this.deletedStates[e][r];if(_===null)return{};for(var S in _)delete d[S]}return d},Co.prototype.initializeTileState=function(e,r){e.setFeatureState(this.state,r)},Co.prototype.coalesceChanges=function(e,r){var a={};for(var d in this.stateChanges){this.state[d]=this.state[d]||{};var _={};for(var S in this.stateChanges[d])this.state[d][S]||(this.state[d][S]={}),Wt(this.state[d][S],this.stateChanges[d][S]),_[S]=this.state[d][S];a[d]=_}for(var i in this.deletedStates){this.state[i]=this.state[i]||{};var t={};if(this.deletedStates[i]===null)for(var o in this.state[i])t[o]={},this.state[i][o]={};else for(var l in this.deletedStates[i]){if(this.deletedStates[i][l]===null)this.state[i][l]={};else for(var p=0,y=Object.keys(this.deletedStates[i][l]);p<y.length;p+=1)delete this.state[i][l][y[p]];t[l]=this.state[i][l]}a[i]=a[i]||{},Wt(a[i],t)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(var v in e)e[v].setFeatureState(a,r)};var ka=function(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ta(8192,16,0),this.grid3D=new Ta(8192,16,0),this.featureIndexArray=new Y,this.promoteId=r};function yp(e,r,a,d,_){return Gi(e,function(S,i){var t=r instanceof Ia?r.get(i):null;return t&&t.evaluate?t.evaluate(a,d,_):t})}function _p(e){for(var r=1/0,a=1/0,d=-1/0,_=-1/0,S=0,i=e;S<i.length;S+=1){var t=i[S];r=Math.min(r,t.x),a=Math.min(a,t.y),d=Math.max(d,t.x),_=Math.max(_,t.y)}return{minX:r,minY:a,maxX:d,maxY:_}}function ed(e,r){return r-e}ka.prototype.insert=function(e,r,a,d,_,S){var i=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,d,_);for(var t=S?this.grid3D:this.grid,o=0;o<r.length;o++){for(var l=r[o],p=[1/0,1/0,-1/0,-1/0],y=0;y<l.length;y++){var v=l[y];p[0]=Math.min(p[0],v.x),p[1]=Math.min(p[1],v.y),p[2]=Math.max(p[2],v.x),p[3]=Math.max(p[3],v.y)}p[0]<8192&&p[1]<8192&&p[2]>=0&&p[3]>=0&&t.insert(i,p[0],p[1],p[2],p[3])}},ka.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new ac.VectorTile(new fh(this.rawTileData)).layers,this.sourceLayerCoder=new Xc(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},ka.prototype.query=function(e,r,a,d){var _=this;this.loadVTLayers();for(var S=e.params||{},i=8192/e.tileSize/e.scale,t=ol(S.filter),o=e.queryGeometry,l=e.queryPadding*i,p=_p(o),y=this.grid.query(p.minX-l,p.minY-l,p.maxX+l,p.maxY+l),v=_p(e.cameraQueryGeometry),I=this.grid3D.query(v.minX-l,v.minY-l,v.maxX+l,v.maxY+l,function(W,ne,ue,Ie){return function(De,Fe,Ue,We,Ve){for(var mt=0,dt=De;mt<dt.length;mt+=1){var tt=dt[mt];if(Fe<=tt.x&&Ue<=tt.y&&We>=tt.x&&Ve>=tt.y)return!0}var pt=[new he(Fe,Ue),new he(Fe,Ve),new he(We,Ve),new he(We,Ue)];if(De.length>2){for(var at=0,gt=pt;at<gt.length;at+=1)if(Ga(De,gt[at]))return!0}for(var nt=0;nt<De.length-1;nt++)if(hl(De[nt],De[nt+1],pt))return!0;return!1}(e.cameraQueryGeometry,W-l,ne-l,ue+l,Ie+l)}),k=0,L=I;k<L.length;k+=1)y.push(L[k]);y.sort(ed);for(var O,B={},q=function(W){var ne=y[W];if(ne!==O){O=ne;var ue=_.featureIndexArray.get(ne),Ie=null;_.loadMatchingFeature(B,ue.bucketIndex,ue.sourceLayerIndex,ue.featureIndex,t,S.layers,S.availableImages,r,a,d,function(De,Fe,Ue){return Ie||(Ie=zr(De)),Fe.queryIntersectsFeature(o,De,Ue,Ie,_.z,e.transform,i,e.pixelPosMatrix)})}},$=0;$<y.length;$++)q($);return B},ka.prototype.loadMatchingFeature=function(e,r,a,d,_,S,i,t,o,l,p){var y=this.bucketLayerIDs[r];if(!S||function(De,Fe){for(var Ue=0;Ue<De.length;Ue++)if(Fe.indexOf(De[Ue])>=0)return!0;return!1}(S,y)){var v=this.sourceLayerCoder.decode(a),I=this.vtLayers[v].feature(d);if(_.needGeometry){var k=Di(I,!0);if(!_.filter(new At(this.tileID.overscaledZ),k,this.tileID.canonical))return}else if(!_.filter(new At(this.tileID.overscaledZ),I))return;for(var L=this.getId(I,v),O=0;O<y.length;O++){var B=y[O];if(!(S&&S.indexOf(B)<0)){var q=t[B];if(q){var $={};L!==void 0&&l&&($=l.getState(q.sourceLayer||"_geojsonTileLayer",L));var W=Wt({},o[B]);W.paint=yp(W.paint,q.paint,I,$,i),W.layout=yp(W.layout,q.layout,I,$,i);var ne=!p||p(I,q,$);if(ne){var ue=new yc(I,this.z,this.x,this.y,L);ue.layer=W;var Ie=e[B];Ie===void 0&&(Ie=e[B]=[]),Ie.push({featureIndex:d,feature:ue,intersectionZ:ne})}}}}}},ka.prototype.lookupSymbolFeatures=function(e,r,a,d,_,S,i,t){var o={};this.loadVTLayers();for(var l=ol(_),p=0,y=e;p<y.length;p+=1)this.loadMatchingFeature(o,a,d,y[p],l,S,i,t,r);return o},ka.prototype.hasLayer=function(e){for(var r=0,a=this.bucketLayerIDs;r<a.length;r+=1)for(var d=0,_=a[r];d<_.length;d+=1)if(e===_[d])return!0;return!1},ka.prototype.getId=function(e,r){var a=e.id;return this.promoteId&&typeof(a=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]])=="boolean"&&(a=Number(a)),a},jt("FeatureIndex",ka,{omit:["rawTileData","sourceLayerCoder"]});var zn=function(e,r){this.tileID=e,this.uid=ui(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};zn.prototype.registerFadeDuration=function(e){var r=e+this.timeAdded;r<hn.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)},zn.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},zn.prototype.loadVectorData=function(e,r,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){for(var d in e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(l,p){var y={};if(!p)return y;for(var v=function(){var L=k[I],O=L.layerIds.map(function($){return p.getLayer($)}).filter(Boolean);if(O.length!==0){L.layers=O,L.stateDependentLayerIds&&(L.stateDependentLayers=L.stateDependentLayerIds.map(function($){return O.filter(function(W){return W.id===$})[0]}));for(var B=0,q=O;B<q.length;B+=1)y[q[B].id]=L}},I=0,k=l;I<k.length;I+=1)v();return y}(e.buckets,r.style),this.hasSymbolBuckets=!1,this.buckets){var _=this.buckets[d];if(_ instanceof rr){if(this.hasSymbolBuckets=!0,!a)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var S in this.buckets){var i=this.buckets[S];if(i instanceof rr&&i.hasRTLText){this.hasRTLText=!0,Gt.isLoading()||Gt.isLoaded()||Ro()!=="deferred"||so();break}}for(var t in this.queryPadding=0,this.buckets){var o=this.buckets[t];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(t).queryRadius(o))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new c},zn.prototype.unloadVectorData=function(){for(var e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},zn.prototype.getBucket=function(e){return this.buckets[e.id]},zn.prototype.upload=function(e){for(var r in this.buckets){var a=this.buckets[r];a.uploadPending()&&a.upload(e)}var d=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new $l(e,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new $l(e,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)},zn.prototype.prepare=function(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)},zn.prototype.queryRenderedFeatures=function(e,r,a,d,_,S,i,t,o,l){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:_,scale:S,tileSize:this.tileSize,pixelPosMatrix:l,transform:t,params:i,queryPadding:this.queryPadding*o},e,r,a):{}},zn.prototype.querySourceFeatures=function(e,r){var a=this.latestFeatureIndex;if(a&&a.rawTileData){var d=a.loadVTLayers(),_=r?r.sourceLayer:"",S=d._geojsonTileLayer||d[_];if(S)for(var i=ol(r&&r.filter),t=this.tileID.canonical,o=t.z,l=t.x,p=t.y,y={z:o,x:l,y:p},v=0;v<S.length;v++){var I=S.feature(v);if(i.needGeometry){var k=Di(I,!0);if(!i.filter(new At(this.tileID.overscaledZ),k,this.tileID.canonical))continue}else if(!i.filter(new At(this.tileID.overscaledZ),I))continue;var L=a.getId(I,_),O=new yc(I,o,l,p,L);O.tile=y,e.push(O)}}},zn.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},zn.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},zn.prototype.setExpiryData=function(e){var r=this.expirationTime;if(e.cacheControl){var a=Lr(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){var d=Date.now(),_=!1;if(this.expirationTime>d)_=!1;else if(r)if(this.expirationTime<r)_=!0;else{var S=this.expirationTime-r;S?this.expirationTime=d+Math.max(S,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},zn.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},zn.prototype.setFeatureState=function(e,r){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0){var a=this.latestFeatureIndex.loadVTLayers();for(var d in this.buckets)if(r.style.hasLayer(d)){var _=this.buckets[d],S=_.layers[0].sourceLayer||"_geojsonTileLayer",i=a[S],t=e[S];if(i&&t&&Object.keys(t).length!==0){_.update(t,i,this.imageAtlas&&this.imageAtlas.patternPositions||{});var o=r&&r.style&&r.style.getLayer(d);o&&(this.queryPadding=Math.max(this.queryPadding,o.queryRadius(_)))}}}},zn.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},zn.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<hn.now()},zn.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},zn.prototype.setHoldDuration=function(e){this.symbolFadeHoldUntil=hn.now()+e},zn.prototype.setDependencies=function(e,r){for(var a={},d=0,_=r;d<_.length;d+=1)a[_[d]]=!0;this.dependencies[e]=a},zn.prototype.hasDependency=function(e,r){for(var a=0,d=e;a<d.length;a+=1){var _=this.dependencies[d[a]];if(_){for(var S=0,i=r;S<i.length;S+=1)if(_[i[S]])return!0}}return!1};var xl=re.performance,vp=function(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},xl.mark(this._marks.start)};vp.prototype.finish=function(){xl.mark(this._marks.end);var e=xl.getEntriesByName(this._marks.measure);return e.length===0&&(xl.measure(this._marks.measure,this._marks.start,this._marks.end),e=xl.getEntriesByName(this._marks.measure),xl.clearMarks(this._marks.start),xl.clearMarks(this._marks.end),xl.clearMeasures(this._marks.measure)),e},m.Actor=Hl,m.AlphaImage=Iu,m.CanonicalTileID=Jl,m.CollisionBoxArray=c,m.Color=di,m.DEMData=Xa,m.DataConstantProperty=Pt,m.DictionaryCoder=Xc,m.EXTENT=8192,m.ErrorEvent=Re,m.EvaluationParameters=At,m.Event=Te,m.Evented=Oe,m.FeatureIndex=ka,m.FillBucket=gs,m.FillExtrusionBucket=ys,m.ImageAtlas=Bc,m.ImagePosition=mh,m.LineBucket=fo,m.LngLat=Ir,m.LngLatBounds=xn,m.MercatorCoordinate=Kl,m.ONE_EM=24,m.OverscaledTileID=sn,m.Point=he,m.Point$1=he,m.Properties=b,m.Protobuf=fh,m.RGBAImage=po,m.RequestManager=pn,m.RequestPerformance=vp,m.ResourceType=zi,m.SegmentVector=ce,m.SourceFeatureState=Co,m.StructArrayLayout1ui2=Ot,m.StructArrayLayout2f1f2i16=Ke,m.StructArrayLayout2i4=V,m.StructArrayLayout3ui6=ut,m.StructArrayLayout4i8=G,m.SymbolBucket=rr,m.Texture=$l,m.Tile=zn,m.Transitionable=an,m.Uniform1f=bt,m.Uniform1i=ht,m.Uniform2f=xt,m.Uniform3f=Dt,m.Uniform4f=Yt,m.UniformColor=ti,m.UniformMatrix4f=Mi,m.UnwrappedTileID=gp,m.ValidationError=Pe,m.WritingMode=ua,m.ZoomHistory=la,m.add=function(e,r,a){return e[0]=r[0]+a[0],e[1]=r[1]+a[1],e[2]=r[2]+a[2],e},m.addDynamicAttributes=dp,m.asyncAll=function(e,r,a){if(!e.length)return a(null,[]);var d=e.length,_=new Array(e.length),S=null;e.forEach(function(i,t){r(i,function(o,l){o&&(S=o),_[t]=l,--d==0&&a(S,_)})})},m.bezier=et,m.bindAll=si,m.browser=hn,m.cacheEntryPossiblyAdded=function(e){++ur>or&&(e.getActor().send("enforceCacheSizeLimit",no),ur=0)},m.clamp=vt,m.clearTileCache=function(e){var r=re.caches.delete("mapbox-tiles");e&&r.catch(e).then(function(){return e()})},m.clipLine=pp,m.clone=function(e){var r=new ji(16);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},m.clone$1=Ki,m.clone$2=function(e){var r=new ji(3);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r},m.collisionCircleLayout=Bp,m.config=Fi,m.create=function(){var e=new ji(16);return ji!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},m.create$1=function(){var e=new ji(9);return ji!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},m.create$2=function(){var e=new ji(4);return ji!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},m.createCommonjsModule=g,m.createExpression=il,m.createLayout=z,m.createStyleLayer=function(e){return e.type==="custom"?new fp(e):new vf[e.type](e)},m.cross=function(e,r,a){var d=r[0],_=r[1],S=r[2],i=a[0],t=a[1],o=a[2];return e[0]=_*o-S*t,e[1]=S*i-d*o,e[2]=d*t-_*i,e},m.deepEqual=function e(r,a){if(Array.isArray(r)){if(!Array.isArray(a)||r.length!==a.length)return!1;for(var d=0;d<r.length;d++)if(!e(r[d],a[d]))return!1;return!0}if(typeof r=="object"&&r!==null&&a!==null){if(typeof a!="object"||Object.keys(r).length!==Object.keys(a).length)return!1;for(var _ in r)if(!e(r[_],a[_]))return!1;return!0}return r===a},m.dot=function(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]},m.dot$1=function(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]+e[3]*r[3]},m.ease=St,m.emitValidationErrors=Ls,m.endsWith=Wi,m.enforceCacheSizeLimit=function(e){Mn(),Tn&&Tn.then(function(r){r.keys().then(function(a){for(var d=0;d<a.length-e;d++)r.delete(a[d])})})},m.evaluateSizeForFeature=lp,m.evaluateSizeForZoom=up,m.evaluateVariableOffset=qc,m.evented=Tu,m.extend=Wt,m.featureFilter=ol,m.filterObject=Zi,m.fromRotation=function(e,r){var a=Math.sin(r),d=Math.cos(r);return e[0]=d,e[1]=a,e[2]=0,e[3]=-a,e[4]=d,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},m.getAnchorAlignment=Mu,m.getAnchorJustification=xh,m.getArrayBuffer=Wn,m.getImage=te,m.getJSON=function(e,r){return Mo(Wt(e,{type:"json"}),r)},m.getRTLTextPluginStatus=Ro,m.getReferrer=Kr,m.getVideo=function(e,r){var a,d,_=re.document.createElement("video");_.muted=!0,_.onloadstart=function(){r(null,_)};for(var S=0;S<e.length;S++){var i=re.document.createElement("source");a=e[S],d=void 0,(d=re.document.createElement("a")).href=a,(d.protocol!==re.document.location.protocol||d.host!==re.document.location.host)&&(_.crossOrigin="Anonymous"),i.src=e[S],_.appendChild(i)}return{cancel:function(){}}},m.identity=ho,m.invert=function(e,r){var a=r[0],d=r[1],_=r[2],S=r[3],i=r[4],t=r[5],o=r[6],l=r[7],p=r[8],y=r[9],v=r[10],I=r[11],k=r[12],L=r[13],O=r[14],B=r[15],q=a*t-d*i,$=a*o-_*i,W=a*l-S*i,ne=d*o-_*t,ue=d*l-S*t,Ie=_*l-S*o,De=p*L-y*k,Fe=p*O-v*k,Ue=p*B-I*k,We=y*O-v*L,Ve=y*B-I*L,mt=v*B-I*O,dt=q*mt-$*Ve+W*We+ne*Ue-ue*Fe+Ie*De;return dt?(e[0]=(t*mt-o*Ve+l*We)*(dt=1/dt),e[1]=(_*Ve-d*mt-S*We)*dt,e[2]=(L*Ie-O*ue+B*ne)*dt,e[3]=(v*ue-y*Ie-I*ne)*dt,e[4]=(o*Ue-i*mt-l*Fe)*dt,e[5]=(a*mt-_*Ue+S*Fe)*dt,e[6]=(O*W-k*Ie-B*$)*dt,e[7]=(p*Ie-v*W+I*$)*dt,e[8]=(i*Ve-t*Ue+l*De)*dt,e[9]=(d*Ue-a*Ve-S*De)*dt,e[10]=(k*ue-L*W+B*q)*dt,e[11]=(y*W-p*ue-I*q)*dt,e[12]=(t*Fe-i*We-o*De)*dt,e[13]=(a*We-d*Fe+_*De)*dt,e[14]=(L*$-k*ne-O*q)*dt,e[15]=(p*ne-y*$+v*q)*dt,e):null},m.isChar=Ct,m.isMapboxURL=Sn,m.keysDifference=function(e,r){var a=[];for(var d in e)d in r||a.push(d);return a},m.makeRequest=Mo,m.mapObject=Gi,m.mercatorXfromLng=mp,m.mercatorYfromLat=en,m.mercatorZfromAltitude=Wl,m.mul=Nl,m.multiply=Io,m.mvt=ac,m.nextPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},m.normalize=function(e,r){var a=r[0],d=r[1],_=r[2],S=a*a+d*d+_*_;return S>0&&(S=1/Math.sqrt(S)),e[0]=r[0]*S,e[1]=r[1]*S,e[2]=r[2]*S,e},m.number=Or,m.offscreenCanvasSupported=kt,m.ortho=function(e,r,a,d,_,S,i){var t=1/(r-a),o=1/(d-_),l=1/(S-i);return e[0]=-2*t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(r+a)*t,e[13]=(_+d)*o,e[14]=(i+S)*l,e[15]=1,e},m.parseGlyphPBF=function(e){return new fh(e).readFields(of,[])},m.pbf=fh,m.performSymbolLayout=function(e,r,a,d,_,S,i){e.createArrays(),e.tilePixelRatio=8192/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;var t=e.layers[0].layout,o=e.layers[0]._unevaluatedLayout._values,l={};if(e.textSizeData.kind==="composite"){var p=e.textSizeData,y=p.maxZoom;l.compositeTextSizes=[o["text-size"].possiblyEvaluate(new At(p.minZoom),i),o["text-size"].possiblyEvaluate(new At(y),i)]}if(e.iconSizeData.kind==="composite"){var v=e.iconSizeData,I=v.maxZoom;l.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new At(v.minZoom),i),o["icon-size"].possiblyEvaluate(new At(I),i)]}l.layoutTextSize=o["text-size"].possiblyEvaluate(new At(e.zoom+1),i),l.layoutIconSize=o["icon-size"].possiblyEvaluate(new At(e.zoom+1),i),l.textMaxSize=o["text-size"].possiblyEvaluate(new At(18));for(var k=24*t.get("text-line-height"),L=t.get("text-rotation-alignment")==="map"&&t.get("symbol-placement")!=="point",O=t.get("text-keep-upright"),B=t.get("text-size"),q=function(){var ne=W[$],ue=t.get("text-font").evaluate(ne,{},i).join(","),Ie=B.evaluate(ne,{},i),De=l.layoutTextSize.evaluate(ne,{},i),Fe=l.layoutIconSize.evaluate(ne,{},i),Ue={horizontal:{},vertical:void 0},We=ne.text,Ve=[0,0];if(We){var mt=We.toString(),dt=24*t.get("text-letter-spacing").evaluate(ne,{},i),tt=function(mi){for(var bi=0,Ai=mi;bi<Ai.length;bi+=1)if(vi=Ai[bi].charCodeAt(0),Ct.Arabic(vi)||Ct["Arabic Supplement"](vi)||Ct["Arabic Extended-A"](vi)||Ct["Arabic Presentation Forms-A"](vi)||Ct["Arabic Presentation Forms-B"](vi))return!1;var vi;return!0}(mt)?dt:0,pt=t.get("text-anchor").evaluate(ne,{},i),at=t.get("text-variable-anchor");if(!at){var gt=t.get("text-radial-offset").evaluate(ne,{},i);Ve=gt?qc(pt,[24*gt,vh]):t.get("text-offset").evaluate(ne,{},i).map(function(mi){return 24*mi})}var nt=L?"center":t.get("text-justify").evaluate(ne,{},i),lt=t.get("symbol-placement"),Ft=lt==="point"?24*t.get("text-max-width").evaluate(ne,{},i):0,Bt=function(){e.allowVerticalPlacement&&sl(mt)&&(Ue.vertical=Oc(We,r,a,_,ue,Ft,k,pt,"left",tt,Ve,ua.vertical,!0,lt,De,Ie))};if(!L&&at){for(var ai=nt==="auto"?at.map(function(mi){return xh(mi)}):[nt],hi=!1,Ti=0;Ti<ai.length;Ti++){var Li=ai[Ti];if(!Ue.horizontal[Li])if(hi)Ue.horizontal[Li]=Ue.horizontal[0];else{var $i=Oc(We,r,a,_,ue,Ft,k,"center",Li,tt,Ve,ua.horizontal,!1,lt,De,Ie);$i&&(Ue.horizontal[Li]=$i,hi=$i.positionedLines.length===1)}}Bt()}else{nt==="auto"&&(nt=xh(pt));var Hi=Oc(We,r,a,_,ue,Ft,k,pt,nt,tt,Ve,ua.horizontal,!1,lt,De,Ie);Hi&&(Ue.horizontal[nt]=Hi),Bt(),sl(mt)&&L&&O&&(Ue.vertical=Oc(We,r,a,_,ue,Ft,k,pt,nt,tt,Ve,ua.vertical,!1,lt,De,Ie))}}var Ui=void 0,Qi=!1;if(ne.icon&&ne.icon.name){var Vi=d[ne.icon.name];Vi&&(Ui=function(mi,bi,Ai){var vi=Mu(Ai),yr=bi[0]-mi.displaySize[0]*vi.horizontalAlign,dr=bi[1]-mi.displaySize[1]*vi.verticalAlign;return{image:mi,top:dr,bottom:dr+mi.displaySize[1],left:yr,right:yr+mi.displaySize[0]}}(_[ne.icon.name],t.get("icon-offset").evaluate(ne,{},i),t.get("icon-anchor").evaluate(ne,{},i)),Qi=Vi.sdf,e.sdfIcons===void 0?e.sdfIcons=Vi.sdf:e.sdfIcons!==Vi.sdf&&Oi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Vi.pixelRatio!==e.pixelRatio||t.get("icon-rotate").constantOr(1)!==0)&&(e.iconsNeedLinear=!0))}var er=Zc(Ue.horizontal)||Ue.vertical;e.iconsInText=!!er&&er.iconsInText,(er||Ui)&&function(mi,bi,Ai,vi,yr,dr,Bi,Pi,Yi,Ht,bn){var br=dr.textMaxSize.evaluate(bi,{});br===void 0&&(br=Bi);var Zr,nr=mi.layers[0].layout,$n=nr.get("icon-offset").evaluate(bi,{},bn),Pn=Zc(Ai.horizontal),ca=Bi/24,mo=mi.tilePixelRatio*ca,go=mi.tilePixelRatio*br/24,wn=mi.tilePixelRatio*Pi,ha=mi.tilePixelRatio*nr.get("symbol-spacing"),Yl=nr.get("text-padding")*mi.tilePixelRatio,Fu=nr.get("icon-padding")*mi.tilePixelRatio,Uu=nr.get("text-max-angle")/180*Math.PI,_c=nr.get("text-rotation-alignment")==="map"&&nr.get("symbol-placement")!=="point",$a=nr.get("icon-rotation-alignment")==="map"&&nr.get("symbol-placement")!=="point",Ns=nr.get("symbol-placement"),Vu=ha/2,Ql=nr.get("icon-text-fit");vi&&Ql!=="none"&&(mi.allowVerticalPlacement&&Ai.vertical&&(Zr=Fc(vi,Ai.vertical,Ql,nr.get("icon-text-fit-padding"),$n,ca)),Pn&&(vi=Fc(vi,Pn,Ql,nr.get("icon-text-fit-padding"),$n,ca)));var bl=function(Iy,xp){xp.x<0||xp.x>=8192||xp.y<0||xp.y>=8192||function(En,El,Cy,bc,Ef,bm,td,eu,id,bp,rd,nd,Sf,wm,wp,Em,Sm,Tm,Am,Im,Wa,od,Cm,tu,zy){var zm,Jc,kh,Mh,Lh,Dh=En.addToLineVertexArray(El,Cy),Pm=0,km=0,Mm=0,Lm=0,Tf=-1,Af=-1,qu={},Dm=xe(""),If=0,Cf=0;if(eu._unevaluatedLayout.getValue("text-radial-offset")===void 0?(If=(zm=eu.layout.get("text-offset").evaluate(Wa,{},tu).map(function(Sp){return 24*Sp}))[0],Cf=zm[1]):(If=24*eu.layout.get("text-radial-offset").evaluate(Wa,{},tu),Cf=vh),En.allowVerticalPlacement&&bc.vertical){var Rm=eu.layout.get("text-rotate").evaluate(Wa,{},tu)+90;Mh=new jc(id,El,bp,rd,nd,bc.vertical,Sf,wm,wp,Rm),td&&(Lh=new jc(id,El,bp,rd,nd,td,Sm,Tm,wp,Rm))}if(Ef){var zf=eu.layout.get("icon-rotate").evaluate(Wa,{}),Bm=eu.layout.get("icon-text-fit")!=="none",Om=Us(Ef,zf,Cm,Bm),Pf=td?Us(td,zf,Cm,Bm):void 0;kh=new jc(id,El,bp,rd,nd,Ef,Sm,Tm,!1,zf),Pm=4*Om.length;var Fm=En.iconSizeData,Ep=null;Fm.kind==="source"?(Ep=[128*eu.layout.get("icon-size").evaluate(Wa,{})])[0]>32640&&Oi(En.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):Fm.kind==="composite"&&((Ep=[128*od.compositeIconSizes[0].evaluate(Wa,{},tu),128*od.compositeIconSizes[1].evaluate(Wa,{},tu)])[0]>32640||Ep[1]>32640)&&Oi(En.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),En.addSymbols(En.icon,Om,Ep,Im,Am,Wa,!1,El,Dh.lineStartIndex,Dh.lineLength,-1,tu),Tf=En.icon.placedSymbolArray.length-1,Pf&&(km=4*Pf.length,En.addSymbols(En.icon,Pf,Ep,Im,Am,Wa,ua.vertical,El,Dh.lineStartIndex,Dh.lineLength,-1,tu),Af=En.icon.placedSymbolArray.length-1)}for(var Um in bc.horizontal){var ad=bc.horizontal[Um];if(!Jc){Dm=xe(ad.text);var Py=eu.layout.get("text-rotate").evaluate(Wa,{},tu);Jc=new jc(id,El,bp,rd,nd,ad,Sf,wm,wp,Py)}var Vm=ad.positionedLines.length===1;if(Mm+=Gc(En,El,ad,bm,eu,wp,Wa,Em,Dh,bc.vertical?ua.horizontal:ua.horizontalOnly,Vm?Object.keys(bc.horizontal):[Um],qu,Tf,od,tu),Vm)break}bc.vertical&&(Lm+=Gc(En,El,bc.vertical,bm,eu,wp,Wa,Em,Dh,ua.vertical,["vertical"],qu,Af,od,tu));var ky=Jc?Jc.boxStartIndex:En.collisionBoxArray.length,My=Jc?Jc.boxEndIndex:En.collisionBoxArray.length,Ly=Mh?Mh.boxStartIndex:En.collisionBoxArray.length,Dy=Mh?Mh.boxEndIndex:En.collisionBoxArray.length,Ry=kh?kh.boxStartIndex:En.collisionBoxArray.length,By=kh?kh.boxEndIndex:En.collisionBoxArray.length,Oy=Lh?Lh.boxStartIndex:En.collisionBoxArray.length,Fy=Lh?Lh.boxEndIndex:En.collisionBoxArray.length,iu=-1,sd=function(Sp,jm){return Sp&&Sp.circleDiameter?Math.max(Sp.circleDiameter,jm):jm};iu=sd(Jc,iu),iu=sd(Mh,iu),iu=sd(kh,iu);var Nm=(iu=sd(Lh,iu))>-1?1:0;Nm&&(iu*=zy/24),En.glyphOffsetArray.length>=rr.MAX_GLYPHS&&Oi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Wa.sortKey!==void 0&&En.addToSortKeyRanges(En.symbolInstances.length,Wa.sortKey),En.symbolInstances.emplaceBack(El.x,El.y,qu.right>=0?qu.right:-1,qu.center>=0?qu.center:-1,qu.left>=0?qu.left:-1,qu.vertical||-1,Tf,Af,Dm,ky,My,Ly,Dy,Ry,By,Oy,Fy,bp,Mm,Lm,Pm,km,Nm,0,Sf,If,Cf,iu)}(mi,xp,Iy,Ai,vi,yr,Zr,mi.layers[0],mi.collisionBoxArray,bi.index,bi.sourceLayerIndex,mi.index,mo,Yl,_c,Yi,wn,Fu,$a,$n,bi,dr,Ht,bn,Bi)};if(Ns==="line")for(var vc=0,Ch=pp(bi.geometry,0,0,8192,8192);vc<Ch.length;vc+=1)for(var zh=Ch[vc],$c=0,Hc=cf(zh,ha,Uu,Ai.vertical||Pn,vi,24,go,mi.overscaling,8192);$c<Hc.length;$c+=1){var Ph=Hc[$c];Pn&&bh(mi,Pn.text,Vu,Ph)||bl(zh,Ph)}else if(Ns==="line-center")for(var Wc=0,Kc=bi.geometry;Wc<Kc.length;Wc+=1){var Xo=Kc[Wc];if(Xo.length>1){var Nu=uf(Xo,Uu,Ai.vertical||Pn,vi,24,go);Nu&&bl(Xo,Nu)}}else if(bi.type==="Polygon")for(var ju=0,yo=ph(bi.geometry,0);ju<yo.length;ju+=1){var $o=yo[ju],wl=pf($o,16);bl($o[0],new _l(wl.x,wl.y,0))}else if(bi.type==="LineString")for(var _s=0,xc=bi.geometry;_s<xc.length;_s+=1){var Ha=xc[_s];bl(Ha,new _l(Ha[0].x,Ha[0].y,0))}else if(bi.type==="Point")for(var xf=0,vm=bi.geometry;xf<vm.length;xf+=1)for(var bf=0,xm=vm[xf];bf<xm.length;bf+=1){var wf=xm[bf];bl([wf],new _l(wf.x,wf.y,0))}}(e,ne,Ue,Ui,d,l,De,Fe,Ve,Qi,i)},$=0,W=e.features;$<W.length;$+=1)q();S&&e.generateCollisionDebugBuffers()},m.perspective=function(e,r,a,d,_){var S,i=1/Math.tan(r/2);return e[0]=i/a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,_!=null&&_!==1/0?(e[10]=(_+d)*(S=1/(d-_)),e[14]=2*_*d*S):(e[10]=-1,e[14]=-2*d),e},m.pick=function(e,r){for(var a={},d=0;d<r.length;d++){var _=r[d];_ in e&&(a[_]=e[_])}return a},m.plugin=Gt,m.polygonIntersectsPolygon=Bo,m.postMapLoadEvent=Vo,m.postTurnstileEvent=st,m.potpack=Xp,m.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],m.register=jt,m.registerForPluginStateChange=function(e){return e({pluginStatus:Rn,pluginURL:Go}),Tu.on("pluginStateChange",e),e},m.renderColorRamp=hh,m.rotate=function(e,r,a){var d=r[0],_=r[1],S=r[2],i=r[3],t=Math.sin(a),o=Math.cos(a);return e[0]=d*o+S*t,e[1]=_*o+i*t,e[2]=d*-t+S*o,e[3]=_*-t+i*o,e},m.rotateX=function(e,r,a){var d=Math.sin(a),_=Math.cos(a),S=r[4],i=r[5],t=r[6],o=r[7],l=r[8],p=r[9],y=r[10],v=r[11];return r!==e&&(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[4]=S*_+l*d,e[5]=i*_+p*d,e[6]=t*_+y*d,e[7]=o*_+v*d,e[8]=l*_-S*d,e[9]=p*_-i*d,e[10]=y*_-t*d,e[11]=v*_-o*d,e},m.rotateZ=function(e,r,a){var d=Math.sin(a),_=Math.cos(a),S=r[0],i=r[1],t=r[2],o=r[3],l=r[4],p=r[5],y=r[6],v=r[7];return r!==e&&(e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=S*_+l*d,e[1]=i*_+p*d,e[2]=t*_+y*d,e[3]=o*_+v*d,e[4]=l*_-S*d,e[5]=p*_-i*d,e[6]=y*_-t*d,e[7]=v*_-o*d,e},m.scale=function(e,r,a){var d=a[0],_=a[1],S=a[2];return e[0]=r[0]*d,e[1]=r[1]*d,e[2]=r[2]*d,e[3]=r[3]*d,e[4]=r[4]*_,e[5]=r[5]*_,e[6]=r[6]*_,e[7]=r[7]*_,e[8]=r[8]*S,e[9]=r[9]*S,e[10]=r[10]*S,e[11]=r[11]*S,e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},m.scale$1=function(e,r,a){return e[0]=r[0]*a,e[1]=r[1]*a,e[2]=r[2]*a,e[3]=r[3]*a,e},m.scale$2=function(e,r,a){return e[0]=r[0]*a,e[1]=r[1]*a,e[2]=r[2]*a,e},m.setCacheLimits=function(e,r){no=e,or=r},m.setRTLTextPlugin=function(e,r,a){if(a===void 0&&(a=!1),Rn==="deferred"||Rn==="loading"||Rn==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Go=hn.resolveURL(e),Rn="deferred",ps=r,Bs(),a||so()},m.sphericalToCartesian=function(e){var r=e[0],a=e[1],d=e[2];return a+=90,a*=Math.PI/180,d*=Math.PI/180,{x:r*Math.cos(a)*Math.sin(d),y:r*Math.sin(a)*Math.sin(d),z:r*Math.cos(d)}},m.sqrLen=function(e){var r=e[0],a=e[1];return r*r+a*a},m.styleSpec=fe,m.sub=function(e,r,a){return e[0]=r[0]-a[0],e[1]=r[1]-a[1],e[2]=r[2]-a[2],e},m.symbolSize=lf,m.transformMat3=function(e,r,a){var d=r[0],_=r[1],S=r[2];return e[0]=d*a[0]+_*a[3]+S*a[6],e[1]=d*a[1]+_*a[4]+S*a[7],e[2]=d*a[2]+_*a[5]+S*a[8],e},m.transformMat4=jl,m.translate=function(e,r,a){var d,_,S,i,t,o,l,p,y,v,I,k,L=a[0],O=a[1],B=a[2];return r===e?(e[12]=r[0]*L+r[4]*O+r[8]*B+r[12],e[13]=r[1]*L+r[5]*O+r[9]*B+r[13],e[14]=r[2]*L+r[6]*O+r[10]*B+r[14],e[15]=r[3]*L+r[7]*O+r[11]*B+r[15]):(_=r[1],S=r[2],i=r[3],t=r[4],o=r[5],l=r[6],p=r[7],y=r[8],v=r[9],I=r[10],k=r[11],e[0]=d=r[0],e[1]=_,e[2]=S,e[3]=i,e[4]=t,e[5]=o,e[6]=l,e[7]=p,e[8]=y,e[9]=v,e[10]=I,e[11]=k,e[12]=d*L+t*O+y*B+r[12],e[13]=_*L+o*O+v*B+r[13],e[14]=S*L+l*O+I*B+r[14],e[15]=i*L+p*O+k*B+r[15]),e},m.triggerPluginCompletionEvent=Su,m.uniqueId=ui,m.validateCustomStyleLayer=function(e){var r=[],a=e.id;return a===void 0&&r.push({message:"layers."+a+': missing required property "id"'}),e.render===void 0&&r.push({message:"layers."+a+': missing required method "render"'}),e.renderingMode&&e.renderingMode!=="2d"&&e.renderingMode!=="3d"&&r.push({message:"layers."+a+': property "renderingMode" must be either "2d" or "3d"'}),r},m.validateLight=al,m.validateStyle=qo,m.values=function(e){var r=[];for(var a in e)r.push(e[a]);return r},m.vectorTile=ac,m.version="1.13.2",m.warnOnce=Oi,m.webpSupported=Ut,m.window=re,m.wrap=Xt}),H(["./shared"],function(m){function g(J){var te=typeof J;if(te==="number"||te==="boolean"||te==="string"||J==null)return JSON.stringify(J);if(Array.isArray(J)){for(var oe="[",me=0,Te=J;me<Te.length;me+=1)oe+=g(Te[me])+",";return oe+"]"}for(var Re=Object.keys(J).sort(),Oe="{",fe=0;fe<Re.length;fe++)Oe+=JSON.stringify(Re[fe])+":"+g(J[Re[fe]])+",";return Oe+"}"}function Z(J){for(var te="",oe=0,me=m.refProperties;oe<me.length;oe+=1)te+="/"+g(J[me[oe]]);return te}var ve=function(J){this.keyCache={},J&&this.replace(J)};ve.prototype.replace=function(J){this._layerConfigs={},this._layers={},this.update(J,[])},ve.prototype.update=function(J,te){for(var oe=this,me=0,Te=J;me<Te.length;me+=1){var Re=Te[me];this._layerConfigs[Re.id]=Re;var Oe=this._layers[Re.id]=m.createStyleLayer(Re);Oe._featureFilter=m.featureFilter(Oe.filter),this.keyCache[Re.id]&&delete this.keyCache[Re.id]}for(var fe=0,Pe=te;fe<Pe.length;fe+=1){var Xe=Pe[fe];delete this.keyCache[Xe],delete this._layerConfigs[Xe],delete this._layers[Xe]}this.familiesBySource={};for(var ie=0,N=function(we,Se){for(var $e={},je=0;je<we.length;je++){var He=Se&&Se[we[je].id]||Z(we[je]);Se&&(Se[we[je].id]=He);var Tt=$e[He];Tt||(Tt=$e[He]=[]),Tt.push(we[je])}var ft=[];for(var wt in $e)ft.push($e[wt]);return ft}(m.values(this._layerConfigs),this.keyCache);ie<N.length;ie+=1){var j=N[ie].map(function(we){return oe._layers[we.id]}),ee=j[0];if(ee.visibility!=="none"){var se=ee.source||"",ge=this.familiesBySource[se];ge||(ge=this.familiesBySource[se]={});var pe=ee.sourceLayer||"_geojsonTileLayer",Ee=ge[pe];Ee||(Ee=ge[pe]=[]),Ee.push(j)}}};var he=function(J){var te={},oe=[];for(var me in J){var Te=J[me],Re=te[me]={};for(var Oe in Te){var fe=Te[+Oe];if(fe&&fe.bitmap.width!==0&&fe.bitmap.height!==0){var Pe={x:0,y:0,w:fe.bitmap.width+2,h:fe.bitmap.height+2};oe.push(Pe),Re[Oe]={rect:Pe,metrics:fe.metrics}}}}var Xe=m.potpack(oe),ie=new m.AlphaImage({width:Xe.w||1,height:Xe.h||1});for(var N in J){var j=J[N];for(var ee in j){var se=j[+ee];if(se&&se.bitmap.width!==0&&se.bitmap.height!==0){var ge=te[N][ee].rect;m.AlphaImage.copy(se.bitmap,ie,{x:0,y:0},{x:ge.x+1,y:ge.y+1},se.bitmap)}}}this.image=ie,this.positions=te};m.register("GlyphAtlas",he);var ye=function(J){this.tileID=new m.OverscaledTileID(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),this.uid=J.uid,this.zoom=J.zoom,this.pixelRatio=J.pixelRatio,this.tileSize=J.tileSize,this.source=J.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=J.showCollisionBoxes,this.collectResourceTiming=!!J.collectResourceTiming,this.returnDependencies=!!J.returnDependencies,this.promoteId=J.promoteId};function re(J,te,oe){for(var me=new m.EvaluationParameters(te),Te=0,Re=J;Te<Re.length;Te+=1)Re[Te].recalculate(me,oe)}function it(J,te){var oe=m.getArrayBuffer(J.request,function(me,Te,Re,Oe){me?te(me):Te&&te(null,{vectorTile:new m.vectorTile.VectorTile(new m.pbf(Te)),rawData:Te,cacheControl:Re,expires:Oe})});return function(){oe.cancel(),te()}}ye.prototype.parse=function(J,te,oe,me,Te){var Re=this;this.status="parsing",this.data=J,this.collisionBoxArray=new m.CollisionBoxArray;var Oe=new m.DictionaryCoder(Object.keys(J.layers).sort()),fe=new m.FeatureIndex(this.tileID,this.promoteId);fe.bucketLayerIDs=[];var Pe,Xe,ie,N,j={},ee={featureIndex:fe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:oe},se=te.familiesBySource[this.source];for(var ge in se){var pe=J.layers[ge];if(pe){pe.version===1&&m.warnOnce('Vector tile source "'+this.source+'" layer "'+ge+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Ee=Oe.encode(ge),we=[],Se=0;Se<pe.length;Se++){var $e=pe.feature(Se),je=fe.getId($e,ge);we.push({feature:$e,id:je,index:Se,sourceLayerIndex:Ee})}for(var He=0,Tt=se[ge];He<Tt.length;He+=1){var ft=Tt[He],wt=ft[0];wt.minzoom&&this.zoom<Math.floor(wt.minzoom)||wt.maxzoom&&this.zoom>=wt.maxzoom||wt.visibility!=="none"&&(re(ft,this.zoom,oe),(j[wt.id]=wt.createBucket({index:fe.bucketLayerIDs.length,layers:ft,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ee,sourceID:this.source})).populate(we,ee,this.tileID.canonical),fe.bucketLayerIDs.push(ft.map(function($t){return $t.id})))}}}var It=m.mapObject(ee.glyphDependencies,function($t){return Object.keys($t).map(Number)});Object.keys(It).length?me.send("getGlyphs",{uid:this.uid,stacks:It},function($t,Mt){Pe||(Pe=$t,Xe=Mt,ni.call(Re))}):Xe={};var xi=Object.keys(ee.iconDependencies);xi.length?me.send("getImages",{icons:xi,source:this.source,tileID:this.tileID,type:"icons"},function($t,Mt){Pe||(Pe=$t,ie=Mt,ni.call(Re))}):ie={};var Qt=Object.keys(ee.patternDependencies);function ni(){if(Pe)return Te(Pe);if(Xe&&ie&&N){var $t=new he(Xe),Mt=new m.ImageAtlas(ie,N);for(var di in j){var qi=j[di];qi instanceof m.SymbolBucket?(re(qi.layers,this.zoom,oe),m.performSymbolLayout(qi,Xe,$t.positions,ie,Mt.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):qi.hasPattern&&(qi instanceof m.LineBucket||qi instanceof m.FillBucket||qi instanceof m.FillExtrusionBucket)&&(re(qi.layers,this.zoom,oe),qi.addFeatures(ee,this.tileID.canonical,Mt.patternPositions))}this.status="done",Te(null,{buckets:m.values(j).filter(function(jr){return!jr.isEmpty()}),featureIndex:fe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:$t.image,imageAtlas:Mt,glyphMap:this.returnDependencies?Xe:null,iconMap:this.returnDependencies?ie:null,glyphPositions:this.returnDependencies?$t.positions:null})}}Qt.length?me.send("getImages",{icons:Qt,source:this.source,tileID:this.tileID,type:"patterns"},function($t,Mt){Pe||(Pe=$t,N=Mt,ni.call(Re))}):N={},ni.call(this)};var et=function(J,te,oe,me){this.actor=J,this.layerIndex=te,this.availableImages=oe,this.loadVectorData=me||it,this.loading={},this.loaded={}};et.prototype.loadTile=function(J,te){var oe=this,me=J.uid;this.loading||(this.loading={});var Te=!!(J&&J.request&&J.request.collectResourceTiming)&&new m.RequestPerformance(J.request),Re=this.loading[me]=new ye(J);Re.abort=this.loadVectorData(J,function(Oe,fe){if(delete oe.loading[me],Oe||!fe)return Re.status="done",oe.loaded[me]=Re,te(Oe);var Pe=fe.rawData,Xe={};fe.expires&&(Xe.expires=fe.expires),fe.cacheControl&&(Xe.cacheControl=fe.cacheControl);var ie={};if(Te){var N=Te.finish();N&&(ie.resourceTiming=JSON.parse(JSON.stringify(N)))}Re.vectorTile=fe.vectorTile,Re.parse(fe.vectorTile,oe.layerIndex,oe.availableImages,oe.actor,function(j,ee){if(j||!ee)return te(j);te(null,m.extend({rawTileData:Pe.slice(0)},ee,Xe,ie))}),oe.loaded=oe.loaded||{},oe.loaded[me]=Re})},et.prototype.reloadTile=function(J,te){var oe=this,me=this.loaded,Te=J.uid,Re=this;if(me&&me[Te]){var Oe=me[Te];Oe.showCollisionBoxes=J.showCollisionBoxes;var fe=function(Pe,Xe){var ie=Oe.reloadCallback;ie&&(delete Oe.reloadCallback,Oe.parse(Oe.vectorTile,Re.layerIndex,oe.availableImages,Re.actor,ie)),te(Pe,Xe)};Oe.status==="parsing"?Oe.reloadCallback=fe:Oe.status==="done"&&(Oe.vectorTile?Oe.parse(Oe.vectorTile,this.layerIndex,this.availableImages,this.actor,fe):fe())}},et.prototype.abortTile=function(J,te){var oe=this.loading,me=J.uid;oe&&oe[me]&&oe[me].abort&&(oe[me].abort(),delete oe[me]),te()},et.prototype.removeTile=function(J,te){var oe=this.loaded,me=J.uid;oe&&oe[me]&&delete oe[me],te()};var St=m.window.ImageBitmap,vt=function(){this.loaded={}};function Xt(J,te){if(J.length!==0){Wt(J[0],te);for(var oe=1;oe<J.length;oe++)Wt(J[oe],!te)}}function Wt(J,te){for(var oe=0,me=0,Te=J.length,Re=Te-1;me<Te;Re=me++)oe+=(J[me][0]-J[Re][0])*(J[Re][1]+J[me][1]);oe>=0!=!!te&&J.reverse()}vt.prototype.loadTile=function(J,te){var oe=J.uid,me=J.encoding,Te=J.rawImageData,Re=St&&Te instanceof St?this.getImageData(Te):Te,Oe=new m.DEMData(oe,Re,me);this.loaded=this.loaded||{},this.loaded[oe]=Oe,te(null,Oe)},vt.prototype.getImageData=function(J){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(J.width,J.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=J.width,this.offscreenCanvas.height=J.height,this.offscreenCanvasContext.drawImage(J,0,0,J.width,J.height);var te=this.offscreenCanvasContext.getImageData(-1,-1,J.width+2,J.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new m.RGBAImage({width:te.width,height:te.height},te.data)},vt.prototype.removeTile=function(J){var te=this.loaded,oe=J.uid;te&&te[oe]&&delete te[oe]};var _t=m.vectorTile.VectorTileFeature.prototype.toGeoJSON,ui=function(J){this._feature=J,this.extent=m.EXTENT,this.type=J.type,this.properties=J.tags,"id"in J&&!isNaN(J.id)&&(this.id=parseInt(J.id,10))};ui.prototype.loadGeometry=function(){if(this._feature.type===1){for(var J=[],te=0,oe=this._feature.geometry;te<oe.length;te+=1){var me=oe[te];J.push([new m.Point$1(me[0],me[1])])}return J}for(var Te=[],Re=0,Oe=this._feature.geometry;Re<Oe.length;Re+=1){for(var fe=[],Pe=0,Xe=Oe[Re];Pe<Xe.length;Pe+=1){var ie=Xe[Pe];fe.push(new m.Point$1(ie[0],ie[1]))}Te.push(fe)}return Te},ui.prototype.toGeoJSON=function(J,te,oe){return _t.call(this,J,te,oe)};var qt=function(J){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.EXTENT,this.length=J.length,this._features=J};qt.prototype.feature=function(J){return new ui(this._features[J])};var Zt=m.vectorTile.VectorTileFeature,si=Wi;function Wi(J,te){this.options=te||{},this.features=J,this.length=J.length}function Gi(J,te){this.id=typeof J.id=="number"?J.id:void 0,this.type=J.type,this.rawGeometry=J.type===1?[J.geometry]:J.geometry,this.properties=J.tags,this.extent=te||4096}Wi.prototype.feature=function(J){return new Gi(this.features[J],this.options.extent)},Gi.prototype.loadGeometry=function(){var J=this.rawGeometry;this.geometry=[];for(var te=0;te<J.length;te++){for(var oe=J[te],me=[],Te=0;Te<oe.length;Te++)me.push(new m.Point$1(oe[Te][0],oe[Te][1]));this.geometry.push(me)}return this.geometry},Gi.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var J=this.geometry,te=1/0,oe=-1/0,me=1/0,Te=-1/0,Re=0;Re<J.length;Re++)for(var Oe=J[Re],fe=0;fe<Oe.length;fe++){var Pe=Oe[fe];te=Math.min(te,Pe.x),oe=Math.max(oe,Pe.x),me=Math.min(me,Pe.y),Te=Math.max(Te,Pe.y)}return[te,me,oe,Te]},Gi.prototype.toGeoJSON=Zt.prototype.toGeoJSON;var Zi=Mr,Ki=si;function Mr(J){var te=new m.pbf;return function(oe,me){for(var Te in oe.layers)me.writeMessage(3,Oi,oe.layers[Te])}(J,te),te.finish()}function Oi(J,te){var oe;te.writeVarintField(15,J.version||1),te.writeStringField(1,J.name||""),te.writeVarintField(5,J.extent||4096);var me={keys:[],values:[],keycache:{},valuecache:{}};for(oe=0;oe<J.length;oe++)me.feature=J.feature(oe),te.writeMessage(2,hr,me);var Te=me.keys;for(oe=0;oe<Te.length;oe++)te.writeStringField(3,Te[oe]);var Re=me.values;for(oe=0;oe<Re.length;oe++)te.writeMessage(4,Fn,Re[oe])}function hr(J,te){var oe=J.feature;oe.id!==void 0&&te.writeVarintField(1,oe.id),te.writeMessage(2,eo,J),te.writeVarintField(3,oe.type),te.writeMessage(4,un,oe)}function eo(J,te){var oe=J.feature,me=J.keys,Te=J.values,Re=J.keycache,Oe=J.valuecache;for(var fe in oe.properties){var Pe=Re[fe];Pe===void 0&&(me.push(fe),Re[fe]=Pe=me.length-1),te.writeVarint(Pe);var Xe=oe.properties[fe],ie=typeof Xe;ie!=="string"&&ie!=="boolean"&&ie!=="number"&&(Xe=JSON.stringify(Xe));var N=ie+":"+Xe,j=Oe[N];j===void 0&&(Te.push(Xe),Oe[N]=j=Te.length-1),te.writeVarint(j)}}function ii(J,te){return(te<<3)+(7&J)}function Lr(J){return J<<1^J>>31}function un(J,te){for(var oe=J.loadGeometry(),me=J.type,Te=0,Re=0,Oe=oe.length,fe=0;fe<Oe;fe++){var Pe=oe[fe],Xe=1;me===1&&(Xe=Pe.length),te.writeVarint(ii(1,Xe));for(var ie=me===3?Pe.length-1:Pe.length,N=0;N<ie;N++){N===1&&me!==1&&te.writeVarint(ii(2,ie-1));var j=Pe[N].x-Te,ee=Pe[N].y-Re;te.writeVarint(Lr(j)),te.writeVarint(Lr(ee)),Te+=j,Re+=ee}me===3&&te.writeVarint(ii(7,1))}}function Fn(J,te){var oe=typeof J;oe==="string"?te.writeStringField(1,J):oe==="boolean"?te.writeBooleanField(7,J):oe==="number"&&(J%1!=0?te.writeDoubleField(3,J):J<0?te.writeSVarintField(6,J):te.writeVarintField(5,J))}function Dr(J,te,oe,me){Vr(J,oe,me),Vr(te,2*oe,2*me),Vr(te,2*oe+1,2*me+1)}function Vr(J,te,oe){var me=J[te];J[te]=J[oe],J[oe]=me}function nn(J,te,oe,me){var Te=J-oe,Re=te-me;return Te*Te+Re*Re}Zi.fromVectorTileJs=Mr,Zi.fromGeojsonVt=function(J,te){te=te||{};var oe={};for(var me in J)oe[me]=new si(J[me].features,te),oe[me].name=me,oe[me].version=te.version,oe[me].extent=te.extent;return Mr({layers:oe})},Zi.GeoJSONWrapper=Ki;var cn=function(J){return J[0]},oi=function(J){return J[1]},$r=function(J,te,oe,me,Te){te===void 0&&(te=cn),oe===void 0&&(oe=oi),me===void 0&&(me=64),Te===void 0&&(Te=Float64Array),this.nodeSize=me,this.points=J;for(var Re=J.length<65536?Uint16Array:Uint32Array,Oe=this.ids=new Re(J.length),fe=this.coords=new Te(2*J.length),Pe=0;Pe<J.length;Pe++)Oe[Pe]=Pe,fe[2*Pe]=te(J[Pe]),fe[2*Pe+1]=oe(J[Pe]);(function Xe(ie,N,j,ee,se,ge){if(!(se-ee<=j)){var pe=ee+se>>1;(function Ee(we,Se,$e,je,He,Tt){for(;He>je;){if(He-je>600){var ft=He-je+1,wt=$e-je+1,It=Math.log(ft),xi=.5*Math.exp(2*It/3),Qt=.5*Math.sqrt(It*xi*(ft-xi)/ft)*(wt-ft/2<0?-1:1);Ee(we,Se,$e,Math.max(je,Math.floor($e-wt*xi/ft+Qt)),Math.min(He,Math.floor($e+(ft-wt)*xi/ft+Qt)),Tt)}var ni=Se[2*$e+Tt],$t=je,Mt=He;for(Dr(we,Se,je,$e),Se[2*He+Tt]>ni&&Dr(we,Se,je,He);$t<Mt;){for(Dr(we,Se,$t,Mt),$t++,Mt--;Se[2*$t+Tt]<ni;)$t++;for(;Se[2*Mt+Tt]>ni;)Mt--}Se[2*je+Tt]===ni?Dr(we,Se,je,Mt):Dr(we,Se,++Mt,He),Mt<=$e&&(je=Mt+1),$e<=Mt&&(He=Mt-1)}})(ie,N,pe,ee,se,ge%2),Xe(ie,N,j,ee,pe-1,ge+1),Xe(ie,N,j,pe+1,se,ge+1)}})(Oe,fe,me,0,Oe.length-1,0)};$r.prototype.range=function(J,te,oe,me){return function(Te,Re,Oe,fe,Pe,Xe,ie){for(var N,j,ee=[0,Te.length-1,0],se=[];ee.length;){var ge=ee.pop(),pe=ee.pop(),Ee=ee.pop();if(pe-Ee<=ie)for(var we=Ee;we<=pe;we++)j=Re[2*we+1],(N=Re[2*we])>=Oe&&N<=Pe&&j>=fe&&j<=Xe&&se.push(Te[we]);else{var Se=Math.floor((Ee+pe)/2);j=Re[2*Se+1],(N=Re[2*Se])>=Oe&&N<=Pe&&j>=fe&&j<=Xe&&se.push(Te[Se]);var $e=(ge+1)%2;(ge===0?Oe<=N:fe<=j)&&(ee.push(Ee),ee.push(Se-1),ee.push($e)),(ge===0?Pe>=N:Xe>=j)&&(ee.push(Se+1),ee.push(pe),ee.push($e))}}return se}(this.ids,this.coords,J,te,oe,me,this.nodeSize)},$r.prototype.within=function(J,te,oe){return function(me,Te,Re,Oe,fe,Pe){for(var Xe=[0,me.length-1,0],ie=[],N=fe*fe;Xe.length;){var j=Xe.pop(),ee=Xe.pop(),se=Xe.pop();if(ee-se<=Pe)for(var ge=se;ge<=ee;ge++)nn(Te[2*ge],Te[2*ge+1],Re,Oe)<=N&&ie.push(me[ge]);else{var pe=Math.floor((se+ee)/2),Ee=Te[2*pe],we=Te[2*pe+1];nn(Ee,we,Re,Oe)<=N&&ie.push(me[pe]);var Se=(j+1)%2;(j===0?Re-fe<=Ee:Oe-fe<=we)&&(Xe.push(se),Xe.push(pe-1),Xe.push(Se)),(j===0?Re+fe>=Ee:Oe+fe>=we)&&(Xe.push(pe+1),Xe.push(ee),Xe.push(Se))}}return ie}(this.ids,this.coords,J,te,oe,this.nodeSize)};var Hr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(J){return J}},wr=function(J){this.options=Hn(Object.create(Hr),J),this.trees=new Array(this.options.maxZoom+1)};function hn(J,te,oe,me,Te){return{x:J,y:te,zoom:1/0,id:oe,parentId:-1,numPoints:me,properties:Te}}function Fi(J,te){var oe=J.geometry.coordinates,me=oe[1];return{x:to(oe[0]),y:ci(me),zoom:1/0,index:te,parentId:-1}}function Ut(J){return{type:"Feature",id:J.id,properties:Nr(J),geometry:{type:"Point",coordinates:[(me=J.x,360*(me-.5)),(te=J.y,oe=(180-360*te)*Math.PI/180,360*Math.atan(Math.exp(oe))/Math.PI-90)]}};var te,oe,me}function Nr(J){var te=J.numPoints,oe=te>=1e4?Math.round(te/1e3)+"k":te>=1e3?Math.round(te/100)/10+"k":te;return Hn(Hn({},J.properties),{cluster:!0,cluster_id:J.id,point_count:te,point_count_abbreviated:oe})}function to(J){return J/360+.5}function ci(J){var te=Math.sin(J*Math.PI/180),oe=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return oe<0?0:oe>1?1:oe}function Hn(J,te){for(var oe in te)J[oe]=te[oe];return J}function pn(J){return J.x}function Sn(J){return J.y}function ko(J,te,oe,me,Te,Re){var Oe=Te-oe,fe=Re-me;if(Oe!==0||fe!==0){var Pe=((J-oe)*Oe+(te-me)*fe)/(Oe*Oe+fe*fe);Pe>1?(oe=Te,me=Re):Pe>0&&(oe+=Oe*Pe,me+=fe*Pe)}return(Oe=J-oe)*Oe+(fe=te-me)*fe}function io(J,te,oe,me){var Te={id:J===void 0?null:J,type:te,geometry:oe,tags:me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Re){var Oe=Re.geometry,fe=Re.type;if(fe==="Point"||fe==="MultiPoint"||fe==="LineString")vo(Re,Oe);else if(fe==="Polygon"||fe==="MultiLineString")for(var Pe=0;Pe<Oe.length;Pe++)vo(Re,Oe[Pe]);else if(fe==="MultiPolygon")for(Pe=0;Pe<Oe.length;Pe++)for(var Xe=0;Xe<Oe[Pe].length;Xe++)vo(Re,Oe[Pe][Xe])}(Te),Te}function vo(J,te){for(var oe=0;oe<te.length;oe+=3)J.minX=Math.min(J.minX,te[oe]),J.minY=Math.min(J.minY,te[oe+1]),J.maxX=Math.max(J.maxX,te[oe]),J.maxY=Math.max(J.maxY,te[oe+1])}function Wr(J,te,oe,me){if(te.geometry){var Te=te.geometry.coordinates,Re=te.geometry.type,Oe=Math.pow(oe.tolerance/((1<<oe.maxZoom)*oe.extent),2),fe=[],Pe=te.id;if(oe.promoteId?Pe=te.properties[oe.promoteId]:oe.generateId&&(Pe=me||0),Re==="Point")Un(Te,fe);else if(Re==="MultiPoint")for(var Xe=0;Xe<Te.length;Xe++)Un(Te[Xe],fe);else if(Re==="LineString")Yo(Te,fe,Oe,!1);else if(Re==="MultiLineString"){if(oe.lineMetrics){for(Xe=0;Xe<Te.length;Xe++)Yo(Te[Xe],fe=[],Oe,!1),J.push(io(Pe,"LineString",fe,te.properties));return}wi(Te,fe,Oe,!1)}else if(Re==="Polygon")wi(Te,fe,Oe,!0);else{if(Re!=="MultiPolygon"){if(Re==="GeometryCollection"){for(Xe=0;Xe<te.geometry.geometries.length;Xe++)Wr(J,{id:Pe,geometry:te.geometry.geometries[Xe],properties:te.properties},oe,me);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Xe=0;Xe<Te.length;Xe++){var ie=[];wi(Te[Xe],ie,Oe,!0),fe.push(ie)}}J.push(io(Pe,Re,fe,te.properties))}}function Un(J,te){te.push(Tn(J[0])),te.push(ro(J[1])),te.push(0)}function Yo(J,te,oe,me){for(var Te,Re,Oe=0,fe=0;fe<J.length;fe++){var Pe=Tn(J[fe][0]),Xe=ro(J[fe][1]);te.push(Pe),te.push(Xe),te.push(0),fe>0&&(Oe+=me?(Te*Xe-Pe*Re)/2:Math.sqrt(Math.pow(Pe-Te,2)+Math.pow(Xe-Re,2))),Te=Pe,Re=Xe}var ie=te.length-3;te[2]=1,function N(j,ee,se,ge){for(var pe,Ee=ge,we=se-ee>>1,Se=se-ee,$e=j[ee],je=j[ee+1],He=j[se],Tt=j[se+1],ft=ee+3;ft<se;ft+=3){var wt=ko(j[ft],j[ft+1],$e,je,He,Tt);if(wt>Ee)pe=ft,Ee=wt;else if(wt===Ee){var It=Math.abs(ft-we);It<Se&&(pe=ft,Se=It)}}Ee>ge&&(pe-ee>3&&N(j,ee,pe,ge),j[pe+2]=Ee,se-pe>3&&N(j,pe,se,ge))}(te,0,ie,oe),te[ie+2]=1,te.size=Math.abs(Oe),te.start=0,te.end=te.size}function wi(J,te,oe,me){for(var Te=0;Te<J.length;Te++){var Re=[];Yo(J[Te],Re,oe,me),te.push(Re)}}function Tn(J){return J/360+.5}function ro(J){var te=Math.sin(J*Math.PI/180),oe=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return oe<0?0:oe>1?1:oe}function kn(J,te,oe,me,Te,Re,Oe,fe){if(me/=te,Re>=(oe/=te)&&Oe<me)return J;if(Oe<oe||Re>=me)return null;for(var Pe=[],Xe=0;Xe<J.length;Xe++){var ie=J[Xe],N=ie.geometry,j=ie.type,ee=Te===0?ie.minX:ie.minY,se=Te===0?ie.maxX:ie.maxY;if(ee>=oe&&se<me)Pe.push(ie);else if(!(se<oe||ee>=me)){var ge=[];if(j==="Point"||j==="MultiPoint")Ma(N,ge,oe,me,Te);else if(j==="LineString")st(N,ge,oe,me,Te,!1,fe.lineMetrics);else if(j==="MultiLineString")Vo(N,ge,oe,me,Te,!1);else if(j==="Polygon")Vo(N,ge,oe,me,Te,!0);else if(j==="MultiPolygon")for(var pe=0;pe<N.length;pe++){var Ee=[];Vo(N[pe],Ee,oe,me,Te,!0),Ee.length&&ge.push(Ee)}if(ge.length){if(fe.lineMetrics&&j==="LineString"){for(pe=0;pe<ge.length;pe++)Pe.push(io(ie.id,j,ge[pe],ie.tags));continue}j!=="LineString"&&j!=="MultiLineString"||(ge.length===1?(j="LineString",ge=ge[0]):j="MultiLineString"),j!=="Point"&&j!=="MultiPoint"||(j=ge.length===3?"Point":"MultiPoint"),Pe.push(io(ie.id,j,ge,ie.tags))}}}return Pe.length?Pe:null}function Ma(J,te,oe,me,Te){for(var Re=0;Re<J.length;Re+=3){var Oe=J[Re+Te];Oe>=oe&&Oe<=me&&(te.push(J[Re]),te.push(J[Re+1]),te.push(J[Re+2]))}}function st(J,te,oe,me,Te,Re,Oe){for(var fe,Pe,Xe=Rt(J),ie=Te===0?or:Mn,N=J.start,j=0;j<J.length-3;j+=3){var ee=J[j],se=J[j+1],ge=J[j+2],pe=J[j+3],Ee=J[j+4],we=Te===0?ee:se,Se=Te===0?pe:Ee,$e=!1;Oe&&(fe=Math.sqrt(Math.pow(ee-pe,2)+Math.pow(se-Ee,2))),we<oe?Se>oe&&(Pe=ie(Xe,ee,se,pe,Ee,oe),Oe&&(Xe.start=N+fe*Pe)):we>me?Se<me&&(Pe=ie(Xe,ee,se,pe,Ee,me),Oe&&(Xe.start=N+fe*Pe)):no(Xe,ee,se,ge),Se<oe&&we>=oe&&(Pe=ie(Xe,ee,se,pe,Ee,oe),$e=!0),Se>me&&we<=me&&(Pe=ie(Xe,ee,se,pe,Ee,me),$e=!0),!Re&&$e&&(Oe&&(Xe.end=N+fe*Pe),te.push(Xe),Xe=Rt(J)),Oe&&(N+=fe)}var je=J.length-3;ee=J[je],se=J[je+1],ge=J[je+2],(we=Te===0?ee:se)>=oe&&we<=me&&no(Xe,ee,se,ge),je=Xe.length-3,Re&&je>=3&&(Xe[je]!==Xe[0]||Xe[je+1]!==Xe[1])&&no(Xe,Xe[0],Xe[1],Xe[2]),Xe.length&&te.push(Xe)}function Rt(J){var te=[];return te.size=J.size,te.start=J.start,te.end=J.end,te}function Vo(J,te,oe,me,Te,Re){for(var Oe=0;Oe<J.length;Oe++)st(J[Oe],te,oe,me,Te,Re,!1)}function no(J,te,oe,me){J.push(te),J.push(oe),J.push(me)}function or(J,te,oe,me,Te,Re){var Oe=(Re-te)/(me-te);return J.push(Re),J.push(oe+(Te-oe)*Oe),J.push(1),Oe}function Mn(J,te,oe,me,Te,Re){var Oe=(Re-oe)/(Te-oe);return J.push(te+(me-te)*Oe),J.push(Re),J.push(1),Oe}function dn(J,te){for(var oe=[],me=0;me<J.length;me++){var Te,Re=J[me],Oe=Re.type;if(Oe==="Point"||Oe==="MultiPoint"||Oe==="LineString")Te=xo(Re.geometry,te);else if(Oe==="MultiLineString"||Oe==="Polygon"){Te=[];for(var fe=0;fe<Re.geometry.length;fe++)Te.push(xo(Re.geometry[fe],te))}else if(Oe==="MultiPolygon")for(Te=[],fe=0;fe<Re.geometry.length;fe++){for(var Pe=[],Xe=0;Xe<Re.geometry[fe].length;Xe++)Pe.push(xo(Re.geometry[fe][Xe],te));Te.push(Pe)}oe.push(io(Re.id,Oe,Te,Re.tags))}return oe}function xo(J,te){var oe=[];oe.size=J.size,J.start!==void 0&&(oe.start=J.start,oe.end=J.end);for(var me=0;me<J.length;me+=3)oe.push(J[me]+te,J[me+1],J[me+2]);return oe}function ur(J,te){if(J.transformed)return J;var oe,me,Te,Re=1<<J.z,Oe=J.x,fe=J.y;for(oe=0;oe<J.features.length;oe++){var Pe=J.features[oe],Xe=Pe.geometry,ie=Pe.type;if(Pe.geometry=[],ie===1)for(me=0;me<Xe.length;me+=2)Pe.geometry.push(kt(Xe[me],Xe[me+1],te,Re,Oe,fe));else for(me=0;me<Xe.length;me++){var N=[];for(Te=0;Te<Xe[me].length;Te+=2)N.push(kt(Xe[me][Te],Xe[me][Te+1],te,Re,Oe,fe));Pe.geometry.push(N)}}return J.transformed=!0,J}function kt(J,te,oe,me,Te,Re){return[Math.round(oe*(J*me-Te)),Math.round(oe*(te*me-Re))]}function zi(J,te,oe,me,Te){for(var Re=te===Te.maxZoom?0:Te.tolerance/((1<<te)*Te.extent),Oe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:oe,y:me,z:te,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},fe=0;fe<J.length;fe++){Oe.numFeatures++,Ei(Oe,J[fe],Re,Te);var Pe=J[fe].minX,Xe=J[fe].minY,ie=J[fe].maxX,N=J[fe].maxY;Pe<Oe.minX&&(Oe.minX=Pe),Xe<Oe.minY&&(Oe.minY=Xe),ie>Oe.maxX&&(Oe.maxX=ie),N>Oe.maxY&&(Oe.maxY=N)}return Oe}function Ei(J,te,oe,me){var Te=te.geometry,Re=te.type,Oe=[];if(Re==="Point"||Re==="MultiPoint")for(var fe=0;fe<Te.length;fe+=3)Oe.push(Te[fe]),Oe.push(Te[fe+1]),J.numPoints++,J.numSimplified++;else if(Re==="LineString")Kr(Oe,Te,J,oe,!1,!1);else if(Re==="MultiLineString"||Re==="Polygon")for(fe=0;fe<Te.length;fe++)Kr(Oe,Te[fe],J,oe,Re==="Polygon",fe===0);else if(Re==="MultiPolygon")for(var Pe=0;Pe<Te.length;Pe++){var Xe=Te[Pe];for(fe=0;fe<Xe.length;fe++)Kr(Oe,Xe[fe],J,oe,!0,fe===0)}if(Oe.length){var ie=te.tags||null;if(Re==="LineString"&&me.lineMetrics){for(var N in ie={},te.tags)ie[N]=te.tags[N];ie.mapbox_clip_start=Te.start/Te.size,ie.mapbox_clip_end=Te.end/Te.size}var j={geometry:Oe,type:Re==="Polygon"||Re==="MultiPolygon"?3:Re==="LineString"||Re==="MultiLineString"?2:1,tags:ie};te.id!==null&&(j.id=te.id),J.features.push(j)}}function Kr(J,te,oe,me,Te,Re){var Oe=me*me;if(me>0&&te.size<(Te?Oe:me))oe.numPoints+=te.length/3;else{for(var fe=[],Pe=0;Pe<te.length;Pe+=3)(me===0||te[Pe+2]>Oe)&&(oe.numSimplified++,fe.push(te[Pe]),fe.push(te[Pe+1])),oe.numPoints++;Te&&function(Xe,ie){for(var N=0,j=0,ee=Xe.length,se=ee-2;j<ee;se=j,j+=2)N+=(Xe[j]-Xe[se])*(Xe[j+1]+Xe[se+1]);if(N>0===ie)for(j=0,ee=Xe.length;j<ee/2;j+=2){var ge=Xe[j],pe=Xe[j+1];Xe[j]=Xe[ee-2-j],Xe[j+1]=Xe[ee-1-j],Xe[ee-2-j]=ge,Xe[ee-1-j]=pe}}(fe,Re),J.push(fe)}}function fn(J,te){var oe=(te=this.options=function(Te,Re){for(var Oe in Re)Te[Oe]=Re[Oe];return Te}(Object.create(this.options),te)).debug;if(oe&&console.time("preprocess data"),te.maxZoom<0||te.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(te.promoteId&&te.generateId)throw new Error("promoteId and generateId cannot be used together.");var me=function(Te,Re){var Oe=[];if(Te.type==="FeatureCollection")for(var fe=0;fe<Te.features.length;fe++)Wr(Oe,Te.features[fe],Re,fe);else Wr(Oe,Te.type==="Feature"?Te:{geometry:Te},Re);return Oe}(J,te);this.tiles={},this.tileCoords=[],oe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",te.indexMaxZoom,te.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(me=function(Te,Re){var Oe=Re.buffer/Re.extent,fe=Te,Pe=kn(Te,1,-1-Oe,Oe,0,-1,2,Re),Xe=kn(Te,1,1-Oe,2+Oe,0,-1,2,Re);return(Pe||Xe)&&(fe=kn(Te,1,-Oe,1+Oe,0,-1,2,Re)||[],Pe&&(fe=dn(Pe,1).concat(fe)),Xe&&(fe=fe.concat(dn(Xe,-1)))),fe}(me,te)).length&&this.splitTile(me,0,0,0),oe&&(me.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function yi(J,te,oe){return 32*((1<<J)*oe+te)+J}function Mo(J,te){var oe=J.tileID.canonical;if(!this._geoJSONIndex)return te(null,null);var me=this._geoJSONIndex.getTile(oe.z,oe.x,oe.y);if(!me)return te(null,null);var Te=new qt(me.features),Re=Zi(Te);Re.byteOffset===0&&Re.byteLength===Re.buffer.byteLength||(Re=new Uint8Array(Re)),te(null,{vectorTile:Te,rawData:Re.buffer})}wr.prototype.load=function(J){var te=this.options,oe=te.log,me=te.minZoom,Te=te.maxZoom,Re=te.nodeSize;oe&&console.time("total time");var Oe="prepare "+J.length+" points";oe&&console.time(Oe),this.points=J;for(var fe=[],Pe=0;Pe<J.length;Pe++)J[Pe].geometry&&fe.push(Fi(J[Pe],Pe));this.trees[Te+1]=new $r(fe,pn,Sn,Re,Float32Array),oe&&console.timeEnd(Oe);for(var Xe=Te;Xe>=me;Xe--){var ie=+Date.now();fe=this._cluster(fe,Xe),this.trees[Xe]=new $r(fe,pn,Sn,Re,Float32Array),oe&&console.log("z%d: %d clusters in %dms",Xe,fe.length,+Date.now()-ie)}return oe&&console.timeEnd("total time"),this},wr.prototype.getClusters=function(J,te){var oe=((J[0]+180)%360+360)%360-180,me=Math.max(-90,Math.min(90,J[1])),Te=J[2]===180?180:((J[2]+180)%360+360)%360-180,Re=Math.max(-90,Math.min(90,J[3]));if(J[2]-J[0]>=360)oe=-180,Te=180;else if(oe>Te){var Oe=this.getClusters([oe,me,180,Re],te),fe=this.getClusters([-180,me,Te,Re],te);return Oe.concat(fe)}for(var Pe=this.trees[this._limitZoom(te)],Xe=[],ie=0,N=Pe.range(to(oe),ci(Re),to(Te),ci(me));ie<N.length;ie+=1){var j=Pe.points[N[ie]];Xe.push(j.numPoints?Ut(j):this.points[j.index])}return Xe},wr.prototype.getChildren=function(J){var te=this._getOriginId(J),oe=this._getOriginZoom(J),me="No cluster with the specified id.",Te=this.trees[oe];if(!Te)throw new Error(me);var Re=Te.points[te];if(!Re)throw new Error(me);for(var Oe=this.options.radius/(this.options.extent*Math.pow(2,oe-1)),fe=[],Pe=0,Xe=Te.within(Re.x,Re.y,Oe);Pe<Xe.length;Pe+=1){var ie=Te.points[Xe[Pe]];ie.parentId===J&&fe.push(ie.numPoints?Ut(ie):this.points[ie.index])}if(fe.length===0)throw new Error(me);return fe},wr.prototype.getLeaves=function(J,te,oe){var me=[];return this._appendLeaves(me,J,te=te||10,oe=oe||0,0),me},wr.prototype.getTile=function(J,te,oe){var me=this.trees[this._limitZoom(J)],Te=Math.pow(2,J),Re=this.options,Oe=Re.radius/Re.extent,fe=(oe-Oe)/Te,Pe=(oe+1+Oe)/Te,Xe={features:[]};return this._addTileFeatures(me.range((te-Oe)/Te,fe,(te+1+Oe)/Te,Pe),me.points,te,oe,Te,Xe),te===0&&this._addTileFeatures(me.range(1-Oe/Te,fe,1,Pe),me.points,Te,oe,Te,Xe),te===Te-1&&this._addTileFeatures(me.range(0,fe,Oe/Te,Pe),me.points,-1,oe,Te,Xe),Xe.features.length?Xe:null},wr.prototype.getClusterExpansionZoom=function(J){for(var te=this._getOriginZoom(J)-1;te<=this.options.maxZoom;){var oe=this.getChildren(J);if(te++,oe.length!==1)break;J=oe[0].properties.cluster_id}return te},wr.prototype._appendLeaves=function(J,te,oe,me,Te){for(var Re=0,Oe=this.getChildren(te);Re<Oe.length;Re+=1){var fe=Oe[Re],Pe=fe.properties;if(Pe&&Pe.cluster?Te+Pe.point_count<=me?Te+=Pe.point_count:Te=this._appendLeaves(J,Pe.cluster_id,oe,me,Te):Te<me?Te++:J.push(fe),J.length===oe)break}return Te},wr.prototype._addTileFeatures=function(J,te,oe,me,Te,Re){for(var Oe=0,fe=J;Oe<fe.length;Oe+=1){var Pe=te[fe[Oe]],Xe=Pe.numPoints,ie={type:1,geometry:[[Math.round(this.options.extent*(Pe.x*Te-oe)),Math.round(this.options.extent*(Pe.y*Te-me))]],tags:Xe?Nr(Pe):this.points[Pe.index].properties},N=void 0;Xe?N=Pe.id:this.options.generateId?N=Pe.index:this.points[Pe.index].id&&(N=this.points[Pe.index].id),N!==void 0&&(ie.id=N),Re.features.push(ie)}},wr.prototype._limitZoom=function(J){return Math.max(this.options.minZoom,Math.min(+J,this.options.maxZoom+1))},wr.prototype._cluster=function(J,te){for(var oe=[],me=this.options,Te=me.reduce,Re=me.minPoints,Oe=me.radius/(me.extent*Math.pow(2,te)),fe=0;fe<J.length;fe++){var Pe=J[fe];if(!(Pe.zoom<=te)){Pe.zoom=te;for(var Xe=this.trees[te+1],ie=Xe.within(Pe.x,Pe.y,Oe),N=Pe.numPoints||1,j=N,ee=0,se=ie;ee<se.length;ee+=1){var ge=Xe.points[se[ee]];ge.zoom>te&&(j+=ge.numPoints||1)}if(j>=Re){for(var pe=Pe.x*N,Ee=Pe.y*N,we=Te&&N>1?this._map(Pe,!0):null,Se=(fe<<5)+(te+1)+this.points.length,$e=0,je=ie;$e<je.length;$e+=1){var He=Xe.points[je[$e]];if(!(He.zoom<=te)){He.zoom=te;var Tt=He.numPoints||1;pe+=He.x*Tt,Ee+=He.y*Tt,He.parentId=Se,Te&&(we||(we=this._map(Pe,!0)),Te(we,this._map(He)))}}Pe.parentId=Se,oe.push(hn(pe/j,Ee/j,Se,j,we))}else if(oe.push(Pe),j>1)for(var ft=0,wt=ie;ft<wt.length;ft+=1){var It=Xe.points[wt[ft]];It.zoom<=te||(It.zoom=te,oe.push(It))}}}return oe},wr.prototype._getOriginId=function(J){return J-this.points.length>>5},wr.prototype._getOriginZoom=function(J){return(J-this.points.length)%32},wr.prototype._map=function(J,te){if(J.numPoints)return te?Hn({},J.properties):J.properties;var oe=this.points[J.index].properties,me=this.options.map(oe);return te&&me===oe?Hn({},me):me},fn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},fn.prototype.splitTile=function(J,te,oe,me,Te,Re,Oe){for(var fe=[J,te,oe,me],Pe=this.options,Xe=Pe.debug;fe.length;){me=fe.pop(),oe=fe.pop(),te=fe.pop(),J=fe.pop();var ie=1<<te,N=yi(te,oe,me),j=this.tiles[N];if(!j&&(Xe>1&&console.time("creation"),j=this.tiles[N]=zi(J,te,oe,me,Pe),this.tileCoords.push({z:te,x:oe,y:me}),Xe)){Xe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",te,oe,me,j.numFeatures,j.numPoints,j.numSimplified),console.timeEnd("creation"));var ee="z"+te;this.stats[ee]=(this.stats[ee]||0)+1,this.total++}if(j.source=J,Te){if(te===Pe.maxZoom||te===Te)continue;var se=1<<Te-te;if(oe!==Math.floor(Re/se)||me!==Math.floor(Oe/se))continue}else if(te===Pe.indexMaxZoom||j.numPoints<=Pe.indexMaxPoints)continue;if(j.source=null,J.length!==0){Xe>1&&console.time("clipping");var ge,pe,Ee,we,Se,$e,je=.5*Pe.buffer/Pe.extent,He=.5-je,Tt=.5+je,ft=1+je;ge=pe=Ee=we=null,Se=kn(J,ie,oe-je,oe+Tt,0,j.minX,j.maxX,Pe),$e=kn(J,ie,oe+He,oe+ft,0,j.minX,j.maxX,Pe),J=null,Se&&(ge=kn(Se,ie,me-je,me+Tt,1,j.minY,j.maxY,Pe),pe=kn(Se,ie,me+He,me+ft,1,j.minY,j.maxY,Pe),Se=null),$e&&(Ee=kn($e,ie,me-je,me+Tt,1,j.minY,j.maxY,Pe),we=kn($e,ie,me+He,me+ft,1,j.minY,j.maxY,Pe),$e=null),Xe>1&&console.timeEnd("clipping"),fe.push(ge||[],te+1,2*oe,2*me),fe.push(pe||[],te+1,2*oe,2*me+1),fe.push(Ee||[],te+1,2*oe+1,2*me),fe.push(we||[],te+1,2*oe+1,2*me+1)}}},fn.prototype.getTile=function(J,te,oe){var me=this.options,Te=me.extent,Re=me.debug;if(J<0||J>24)return null;var Oe=1<<J,fe=yi(J,te=(te%Oe+Oe)%Oe,oe);if(this.tiles[fe])return ur(this.tiles[fe],Te);Re>1&&console.log("drilling down to z%d-%d-%d",J,te,oe);for(var Pe,Xe=J,ie=te,N=oe;!Pe&&Xe>0;)Xe--,ie=Math.floor(ie/2),N=Math.floor(N/2),Pe=this.tiles[yi(Xe,ie,N)];return Pe&&Pe.source?(Re>1&&console.log("found parent tile z%d-%d-%d",Xe,ie,N),Re>1&&console.time("drilling down"),this.splitTile(Pe.source,Xe,ie,N,J,te,oe),Re>1&&console.timeEnd("drilling down"),this.tiles[fe]?ur(this.tiles[fe],Te):null):null};var Wn=function(J){function te(oe,me,Te,Re){J.call(this,oe,me,Te,Mo),Re&&(this.loadGeoJSON=Re)}return J&&(te.__proto__=J),(te.prototype=Object.create(J&&J.prototype)).constructor=te,te.prototype.loadData=function(oe,me){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=me,this._pendingLoadDataParams=oe,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},te.prototype._loadData=function(){var oe=this;if(this._pendingCallback&&this._pendingLoadDataParams){var me=this._pendingCallback,Te=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Re=!!(Te&&Te.request&&Te.request.collectResourceTiming)&&new m.RequestPerformance(Te.request);this.loadGeoJSON(Te,function(Oe,fe){if(Oe||!fe)return me(Oe);if(typeof fe!="object")return me(new Error("Input data given to '"+Te.source+"' is not a valid GeoJSON object."));(function j(ee,se){var ge,pe=ee&&ee.type;if(pe==="FeatureCollection")for(ge=0;ge<ee.features.length;ge++)j(ee.features[ge],se);else if(pe==="GeometryCollection")for(ge=0;ge<ee.geometries.length;ge++)j(ee.geometries[ge],se);else if(pe==="Feature")j(ee.geometry,se);else if(pe==="Polygon")Xt(ee.coordinates,se);else if(pe==="MultiPolygon")for(ge=0;ge<ee.coordinates.length;ge++)Xt(ee.coordinates[ge],se);return ee})(fe,!0);try{if(Te.filter){var Pe=m.createExpression(Te.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Pe.result==="error")throw new Error(Pe.value.map(function(j){return j.key+": "+j.message}).join(", "));var Xe=fe.features.filter(function(j){return Pe.value.evaluate({zoom:0},j)});fe={type:"FeatureCollection",features:Xe}}oe._geoJSONIndex=Te.cluster?new wr(function(j){var ee=j.superclusterOptions,se=j.clusterProperties;if(!se||!ee)return ee;for(var ge={},pe={},Ee={accumulated:null,zoom:0},we={properties:null},Se=Object.keys(se),$e=0,je=Se;$e<je.length;$e+=1){var He=je[$e],Tt=se[He],ft=Tt[0],wt=m.createExpression(Tt[1]),It=m.createExpression(typeof ft=="string"?[ft,["accumulated"],["get",He]]:ft);ge[He]=wt.value,pe[He]=It.value}return ee.map=function(xi){we.properties=xi;for(var Qt={},ni=0,$t=Se;ni<$t.length;ni+=1){var Mt=$t[ni];Qt[Mt]=ge[Mt].evaluate(Ee,we)}return Qt},ee.reduce=function(xi,Qt){we.properties=Qt;for(var ni=0,$t=Se;ni<$t.length;ni+=1){var Mt=$t[ni];Ee.accumulated=xi[Mt],xi[Mt]=pe[Mt].evaluate(Ee,we)}},ee}(Te)).load(fe.features):function(j,ee){return new fn(j,ee)}(fe,Te.geojsonVtOptions)}catch(j){return me(j)}oe.loaded={};var ie={};if(Re){var N=Re.finish();N&&(ie.resourceTiming={},ie.resourceTiming[Te.source]=JSON.parse(JSON.stringify(N)))}me(null,ie)})}},te.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},te.prototype.reloadTile=function(oe,me){var Te=this.loaded;return Te&&Te[oe.uid]?J.prototype.reloadTile.call(this,oe,me):this.loadTile(oe,me)},te.prototype.loadGeoJSON=function(oe,me){if(oe.request)m.getJSON(oe.request,me);else{if(typeof oe.data!="string")return me(new Error("Input data given to '"+oe.source+"' is not a valid GeoJSON object."));try{return me(null,JSON.parse(oe.data))}catch{return me(new Error("Input data given to '"+oe.source+"' is not a valid GeoJSON object."))}}},te.prototype.removeSource=function(oe,me){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),me()},te.prototype.getClusterExpansionZoom=function(oe,me){try{me(null,this._geoJSONIndex.getClusterExpansionZoom(oe.clusterId))}catch(Te){me(Te)}},te.prototype.getClusterChildren=function(oe,me){try{me(null,this._geoJSONIndex.getChildren(oe.clusterId))}catch(Te){me(Te)}},te.prototype.getClusterLeaves=function(oe,me){try{me(null,this._geoJSONIndex.getLeaves(oe.clusterId,oe.limit,oe.offset))}catch(Te){me(Te)}},te}(et),ar=function(J){var te=this;this.self=J,this.actor=new m.Actor(J,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:et,geojson:Wn},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(oe,me){if(te.workerSourceTypes[oe])throw new Error('Worker source with name "'+oe+'" already registered.');te.workerSourceTypes[oe]=me},this.self.registerRTLTextPlugin=function(oe){if(m.plugin.isParsed())throw new Error("RTL text plugin already registered.");m.plugin.applyArabicShaping=oe.applyArabicShaping,m.plugin.processBidirectionalText=oe.processBidirectionalText,m.plugin.processStyledBidirectionalText=oe.processStyledBidirectionalText}};return ar.prototype.setReferrer=function(J,te){this.referrer=te},ar.prototype.setImages=function(J,te,oe){for(var me in this.availableImages[J]=te,this.workerSources[J]){var Te=this.workerSources[J][me];for(var Re in Te)Te[Re].availableImages=te}oe()},ar.prototype.setLayers=function(J,te,oe){this.getLayerIndex(J).replace(te),oe()},ar.prototype.updateLayers=function(J,te,oe){this.getLayerIndex(J).update(te.layers,te.removedIds),oe()},ar.prototype.loadTile=function(J,te,oe){this.getWorkerSource(J,te.type,te.source).loadTile(te,oe)},ar.prototype.loadDEMTile=function(J,te,oe){this.getDEMWorkerSource(J,te.source).loadTile(te,oe)},ar.prototype.reloadTile=function(J,te,oe){this.getWorkerSource(J,te.type,te.source).reloadTile(te,oe)},ar.prototype.abortTile=function(J,te,oe){this.getWorkerSource(J,te.type,te.source).abortTile(te,oe)},ar.prototype.removeTile=function(J,te,oe){this.getWorkerSource(J,te.type,te.source).removeTile(te,oe)},ar.prototype.removeDEMTile=function(J,te){this.getDEMWorkerSource(J,te.source).removeTile(te)},ar.prototype.removeSource=function(J,te,oe){if(this.workerSources[J]&&this.workerSources[J][te.type]&&this.workerSources[J][te.type][te.source]){var me=this.workerSources[J][te.type][te.source];delete this.workerSources[J][te.type][te.source],me.removeSource!==void 0?me.removeSource(te,oe):oe()}},ar.prototype.loadWorkerSource=function(J,te,oe){try{this.self.importScripts(te.url),oe()}catch(me){oe(me.toString())}},ar.prototype.syncRTLPluginState=function(J,te,oe){try{m.plugin.setState(te);var me=m.plugin.getPluginURL();if(m.plugin.isLoaded()&&!m.plugin.isParsed()&&me!=null){this.self.importScripts(me);var Te=m.plugin.isParsed();oe(Te?void 0:new Error("RTL Text Plugin failed to import scripts from "+me),Te)}}catch(Re){oe(Re.toString())}},ar.prototype.getAvailableImages=function(J){var te=this.availableImages[J];return te||(te=[]),te},ar.prototype.getLayerIndex=function(J){var te=this.layerIndexes[J];return te||(te=this.layerIndexes[J]=new ve),te},ar.prototype.getWorkerSource=function(J,te,oe){var me=this;return this.workerSources[J]||(this.workerSources[J]={}),this.workerSources[J][te]||(this.workerSources[J][te]={}),this.workerSources[J][te][oe]||(this.workerSources[J][te][oe]=new this.workerSourceTypes[te]({send:function(Te,Re,Oe){me.actor.send(Te,Re,Oe,J)}},this.getLayerIndex(J),this.getAvailableImages(J))),this.workerSources[J][te][oe]},ar.prototype.getDEMWorkerSource=function(J,te){return this.demWorkerSources[J]||(this.demWorkerSources[J]={}),this.demWorkerSources[J][te]||(this.demWorkerSources[J][te]=new vt),this.demWorkerSources[J][te]},ar.prototype.enforceCacheSizeLimit=function(J,te){m.enforceCacheSizeLimit(te)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new ar(self)),ar}),H(["./shared"],function(m){var g=m.createCommonjsModule(function(s){function c(T){return!u(T)}function u(T){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var M,F,X=new Blob([""],{type:"text/javascript"}),Y=URL.createObjectURL(X);try{F=new Worker(Y),M=!0}catch{M=!1}return F&&F.terminate(),URL.revokeObjectURL(Y),M}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var M=document.createElement("canvas");M.width=M.height=1;var F=M.getContext("2d");if(!F)return!1;var X=F.getImageData(0,0,1,1);return X&&X.width===M.width}()?(f[P=T&&T.failIfMajorPerformanceCaveat]===void 0&&(f[P]=function(M){var F=function(Y){var le=document.createElement("canvas"),ce=Object.create(c.webGLContextAttributes);return ce.failIfMajorPerformanceCaveat=Y,le.probablySupportsContext?le.probablySupportsContext("webgl",ce)||le.probablySupportsContext("experimental-webgl",ce):le.supportsContext?le.supportsContext("webgl",ce)||le.supportsContext("experimental-webgl",ce):le.getContext("webgl",ce)||le.getContext("experimental-webgl",ce)}(M);if(!F)return!1;var X=F.createShader(F.VERTEX_SHADER);return!(!X||F.isContextLost())&&(F.shaderSource(X,"void main() {}"),F.compileShader(X),F.getShaderParameter(X,F.COMPILE_STATUS)===!0)}(P)),f[P]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var P}s.exports?s.exports=c:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=c,window.mapboxgl.notSupportedReason=u);var f={};c.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),Z={create:function(s,c,u){var f=m.window.document.createElement(s);return c!==void 0&&(f.className=c),u&&u.appendChild(f),f},createNS:function(s,c){return m.window.document.createElementNS(s,c)}},ve=m.window.document&&m.window.document.documentElement.style;function he(s){if(!ve)return s[0];for(var c=0;c<s.length;c++)if(s[c]in ve)return s[c];return s[0]}var ye,re=he(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);Z.disableDrag=function(){ve&&re&&(ye=ve[re],ve[re]="none")},Z.enableDrag=function(){ve&&re&&(ve[re]=ye)};var it=he(["transform","WebkitTransform"]);Z.setTransform=function(s,c){s.style[it]=c};var et=!1;try{var St=Object.defineProperty({},"passive",{get:function(){et=!0}});m.window.addEventListener("test",St,St),m.window.removeEventListener("test",St,St)}catch{et=!1}Z.addEventListener=function(s,c,u,f){f===void 0&&(f={}),s.addEventListener(c,u,"passive"in f&&et?f:f.capture)},Z.removeEventListener=function(s,c,u,f){f===void 0&&(f={}),s.removeEventListener(c,u,"passive"in f&&et?f:f.capture)};var vt=function(s){s.preventDefault(),s.stopPropagation(),m.window.removeEventListener("click",vt,!0)};function Xt(s){var c=s.userImage;return!!(c&&c.render&&c.render())&&(s.data.replace(new Uint8Array(c.data.buffer)),!0)}Z.suppressClick=function(){m.window.addEventListener("click",vt,!0),m.window.setTimeout(function(){m.window.removeEventListener("click",vt,!0)},0)},Z.mousePos=function(s,c){var u=s.getBoundingClientRect();return new m.Point(c.clientX-u.left-s.clientLeft,c.clientY-u.top-s.clientTop)},Z.touchPos=function(s,c){for(var u=s.getBoundingClientRect(),f=[],T=0;T<c.length;T++)f.push(new m.Point(c[T].clientX-u.left-s.clientLeft,c[T].clientY-u.top-s.clientTop));return f},Z.mouseButton=function(s){return m.window.InstallTrigger!==void 0&&s.button===2&&s.ctrlKey&&m.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:s.button},Z.remove=function(s){s.parentNode&&s.parentNode.removeChild(s)};var Wt=function(s){function c(){s.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new m.RGBAImage({width:1,height:1}),this.dirty=!0}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.isLoaded=function(){return this.loaded},c.prototype.setLoaded=function(u){if(this.loaded!==u&&(this.loaded=u,u)){for(var f=0,T=this.requestors;f<T.length;f+=1){var P=T[f];this._notify(P.ids,P.callback)}this.requestors=[]}},c.prototype.getImage=function(u){return this.images[u]},c.prototype.addImage=function(u,f){this._validate(u,f)&&(this.images[u]=f)},c.prototype._validate=function(u,f){var T=!0;return this._validateStretch(f.stretchX,f.data&&f.data.width)||(this.fire(new m.ErrorEvent(new Error('Image "'+u+'" has invalid "stretchX" value'))),T=!1),this._validateStretch(f.stretchY,f.data&&f.data.height)||(this.fire(new m.ErrorEvent(new Error('Image "'+u+'" has invalid "stretchY" value'))),T=!1),this._validateContent(f.content,f)||(this.fire(new m.ErrorEvent(new Error('Image "'+u+'" has invalid "content" value'))),T=!1),T},c.prototype._validateStretch=function(u,f){if(!u)return!0;for(var T=0,P=0,M=u;P<M.length;P+=1){var F=M[P];if(F[0]<T||F[1]<F[0]||f<F[1])return!1;T=F[1]}return!0},c.prototype._validateContent=function(u,f){return!(u&&(u.length!==4||u[0]<0||f.data.width<u[0]||u[1]<0||f.data.height<u[1]||u[2]<0||f.data.width<u[2]||u[3]<0||f.data.height<u[3]||u[2]<u[0]||u[3]<u[1]))},c.prototype.updateImage=function(u,f){f.version=this.images[u].version+1,this.images[u]=f,this.updatedImages[u]=!0},c.prototype.removeImage=function(u){var f=this.images[u];delete this.images[u],delete this.patterns[u],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()},c.prototype.listImages=function(){return Object.keys(this.images)},c.prototype.getImages=function(u,f){var T=!0;if(!this.isLoaded())for(var P=0,M=u;P<M.length;P+=1)this.images[M[P]]||(T=!1);this.isLoaded()||T?this._notify(u,f):this.requestors.push({ids:u,callback:f})},c.prototype._notify=function(u,f){for(var T={},P=0,M=u;P<M.length;P+=1){var F=M[P];this.images[F]||this.fire(new m.Event("styleimagemissing",{id:F}));var X=this.images[F];X?T[F]={data:X.data.clone(),pixelRatio:X.pixelRatio,sdf:X.sdf,version:X.version,stretchX:X.stretchX,stretchY:X.stretchY,content:X.content,hasRenderCallback:Boolean(X.userImage&&X.userImage.render)}:m.warnOnce('Image "'+F+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}f(null,T)},c.prototype.getPixelSize=function(){var u=this.atlasImage;return{width:u.width,height:u.height}},c.prototype.getPattern=function(u){var f=this.patterns[u],T=this.getImage(u);if(!T)return null;if(f&&f.position.version===T.version)return f.position;if(f)f.position.version=T.version;else{var P={w:T.data.width+2,h:T.data.height+2,x:0,y:0},M=new m.ImagePosition(P,T);this.patterns[u]={bin:P,position:M}}return this._updatePatternAtlas(),this.patterns[u].position},c.prototype.bind=function(u){var f=u.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new m.Texture(u,this.atlasImage,f.RGBA),this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)},c.prototype._updatePatternAtlas=function(){var u=[];for(var f in this.patterns)u.push(this.patterns[f].bin);var T=m.potpack(u),P=T.w,M=T.h,F=this.atlasImage;for(var X in F.resize({width:P||1,height:M||1}),this.patterns){var Y=this.patterns[X].bin,le=Y.x+1,ce=Y.y+1,de=this.images[X].data,Ce=de.width,Ae=de.height;m.RGBAImage.copy(de,F,{x:0,y:0},{x:le,y:ce},{width:Ce,height:Ae}),m.RGBAImage.copy(de,F,{x:0,y:Ae-1},{x:le,y:ce-1},{width:Ce,height:1}),m.RGBAImage.copy(de,F,{x:0,y:0},{x:le,y:ce+Ae},{width:Ce,height:1}),m.RGBAImage.copy(de,F,{x:Ce-1,y:0},{x:le-1,y:ce},{width:1,height:Ae}),m.RGBAImage.copy(de,F,{x:0,y:0},{x:le+Ce,y:ce},{width:1,height:Ae})}this.dirty=!0},c.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},c.prototype.dispatchRenderCallbacks=function(u){for(var f=0,T=u;f<T.length;f+=1){var P=T[f];if(!this.callbackDispatchedThisFrame[P]){this.callbackDispatchedThisFrame[P]=!0;var M=this.images[P];Xt(M)&&this.updateImage(P,M)}}},c}(m.Evented),_t=Zt,ui=Zt,qt=1e20;function Zt(s,c,u,f,T,P){this.fontSize=s||24,this.buffer=c===void 0?3:c,this.cutoff=f||.25,this.fontFamily=T||"sans-serif",this.fontWeight=P||"normal",this.radius=u||8;var M=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=M,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.d=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Int16Array(M),this.middle=Math.round(M/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function si(s,c,u,f,T,P,M){for(var F=0;F<c;F++){for(var X=0;X<u;X++)f[X]=s[X*c+F];for(Wi(f,T,P,M,u),X=0;X<u;X++)s[X*c+F]=T[X]}for(X=0;X<u;X++){for(F=0;F<c;F++)f[F]=s[X*c+F];for(Wi(f,T,P,M,c),F=0;F<c;F++)s[X*c+F]=Math.sqrt(T[F])}}function Wi(s,c,u,f,T){u[0]=0,f[0]=-qt,f[1]=+qt;for(var P=1,M=0;P<T;P++){for(var F=(s[P]+P*P-(s[u[M]]+u[M]*u[M]))/(2*P-2*u[M]);F<=f[M];)M--,F=(s[P]+P*P-(s[u[M]]+u[M]*u[M]))/(2*P-2*u[M]);u[++M]=P,f[M]=F,f[M+1]=+qt}for(P=0,M=0;P<T;P++){for(;f[M+1]<P;)M++;c[P]=(P-u[M])*(P-u[M])+s[u[M]]}}Zt.prototype.draw=function(s){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(s,this.buffer,this.middle);for(var c=this.ctx.getImageData(0,0,this.size,this.size),u=new Uint8ClampedArray(this.size*this.size),f=0;f<this.size*this.size;f++){var T=c.data[4*f+3]/255;this.gridOuter[f]=T===1?0:T===0?qt:Math.pow(Math.max(0,.5-T),2),this.gridInner[f]=T===1?qt:T===0?0:Math.pow(Math.max(0,T-.5),2)}for(si(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),si(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),f=0;f<this.size*this.size;f++)u[f]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[f]-this.gridInner[f])/this.radius+this.cutoff))));return u},_t.default=ui;var Gi=function(s,c){this.requestManager=s,this.localIdeographFontFamily=c,this.entries={}};Gi.prototype.setURL=function(s){this.url=s},Gi.prototype.getGlyphs=function(s,c){var u=this,f=[];for(var T in s)for(var P=0,M=s[T];P<M.length;P+=1)f.push({stack:T,id:M[P]});m.asyncAll(f,function(F,X){var Y=F.stack,le=F.id,ce=u.entries[Y];ce||(ce=u.entries[Y]={glyphs:{},requests:{},ranges:{}});var de=ce.glyphs[le];if(de===void 0){if(de=u._tinySDF(ce,Y,le))return ce.glyphs[le]=de,void X(null,{stack:Y,id:le,glyph:de});var Ce=Math.floor(le/256);if(256*Ce>65535)X(new Error("glyphs > 65535 not supported"));else if(ce.ranges[Ce])X(null,{stack:Y,id:le,glyph:de});else{var Ae=ce.requests[Ce];Ae||(Ae=ce.requests[Ce]=[],Gi.loadGlyphRange(Y,Ce,u.url,u.requestManager,function(ke,xe){if(xe){for(var ze in xe)u._doesCharSupportLocalGlyph(+ze)||(ce.glyphs[+ze]=xe[+ze]);ce.ranges[Ce]=!0}for(var Be=0,Ge=Ae;Be<Ge.length;Be+=1)(0,Ge[Be])(ke,xe);delete ce.requests[Ce]})),Ae.push(function(ke,xe){ke?X(ke):xe&&X(null,{stack:Y,id:le,glyph:xe[le]||null})})}}else X(null,{stack:Y,id:le,glyph:de})},function(F,X){if(F)c(F);else if(X){for(var Y={},le=0,ce=X;le<ce.length;le+=1){var de=ce[le],Ce=de.stack,Ae=de.id,ke=de.glyph;(Y[Ce]||(Y[Ce]={}))[Ae]=ke&&{id:ke.id,bitmap:ke.bitmap.clone(),metrics:ke.metrics}}c(null,Y)}})},Gi.prototype._doesCharSupportLocalGlyph=function(s){return!!this.localIdeographFontFamily&&(m.isChar["CJK Unified Ideographs"](s)||m.isChar["Hangul Syllables"](s)||m.isChar.Hiragana(s)||m.isChar.Katakana(s))},Gi.prototype._tinySDF=function(s,c,u){var f=this.localIdeographFontFamily;if(f&&this._doesCharSupportLocalGlyph(u)){var T=s.tinySDF;if(!T){var P="400";/bold/i.test(c)?P="900":/medium/i.test(c)?P="500":/light/i.test(c)&&(P="200"),T=s.tinySDF=new Gi.TinySDF(24,3,8,.25,f,P)}return{id:u,bitmap:new m.AlphaImage({width:30,height:30},T.draw(String.fromCharCode(u))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Gi.loadGlyphRange=function(s,c,u,f,T){var P=256*c,M=P+255,F=f.transformRequest(f.normalizeGlyphsURL(u).replace("{fontstack}",s).replace("{range}",P+"-"+M),m.ResourceType.Glyphs);m.getArrayBuffer(F,function(X,Y){if(X)T(X);else if(Y){for(var le={},ce=0,de=m.parseGlyphPBF(Y);ce<de.length;ce+=1){var Ce=de[ce];le[Ce.id]=Ce}T(null,le)}})},Gi.TinySDF=_t;var Zi=function(){this.specification=m.styleSpec.light.position};Zi.prototype.possiblyEvaluate=function(s,c){return m.sphericalToCartesian(s.expression.evaluate(c))},Zi.prototype.interpolate=function(s,c,u){return{x:m.number(s.x,c.x,u),y:m.number(s.y,c.y,u),z:m.number(s.z,c.z,u)}};var Ki=new m.Properties({anchor:new m.DataConstantProperty(m.styleSpec.light.anchor),position:new Zi,color:new m.DataConstantProperty(m.styleSpec.light.color),intensity:new m.DataConstantProperty(m.styleSpec.light.intensity)}),Mr=function(s){function c(u){s.call(this),this._transitionable=new m.Transitionable(Ki),this.setLight(u),this._transitioning=this._transitionable.untransitioned()}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getLight=function(){return this._transitionable.serialize()},c.prototype.setLight=function(u,f){if(f===void 0&&(f={}),!this._validate(m.validateLight,u,f))for(var T in u){var P=u[T];m.endsWith(T,"-transition")?this._transitionable.setTransition(T.slice(0,-11),P):this._transitionable.setValue(T,P)}},c.prototype.updateTransitions=function(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)},c.prototype.hasTransition=function(){return this._transitioning.hasTransition()},c.prototype.recalculate=function(u){this.properties=this._transitioning.possiblyEvaluate(u)},c.prototype._validate=function(u,f,T){return(!T||T.validate!==!1)&&m.emitValidationErrors(this,u.call(m.validateStyle,m.extend({value:f,style:{glyphs:!0,sprite:!0},styleSpec:m.styleSpec})))},c}(m.Evented),Oi=function(s,c){this.width=s,this.height=c,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Oi.prototype.getDash=function(s,c){var u=s.join(",")+String(c);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(s,c)),this.dashEntry[u]},Oi.prototype.getDashRanges=function(s,c,u){var f=[],T=s.length%2==1?-s[s.length-1]*u:0,P=s[0]*u,M=!0;f.push({left:T,right:P,isDash:M,zeroLength:s[0]===0});for(var F=s[0],X=1;X<s.length;X++){var Y=s[X];f.push({left:T=F*u,right:P=(F+=Y)*u,isDash:M=!M,zeroLength:Y===0})}return f},Oi.prototype.addRoundDash=function(s,c,u){for(var f=c/2,T=-u;T<=u;T++)for(var P=this.width*(this.nextRow+u+T),M=0,F=s[M],X=0;X<this.width;X++){X/F.right>1&&(F=s[++M]);var Y=Math.abs(X-F.left),le=Math.abs(X-F.right),ce=Math.min(Y,le),de=void 0,Ce=T/u*(f+1);if(F.isDash){var Ae=f-Math.abs(Ce);de=Math.sqrt(ce*ce+Ae*Ae)}else de=f-Math.sqrt(ce*ce+Ce*Ce);this.data[P+X]=Math.max(0,Math.min(255,de+128))}},Oi.prototype.addRegularDash=function(s){for(var c=s.length-1;c>=0;--c){var u=s[c],f=s[c+1];u.zeroLength?s.splice(c,1):f&&f.isDash===u.isDash&&(f.left=u.left,s.splice(c,1))}var T=s[0],P=s[s.length-1];T.isDash===P.isDash&&(T.left=P.left-this.width,P.right=T.right+this.width);for(var M=this.width*this.nextRow,F=0,X=s[F],Y=0;Y<this.width;Y++){Y/X.right>1&&(X=s[++F]);var le=Math.abs(Y-X.left),ce=Math.abs(Y-X.right),de=Math.min(le,ce);this.data[M+Y]=Math.max(0,Math.min(255,(X.isDash?de:-de)+128))}},Oi.prototype.addDash=function(s,c){var u=c?7:0,f=2*u+1;if(this.nextRow+f>this.height)return m.warnOnce("LineAtlas out of space"),null;for(var T=0,P=0;P<s.length;P++)T+=s[P];if(T!==0){var M=this.width/T,F=this.getDashRanges(s,this.width,M);c?this.addRoundDash(F,M,u):this.addRegularDash(F)}var X={y:(this.nextRow+u+.5)/this.height,height:2*u/this.height,width:T};return this.nextRow+=f,this.dirty=!0,X},Oi.prototype.bind=function(s){var c=s.gl;this.texture?(c.bindTexture(c.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,c.texSubImage2D(c.TEXTURE_2D,0,0,0,this.width,this.height,c.ALPHA,c.UNSIGNED_BYTE,this.data))):(this.texture=c.createTexture(),c.bindTexture(c.TEXTURE_2D,this.texture),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texImage2D(c.TEXTURE_2D,0,c.ALPHA,this.width,this.height,0,c.ALPHA,c.UNSIGNED_BYTE,this.data))};var hr=function s(c,u){this.workerPool=c,this.actors=[],this.currentActor=0,this.id=m.uniqueId();for(var f=this.workerPool.acquire(this.id),T=0;T<f.length;T++){var P=new s.Actor(f[T],u,this.id);P.name="Worker "+T,this.actors.push(P)}};function eo(s,c,u){var f=function(T,P){if(T)return u(T);if(P){var M=m.pick(m.extend(P,s),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);P.vector_layers&&(M.vectorLayers=P.vector_layers,M.vectorLayerIds=M.vectorLayers.map(function(F){return F.id})),M.tiles=c.canonicalizeTileset(M,s.url),u(null,M)}};return s.url?m.getJSON(c.transformRequest(c.normalizeSourceURL(s.url),m.ResourceType.Source),f):m.browser.frame(function(){return f(null,s)})}hr.prototype.broadcast=function(s,c,u){m.asyncAll(this.actors,function(f,T){f.send(s,c,T)},u=u||function(){})},hr.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},hr.prototype.remove=function(){this.actors.forEach(function(s){s.remove()}),this.actors=[],this.workerPool.release(this.id)},hr.Actor=m.Actor;var ii=function(s,c,u){this.bounds=m.LngLatBounds.convert(this.validateBounds(s)),this.minzoom=c||0,this.maxzoom=u||24};ii.prototype.validateBounds=function(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]},ii.prototype.contains=function(s){var c=Math.pow(2,s.z),u=Math.floor(m.mercatorXfromLng(this.bounds.getWest())*c),f=Math.floor(m.mercatorYfromLat(this.bounds.getNorth())*c),T=Math.ceil(m.mercatorXfromLng(this.bounds.getEast())*c),P=Math.ceil(m.mercatorYfromLat(this.bounds.getSouth())*c);return s.x>=u&&s.x<T&&s.y>=f&&s.y<P};var Lr=function(s){function c(u,f,T,P){if(s.call(this),this.id=u,this.dispatcher=T,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,m.extend(this,m.pick(f,["url","scheme","tileSize","promoteId"])),this._options=m.extend({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(P)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.load=function(){var u=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=eo(this._options,this.map._requestManager,function(f,T){u._tileJSONRequest=null,u._loaded=!0,f?u.fire(new m.ErrorEvent(f)):T&&(m.extend(u,T),T.bounds&&(u.tileBounds=new ii(T.bounds,u.minzoom,u.maxzoom)),m.postTurnstileEvent(T.tiles,u.map._requestManager._customAccessToken),m.postMapLoadEvent(T.tiles,u.map._getMapId(),u.map._requestManager._skuToken,u.map._requestManager._customAccessToken),u.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),u.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})},c.prototype.loaded=function(){return this._loaded},c.prototype.hasTile=function(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)},c.prototype.onAdd=function(u){this.map=u,this.load()},c.prototype.setSourceProperty=function(u){this._tileJSONRequest&&this._tileJSONRequest.cancel(),u(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},c.prototype.setTiles=function(u){var f=this;return this.setSourceProperty(function(){f._options.tiles=u}),this},c.prototype.setUrl=function(u){var f=this;return this.setSourceProperty(function(){f.url=u,f._options.url=u}),this},c.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},c.prototype.serialize=function(){return m.extend({},this._options)},c.prototype.loadTile=function(u,f){var T=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme)),P={request:this.map._requestManager.transformRequest(T,m.ResourceType.Tile),uid:u.uid,tileID:u.tileID,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:m.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function M(F,X){return delete u.request,u.aborted?f(null):F&&F.status!==404?f(F):(X&&X.resourceTiming&&(u.resourceTiming=X.resourceTiming),this.map._refreshExpiredTiles&&X&&u.setExpiryData(X),u.loadVectorData(X,this.map.painter),m.cacheEntryPossiblyAdded(this.dispatcher),f(null),void(u.reloadCallback&&(this.loadTile(u,u.reloadCallback),u.reloadCallback=null)))}P.request.collectResourceTiming=this._collectResourceTiming,u.actor&&u.state!=="expired"?u.state==="loading"?u.reloadCallback=f:u.request=u.actor.send("reloadTile",P,M.bind(this)):(u.actor=this.dispatcher.getActor(),u.request=u.actor.send("loadTile",P,M.bind(this)))},c.prototype.abortTile=function(u){u.request&&(u.request.cancel(),delete u.request),u.actor&&u.actor.send("abortTile",{uid:u.uid,type:this.type,source:this.id},void 0)},c.prototype.unloadTile=function(u){u.unloadVectorData(),u.actor&&u.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id},void 0)},c.prototype.hasTransition=function(){return!1},c}(m.Evented),un=function(s){function c(u,f,T,P){s.call(this),this.id=u,this.dispatcher=T,this.setEventedParent(P),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=m.extend({type:"raster"},f),m.extend(this,m.pick(f,["url","scheme","tileSize"]))}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.load=function(){var u=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=eo(this._options,this.map._requestManager,function(f,T){u._tileJSONRequest=null,u._loaded=!0,f?u.fire(new m.ErrorEvent(f)):T&&(m.extend(u,T),T.bounds&&(u.tileBounds=new ii(T.bounds,u.minzoom,u.maxzoom)),m.postTurnstileEvent(T.tiles),m.postMapLoadEvent(T.tiles,u.map._getMapId(),u.map._requestManager._skuToken),u.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),u.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})},c.prototype.loaded=function(){return this._loaded},c.prototype.onAdd=function(u){this.map=u,this.load()},c.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},c.prototype.serialize=function(){return m.extend({},this._options)},c.prototype.hasTile=function(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)},c.prototype.loadTile=function(u,f){var T=this,P=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);u.request=m.getImage(this.map._requestManager.transformRequest(P,m.ResourceType.Tile),function(M,F){if(delete u.request,u.aborted)u.state="unloaded",f(null);else if(M)u.state="errored",f(M);else if(F){T.map._refreshExpiredTiles&&u.setExpiryData(F),delete F.cacheControl,delete F.expires;var X=T.map.painter.context,Y=X.gl;u.texture=T.map.painter.getTileTexture(F.width),u.texture?u.texture.update(F,{useMipmap:!0}):(u.texture=new m.Texture(X,F,Y.RGBA,{useMipmap:!0}),u.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE,Y.LINEAR_MIPMAP_NEAREST),X.extTextureFilterAnisotropic&&Y.texParameterf(Y.TEXTURE_2D,X.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,X.extTextureFilterAnisotropicMax)),u.state="loaded",m.cacheEntryPossiblyAdded(T.dispatcher),f(null)}})},c.prototype.abortTile=function(u,f){u.request&&(u.request.cancel(),delete u.request),f()},c.prototype.unloadTile=function(u,f){u.texture&&this.map.painter.saveTileTexture(u.texture),f()},c.prototype.hasTransition=function(){return!1},c}(m.Evented),Fn=function(s){function c(u,f,T,P){s.call(this,u,f,T,P),this.type="raster-dem",this.maxzoom=22,this._options=m.extend({type:"raster-dem"},f),this.encoding=f.encoding||"mapbox"}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},c.prototype.loadTile=function(u,f){var T=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function P(M,F){M&&(u.state="errored",f(M)),F&&(u.dem=F,u.needsHillshadePrepare=!0,u.state="loaded",f(null))}u.request=m.getImage(this.map._requestManager.transformRequest(T,m.ResourceType.Tile),function(M,F){if(delete u.request,u.aborted)u.state="unloaded",f(null);else if(M)u.state="errored",f(M);else if(F){this.map._refreshExpiredTiles&&u.setExpiryData(F),delete F.cacheControl,delete F.expires;var X=m.window.ImageBitmap&&F instanceof m.window.ImageBitmap&&m.offscreenCanvasSupported()?F:m.browser.getImageData(F,1),Y={uid:u.uid,coord:u.tileID,source:this.id,rawImageData:X,encoding:this.encoding};u.actor&&u.state!=="expired"||(u.actor=this.dispatcher.getActor(),u.actor.send("loadDEMTile",Y,P.bind(this)))}}.bind(this)),u.neighboringTiles=this._getNeighboringTiles(u.tileID)},c.prototype._getNeighboringTiles=function(u){var f=u.canonical,T=Math.pow(2,f.z),P=(f.x-1+T)%T,M=f.x===0?u.wrap-1:u.wrap,F=(f.x+1+T)%T,X=f.x+1===T?u.wrap+1:u.wrap,Y={};return Y[new m.OverscaledTileID(u.overscaledZ,M,f.z,P,f.y).key]={backfilled:!1},Y[new m.OverscaledTileID(u.overscaledZ,X,f.z,F,f.y).key]={backfilled:!1},f.y>0&&(Y[new m.OverscaledTileID(u.overscaledZ,M,f.z,P,f.y-1).key]={backfilled:!1},Y[new m.OverscaledTileID(u.overscaledZ,u.wrap,f.z,f.x,f.y-1).key]={backfilled:!1},Y[new m.OverscaledTileID(u.overscaledZ,X,f.z,F,f.y-1).key]={backfilled:!1}),f.y+1<T&&(Y[new m.OverscaledTileID(u.overscaledZ,M,f.z,P,f.y+1).key]={backfilled:!1},Y[new m.OverscaledTileID(u.overscaledZ,u.wrap,f.z,f.x,f.y+1).key]={backfilled:!1},Y[new m.OverscaledTileID(u.overscaledZ,X,f.z,F,f.y+1).key]={backfilled:!1}),Y},c.prototype.unloadTile=function(u){u.demTexture&&this.map.painter.saveTileTexture(u.demTexture),u.fbo&&(u.fbo.destroy(),delete u.fbo),u.dem&&delete u.dem,delete u.neighboringTiles,u.state="unloaded",u.actor&&u.actor.send("removeDEMTile",{uid:u.uid,source:this.id})},c}(un),Dr=function(s){function c(u,f,T,P){s.call(this),this.id=u,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=T.getActor(),this.setEventedParent(P),this._data=f.data,this._options=m.extend({},f),this._collectResourceTiming=f.collectResourceTiming,this._resourceTiming=[],f.maxzoom!==void 0&&(this.maxzoom=f.maxzoom),f.type&&(this.type=f.type),f.attribution&&(this.attribution=f.attribution),this.promoteId=f.promoteId;var M=m.EXTENT/this.tileSize;this.workerOptions=m.extend({source:this.id,cluster:f.cluster||!1,geojsonVtOptions:{buffer:(f.buffer!==void 0?f.buffer:128)*M,tolerance:(f.tolerance!==void 0?f.tolerance:.375)*M,extent:m.EXTENT,maxZoom:this.maxzoom,lineMetrics:f.lineMetrics||!1,generateId:f.generateId||!1},superclusterOptions:{maxZoom:f.clusterMaxZoom!==void 0?Math.min(f.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,f.clusterMinPoints||2),extent:m.EXTENT,radius:(f.clusterRadius||50)*M,log:!1,generateId:f.generateId||!1},clusterProperties:f.clusterProperties,filter:f.filter},f.workerOptions)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.load=function(){var u=this;this.fire(new m.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(f){if(f)u.fire(new m.ErrorEvent(f));else{var T={dataType:"source",sourceDataType:"metadata"};u._collectResourceTiming&&u._resourceTiming&&u._resourceTiming.length>0&&(T.resourceTiming=u._resourceTiming,u._resourceTiming=[]),u.fire(new m.Event("data",T))}})},c.prototype.onAdd=function(u){this.map=u,this.load()},c.prototype.setData=function(u){var f=this;return this._data=u,this.fire(new m.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(T){if(T)f.fire(new m.ErrorEvent(T));else{var P={dataType:"source",sourceDataType:"content"};f._collectResourceTiming&&f._resourceTiming&&f._resourceTiming.length>0&&(P.resourceTiming=f._resourceTiming,f._resourceTiming=[]),f.fire(new m.Event("data",P))}}),this},c.prototype.getClusterExpansionZoom=function(u,f){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:u,source:this.id},f),this},c.prototype.getClusterChildren=function(u,f){return this.actor.send("geojson.getClusterChildren",{clusterId:u,source:this.id},f),this},c.prototype.getClusterLeaves=function(u,f,T,P){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:u,limit:f,offset:T},P),this},c.prototype._updateWorkerData=function(u){var f=this;this._loaded=!1;var T=m.extend({},this.workerOptions),P=this._data;typeof P=="string"?(T.request=this.map._requestManager.transformRequest(m.browser.resolveURL(P),m.ResourceType.Source),T.request.collectResourceTiming=this._collectResourceTiming):T.data=JSON.stringify(P),this.actor.send(this.type+".loadData",T,function(M,F){f._removed||F&&F.abandoned||(f._loaded=!0,F&&F.resourceTiming&&F.resourceTiming[f.id]&&(f._resourceTiming=F.resourceTiming[f.id].slice(0)),f.actor.send(f.type+".coalesce",{source:T.source},null),u(M))})},c.prototype.loaded=function(){return this._loaded},c.prototype.loadTile=function(u,f){var T=this,P=u.actor?"reloadTile":"loadTile";u.actor=this.actor,u.request=this.actor.send(P,{type:this.type,uid:u.uid,tileID:u.tileID,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:m.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(M,F){return delete u.request,u.unloadVectorData(),u.aborted?f(null):M?f(M):(u.loadVectorData(F,T.map.painter,P==="reloadTile"),f(null))})},c.prototype.abortTile=function(u){u.request&&(u.request.cancel(),delete u.request),u.aborted=!0},c.prototype.unloadTile=function(u){u.unloadVectorData(),this.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id})},c.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},c.prototype.serialize=function(){return m.extend({},this._options,{type:this.type,data:this._data})},c.prototype.hasTransition=function(){return!1},c}(m.Evented),Vr=m.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),nn=function(s){function c(u,f,T,P){s.call(this),this.id=u,this.dispatcher=T,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(P),this.options=f}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.load=function(u,f){var T=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this.url=this.options.url,m.getImage(this.map._requestManager.transformRequest(this.url,m.ResourceType.Image),function(P,M){T._loaded=!0,P?T.fire(new m.ErrorEvent(P)):M&&(T.image=M,u&&(T.coordinates=u),f&&f(),T._finishLoading())})},c.prototype.loaded=function(){return this._loaded},c.prototype.updateImage=function(u){var f=this;return this.image&&u.url?(this.options.url=u.url,this.load(u.coordinates,function(){f.texture=null}),this):this},c.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})))},c.prototype.onAdd=function(u){this.map=u,this.load()},c.prototype.setCoordinates=function(u){var f=this;this.coordinates=u;var T=u.map(m.MercatorCoordinate.fromLngLat);this.tileID=function(M){for(var F=1/0,X=1/0,Y=-1/0,le=-1/0,ce=0,de=M;ce<de.length;ce+=1){var Ce=de[ce];F=Math.min(F,Ce.x),X=Math.min(X,Ce.y),Y=Math.max(Y,Ce.x),le=Math.max(le,Ce.y)}var Ae=Math.max(Y-F,le-X),ke=Math.max(0,Math.floor(-Math.log(Ae)/Math.LN2)),xe=Math.pow(2,ke);return new m.CanonicalTileID(ke,Math.floor((F+Y)/2*xe),Math.floor((X+le)/2*xe))}(T),this.minzoom=this.maxzoom=this.tileID.z;var P=T.map(function(M){return f.tileID.getTilePoint(M)._round()});return this._boundsArray=new m.StructArrayLayout4i8,this._boundsArray.emplaceBack(P[0].x,P[0].y,0,0),this._boundsArray.emplaceBack(P[1].x,P[1].y,m.EXTENT,0),this._boundsArray.emplaceBack(P[3].x,P[3].y,0,m.EXTENT),this._boundsArray.emplaceBack(P[2].x,P[2].y,m.EXTENT,m.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})),this},c.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var u=this.map.painter.context,f=u.gl;for(var T in this.boundsBuffer||(this.boundsBuffer=u.createVertexBuffer(this._boundsArray,Vr.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new m.Texture(u,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE)),this.tiles){var P=this.tiles[T];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},c.prototype.loadTile=function(u,f){this.tileID&&this.tileID.equals(u.tileID.canonical)?(this.tiles[String(u.tileID.wrap)]=u,u.buckets={},f(null)):(u.state="errored",f(null))},c.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},c.prototype.hasTransition=function(){return!1},c}(m.Evented),cn=function(s){function c(u,f,T,P){s.call(this,u,f,T,P),this.roundZoom=!0,this.type="video",this.options=f}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.load=function(){var u=this;this._loaded=!1;var f=this.options;this.urls=[];for(var T=0,P=f.urls;T<P.length;T+=1)this.urls.push(this.map._requestManager.transformRequest(P[T],m.ResourceType.Source).url);m.getVideo(this.urls,function(M,F){u._loaded=!0,M?u.fire(new m.ErrorEvent(M)):F&&(u.video=F,u.video.loop=!0,u.video.addEventListener("playing",function(){u.map.triggerRepaint()}),u.map&&u.video.play(),u._finishLoading())})},c.prototype.pause=function(){this.video&&this.video.pause()},c.prototype.play=function(){this.video&&this.video.play()},c.prototype.seek=function(u){if(this.video){var f=this.video.seekable;u<f.start(0)||u>f.end(0)?this.fire(new m.ErrorEvent(new m.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+f.start(0)+" and "+f.end(0)+"-second mark."))):this.video.currentTime=u}},c.prototype.getVideo=function(){return this.video},c.prototype.onAdd=function(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},c.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var u=this.map.painter.context,f=u.gl;for(var T in this.boundsBuffer||(this.boundsBuffer=u.createVertexBuffer(this._boundsArray,Vr.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE),f.texSubImage2D(f.TEXTURE_2D,0,0,0,f.RGBA,f.UNSIGNED_BYTE,this.video)):(this.texture=new m.Texture(u,this.video,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE)),this.tiles){var P=this.tiles[T];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},c.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},c.prototype.hasTransition=function(){return this.video&&!this.video.paused},c}(nn),oi=function(s){function c(u,f,T,P){s.call(this,u,f,T,P),f.coordinates?Array.isArray(f.coordinates)&&f.coordinates.length===4&&!f.coordinates.some(function(M){return!Array.isArray(M)||M.length!==2||M.some(function(F){return typeof F!="number"})})||this.fire(new m.ErrorEvent(new m.ValidationError("sources."+u,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new m.ErrorEvent(new m.ValidationError("sources."+u,null,'missing required property "coordinates"'))),f.animate&&typeof f.animate!="boolean"&&this.fire(new m.ErrorEvent(new m.ValidationError("sources."+u,null,'optional "animate" property must be a boolean value'))),f.canvas?typeof f.canvas=="string"||f.canvas instanceof m.window.HTMLCanvasElement||this.fire(new m.ErrorEvent(new m.ValidationError("sources."+u,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new m.ErrorEvent(new m.ValidationError("sources."+u,null,'missing required property "canvas"'))),this.options=f,this.animate=f.animate===void 0||f.animate}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof m.window.HTMLCanvasElement?this.options.canvas:m.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new m.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},c.prototype.getCanvas=function(){return this.canvas},c.prototype.onAdd=function(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()},c.prototype.onRemove=function(){this.pause()},c.prototype.prepare=function(){var u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var f=this.map.painter.context,T=f.gl;for(var P in this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,Vr.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(u||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new m.Texture(f,this.canvas,T.RGBA,{premultiply:!0}),this.tiles){var M=this.tiles[P];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture)}}},c.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},c.prototype.hasTransition=function(){return this._playing},c.prototype._hasInvalidDimensions=function(){for(var u=0,f=[this.canvas.width,this.canvas.height];u<f.length;u+=1){var T=f[u];if(isNaN(T)||T<=0)return!0}return!1},c}(nn),$r={vector:Lr,raster:un,"raster-dem":Fn,geojson:Dr,video:cn,image:nn,canvas:oi};function Hr(s,c){var u=m.identity([]);return m.translate(u,u,[1,1,0]),m.scale(u,u,[.5*s.width,.5*s.height,1]),m.multiply(u,u,s.calculatePosMatrix(c.toUnwrapped()))}function wr(s,c,u,f,T,P){var M=function(ke,xe,ze){if(ke)for(var Be=0,Ge=ke;Be<Ge.length;Be+=1){var Je=xe[Ge[Be]];if(Je&&Je.source===ze&&Je.type==="fill-extrusion")return!0}else for(var Ye in xe){var Qe=xe[Ye];if(Qe.source===ze&&Qe.type==="fill-extrusion")return!0}return!1}(T&&T.layers,c,s.id),F=P.maxPitchScaleFactor(),X=s.tilesIn(f,F,M);X.sort(hn);for(var Y=[],le=0,ce=X;le<ce.length;le+=1){var de=ce[le];Y.push({wrappedTileID:de.tileID.wrapped().key,queryResults:de.tile.queryRenderedFeatures(c,u,s._state,de.queryGeometry,de.cameraQueryGeometry,de.scale,T,P,F,Hr(s.transform,de.tileID))})}var Ce=function(ke){for(var xe={},ze={},Be=0,Ge=ke;Be<Ge.length;Be+=1){var Je=Ge[Be],Ye=Je.queryResults,Qe=Je.wrappedTileID,ht=ze[Qe]=ze[Qe]||{};for(var bt in Ye)for(var xt=Ye[bt],Dt=ht[bt]=ht[bt]||{},Yt=xe[bt]=xe[bt]||[],ti=0,Jt=xt;ti<Jt.length;ti+=1){var Mi=Jt[ti];Dt[Mi.featureIndex]||(Dt[Mi.featureIndex]=!0,Yt.push(Mi))}}return xe}(Y);for(var Ae in Ce)Ce[Ae].forEach(function(ke){var xe=ke.feature,ze=s.getFeatureState(xe.layer["source-layer"],xe.id);xe.source=xe.layer.source,xe.layer["source-layer"]&&(xe.sourceLayer=xe.layer["source-layer"]),xe.state=ze});return Ce}function hn(s,c){var u=s.tileID,f=c.tileID;return u.overscaledZ-f.overscaledZ||u.canonical.y-f.canonical.y||u.wrap-f.wrap||u.canonical.x-f.canonical.x}var Fi=function(s,c){this.max=s,this.onRemove=c,this.reset()};Fi.prototype.reset=function(){for(var s in this.data)for(var c=0,u=this.data[s];c<u.length;c+=1){var f=u[c];f.timeout&&clearTimeout(f.timeout),this.onRemove(f.value)}return this.data={},this.order=[],this},Fi.prototype.add=function(s,c,u){var f=this,T=s.wrapped().key;this.data[T]===void 0&&(this.data[T]=[]);var P={value:c,timeout:void 0};if(u!==void 0&&(P.timeout=setTimeout(function(){f.remove(s,P)},u)),this.data[T].push(P),this.order.push(T),this.order.length>this.max){var M=this._getAndRemoveByKey(this.order[0]);M&&this.onRemove(M)}return this},Fi.prototype.has=function(s){return s.wrapped().key in this.data},Fi.prototype.getAndRemove=function(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null},Fi.prototype._getAndRemoveByKey=function(s){var c=this.data[s].shift();return c.timeout&&clearTimeout(c.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),c.value},Fi.prototype.getByKey=function(s){var c=this.data[s];return c?c[0].value:null},Fi.prototype.get=function(s){return this.has(s)?this.data[s.wrapped().key][0].value:null},Fi.prototype.remove=function(s,c){if(!this.has(s))return this;var u=s.wrapped().key,f=c===void 0?0:this.data[u].indexOf(c),T=this.data[u][f];return this.data[u].splice(f,1),T.timeout&&clearTimeout(T.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(T.value),this.order.splice(this.order.indexOf(u),1),this},Fi.prototype.setMaxSize=function(s){for(this.max=s;this.order.length>this.max;){var c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this},Fi.prototype.filter=function(s){var c=[];for(var u in this.data)for(var f=0,T=this.data[u];f<T.length;f+=1){var P=T[f];s(P.value)||c.push(P)}for(var M=0,F=c;M<F.length;M+=1){var X=F[M];this.remove(X.value.tileID,X)}};var Ut=function(s,c,u){this.context=s;var f=s.gl;this.buffer=f.createBuffer(),this.dynamicDraw=Boolean(u),this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer};Ut.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},Ut.prototype.updateData=function(s){var c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)},Ut.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Nr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},to=function(s,c,u,f){this.length=c.length,this.attributes=u,this.itemSize=c.bytesPerElement,this.dynamicDraw=f,this.context=s;var T=s.gl;this.buffer=T.createBuffer(),s.bindVertexBuffer.set(this.buffer),T.bufferData(T.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer};to.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},to.prototype.updateData=function(s){var c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,s.arrayBuffer)},to.prototype.enableAttributes=function(s,c){for(var u=0;u<this.attributes.length;u++){var f=c.attributes[this.attributes[u].name];f!==void 0&&s.enableVertexAttribArray(f)}},to.prototype.setVertexAttribPointers=function(s,c,u){for(var f=0;f<this.attributes.length;f++){var T=this.attributes[f],P=c.attributes[T.name];P!==void 0&&s.vertexAttribPointer(P,T.components,s[Nr[T.type]],!1,this.itemSize,T.offset+this.itemSize*(u||0))}},to.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var ci=function(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};ci.prototype.get=function(){return this.current},ci.prototype.set=function(s){},ci.prototype.getDefault=function(){return this.default},ci.prototype.setDefault=function(){this.set(this.default)};var Hn=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return m.Color.transparent},c.prototype.set=function(u){var f=this.current;(u.r!==f.r||u.g!==f.g||u.b!==f.b||u.a!==f.a||this.dirty)&&(this.gl.clearColor(u.r,u.g,u.b,u.a),this.current=u,this.dirty=!1)},c}(ci),pn=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return 1},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.clearDepth(u),this.current=u,this.dirty=!1)},c}(ci),Sn=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return 0},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.clearStencil(u),this.current=u,this.dirty=!1)},c}(ci),ko=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return[!0,!0,!0,!0]},c.prototype.set=function(u){var f=this.current;(u[0]!==f[0]||u[1]!==f[1]||u[2]!==f[2]||u[3]!==f[3]||this.dirty)&&(this.gl.colorMask(u[0],u[1],u[2],u[3]),this.current=u,this.dirty=!1)},c}(ci),io=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return!0},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.depthMask(u),this.current=u,this.dirty=!1)},c}(ci),vo=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return 255},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.stencilMask(u),this.current=u,this.dirty=!1)},c}(ci),Wr=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},c.prototype.set=function(u){var f=this.current;(u.func!==f.func||u.ref!==f.ref||u.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(u.func,u.ref,u.mask),this.current=u,this.dirty=!1)},c}(ci),Un=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){var u=this.gl;return[u.KEEP,u.KEEP,u.KEEP]},c.prototype.set=function(u){var f=this.current;(u[0]!==f[0]||u[1]!==f[1]||u[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(u[0],u[1],u[2]),this.current=u,this.dirty=!1)},c}(ci),Yo=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return!1},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;u?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=u,this.dirty=!1}},c}(ci),wi=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return[0,1]},c.prototype.set=function(u){var f=this.current;(u[0]!==f[0]||u[1]!==f[1]||this.dirty)&&(this.gl.depthRange(u[0],u[1]),this.current=u,this.dirty=!1)},c}(ci),Tn=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return!1},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;u?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=u,this.dirty=!1}},c}(ci),ro=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return this.gl.LESS},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.depthFunc(u),this.current=u,this.dirty=!1)},c}(ci),kn=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return!1},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;u?f.enable(f.BLEND):f.disable(f.BLEND),this.current=u,this.dirty=!1}},c}(ci),Ma=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){var u=this.gl;return[u.ONE,u.ZERO]},c.prototype.set=function(u){var f=this.current;(u[0]!==f[0]||u[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(u[0],u[1]),this.current=u,this.dirty=!1)},c}(ci),st=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return m.Color.transparent},c.prototype.set=function(u){var f=this.current;(u.r!==f.r||u.g!==f.g||u.b!==f.b||u.a!==f.a||this.dirty)&&(this.gl.blendColor(u.r,u.g,u.b,u.a),this.current=u,this.dirty=!1)},c}(ci),Rt=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return this.gl.FUNC_ADD},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.blendEquation(u),this.current=u,this.dirty=!1)},c}(ci),Vo=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return!1},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;u?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=u,this.dirty=!1}},c}(ci),no=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return this.gl.BACK},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.cullFace(u),this.current=u,this.dirty=!1)},c}(ci),or=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return this.gl.CCW},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.frontFace(u),this.current=u,this.dirty=!1)},c}(ci),Mn=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return null},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.useProgram(u),this.current=u,this.dirty=!1)},c}(ci),dn=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return this.gl.TEXTURE0},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.activeTexture(u),this.current=u,this.dirty=!1)},c}(ci),xo=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){var u=this.gl;return[0,0,u.drawingBufferWidth,u.drawingBufferHeight]},c.prototype.set=function(u){var f=this.current;(u[0]!==f[0]||u[1]!==f[1]||u[2]!==f[2]||u[3]!==f[3]||this.dirty)&&(this.gl.viewport(u[0],u[1],u[2],u[3]),this.current=u,this.dirty=!1)},c}(ci),ur=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return null},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,u),this.current=u,this.dirty=!1}},c}(ci),kt=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return null},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,u),this.current=u,this.dirty=!1}},c}(ci),zi=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return null},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;f.bindTexture(f.TEXTURE_2D,u),this.current=u,this.dirty=!1}},c}(ci),Ei=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return null},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,u),this.current=u,this.dirty=!1}},c}(ci),Kr=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return null},c.prototype.set=function(u){var f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,u),this.current=u,this.dirty=!1},c}(ci),fn=function(s){function c(u){s.call(this,u),this.vao=u.extVertexArrayObject}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return null},c.prototype.set=function(u){this.vao&&(u!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(u),this.current=u,this.dirty=!1)},c}(ci),yi=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return 4},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,u),this.current=u,this.dirty=!1}},c}(ci),Mo=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return!1},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,u),this.current=u,this.dirty=!1}},c}(ci),Wn=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return!1},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,u),this.current=u,this.dirty=!1}},c}(ci),ar=function(s){function c(u,f){s.call(this,u),this.context=u,this.parent=f}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return null},c}(ci),J=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.setDirty=function(){this.dirty=!0},c.prototype.set=function(u){if(u!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,u,0),this.current=u,this.dirty=!1}},c}(ar),te=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.set=function(u){if(u!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.RENDERBUFFER,u),this.current=u,this.dirty=!1}},c}(ar),oe=function(s,c,u,f){this.context=s,this.width=c,this.height=u;var T=this.framebuffer=s.gl.createFramebuffer();this.colorAttachment=new J(s,T),f&&(this.depthAttachment=new te(s,T))};oe.prototype.destroy=function(){var s=this.context.gl,c=this.colorAttachment.get();if(c&&s.deleteTexture(c),this.depthAttachment){var u=this.depthAttachment.get();u&&s.deleteRenderbuffer(u)}s.deleteFramebuffer(this.framebuffer)};var me=function(s,c,u){this.func=s,this.mask=c,this.range=u};me.ReadOnly=!1,me.ReadWrite=!0,me.disabled=new me(519,me.ReadOnly,[0,1]);var Te=function(s,c,u,f,T,P){this.test=s,this.ref=c,this.mask=u,this.fail=f,this.depthFail=T,this.pass=P};Te.disabled=new Te({func:519,mask:0},0,0,7680,7680,7680);var Re=function(s,c,u){this.blendFunction=s,this.blendColor=c,this.mask=u};Re.disabled=new Re(Re.Replace=[1,0],m.Color.transparent,[!1,!1,!1,!1]),Re.unblended=new Re(Re.Replace,m.Color.transparent,[!0,!0,!0,!0]),Re.alphaBlended=new Re([1,771],m.Color.transparent,[!0,!0,!0,!0]);var Oe=function(s,c,u){this.enable=s,this.mode=c,this.frontFace=u};Oe.disabled=new Oe(!1,1029,2305),Oe.backCCW=new Oe(!0,1029,2305);var fe=function(s){this.gl=s,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Hn(this),this.clearDepth=new pn(this),this.clearStencil=new Sn(this),this.colorMask=new ko(this),this.depthMask=new io(this),this.stencilMask=new vo(this),this.stencilFunc=new Wr(this),this.stencilOp=new Un(this),this.stencilTest=new Yo(this),this.depthRange=new wi(this),this.depthTest=new Tn(this),this.depthFunc=new ro(this),this.blend=new kn(this),this.blendFunc=new Ma(this),this.blendColor=new st(this),this.blendEquation=new Rt(this),this.cullFace=new Vo(this),this.cullFaceSide=new no(this),this.frontFace=new or(this),this.program=new Mn(this),this.activeTexture=new dn(this),this.viewport=new xo(this),this.bindFramebuffer=new ur(this),this.bindRenderbuffer=new kt(this),this.bindTexture=new zi(this),this.bindVertexBuffer=new Ei(this),this.bindElementBuffer=new Kr(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new fn(this),this.pixelStoreUnpack=new yi(this),this.pixelStoreUnpackPremultiplyAlpha=new Mo(this),this.pixelStoreUnpackFlipY=new Wn(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=s.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(s.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE)};fe.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},fe.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},fe.prototype.createIndexBuffer=function(s,c){return new Ut(this,s,c)},fe.prototype.createVertexBuffer=function(s,c,u){return new to(this,s,c,u)},fe.prototype.createRenderbuffer=function(s,c,u){var f=this.gl,T=f.createRenderbuffer();return this.bindRenderbuffer.set(T),f.renderbufferStorage(f.RENDERBUFFER,s,c,u),this.bindRenderbuffer.set(null),T},fe.prototype.createFramebuffer=function(s,c,u){return new oe(this,s,c,u)},fe.prototype.clear=function(s){var c=s.color,u=s.depth,f=this.gl,T=0;c&&(T|=f.COLOR_BUFFER_BIT,this.clearColor.set(c),this.colorMask.set([!0,!0,!0,!0])),u!==void 0&&(T|=f.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),f.clear(T)},fe.prototype.setCullFace=function(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))},fe.prototype.setDepthMode=function(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)},fe.prototype.setStencilMode=function(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)},fe.prototype.setColorMode=function(s){m.deepEqual(s.blendFunction,Re.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)},fe.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Pe=function(s){function c(u,f,T){var P=this;s.call(this),this.id=u,this.dispatcher=T,this.on("data",function(M){M.dataType==="source"&&M.sourceDataType==="metadata"&&(P._sourceLoaded=!0),P._sourceLoaded&&!P._paused&&M.dataType==="source"&&M.sourceDataType==="content"&&(P.reload(),P.transform&&P.update(P.transform))}),this.on("error",function(){P._sourceErrored=!0}),this._source=function(M,F,X,Y){var le=new $r[F.type](M,F,X,Y);if(le.id!==M)throw new Error("Expected Source id to be "+M+" instead of "+le.id);return m.bindAll(["load","abort","unload","serialize","prepare"],le),le}(u,f,T,this),this._tiles={},this._cache=new Fi(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new m.SourceFeatureState}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.onAdd=function(u){this.map=u,this._maxTileCacheSize=u?u._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(u)},c.prototype.onRemove=function(u){this._source&&this._source.onRemove&&this._source.onRemove(u)},c.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var u in this._tiles){var f=this._tiles[u];if(f.state!=="loaded"&&f.state!=="errored")return!1}return!0},c.prototype.getSource=function(){return this._source},c.prototype.pause=function(){this._paused=!0},c.prototype.resume=function(){if(this._paused){var u=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,u&&this.reload(),this.transform&&this.update(this.transform)}},c.prototype._loadTile=function(u,f){return this._source.loadTile(u,f)},c.prototype._unloadTile=function(u){if(this._source.unloadTile)return this._source.unloadTile(u,function(){})},c.prototype._abortTile=function(u){if(this._source.abortTile)return this._source.abortTile(u,function(){})},c.prototype.serialize=function(){return this._source.serialize()},c.prototype.prepare=function(u){for(var f in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var T=this._tiles[f];T.upload(u),T.prepare(this.map.style.imageManager)}},c.prototype.getIds=function(){return m.values(this._tiles).map(function(u){return u.tileID}).sort(Xe).map(function(u){return u.key})},c.prototype.getRenderableIds=function(u){var f=this,T=[];for(var P in this._tiles)this._isIdRenderable(P,u)&&T.push(this._tiles[P]);return u?T.sort(function(M,F){var X=M.tileID,Y=F.tileID,le=new m.Point(X.canonical.x,X.canonical.y)._rotate(f.transform.angle),ce=new m.Point(Y.canonical.x,Y.canonical.y)._rotate(f.transform.angle);return X.overscaledZ-Y.overscaledZ||ce.y-le.y||ce.x-le.x}).map(function(M){return M.tileID.key}):T.map(function(M){return M.tileID}).sort(Xe).map(function(M){return M.key})},c.prototype.hasRenderableParent=function(u){var f=this.findLoadedParent(u,0);return!!f&&this._isIdRenderable(f.tileID.key)},c.prototype._isIdRenderable=function(u,f){return this._tiles[u]&&this._tiles[u].hasData()&&!this._coveredTiles[u]&&(f||!this._tiles[u].holdingForFade())},c.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var u in this._cache.reset(),this._tiles)this._tiles[u].state!=="errored"&&this._reloadTile(u,"reloading")},c.prototype._reloadTile=function(u,f){var T=this._tiles[u];T&&(T.state!=="loading"&&(T.state=f),this._loadTile(T,this._tileLoaded.bind(this,T,u,f)))},c.prototype._tileLoaded=function(u,f,T,P){if(P)return u.state="errored",void(P.status!==404?this._source.fire(new m.ErrorEvent(P,{tile:u})):this.update(this.transform));u.timeAdded=m.browser.now(),T==="expired"&&(u.refreshedUponExpiration=!0),this._setTileReloadTimer(f,u),this.getSource().type==="raster-dem"&&u.dem&&this._backfillDEM(u),this._state.initializeTileState(u,this.map?this.map.painter:null),this._source.fire(new m.Event("data",{dataType:"source",tile:u,coord:u.tileID}))},c.prototype._backfillDEM=function(u){for(var f=this.getRenderableIds(),T=0;T<f.length;T++){var P=f[T];if(u.neighboringTiles&&u.neighboringTiles[P]){var M=this.getTileByID(P);F(u,M),F(M,u)}}function F(X,Y){X.needsHillshadePrepare=!0;var le=Y.tileID.canonical.x-X.tileID.canonical.x,ce=Y.tileID.canonical.y-X.tileID.canonical.y,de=Math.pow(2,X.tileID.canonical.z),Ce=Y.tileID.key;le===0&&ce===0||Math.abs(ce)>1||(Math.abs(le)>1&&(Math.abs(le+de)===1?le+=de:Math.abs(le-de)===1&&(le-=de)),Y.dem&&X.dem&&(X.dem.backfillBorder(Y.dem,le,ce),X.neighboringTiles&&X.neighboringTiles[Ce]&&(X.neighboringTiles[Ce].backfilled=!0)))}},c.prototype.getTile=function(u){return this.getTileByID(u.key)},c.prototype.getTileByID=function(u){return this._tiles[u]},c.prototype._retainLoadedChildren=function(u,f,T,P){for(var M in this._tiles){var F=this._tiles[M];if(!(P[M]||!F.hasData()||F.tileID.overscaledZ<=f||F.tileID.overscaledZ>T)){for(var X=F.tileID;F&&F.tileID.overscaledZ>f+1;){var Y=F.tileID.scaledTo(F.tileID.overscaledZ-1);(F=this._tiles[Y.key])&&F.hasData()&&(X=Y)}for(var le=X;le.overscaledZ>f;)if(u[(le=le.scaledTo(le.overscaledZ-1)).key]){P[X.key]=X;break}}}},c.prototype.findLoadedParent=function(u,f){if(u.key in this._loadedParentTiles){var T=this._loadedParentTiles[u.key];return T&&T.tileID.overscaledZ>=f?T:null}for(var P=u.overscaledZ-1;P>=f;P--){var M=u.scaledTo(P),F=this._getLoadedTile(M);if(F)return F}},c.prototype._getLoadedTile=function(u){var f=this._tiles[u.key];return f&&f.hasData()?f:this._cache.getByKey(u.wrapped().key)},c.prototype.updateCacheSize=function(u){var f=Math.ceil(u.width/this._source.tileSize)+1,T=Math.ceil(u.height/this._source.tileSize)+1,P=Math.floor(f*T*5),M=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,P):P;this._cache.setMaxSize(M)},c.prototype.handleWrapJump=function(u){var f=Math.round((u-(this._prevLng===void 0?u:this._prevLng))/360);if(this._prevLng=u,f){var T={};for(var P in this._tiles){var M=this._tiles[P];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+f),T[M.tileID.key]=M}for(var F in this._tiles=T,this._timers)clearTimeout(this._timers[F]),delete this._timers[F];for(var X in this._tiles)this._setTileReloadTimer(X,this._tiles[X])}},c.prototype.update=function(u){var f=this;if(this.transform=u,this._sourceLoaded&&!this._paused){var T;this.updateCacheSize(u),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?T=u.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(ht){return new m.OverscaledTileID(ht.canonical.z,ht.wrap,ht.canonical.z,ht.canonical.x,ht.canonical.y)}):(T=u.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(T=T.filter(function(ht){return f._source.hasTile(ht)}))):T=[];var P=u.coveringZoomLevel(this._source),M=Math.max(P-c.maxOverzooming,this._source.minzoom),F=Math.max(P+c.maxUnderzooming,this._source.minzoom),X=this._updateRetainedTiles(T,P);if(ie(this._source.type)){for(var Y={},le={},ce=0,de=Object.keys(X);ce<de.length;ce+=1){var Ce=de[ce],Ae=X[Ce],ke=this._tiles[Ce];if(ke&&!(ke.fadeEndTime&&ke.fadeEndTime<=m.browser.now())){var xe=this.findLoadedParent(Ae,M);xe&&(this._addTile(xe.tileID),Y[xe.tileID.key]=xe.tileID),le[Ce]=Ae}}for(var ze in this._retainLoadedChildren(le,P,F,X),Y)X[ze]||(this._coveredTiles[ze]=!0,X[ze]=Y[ze])}for(var Be in X)this._tiles[Be].clearFadeHold();for(var Ge=0,Je=m.keysDifference(this._tiles,X);Ge<Je.length;Ge+=1){var Ye=Je[Ge],Qe=this._tiles[Ye];Qe.hasSymbolBuckets&&!Qe.holdingForFade()?Qe.setHoldDuration(this.map._fadeDuration):Qe.hasSymbolBuckets&&!Qe.symbolFadeFinished()||this._removeTile(Ye)}this._updateLoadedParentTileCache()}},c.prototype.releaseSymbolFadeTiles=function(){for(var u in this._tiles)this._tiles[u].holdingForFade()&&this._removeTile(u)},c.prototype._updateRetainedTiles=function(u,f){for(var T={},P={},M=Math.max(f-c.maxOverzooming,this._source.minzoom),F=Math.max(f+c.maxUnderzooming,this._source.minzoom),X={},Y=0,le=u;Y<le.length;Y+=1){var ce=le[Y],de=this._addTile(ce);T[ce.key]=ce,de.hasData()||f<this._source.maxzoom&&(X[ce.key]=ce)}this._retainLoadedChildren(X,f,F,T);for(var Ce=0,Ae=u;Ce<Ae.length;Ce+=1){var ke=Ae[Ce],xe=this._tiles[ke.key];if(!xe.hasData()){if(f+1>this._source.maxzoom){var ze=ke.children(this._source.maxzoom)[0],Be=this.getTile(ze);if(Be&&Be.hasData()){T[ze.key]=ze;continue}}else{var Ge=ke.children(this._source.maxzoom);if(T[Ge[0].key]&&T[Ge[1].key]&&T[Ge[2].key]&&T[Ge[3].key])continue}for(var Je=xe.wasRequested(),Ye=ke.overscaledZ-1;Ye>=M;--Ye){var Qe=ke.scaledTo(Ye);if(P[Qe.key]||(P[Qe.key]=!0,!(xe=this.getTile(Qe))&&Je&&(xe=this._addTile(Qe)),xe&&(T[Qe.key]=Qe,Je=xe.wasRequested(),xe.hasData())))break}}}return T},c.prototype._updateLoadedParentTileCache=function(){for(var u in this._loadedParentTiles={},this._tiles){for(var f=[],T=void 0,P=this._tiles[u].tileID;P.overscaledZ>0;){if(P.key in this._loadedParentTiles){T=this._loadedParentTiles[P.key];break}f.push(P.key);var M=P.scaledTo(P.overscaledZ-1);if(T=this._getLoadedTile(M))break;P=M}for(var F=0,X=f;F<X.length;F+=1)this._loadedParentTiles[X[F]]=T}},c.prototype._addTile=function(u){var f=this._tiles[u.key];if(f)return f;(f=this._cache.getAndRemove(u))&&(this._setTileReloadTimer(u.key,f),f.tileID=u,this._state.initializeTileState(f,this.map?this.map.painter:null),this._cacheTimers[u.key]&&(clearTimeout(this._cacheTimers[u.key]),delete this._cacheTimers[u.key],this._setTileReloadTimer(u.key,f)));var T=Boolean(f);return T||(f=new m.Tile(u,this._source.tileSize*u.overscaleFactor()),this._loadTile(f,this._tileLoaded.bind(this,f,u.key,f.state))),f?(f.uses++,this._tiles[u.key]=f,T||this._source.fire(new m.Event("dataloading",{tile:f,coord:f.tileID,dataType:"source"})),f):null},c.prototype._setTileReloadTimer=function(u,f){var T=this;u in this._timers&&(clearTimeout(this._timers[u]),delete this._timers[u]);var P=f.getExpiryTimeout();P&&(this._timers[u]=setTimeout(function(){T._reloadTile(u,"expired"),delete T._timers[u]},P))},c.prototype._removeTile=function(u){var f=this._tiles[u];f&&(f.uses--,delete this._tiles[u],this._timers[u]&&(clearTimeout(this._timers[u]),delete this._timers[u]),f.uses>0||(f.hasData()&&f.state!=="reloading"?this._cache.add(f.tileID,f,f.getExpiryTimeout()):(f.aborted=!0,this._abortTile(f),this._unloadTile(f))))},c.prototype.clearTiles=function(){for(var u in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(u);this._cache.reset()},c.prototype.tilesIn=function(u,f,T){var P=this,M=[],F=this.transform;if(!F)return M;for(var X=T?F.getCameraQueryGeometry(u):u,Y=u.map(function(Ye){return F.pointCoordinate(Ye)}),le=X.map(function(Ye){return F.pointCoordinate(Ye)}),ce=this.getIds(),de=1/0,Ce=1/0,Ae=-1/0,ke=-1/0,xe=0,ze=le;xe<ze.length;xe+=1){var Be=ze[xe];de=Math.min(de,Be.x),Ce=Math.min(Ce,Be.y),Ae=Math.max(Ae,Be.x),ke=Math.max(ke,Be.y)}for(var Ge=function(Ye){var Qe=P._tiles[ce[Ye]];if(!Qe.holdingForFade()){var ht=Qe.tileID,bt=Math.pow(2,F.zoom-Qe.tileID.overscaledZ),xt=f*Qe.queryPadding*m.EXTENT/Qe.tileSize/bt,Dt=[ht.getTilePoint(new m.MercatorCoordinate(de,Ce)),ht.getTilePoint(new m.MercatorCoordinate(Ae,ke))];if(Dt[0].x-xt<m.EXTENT&&Dt[0].y-xt<m.EXTENT&&Dt[1].x+xt>=0&&Dt[1].y+xt>=0){var Yt=Y.map(function(Jt){return ht.getTilePoint(Jt)}),ti=le.map(function(Jt){return ht.getTilePoint(Jt)});M.push({tile:Qe,tileID:ht,queryGeometry:Yt,cameraQueryGeometry:ti,scale:bt})}}},Je=0;Je<ce.length;Je++)Ge(Je);return M},c.prototype.getVisibleCoordinates=function(u){for(var f=this,T=this.getRenderableIds(u).map(function(X){return f._tiles[X].tileID}),P=0,M=T;P<M.length;P+=1){var F=M[P];F.posMatrix=this.transform.calculatePosMatrix(F.toUnwrapped())}return T},c.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(ie(this._source.type))for(var u in this._tiles){var f=this._tiles[u];if(f.fadeEndTime!==void 0&&f.fadeEndTime>=m.browser.now())return!0}return!1},c.prototype.setFeatureState=function(u,f,T){this._state.updateState(u=u||"_geojsonTileLayer",f,T)},c.prototype.removeFeatureState=function(u,f,T){this._state.removeFeatureState(u=u||"_geojsonTileLayer",f,T)},c.prototype.getFeatureState=function(u,f){return this._state.getState(u=u||"_geojsonTileLayer",f)},c.prototype.setDependencies=function(u,f,T){var P=this._tiles[u];P&&P.setDependencies(f,T)},c.prototype.reloadTilesForDependencies=function(u,f){for(var T in this._tiles)this._tiles[T].hasDependency(u,f)&&this._reloadTile(T,"reloading");this._cache.filter(function(P){return!P.hasDependency(u,f)})},c}(m.Evented);function Xe(s,c){var u=Math.abs(2*s.wrap)-+(s.wrap<0),f=Math.abs(2*c.wrap)-+(c.wrap<0);return s.overscaledZ-c.overscaledZ||f-u||c.canonical.y-s.canonical.y||c.canonical.x-s.canonical.x}function ie(s){return s==="raster"||s==="image"||s==="video"}function N(){return new m.window.Worker(gi.workerUrl)}Pe.maxOverzooming=10,Pe.maxUnderzooming=3;var j="mapboxgl_preloaded_worker_pool",ee=function(){this.active={}};ee.prototype.acquire=function(s){if(!this.workers)for(this.workers=[];this.workers.length<ee.workerCount;)this.workers.push(new N);return this.active[s]=!0,this.workers.slice()},ee.prototype.release=function(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach(function(c){c.terminate()}),this.workers=null)},ee.prototype.isPreloaded=function(){return!!this.active[j]},ee.prototype.numActive=function(){return Object.keys(this.active).length};var se,ge=Math.floor(m.browser.hardwareConcurrency/2);function pe(){return se||(se=new ee),se}function Ee(s,c){var u={};for(var f in s)f!=="ref"&&(u[f]=s[f]);return m.refProperties.forEach(function(T){T in c&&(u[T]=c[T])}),u}function we(s){s=s.slice();for(var c=Object.create(null),u=0;u<s.length;u++)c[s[u].id]=s[u];for(var f=0;f<s.length;f++)"ref"in s[f]&&(s[f]=Ee(s[f],c[s[f].ref]));return s}ee.workerCount=Math.max(Math.min(ge,6),1);var Se={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function $e(s,c,u){u.push({command:Se.addSource,args:[s,c[s]]})}function je(s,c,u){c.push({command:Se.removeSource,args:[s]}),u[s]=!0}function He(s,c,u,f){je(s,u,f),$e(s,c,u)}function Tt(s,c,u){var f;for(f in s[u])if(s[u].hasOwnProperty(f)&&f!=="data"&&!m.deepEqual(s[u][f],c[u][f]))return!1;for(f in c[u])if(c[u].hasOwnProperty(f)&&f!=="data"&&!m.deepEqual(s[u][f],c[u][f]))return!1;return!0}function ft(s,c,u,f,T,P){var M;for(M in c=c||{},s=s||{})s.hasOwnProperty(M)&&(m.deepEqual(s[M],c[M])||u.push({command:P,args:[f,M,c[M],T]}));for(M in c)c.hasOwnProperty(M)&&!s.hasOwnProperty(M)&&(m.deepEqual(s[M],c[M])||u.push({command:P,args:[f,M,c[M],T]}))}function wt(s){return s.id}function It(s,c){return s[c.id]=c,s}var xi=function(s,c){this.reset(s,c)};xi.prototype.reset=function(s,c){this.points=s||[],this._distances=[0];for(var u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding},xi.prototype.lerp=function(s){if(this.points.length===1)return this.points[0];s=m.clamp(s,0,1);for(var c=1,u=this._distances[c],f=s*this.paddedLength+this.padding;u<f&&c<this._distances.length;)u=this._distances[++c];var T=c-1,P=this._distances[T],M=u-P,F=M>0?(f-P)/M:0;return this.points[T].mult(1-F).add(this.points[c].mult(F))};var Qt=function(s,c,u){var f=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(s/u),this.yCellCount=Math.ceil(c/u);for(var P=0;P<this.xCellCount*this.yCellCount;P++)f.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=c,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0};function ni(s,c,u,f,T){var P=m.create();return c?(m.scale(P,P,[1/T,1/T,1]),u||m.rotateZ(P,P,f.angle)):m.multiply(P,f.labelPlaneMatrix,s),P}function $t(s,c,u,f,T){if(c){var P=m.clone(s);return m.scale(P,P,[T,T,1]),u||m.rotateZ(P,P,-f.angle),P}return f.glCoordMatrix}function Mt(s,c){var u=[s.x,s.y,0,1];Jr(u,u,c);var f=u[3];return{point:new m.Point(u[0]/f,u[1]/f),signedDistanceFromCamera:f}}function di(s,c){return .5+s/c*.5}function qi(s,c){var u=s[0]/s[3],f=s[1]/s[3];return u>=-c[0]&&u<=c[0]&&f>=-c[1]&&f<=c[1]}function jr(s,c,u,f,T,P,M,F){var X=f?s.textSizeData:s.iconSizeData,Y=m.evaluateSizeForZoom(X,u.transform.zoom),le=[256/u.width*2+1,256/u.height*2+1],ce=f?s.text.dynamicLayoutVertexArray:s.icon.dynamicLayoutVertexArray;ce.clear();for(var de=s.lineVertexArray,Ce=f?s.text.placedSymbolArray:s.icon.placedSymbolArray,Ae=u.transform.width/u.transform.height,ke=!1,xe=0;xe<Ce.length;xe++){var ze=Ce.get(xe);if(ze.hidden||ze.writingMode===m.WritingMode.vertical&&!ke)Vn(ze.numGlyphs,ce);else{ke=!1;var Be=[ze.anchorX,ze.anchorY,0,1];if(m.transformMat4(Be,Be,c),qi(Be,le)){var Ge=di(u.transform.cameraToCenterDistance,Be[3]),Je=m.evaluateSizeForFeature(X,Y,ze),Ye=M?Je/Ge:Je*Ge,Qe=new m.Point(ze.anchorX,ze.anchorY),ht=Mt(Qe,T).point,bt={},xt=Gs(ze,Ye,!1,F,c,T,P,s.glyphOffsetArray,de,ce,ht,Qe,bt,Ae);ke=xt.useVertical,(xt.notEnoughRoom||ke||xt.needsFlipping&&Gs(ze,Ye,!0,F,c,T,P,s.glyphOffsetArray,de,ce,ht,Qe,bt,Ae).notEnoughRoom)&&Vn(ze.numGlyphs,ce)}else Vn(ze.numGlyphs,ce)}}f?s.text.dynamicLayoutVertexBuffer.updateData(ce):s.icon.dynamicLayoutVertexBuffer.updateData(ce)}function Xi(s,c,u,f,T,P,M,F,X,Y,le){var ce=F.glyphStartIndex+F.numGlyphs,de=F.lineStartIndex,Ce=F.lineStartIndex+F.lineLength,Ae=c.getoffsetX(F.glyphStartIndex),ke=c.getoffsetX(ce-1),xe=Rr(s*Ae,u,f,T,P,M,F.segment,de,Ce,X,Y,le);if(!xe)return null;var ze=Rr(s*ke,u,f,T,P,M,F.segment,de,Ce,X,Y,le);return ze?{first:xe,last:ze}:null}function Ln(s,c,u,f){return s===m.WritingMode.horizontal&&Math.abs(u.y-c.y)>Math.abs(u.x-c.x)*f?{useVertical:!0}:(s===m.WritingMode.vertical?c.y<u.y:c.x>u.x)?{needsFlipping:!0}:null}function Gs(s,c,u,f,T,P,M,F,X,Y,le,ce,de,Ce){var Ae,ke=c/24,xe=s.lineOffsetX*ke,ze=s.lineOffsetY*ke;if(s.numGlyphs>1){var Be=s.glyphStartIndex+s.numGlyphs,Ge=s.lineStartIndex,Je=s.lineStartIndex+s.lineLength,Ye=Xi(ke,F,xe,ze,u,le,ce,s,X,P,de);if(!Ye)return{notEnoughRoom:!0};var Qe=Mt(Ye.first.point,M).point,ht=Mt(Ye.last.point,M).point;if(f&&!u){var bt=Ln(s.writingMode,Qe,ht,Ce);if(bt)return bt}Ae=[Ye.first];for(var xt=s.glyphStartIndex+1;xt<Be-1;xt++)Ae.push(Rr(ke*F.getoffsetX(xt),xe,ze,u,le,ce,s.segment,Ge,Je,X,P,de));Ae.push(Ye.last)}else{if(f&&!u){var Dt=Mt(ce,T).point,Yt=s.lineStartIndex+s.segment+1,ti=new m.Point(X.getx(Yt),X.gety(Yt)),Jt=Mt(ti,T),Mi=Jt.signedDistanceFromCamera>0?Jt.point:tr(ce,ti,Dt,1,T),Nt=Ln(s.writingMode,Dt,Mi,Ce);if(Nt)return Nt}var fi=Rr(ke*F.getoffsetX(s.glyphStartIndex),xe,ze,u,le,ce,s.segment,s.lineStartIndex,s.lineStartIndex+s.lineLength,X,P,de);if(!fi)return{notEnoughRoom:!0};Ae=[fi]}for(var Ci=0,pi=Ae;Ci<pi.length;Ci+=1){var li=pi[Ci];m.addDynamicAttributes(Y,li.point,li.angle)}return{}}function tr(s,c,u,f,T){var P=Mt(s.add(s.sub(c)._unit()),T).point,M=u.sub(P);return u.add(M._mult(f/M.mag()))}function Rr(s,c,u,f,T,P,M,F,X,Y,le,ce){var de=f?s-c:s+c,Ce=de>0?1:-1,Ae=0;f&&(Ce*=-1,Ae=Math.PI),Ce<0&&(Ae+=Math.PI);for(var ke=Ce>0?F+M:F+M+1,xe=T,ze=T,Be=0,Ge=0,Je=Math.abs(de),Ye=[];Be+Ge<=Je;){if((ke+=Ce)<F||ke>=X)return null;if(ze=xe,Ye.push(xe),(xe=ce[ke])===void 0){var Qe=new m.Point(Y.getx(ke),Y.gety(ke)),ht=Mt(Qe,le);if(ht.signedDistanceFromCamera>0)xe=ce[ke]=ht.point;else{var bt=ke-Ce;xe=tr(Be===0?P:new m.Point(Y.getx(bt),Y.gety(bt)),Qe,ze,Je-Be+1,le)}}Be+=Ge,Ge=ze.dist(xe)}var xt=(Je-Be)/Ge,Dt=xe.sub(ze),Yt=Dt.mult(xt)._add(ze);Yt._add(Dt._unit()._perp()._mult(u*Ce));var ti=Ae+Math.atan2(xe.y-ze.y,xe.x-ze.x);return Ye.push(Yt),{point:Yt,angle:ti,path:Ye}}Qt.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Qt.prototype.insert=function(s,c,u,f,T){this._forEachCell(c,u,f,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(c),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(T)},Qt.prototype.insertCircle=function(s,c,u,f){this._forEachCell(c-f,u-f,c+f,u+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(c),this.circles.push(u),this.circles.push(f)},Qt.prototype._insertBoxCell=function(s,c,u,f,T,P){this.boxCells[T].push(P)},Qt.prototype._insertCircleCell=function(s,c,u,f,T,P){this.circleCells[T].push(P)},Qt.prototype._query=function(s,c,u,f,T,P){if(u<0||s>this.width||f<0||c>this.height)return!T&&[];var M=[];if(s<=0&&c<=0&&this.width<=u&&this.height<=f){if(T)return!0;for(var F=0;F<this.boxKeys.length;F++)M.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(var X=0;X<this.circleKeys.length;X++){var Y=this.circles[3*X],le=this.circles[3*X+1],ce=this.circles[3*X+2];M.push({key:this.circleKeys[X],x1:Y-ce,y1:le-ce,x2:Y+ce,y2:le+ce})}return P?M.filter(P):M}return this._forEachCell(s,c,u,f,this._queryCell,M,{hitTest:T,seenUids:{box:{},circle:{}}},P),T?M.length>0:M},Qt.prototype._queryCircle=function(s,c,u,f,T){var P=s-u,M=s+u,F=c-u,X=c+u;if(M<0||P>this.width||X<0||F>this.height)return!f&&[];var Y=[];return this._forEachCell(P,F,M,X,this._queryCellCircle,Y,{hitTest:f,circle:{x:s,y:c,radius:u},seenUids:{box:{},circle:{}}},T),f?Y.length>0:Y},Qt.prototype.query=function(s,c,u,f,T){return this._query(s,c,u,f,!1,T)},Qt.prototype.hitTest=function(s,c,u,f,T){return this._query(s,c,u,f,!0,T)},Qt.prototype.hitTestCircle=function(s,c,u,f){return this._queryCircle(s,c,u,!0,f)},Qt.prototype._queryCell=function(s,c,u,f,T,P,M,F){var X=M.seenUids,Y=this.boxCells[T];if(Y!==null)for(var le=this.bboxes,ce=0,de=Y;ce<de.length;ce+=1){var Ce=de[ce];if(!X.box[Ce]){X.box[Ce]=!0;var Ae=4*Ce;if(s<=le[Ae+2]&&c<=le[Ae+3]&&u>=le[Ae+0]&&f>=le[Ae+1]&&(!F||F(this.boxKeys[Ce]))){if(M.hitTest)return P.push(!0),!0;P.push({key:this.boxKeys[Ce],x1:le[Ae],y1:le[Ae+1],x2:le[Ae+2],y2:le[Ae+3]})}}}var ke=this.circleCells[T];if(ke!==null)for(var xe=this.circles,ze=0,Be=ke;ze<Be.length;ze+=1){var Ge=Be[ze];if(!X.circle[Ge]){X.circle[Ge]=!0;var Je=3*Ge;if(this._circleAndRectCollide(xe[Je],xe[Je+1],xe[Je+2],s,c,u,f)&&(!F||F(this.circleKeys[Ge]))){if(M.hitTest)return P.push(!0),!0;var Ye=xe[Je],Qe=xe[Je+1],ht=xe[Je+2];P.push({key:this.circleKeys[Ge],x1:Ye-ht,y1:Qe-ht,x2:Ye+ht,y2:Qe+ht})}}}},Qt.prototype._queryCellCircle=function(s,c,u,f,T,P,M,F){var X=M.circle,Y=M.seenUids,le=this.boxCells[T];if(le!==null)for(var ce=this.bboxes,de=0,Ce=le;de<Ce.length;de+=1){var Ae=Ce[de];if(!Y.box[Ae]){Y.box[Ae]=!0;var ke=4*Ae;if(this._circleAndRectCollide(X.x,X.y,X.radius,ce[ke+0],ce[ke+1],ce[ke+2],ce[ke+3])&&(!F||F(this.boxKeys[Ae])))return P.push(!0),!0}}var xe=this.circleCells[T];if(xe!==null)for(var ze=this.circles,Be=0,Ge=xe;Be<Ge.length;Be+=1){var Je=Ge[Be];if(!Y.circle[Je]){Y.circle[Je]=!0;var Ye=3*Je;if(this._circlesCollide(ze[Ye],ze[Ye+1],ze[Ye+2],X.x,X.y,X.radius)&&(!F||F(this.circleKeys[Je])))return P.push(!0),!0}}},Qt.prototype._forEachCell=function(s,c,u,f,T,P,M,F){for(var X=this._convertToXCellCoord(s),Y=this._convertToYCellCoord(c),le=this._convertToXCellCoord(u),ce=this._convertToYCellCoord(f),de=X;de<=le;de++)for(var Ce=Y;Ce<=ce;Ce++)if(T.call(this,s,c,u,f,this.xCellCount*Ce+de,P,M,F))return},Qt.prototype._convertToXCellCoord=function(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))},Qt.prototype._convertToYCellCoord=function(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))},Qt.prototype._circlesCollide=function(s,c,u,f,T,P){var M=f-s,F=T-c,X=u+P;return X*X>M*M+F*F},Qt.prototype._circleAndRectCollide=function(s,c,u,f,T,P,M){var F=(P-f)/2,X=Math.abs(s-(f+F));if(X>F+u)return!1;var Y=(M-T)/2,le=Math.abs(c-(T+Y));if(le>Y+u)return!1;if(X<=F||le<=Y)return!0;var ce=X-F,de=le-Y;return ce*ce+de*de<=u*u};var es=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Vn(s,c){for(var u=0;u<s;u++){var f=c.length;c.resize(f+4),c.float32.set(es,3*f)}}function Jr(s,c,u){var f=c[0],T=c[1];return s[0]=u[0]*f+u[4]*T+u[12],s[1]=u[1]*f+u[5]*T+u[13],s[3]=u[3]*f+u[7]*T+u[15],s}var bo=function(s,c,u){c===void 0&&(c=new Qt(s.width+200,s.height+200,25)),u===void 0&&(u=new Qt(s.width+200,s.height+200,25)),this.transform=s,this.grid=c,this.ignoredGrid=u,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+100,this.screenBottomBoundary=s.height+100,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200};function pr(s,c,u){return c*(m.EXTENT/(s.tileSize*Math.pow(2,u-s.tileID.overscaledZ)))}bo.prototype.placeCollisionBox=function(s,c,u,f,T){var P=this.projectAndGetPerspectiveRatio(f,s.anchorPointX,s.anchorPointY),M=u*P.perspectiveRatio,F=s.x1*M+P.point.x,X=s.y1*M+P.point.y,Y=s.x2*M+P.point.x,le=s.y2*M+P.point.y;return!this.isInsideGrid(F,X,Y,le)||!c&&this.grid.hitTest(F,X,Y,le,T)?{box:[],offscreen:!1}:{box:[F,X,Y,le],offscreen:this.isOffscreen(F,X,Y,le)}},bo.prototype.placeCollisionCircles=function(s,c,u,f,T,P,M,F,X,Y,le,ce,de){var Ce=[],Ae=new m.Point(c.anchorX,c.anchorY),ke=Mt(Ae,P),xe=di(this.transform.cameraToCenterDistance,ke.signedDistanceFromCamera),ze=(Y?T/xe:T*xe)/m.ONE_EM,Be=Mt(Ae,M).point,Ge=Xi(ze,f,c.lineOffsetX*ze,c.lineOffsetY*ze,!1,Be,Ae,c,u,M,{}),Je=!1,Ye=!1,Qe=!0;if(Ge){for(var ht=.5*ce*xe+de,bt=new m.Point(-100,-100),xt=new m.Point(this.screenRightBoundary,this.screenBottomBoundary),Dt=new xi,Yt=Ge.first,ti=Ge.last,Jt=[],Mi=Yt.path.length-1;Mi>=1;Mi--)Jt.push(Yt.path[Mi]);for(var Nt=1;Nt<ti.path.length;Nt++)Jt.push(ti.path[Nt]);var fi=2.5*ht;if(F){var Ci=Jt.map(function(Fo){return Mt(Fo,F)});Jt=Ci.some(function(Fo){return Fo.signedDistanceFromCamera<=0})?[]:Ci.map(function(Fo){return Fo.point})}var pi=[];if(Jt.length>0){for(var li=Jt[0].clone(),_i=Jt[0].clone(),ri=1;ri<Jt.length;ri++)li.x=Math.min(li.x,Jt[ri].x),li.y=Math.min(li.y,Jt[ri].y),_i.x=Math.max(_i.x,Jt[ri].x),_i.y=Math.max(_i.y,Jt[ri].y);pi=li.x>=bt.x&&_i.x<=xt.x&&li.y>=bt.y&&_i.y<=xt.y?[Jt]:_i.x<bt.x||li.x>xt.x||_i.y<bt.y||li.y>xt.y?[]:m.clipLine([Jt],bt.x,bt.y,xt.x,xt.y)}for(var ei=0,Ar=pi;ei<Ar.length;ei+=1){var Ur;Dt.reset(Ar[ei],.25*ht),Ur=Dt.length<=.5*ht?1:Math.ceil(Dt.paddedLength/fi)+1;for(var Qr=0;Qr<Ur;Qr++){var Bn=Qr/Math.max(Ur-1,1),zr=Dt.lerp(Bn),Di=zr.x+100,co=zr.y+100;Ce.push(Di,co,ht,0);var Qn=Di-ht,Bo=co-ht,gn=Di+ht,Oo=co+ht;if(Qe=Qe&&this.isOffscreen(Qn,Bo,gn,Oo),Ye=Ye||this.isInsideGrid(Qn,Bo,gn,Oo),!s&&this.grid.hitTestCircle(Di,co,ht,le)&&(Je=!0,!X))return{circles:[],offscreen:!1,collisionDetected:Je}}}}return{circles:!X&&Je||!Ye?[]:Ce,offscreen:Qe,collisionDetected:Je}},bo.prototype.queryRenderedSymbols=function(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var c=[],u=1/0,f=1/0,T=-1/0,P=-1/0,M=0,F=s;M<F.length;M+=1){var X=F[M],Y=new m.Point(X.x+100,X.y+100);u=Math.min(u,Y.x),f=Math.min(f,Y.y),T=Math.max(T,Y.x),P=Math.max(P,Y.y),c.push(Y)}for(var le={},ce={},de=0,Ce=this.grid.query(u,f,T,P).concat(this.ignoredGrid.query(u,f,T,P));de<Ce.length;de+=1){var Ae=Ce[de],ke=Ae.key;if(le[ke.bucketInstanceId]===void 0&&(le[ke.bucketInstanceId]={}),!le[ke.bucketInstanceId][ke.featureIndex]){var xe=[new m.Point(Ae.x1,Ae.y1),new m.Point(Ae.x2,Ae.y1),new m.Point(Ae.x2,Ae.y2),new m.Point(Ae.x1,Ae.y2)];m.polygonIntersectsPolygon(c,xe)&&(le[ke.bucketInstanceId][ke.featureIndex]=!0,ce[ke.bucketInstanceId]===void 0&&(ce[ke.bucketInstanceId]=[]),ce[ke.bucketInstanceId].push(ke.featureIndex))}}return ce},bo.prototype.insertCollisionBox=function(s,c,u,f,T){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:f,collisionGroupID:T},s[0],s[1],s[2],s[3])},bo.prototype.insertCollisionCircles=function(s,c,u,f,T){for(var P=c?this.ignoredGrid:this.grid,M={bucketInstanceId:u,featureIndex:f,collisionGroupID:T},F=0;F<s.length;F+=4)P.insertCircle(M,s[F],s[F+1],s[F+2])},bo.prototype.projectAndGetPerspectiveRatio=function(s,c,u){var f=[c,u,0,1];return Jr(f,f,s),{point:new m.Point((f[0]/f[3]+1)/2*this.transform.width+100,(-f[1]/f[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/f[3]*.5}},bo.prototype.isOffscreen=function(s,c,u,f){return u<100||s>=this.screenRightBoundary||f<100||c>this.screenBottomBoundary},bo.prototype.isInsideGrid=function(s,c,u,f){return u>=0&&s<this.gridRightBoundary&&f>=0&&c<this.gridBottomBoundary},bo.prototype.getViewportMatrix=function(){var s=m.identity([]);return m.translate(s,s,[-100,-100,0]),s};var wo=function(s,c,u,f){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?c:-c))):f&&u?1:0,this.placed=u};wo.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Kn=function(s,c,u,f,T){this.text=new wo(s?s.text:null,c,u,T),this.icon=new wo(s?s.icon:null,c,f,T)};Kn.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var du=function(s,c,u){this.text=s,this.icon=c,this.skipFade=u},Eo=function(){this.invProjMatrix=m.create(),this.viewportMatrix=m.create(),this.circles=[]},ts=function(s,c,u,f,T){this.bucketInstanceId=s,this.featureIndex=c,this.sourceLayerIndex=u,this.bucketIndex=f,this.tileID=T},Lo=function(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}};function Br(s,c,u,f,T){var P=m.getAnchorAlignment(s),M=-(P.horizontalAlign-.5)*c,F=-(P.verticalAlign-.5)*u,X=m.evaluateVariableOffset(s,f);return new m.Point(M+X[0]*T,F+X[1]*T)}function oo(s,c,u,f,T,P){var M=s.x1,F=s.x2,X=s.y1,Y=s.y2,le=s.anchorPointX,ce=s.anchorPointY,de=new m.Point(c,u);return f&&de._rotate(T?P:-P),{x1:M+de.x,y1:X+de.y,x2:F+de.x,y2:Y+de.y,anchorPointX:le,anchorPointY:ce}}Lo.prototype.get=function(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){var c=++this.maxGroupID;this.collisionGroups[s]={ID:c,predicate:function(u){return u.collisionGroupID===c}}}return this.collisionGroups[s]};var mn=function(s,c,u,f){this.transform=s.clone(),this.collisionIndex=new bo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Lo(u),this.collisionCircleArrays={},this.prevPlacement=f,f&&(f.prevPlacement=void 0),this.placedOrientations={}};function Qo(s,c,u,f,T){s.emplaceBack(c?1:0,u?1:0,f||0,T||0),s.emplaceBack(c?1:0,u?1:0,f||0,T||0),s.emplaceBack(c?1:0,u?1:0,f||0,T||0),s.emplaceBack(c?1:0,u?1:0,f||0,T||0)}mn.prototype.getBucketParts=function(s,c,u,f){var T=u.getBucket(c),P=u.latestFeatureIndex;if(T&&P&&c.id===T.layerIds[0]){var M=u.collisionBoxArray,F=T.layers[0].layout,X=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),Y=u.tileSize/m.EXTENT,le=this.transform.calculatePosMatrix(u.tileID.toUnwrapped()),ce=F.get("text-pitch-alignment")==="map",de=F.get("text-rotation-alignment")==="map",Ce=pr(u,1,this.transform.zoom),Ae=ni(le,ce,de,this.transform,Ce),ke=null;if(ce){var xe=$t(le,ce,de,this.transform,Ce);ke=m.multiply([],this.transform.labelPlaneMatrix,xe)}this.retainedQueryData[T.bucketInstanceId]=new ts(T.bucketInstanceId,P,T.sourceLayerIndex,T.index,u.tileID);var ze={bucket:T,layout:F,posMatrix:le,textLabelPlaneMatrix:Ae,labelToScreenMatrix:ke,scale:X,textPixelRatio:Y,holdingForFade:u.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:m.evaluateSizeForZoom(T.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(T.sourceID)};if(f)for(var Be=0,Ge=T.sortKeyRanges;Be<Ge.length;Be+=1){var Je=Ge[Be];s.push({sortKey:Je.sortKey,symbolInstanceStart:Je.symbolInstanceStart,symbolInstanceEnd:Je.symbolInstanceEnd,parameters:ze})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:ze})}},mn.prototype.attemptAnchorPlacement=function(s,c,u,f,T,P,M,F,X,Y,le,ce,de,Ce,Ae){var ke,xe=[ce.textOffset0,ce.textOffset1],ze=Br(s,u,f,xe,T),Be=this.collisionIndex.placeCollisionBox(oo(c,ze.x,ze.y,P,M,this.transform.angle),le,F,X,Y.predicate);if(!Ae||this.collisionIndex.placeCollisionBox(oo(Ae,ze.x,ze.y,P,M,this.transform.angle),le,F,X,Y.predicate).box.length!==0)return Be.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[ce.crossTileID]&&this.prevPlacement.placements[ce.crossTileID]&&this.prevPlacement.placements[ce.crossTileID].text&&(ke=this.prevPlacement.variableOffsets[ce.crossTileID].anchor),this.variableOffsets[ce.crossTileID]={textOffset:xe,width:u,height:f,anchor:s,textBoxScale:T,prevAnchor:ke},this.markUsedJustification(de,s,ce,Ce),de.allowVerticalPlacement&&(this.markUsedOrientation(de,Ce,ce),this.placedOrientations[ce.crossTileID]=Ce),{shift:ze,placedGlyphBoxes:Be}):void 0},mn.prototype.placeLayerBucketPart=function(s,c,u){var f=this,T=s.parameters,P=T.bucket,M=T.layout,F=T.posMatrix,X=T.textLabelPlaneMatrix,Y=T.labelToScreenMatrix,le=T.textPixelRatio,ce=T.holdingForFade,de=T.collisionBoxArray,Ce=T.partiallyEvaluatedTextSize,Ae=T.collisionGroup,ke=M.get("text-optional"),xe=M.get("icon-optional"),ze=M.get("text-allow-overlap"),Be=M.get("icon-allow-overlap"),Ge=M.get("text-rotation-alignment")==="map",Je=M.get("text-pitch-alignment")==="map",Ye=M.get("icon-text-fit")!=="none",Qe=M.get("symbol-z-order")==="viewport-y",ht=ze&&(Be||!P.hasIconData()||xe),bt=Be&&(ze||!P.hasTextData()||ke);!P.collisionArrays&&de&&P.deserializeCollisionBoxes(de);var xt=function(Nt,fi){if(!c[Nt.crossTileID])if(ce)f.placements[Nt.crossTileID]=new du(!1,!1,!1);else{var Ci,pi=!1,li=!1,_i=!0,ri=null,ei={box:null,offscreen:null},Ar={box:null,offscreen:null},Ur=null,Qr=null,Bn=0,zr=0,Di=0;fi.textFeatureIndex?Bn=fi.textFeatureIndex:Nt.useRuntimeCollisionCircles&&(Bn=Nt.featureIndex),fi.verticalTextFeatureIndex&&(zr=fi.verticalTextFeatureIndex);var co=fi.textBox;if(co){var Qn=function(ji){var ho=m.WritingMode.horizontal;if(P.allowVerticalPlacement&&!ji&&f.prevPlacement){var Io=f.prevPlacement.placedOrientations[Nt.crossTileID];Io&&(f.placedOrientations[Nt.crossTileID]=Io,f.markUsedOrientation(P,ho=Io,Nt))}return ho},Bo=function(ji,ho){if(P.allowVerticalPlacement&&Nt.numVerticalGlyphVertices>0&&fi.verticalTextBox)for(var Io=0,pl=P.writingModes;Io<pl.length&&(pl[Io]===m.WritingMode.vertical?(ei=ho(),Ar=ei):ei=ji(),!(ei&&ei.box&&ei.box.length));Io+=1);else ei=ji()};if(M.get("text-variable-anchor")){var gn=M.get("text-variable-anchor");if(f.prevPlacement&&f.prevPlacement.variableOffsets[Nt.crossTileID]){var Oo=f.prevPlacement.variableOffsets[Nt.crossTileID];gn.indexOf(Oo.anchor)>0&&(gn=gn.filter(function(ji){return ji!==Oo.anchor})).unshift(Oo.anchor)}var Fo=function(ji,ho,Io){for(var pl=ji.x2-ji.x1,Nl=ji.y2-ji.y1,jl=Nt.textBoxScale,lh=Ye&&!Be?ho:null,fs={box:[],offscreen:!1},uh=ze?2*gn.length:gn.length,ms=0;ms<uh;++ms){var Au=f.attemptAnchorPlacement(gn[ms%gn.length],ji,pl,Nl,jl,Ge,Je,le,F,Ae,ms>=gn.length,Nt,P,Io,lh);if(Au&&(fs=Au.placedGlyphBoxes)&&fs.box&&fs.box.length){pi=!0,ri=Au.shift;break}}return fs};Bo(function(){return Fo(co,fi.iconBox,m.WritingMode.horizontal)},function(){var ji=fi.verticalTextBox;return P.allowVerticalPlacement&&!(ei&&ei.box&&ei.box.length)&&Nt.numVerticalGlyphVertices>0&&ji?Fo(ji,fi.verticalIconBox,m.WritingMode.vertical):{box:null,offscreen:null}}),ei&&(pi=ei.box,_i=ei.offscreen);var Fl=Qn(ei&&ei.box);if(!pi&&f.prevPlacement){var Ul=f.prevPlacement.variableOffsets[Nt.crossTileID];Ul&&(f.variableOffsets[Nt.crossTileID]=Ul,f.markUsedJustification(P,Ul.anchor,Nt,Fl))}}else{var ds=function(ji,ho){var Io=f.collisionIndex.placeCollisionBox(ji,ze,le,F,Ae.predicate);return Io&&Io.box&&Io.box.length&&(f.markUsedOrientation(P,ho,Nt),f.placedOrientations[Nt.crossTileID]=ho),Io};Bo(function(){return ds(co,m.WritingMode.horizontal)},function(){var ji=fi.verticalTextBox;return P.allowVerticalPlacement&&Nt.numVerticalGlyphVertices>0&&ji?ds(ji,m.WritingMode.vertical):{box:null,offscreen:null}}),Qn(ei&&ei.box&&ei.box.length)}}if(pi=(Ci=ei)&&Ci.box&&Ci.box.length>0,_i=Ci&&Ci.offscreen,Nt.useRuntimeCollisionCircles){var Vl=P.text.placedSymbolArray.get(Nt.centerJustifiedTextSymbolIndex),cl=m.evaluateSizeForFeature(P.textSizeData,Ce,Vl),Ga=M.get("text-padding");Ur=f.collisionIndex.placeCollisionCircles(ze,Vl,P.lineVertexArray,P.glyphOffsetArray,cl,F,X,Y,u,Je,Ae.predicate,Nt.collisionCircleDiameter,Ga),pi=ze||Ur.circles.length>0&&!Ur.collisionDetected,_i=_i&&Ur.offscreen}if(fi.iconFeatureIndex&&(Di=fi.iconFeatureIndex),fi.iconBox){var hl=function(ji){var ho=Ye&&ri?oo(ji,ri.x,ri.y,Ge,Je,f.transform.angle):ji;return f.collisionIndex.placeCollisionBox(ho,Be,le,F,Ae.predicate)};li=Ar&&Ar.box&&Ar.box.length&&fi.verticalIconBox?(Qr=hl(fi.verticalIconBox)).box.length>0:(Qr=hl(fi.iconBox)).box.length>0,_i=_i&&Qr.offscreen}var Ca=ke||Nt.numHorizontalGlyphVertices===0&&Nt.numVerticalGlyphVertices===0,yn=xe||Nt.numIconVertices===0;if(Ca||yn?yn?Ca||(li=li&&pi):pi=li&&pi:li=pi=li&&pi,pi&&Ci&&Ci.box&&f.collisionIndex.insertCollisionBox(Ci.box,M.get("text-ignore-placement"),P.bucketInstanceId,Ar&&Ar.box&&zr?zr:Bn,Ae.ID),li&&Qr&&f.collisionIndex.insertCollisionBox(Qr.box,M.get("icon-ignore-placement"),P.bucketInstanceId,Di,Ae.ID),Ur&&(pi&&f.collisionIndex.insertCollisionCircles(Ur.circles,M.get("text-ignore-placement"),P.bucketInstanceId,Bn,Ae.ID),u)){var Uo=P.bucketInstanceId,Os=f.collisionCircleArrays[Uo];Os===void 0&&(Os=f.collisionCircleArrays[Uo]=new Eo);for(var za=0;za<Ur.circles.length;za+=4)Os.circles.push(Ur.circles[za+0]),Os.circles.push(Ur.circles[za+1]),Os.circles.push(Ur.circles[za+2]),Os.circles.push(Ur.collisionDetected?1:0)}f.placements[Nt.crossTileID]=new du(pi||ht,li||bt,_i||P.justReloaded),c[Nt.crossTileID]=!0}};if(Qe)for(var Dt=P.getSortedSymbolIndexes(this.transform.angle),Yt=Dt.length-1;Yt>=0;--Yt){var ti=Dt[Yt];xt(P.symbolInstances.get(ti),P.collisionArrays[ti])}else for(var Jt=s.symbolInstanceStart;Jt<s.symbolInstanceEnd;Jt++)xt(P.symbolInstances.get(Jt),P.collisionArrays[Jt]);if(u&&P.bucketInstanceId in this.collisionCircleArrays){var Mi=this.collisionCircleArrays[P.bucketInstanceId];m.invert(Mi.invProjMatrix,F),Mi.viewportMatrix=this.collisionIndex.getViewportMatrix()}P.justReloaded=!1},mn.prototype.markUsedJustification=function(s,c,u,f){var T;T=f===m.WritingMode.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[m.getAnchorJustification(c)];for(var P=0,M=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];P<M.length;P+=1){var F=M[P];F>=0&&(s.text.placedSymbolArray.get(F).crossTileID=T>=0&&F!==T?0:u.crossTileID)}},mn.prototype.markUsedOrientation=function(s,c,u){for(var f=c===m.WritingMode.horizontal||c===m.WritingMode.horizontalOnly?c:0,T=c===m.WritingMode.vertical?c:0,P=0,M=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];P<M.length;P+=1)s.text.placedSymbolArray.get(M[P]).placedOrientation=f;u.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=T)},mn.prototype.commit=function(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;var c=this.prevPlacement,u=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;var f=c?c.symbolFadeChange(s):1,T=c?c.opacities:{},P=c?c.variableOffsets:{},M=c?c.placedOrientations:{};for(var F in this.placements){var X=this.placements[F],Y=T[F];Y?(this.opacities[F]=new Kn(Y,f,X.text,X.icon),u=u||X.text!==Y.text.placed||X.icon!==Y.icon.placed):(this.opacities[F]=new Kn(null,f,X.text,X.icon,X.skipFade),u=u||X.text||X.icon)}for(var le in T){var ce=T[le];if(!this.opacities[le]){var de=new Kn(ce,f,!1,!1);de.isHidden()||(this.opacities[le]=de,u=u||ce.text.placed||ce.icon.placed)}}for(var Ce in P)this.variableOffsets[Ce]||!this.opacities[Ce]||this.opacities[Ce].isHidden()||(this.variableOffsets[Ce]=P[Ce]);for(var Ae in M)this.placedOrientations[Ae]||!this.opacities[Ae]||this.opacities[Ae].isHidden()||(this.placedOrientations[Ae]=M[Ae]);u?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:s)},mn.prototype.updateLayerOpacities=function(s,c){for(var u={},f=0,T=c;f<T.length;f+=1){var P=T[f],M=P.getBucket(s);M&&P.latestFeatureIndex&&s.id===M.layerIds[0]&&this.updateBucketOpacities(M,u,P.collisionBoxArray)}},mn.prototype.updateBucketOpacities=function(s,c,u){var f=this;s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();var T=s.layers[0].layout,P=new Kn(null,0,!1,!1,!0),M=T.get("text-allow-overlap"),F=T.get("icon-allow-overlap"),X=T.get("text-variable-anchor"),Y=T.get("text-rotation-alignment")==="map",le=T.get("text-pitch-alignment")==="map",ce=T.get("icon-text-fit")!=="none",de=new Kn(null,0,M&&(F||!s.hasIconData()||T.get("icon-optional")),F&&(M||!s.hasTextData()||T.get("text-optional")),!0);!s.collisionArrays&&u&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(u);for(var Ce=function(ze,Be,Ge){for(var Je=0;Je<Be/4;Je++)ze.opacityVertexArray.emplaceBack(Ge)},Ae=function(ze){var Be=s.symbolInstances.get(ze),Ge=Be.numHorizontalGlyphVertices,Je=Be.numVerticalGlyphVertices,Ye=Be.crossTileID,Qe=f.opacities[Ye];c[Ye]?Qe=P:Qe||(f.opacities[Ye]=Qe=de),c[Ye]=!0;var ht=Be.numIconVertices>0,bt=f.placedOrientations[Be.crossTileID],xt=bt===m.WritingMode.vertical,Dt=bt===m.WritingMode.horizontal||bt===m.WritingMode.horizontalOnly;if(Ge>0||Je>0){var Yt=gu(Qe.text);Ce(s.text,Ge,xt?fa:Yt),Ce(s.text,Je,Dt?fa:Yt);var ti=Qe.text.isHidden();[Be.rightJustifiedTextSymbolIndex,Be.centerJustifiedTextSymbolIndex,Be.leftJustifiedTextSymbolIndex].forEach(function(ei){ei>=0&&(s.text.placedSymbolArray.get(ei).hidden=ti||xt?1:0)}),Be.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get(Be.verticalPlacedTextSymbolIndex).hidden=ti||Dt?1:0);var Jt=f.variableOffsets[Be.crossTileID];Jt&&f.markUsedJustification(s,Jt.anchor,Be,bt);var Mi=f.placedOrientations[Be.crossTileID];Mi&&(f.markUsedJustification(s,"left",Be,Mi),f.markUsedOrientation(s,Mi,Be))}if(ht){var Nt=gu(Qe.icon),fi=!(ce&&Be.verticalPlacedIconSymbolIndex&&xt);Be.placedIconSymbolIndex>=0&&(Ce(s.icon,Be.numIconVertices,fi?Nt:fa),s.icon.placedSymbolArray.get(Be.placedIconSymbolIndex).hidden=Qe.icon.isHidden()),Be.verticalPlacedIconSymbolIndex>=0&&(Ce(s.icon,Be.numVerticalIconVertices,fi?fa:Nt),s.icon.placedSymbolArray.get(Be.verticalPlacedIconSymbolIndex).hidden=Qe.icon.isHidden())}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){var Ci=s.collisionArrays[ze];if(Ci){var pi=new m.Point(0,0);if(Ci.textBox||Ci.verticalTextBox){var li=!0;if(X){var _i=f.variableOffsets[Ye];_i?(pi=Br(_i.anchor,_i.width,_i.height,_i.textOffset,_i.textBoxScale),Y&&pi._rotate(le?f.transform.angle:-f.transform.angle)):li=!1}Ci.textBox&&Qo(s.textCollisionBox.collisionVertexArray,Qe.text.placed,!li||xt,pi.x,pi.y),Ci.verticalTextBox&&Qo(s.textCollisionBox.collisionVertexArray,Qe.text.placed,!li||Dt,pi.x,pi.y)}var ri=Boolean(!Dt&&Ci.verticalIconBox);Ci.iconBox&&Qo(s.iconCollisionBox.collisionVertexArray,Qe.icon.placed,ri,ce?pi.x:0,ce?pi.y:0),Ci.verticalIconBox&&Qo(s.iconCollisionBox.collisionVertexArray,Qe.icon.placed,!ri,ce?pi.x:0,ce?pi.y:0)}}},ke=0;ke<s.symbolInstances.length;ke++)Ae(ke);if(s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){var xe=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=xe.invProjMatrix,s.placementViewportMatrix=xe.viewportMatrix,s.collisionCircleArray=xe.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}},mn.prototype.symbolFadeChange=function(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},mn.prototype.zoomAdjustment=function(s){return Math.max(0,(this.transform.zoom-s)/1.5)},mn.prototype.hasTransitions=function(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration},mn.prototype.stillRecent=function(s,c){var u=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*u>s},mn.prototype.setStale=function(){this.stale=!0};var Zs=Math.pow(2,25),Il=Math.pow(2,24),is=Math.pow(2,17),on=Math.pow(2,16),Ss=Math.pow(2,9),fu=Math.pow(2,8),mu=Math.pow(2,1);function gu(s){if(s.opacity===0&&!s.placed)return 0;if(s.opacity===1&&s.placed)return 4294967295;var c=s.placed?1:0,u=Math.floor(127*s.opacity);return u*Zs+c*Il+u*is+c*on+u*Ss+c*fu+u*mu+c}var fa=0,Xs=function(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&s.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Xs.prototype.continuePlacement=function(s,c,u,f,T){for(var P=this._bucketParts;this._currentTileIndex<s.length;)if(c.getBucketParts(P,f,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,T())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort(function(M,F){return M.sortKey-F.sortKey}));this._currentPartIndex<P.length;)if(c.placeLayerBucketPart(P[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,T())return!0;return!1};var $s=function(s,c,u,f,T,P,M){this.placement=new mn(s,T,P,M),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=f,this._done=!1};$s.prototype.isDone=function(){return this._done},$s.prototype.continuePlacement=function(s,c,u){for(var f=this,T=m.browser.now(),P=function(){var X=m.browser.now()-T;return!f._forceFullPlacement&&X>2};this._currentPlacementIndex>=0;){var M=c[s[this._currentPlacementIndex]],F=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&(!M.minzoom||M.minzoom<=F)&&(!M.maxzoom||M.maxzoom>F)){if(this._inProgressLayer||(this._inProgressLayer=new Xs(M)),this._inProgressLayer.continuePlacement(u[M.source],this.placement,this._showCollisionBoxes,M,P))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},$s.prototype.commit=function(s){return this.placement.commit(s),this.placement};var $u=512/m.EXTENT/2,Ts=function(s,c,u){this.tileID=s,this.indexedSymbolInstances={},this.bucketInstanceId=u;for(var f=0;f<c.length;f++){var T=c.get(f),P=T.key;this.indexedSymbolInstances[P]||(this.indexedSymbolInstances[P]=[]),this.indexedSymbolInstances[P].push({crossTileID:T.crossTileID,coord:this.getScaledCoordinates(T,s)})}};Ts.prototype.getScaledCoordinates=function(s,c){var u=$u/Math.pow(2,c.canonical.z-this.tileID.canonical.z);return{x:Math.floor((c.canonical.x*m.EXTENT+s.anchorX)*u),y:Math.floor((c.canonical.y*m.EXTENT+s.anchorY)*u)}},Ts.prototype.findMatches=function(s,c,u){for(var f=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),T=0;T<s.length;T++){var P=s.get(T);if(!P.crossTileID){var M=this.indexedSymbolInstances[P.key];if(M)for(var F=this.getScaledCoordinates(P,c),X=0,Y=M;X<Y.length;X+=1){var le=Y[X];if(Math.abs(le.coord.x-F.x)<=f&&Math.abs(le.coord.y-F.y)<=f&&!u[le.crossTileID]){u[le.crossTileID]=!0,P.crossTileID=le.crossTileID;break}}}}};var ao=function(){this.maxCrossTileID=0};ao.prototype.generate=function(){return++this.maxCrossTileID};var ea=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};ea.prototype.handleWrapJump=function(s){var c=Math.round((s-this.lng)/360);if(c!==0)for(var u in this.indexes){var f=this.indexes[u],T={};for(var P in f){var M=f[P];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+c),T[M.tileID.key]=M}this.indexes[u]=T}this.lng=s},ea.prototype.addBucket=function(s,c,u){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(var f=0;f<c.symbolInstances.length;f++)c.symbolInstances.get(f).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});var T=this.usedCrossTileIDs[s.overscaledZ];for(var P in this.indexes){var M=this.indexes[P];if(Number(P)>s.overscaledZ)for(var F in M){var X=M[F];X.tileID.isChildOf(s)&&X.findMatches(c.symbolInstances,s,T)}else{var Y=M[s.scaledTo(Number(P)).key];Y&&Y.findMatches(c.symbolInstances,s,T)}}for(var le=0;le<c.symbolInstances.length;le++){var ce=c.symbolInstances.get(le);ce.crossTileID||(ce.crossTileID=u.generate(),T[ce.crossTileID]=!0)}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new Ts(s,c.symbolInstances,c.bucketInstanceId),!0},ea.prototype.removeBucketCrossTileIDs=function(s,c){for(var u in c.indexedSymbolInstances)for(var f=0,T=c.indexedSymbolInstances[u];f<T.length;f+=1)delete this.usedCrossTileIDs[s][T[f].crossTileID]},ea.prototype.removeStaleBuckets=function(s){var c=!1;for(var u in this.indexes){var f=this.indexes[u];for(var T in f)s[f[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,f[T]),delete f[T],c=!0)}return c};var ta=function(){this.layerIndexes={},this.crossTileIDs=new ao,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};ta.prototype.addLayer=function(s,c,u){var f=this.layerIndexes[s.id];f===void 0&&(f=this.layerIndexes[s.id]=new ea);var T=!1,P={};f.handleWrapJump(u);for(var M=0,F=c;M<F.length;M+=1){var X=F[M],Y=X.getBucket(s);Y&&s.id===Y.layerIds[0]&&(Y.bucketInstanceId||(Y.bucketInstanceId=++this.maxBucketInstanceId),f.addBucket(X.tileID,Y,this.crossTileIDs)&&(T=!0),P[Y.bucketInstanceId]=!0)}return f.removeStaleBuckets(P)&&(T=!0),T},ta.prototype.pruneUnusedLayers=function(s){var c={};for(var u in s.forEach(function(f){c[f]=!0}),this.layerIndexes)c[u]||delete this.layerIndexes[u]};var La=function(s,c){return m.emitValidationErrors(s,c&&c.filter(function(u){return u.identifier!=="source.canvas"}))},Ri=m.pick(Se,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Da=m.pick(Se,["setCenter","setZoom","setBearing","setPitch"]),Ra=function(){var s={},c=m.styleSpec.$version;for(var u in m.styleSpec.$root){var f,T=m.styleSpec.$root[u];T.required&&(f=u==="version"?c:T.type==="array"?[]:{})!=null&&(s[u]=f)}return s}(),An=function(s){function c(u,f){var T=this;f===void 0&&(f={}),s.call(this),this.map=u,this.dispatcher=new hr(pe(),this),this.imageManager=new Wt,this.imageManager.setEventedParent(this),this.glyphManager=new Gi(u._requestManager,f.localIdeographFontFamily),this.lineAtlas=new Oi(256,512),this.crossTileSymbolIndex=new ta,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new m.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",m.getReferrer());var P=this;this._rtlTextPluginCallback=c.registerForPluginStateChange(function(M){P.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:M.pluginStatus,pluginURL:M.pluginURL},function(F,X){if(m.triggerPluginCompletionEvent(F),X&&X.every(function(le){return le}))for(var Y in P.sourceCaches)P.sourceCaches[Y].reload()})}),this.on("data",function(M){if(M.dataType==="source"&&M.sourceDataType==="metadata"){var F=T.sourceCaches[M.sourceId];if(F){var X=F.getSource();if(X&&X.vectorLayerIds)for(var Y in T._layers){var le=T._layers[Y];le.source===X.id&&T._validateLayer(le)}}}})}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.loadURL=function(u,f){var T=this;f===void 0&&(f={}),this.fire(new m.Event("dataloading",{dataType:"style"}));var P=typeof f.validate=="boolean"?f.validate:!m.isMapboxURL(u);u=this.map._requestManager.normalizeStyleURL(u,f.accessToken);var M=this.map._requestManager.transformRequest(u,m.ResourceType.Style);this._request=m.getJSON(M,function(F,X){T._request=null,F?T.fire(new m.ErrorEvent(F)):X&&T._load(X,P)})},c.prototype.loadJSON=function(u,f){var T=this;f===void 0&&(f={}),this.fire(new m.Event("dataloading",{dataType:"style"})),this._request=m.browser.frame(function(){T._request=null,T._load(u,f.validate!==!1)})},c.prototype.loadEmpty=function(){this.fire(new m.Event("dataloading",{dataType:"style"})),this._load(Ra,!1)},c.prototype._load=function(u,f){if(!f||!La(this,m.validateStyle(u))){for(var T in this._loaded=!0,this.stylesheet=u,u.sources)this.addSource(T,u.sources[T],{validate:!1});u.sprite?this._loadSprite(u.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(u.glyphs);var P=we(this.stylesheet.layers);this._order=P.map(function(Y){return Y.id}),this._layers={},this._serializedLayers={};for(var M=0,F=P;M<F.length;M+=1){var X=F[M];(X=m.createStyleLayer(X)).setEventedParent(this,{layer:{id:X.id}}),this._layers[X.id]=X,this._serializedLayers[X.id]=X.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Mr(this.stylesheet.light),this.fire(new m.Event("data",{dataType:"style"})),this.fire(new m.Event("style.load"))}},c.prototype._loadSprite=function(u){var f=this;this._spriteRequest=function(T,P,M){var F,X,Y,le=m.browser.devicePixelRatio>1?"@2x":"",ce=m.getJSON(P.transformRequest(P.normalizeSpriteURL(T,le,".json"),m.ResourceType.SpriteJSON),function(Ae,ke){ce=null,Y||(Y=Ae,F=ke,Ce())}),de=m.getImage(P.transformRequest(P.normalizeSpriteURL(T,le,".png"),m.ResourceType.SpriteImage),function(Ae,ke){de=null,Y||(Y=Ae,X=ke,Ce())});function Ce(){if(Y)M(Y);else if(F&&X){var Ae=m.browser.getImageData(X),ke={};for(var xe in F){var ze=F[xe],Be=ze.width,Ge=ze.height,Je=ze.x,Ye=ze.y,Qe=ze.sdf,ht=ze.pixelRatio,bt=ze.stretchX,xt=ze.stretchY,Dt=ze.content,Yt=new m.RGBAImage({width:Be,height:Ge});m.RGBAImage.copy(Ae,Yt,{x:Je,y:Ye},{x:0,y:0},{width:Be,height:Ge}),ke[xe]={data:Yt,pixelRatio:ht,sdf:Qe,stretchX:bt,stretchY:xt,content:Dt}}M(null,ke)}}return{cancel:function(){ce&&(ce.cancel(),ce=null),de&&(de.cancel(),de=null)}}}(u,this.map._requestManager,function(T,P){if(f._spriteRequest=null,T)f.fire(new m.ErrorEvent(T));else if(P)for(var M in P)f.imageManager.addImage(M,P[M]);f.imageManager.setLoaded(!0),f._availableImages=f.imageManager.listImages(),f.dispatcher.broadcast("setImages",f._availableImages),f.fire(new m.Event("data",{dataType:"style"}))})},c.prototype._validateLayer=function(u){var f=this.sourceCaches[u.source];if(f){var T=u.sourceLayer;if(T){var P=f.getSource();(P.type==="geojson"||P.vectorLayerIds&&P.vectorLayerIds.indexOf(T)===-1)&&this.fire(new m.ErrorEvent(new Error('Source layer "'+T+'" does not exist on source "'+P.id+'" as specified by style layer "'+u.id+'"')))}}},c.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var u in this.sourceCaches)if(!this.sourceCaches[u].loaded())return!1;return!!this.imageManager.isLoaded()},c.prototype._serializeLayers=function(u){for(var f=[],T=0,P=u;T<P.length;T+=1){var M=this._layers[P[T]];M.type!=="custom"&&f.push(M.serialize())}return f},c.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var u in this.sourceCaches)if(this.sourceCaches[u].hasTransition())return!0;for(var f in this._layers)if(this._layers[f].hasTransition())return!0;return!1},c.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},c.prototype.update=function(u){if(this._loaded){var f=this._changed;if(this._changed){var T=Object.keys(this._updatedLayers),P=Object.keys(this._removedLayers);for(var M in(T.length||P.length)&&this._updateWorkerLayers(T,P),this._updatedSources){var F=this._updatedSources[M];F==="reload"?this._reloadSource(M):F==="clear"&&this._clearSource(M)}for(var X in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[X].updateTransitions(u);this.light.updateTransitions(u),this._resetUpdates()}var Y={};for(var le in this.sourceCaches){var ce=this.sourceCaches[le];Y[le]=ce.used,ce.used=!1}for(var de=0,Ce=this._order;de<Ce.length;de+=1){var Ae=this._layers[Ce[de]];Ae.recalculate(u,this._availableImages),!Ae.isHidden(u.zoom)&&Ae.source&&(this.sourceCaches[Ae.source].used=!0)}for(var ke in Y){var xe=this.sourceCaches[ke];Y[ke]!==xe.used&&xe.fire(new m.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:ke}))}this.light.recalculate(u),this.z=u.zoom,f&&this.fire(new m.Event("data",{dataType:"style"}))}},c.prototype._updateTilesForChangedImages=function(){var u=Object.keys(this._changedImages);if(u.length){for(var f in this.sourceCaches)this.sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],u);this._changedImages={}}},c.prototype._updateWorkerLayers=function(u,f){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(u),removedIds:f})},c.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},c.prototype.setState=function(u){var f=this;if(this._checkLoaded(),La(this,m.validateStyle(u)))return!1;(u=m.clone$1(u)).layers=we(u.layers);var T=function(M,F){if(!M)return[{command:Se.setStyle,args:[F]}];var X=[];try{if(!m.deepEqual(M.version,F.version))return[{command:Se.setStyle,args:[F]}];m.deepEqual(M.center,F.center)||X.push({command:Se.setCenter,args:[F.center]}),m.deepEqual(M.zoom,F.zoom)||X.push({command:Se.setZoom,args:[F.zoom]}),m.deepEqual(M.bearing,F.bearing)||X.push({command:Se.setBearing,args:[F.bearing]}),m.deepEqual(M.pitch,F.pitch)||X.push({command:Se.setPitch,args:[F.pitch]}),m.deepEqual(M.sprite,F.sprite)||X.push({command:Se.setSprite,args:[F.sprite]}),m.deepEqual(M.glyphs,F.glyphs)||X.push({command:Se.setGlyphs,args:[F.glyphs]}),m.deepEqual(M.transition,F.transition)||X.push({command:Se.setTransition,args:[F.transition]}),m.deepEqual(M.light,F.light)||X.push({command:Se.setLight,args:[F.light]});var Y={},le=[];(function(de,Ce,Ae,ke){var xe;for(xe in Ce=Ce||{},de=de||{})de.hasOwnProperty(xe)&&(Ce.hasOwnProperty(xe)||je(xe,Ae,ke));for(xe in Ce)Ce.hasOwnProperty(xe)&&(de.hasOwnProperty(xe)?m.deepEqual(de[xe],Ce[xe])||(de[xe].type==="geojson"&&Ce[xe].type==="geojson"&&Tt(de,Ce,xe)?Ae.push({command:Se.setGeoJSONSourceData,args:[xe,Ce[xe].data]}):He(xe,Ce,Ae,ke)):$e(xe,Ce,Ae))})(M.sources,F.sources,le,Y);var ce=[];M.layers&&M.layers.forEach(function(de){Y[de.source]?X.push({command:Se.removeLayer,args:[de.id]}):ce.push(de)}),X=X.concat(le),function(de,Ce,Ae){Ce=Ce||[];var ke,xe,ze,Be,Ge,Je,Ye,Qe=(de=de||[]).map(wt),ht=Ce.map(wt),bt=de.reduce(It,{}),xt=Ce.reduce(It,{}),Dt=Qe.slice(),Yt=Object.create(null);for(ke=0,xe=0;ke<Qe.length;ke++)xt.hasOwnProperty(ze=Qe[ke])?xe++:(Ae.push({command:Se.removeLayer,args:[ze]}),Dt.splice(Dt.indexOf(ze,xe),1));for(ke=0,xe=0;ke<ht.length;ke++)Dt[Dt.length-1-ke]!==(ze=ht[ht.length-1-ke])&&(bt.hasOwnProperty(ze)?(Ae.push({command:Se.removeLayer,args:[ze]}),Dt.splice(Dt.lastIndexOf(ze,Dt.length-xe),1)):xe++,Ae.push({command:Se.addLayer,args:[xt[ze],Je=Dt[Dt.length-ke]]}),Dt.splice(Dt.length-ke,0,ze),Yt[ze]=!0);for(ke=0;ke<ht.length;ke++)if(Be=bt[ze=ht[ke]],Ge=xt[ze],!Yt[ze]&&!m.deepEqual(Be,Ge))if(m.deepEqual(Be.source,Ge.source)&&m.deepEqual(Be["source-layer"],Ge["source-layer"])&&m.deepEqual(Be.type,Ge.type)){for(Ye in ft(Be.layout,Ge.layout,Ae,ze,null,Se.setLayoutProperty),ft(Be.paint,Ge.paint,Ae,ze,null,Se.setPaintProperty),m.deepEqual(Be.filter,Ge.filter)||Ae.push({command:Se.setFilter,args:[ze,Ge.filter]}),m.deepEqual(Be.minzoom,Ge.minzoom)&&m.deepEqual(Be.maxzoom,Ge.maxzoom)||Ae.push({command:Se.setLayerZoomRange,args:[ze,Ge.minzoom,Ge.maxzoom]}),Be)Be.hasOwnProperty(Ye)&&Ye!=="layout"&&Ye!=="paint"&&Ye!=="filter"&&Ye!=="metadata"&&Ye!=="minzoom"&&Ye!=="maxzoom"&&(Ye.indexOf("paint.")===0?ft(Be[Ye],Ge[Ye],Ae,ze,Ye.slice(6),Se.setPaintProperty):m.deepEqual(Be[Ye],Ge[Ye])||Ae.push({command:Se.setLayerProperty,args:[ze,Ye,Ge[Ye]]}));for(Ye in Ge)Ge.hasOwnProperty(Ye)&&!Be.hasOwnProperty(Ye)&&Ye!=="layout"&&Ye!=="paint"&&Ye!=="filter"&&Ye!=="metadata"&&Ye!=="minzoom"&&Ye!=="maxzoom"&&(Ye.indexOf("paint.")===0?ft(Be[Ye],Ge[Ye],Ae,ze,Ye.slice(6),Se.setPaintProperty):m.deepEqual(Be[Ye],Ge[Ye])||Ae.push({command:Se.setLayerProperty,args:[ze,Ye,Ge[Ye]]}))}else Ae.push({command:Se.removeLayer,args:[ze]}),Je=Dt[Dt.lastIndexOf(ze)+1],Ae.push({command:Se.addLayer,args:[Ge,Je]})}(ce,F.layers,X)}catch(de){console.warn("Unable to compute style diff:",de),X=[{command:Se.setStyle,args:[F]}]}return X}(this.serialize(),u).filter(function(M){return!(M.command in Da)});if(T.length===0)return!1;var P=T.filter(function(M){return!(M.command in Ri)});if(P.length>0)throw new Error("Unimplemented: "+P.map(function(M){return M.command}).join(", ")+".");return T.forEach(function(M){M.command!=="setTransition"&&f[M.command].apply(f,M.args)}),this.stylesheet=u,!0},c.prototype.addImage=function(u,f){if(this.getImage(u))return this.fire(new m.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(u,f),this._afterImageUpdated(u)},c.prototype.updateImage=function(u,f){this.imageManager.updateImage(u,f)},c.prototype.getImage=function(u){return this.imageManager.getImage(u)},c.prototype.removeImage=function(u){if(!this.getImage(u))return this.fire(new m.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(u),this._afterImageUpdated(u)},c.prototype._afterImageUpdated=function(u){this._availableImages=this.imageManager.listImages(),this._changedImages[u]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new m.Event("data",{dataType:"style"}))},c.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},c.prototype.addSource=function(u,f,T){var P=this;if(T===void 0&&(T={}),this._checkLoaded(),this.sourceCaches[u]!==void 0)throw new Error("There is already a source with this ID");if(!f.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(f).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(m.validateStyle.source,"sources."+u,f,null,T))){this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);var M=this.sourceCaches[u]=new Pe(u,f,this.dispatcher);M.style=this,M.setEventedParent(this,function(){return{isSourceLoaded:P.loaded(),source:M.serialize(),sourceId:u}}),M.onAdd(this.map),this._changed=!0}},c.prototype.removeSource=function(u){if(this._checkLoaded(),this.sourceCaches[u]===void 0)throw new Error("There is no source with this ID");for(var f in this._layers)if(this._layers[f].source===u)return this.fire(new m.ErrorEvent(new Error('Source "'+u+'" cannot be removed while layer "'+f+'" is using it.')));var T=this.sourceCaches[u];delete this.sourceCaches[u],delete this._updatedSources[u],T.fire(new m.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:u})),T.setEventedParent(null),T.clearTiles(),T.onRemove&&T.onRemove(this.map),this._changed=!0},c.prototype.setGeoJSONSourceData=function(u,f){this._checkLoaded(),this.sourceCaches[u].getSource().setData(f),this._changed=!0},c.prototype.getSource=function(u){return this.sourceCaches[u]&&this.sourceCaches[u].getSource()},c.prototype.addLayer=function(u,f,T){T===void 0&&(T={}),this._checkLoaded();var P=u.id;if(this.getLayer(P))this.fire(new m.ErrorEvent(new Error('Layer with id "'+P+'" already exists on this map')));else{var M;if(u.type==="custom"){if(La(this,m.validateCustomStyleLayer(u)))return;M=m.createStyleLayer(u)}else{if(typeof u.source=="object"&&(this.addSource(P,u.source),u=m.clone$1(u),u=m.extend(u,{source:P})),this._validate(m.validateStyle.layer,"layers."+P,u,{arrayIndex:-1},T))return;M=m.createStyleLayer(u),this._validateLayer(M),M.setEventedParent(this,{layer:{id:P}}),this._serializedLayers[M.id]=M.serialize()}var F=f?this._order.indexOf(f):this._order.length;if(f&&F===-1)this.fire(new m.ErrorEvent(new Error('Layer with id "'+f+'" does not exist on this map.')));else{if(this._order.splice(F,0,P),this._layerOrderChanged=!0,this._layers[P]=M,this._removedLayers[P]&&M.source&&M.type!=="custom"){var X=this._removedLayers[P];delete this._removedLayers[P],X.type!==M.type?this._updatedSources[M.source]="clear":(this._updatedSources[M.source]="reload",this.sourceCaches[M.source].pause())}this._updateLayer(M),M.onAdd&&M.onAdd(this.map)}}},c.prototype.moveLayer=function(u,f){if(this._checkLoaded(),this._changed=!0,this._layers[u]){if(u!==f){var T=this._order.indexOf(u);this._order.splice(T,1);var P=f?this._order.indexOf(f):this._order.length;f&&P===-1?this.fire(new m.ErrorEvent(new Error('Layer with id "'+f+'" does not exist on this map.'))):(this._order.splice(P,0,u),this._layerOrderChanged=!0)}}else this.fire(new m.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style and cannot be moved.")))},c.prototype.removeLayer=function(u){this._checkLoaded();var f=this._layers[u];if(f){f.setEventedParent(null);var T=this._order.indexOf(u);this._order.splice(T,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[u]=f,delete this._layers[u],delete this._serializedLayers[u],delete this._updatedLayers[u],delete this._updatedPaintProps[u],f.onRemove&&f.onRemove(this.map)}else this.fire(new m.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style and cannot be removed.")))},c.prototype.getLayer=function(u){return this._layers[u]},c.prototype.hasLayer=function(u){return u in this._layers},c.prototype.setLayerZoomRange=function(u,f,T){this._checkLoaded();var P=this.getLayer(u);P?P.minzoom===f&&P.maxzoom===T||(f!=null&&(P.minzoom=f),T!=null&&(P.maxzoom=T),this._updateLayer(P)):this.fire(new m.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style and cannot have zoom extent.")))},c.prototype.setFilter=function(u,f,T){T===void 0&&(T={}),this._checkLoaded();var P=this.getLayer(u);if(P){if(!m.deepEqual(P.filter,f))return f==null?(P.filter=void 0,void this._updateLayer(P)):void(this._validate(m.validateStyle.filter,"layers."+P.id+".filter",f,null,T)||(P.filter=m.clone$1(f),this._updateLayer(P)))}else this.fire(new m.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style and cannot be filtered.")))},c.prototype.getFilter=function(u){return m.clone$1(this.getLayer(u).filter)},c.prototype.setLayoutProperty=function(u,f,T,P){P===void 0&&(P={}),this._checkLoaded();var M=this.getLayer(u);M?m.deepEqual(M.getLayoutProperty(f),T)||(M.setLayoutProperty(f,T,P),this._updateLayer(M)):this.fire(new m.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style and cannot be styled.")))},c.prototype.getLayoutProperty=function(u,f){var T=this.getLayer(u);if(T)return T.getLayoutProperty(f);this.fire(new m.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style.")))},c.prototype.setPaintProperty=function(u,f,T,P){P===void 0&&(P={}),this._checkLoaded();var M=this.getLayer(u);M?m.deepEqual(M.getPaintProperty(f),T)||(M.setPaintProperty(f,T,P)&&this._updateLayer(M),this._changed=!0,this._updatedPaintProps[u]=!0):this.fire(new m.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style and cannot be styled.")))},c.prototype.getPaintProperty=function(u,f){return this.getLayer(u).getPaintProperty(f)},c.prototype.setFeatureState=function(u,f){this._checkLoaded();var T=u.source,P=u.sourceLayer,M=this.sourceCaches[T];if(M!==void 0){var F=M.getSource().type;F==="geojson"&&P?this.fire(new m.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):F!=="vector"||P?(u.id===void 0&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),M.setFeatureState(P,u.id,f)):this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+T+"' does not exist in the map's style.")))},c.prototype.removeFeatureState=function(u,f){this._checkLoaded();var T=u.source,P=this.sourceCaches[T];if(P!==void 0){var M=P.getSource().type,F=M==="vector"?u.sourceLayer:void 0;M!=="vector"||F?f&&typeof u.id!="string"&&typeof u.id!="number"?this.fire(new m.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):P.removeFeatureState(F,u.id,f):this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+T+"' does not exist in the map's style.")))},c.prototype.getFeatureState=function(u){this._checkLoaded();var f=u.source,T=u.sourceLayer,P=this.sourceCaches[f];if(P!==void 0){if(P.getSource().type!=="vector"||T)return u.id===void 0&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),P.getFeatureState(T,u.id);this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+f+"' does not exist in the map's style.")))},c.prototype.getTransition=function(){return m.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},c.prototype.serialize=function(){return m.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:m.mapObject(this.sourceCaches,function(u){return u.serialize()}),layers:this._serializeLayers(this._order)},function(u){return u!==void 0})},c.prototype._updateLayer=function(u){this._updatedLayers[u.id]=!0,u.source&&!this._updatedSources[u.source]&&this.sourceCaches[u.source].getSource().type!=="raster"&&(this._updatedSources[u.source]="reload",this.sourceCaches[u.source].pause()),this._changed=!0},c.prototype._flattenAndSortRenderedFeatures=function(u){for(var f=this,T=function(bt){return f._layers[bt].type==="fill-extrusion"},P={},M=[],F=this._order.length-1;F>=0;F--){var X=this._order[F];if(T(X)){P[X]=F;for(var Y=0,le=u;Y<le.length;Y+=1){var ce=le[Y][X];if(ce)for(var de=0,Ce=ce;de<Ce.length;de+=1)M.push(Ce[de])}}}M.sort(function(bt,xt){return xt.intersectionZ-bt.intersectionZ});for(var Ae=[],ke=this._order.length-1;ke>=0;ke--){var xe=this._order[ke];if(T(xe))for(var ze=M.length-1;ze>=0;ze--){var Be=M[ze].feature;if(P[Be.layer.id]<ke)break;Ae.push(Be),M.pop()}else for(var Ge=0,Je=u;Ge<Je.length;Ge+=1){var Ye=Je[Ge][xe];if(Ye)for(var Qe=0,ht=Ye;Qe<ht.length;Qe+=1)Ae.push(ht[Qe].feature)}}return Ae},c.prototype.queryRenderedFeatures=function(u,f,T){f&&f.filter&&this._validate(m.validateStyle.filter,"queryRenderedFeatures.filter",f.filter,null,f);var P={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new m.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var M=0,F=f.layers;M<F.length;M+=1){var X=F[M],Y=this._layers[X];if(!Y)return this.fire(new m.ErrorEvent(new Error("The layer '"+X+"' does not exist in the map's style and cannot be queried for features."))),[];P[Y.source]=!0}}var le=[];for(var ce in f.availableImages=this._availableImages,this.sourceCaches)f.layers&&!P[ce]||le.push(wr(this.sourceCaches[ce],this._layers,this._serializedLayers,u,f,T));return this.placement&&le.push(function(de,Ce,Ae,ke,xe,ze,Be){for(var Ge={},Je=ze.queryRenderedSymbols(ke),Ye=[],Qe=0,ht=Object.keys(Je).map(Number);Qe<ht.length;Qe+=1)Ye.push(Be[ht[Qe]]);Ye.sort(hn);for(var bt=function(){var Jt=Dt[xt],Mi=Jt.featureIndex.lookupSymbolFeatures(Je[Jt.bucketInstanceId],Ce,Jt.bucketIndex,Jt.sourceLayerIndex,xe.filter,xe.layers,xe.availableImages,de);for(var Nt in Mi){var fi=Ge[Nt]=Ge[Nt]||[],Ci=Mi[Nt];Ci.sort(function(_i,ri){var ei=Jt.featureSortOrder;if(ei){var Ar=ei.indexOf(_i.featureIndex);return ei.indexOf(ri.featureIndex)-Ar}return ri.featureIndex-_i.featureIndex});for(var pi=0,li=Ci;pi<li.length;pi+=1)fi.push(li[pi])}},xt=0,Dt=Ye;xt<Dt.length;xt+=1)bt();var Yt=function(Jt){Ge[Jt].forEach(function(Mi){var Nt=Mi.feature,fi=Ae[de[Jt].source].getFeatureState(Nt.layer["source-layer"],Nt.id);Nt.source=Nt.layer.source,Nt.layer["source-layer"]&&(Nt.sourceLayer=Nt.layer["source-layer"]),Nt.state=fi})};for(var ti in Ge)Yt(ti);return Ge}(this._layers,this._serializedLayers,this.sourceCaches,u,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(le)},c.prototype.querySourceFeatures=function(u,f){f&&f.filter&&this._validate(m.validateStyle.filter,"querySourceFeatures.filter",f.filter,null,f);var T=this.sourceCaches[u];return T?function(P,M){for(var F=P.getRenderableIds().map(function(Ce){return P.getTileByID(Ce)}),X=[],Y={},le=0;le<F.length;le++){var ce=F[le],de=ce.tileID.canonical.key;Y[de]||(Y[de]=!0,ce.querySourceFeatures(X,M))}return X}(T,f):[]},c.prototype.addSourceType=function(u,f,T){return c.getSourceType(u)?T(new Error('A source type called "'+u+'" already exists.')):(c.setSourceType(u,f),f.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:u,url:f.workerSourceURL},T):T(null,null))},c.prototype.getLight=function(){return this.light.getLight()},c.prototype.setLight=function(u,f){f===void 0&&(f={}),this._checkLoaded();var T=this.light.getLight(),P=!1;for(var M in u)if(!m.deepEqual(u[M],T[M])){P=!0;break}if(P){var F={now:m.browser.now(),transition:m.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(u,f),this.light.updateTransitions(F)}},c.prototype._validate=function(u,f,T,P,M){return M===void 0&&(M={}),(!M||M.validate!==!1)&&La(this,u.call(m.validateStyle,m.extend({key:f,style:this.serialize(),value:T,styleSpec:m.styleSpec},P)))},c.prototype._remove=function(){for(var u in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),m.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[u].setEventedParent(null);for(var f in this.sourceCaches)this.sourceCaches[f].clearTiles(),this.sourceCaches[f].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},c.prototype._clearSource=function(u){this.sourceCaches[u].clearTiles()},c.prototype._reloadSource=function(u){this.sourceCaches[u].resume(),this.sourceCaches[u].reload()},c.prototype._updateSources=function(u){for(var f in this.sourceCaches)this.sourceCaches[f].update(u)},c.prototype._generateCollisionBoxes=function(){for(var u in this.sourceCaches)this._reloadSource(u)},c.prototype._updatePlacement=function(u,f,T,P,M){M===void 0&&(M=!1);for(var F=!1,X=!1,Y={},le=0,ce=this._order;le<ce.length;le+=1){var de=this._layers[ce[le]];if(de.type==="symbol"){if(!Y[de.source]){var Ce=this.sourceCaches[de.source];Y[de.source]=Ce.getRenderableIds(!0).map(function(Be){return Ce.getTileByID(Be)}).sort(function(Be,Ge){return Ge.tileID.overscaledZ-Be.tileID.overscaledZ||(Be.tileID.isLessThan(Ge.tileID)?-1:1)})}var Ae=this.crossTileSymbolIndex.addLayer(de,Y[de.source],u.center.lng);F=F||Ae}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((M=M||this._layerOrderChanged||T===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(m.browser.now(),u.zoom))&&(this.pauseablePlacement=new $s(u,this._order,M,f,T,P,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,Y),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(m.browser.now()),X=!0),F&&this.pauseablePlacement.placement.setStale()),X||F)for(var ke=0,xe=this._order;ke<xe.length;ke+=1){var ze=this._layers[xe[ke]];ze.type==="symbol"&&this.placement.updateLayerOpacities(ze,Y[ze.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(m.browser.now())},c.prototype._releaseSymbolFadeTiles=function(){for(var u in this.sourceCaches)this.sourceCaches[u].releaseSymbolFadeTiles()},c.prototype.getImages=function(u,f,T){this.imageManager.getImages(f.icons,T),this._updateTilesForChangedImages();var P=this.sourceCaches[f.source];P&&P.setDependencies(f.tileID.key,f.type,f.icons)},c.prototype.getGlyphs=function(u,f,T){this.glyphManager.getGlyphs(f.stacks,T)},c.prototype.getResource=function(u,f,T){return m.makeRequest(f,T)},c}(m.Evented);An.getSourceType=function(s){return $r[s]},An.setSourceType=function(s,c){$r[s]=c},An.registerForPluginStateChange=m.registerForPluginStateChange;var Or=m.createLayout([{name:"a_pos",type:"Int16",components:2}]),In=ir(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Cl=ir(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),zl=ir(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Pl=ir(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Hs=ir("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ws=ir(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),As=ir(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Ks=ir("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),kl=ir("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),Js=ir("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),Hu=ir(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),Is=ir(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),ia=ir(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Wu=ir(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Cn=ir(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),yu=ir(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Ba=ir(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Oa=ir(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),rs=ir(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),ma=ir(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),ra=ir(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Do=ir(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Fa=ir(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),ga=ir(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),Ml=ir(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Ua=ir(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function ir(s,c){var u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=c.match(/attribute ([\w]+) ([\w]+)/g),T=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=c.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),M=P?P.concat(T):T,F={};return{fragmentSource:s=s.replace(u,function(X,Y,le,ce,de){return F[de]=!0,Y==="define"?`
#ifndef HAS_UNIFORM_u_`+de+`
varying `+le+" "+ce+" "+de+`;
#else
uniform `+le+" "+ce+" u_"+de+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+de+`
    `+le+" "+ce+" "+de+" = u_"+de+`;
#endif
`}),vertexSource:c=c.replace(u,function(X,Y,le,ce,de){var Ce=ce==="float"?"vec2":"vec4",Ae=de.match(/color/)?"color":Ce;return F[de]?Y==="define"?`
#ifndef HAS_UNIFORM_u_`+de+`
uniform lowp float u_`+de+`_t;
attribute `+le+" "+Ce+" a_"+de+`;
varying `+le+" "+ce+" "+de+`;
#else
uniform `+le+" "+ce+" u_"+de+`;
#endif
`:Ae==="vec4"?`
#ifndef HAS_UNIFORM_u_`+de+`
    `+de+" = a_"+de+`;
#else
    `+le+" "+ce+" "+de+" = u_"+de+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+de+`
    `+de+" = unpack_mix_"+Ae+"(a_"+de+", u_"+de+`_t);
#else
    `+le+" "+ce+" "+de+" = u_"+de+`;
#endif
`:Y==="define"?`
#ifndef HAS_UNIFORM_u_`+de+`
uniform lowp float u_`+de+`_t;
attribute `+le+" "+Ce+" a_"+de+`;
#else
uniform `+le+" "+ce+" u_"+de+`;
#endif
`:Ae==="vec4"?`
#ifndef HAS_UNIFORM_u_`+de+`
    `+le+" "+ce+" "+de+" = a_"+de+`;
#else
    `+le+" "+ce+" "+de+" = u_"+de+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+de+`
    `+le+" "+ce+" "+de+" = unpack_mix_"+Ae+"(a_"+de+", u_"+de+`_t);
#else
    `+le+" "+ce+" "+de+" = u_"+de+`;
#endif
`}),staticAttributes:f,staticUniforms:M}}var ns=Object.freeze({__proto__:null,prelude:In,background:Cl,backgroundPattern:zl,circle:Pl,clippingMask:Hs,heatmap:Ws,heatmapTexture:As,collisionBox:Ks,collisionCircle:kl,debug:Js,fill:Hu,fillOutline:Is,fillOutlinePattern:ia,fillPattern:Wu,fillExtrusion:Cn,fillExtrusionPattern:yu,hillshadePrepare:Ba,hillshade:Oa,line:rs,lineGradient:ma,linePattern:ra,lineSDF:Do,raster:Fa,symbolIcon:ga,symbolSDF:Ml,symbolTextAndIcon:Ua}),ya=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function _u(s){for(var c=[],u=0;u<s.length;u++)if(s[u]!==null){var f=s[u].split(" ");c.push(f.pop())}return c}ya.prototype.bind=function(s,c,u,f,T,P,M,F){this.context=s;for(var X=this.boundPaintVertexBuffers.length!==f.length,Y=0;!X&&Y<f.length;Y++)this.boundPaintVertexBuffers[Y]!==f[Y]&&(X=!0);s.extVertexArrayObject&&this.vao&&this.boundProgram===c&&this.boundLayoutVertexBuffer===u&&!X&&this.boundIndexBuffer===T&&this.boundVertexOffset===P&&this.boundDynamicVertexBuffer===M&&this.boundDynamicVertexBuffer2===F?(s.bindVertexArrayOES.set(this.vao),M&&M.bind(),T&&T.dynamicDraw&&T.bind(),F&&F.bind()):this.freshBind(c,u,f,T,P,M,F)},ya.prototype.freshBind=function(s,c,u,f,T,P,M){var F,X=s.numAttributes,Y=this.context,le=Y.gl;if(Y.extVertexArrayObject)this.vao&&this.destroy(),this.vao=Y.extVertexArrayObject.createVertexArrayOES(),Y.bindVertexArrayOES.set(this.vao),F=0,this.boundProgram=s,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=f,this.boundVertexOffset=T,this.boundDynamicVertexBuffer=P,this.boundDynamicVertexBuffer2=M;else{F=Y.currentNumAttributes||0;for(var ce=X;ce<F;ce++)le.disableVertexAttribArray(ce)}c.enableAttributes(le,s);for(var de=0,Ce=u;de<Ce.length;de+=1)Ce[de].enableAttributes(le,s);P&&P.enableAttributes(le,s),M&&M.enableAttributes(le,s),c.bind(),c.setVertexAttribPointers(le,s,T);for(var Ae=0,ke=u;Ae<ke.length;Ae+=1){var xe=ke[Ae];xe.bind(),xe.setVertexAttribPointers(le,s,T)}P&&(P.bind(),P.setVertexAttribPointers(le,s,T)),f&&f.bind(),M&&(M.bind(),M.setVertexAttribPointers(le,s,T)),Y.currentNumAttributes=X},ya.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Ll=function(s,c,u,f,T,P){var M=s.gl;this.program=M.createProgram();for(var F=_u(u.staticAttributes),X=f?f.getBinderAttributes():[],Y=F.concat(X),le=u.staticUniforms?_u(u.staticUniforms):[],ce=f?f.getBinderUniforms():[],de=[],Ce=0,Ae=le.concat(ce);Ce<Ae.length;Ce+=1){var ke=Ae[Ce];de.indexOf(ke)<0&&de.push(ke)}var xe=f?f.defines():[];P&&xe.push("#define OVERDRAW_INSPECTOR;");var ze=xe.concat(In.fragmentSource,u.fragmentSource).join(`
`),Be=xe.concat(In.vertexSource,u.vertexSource).join(`
`),Ge=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(Ge,ze),M.compileShader(Ge),M.attachShader(this.program,Ge);var Je=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(Je,Be),M.compileShader(Je),M.attachShader(this.program,Je),this.attributes={};var Ye={};this.numAttributes=Y.length;for(var Qe=0;Qe<this.numAttributes;Qe++)Y[Qe]&&(M.bindAttribLocation(this.program,Qe,Y[Qe]),this.attributes[Y[Qe]]=Qe);M.linkProgram(this.program),M.deleteShader(Je),M.deleteShader(Ge);for(var ht=0;ht<de.length;ht++){var bt=de[ht];if(bt&&!Ye[bt]){var xt=M.getUniformLocation(this.program,bt);xt&&(Ye[bt]=xt)}}this.fixedUniforms=T(s,Ye),this.binderUniforms=f?f.getUniforms(s,Ye):[]}}};function Si(s,c,u){var f=1/pr(u,1,c.transform.tileZoom),T=Math.pow(2,u.tileID.overscaledZ),P=u.tileSize*Math.pow(2,c.transform.tileZoom)/T,M=P*(u.tileID.canonical.x+u.tileID.wrap*T),F=P*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[f,s.fromScale,s.toScale],u_fade:s.t,u_pixel_coord_upper:[M>>16,F>>16],u_pixel_coord_lower:[65535&M,65535&F]}}Ll.prototype.draw=function(s,c,u,f,T,P,M,F,X,Y,le,ce,de,Ce,Ae,ke){var xe,ze=s.gl;if(!this.failedToCreate){for(var Be in s.program.set(this.program),s.setDepthMode(u),s.setStencilMode(f),s.setColorMode(T),s.setCullFace(P),this.fixedUniforms)this.fixedUniforms[Be].set(M[Be]);Ce&&Ce.setUniforms(s,this.binderUniforms,ce,{zoom:de});for(var Ge=(xe={},xe[ze.LINES]=2,xe[ze.TRIANGLES]=3,xe[ze.LINE_STRIP]=1,xe)[c],Je=0,Ye=le.get();Je<Ye.length;Je+=1){var Qe=Ye[Je],ht=Qe.vaos||(Qe.vaos={});(ht[F]||(ht[F]=new ya)).bind(s,this,X,Ce?Ce.getPaintVertexBuffers():[],Y,Qe.vertexOffset,Ae,ke),ze.drawElements(c,Qe.primitiveLength*Ge,ze.UNSIGNED_SHORT,Qe.primitiveOffset*Ge*2)}}};var Ys=function(s,c,u,f){var T=c.style.light,P=T.properties.get("position"),M=[P.x,P.y,P.z],F=m.create$1();T.properties.get("anchor")==="viewport"&&m.fromRotation(F,-c.transform.angle),m.transformMat3(M,M,F);var X=T.properties.get("color");return{u_matrix:s,u_lightpos:M,u_lightintensity:T.properties.get("intensity"),u_lightcolor:[X.r,X.g,X.b],u_vertical_gradient:+u,u_opacity:f}},Ni=function(s,c,u,f,T,P,M){return m.extend(Ys(s,c,u,f),Si(P,c,M),{u_height_factor:-Math.pow(2,T.overscaledZ)/M.tileSize/8})},No=function(s){return{u_matrix:s}},sr=function(s,c,u,f){return m.extend(No(s),Si(u,c,f))},Fr=function(s,c){return{u_matrix:s,u_world:c}},Qs=function(s,c,u,f,T){return m.extend(sr(s,c,u,f),{u_world:T})},el=function(s,c,u,f){var T,P,M=s.transform;if(f.paint.get("circle-pitch-alignment")==="map"){var F=pr(u,1,M.zoom);T=!0,P=[F,F]}else T=!1,P=M.pixelsToGLUnits;return{u_camera_to_center_distance:M.cameraToCenterDistance,u_scale_with_map:+(f.paint.get("circle-pitch-scale")==="map"),u_matrix:s.translatePosMatrix(c.posMatrix,u,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_pitch_with_map:+T,u_device_pixel_ratio:m.browser.devicePixelRatio,u_extrude_scale:P}},os=function(s,c,u){var f=pr(u,1,c.zoom),T=Math.pow(2,c.zoom-u.tileID.overscaledZ),P=u.tileID.overscaleFactor();return{u_matrix:s,u_camera_to_center_distance:c.cameraToCenterDistance,u_pixels_to_tile_units:f,u_extrude_scale:[c.pixelsToGLUnits[0]/(f*T),c.pixelsToGLUnits[1]/(f*T)],u_overscale_factor:P}},Dl=function(s,c,u){return{u_matrix:s,u_inv_matrix:c,u_camera_to_center_distance:u.cameraToCenterDistance,u_viewport_size:[u.width,u.height]}},na=function(s,c,u){return u===void 0&&(u=1),{u_matrix:s,u_color:c,u_overlay:0,u_overlay_scale:u}},oa=function(s){return{u_matrix:s}},tl=function(s,c,u,f){return{u_matrix:s,u_extrude_scale:pr(c,1,u),u_intensity:f}},Va=function(s,c,u){var f=s.transform;return{u_matrix:vu(s,c,u),u_ratio:1/pr(c,1,f.zoom),u_device_pixel_ratio:m.browser.devicePixelRatio,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},lr=function(s,c,u,f){return m.extend(Va(s,c,u),{u_image:0,u_image_height:f})},_a=function(s,c,u,f){var T=s.transform,P=Nn(c,T);return{u_matrix:vu(s,c,u),u_texsize:c.imageAtlasTexture.size,u_ratio:1/pr(c,1,T.zoom),u_device_pixel_ratio:m.browser.devicePixelRatio,u_image:0,u_scale:[P,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]]}},Rl=function(s,c,u,f,T){var P=s.lineAtlas,M=Nn(c,s.transform),F=u.layout.get("line-cap")==="round",X=P.getDash(f.from,F),Y=P.getDash(f.to,F),le=X.width*T.fromScale,ce=Y.width*T.toScale;return m.extend(Va(s,c,u),{u_patternscale_a:[M/le,-X.height/2],u_patternscale_b:[M/ce,-Y.height/2],u_sdfgamma:P.width/(256*Math.min(le,ce)*m.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:X.y,u_tex_y_b:Y.y,u_mix:T.t})};function Nn(s,c){return 1/pr(s,1,c.tileZoom)}function vu(s,c,u){return s.translatePosMatrix(c.tileID.posMatrix,c,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}var Ku=function(s,c,u,f,T){return{u_matrix:s,u_tl_parent:c,u_scale_parent:u,u_buffer_scale:1,u_fade_t:f.mix,u_opacity:f.opacity*T.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:T.paint.get("raster-brightness-min"),u_brightness_high:T.paint.get("raster-brightness-max"),u_saturation_factor:(M=T.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(P=T.paint.get("raster-contrast"),P>0?1/(1-P):1+P),u_spin_weights:xu(T.paint.get("raster-hue-rotate"))};var P,M};function xu(s){s*=Math.PI/180;var c=Math.sin(s),u=Math.cos(s);return[(2*u+1)/3,(-Math.sqrt(3)*c-u+1)/3,(Math.sqrt(3)*c-u+1)/3]}var va,xa=function(s,c,u,f,T,P,M,F,X,Y){var le=T.transform;return{u_is_size_zoom_constant:+(s==="constant"||s==="source"),u_is_size_feature_constant:+(s==="constant"||s==="camera"),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:le.cameraToCenterDistance,u_pitch:le.pitch/360*2*Math.PI,u_rotate_symbol:+u,u_aspect_ratio:le.width/le.height,u_fade_change:T.options.fadeDuration?T.symbolFadeChange:1,u_matrix:P,u_label_plane_matrix:M,u_coord_matrix:F,u_is_text:+X,u_pitch_with_map:+f,u_texsize:Y,u_texture:0}},as=function(s,c,u,f,T,P,M,F,X,Y,le){var ce=T.transform;return m.extend(xa(s,c,u,f,T,P,M,F,X,Y),{u_gamma_scale:f?Math.cos(ce._pitch)*ce.cameraToCenterDistance:1,u_device_pixel_ratio:m.browser.devicePixelRatio,u_is_halo:+le})},il=function(s,c,u,f,T,P,M,F,X,Y){return m.extend(as(s,c,u,f,T,P,M,F,!0,X,!0),{u_texsize_icon:Y,u_texture_icon:1})},Na=function(s,c,u){return{u_matrix:s,u_opacity:c,u_color:u}},ba=function(s,c,u,f,T,P){return m.extend(function(M,F,X,Y){var le=X.imageManager.getPattern(M.from.toString()),ce=X.imageManager.getPattern(M.to.toString()),de=X.imageManager.getPixelSize(),Ce=de.width,Ae=de.height,ke=Math.pow(2,Y.tileID.overscaledZ),xe=Y.tileSize*Math.pow(2,X.transform.tileZoom)/ke,ze=xe*(Y.tileID.canonical.x+Y.tileID.wrap*ke),Be=xe*Y.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:le.tl,u_pattern_br_a:le.br,u_pattern_tl_b:ce.tl,u_pattern_br_b:ce.br,u_texsize:[Ce,Ae],u_mix:F.t,u_pattern_size_a:le.displaySize,u_pattern_size_b:ce.displaySize,u_scale_a:F.fromScale,u_scale_b:F.toScale,u_tile_units_to_pixels:1/pr(Y,1,X.transform.tileZoom),u_pixel_coord_upper:[ze>>16,Be>>16],u_pixel_coord_lower:[65535&ze,65535&Be]}}(f,P,u,T),{u_matrix:s,u_opacity:c})},bu={fillExtrusion:function(s,c){return{u_matrix:new m.UniformMatrix4f(s,c.u_matrix),u_lightpos:new m.Uniform3f(s,c.u_lightpos),u_lightintensity:new m.Uniform1f(s,c.u_lightintensity),u_lightcolor:new m.Uniform3f(s,c.u_lightcolor),u_vertical_gradient:new m.Uniform1f(s,c.u_vertical_gradient),u_opacity:new m.Uniform1f(s,c.u_opacity)}},fillExtrusionPattern:function(s,c){return{u_matrix:new m.UniformMatrix4f(s,c.u_matrix),u_lightpos:new m.Uniform3f(s,c.u_lightpos),u_lightintensity:new m.Uniform1f(s,c.u_lightintensity),u_lightcolor:new m.Uniform3f(s,c.u_lightcolor),u_vertical_gradient:new m.Uniform1f(s,c.u_vertical_gradient),u_height_factor:new m.Uniform1f(s,c.u_height_factor),u_image:new m.Uniform1i(s,c.u_image),u_texsize:new m.Uniform2f(s,c.u_texsize),u_pixel_coord_upper:new m.Uniform2f(s,c.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(s,c.u_pixel_coord_lower),u_scale:new m.Uniform3f(s,c.u_scale),u_fade:new m.Uniform1f(s,c.u_fade),u_opacity:new m.Uniform1f(s,c.u_opacity)}},fill:function(s,c){return{u_matrix:new m.UniformMatrix4f(s,c.u_matrix)}},fillPattern:function(s,c){return{u_matrix:new m.UniformMatrix4f(s,c.u_matrix),u_image:new m.Uniform1i(s,c.u_image),u_texsize:new m.Uniform2f(s,c.u_texsize),u_pixel_coord_upper:new m.Uniform2f(s,c.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(s,c.u_pixel_coord_lower),u_scale:new m.Uniform3f(s,c.u_scale),u_fade:new m.Uniform1f(s,c.u_fade)}},fillOutline:function(s,c){return{u_matrix:new m.UniformMatrix4f(s,c.u_matrix),u_world:new m.Uniform2f(s,c.u_world)}},fillOutlinePattern:function(s,c){return{u_matrix:new m.UniformMatrix4f(s,c.u_matrix),u_world:new m.Uniform2f(s,c.u_world),u_image:new m.Uniform1i(s,c.u_image),u_texsize:new m.Uniform2f(s,c.u_texsize),u_pixel_coord_upper:new m.Uniform2f(s,c.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(s,c.u_pixel_coord_lower),u_scale:new m.Uniform3f(s,c.u_scale),u_fade:new m.Uniform1f(s,c.u_fade)}},circle:function(s,c){return{u_camera_to_center_distance:new m.Uniform1f(s,c.u_camera_to_center_distance),u_scale_with_map:new m.Uniform1i(s,c.u_scale_with_map),u_pitch_with_map:new m.Uniform1i(s,c.u_pitch_with_map),u_extrude_scale:new m.Uniform2f(s,c.u_extrude_scale),u_device_pixel_ratio:new m.Uniform1f(s,c.u_device_pixel_ratio),u_matrix:new m.UniformMatrix4f(s,c.u_matrix)}},collisionBox:function(s,c){return{u_matrix:new m.UniformMatrix4f(s,c.u_matrix),u_camera_to_center_distance:new m.Uniform1f(s,c.u_camera_to_center_distance),u_pixels_to_tile_units:new m.Uniform1f(s,c.u_pixels_to_tile_units),u_extrude_scale:new m.Uniform2f(s,c.u_extrude_scale),u_overscale_factor:new m.Uniform1f(s,c.u_overscale_factor)}},collisionCircle:function(s,c){return{u_matrix:new m.UniformMatrix4f(s,c.u_matrix),u_inv_matrix:new m.UniformMatrix4f(s,c.u_inv_matrix),u_camera_to_center_distance:new m.Uniform1f(s,c.u_camera_to_center_distance),u_viewport_size:new m.Uniform2f(s,c.u_viewport_size)}},debug:function(s,c){return{u_color:new m.UniformColor(s,c.u_color),u_matrix:new m.UniformMatrix4f(s,c.u_matrix),u_overlay:new m.Uniform1i(s,c.u_overlay),u_overlay_scale:new m.Uniform1f(s,c.u_overlay_scale)}},clippingMask:function(s,c){return{u_matrix:new m.UniformMatrix4f(s,c.u_matrix)}},heatmap:function(s,c){return{u_extrude_scale:new m.Uniform1f(s,c.u_extrude_scale),u_intensity:new m.Uniform1f(s,c.u_intensity),u_matrix:new m.UniformMatrix4f(s,c.u_matrix)}},heatmapTexture:function(s,c){return{u_matrix:new m.UniformMatrix4f(s,c.u_matrix),u_world:new m.Uniform2f(s,c.u_world),u_image:new m.Uniform1i(s,c.u_image),u_color_ramp:new m.Uniform1i(s,c.u_color_ramp),u_opacity:new m.Uniform1f(s,c.u_opacity)}},hillshade:function(s,c){return{u_matrix:new m.UniformMatrix4f(s,c.u_matrix),u_image:new m.Uniform1i(s,c.u_image),u_latrange:new m.Uniform2f(s,c.u_latrange),u_light:new m.Uniform2f(s,c.u_light),u_shadow:new m.UniformColor(s,c.u_shadow),u_highlight:new m.UniformColor(s,c.u_highlight),u_accent:new m.UniformColor(s,c.u_accent)}},hillshadePrepare:function(s,c){return{u_matrix:new m.UniformMatrix4f(s,c.u_matrix),u_image:new m.Uniform1i(s,c.u_image),u_dimension:new m.Uniform2f(s,c.u_dimension),u_zoom:new m.Uniform1f(s,c.u_zoom),u_unpack:new m.Uniform4f(s,c.u_unpack)}},line:function(s,c){return{u_matrix:new m.UniformMatrix4f(s,c.u_matrix),u_ratio:new m.Uniform1f(s,c.u_ratio),u_device_pixel_ratio:new m.Uniform1f(s,c.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(s,c.u_units_to_pixels)}},lineGradient:function(s,c){return{u_matrix:new m.UniformMatrix4f(s,c.u_matrix),u_ratio:new m.Uniform1f(s,c.u_ratio),u_device_pixel_ratio:new m.Uniform1f(s,c.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(s,c.u_units_to_pixels),u_image:new m.Uniform1i(s,c.u_image),u_image_height:new m.Uniform1f(s,c.u_image_height)}},linePattern:function(s,c){return{u_matrix:new m.UniformMatrix4f(s,c.u_matrix),u_texsize:new m.Uniform2f(s,c.u_texsize),u_ratio:new m.Uniform1f(s,c.u_ratio),u_device_pixel_ratio:new m.Uniform1f(s,c.u_device_pixel_ratio),u_image:new m.Uniform1i(s,c.u_image),u_units_to_pixels:new m.Uniform2f(s,c.u_units_to_pixels),u_scale:new m.Uniform3f(s,c.u_scale),u_fade:new m.Uniform1f(s,c.u_fade)}},lineSDF:function(s,c){return{u_matrix:new m.UniformMatrix4f(s,c.u_matrix),u_ratio:new m.Uniform1f(s,c.u_ratio),u_device_pixel_ratio:new m.Uniform1f(s,c.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(s,c.u_units_to_pixels),u_patternscale_a:new m.Uniform2f(s,c.u_patternscale_a),u_patternscale_b:new m.Uniform2f(s,c.u_patternscale_b),u_sdfgamma:new m.Uniform1f(s,c.u_sdfgamma),u_image:new m.Uniform1i(s,c.u_image),u_tex_y_a:new m.Uniform1f(s,c.u_tex_y_a),u_tex_y_b:new m.Uniform1f(s,c.u_tex_y_b),u_mix:new m.Uniform1f(s,c.u_mix)}},raster:function(s,c){return{u_matrix:new m.UniformMatrix4f(s,c.u_matrix),u_tl_parent:new m.Uniform2f(s,c.u_tl_parent),u_scale_parent:new m.Uniform1f(s,c.u_scale_parent),u_buffer_scale:new m.Uniform1f(s,c.u_buffer_scale),u_fade_t:new m.Uniform1f(s,c.u_fade_t),u_opacity:new m.Uniform1f(s,c.u_opacity),u_image0:new m.Uniform1i(s,c.u_image0),u_image1:new m.Uniform1i(s,c.u_image1),u_brightness_low:new m.Uniform1f(s,c.u_brightness_low),u_brightness_high:new m.Uniform1f(s,c.u_brightness_high),u_saturation_factor:new m.Uniform1f(s,c.u_saturation_factor),u_contrast_factor:new m.Uniform1f(s,c.u_contrast_factor),u_spin_weights:new m.Uniform3f(s,c.u_spin_weights)}},symbolIcon:function(s,c){return{u_is_size_zoom_constant:new m.Uniform1i(s,c.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(s,c.u_is_size_feature_constant),u_size_t:new m.Uniform1f(s,c.u_size_t),u_size:new m.Uniform1f(s,c.u_size),u_camera_to_center_distance:new m.Uniform1f(s,c.u_camera_to_center_distance),u_pitch:new m.Uniform1f(s,c.u_pitch),u_rotate_symbol:new m.Uniform1i(s,c.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(s,c.u_aspect_ratio),u_fade_change:new m.Uniform1f(s,c.u_fade_change),u_matrix:new m.UniformMatrix4f(s,c.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(s,c.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(s,c.u_coord_matrix),u_is_text:new m.Uniform1i(s,c.u_is_text),u_pitch_with_map:new m.Uniform1i(s,c.u_pitch_with_map),u_texsize:new m.Uniform2f(s,c.u_texsize),u_texture:new m.Uniform1i(s,c.u_texture)}},symbolSDF:function(s,c){return{u_is_size_zoom_constant:new m.Uniform1i(s,c.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(s,c.u_is_size_feature_constant),u_size_t:new m.Uniform1f(s,c.u_size_t),u_size:new m.Uniform1f(s,c.u_size),u_camera_to_center_distance:new m.Uniform1f(s,c.u_camera_to_center_distance),u_pitch:new m.Uniform1f(s,c.u_pitch),u_rotate_symbol:new m.Uniform1i(s,c.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(s,c.u_aspect_ratio),u_fade_change:new m.Uniform1f(s,c.u_fade_change),u_matrix:new m.UniformMatrix4f(s,c.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(s,c.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(s,c.u_coord_matrix),u_is_text:new m.Uniform1i(s,c.u_is_text),u_pitch_with_map:new m.Uniform1i(s,c.u_pitch_with_map),u_texsize:new m.Uniform2f(s,c.u_texsize),u_texture:new m.Uniform1i(s,c.u_texture),u_gamma_scale:new m.Uniform1f(s,c.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(s,c.u_device_pixel_ratio),u_is_halo:new m.Uniform1i(s,c.u_is_halo)}},symbolTextAndIcon:function(s,c){return{u_is_size_zoom_constant:new m.Uniform1i(s,c.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(s,c.u_is_size_feature_constant),u_size_t:new m.Uniform1f(s,c.u_size_t),u_size:new m.Uniform1f(s,c.u_size),u_camera_to_center_distance:new m.Uniform1f(s,c.u_camera_to_center_distance),u_pitch:new m.Uniform1f(s,c.u_pitch),u_rotate_symbol:new m.Uniform1i(s,c.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(s,c.u_aspect_ratio),u_fade_change:new m.Uniform1f(s,c.u_fade_change),u_matrix:new m.UniformMatrix4f(s,c.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(s,c.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(s,c.u_coord_matrix),u_is_text:new m.Uniform1i(s,c.u_is_text),u_pitch_with_map:new m.Uniform1i(s,c.u_pitch_with_map),u_texsize:new m.Uniform2f(s,c.u_texsize),u_texsize_icon:new m.Uniform2f(s,c.u_texsize_icon),u_texture:new m.Uniform1i(s,c.u_texture),u_texture_icon:new m.Uniform1i(s,c.u_texture_icon),u_gamma_scale:new m.Uniform1f(s,c.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(s,c.u_device_pixel_ratio),u_is_halo:new m.Uniform1i(s,c.u_is_halo)}},background:function(s,c){return{u_matrix:new m.UniformMatrix4f(s,c.u_matrix),u_opacity:new m.Uniform1f(s,c.u_opacity),u_color:new m.UniformColor(s,c.u_color)}},backgroundPattern:function(s,c){return{u_matrix:new m.UniformMatrix4f(s,c.u_matrix),u_opacity:new m.Uniform1f(s,c.u_opacity),u_image:new m.Uniform1i(s,c.u_image),u_pattern_tl_a:new m.Uniform2f(s,c.u_pattern_tl_a),u_pattern_br_a:new m.Uniform2f(s,c.u_pattern_br_a),u_pattern_tl_b:new m.Uniform2f(s,c.u_pattern_tl_b),u_pattern_br_b:new m.Uniform2f(s,c.u_pattern_br_b),u_texsize:new m.Uniform2f(s,c.u_texsize),u_mix:new m.Uniform1f(s,c.u_mix),u_pattern_size_a:new m.Uniform2f(s,c.u_pattern_size_a),u_pattern_size_b:new m.Uniform2f(s,c.u_pattern_size_b),u_scale_a:new m.Uniform1f(s,c.u_scale_a),u_scale_b:new m.Uniform1f(s,c.u_scale_b),u_pixel_coord_upper:new m.Uniform2f(s,c.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(s,c.u_pixel_coord_lower),u_tile_units_to_pixels:new m.Uniform1f(s,c.u_tile_units_to_pixels)}}};function aa(s,c,u,f,T,P,M){for(var F=s.context,X=F.gl,Y=s.useProgram("collisionBox"),le=[],ce=0,de=0,Ce=0;Ce<f.length;Ce++){var Ae=f[Ce],ke=c.getTile(Ae),xe=ke.getBucket(u);if(xe){var ze=Ae.posMatrix;T[0]===0&&T[1]===0||(ze=s.translatePosMatrix(Ae.posMatrix,ke,T,P));var Be=M?xe.textCollisionBox:xe.iconCollisionBox,Ge=xe.collisionCircleArray;if(Ge.length>0){var Je=m.create(),Ye=ze;m.mul(Je,xe.placementInvProjMatrix,s.transform.glCoordMatrix),m.mul(Je,Je,xe.placementViewportMatrix),le.push({circleArray:Ge,circleOffset:de,transform:Ye,invTransform:Je}),de=ce+=Ge.length/4}Be&&Y.draw(F,X.LINES,me.disabled,Te.disabled,s.colorModeForRenderPass(),Oe.disabled,os(ze,s.transform,ke),u.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,null,s.transform.zoom,null,null,Be.collisionVertexBuffer)}}if(M&&le.length){var Qe=s.useProgram("collisionCircle"),ht=new m.StructArrayLayout2f1f2i16;ht.resize(4*ce),ht._trim();for(var bt=0,xt=0,Dt=le;xt<Dt.length;xt+=1)for(var Yt=Dt[xt],ti=0;ti<Yt.circleArray.length/4;ti++){var Jt=4*ti,Mi=Yt.circleArray[Jt+0],Nt=Yt.circleArray[Jt+1],fi=Yt.circleArray[Jt+2],Ci=Yt.circleArray[Jt+3];ht.emplace(bt++,Mi,Nt,fi,Ci,0),ht.emplace(bt++,Mi,Nt,fi,Ci,1),ht.emplace(bt++,Mi,Nt,fi,Ci,2),ht.emplace(bt++,Mi,Nt,fi,Ci,3)}(!va||va.length<2*ce)&&(va=function(Ur){var Qr=2*Ur,Bn=new m.StructArrayLayout3ui6;Bn.resize(Qr),Bn._trim();for(var zr=0;zr<Qr;zr++){var Di=6*zr;Bn.uint16[Di+0]=4*zr+0,Bn.uint16[Di+1]=4*zr+1,Bn.uint16[Di+2]=4*zr+2,Bn.uint16[Di+3]=4*zr+2,Bn.uint16[Di+4]=4*zr+3,Bn.uint16[Di+5]=4*zr+0}return Bn}(ce));for(var pi=F.createIndexBuffer(va,!0),li=F.createVertexBuffer(ht,m.collisionCircleLayout.members,!0),_i=0,ri=le;_i<ri.length;_i+=1){var ei=ri[_i],Ar=Dl(ei.transform,ei.invTransform,s.transform);Qe.draw(F,X.TRIANGLES,me.disabled,Te.disabled,s.colorModeForRenderPass(),Oe.disabled,Ar,u.id,li,pi,m.SegmentVector.simpleSegment(0,2*ei.circleOffset,ei.circleArray.length,ei.circleArray.length/2),null,s.transform.zoom,null,null,null)}li.destroy(),pi.destroy()}}var So=m.identity(new Float32Array(16));function rl(s,c,u,f,T,P){var M=m.getAnchorAlignment(s),F=-(M.horizontalAlign-.5)*c,X=-(M.verticalAlign-.5)*u,Y=m.evaluateVariableOffset(s,f);return new m.Point((F/T+Y[0])*P,(X/T+Y[1])*P)}function nl(s,c,u,f,T,P,M,F,X,Y,le){var ce=s.text.placedSymbolArray,de=s.text.dynamicLayoutVertexArray,Ce=s.icon.dynamicLayoutVertexArray,Ae={};de.clear();for(var ke=0;ke<ce.length;ke++){var xe=ce.get(ke),ze=xe.hidden||!xe.crossTileID||s.allowVerticalPlacement&&!xe.placedOrientation?null:f[xe.crossTileID];if(ze){var Be=new m.Point(xe.anchorX,xe.anchorY),Ge=Mt(Be,u?F:M),Je=di(P.cameraToCenterDistance,Ge.signedDistanceFromCamera),Ye=T.evaluateSizeForFeature(s.textSizeData,Y,xe)*Je/m.ONE_EM;u&&(Ye*=s.tilePixelRatio/X);for(var Qe=rl(ze.anchor,ze.width,ze.height,ze.textOffset,ze.textBoxScale,Ye),ht=u?Mt(Be.add(Qe),M).point:Ge.point.add(c?Qe.rotate(-P.angle):Qe),bt=s.allowVerticalPlacement&&xe.placedOrientation===m.WritingMode.vertical?Math.PI/2:0,xt=0;xt<xe.numGlyphs;xt++)m.addDynamicAttributes(de,ht,bt);le&&xe.associatedIconIndex>=0&&(Ae[xe.associatedIconIndex]={shiftedAnchor:ht,angle:bt})}else Vn(xe.numGlyphs,de)}if(le){Ce.clear();for(var Dt=s.icon.placedSymbolArray,Yt=0;Yt<Dt.length;Yt++){var ti=Dt.get(Yt);if(ti.hidden)Vn(ti.numGlyphs,Ce);else{var Jt=Ae[Yt];if(Jt)for(var Mi=0;Mi<ti.numGlyphs;Mi++)m.addDynamicAttributes(Ce,Jt.shiftedAnchor,Jt.angle);else Vn(ti.numGlyphs,Ce)}}s.icon.dynamicLayoutVertexBuffer.updateData(Ce)}s.text.dynamicLayoutVertexBuffer.updateData(de)}function ss(s,c,u){return u.iconsInText&&c?"symbolTextAndIcon":s?"symbolSDF":"symbolIcon"}function jo(s,c,u,f,T,P,M,F,X,Y,le,ce){for(var de=s.context,Ce=de.gl,Ae=s.transform,ke=F==="map",xe=X==="map",ze=ke&&u.layout.get("symbol-placement")!=="point",Be=ke&&!xe&&!ze,Ge=u.layout.get("symbol-sort-key").constantOr(1)!==void 0,Je=!1,Ye=s.depthModeForSublayer(0,me.ReadOnly),Qe=u.layout.get("text-variable-anchor"),ht=[],bt=0,xt=f;bt<xt.length;bt+=1){var Dt=xt[bt],Yt=c.getTile(Dt),ti=Yt.getBucket(u);if(ti){var Jt=T?ti.text:ti.icon;if(Jt&&Jt.segments.get().length){var Mi=Jt.programConfigurations.get(u.id),Nt=T||ti.sdfIcons,fi=T?ti.textSizeData:ti.iconSizeData,Ci=xe||Ae.pitch!==0,pi=s.useProgram(ss(Nt,T,ti),Mi),li=m.evaluateSizeForZoom(fi,Ae.zoom),_i=void 0,ri=[0,0],ei=void 0,Ar=void 0,Ur=null,Qr=void 0;if(T)ei=Yt.glyphAtlasTexture,Ar=Ce.LINEAR,_i=Yt.glyphAtlasTexture.size,ti.iconsInText&&(ri=Yt.imageAtlasTexture.size,Ur=Yt.imageAtlasTexture,Qr=Ci||s.options.rotating||s.options.zooming||fi.kind==="composite"||fi.kind==="camera"?Ce.LINEAR:Ce.NEAREST);else{var Bn=u.layout.get("icon-size").constantOr(0)!==1||ti.iconsNeedLinear;ei=Yt.imageAtlasTexture,Ar=Nt||s.options.rotating||s.options.zooming||Bn||Ci?Ce.LINEAR:Ce.NEAREST,_i=Yt.imageAtlasTexture.size}var zr=pr(Yt,1,s.transform.zoom),Di=ni(Dt.posMatrix,xe,ke,s.transform,zr),co=$t(Dt.posMatrix,xe,ke,s.transform,zr),Qn=Qe&&ti.hasTextData(),Bo=u.layout.get("icon-text-fit")!=="none"&&Qn&&ti.hasIconData();ze&&jr(ti,Dt.posMatrix,s,T,Di,co,xe,Y);var gn=s.translatePosMatrix(Dt.posMatrix,Yt,P,M),Oo=ze||T&&Qe||Bo?So:Di,Fo=s.translatePosMatrix(co,Yt,P,M,!0),Fl=Nt&&u.paint.get(T?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Ul={program:pi,buffers:Jt,uniformValues:Nt?ti.iconsInText?il(fi.kind,li,Be,xe,s,gn,Oo,Fo,_i,ri):as(fi.kind,li,Be,xe,s,gn,Oo,Fo,T,_i,!0):xa(fi.kind,li,Be,xe,s,gn,Oo,Fo,T,_i),atlasTexture:ei,atlasTextureIcon:Ur,atlasInterpolation:Ar,atlasInterpolationIcon:Qr,isSDF:Nt,hasHalo:Fl};if(Ge&&ti.canOverlap){Je=!0;for(var ds=0,Vl=Jt.segments.get();ds<Vl.length;ds+=1){var cl=Vl[ds];ht.push({segments:new m.SegmentVector([cl]),sortKey:cl.sortKey,state:Ul})}}else ht.push({segments:Jt.segments,sortKey:0,state:Ul})}}}Je&&ht.sort(function(Os,za){return Os.sortKey-za.sortKey});for(var Ga=0,hl=ht;Ga<hl.length;Ga+=1){var Ca=hl[Ga],yn=Ca.state;if(de.activeTexture.set(Ce.TEXTURE0),yn.atlasTexture.bind(yn.atlasInterpolation,Ce.CLAMP_TO_EDGE),yn.atlasTextureIcon&&(de.activeTexture.set(Ce.TEXTURE1),yn.atlasTextureIcon&&yn.atlasTextureIcon.bind(yn.atlasInterpolationIcon,Ce.CLAMP_TO_EDGE)),yn.isSDF){var Uo=yn.uniformValues;yn.hasHalo&&(Uo.u_is_halo=1,Cs(yn.buffers,Ca.segments,u,s,yn.program,Ye,le,ce,Uo)),Uo.u_is_halo=0}Cs(yn.buffers,Ca.segments,u,s,yn.program,Ye,le,ce,yn.uniformValues)}}function Cs(s,c,u,f,T,P,M,F,X){var Y=f.context;T.draw(Y,Y.gl.TRIANGLES,P,M,F,Oe.disabled,X,u.id,s.layoutVertexBuffer,s.indexBuffer,c,u.paint,f.transform.zoom,s.programConfigurations.get(u.id),s.dynamicLayoutVertexBuffer,s.opacityVertexBuffer)}function ja(s,c,u,f,T,P,M){var F,X,Y,le,ce,de=s.context.gl,Ce=u.paint.get("fill-pattern"),Ae=Ce&&Ce.constantOr(1),ke=u.getCrossfadeParameters();M?(X=Ae&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=de.LINES):(X=Ae?"fillPattern":"fill",F=de.TRIANGLES);for(var xe=0,ze=f;xe<ze.length;xe+=1){var Be=ze[xe],Ge=c.getTile(Be);if(!Ae||Ge.patternsLoaded()){var Je=Ge.getBucket(u);if(Je){var Ye=Je.programConfigurations.get(u.id),Qe=s.useProgram(X,Ye);Ae&&(s.context.activeTexture.set(de.TEXTURE0),Ge.imageAtlasTexture.bind(de.LINEAR,de.CLAMP_TO_EDGE),Ye.updatePaintBuffers(ke));var ht=Ce.constantOr(null);if(ht&&Ge.imageAtlas){var bt=Ge.imageAtlas,xt=bt.patternPositions[ht.to.toString()],Dt=bt.patternPositions[ht.from.toString()];xt&&Dt&&Ye.setConstantPatternPositions(xt,Dt)}var Yt=s.translatePosMatrix(Be.posMatrix,Ge,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));if(M){le=Je.indexBuffer2,ce=Je.segments2;var ti=[de.drawingBufferWidth,de.drawingBufferHeight];Y=X==="fillOutlinePattern"&&Ae?Qs(Yt,s,ke,Ge,ti):Fr(Yt,ti)}else le=Je.indexBuffer,ce=Je.segments,Y=Ae?sr(Yt,s,ke,Ge):No(Yt);Qe.draw(s.context,F,T,s.stencilModeForClipping(Be),P,Oe.disabled,Y,u.id,Je.layoutVertexBuffer,le,ce,u.paint,s.transform.zoom,Ye)}}}}function Bl(s,c,u,f,T,P,M){for(var F=s.context,X=F.gl,Y=u.paint.get("fill-extrusion-pattern"),le=Y.constantOr(1),ce=u.getCrossfadeParameters(),de=u.paint.get("fill-extrusion-opacity"),Ce=0,Ae=f;Ce<Ae.length;Ce+=1){var ke=Ae[Ce],xe=c.getTile(ke),ze=xe.getBucket(u);if(ze){var Be=ze.programConfigurations.get(u.id),Ge=s.useProgram(le?"fillExtrusionPattern":"fillExtrusion",Be);le&&(s.context.activeTexture.set(X.TEXTURE0),xe.imageAtlasTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),Be.updatePaintBuffers(ce));var Je=Y.constantOr(null);if(Je&&xe.imageAtlas){var Ye=xe.imageAtlas,Qe=Ye.patternPositions[Je.to.toString()],ht=Ye.patternPositions[Je.from.toString()];Qe&&ht&&Be.setConstantPatternPositions(Qe,ht)}var bt=s.translatePosMatrix(ke.posMatrix,xe,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),xt=u.paint.get("fill-extrusion-vertical-gradient"),Dt=le?Ni(bt,s,xt,de,ke,ce,xe):Ys(bt,s,xt,de);Ge.draw(F,F.gl.TRIANGLES,T,P,M,Oe.backCCW,Dt,u.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,u.paint,s.transform.zoom,Be)}}}function ol(s,c,u,f,T,P){var M=s.context,F=M.gl,X=c.fbo;if(X){var Y=s.useProgram("hillshade");M.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,X.colorAttachment.get());var le=function(ce,de,Ce){var Ae=Ce.paint.get("hillshade-shadow-color"),ke=Ce.paint.get("hillshade-highlight-color"),xe=Ce.paint.get("hillshade-accent-color"),ze=Ce.paint.get("hillshade-illumination-direction")*(Math.PI/180);Ce.paint.get("hillshade-illumination-anchor")==="viewport"&&(ze-=ce.transform.angle);var Be,Ge,Je,Ye=!ce.options.moving;return{u_matrix:ce.transform.calculatePosMatrix(de.tileID.toUnwrapped(),Ye),u_image:0,u_latrange:(Be=de.tileID,Ge=Math.pow(2,Be.canonical.z),Je=Be.canonical.y,[new m.MercatorCoordinate(0,Je/Ge).toLngLat().lat,new m.MercatorCoordinate(0,(Je+1)/Ge).toLngLat().lat]),u_light:[Ce.paint.get("hillshade-exaggeration"),ze],u_shadow:Ae,u_highlight:ke,u_accent:xe}}(s,c,u);Y.draw(M,F.TRIANGLES,f,T,P,Oe.disabled,le,u.id,s.rasterBoundsBuffer,s.quadTriangleIndexBuffer,s.rasterBoundsSegments)}}function Ju(s,c,u,f,T,P){var M=s.context,F=M.gl,X=c.dem;if(X&&X.data){var Y=X.dim,le=X.stride,ce=X.getPixels();if(M.activeTexture.set(F.TEXTURE1),M.pixelStoreUnpackPremultiplyAlpha.set(!1),c.demTexture=c.demTexture||s.getTileTexture(le),c.demTexture){var de=c.demTexture;de.update(ce,{premultiply:!1}),de.bind(F.NEAREST,F.CLAMP_TO_EDGE)}else c.demTexture=new m.Texture(M,ce,F.RGBA,{premultiply:!1}),c.demTexture.bind(F.NEAREST,F.CLAMP_TO_EDGE);M.activeTexture.set(F.TEXTURE0);var Ce=c.fbo;if(!Ce){var Ae=new m.Texture(M,{width:Y,height:Y,data:null},F.RGBA);Ae.bind(F.LINEAR,F.CLAMP_TO_EDGE),(Ce=c.fbo=M.createFramebuffer(Y,Y,!0)).colorAttachment.set(Ae.texture)}M.bindFramebuffer.set(Ce.framebuffer),M.viewport.set([0,0,Y,Y]),s.useProgram("hillshadePrepare").draw(M,F.TRIANGLES,f,T,P,Oe.disabled,function(ke,xe){var ze=xe.stride,Be=m.create();return m.ortho(Be,0,m.EXTENT,-m.EXTENT,0,0,1),m.translate(Be,Be,[0,-m.EXTENT,0]),{u_matrix:Be,u_image:1,u_dimension:[ze,ze],u_zoom:ke.overscaledZ,u_unpack:xe.getUnpackVector()}}(c.tileID,X),u.id,s.rasterBoundsBuffer,s.quadTriangleIndexBuffer,s.rasterBoundsSegments),c.needsHillshadePrepare=!1}}function wa(s,c,u,f,T){var P=f.paint.get("raster-fade-duration");if(P>0){var M=m.browser.now(),F=(M-s.timeAdded)/P,X=c?(M-c.timeAdded)/P:-1,Y=u.getSource(),le=T.coveringZoomLevel({tileSize:Y.tileSize,roundZoom:Y.roundZoom}),ce=!c||Math.abs(c.tileID.overscaledZ-le)>Math.abs(s.tileID.overscaledZ-le),de=ce&&s.refreshedUponExpiration?1:m.clamp(ce?F:1-X,0,1);return s.refreshedUponExpiration&&F>=1&&(s.refreshedUponExpiration=!1),c?{opacity:1,mix:1-de}:{opacity:de,mix:0}}return{opacity:1,mix:0}}var Ol=new m.Color(1,0,0,1),zs=new m.Color(0,1,0,1),Ps=new m.Color(0,0,1,1),jn=new m.Color(1,0,1,1),qn=new m.Color(0,1,1,1);function wu(s,c,u,f){ks(s,0,c+u/2,s.transform.width,u,f)}function Ea(s,c,u,f){ks(s,c-u/2,0,u,s.transform.height,f)}function ks(s,c,u,f,T,P){var M=s.context,F=M.gl;F.enable(F.SCISSOR_TEST),F.scissor(c*m.browser.devicePixelRatio,u*m.browser.devicePixelRatio,f*m.browser.devicePixelRatio,T*m.browser.devicePixelRatio),M.clear({color:P}),F.disable(F.SCISSOR_TEST)}function ls(s,c,u){var f=s.context,T=f.gl,P=u.posMatrix,M=s.useProgram("debug"),F=me.disabled,X=Te.disabled,Y=s.colorModeForRenderPass();f.activeTexture.set(T.TEXTURE0),s.emptyTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),M.draw(f,T.LINE_STRIP,F,X,Y,Oe.disabled,na(P,m.Color.red),"$debug",s.debugBuffer,s.tileBorderIndexBuffer,s.debugSegments);var le=c.getTileByID(u.key).latestRawTileData,ce=Math.floor((le&&le.byteLength||0)/1024),de=c.getTile(u).tileSize,Ce=512/Math.min(de,512)*(u.overscaledZ/s.transform.zoom)*.5,Ae=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(Ae+=" => "+u.overscaledZ),function(ke,xe){ke.initDebugOverlayCanvas();var ze=ke.debugOverlayCanvas,Be=ke.context.gl,Ge=ke.debugOverlayCanvas.getContext("2d");Ge.clearRect(0,0,ze.width,ze.height),Ge.shadowColor="white",Ge.shadowBlur=2,Ge.lineWidth=1.5,Ge.strokeStyle="white",Ge.textBaseline="top",Ge.font="bold 36px Open Sans, sans-serif",Ge.fillText(xe,5,5),Ge.strokeText(xe,5,5),ke.debugOverlayTexture.update(ze),ke.debugOverlayTexture.bind(Be.LINEAR,Be.CLAMP_TO_EDGE)}(s,Ae+" "+ce+"kb"),M.draw(f,T.TRIANGLES,F,X,Re.alphaBlended,Oe.disabled,na(P,m.Color.transparent,Ce),"$debug",s.debugBuffer,s.quadTriangleIndexBuffer,s.debugSegments)}var To={symbol:function(s,c,u,f,T){if(s.renderPass==="translucent"){var P=Te.disabled,M=s.colorModeForRenderPass();u.layout.get("text-variable-anchor")&&function(F,X,Y,le,ce,de,Ce){for(var Ae=X.transform,ke=ce==="map",xe=de==="map",ze=0,Be=F;ze<Be.length;ze+=1){var Ge=Be[ze],Je=le.getTile(Ge),Ye=Je.getBucket(Y);if(Ye&&Ye.text&&Ye.text.segments.get().length){var Qe=m.evaluateSizeForZoom(Ye.textSizeData,Ae.zoom),ht=pr(Je,1,X.transform.zoom),bt=ni(Ge.posMatrix,xe,ke,X.transform,ht),xt=Y.layout.get("icon-text-fit")!=="none"&&Ye.hasIconData();if(Qe){var Dt=Math.pow(2,Ae.zoom-Je.tileID.overscaledZ);nl(Ye,ke,xe,Ce,m.symbolSize,Ae,bt,Ge.posMatrix,Dt,Qe,xt)}}}}(f,s,u,c,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),T),u.paint.get("icon-opacity").constantOr(1)!==0&&jo(s,c,u,f,!1,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),u.layout.get("icon-rotation-alignment"),u.layout.get("icon-pitch-alignment"),u.layout.get("icon-keep-upright"),P,M),u.paint.get("text-opacity").constantOr(1)!==0&&jo(s,c,u,f,!0,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),u.layout.get("text-keep-upright"),P,M),c.map.showCollisionBoxes&&(aa(s,c,u,f,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),aa(s,c,u,f,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))}},circle:function(s,c,u,f){if(s.renderPass==="translucent"){var T=u.paint.get("circle-opacity"),P=u.paint.get("circle-stroke-width"),M=u.paint.get("circle-stroke-opacity"),F=u.layout.get("circle-sort-key").constantOr(1)!==void 0;if(T.constantOr(1)!==0||P.constantOr(1)!==0&&M.constantOr(1)!==0){for(var X=s.context,Y=X.gl,le=s.depthModeForSublayer(0,me.ReadOnly),ce=Te.disabled,de=s.colorModeForRenderPass(),Ce=[],Ae=0;Ae<f.length;Ae++){var ke=f[Ae],xe=c.getTile(ke),ze=xe.getBucket(u);if(ze){var Be=ze.programConfigurations.get(u.id),Ge={programConfiguration:Be,program:s.useProgram("circle",Be),layoutVertexBuffer:ze.layoutVertexBuffer,indexBuffer:ze.indexBuffer,uniformValues:el(s,ke,xe,u)};if(F)for(var Je=0,Ye=ze.segments.get();Je<Ye.length;Je+=1){var Qe=Ye[Je];Ce.push({segments:new m.SegmentVector([Qe]),sortKey:Qe.sortKey,state:Ge})}else Ce.push({segments:ze.segments,sortKey:0,state:Ge})}}F&&Ce.sort(function(Yt,ti){return Yt.sortKey-ti.sortKey});for(var ht=0,bt=Ce;ht<bt.length;ht+=1){var xt=bt[ht],Dt=xt.state;Dt.program.draw(X,Y.TRIANGLES,le,ce,de,Oe.disabled,Dt.uniformValues,u.id,Dt.layoutVertexBuffer,Dt.indexBuffer,xt.segments,u.paint,s.transform.zoom,Dt.programConfiguration)}}}},heatmap:function(s,c,u,f){if(u.paint.get("heatmap-opacity")!==0)if(s.renderPass==="offscreen"){var T=s.context,P=T.gl,M=Te.disabled,F=new Re([P.ONE,P.ONE],m.Color.transparent,[!0,!0,!0,!0]);(function(Ce,Ae,ke){var xe=Ce.gl;Ce.activeTexture.set(xe.TEXTURE1),Ce.viewport.set([0,0,Ae.width/4,Ae.height/4]);var ze=ke.heatmapFbo;if(ze)xe.bindTexture(xe.TEXTURE_2D,ze.colorAttachment.get()),Ce.bindFramebuffer.set(ze.framebuffer);else{var Be=xe.createTexture();xe.bindTexture(xe.TEXTURE_2D,Be),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_WRAP_S,xe.CLAMP_TO_EDGE),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_WRAP_T,xe.CLAMP_TO_EDGE),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_MIN_FILTER,xe.LINEAR),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_MAG_FILTER,xe.LINEAR),ze=ke.heatmapFbo=Ce.createFramebuffer(Ae.width/4,Ae.height/4,!1),function(Ge,Je,Ye,Qe){var ht=Ge.gl;ht.texImage2D(ht.TEXTURE_2D,0,ht.RGBA,Je.width/4,Je.height/4,0,ht.RGBA,Ge.extRenderToTextureHalfFloat?Ge.extTextureHalfFloat.HALF_FLOAT_OES:ht.UNSIGNED_BYTE,null),Qe.colorAttachment.set(Ye)}(Ce,Ae,Be,ze)}})(T,s,u),T.clear({color:m.Color.transparent});for(var X=0;X<f.length;X++){var Y=f[X];if(!c.hasRenderableParent(Y)){var le=c.getTile(Y),ce=le.getBucket(u);if(ce){var de=ce.programConfigurations.get(u.id);s.useProgram("heatmap",de).draw(T,P.TRIANGLES,me.disabled,M,F,Oe.disabled,tl(Y.posMatrix,le,s.transform.zoom,u.paint.get("heatmap-intensity")),u.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,u.paint,s.transform.zoom,de)}}}T.viewport.set([0,0,s.width,s.height])}else s.renderPass==="translucent"&&(s.context.setColorMode(s.colorModeForRenderPass()),function(Ce,Ae){var ke=Ce.context,xe=ke.gl,ze=Ae.heatmapFbo;if(ze){ke.activeTexture.set(xe.TEXTURE0),xe.bindTexture(xe.TEXTURE_2D,ze.colorAttachment.get()),ke.activeTexture.set(xe.TEXTURE1);var Be=Ae.colorRampTexture;Be||(Be=Ae.colorRampTexture=new m.Texture(ke,Ae.colorRamp,xe.RGBA)),Be.bind(xe.LINEAR,xe.CLAMP_TO_EDGE),Ce.useProgram("heatmapTexture").draw(ke,xe.TRIANGLES,me.disabled,Te.disabled,Ce.colorModeForRenderPass(),Oe.disabled,function(Ge,Je,Ye,Qe){var ht=m.create();m.ortho(ht,0,Ge.width,Ge.height,0,0,1);var bt=Ge.context.gl;return{u_matrix:ht,u_world:[bt.drawingBufferWidth,bt.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Je.paint.get("heatmap-opacity")}}(Ce,Ae),Ae.id,Ce.viewportBuffer,Ce.quadTriangleIndexBuffer,Ce.viewportSegments,Ae.paint,Ce.transform.zoom)}}(s,u))},line:function(s,c,u,f){if(s.renderPass==="translucent"){var T=u.paint.get("line-opacity"),P=u.paint.get("line-width");if(T.constantOr(1)!==0&&P.constantOr(1)!==0)for(var M=s.depthModeForSublayer(0,me.ReadOnly),F=s.colorModeForRenderPass(),X=u.paint.get("line-dasharray"),Y=u.paint.get("line-pattern"),le=Y.constantOr(1),ce=u.paint.get("line-gradient"),de=u.getCrossfadeParameters(),Ce=le?"linePattern":X?"lineSDF":ce?"lineGradient":"line",Ae=s.context,ke=Ae.gl,xe=!0,ze=0,Be=f;ze<Be.length;ze+=1){var Ge=Be[ze],Je=c.getTile(Ge);if(!le||Je.patternsLoaded()){var Ye=Je.getBucket(u);if(Ye){var Qe=Ye.programConfigurations.get(u.id),ht=s.context.program.get(),bt=s.useProgram(Ce,Qe),xt=xe||bt.program!==ht,Dt=Y.constantOr(null);if(Dt&&Je.imageAtlas){var Yt=Je.imageAtlas,ti=Yt.patternPositions[Dt.to.toString()],Jt=Yt.patternPositions[Dt.from.toString()];ti&&Jt&&Qe.setConstantPatternPositions(ti,Jt)}var Mi=le?_a(s,Je,u,de):X?Rl(s,Je,u,X,de):ce?lr(s,Je,u,Ye.lineClipsArray.length):Va(s,Je,u);if(le)Ae.activeTexture.set(ke.TEXTURE0),Je.imageAtlasTexture.bind(ke.LINEAR,ke.CLAMP_TO_EDGE),Qe.updatePaintBuffers(de);else if(X&&(xt||s.lineAtlas.dirty))Ae.activeTexture.set(ke.TEXTURE0),s.lineAtlas.bind(Ae);else if(ce){var Nt=Ye.gradients[u.id],fi=Nt.texture;if(u.gradientVersion!==Nt.version){var Ci=256;if(u.stepInterpolant){var pi=c.getSource().maxzoom,li=Ge.canonical.z===pi?Math.ceil(1<<s.transform.maxZoom-Ge.canonical.z):1;Ci=m.clamp(m.nextPowerOfTwo(Ye.maxLineLength/m.EXTENT*1024*li),256,Ae.maxTextureSize)}Nt.gradient=m.renderColorRamp({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:Ci,image:Nt.gradient||void 0,clips:Ye.lineClipsArray}),Nt.texture?Nt.texture.update(Nt.gradient):Nt.texture=new m.Texture(Ae,Nt.gradient,ke.RGBA),Nt.version=u.gradientVersion,fi=Nt.texture}Ae.activeTexture.set(ke.TEXTURE0),fi.bind(u.stepInterpolant?ke.NEAREST:ke.LINEAR,ke.CLAMP_TO_EDGE)}bt.draw(Ae,ke.TRIANGLES,M,s.stencilModeForClipping(Ge),F,Oe.disabled,Mi,u.id,Ye.layoutVertexBuffer,Ye.indexBuffer,Ye.segments,u.paint,s.transform.zoom,Qe,Ye.layoutVertexBuffer2),xe=!1}}}}},fill:function(s,c,u,f){var T=u.paint.get("fill-color"),P=u.paint.get("fill-opacity");if(P.constantOr(1)!==0){var M=s.colorModeForRenderPass(),F=u.paint.get("fill-pattern"),X=s.opaquePassEnabledForLayer()&&!F.constantOr(1)&&T.constantOr(m.Color.transparent).a===1&&P.constantOr(0)===1?"opaque":"translucent";if(s.renderPass===X){var Y=s.depthModeForSublayer(1,s.renderPass==="opaque"?me.ReadWrite:me.ReadOnly);ja(s,c,u,f,Y,M,!1)}if(s.renderPass==="translucent"&&u.paint.get("fill-antialias")){var le=s.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,me.ReadOnly);ja(s,c,u,f,le,M,!0)}}},"fill-extrusion":function(s,c,u,f){var T=u.paint.get("fill-extrusion-opacity");if(T!==0&&s.renderPass==="translucent"){var P=new me(s.context.gl.LEQUAL,me.ReadWrite,s.depthRangeFor3D);if(T!==1||u.paint.get("fill-extrusion-pattern").constantOr(1))Bl(s,c,u,f,P,Te.disabled,Re.disabled),Bl(s,c,u,f,P,s.stencilModeFor3D(),s.colorModeForRenderPass());else{var M=s.colorModeForRenderPass();Bl(s,c,u,f,P,Te.disabled,M)}}},hillshade:function(s,c,u,f){if(s.renderPass==="offscreen"||s.renderPass==="translucent"){for(var T=s.context,P=s.depthModeForSublayer(0,me.ReadOnly),M=s.colorModeForRenderPass(),F=s.renderPass==="translucent"?s.stencilConfigForOverlap(f):[{},f],X=F[0],Y=0,le=F[1];Y<le.length;Y+=1){var ce=le[Y],de=c.getTile(ce);de.needsHillshadePrepare&&s.renderPass==="offscreen"?Ju(s,de,u,P,Te.disabled,M):s.renderPass==="translucent"&&ol(s,de,u,P,X[ce.overscaledZ],M)}T.viewport.set([0,0,s.width,s.height])}},raster:function(s,c,u,f){if(s.renderPass==="translucent"&&u.paint.get("raster-opacity")!==0&&f.length)for(var T=s.context,P=T.gl,M=c.getSource(),F=s.useProgram("raster"),X=s.colorModeForRenderPass(),Y=M instanceof nn?[{},f]:s.stencilConfigForOverlap(f),le=Y[0],ce=Y[1],de=ce[ce.length-1].overscaledZ,Ce=!s.options.moving,Ae=0,ke=ce;Ae<ke.length;Ae+=1){var xe=ke[Ae],ze=s.depthModeForSublayer(xe.overscaledZ-de,u.paint.get("raster-opacity")===1?me.ReadWrite:me.ReadOnly,P.LESS),Be=c.getTile(xe),Ge=s.transform.calculatePosMatrix(xe.toUnwrapped(),Ce);Be.registerFadeDuration(u.paint.get("raster-fade-duration"));var Je=c.findLoadedParent(xe,0),Ye=wa(Be,Je,c,u,s.transform),Qe=void 0,ht=void 0,bt=u.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;T.activeTexture.set(P.TEXTURE0),Be.texture.bind(bt,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),T.activeTexture.set(P.TEXTURE1),Je?(Je.texture.bind(bt,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),Qe=Math.pow(2,Je.tileID.overscaledZ-Be.tileID.overscaledZ),ht=[Be.tileID.canonical.x*Qe%1,Be.tileID.canonical.y*Qe%1]):Be.texture.bind(bt,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST);var xt=Ku(Ge,ht||[0,0],Qe||1,Ye,u);M instanceof nn?F.draw(T,P.TRIANGLES,ze,Te.disabled,X,Oe.disabled,xt,u.id,M.boundsBuffer,s.quadTriangleIndexBuffer,M.boundsSegments):F.draw(T,P.TRIANGLES,ze,le[xe.overscaledZ],X,Oe.disabled,xt,u.id,s.rasterBoundsBuffer,s.quadTriangleIndexBuffer,s.rasterBoundsSegments)}},background:function(s,c,u){var f=u.paint.get("background-color"),T=u.paint.get("background-opacity");if(T!==0){var P=s.context,M=P.gl,F=s.transform,X=F.tileSize,Y=u.paint.get("background-pattern");if(!s.isPatternMissing(Y)){var le=!Y&&f.a===1&&T===1&&s.opaquePassEnabledForLayer()?"opaque":"translucent";if(s.renderPass===le){var ce=Te.disabled,de=s.depthModeForSublayer(0,le==="opaque"?me.ReadWrite:me.ReadOnly),Ce=s.colorModeForRenderPass(),Ae=s.useProgram(Y?"backgroundPattern":"background"),ke=F.coveringTiles({tileSize:X});Y&&(P.activeTexture.set(M.TEXTURE0),s.imageManager.bind(s.context));for(var xe=u.getCrossfadeParameters(),ze=0,Be=ke;ze<Be.length;ze+=1){var Ge=Be[ze],Je=s.transform.calculatePosMatrix(Ge.toUnwrapped()),Ye=Y?ba(Je,T,s,Y,{tileID:Ge,tileSize:X},xe):Na(Je,T,f);Ae.draw(P,M.TRIANGLES,de,ce,Ce,Oe.disabled,Ye,u.id,s.tileExtentBuffer,s.quadTriangleIndexBuffer,s.tileExtentSegments)}}}}},debug:function(s,c,u){for(var f=0;f<u.length;f++)ls(s,c,u[f])},custom:function(s,c,u){var f=s.context,T=u.implementation;if(s.renderPass==="offscreen"){var P=T.prerender;P&&(s.setCustomLayerDefaults(),f.setColorMode(s.colorModeForRenderPass()),P.call(T,f.gl,s.transform.customLayerMatrix()),f.setDirty(),s.setBaseState())}else if(s.renderPass==="translucent"){s.setCustomLayerDefaults(),f.setColorMode(s.colorModeForRenderPass()),f.setStencilMode(Te.disabled);var M=T.renderingMode==="3d"?new me(s.context.gl.LEQUAL,me.ReadWrite,s.depthRangeFor3D):s.depthModeForSublayer(0,me.ReadOnly);f.setDepthMode(M),T.render(f.gl,s.transform.customLayerMatrix()),f.setDirty(),s.setBaseState(),f.bindFramebuffer.set(null)}}},_r=function(s,c){this.context=new fe(s),this.transform=c,this._tileTextures={},this.setup(),this.numSublayers=Pe.maxUnderzooming+Pe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ta,this.gpuTimers={}};_r.prototype.resize=function(s,c){if(this.width=s*m.browser.devicePixelRatio,this.height=c*m.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var u=0,f=this.style._order;u<f.length;u+=1)this.style._layers[f[u]].resize()},_r.prototype.setup=function(){var s=this.context,c=new m.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(m.EXTENT,0),c.emplaceBack(0,m.EXTENT),c.emplaceBack(m.EXTENT,m.EXTENT),this.tileExtentBuffer=s.createVertexBuffer(c,Or.members),this.tileExtentSegments=m.SegmentVector.simpleSegment(0,0,4,2);var u=new m.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(m.EXTENT,0),u.emplaceBack(0,m.EXTENT),u.emplaceBack(m.EXTENT,m.EXTENT),this.debugBuffer=s.createVertexBuffer(u,Or.members),this.debugSegments=m.SegmentVector.simpleSegment(0,0,4,5);var f=new m.StructArrayLayout4i8;f.emplaceBack(0,0,0,0),f.emplaceBack(m.EXTENT,0,m.EXTENT,0),f.emplaceBack(0,m.EXTENT,0,m.EXTENT),f.emplaceBack(m.EXTENT,m.EXTENT,m.EXTENT,m.EXTENT),this.rasterBoundsBuffer=s.createVertexBuffer(f,Vr.members),this.rasterBoundsSegments=m.SegmentVector.simpleSegment(0,0,4,2);var T=new m.StructArrayLayout2i4;T.emplaceBack(0,0),T.emplaceBack(1,0),T.emplaceBack(0,1),T.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(T,Or.members),this.viewportSegments=m.SegmentVector.simpleSegment(0,0,4,2);var P=new m.StructArrayLayout1ui2;P.emplaceBack(0),P.emplaceBack(1),P.emplaceBack(3),P.emplaceBack(2),P.emplaceBack(0),this.tileBorderIndexBuffer=s.createIndexBuffer(P);var M=new m.StructArrayLayout3ui6;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(M),this.emptyTexture=new m.Texture(s,{width:1,height:1,data:new Uint8Array([0,0,0,0])},s.gl.RGBA);var F=this.context.gl;this.stencilClearMode=new Te({func:F.ALWAYS,mask:0},0,255,F.ZERO,F.ZERO,F.ZERO)},_r.prototype.clearStencil=function(){var s=this.context,c=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var u=m.create();m.ortho(u,0,this.width,this.height,0,0,1),m.scale(u,u,[c.drawingBufferWidth,c.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(s,c.TRIANGLES,me.disabled,this.stencilClearMode,Re.disabled,Oe.disabled,oa(u),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},_r.prototype._renderTileClippingMasks=function(s,c){if(this.currentStencilSource!==s.source&&s.isTileClipped()&&c&&c.length){this.currentStencilSource=s.source;var u=this.context,f=u.gl;this.nextStencilID+c.length>256&&this.clearStencil(),u.setColorMode(Re.disabled),u.setDepthMode(me.disabled);var T=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var P=0,M=c;P<M.length;P+=1){var F=M[P],X=this._tileClippingMaskIDs[F.key]=this.nextStencilID++;T.draw(u,f.TRIANGLES,me.disabled,new Te({func:f.ALWAYS,mask:0},X,255,f.KEEP,f.KEEP,f.REPLACE),Re.disabled,Oe.disabled,oa(F.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},_r.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var s=this.nextStencilID++,c=this.context.gl;return new Te({func:c.NOTEQUAL,mask:255},s,255,c.KEEP,c.KEEP,c.REPLACE)},_r.prototype.stencilModeForClipping=function(s){var c=this.context.gl;return new Te({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,c.KEEP,c.KEEP,c.REPLACE)},_r.prototype.stencilConfigForOverlap=function(s){var c,u=this.context.gl,f=s.sort(function(X,Y){return Y.overscaledZ-X.overscaledZ}),T=f[f.length-1].overscaledZ,P=f[0].overscaledZ-T+1;if(P>1){this.currentStencilSource=void 0,this.nextStencilID+P>256&&this.clearStencil();for(var M={},F=0;F<P;F++)M[F+T]=new Te({func:u.GEQUAL,mask:255},F+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=P,[M,f]}return[(c={},c[T]=Te.disabled,c),f]},_r.prototype.colorModeForRenderPass=function(){var s=this.context.gl;return this._showOverdrawInspector?new Re([s.CONSTANT_COLOR,s.ONE],new m.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Re.unblended:Re.alphaBlended},_r.prototype.depthModeForSublayer=function(s,c,u){if(!this.opaquePassEnabledForLayer())return me.disabled;var f=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new me(u||this.context.gl.LEQUAL,c,[f,f])},_r.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},_r.prototype.render=function(s,c){var u=this;this.style=s,this.options=c,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(m.browser.now()),this.imageManager.beginFrame();var f=this.style._order,T=this.style.sourceCaches;for(var P in T){var M=T[P];M.used&&M.prepare(this.context)}var F,X,Y={},le={},ce={};for(var de in T){var Ce=T[de];Y[de]=Ce.getVisibleCoordinates(),le[de]=Y[de].slice().reverse(),ce[de]=Ce.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Ae=0;Ae<f.length;Ae++)if(this.style._layers[f[Ae]].is3D()){this.opaquePassCutoff=Ae;break}this.renderPass="offscreen";for(var ke=0,xe=f;ke<xe.length;ke+=1){var ze=this.style._layers[xe[ke]];if(ze.hasOffscreenPass()&&!ze.isHidden(this.transform.zoom)){var Be=le[ze.source];(ze.type==="custom"||Be.length)&&this.renderLayer(this,T[ze.source],ze,Be)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:c.showOverdrawInspector?m.Color.black:m.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.depthRangeFor3D=[0,1-(s._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){var Ge=this.style._layers[f[this.currentLayer]],Je=T[Ge.source],Ye=Y[Ge.source];this._renderTileClippingMasks(Ge,Ye),this.renderLayer(this,Je,Ge,Ye)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){var Qe=this.style._layers[f[this.currentLayer]],ht=T[Qe.source],bt=(Qe.type==="symbol"?ce:le)[Qe.source];this._renderTileClippingMasks(Qe,Y[Qe.source]),this.renderLayer(this,ht,Qe,bt)}this.options.showTileBoundaries&&(m.values(this.style._layers).forEach(function(xt){xt.source&&!xt.isHidden(u.transform.zoom)&&(xt.source!==(X&&X.id)&&(X=u.style.sourceCaches[xt.source]),(!F||F.getSource().maxzoom<X.getSource().maxzoom)&&(F=X))}),F&&To.debug(this,F,F.getVisibleCoordinates())),this.options.showPadding&&function(xt){var Dt=xt.transform.padding;wu(xt,xt.transform.height-(Dt.top||0),3,Ol),wu(xt,Dt.bottom||0,3,zs),Ea(xt,Dt.left||0,3,Ps),Ea(xt,xt.transform.width-(Dt.right||0),3,jn);var Yt=xt.transform.centerPoint;(function(ti,Jt,Mi,Nt){ks(ti,Jt-1,Mi-10,2,20,Nt),ks(ti,Jt-10,Mi-1,20,2,Nt)})(xt,Yt.x,xt.transform.height-Yt.y,qn)}(this),this.context.setDefault()},_r.prototype.renderLayer=function(s,c,u,f){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="custom"||f.length)&&(this.id=u.id,this.gpuTimingStart(u),To[u.type](s,c,u,f,this.style.placement.variableOffsets),this.gpuTimingEnd())},_r.prototype.gpuTimingStart=function(s){if(this.options.gpuTiming){var c=this.context.extTimerQuery,u=this.gpuTimers[s.id];u||(u=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),u.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,u.query)}},_r.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var s=this.context.extTimerQuery;s.endQueryEXT(s.TIME_ELAPSED_EXT)}},_r.prototype.collectGpuTimers=function(){var s=this.gpuTimers;return this.gpuTimers={},s},_r.prototype.queryGpuTimers=function(s){var c={};for(var u in s){var f=s[u],T=this.context.extTimerQuery,P=T.getQueryObjectEXT(f.query,T.QUERY_RESULT_EXT)/1e6;T.deleteQueryEXT(f.query),c[u]=P}return c},_r.prototype.translatePosMatrix=function(s,c,u,f,T){if(!u[0]&&!u[1])return s;var P=T?f==="map"?this.transform.angle:0:f==="viewport"?-this.transform.angle:0;if(P){var M=Math.sin(P),F=Math.cos(P);u=[u[0]*F-u[1]*M,u[0]*M+u[1]*F]}var X=[T?u[0]:pr(c,u[0],this.transform.zoom),T?u[1]:pr(c,u[1],this.transform.zoom),0],Y=new Float32Array(16);return m.translate(Y,s,X),Y},_r.prototype.saveTileTexture=function(s){var c=this._tileTextures[s.size[0]];c?c.push(s):this._tileTextures[s.size[0]]=[s]},_r.prototype.getTileTexture=function(s){var c=this._tileTextures[s];return c&&c.length>0?c.pop():null},_r.prototype.isPatternMissing=function(s){if(!s)return!1;if(!s.from||!s.to)return!0;var c=this.imageManager.getPattern(s.from.toString()),u=this.imageManager.getPattern(s.to.toString());return!c||!u},_r.prototype.useProgram=function(s,c){this.cache=this.cache||{};var u=""+s+(c?c.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[u]||(this.cache[u]=new Ll(this.context,s,ns[s],c,bu[s],this._showOverdrawInspector)),this.cache[u]},_r.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},_r.prototype.setBaseState=function(){var s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)},_r.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=m.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new m.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},_r.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Ms=function(s,c){this.points=s,this.planes=c};Ms.fromInvProjectionMatrix=function(s,c,u){var f=Math.pow(2,u),T=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(M){return m.transformMat4([],M,s)}).map(function(M){return m.scale$1([],M,1/M[3]/c*f)}),P=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(M){var F=m.sub([],T[M[0]],T[M[1]]),X=m.sub([],T[M[2]],T[M[1]]),Y=m.normalize([],m.cross([],F,X)),le=-m.dot(Y,T[M[1]]);return Y.concat(le)});return new Ms(T,P)};var us=function(s,c){this.min=s,this.max=c,this.center=m.scale$2([],m.add([],this.min,this.max),.5)};us.prototype.quadrant=function(s){for(var c=[s%2==0,s<2],u=m.clone$2(this.min),f=m.clone$2(this.max),T=0;T<c.length;T++)u[T]=c[T]?this.min[T]:this.center[T],f[T]=c[T]?this.center[T]:this.max[T];return f[2]=this.max[2],new us(u,f)},us.prototype.distanceX=function(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]},us.prototype.distanceY=function(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]},us.prototype.intersects=function(s){for(var c=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],u=!0,f=0;f<s.planes.length;f++){for(var T=s.planes[f],P=0,M=0;M<c.length;M++)P+=m.dot$1(T,c[M])>=0;if(P===0)return 0;P!==c.length&&(u=!1)}if(u)return 2;for(var F=0;F<3;F++){for(var X=Number.MAX_VALUE,Y=-Number.MAX_VALUE,le=0;le<s.points.length;le++){var ce=s.points[le][F]-this.min[F];X=Math.min(X,ce),Y=Math.max(Y,ce)}if(Y<0||X>this.max[F]-this.min[F])return 0}return 1};var Sa=function(s,c,u,f){if(s===void 0&&(s=0),c===void 0&&(c=0),u===void 0&&(u=0),f===void 0&&(f=0),isNaN(s)||s<0||isNaN(c)||c<0||isNaN(u)||u<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=c,this.left=u,this.right=f};Sa.prototype.interpolate=function(s,c,u){return c.top!=null&&s.top!=null&&(this.top=m.number(s.top,c.top,u)),c.bottom!=null&&s.bottom!=null&&(this.bottom=m.number(s.bottom,c.bottom,u)),c.left!=null&&s.left!=null&&(this.left=m.number(s.left,c.left,u)),c.right!=null&&s.right!=null&&(this.right=m.number(s.right,c.right,u)),this},Sa.prototype.getCenter=function(s,c){var u=m.clamp((this.left+s-this.right)/2,0,s),f=m.clamp((this.top+c-this.bottom)/2,0,c);return new m.Point(u,f)},Sa.prototype.equals=function(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right},Sa.prototype.clone=function(){return new Sa(this.top,this.bottom,this.left,this.right)},Sa.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Ii=function(s,c,u,f,T){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=T===void 0||T,this._minZoom=s||0,this._maxZoom=c||22,this._minPitch=u==null?0:u,this._maxPitch=f==null?60:f,this.setMaxBounds(),this.width=0,this.height=0,this._center=new m.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Sa,this._posMatrixCache={},this._alignedPosMatrixCache={}},Ji={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Ii.prototype.clone=function(){var s=new Ii(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return s.tileSize=this.tileSize,s.latRange=this.latRange,s.width=this.width,s.height=this.height,s._center=this._center,s.zoom=this.zoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._calcMatrices(),s},Ji.minZoom.get=function(){return this._minZoom},Ji.minZoom.set=function(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))},Ji.maxZoom.get=function(){return this._maxZoom},Ji.maxZoom.set=function(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))},Ji.minPitch.get=function(){return this._minPitch},Ji.minPitch.set=function(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))},Ji.maxPitch.get=function(){return this._maxPitch},Ji.maxPitch.set=function(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))},Ji.renderWorldCopies.get=function(){return this._renderWorldCopies},Ji.renderWorldCopies.set=function(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s},Ji.worldSize.get=function(){return this.tileSize*this.scale},Ji.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Ji.size.get=function(){return new m.Point(this.width,this.height)},Ji.bearing.get=function(){return-this.angle/Math.PI*180},Ji.bearing.set=function(s){var c=-m.wrap(s,-180,180)*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=m.create$2(),m.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Ji.pitch.get=function(){return this._pitch/Math.PI*180},Ji.pitch.set=function(s){var c=m.clamp(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())},Ji.fov.get=function(){return this._fov/Math.PI*180},Ji.fov.set=function(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=s/180*Math.PI,this._calcMatrices())},Ji.zoom.get=function(){return this._zoom},Ji.zoom.set=function(s){var c=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._zoom=c,this.scale=this.zoomScale(c),this.tileZoom=Math.floor(c),this.zoomFraction=c-this.tileZoom,this._constrain(),this._calcMatrices())},Ji.center.get=function(){return this._center},Ji.center.set=function(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._constrain(),this._calcMatrices())},Ji.padding.get=function(){return this._edgeInsets.toJSON()},Ji.padding.set=function(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())},Ji.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Ii.prototype.isPaddingEqual=function(s){return this._edgeInsets.equals(s)},Ii.prototype.interpolatePadding=function(s,c,u){this._unmodified=!1,this._edgeInsets.interpolate(s,c,u),this._constrain(),this._calcMatrices()},Ii.prototype.coveringZoomLevel=function(s){var c=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,c)},Ii.prototype.getVisibleUnwrappedCoordinates=function(s){var c=[new m.UnwrappedTileID(0,s)];if(this._renderWorldCopies)for(var u=this.pointCoordinate(new m.Point(0,0)),f=this.pointCoordinate(new m.Point(this.width,0)),T=this.pointCoordinate(new m.Point(this.width,this.height)),P=this.pointCoordinate(new m.Point(0,this.height)),M=Math.floor(Math.min(u.x,f.x,T.x,P.x)),F=Math.floor(Math.max(u.x,f.x,T.x,P.x)),X=M-1;X<=F+1;X++)X!==0&&c.push(new m.UnwrappedTileID(X,s));return c},Ii.prototype.coveringTiles=function(s){var c=this.coveringZoomLevel(s),u=c;if(s.minzoom!==void 0&&c<s.minzoom)return[];s.maxzoom!==void 0&&c>s.maxzoom&&(c=s.maxzoom);var f=m.MercatorCoordinate.fromLngLat(this.center),T=Math.pow(2,c),P=[T*f.x,T*f.y,0],M=Ms.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c),F=s.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(F=c);var X=function(xt){return{aabb:new us([xt*T,0,0],[(xt+1)*T,T,0]),zoom:0,x:0,y:0,wrap:xt,fullyVisible:!1}},Y=[],le=[],ce=c,de=s.reparseOverscaled?u:c;if(this._renderWorldCopies)for(var Ce=1;Ce<=3;Ce++)Y.push(X(-Ce)),Y.push(X(Ce));for(Y.push(X(0));Y.length>0;){var Ae=Y.pop(),ke=Ae.x,xe=Ae.y,ze=Ae.fullyVisible;if(!ze){var Be=Ae.aabb.intersects(M);if(Be===0)continue;ze=Be===2}var Ge=Ae.aabb.distanceX(P),Je=Ae.aabb.distanceY(P),Ye=Math.max(Math.abs(Ge),Math.abs(Je));if(Ae.zoom===ce||Ye>3+(1<<ce-Ae.zoom)-2&&Ae.zoom>=F)le.push({tileID:new m.OverscaledTileID(Ae.zoom===ce?de:Ae.zoom,Ae.wrap,Ae.zoom,ke,xe),distanceSq:m.sqrLen([P[0]-.5-ke,P[1]-.5-xe])});else for(var Qe=0;Qe<4;Qe++){var ht=(ke<<1)+Qe%2,bt=(xe<<1)+(Qe>>1);Y.push({aabb:Ae.aabb.quadrant(Qe),zoom:Ae.zoom+1,x:ht,y:bt,wrap:Ae.wrap,fullyVisible:ze})}}return le.sort(function(xt,Dt){return xt.distanceSq-Dt.distanceSq}).map(function(xt){return xt.tileID})},Ii.prototype.resize=function(s,c){this.width=s,this.height=c,this.pixelsToGLUnits=[2/s,-2/c],this._constrain(),this._calcMatrices()},Ji.unmodified.get=function(){return this._unmodified},Ii.prototype.zoomScale=function(s){return Math.pow(2,s)},Ii.prototype.scaleZoom=function(s){return Math.log(s)/Math.LN2},Ii.prototype.project=function(s){var c=m.clamp(s.lat,-this.maxValidLatitude,this.maxValidLatitude);return new m.Point(m.mercatorXfromLng(s.lng)*this.worldSize,m.mercatorYfromLat(c)*this.worldSize)},Ii.prototype.unproject=function(s){return new m.MercatorCoordinate(s.x/this.worldSize,s.y/this.worldSize).toLngLat()},Ji.point.get=function(){return this.project(this.center)},Ii.prototype.setLocationAtPoint=function(s,c){var u=this.pointCoordinate(c),f=this.pointCoordinate(this.centerPoint),T=this.locationCoordinate(s),P=new m.MercatorCoordinate(T.x-(u.x-f.x),T.y-(u.y-f.y));this.center=this.coordinateLocation(P),this._renderWorldCopies&&(this.center=this.center.wrap())},Ii.prototype.locationPoint=function(s){return this.coordinatePoint(this.locationCoordinate(s))},Ii.prototype.pointLocation=function(s){return this.coordinateLocation(this.pointCoordinate(s))},Ii.prototype.locationCoordinate=function(s){return m.MercatorCoordinate.fromLngLat(s)},Ii.prototype.coordinateLocation=function(s){return s.toLngLat()},Ii.prototype.pointCoordinate=function(s){var c=[s.x,s.y,0,1],u=[s.x,s.y,1,1];m.transformMat4(c,c,this.pixelMatrixInverse),m.transformMat4(u,u,this.pixelMatrixInverse);var f=c[3],T=u[3],P=c[1]/f,M=u[1]/T,F=c[2]/f,X=u[2]/T,Y=F===X?0:(0-F)/(X-F);return new m.MercatorCoordinate(m.number(c[0]/f,u[0]/T,Y)/this.worldSize,m.number(P,M,Y)/this.worldSize)},Ii.prototype.coordinatePoint=function(s){var c=[s.x*this.worldSize,s.y*this.worldSize,0,1];return m.transformMat4(c,c,this.pixelMatrix),new m.Point(c[0]/c[3],c[1]/c[3])},Ii.prototype.getBounds=function(){return new m.LngLatBounds().extend(this.pointLocation(new m.Point(0,0))).extend(this.pointLocation(new m.Point(this.width,0))).extend(this.pointLocation(new m.Point(this.width,this.height))).extend(this.pointLocation(new m.Point(0,this.height)))},Ii.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new m.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Ii.prototype.setMaxBounds=function(s){s?(this.lngRange=[s.getWest(),s.getEast()],this.latRange=[s.getSouth(),s.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Ii.prototype.calculatePosMatrix=function(s,c){c===void 0&&(c=!1);var u=s.key,f=c?this._alignedPosMatrixCache:this._posMatrixCache;if(f[u])return f[u];var T=s.canonical,P=this.worldSize/this.zoomScale(T.z),M=T.x+Math.pow(2,T.z)*s.wrap,F=m.identity(new Float64Array(16));return m.translate(F,F,[M*P,T.y*P,0]),m.scale(F,F,[P/m.EXTENT,P/m.EXTENT,1]),m.multiply(F,c?this.alignedProjMatrix:this.projMatrix,F),f[u]=new Float32Array(F),f[u]},Ii.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Ii.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var s,c,u,f,T=-90,P=90,M=-180,F=180,X=this.size,Y=this._unmodified;if(this.latRange){var le=this.latRange;T=m.mercatorYfromLat(le[1])*this.worldSize,s=(P=m.mercatorYfromLat(le[0])*this.worldSize)-T<X.y?X.y/(P-T):0}if(this.lngRange){var ce=this.lngRange;M=m.mercatorXfromLng(ce[0])*this.worldSize,c=(F=m.mercatorXfromLng(ce[1])*this.worldSize)-M<X.x?X.x/(F-M):0}var de=this.point,Ce=Math.max(c||0,s||0);if(Ce)return this.center=this.unproject(new m.Point(c?(F+M)/2:de.x,s?(P+T)/2:de.y)),this.zoom+=this.scaleZoom(Ce),this._unmodified=Y,void(this._constraining=!1);if(this.latRange){var Ae=de.y,ke=X.y/2;Ae-ke<T&&(f=T+ke),Ae+ke>P&&(f=P-ke)}if(this.lngRange){var xe=de.x,ze=X.x/2;xe-ze<M&&(u=M+ze),xe+ze>F&&(u=F-ze)}u===void 0&&f===void 0||(this.center=this.unproject(new m.Point(u!==void 0?u:de.x,f!==void 0?f:de.y))),this._unmodified=Y,this._constraining=!1}},Ii.prototype._calcMatrices=function(){if(this.height){var s=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var c=Math.PI/2+this._pitch,u=this._fov*(.5+s.y/this.height),f=Math.sin(u)*this.cameraToCenterDistance/Math.sin(m.clamp(Math.PI-c-u,.01,Math.PI-.01)),T=this.point,P=T.x,M=T.y,F=1.01*(Math.cos(Math.PI/2-this._pitch)*f+this.cameraToCenterDistance),X=this.height/50,Y=new Float64Array(16);m.perspective(Y,this._fov,this.width/this.height,X,F),Y[8]=2*-s.x/this.width,Y[9]=2*s.y/this.height,m.scale(Y,Y,[1,-1,1]),m.translate(Y,Y,[0,0,-this.cameraToCenterDistance]),m.rotateX(Y,Y,this._pitch),m.rotateZ(Y,Y,this.angle),m.translate(Y,Y,[-P,-M,0]),this.mercatorMatrix=m.scale([],Y,[this.worldSize,this.worldSize,this.worldSize]),m.scale(Y,Y,[1,1,m.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=Y,this.invProjMatrix=m.invert([],this.projMatrix);var le=this.width%2/2,ce=this.height%2/2,de=Math.cos(this.angle),Ce=Math.sin(this.angle),Ae=P-Math.round(P)+de*le+Ce*ce,ke=M-Math.round(M)+de*ce+Ce*le,xe=new Float64Array(Y);if(m.translate(xe,xe,[Ae>.5?Ae-1:Ae,ke>.5?ke-1:ke,0]),this.alignedProjMatrix=xe,Y=m.create(),m.scale(Y,Y,[this.width/2,-this.height/2,1]),m.translate(Y,Y,[1,-1,0]),this.labelPlaneMatrix=Y,Y=m.create(),m.scale(Y,Y,[1,-1,1]),m.translate(Y,Y,[-1,-1,0]),m.scale(Y,Y,[2/this.width,2/this.height,1]),this.glCoordMatrix=Y,this.pixelMatrix=m.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(Y=m.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=Y,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Ii.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var s=this.pointCoordinate(new m.Point(0,0)),c=[s.x*this.worldSize,s.y*this.worldSize,0,1];return m.transformMat4(c,c,this.pixelMatrix)[3]/this.cameraToCenterDistance},Ii.prototype.getCameraPoint=function(){var s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new m.Point(0,s))},Ii.prototype.getCameraQueryGeometry=function(s){var c=this.getCameraPoint();if(s.length===1)return[s[0],c];for(var u=c.x,f=c.y,T=c.x,P=c.y,M=0,F=s;M<F.length;M+=1){var X=F[M];u=Math.min(u,X.x),f=Math.min(f,X.y),T=Math.max(T,X.x),P=Math.max(P,X.y)}return[new m.Point(u,f),new m.Point(T,f),new m.Point(T,P),new m.Point(u,P),new m.Point(u,f)]},Object.defineProperties(Ii.prototype,Ji);var Lt=function(s){var c,u,f,T;this._hashName=s&&encodeURIComponent(s),m.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(c=this._updateHashUnthrottled.bind(this),u=!1,f=null,T=function(){f=null,u&&(c(),f=setTimeout(T,300),u=!1)},function(){return u=!0,f||T(),f})};Lt.prototype.addTo=function(s){return this._map=s,m.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Lt.prototype.remove=function(){return m.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Lt.prototype.getHashString=function(s){var c=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,f=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,f),P=Math.round(c.lng*T)/T,M=Math.round(c.lat*T)/T,F=this._map.getBearing(),X=this._map.getPitch(),Y="";if(Y+=s?"/"+P+"/"+M+"/"+u:u+"/"+M+"/"+P,(F||X)&&(Y+="/"+Math.round(10*F)/10),X&&(Y+="/"+Math.round(X)),this._hashName){var le=this._hashName,ce=!1,de=m.window.location.hash.slice(1).split("&").map(function(Ce){var Ae=Ce.split("=")[0];return Ae===le?(ce=!0,Ae+"="+Y):Ce}).filter(function(Ce){return Ce});return ce||de.push(le+"="+Y),"#"+de.join("&")}return"#"+Y},Lt.prototype._getCurrentHash=function(){var s,c=this,u=m.window.location.hash.replace("#","");return this._hashName?(u.split("&").map(function(f){return f.split("=")}).forEach(function(f){f[0]===c._hashName&&(s=f)}),(s&&s[1]||"").split("/")):u.split("/")},Lt.prototype._onHashChange=function(){var s=this._getCurrentHash();if(s.length>=3&&!s.some(function(u){return isNaN(u)})){var c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:c,pitch:+(s[4]||0)}),!0}return!1},Lt.prototype._updateHashUnthrottled=function(){var s=m.window.location.href.replace(/(#.+)?$/,this.getHashString());try{m.window.history.replaceState(m.window.history.state,null,s)}catch{}};var cs={linearity:.3,easing:m.bezier(0,0,.3,1)},sa=m.extend({deceleration:2500,maxSpeed:1400},cs),qo=m.extend({deceleration:20,maxSpeed:1400},cs),al=m.extend({deceleration:1e3,maxSpeed:360},cs),Vt=m.extend({deceleration:1e3,maxSpeed:90},cs),hs=function(s){this._map=s,this.clear()};function Ls(s,c){(!s.duration||s.duration<c.duration)&&(s.duration=c.duration,s.easing=c.easing)}function Ta(s,c,u){var f=u.maxSpeed,T=u.linearity,P=u.deceleration,M=m.clamp(s*T/(c/1e3),-f,f),F=Math.abs(M)/(P*T);return{easing:u.easing,duration:1e3*F,amount:M*(F/2)}}hs.prototype.clear=function(){this._inertiaBuffer=[]},hs.prototype.record=function(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:m.browser.now(),settings:s})},hs.prototype._drainInertiaBuffer=function(){for(var s=this._inertiaBuffer,c=m.browser.now();s.length>0&&c-s[0].time>160;)s.shift()},hs.prototype._onMoveEnd=function(s){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var c={zoom:0,bearing:0,pitch:0,pan:new m.Point(0,0),pinchAround:void 0,around:void 0},u=0,f=this._inertiaBuffer;u<f.length;u+=1){var T=f[u].settings;c.zoom+=T.zoomDelta||0,c.bearing+=T.bearingDelta||0,c.pitch+=T.pitchDelta||0,T.panDelta&&c.pan._add(T.panDelta),T.around&&(c.around=T.around),T.pinchAround&&(c.pinchAround=T.pinchAround)}var P=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,M={};if(c.pan.mag()){var F=Ta(c.pan.mag(),P,m.extend({},sa,s||{}));M.offset=c.pan.mult(F.amount/c.pan.mag()),M.center=this._map.transform.center,Ls(M,F)}if(c.zoom){var X=Ta(c.zoom,P,qo);M.zoom=this._map.transform.zoom+X.amount,Ls(M,X)}if(c.bearing){var Y=Ta(c.bearing,P,al);M.bearing=this._map.transform.bearing+m.clamp(Y.amount,-179,179),Ls(M,Y)}if(c.pitch){var le=Ta(c.pitch,P,Vt);M.pitch=this._map.transform.pitch+le.amount,Ls(M,le)}if(M.zoom||M.bearing){var ce=c.pinchAround===void 0?c.around:c.pinchAround;M.around=ce?this._map.unproject(ce):this._map.getCenter()}return this.clear(),m.extend(M,{noMoveStart:!0})}};var Er=function(s){function c(f,T,P,M){M===void 0&&(M={});var F=Z.mousePos(T.getCanvasContainer(),P),X=T.unproject(F);s.call(this,f,m.extend({point:F,lngLat:X,originalEvent:P},M)),this._defaultPrevented=!1,this.target=T}s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c;var u={defaultPrevented:{configurable:!0}};return c.prototype.preventDefault=function(){this._defaultPrevented=!0},u.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(c.prototype,u),c}(m.Event),Ds=function(s){function c(f,T,P){var M=f==="touchend"?P.changedTouches:P.touches,F=Z.touchPos(T.getCanvasContainer(),M),X=F.map(function(ce){return T.unproject(ce)}),Y=F.reduce(function(ce,de,Ce,Ae){return ce.add(de.div(Ae.length))},new m.Point(0,0)),le=T.unproject(Y);s.call(this,f,{points:F,point:Y,lngLats:X,lngLat:le,originalEvent:P}),this._defaultPrevented=!1}s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c;var u={defaultPrevented:{configurable:!0}};return c.prototype.preventDefault=function(){this._defaultPrevented=!0},u.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(c.prototype,u),c}(m.Event),Eu=function(s){function c(f,T,P){s.call(this,f,{originalEvent:P}),this._defaultPrevented=!1}s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c;var u={defaultPrevented:{configurable:!0}};return c.prototype.preventDefault=function(){this._defaultPrevented=!0},u.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(c.prototype,u),c}(m.Event),qr=function(s,c){this._map=s,this._clickTolerance=c.clickTolerance};qr.prototype.reset=function(){delete this._mousedownPos},qr.prototype.wheel=function(s){return this._firePreventable(new Eu(s.type,this._map,s))},qr.prototype.mousedown=function(s,c){return this._mousedownPos=c,this._firePreventable(new Er(s.type,this._map,s))},qr.prototype.mouseup=function(s){this._map.fire(new Er(s.type,this._map,s))},qr.prototype.click=function(s,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||this._map.fire(new Er(s.type,this._map,s))},qr.prototype.dblclick=function(s){return this._firePreventable(new Er(s.type,this._map,s))},qr.prototype.mouseover=function(s){this._map.fire(new Er(s.type,this._map,s))},qr.prototype.mouseout=function(s){this._map.fire(new Er(s.type,this._map,s))},qr.prototype.touchstart=function(s){return this._firePreventable(new Ds(s.type,this._map,s))},qr.prototype.touchmove=function(s){this._map.fire(new Ds(s.type,this._map,s))},qr.prototype.touchend=function(s){this._map.fire(new Ds(s.type,this._map,s))},qr.prototype.touchcancel=function(s){this._map.fire(new Ds(s.type,this._map,s))},qr.prototype._firePreventable=function(s){if(this._map.fire(s),s.defaultPrevented)return{}},qr.prototype.isEnabled=function(){return!0},qr.prototype.isActive=function(){return!1},qr.prototype.enable=function(){},qr.prototype.disable=function(){};var jt=function(s){this._map=s};jt.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},jt.prototype.mousemove=function(s){this._map.fire(new Er(s.type,this._map,s))},jt.prototype.mousedown=function(){this._delayContextMenu=!0},jt.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Er("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},jt.prototype.contextmenu=function(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new Er(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()},jt.prototype.isEnabled=function(){return!0},jt.prototype.isActive=function(){return!1},jt.prototype.enable=function(){},jt.prototype.disable=function(){};var Dn=function(s,c){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=c.clickTolerance||1};function Rs(s,c){for(var u={},f=0;f<s.length;f++)u[s[f].identifier]=c[f];return u}Dn.prototype.isEnabled=function(){return!!this._enabled},Dn.prototype.isActive=function(){return!!this._active},Dn.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Dn.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Dn.prototype.mousedown=function(s,c){this.isEnabled()&&s.shiftKey&&s.button===0&&(Z.disableDrag(),this._startPos=this._lastPos=c,this._active=!0)},Dn.prototype.mousemoveWindow=function(s,c){if(this._active){var u=c;if(!(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)){var f=this._startPos;this._lastPos=u,this._box||(this._box=Z.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));var T=Math.min(f.x,u.x),P=Math.max(f.x,u.x),M=Math.min(f.y,u.y),F=Math.max(f.y,u.y);Z.setTransform(this._box,"translate("+T+"px,"+M+"px)"),this._box.style.width=P-T+"px",this._box.style.height=F-M+"px"}}},Dn.prototype.mouseupWindow=function(s,c){var u=this;if(this._active&&s.button===0){var f=this._startPos,T=c;if(this.reset(),Z.suppressClick(),f.x!==T.x||f.y!==T.y)return this._map.fire(new m.Event("boxzoomend",{originalEvent:s})),{cameraAnimation:function(P){return P.fitScreenCoordinates(f,T,u._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",s)}},Dn.prototype.keydown=function(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))},Dn.prototype.blur=function(){this.reset()},Dn.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(Z.remove(this._box),this._box=null),Z.enableDrag(),delete this._startPos,delete this._lastPos},Dn.prototype._fireEvent=function(s,c){return this._map.fire(new m.Event(s,{originalEvent:c}))};var qa=function(s){this.reset(),this.numTouches=s.numTouches};qa.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},qa.prototype.touchstart=function(s,c,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=s.timeStamp),u.length===this.numTouches&&(this.centroid=function(f){for(var T=new m.Point(0,0),P=0,M=f;P<M.length;P+=1)T._add(M[P]);return T.div(f.length)}(c),this.touches=Rs(u,c)))},qa.prototype.touchmove=function(s,c,u){if(!this.aborted&&this.centroid){var f=Rs(u,c);for(var T in this.touches){var P=f[T];(!P||P.dist(this.touches[T])>30)&&(this.aborted=!0)}}},qa.prototype.touchend=function(s,c,u){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){var f=!this.aborted&&this.centroid;if(this.reset(),f)return f}};var Ao=function(s){this.singleTap=new qa(s),this.numTaps=s.numTaps,this.reset()};Ao.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Ao.prototype.touchstart=function(s,c,u){this.singleTap.touchstart(s,c,u)},Ao.prototype.touchmove=function(s,c,u){this.singleTap.touchmove(s,c,u)},Ao.prototype.touchend=function(s,c,u){var f=this.singleTap.touchend(s,c,u);if(f){var T=s.timeStamp-this.lastTime<500,P=!this.lastTap||this.lastTap.dist(f)<30;if(T&&P||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}};var vr=function(){this._zoomIn=new Ao({numTouches:1,numTaps:2}),this._zoomOut=new Ao({numTouches:2,numTaps:1}),this.reset()};vr.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},vr.prototype.touchstart=function(s,c,u){this._zoomIn.touchstart(s,c,u),this._zoomOut.touchstart(s,c,u)},vr.prototype.touchmove=function(s,c,u){this._zoomIn.touchmove(s,c,u),this._zoomOut.touchmove(s,c,u)},vr.prototype.touchend=function(s,c,u){var f=this,T=this._zoomIn.touchend(s,c,u),P=this._zoomOut.touchend(s,c,u);return T?(this._active=!0,s.preventDefault(),setTimeout(function(){return f.reset()},0),{cameraAnimation:function(M){return M.easeTo({duration:300,zoom:M.getZoom()+1,around:M.unproject(T)},{originalEvent:s})}}):P?(this._active=!0,s.preventDefault(),setTimeout(function(){return f.reset()},0),{cameraAnimation:function(M){return M.easeTo({duration:300,zoom:M.getZoom()-1,around:M.unproject(P)},{originalEvent:s})}}):void 0},vr.prototype.touchcancel=function(){this.reset()},vr.prototype.enable=function(){this._enabled=!0},vr.prototype.disable=function(){this._enabled=!1,this.reset()},vr.prototype.isEnabled=function(){return this._enabled},vr.prototype.isActive=function(){return this._active};var la={0:1,2:2},Ct=function(s){this.reset(),this._clickTolerance=s.clickTolerance||1};Ct.prototype.blur=function(){this.reset()},Ct.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Ct.prototype._correctButton=function(s,c){return!1},Ct.prototype._move=function(s,c){return{}},Ct.prototype.mousedown=function(s,c){if(!this._lastPoint){var u=Z.mouseButton(s);this._correctButton(s,u)&&(this._lastPoint=c,this._eventButton=u)}},Ct.prototype.mousemoveWindow=function(s,c){var u=this._lastPoint;if(u){if(s.preventDefault(),function(f,T){var P=la[T];return f.buttons===void 0||(f.buttons&P)!==P}(s,this._eventButton))this.reset();else if(this._moved||!(c.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(u,c)}},Ct.prototype.mouseupWindow=function(s){this._lastPoint&&Z.mouseButton(s)===this._eventButton&&(this._moved&&Z.suppressClick(),this.reset())},Ct.prototype.enable=function(){this._enabled=!0},Ct.prototype.disable=function(){this._enabled=!1,this.reset()},Ct.prototype.isEnabled=function(){return this._enabled},Ct.prototype.isActive=function(){return this._active};var sl=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.mousedown=function(u,f){s.prototype.mousedown.call(this,u,f),this._lastPoint&&(this._active=!0)},c.prototype._correctButton=function(u,f){return f===0&&!u.ctrlKey},c.prototype._move=function(u,f){return{around:f,panDelta:f.sub(u)}},c}(Ct),Aa=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype._correctButton=function(u,f){return f===0&&u.ctrlKey||f===2},c.prototype._move=function(u,f){var T=.8*(f.x-u.x);if(T)return this._active=!0,{bearingDelta:T}},c.prototype.contextmenu=function(u){u.preventDefault()},c}(Ct),ll=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype._correctButton=function(u,f){return f===0&&u.ctrlKey||f===2},c.prototype._move=function(u,f){var T=-.5*(f.y-u.y);if(T)return this._active=!0,{pitchDelta:T}},c.prototype.contextmenu=function(u){u.preventDefault()},c}(Ct),Jn=function(s){this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset()};Jn.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new m.Point(0,0)},Jn.prototype.touchstart=function(s,c,u){return this._calculateTransform(s,c,u)},Jn.prototype.touchmove=function(s,c,u){if(this._active&&!(u.length<this._minTouches))return s.preventDefault(),this._calculateTransform(s,c,u)},Jn.prototype.touchend=function(s,c,u){this._calculateTransform(s,c,u),this._active&&u.length<this._minTouches&&this.reset()},Jn.prototype.touchcancel=function(){this.reset()},Jn.prototype._calculateTransform=function(s,c,u){u.length>0&&(this._active=!0);var f=Rs(u,c),T=new m.Point(0,0),P=new m.Point(0,0),M=0;for(var F in f){var X=f[F],Y=this._touches[F];Y&&(T._add(X),P._add(X.sub(Y)),M++,f[F]=X)}if(this._touches=f,!(M<this._minTouches)&&P.mag()){var le=P.div(M);if(this._sum._add(le),!(this._sum.mag()<this._clickTolerance))return{around:T.div(M),panDelta:le}}},Jn.prototype.enable=function(){this._enabled=!0},Jn.prototype.disable=function(){this._enabled=!1,this.reset()},Jn.prototype.isEnabled=function(){return this._enabled},Jn.prototype.isActive=function(){return this._active};var Sr=function(){this.reset()};function mr(s,c,u){for(var f=0;f<s.length;f++)if(s[f].identifier===u)return c[f]}function ps(s,c){return Math.log(s/c)/Math.LN2}Sr.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Sr.prototype._start=function(s){},Sr.prototype._move=function(s,c,u){return{}},Sr.prototype.touchstart=function(s,c,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([c[0],c[1]]))},Sr.prototype.touchmove=function(s,c,u){if(this._firstTwoTouches){s.preventDefault();var f=this._firstTwoTouches,T=f[1],P=mr(u,c,f[0]),M=mr(u,c,T);if(P&&M){var F=this._aroundCenter?null:P.add(M).div(2);return this._move([P,M],F,s)}}},Sr.prototype.touchend=function(s,c,u){if(this._firstTwoTouches){var f=this._firstTwoTouches,T=f[1],P=mr(u,c,f[0]),M=mr(u,c,T);P&&M||(this._active&&Z.suppressClick(),this.reset())}},Sr.prototype.touchcancel=function(){this.reset()},Sr.prototype.enable=function(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"},Sr.prototype.disable=function(){this._enabled=!1,this.reset()},Sr.prototype.isEnabled=function(){return this._enabled},Sr.prototype.isActive=function(){return this._active};var Rn=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.reset=function(){s.prototype.reset.call(this),delete this._distance,delete this._startDistance},c.prototype._start=function(u){this._startDistance=this._distance=u[0].dist(u[1])},c.prototype._move=function(u,f){var T=this._distance;if(this._distance=u[0].dist(u[1]),this._active||!(Math.abs(ps(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ps(this._distance,T),pinchAround:f}},c}(Sr);function Go(s,c){return 180*s.angleWith(c)/Math.PI}var Su=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.reset=function(){s.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},c.prototype._start=function(u){this._startVector=this._vector=u[0].sub(u[1]),this._minDiameter=u[0].dist(u[1])},c.prototype._move=function(u,f){var T=this._vector;if(this._vector=u[0].sub(u[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Go(this._vector,T),pinchAround:f}},c.prototype._isBelowThreshold=function(u){this._minDiameter=Math.min(this._minDiameter,u.mag());var f=25/(Math.PI*this._minDiameter)*360,T=Go(u,this._startVector);return Math.abs(T)<f},c}(Sr);function Bs(s){return Math.abs(s.y)>Math.abs(s.x)}var Tu=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.reset=function(){s.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},c.prototype._start=function(u){this._lastPoints=u,Bs(u[0].sub(u[1]))&&(this._valid=!1)},c.prototype._move=function(u,f,T){var P=u[0].sub(this._lastPoints[0]),M=u[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(P,M,T.timeStamp),this._valid)return this._lastPoints=u,this._active=!0,{pitchDelta:(P.y+M.y)/2*-.5}},c.prototype.gestureBeginsVertically=function(u,f,T){if(this._valid!==void 0)return this._valid;var P=u.mag()>=2,M=f.mag()>=2;if(P||M){if(!P||!M)return this._firstMove===void 0&&(this._firstMove=T),T-this._firstMove<100&&void 0;var F=u.y>0==f.y>0;return Bs(u)&&Bs(f)&&F}},c}(Sr),Ro={panStep:100,bearingStep:15,pitchStep:10},so=function(){var s=Ro;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1};function Gt(s){return s*(2-s)}so.prototype.blur=function(){this.reset()},so.prototype.reset=function(){this._active=!1},so.prototype.keydown=function(s){var c=this;if(!(s.altKey||s.ctrlKey||s.metaKey)){var u=0,f=0,T=0,P=0,M=0;switch(s.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:s.shiftKey?f=-1:(s.preventDefault(),P=-1);break;case 39:s.shiftKey?f=1:(s.preventDefault(),P=1);break;case 38:s.shiftKey?T=1:(s.preventDefault(),M=-1);break;case 40:s.shiftKey?T=-1:(s.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(f=0,T=0),{cameraAnimation:function(F){var X=F.getZoom();F.easeTo({duration:300,easeId:"keyboardHandler",easing:Gt,zoom:u?Math.round(X)+u*(s.shiftKey?2:1):X,bearing:F.getBearing()+f*c._bearingStep,pitch:F.getPitch()+T*c._pitchStep,offset:[-P*c._panStep,-M*c._panStep],center:F.getCenter()},{originalEvent:s})}}}},so.prototype.enable=function(){this._enabled=!0},so.prototype.disable=function(){this._enabled=!1,this.reset()},so.prototype.isEnabled=function(){return this._enabled},so.prototype.isActive=function(){return this._active},so.prototype.disableRotation=function(){this._rotationDisabled=!0},so.prototype.enableRotation=function(){this._rotationDisabled=!1};var At=function(s,c){this._map=s,this._el=s.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,m.bindAll(["_onTimeout"],this)};At.prototype.setZoomRate=function(s){this._defaultZoomRate=s},At.prototype.setWheelZoomRate=function(s){this._wheelZoomRate=s},At.prototype.isEnabled=function(){return!!this._enabled},At.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},At.prototype.isZooming=function(){return!!this._zooming},At.prototype.enable=function(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=s&&s.around==="center")},At.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},At.prototype.wheel=function(s){if(this.isEnabled()){var c=s.deltaMode===m.window.WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY,u=m.browser.now(),f=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,c!==0&&c%4.000244140625==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(f*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),s.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=s,this._delta-=c,this._active||this._start(s)),s.preventDefault()}},At.prototype._onTimeout=function(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)},At.prototype._start=function(s){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var c=Z.mousePos(this._el,s);this._around=m.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(c)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},At.prototype.renderFrame=function(){var s=this;if(this._frameId&&(this._frameId=null,this.isActive())){var c=this._map.transform;if(this._delta!==0){var u=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,f=2/(1+Math.exp(-Math.abs(this._delta*u)));this._delta<0&&f!==0&&(f=1/f);var T=typeof this._targetZoom=="number"?c.zoomScale(this._targetZoom):c.scale;this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,c.scaleZoom(T*f))),this._type==="wheel"&&(this._startZoom=c.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var P,M=typeof this._targetZoom=="number"?this._targetZoom:c.zoom,F=this._startZoom,X=this._easing,Y=!1;if(this._type==="wheel"&&F&&X){var le=Math.min((m.browser.now()-this._lastWheelEventTime)/200,1),ce=X(le);P=m.number(F,M,ce),le<1?this._frameId||(this._frameId=!0):Y=!0}else P=M,Y=!0;return this._active=!0,Y&&(this._active=!1,this._finishTimeout=setTimeout(function(){s._zooming=!1,s._handler._triggerRenderFrame(),delete s._targetZoom,delete s._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!Y,zoomDelta:P-c.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},At.prototype._smoothOutEasing=function(s){var c=m.ease;if(this._prevEase){var u=this._prevEase,f=(m.browser.now()-u.start)/u.duration,T=u.easing(f+.01)-u.easing(f),P=.27/Math.sqrt(T*T+1e-4)*.01,M=Math.sqrt(.0729-P*P);c=m.bezier(P,M,.25,1)}return this._prevEase={start:m.browser.now(),duration:s,easing:c},c},At.prototype.blur=function(){this.reset()},At.prototype.reset=function(){this._active=!1};var lo=function(s,c){this._clickZoom=s,this._tapZoom=c};lo.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},lo.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},lo.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},lo.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var Gn=function(){this.reset()};Gn.prototype.reset=function(){this._active=!1},Gn.prototype.blur=function(){this.reset()},Gn.prototype.dblclick=function(s,c){return s.preventDefault(),{cameraAnimation:function(u){u.easeTo({duration:300,zoom:u.getZoom()+(s.shiftKey?-1:1),around:u.unproject(c)},{originalEvent:s})}}},Gn.prototype.enable=function(){this._enabled=!0},Gn.prototype.disable=function(){this._enabled=!1,this.reset()},Gn.prototype.isEnabled=function(){return this._enabled},Gn.prototype.isActive=function(){return this._active};var an=function(){this._tap=new Ao({numTouches:1,numTaps:1}),this.reset()};an.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},an.prototype.touchstart=function(s,c,u){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=c[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(s,c,u))},an.prototype.touchmove=function(s,c,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;var f=c[0],T=f.y-this._swipePoint.y;return this._swipePoint=f,s.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(s,c,u)},an.prototype.touchend=function(s,c,u){this._tapTime?this._swipePoint&&u.length===0&&this.reset():this._tap.touchend(s,c,u)&&(this._tapTime=s.timeStamp)},an.prototype.touchcancel=function(){this.reset()},an.prototype.enable=function(){this._enabled=!0},an.prototype.disable=function(){this._enabled=!1,this.reset()},an.prototype.isEnabled=function(){return this._enabled},an.prototype.isActive=function(){return this._active};var Tr=function(s,c,u){this._el=s,this._mousePan=c,this._touchPan=u};Tr.prototype.enable=function(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Tr.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Tr.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Tr.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var uo=function(s,c,u){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=c,this._mousePitch=u};uo.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},uo.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},uo.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},uo.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Cr=function(s,c,u,f){this._el=s,this._touchZoom=c,this._touchRotate=u,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0};Cr.prototype.enable=function(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Cr.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Cr.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Cr.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Cr.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Cr.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var Zn=function(s){return s.zoom||s.drag||s.pitch||s.rotate},Ia=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c}(m.Event);function Pt(s){return s.panDelta&&s.panDelta.mag()||s.zoomDelta||s.bearingDelta||s.pitchDelta}var zt=function(s,c){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new hs(s),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(c),m.bindAll(["handleEvent","handleWindowEvent"],this);var u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[m.window.document,"mousemove",{capture:!0}],[m.window.document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[m.window,"blur",void 0]];for(var f=0,T=this._listeners;f<T.length;f+=1){var P=T[f],M=P[0];Z.addEventListener(M,P[1],M===m.window.document?this.handleWindowEvent:this.handleEvent,P[2])}};zt.prototype.destroy=function(){for(var s=0,c=this._listeners;s<c.length;s+=1){var u=c[s],f=u[0];Z.removeEventListener(f,u[1],f===m.window.document?this.handleWindowEvent:this.handleEvent,u[2])}},zt.prototype._addDefaultHandlers=function(s){var c=this._map,u=c.getCanvasContainer();this._add("mapEvent",new qr(c,s));var f=c.boxZoom=new Dn(c,s);this._add("boxZoom",f);var T=new vr,P=new Gn;c.doubleClickZoom=new lo(P,T),this._add("tapZoom",T),this._add("clickZoom",P);var M=new an;this._add("tapDragZoom",M);var F=c.touchPitch=new Tu;this._add("touchPitch",F);var X=new Aa(s),Y=new ll(s);c.dragRotate=new uo(s,X,Y),this._add("mouseRotate",X,["mousePitch"]),this._add("mousePitch",Y,["mouseRotate"]);var le=new sl(s),ce=new Jn(s);c.dragPan=new Tr(u,le,ce),this._add("mousePan",le),this._add("touchPan",ce,["touchZoom","touchRotate"]);var de=new Su,Ce=new Rn;c.touchZoomRotate=new Cr(u,Ce,de,M),this._add("touchRotate",de,["touchPan","touchZoom"]),this._add("touchZoom",Ce,["touchPan","touchRotate"]);var Ae=c.scrollZoom=new At(c,this);this._add("scrollZoom",Ae,["mousePan"]);var ke=c.keyboard=new so;this._add("keyboard",ke),this._add("blockableMapEvent",new jt(c));for(var xe=0,ze=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];xe<ze.length;xe+=1){var Be=ze[xe];s.interactive&&s[Be]&&c[Be].enable(s[Be])}},zt.prototype._add=function(s,c,u){this._handlers.push({handlerName:s,handler:c,allowed:u}),this._handlersById[s]=c},zt.prototype.stop=function(s){if(!this._updatingCamera){for(var c=0,u=this._handlers;c<u.length;c+=1)u[c].handler.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}},zt.prototype.isActive=function(){for(var s=0,c=this._handlers;s<c.length;s+=1)if(c[s].handler.isActive())return!0;return!1},zt.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},zt.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},zt.prototype.isMoving=function(){return Boolean(Zn(this._eventsInProgress))||this.isZooming()},zt.prototype._blockedByActive=function(s,c,u){for(var f in s)if(f!==u&&(!c||c.indexOf(f)<0))return!0;return!1},zt.prototype.handleWindowEvent=function(s){this.handleEvent(s,s.type+"Window")},zt.prototype._getMapTouches=function(s){for(var c=[],u=0,f=s;u<f.length;u+=1){var T=f[u];this._el.contains(T.target)&&c.push(T)}return c},zt.prototype.handleEvent=function(s,c){this._updatingCamera=!0;for(var u=s.type==="renderFrame"?void 0:s,f={needsRenderFrame:!1},T={},P={},M=s.touches?this._getMapTouches(s.touches):void 0,F=M?Z.touchPos(this._el,M):Z.mousePos(this._el,s),X=0,Y=this._handlers;X<Y.length;X+=1){var le=Y[X],ce=le.handlerName,de=le.handler,Ce=le.allowed;if(de.isEnabled()){var Ae=void 0;this._blockedByActive(P,Ce,ce)?de.reset():de[c||s.type]&&(Ae=de[c||s.type](s,F,M),this.mergeHandlerResult(f,T,Ae,ce,u),Ae&&Ae.needsRenderFrame&&this._triggerRenderFrame()),(Ae||de.isActive())&&(P[ce]=de)}}var ke={};for(var xe in this._previousActiveHandlers)P[xe]||(ke[xe]=u);this._previousActiveHandlers=P,(Object.keys(ke).length||Pt(f))&&(this._changes.push([f,T,ke]),this._triggerRenderFrame()),(Object.keys(P).length||Pt(f))&&this._map._stop(!0),this._updatingCamera=!1;var ze=f.cameraAnimation;ze&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ze(this._map))},zt.prototype.mergeHandlerResult=function(s,c,u,f,T){if(u){m.extend(s,u);var P={handlerName:f,originalEvent:u.originalEvent||T};u.zoomDelta!==void 0&&(c.zoom=P),u.panDelta!==void 0&&(c.drag=P),u.pitchDelta!==void 0&&(c.pitch=P),u.bearingDelta!==void 0&&(c.rotate=P)}},zt.prototype._applyChanges=function(){for(var s={},c={},u={},f=0,T=this._changes;f<T.length;f+=1){var P=T[f],M=P[0],F=P[1],X=P[2];M.panDelta&&(s.panDelta=(s.panDelta||new m.Point(0,0))._add(M.panDelta)),M.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+M.zoomDelta),M.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+M.bearingDelta),M.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+M.pitchDelta),M.around!==void 0&&(s.around=M.around),M.pinchAround!==void 0&&(s.pinchAround=M.pinchAround),M.noInertia&&(s.noInertia=M.noInertia),m.extend(c,F),m.extend(u,X)}this._updateMapTransform(s,c,u),this._changes=[]},zt.prototype._updateMapTransform=function(s,c,u){var f=this._map,T=f.transform;if(!Pt(s))return this._fireEvents(c,u,!0);var P=s.panDelta,M=s.zoomDelta,F=s.bearingDelta,X=s.pitchDelta,Y=s.around,le=s.pinchAround;le!==void 0&&(Y=le),f._stop(!0),Y=Y||f.transform.centerPoint;var ce=T.pointLocation(P?Y.sub(P):Y);F&&(T.bearing+=F),X&&(T.pitch+=X),M&&(T.zoom+=M),T.setLocationAtPoint(ce,Y),this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(c,u,!0)},zt.prototype._fireEvents=function(s,c,u){var f=this,T=Zn(this._eventsInProgress),P=Zn(s),M={};for(var F in s)this._eventsInProgress[F]||(M[F+"start"]=s[F].originalEvent),this._eventsInProgress[F]=s[F];for(var X in!T&&P&&this._fireEvent("movestart",P.originalEvent),M)this._fireEvent(X,M[X]);for(var Y in P&&this._fireEvent("move",P.originalEvent),s)this._fireEvent(Y,s[Y].originalEvent);var le,ce={};for(var de in this._eventsInProgress){var Ce=this._eventsInProgress[de],Ae=Ce.handlerName,ke=Ce.originalEvent;this._handlersById[Ae].isActive()||(delete this._eventsInProgress[de],ce[de+"end"]=le=c[Ae]||ke)}for(var xe in ce)this._fireEvent(xe,ce[xe]);var ze=Zn(this._eventsInProgress);if(u&&(T||P)&&!ze){this._updatingCamera=!0;var Be=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Ge=function(Je){return Je!==0&&-f._bearingSnap<Je&&Je<f._bearingSnap};Be?(Ge(Be.bearing||this._map.getBearing())&&(Be.bearing=0),this._map.easeTo(Be,{originalEvent:le})):(this._map.fire(new m.Event("moveend",{originalEvent:le})),Ge(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},zt.prototype._fireEvent=function(s,c){this._map.fire(new m.Event(s,c?{originalEvent:c}:{}))},zt.prototype._requestFrame=function(){var s=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(c){delete s._frameId,s.handleEvent(new Ia("renderFrame",{timeStamp:c})),s._applyChanges()})},zt.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var ul=function(s){function c(u,f){s.call(this),this._moving=!1,this._zooming=!1,this.transform=u,this._bearingSnap=f.bearingSnap,m.bindAll(["_renderFrameCallback"],this)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getCenter=function(){return new m.LngLat(this.transform.center.lng,this.transform.center.lat)},c.prototype.setCenter=function(u,f){return this.jumpTo({center:u},f)},c.prototype.panBy=function(u,f,T){return u=m.Point.convert(u).mult(-1),this.panTo(this.transform.center,m.extend({offset:u},f),T)},c.prototype.panTo=function(u,f,T){return this.easeTo(m.extend({center:u},f),T)},c.prototype.getZoom=function(){return this.transform.zoom},c.prototype.setZoom=function(u,f){return this.jumpTo({zoom:u},f),this},c.prototype.zoomTo=function(u,f,T){return this.easeTo(m.extend({zoom:u},f),T)},c.prototype.zoomIn=function(u,f){return this.zoomTo(this.getZoom()+1,u,f),this},c.prototype.zoomOut=function(u,f){return this.zoomTo(this.getZoom()-1,u,f),this},c.prototype.getBearing=function(){return this.transform.bearing},c.prototype.setBearing=function(u,f){return this.jumpTo({bearing:u},f),this},c.prototype.getPadding=function(){return this.transform.padding},c.prototype.setPadding=function(u,f){return this.jumpTo({padding:u},f),this},c.prototype.rotateTo=function(u,f,T){return this.easeTo(m.extend({bearing:u},f),T)},c.prototype.resetNorth=function(u,f){return this.rotateTo(0,m.extend({duration:1e3},u),f),this},c.prototype.resetNorthPitch=function(u,f){return this.easeTo(m.extend({bearing:0,pitch:0,duration:1e3},u),f),this},c.prototype.snapToNorth=function(u,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(u,f):this},c.prototype.getPitch=function(){return this.transform.pitch},c.prototype.setPitch=function(u,f){return this.jumpTo({pitch:u},f),this},c.prototype.cameraForBounds=function(u,f){u=m.LngLatBounds.convert(u);var T=f&&f.bearing||0;return this._cameraForBoxAndBearing(u.getNorthWest(),u.getSouthEast(),T,f)},c.prototype._cameraForBoxAndBearing=function(u,f,T,P){var M={top:0,bottom:0,right:0,left:0};if(typeof(P=m.extend({padding:M,offset:[0,0],maxZoom:this.transform.maxZoom},P)).padding=="number"){var F=P.padding;P.padding={top:F,bottom:F,right:F,left:F}}P.padding=m.extend(M,P.padding);var X=this.transform,Y=X.padding,le=X.project(m.LngLat.convert(u)),ce=X.project(m.LngLat.convert(f)),de=le.rotate(-T*Math.PI/180),Ce=ce.rotate(-T*Math.PI/180),Ae=new m.Point(Math.max(de.x,Ce.x),Math.max(de.y,Ce.y)),ke=new m.Point(Math.min(de.x,Ce.x),Math.min(de.y,Ce.y)),xe=Ae.sub(ke),ze=(X.width-(Y.left+Y.right+P.padding.left+P.padding.right))/xe.x,Be=(X.height-(Y.top+Y.bottom+P.padding.top+P.padding.bottom))/xe.y;if(!(Be<0||ze<0)){var Ge=Math.min(X.scaleZoom(X.scale*Math.min(ze,Be)),P.maxZoom),Je=typeof P.offset.x=="number"?new m.Point(P.offset.x,P.offset.y):m.Point.convert(P.offset),Ye=new m.Point((P.padding.left-P.padding.right)/2,(P.padding.top-P.padding.bottom)/2).rotate(T*Math.PI/180),Qe=Je.add(Ye).mult(X.scale/X.zoomScale(Ge));return{center:X.unproject(le.add(ce).div(2).sub(Qe)),zoom:Ge,bearing:T}}m.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},c.prototype.fitBounds=function(u,f,T){return this._fitInternal(this.cameraForBounds(u,f),f,T)},c.prototype.fitScreenCoordinates=function(u,f,T,P,M){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(m.Point.convert(u)),this.transform.pointLocation(m.Point.convert(f)),T,P),P,M)},c.prototype._fitInternal=function(u,f,T){return u?(delete(f=m.extend(u,f)).padding,f.linear?this.easeTo(f,T):this.flyTo(f,T)):this},c.prototype.jumpTo=function(u,f){this.stop();var T=this.transform,P=!1,M=!1,F=!1;return"zoom"in u&&T.zoom!==+u.zoom&&(P=!0,T.zoom=+u.zoom),u.center!==void 0&&(T.center=m.LngLat.convert(u.center)),"bearing"in u&&T.bearing!==+u.bearing&&(M=!0,T.bearing=+u.bearing),"pitch"in u&&T.pitch!==+u.pitch&&(F=!0,T.pitch=+u.pitch),u.padding==null||T.isPaddingEqual(u.padding)||(T.padding=u.padding),this.fire(new m.Event("movestart",f)).fire(new m.Event("move",f)),P&&this.fire(new m.Event("zoomstart",f)).fire(new m.Event("zoom",f)).fire(new m.Event("zoomend",f)),M&&this.fire(new m.Event("rotatestart",f)).fire(new m.Event("rotate",f)).fire(new m.Event("rotateend",f)),F&&this.fire(new m.Event("pitchstart",f)).fire(new m.Event("pitch",f)).fire(new m.Event("pitchend",f)),this.fire(new m.Event("moveend",f))},c.prototype.easeTo=function(u,f){var T=this;this._stop(!1,u.easeId),((u=m.extend({offset:[0,0],duration:500,easing:m.ease},u)).animate===!1||!u.essential&&m.browser.prefersReducedMotion)&&(u.duration=0);var P=this.transform,M=this.getZoom(),F=this.getBearing(),X=this.getPitch(),Y=this.getPadding(),le="zoom"in u?+u.zoom:M,ce="bearing"in u?this._normalizeBearing(u.bearing,F):F,de="pitch"in u?+u.pitch:X,Ce="padding"in u?u.padding:P.padding,Ae=m.Point.convert(u.offset),ke=P.centerPoint.add(Ae),xe=P.pointLocation(ke),ze=m.LngLat.convert(u.center||xe);this._normalizeCenter(ze);var Be,Ge,Je=P.project(xe),Ye=P.project(ze).sub(Je),Qe=P.zoomScale(le-M);u.around&&(Be=m.LngLat.convert(u.around),Ge=P.locationPoint(Be));var ht={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||le!==M,this._rotating=this._rotating||F!==ce,this._pitching=this._pitching||de!==X,this._padding=!P.isPaddingEqual(Ce),this._easeId=u.easeId,this._prepareEase(f,u.noMoveStart,ht),this._ease(function(bt){if(T._zooming&&(P.zoom=m.number(M,le,bt)),T._rotating&&(P.bearing=m.number(F,ce,bt)),T._pitching&&(P.pitch=m.number(X,de,bt)),T._padding&&(P.interpolatePadding(Y,Ce,bt),ke=P.centerPoint.add(Ae)),Be)P.setLocationAtPoint(Be,Ge);else{var xt=P.zoomScale(P.zoom-M),Dt=le>M?Math.min(2,Qe):Math.max(.5,Qe),Yt=Math.pow(Dt,1-bt),ti=P.unproject(Je.add(Ye.mult(bt*Yt)).mult(xt));P.setLocationAtPoint(P.renderWorldCopies?ti.wrap():ti,ke)}T._fireMoveEvents(f)},function(bt){T._afterEase(f,bt)},u),this},c.prototype._prepareEase=function(u,f,T){T===void 0&&(T={}),this._moving=!0,f||T.moving||this.fire(new m.Event("movestart",u)),this._zooming&&!T.zooming&&this.fire(new m.Event("zoomstart",u)),this._rotating&&!T.rotating&&this.fire(new m.Event("rotatestart",u)),this._pitching&&!T.pitching&&this.fire(new m.Event("pitchstart",u))},c.prototype._fireMoveEvents=function(u){this.fire(new m.Event("move",u)),this._zooming&&this.fire(new m.Event("zoom",u)),this._rotating&&this.fire(new m.Event("rotate",u)),this._pitching&&this.fire(new m.Event("pitch",u))},c.prototype._afterEase=function(u,f){if(!this._easeId||!f||this._easeId!==f){delete this._easeId;var T=this._zooming,P=this._rotating,M=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,T&&this.fire(new m.Event("zoomend",u)),P&&this.fire(new m.Event("rotateend",u)),M&&this.fire(new m.Event("pitchend",u)),this.fire(new m.Event("moveend",u))}},c.prototype.flyTo=function(u,f){var T=this;if(!u.essential&&m.browser.prefersReducedMotion){var P=m.pick(u,["center","zoom","bearing","pitch","around"]);return this.jumpTo(P,f)}this.stop(),u=m.extend({offset:[0,0],speed:1.2,curve:1.42,easing:m.ease},u);var M=this.transform,F=this.getZoom(),X=this.getBearing(),Y=this.getPitch(),le=this.getPadding(),ce="zoom"in u?m.clamp(+u.zoom,M.minZoom,M.maxZoom):F,de="bearing"in u?this._normalizeBearing(u.bearing,X):X,Ce="pitch"in u?+u.pitch:Y,Ae="padding"in u?u.padding:M.padding,ke=M.zoomScale(ce-F),xe=m.Point.convert(u.offset),ze=M.centerPoint.add(xe),Be=M.pointLocation(ze),Ge=m.LngLat.convert(u.center||Be);this._normalizeCenter(Ge);var Je=M.project(Be),Ye=M.project(Ge).sub(Je),Qe=u.curve,ht=Math.max(M.width,M.height),bt=ht/ke,xt=Ye.mag();if("minZoom"in u){var Dt=m.clamp(Math.min(u.minZoom,F,ce),M.minZoom,M.maxZoom),Yt=ht/M.zoomScale(Dt-F);Qe=Math.sqrt(Yt/xt*2)}var ti=Qe*Qe;function Jt(ri){var ei=(bt*bt-ht*ht+(ri?-1:1)*ti*ti*xt*xt)/(2*(ri?bt:ht)*ti*xt);return Math.log(Math.sqrt(ei*ei+1)-ei)}function Mi(ri){return(Math.exp(ri)-Math.exp(-ri))/2}function Nt(ri){return(Math.exp(ri)+Math.exp(-ri))/2}var fi=Jt(0),Ci=function(ri){return Nt(fi)/Nt(fi+Qe*ri)},pi=function(ri){return ht*((Nt(fi)*(Mi(ei=fi+Qe*ri)/Nt(ei))-Mi(fi))/ti)/xt;var ei},li=(Jt(1)-fi)/Qe;if(Math.abs(xt)<1e-6||!isFinite(li)){if(Math.abs(ht-bt)<1e-6)return this.easeTo(u,f);var _i=bt<ht?-1:1;li=Math.abs(Math.log(bt/ht))/Qe,pi=function(){return 0},Ci=function(ri){return Math.exp(_i*Qe*ri)}}return u.duration="duration"in u?+u.duration:1e3*li/("screenSpeed"in u?+u.screenSpeed/Qe:+u.speed),u.maxDuration&&u.duration>u.maxDuration&&(u.duration=0),this._zooming=!0,this._rotating=X!==de,this._pitching=Ce!==Y,this._padding=!M.isPaddingEqual(Ae),this._prepareEase(f,!1),this._ease(function(ri){var ei=ri*li,Ar=1/Ci(ei);M.zoom=ri===1?ce:F+M.scaleZoom(Ar),T._rotating&&(M.bearing=m.number(X,de,ri)),T._pitching&&(M.pitch=m.number(Y,Ce,ri)),T._padding&&(M.interpolatePadding(le,Ae,ri),ze=M.centerPoint.add(xe));var Ur=ri===1?Ge:M.unproject(Je.add(Ye.mult(pi(ei))).mult(Ar));M.setLocationAtPoint(M.renderWorldCopies?Ur.wrap():Ur,ze),T._fireMoveEvents(f)},function(){return T._afterEase(f)},u),this},c.prototype.isEasing=function(){return!!this._easeFrameId},c.prototype.stop=function(){return this._stop()},c.prototype._stop=function(u,f){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var T=this._onEaseEnd;delete this._onEaseEnd,T.call(this,f)}if(!u){var P=this.handlers;P&&P.stop(!1)}return this},c.prototype._ease=function(u,f,T){T.animate===!1||T.duration===0?(u(1),f()):(this._easeStart=m.browser.now(),this._easeOptions=T,this._onEaseFrame=u,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},c.prototype._renderFrameCallback=function(){var u=Math.min((m.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(u)),u<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},c.prototype._normalizeBearing=function(u,f){u=m.wrap(u,-180,180);var T=Math.abs(u-f);return Math.abs(u-360-f)<T&&(u-=360),Math.abs(u+360-f)<T&&(u+=360),u},c.prototype._normalizeCenter=function(u){var f=this.transform;if(f.renderWorldCopies&&!f.lngRange){var T=u.lng-f.center.lng;u.lng+=T>180?-360:T<-180?360:0}},c}(m.Evented),Yr=function(s){s===void 0&&(s={}),this.options=s,m.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};Yr.prototype.getDefaultPosition=function(){return"bottom-right"},Yr.prototype.onAdd=function(s){var c=this.options&&this.options.compact;return this._map=s,this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Z.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Z.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},Yr.prototype.onRemove=function(){Z.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},Yr.prototype._setElementTitle=function(s,c){var u=this._map._getUIString("AttributionControl."+c);s.title=u,s.setAttribute("aria-label",u)},Yr.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},Yr.prototype._updateEditLink=function(){var s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));var c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||m.config.ACCESS_TOKEN}];if(s){var u=c.reduce(function(f,T,P){return T.value&&(f+=T.key+"="+T.value+(P<c.length-1?"&":"")),f},"?");s.href=m.config.FEEDBACK_URL+"/"+u+(this._map._hash?this._map._hash.getHashString(!0):""),s.rel="noopener nofollow",this._setElementTitle(s,"MapFeedback")}},Yr.prototype._updateData=function(s){!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},Yr.prototype._updateAttributions=function(){if(this._map.style){var s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map(function(F){return typeof F!="string"?"":F})):typeof this.options.customAttribution=="string"&&s.push(this.options.customAttribution)),this._map.style.stylesheet){var c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}var u=this._map.style.sourceCaches;for(var f in u){var T=u[f];if(T.used){var P=T.getSource();P.attribution&&s.indexOf(P.attribution)<0&&s.push(P.attribution)}}s.sort(function(F,X){return F.length-X.length});var M=(s=s.filter(function(F,X){for(var Y=X+1;Y<s.length;Y++)if(s[Y].indexOf(F)>=0)return!1;return!0})).join(" | ");M!==this._attribHTML&&(this._attribHTML=M,s.length?(this._innerContainer.innerHTML=M,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},Yr.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Yn=function(){m.bindAll(["_updateLogo"],this),m.bindAll(["_updateCompact"],this)};Yn.prototype.onAdd=function(s){this._map=s,this._container=Z.create("div","mapboxgl-ctrl");var c=Z.create("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Yn.prototype.onRemove=function(){Z.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Yn.prototype.getDefaultPosition=function(){return"bottom-left"},Yn.prototype._updateLogo=function(s){s&&s.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Yn.prototype._logoRequired=function(){if(this._map.style){var s=this._map.style.sourceCaches;for(var c in s)if(s[c].getSource().mapbox_logo)return!0;return!1}},Yn.prototype._updateCompact=function(){var s=this._container.children;if(s.length){var c=s[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}};var b=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};b.prototype.add=function(s){var c=++this._id;return this._queue.push({callback:s,id:c,cancelled:!1}),c},b.prototype.remove=function(s){for(var c=this._currentlyRunning,u=0,f=c?this._queue.concat(c):this._queue;u<f.length;u+=1){var T=f[u];if(T.id===s)return void(T.cancelled=!0)}},b.prototype.run=function(s){s===void 0&&(s=0);var c=this._currentlyRunning=this._queue;this._queue=[];for(var u=0,f=c;u<f.length;u+=1){var T=f[u];if(!T.cancelled&&(T.callback(s),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},b.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var n={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},h=m.window.HTMLImageElement,x=m.window.HTMLElement,E=m.window.ImageBitmap,z={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},R=function(s){function c(f){var T=this;if((f=m.extend({},z,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var P=new Ii(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies);if(s.call(this,P,f),this._interactive=f.interactive,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._crossSourceCollisions=f.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=f.collectResourceTiming,this._renderTaskQueue=new b,this._controls=[],this._mapId=m.uniqueId(),this._locale=m.extend({},n,f.locale),this._clickTolerance=f.clickTolerance,this._requestManager=new m.RequestManager(f.transformRequest,f.accessToken),typeof f.container=="string"){if(this._container=m.window.document.getElementById(f.container),!this._container)throw new Error("Container '"+f.container+"' not found.")}else{if(!(f.container instanceof x))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(f.maxBounds&&this.setMaxBounds(f.maxBounds),m.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return T._update(!1)}),this.on("moveend",function(){return T._update(!1)}),this.on("zoom",function(){return T._update(!0)}),m.window!==void 0&&(m.window.addEventListener("online",this._onWindowOnline,!1),m.window.addEventListener("resize",this._onWindowResize,!1),m.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new zt(this,f),this._hash=f.hash&&new Lt(typeof f.hash=="string"&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,m.extend({},f.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=f.localIdeographFontFamily,f.style&&this.setStyle(f.style,{localIdeographFontFamily:f.localIdeographFontFamily}),f.attributionControl&&this.addControl(new Yr({customAttribution:f.customAttribution})),this.addControl(new Yn,f.logoPosition),this.on("style.load",function(){T.transform.unmodified&&T.jumpTo(T.style.stylesheet)}),this.on("data",function(M){T._update(M.dataType==="style"),T.fire(new m.Event(M.dataType+"data",M))}),this.on("dataloading",function(M){T.fire(new m.Event(M.dataType+"dataloading",M))})}s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c;var u={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return c.prototype._getMapId=function(){return this._mapId},c.prototype.addControl=function(f,T){if(T===void 0&&(T=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var P=f.onAdd(this);this._controls.push(f);var M=this._controlPositions[T];return T.indexOf("bottom")!==-1?M.insertBefore(P,M.firstChild):M.appendChild(P),this},c.prototype.removeControl=function(f){if(!f||!f.onRemove)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var T=this._controls.indexOf(f);return T>-1&&this._controls.splice(T,1),f.onRemove(this),this},c.prototype.hasControl=function(f){return this._controls.indexOf(f)>-1},c.prototype.resize=function(f){var T=this._containerDimensions(),P=T[0],M=T[1];if(P===this.transform.width&&M===this.transform.height)return this;this._resizeCanvas(P,M),this.transform.resize(P,M),this.painter.resize(P,M);var F=!this._moving;return F&&this.fire(new m.Event("movestart",f)).fire(new m.Event("move",f)),this.fire(new m.Event("resize",f)),F&&this.fire(new m.Event("moveend",f)),this},c.prototype.getBounds=function(){return this.transform.getBounds()},c.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},c.prototype.setMaxBounds=function(f){return this.transform.setMaxBounds(m.LngLatBounds.convert(f)),this._update()},c.prototype.setMinZoom=function(f){if((f=f==null?-2:f)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f&&this.setZoom(f),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},c.prototype.getMinZoom=function(){return this.transform.minZoom},c.prototype.setMaxZoom=function(f){if((f=f==null?22:f)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f&&this.setZoom(f),this;throw new Error("maxZoom must be greater than the current minZoom")},c.prototype.getMaxZoom=function(){return this.transform.maxZoom},c.prototype.setMinPitch=function(f){if((f=f==null?0:f)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f&&this.setPitch(f),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},c.prototype.getMinPitch=function(){return this.transform.minPitch},c.prototype.setMaxPitch=function(f){if((f=f==null?60:f)>60)throw new Error("maxPitch must be less than or equal to 60");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f&&this.setPitch(f),this;throw new Error("maxPitch must be greater than the current minPitch")},c.prototype.getMaxPitch=function(){return this.transform.maxPitch},c.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},c.prototype.setRenderWorldCopies=function(f){return this.transform.renderWorldCopies=f,this._update()},c.prototype.project=function(f){return this.transform.locationPoint(m.LngLat.convert(f))},c.prototype.unproject=function(f){return this.transform.pointLocation(m.Point.convert(f))},c.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},c.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},c.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},c.prototype._createDelegatedListener=function(f,T,P){var M,F=this;if(f==="mouseenter"||f==="mouseover"){var X=!1;return{layer:T,listener:P,delegates:{mousemove:function(le){var ce=F.getLayer(T)?F.queryRenderedFeatures(le.point,{layers:[T]}):[];ce.length?X||(X=!0,P.call(F,new Er(f,F,le.originalEvent,{features:ce}))):X=!1},mouseout:function(){X=!1}}}}if(f==="mouseleave"||f==="mouseout"){var Y=!1;return{layer:T,listener:P,delegates:{mousemove:function(le){(F.getLayer(T)?F.queryRenderedFeatures(le.point,{layers:[T]}):[]).length?Y=!0:Y&&(Y=!1,P.call(F,new Er(f,F,le.originalEvent)))},mouseout:function(le){Y&&(Y=!1,P.call(F,new Er(f,F,le.originalEvent)))}}}}return{layer:T,listener:P,delegates:(M={},M[f]=function(le){var ce=F.getLayer(T)?F.queryRenderedFeatures(le.point,{layers:[T]}):[];ce.length&&(le.features=ce,P.call(F,le),delete le.features)},M)}},c.prototype.on=function(f,T,P){if(P===void 0)return s.prototype.on.call(this,f,T);var M=this._createDelegatedListener(f,T,P);for(var F in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(M),M.delegates)this.on(F,M.delegates[F]);return this},c.prototype.once=function(f,T,P){if(P===void 0)return s.prototype.once.call(this,f,T);var M=this._createDelegatedListener(f,T,P);for(var F in M.delegates)this.once(F,M.delegates[F]);return this},c.prototype.off=function(f,T,P){var M=this;return P===void 0?s.prototype.off.call(this,f,T):(this._delegatedListeners&&this._delegatedListeners[f]&&function(F){for(var X=F[f],Y=0;Y<X.length;Y++){var le=X[Y];if(le.layer===T&&le.listener===P){for(var ce in le.delegates)M.off(ce,le.delegates[ce]);return X.splice(Y,1),M}}}(this._delegatedListeners),this)},c.prototype.queryRenderedFeatures=function(f,T){if(!this.style)return[];var P;if(T!==void 0||f===void 0||f instanceof m.Point||Array.isArray(f)||(T=f,f=void 0),T=T||{},(f=f||[[0,0],[this.transform.width,this.transform.height]])instanceof m.Point||typeof f[0]=="number")P=[m.Point.convert(f)];else{var M=m.Point.convert(f[0]),F=m.Point.convert(f[1]);P=[M,new m.Point(F.x,M.y),F,new m.Point(M.x,F.y),M]}return this.style.queryRenderedFeatures(P,T,this.transform)},c.prototype.querySourceFeatures=function(f,T){return this.style.querySourceFeatures(f,T)},c.prototype.setStyle=function(f,T){return(T=m.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},T)).diff!==!1&&T.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&f?(this._diffStyle(f,T),this):(this._localIdeographFontFamily=T.localIdeographFontFamily,this._updateStyle(f,T))},c.prototype._getUIString=function(f){var T=this._locale[f];if(T==null)throw new Error("Missing UI string '"+f+"'");return T},c.prototype._updateStyle=function(f,T){return this.style&&(this.style.setEventedParent(null),this.style._remove()),f?(this.style=new An(this,T||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f):this.style.loadJSON(f),this):(delete this.style,this)},c.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new An(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},c.prototype._diffStyle=function(f,T){var P=this;if(typeof f=="string"){var M=this._requestManager.normalizeStyleURL(f),F=this._requestManager.transformRequest(M,m.ResourceType.Style);m.getJSON(F,function(X,Y){X?P.fire(new m.ErrorEvent(X)):Y&&P._updateDiff(Y,T)})}else typeof f=="object"&&this._updateDiff(f,T)},c.prototype._updateDiff=function(f,T){try{this.style.setState(f)&&this._update(!0)}catch(P){m.warnOnce("Unable to perform style diff: "+(P.message||P.error||P)+".  Rebuilding the style from scratch."),this._updateStyle(f,T)}},c.prototype.getStyle=function(){if(this.style)return this.style.serialize()},c.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():m.warnOnce("There is no style added to the map.")},c.prototype.addSource=function(f,T){return this._lazyInitEmptyStyle(),this.style.addSource(f,T),this._update(!0)},c.prototype.isSourceLoaded=function(f){var T=this.style&&this.style.sourceCaches[f];if(T!==void 0)return T.loaded();this.fire(new m.ErrorEvent(new Error("There is no source with ID '"+f+"'")))},c.prototype.areTilesLoaded=function(){var f=this.style&&this.style.sourceCaches;for(var T in f){var P=f[T]._tiles;for(var M in P){var F=P[M];if(F.state!=="loaded"&&F.state!=="errored")return!1}}return!0},c.prototype.addSourceType=function(f,T,P){return this._lazyInitEmptyStyle(),this.style.addSourceType(f,T,P)},c.prototype.removeSource=function(f){return this.style.removeSource(f),this._update(!0)},c.prototype.getSource=function(f){return this.style.getSource(f)},c.prototype.addImage=function(f,T,P){P===void 0&&(P={});var M=P.pixelRatio;M===void 0&&(M=1);var F=P.sdf;F===void 0&&(F=!1);var X=P.stretchX,Y=P.stretchY,le=P.content;if(this._lazyInitEmptyStyle(),T instanceof h||E&&T instanceof E){var ce=m.browser.getImageData(T);this.style.addImage(f,{data:new m.RGBAImage({width:ce.width,height:ce.height},ce.data),pixelRatio:M,stretchX:X,stretchY:Y,content:le,sdf:F,version:0})}else{if(T.width===void 0||T.height===void 0)return this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var de=T;this.style.addImage(f,{data:new m.RGBAImage({width:T.width,height:T.height},new Uint8Array(T.data)),pixelRatio:M,stretchX:X,stretchY:Y,content:le,sdf:F,version:0,userImage:de}),de.onAdd&&de.onAdd(this,f)}},c.prototype.updateImage=function(f,T){var P=this.style.getImage(f);if(!P)return this.fire(new m.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var M=T instanceof h||E&&T instanceof E?m.browser.getImageData(T):T,F=M.width,X=M.height,Y=M.data;return F===void 0||X===void 0?this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):F!==P.data.width||X!==P.data.height?this.fire(new m.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(P.data.replace(Y,!(T instanceof h||E&&T instanceof E)),void this.style.updateImage(f,P))},c.prototype.hasImage=function(f){return f?!!this.style.getImage(f):(this.fire(new m.ErrorEvent(new Error("Missing required image id"))),!1)},c.prototype.removeImage=function(f){this.style.removeImage(f)},c.prototype.loadImage=function(f,T){m.getImage(this._requestManager.transformRequest(f,m.ResourceType.Image),T)},c.prototype.listImages=function(){return this.style.listImages()},c.prototype.addLayer=function(f,T){return this._lazyInitEmptyStyle(),this.style.addLayer(f,T),this._update(!0)},c.prototype.moveLayer=function(f,T){return this.style.moveLayer(f,T),this._update(!0)},c.prototype.removeLayer=function(f){return this.style.removeLayer(f),this._update(!0)},c.prototype.getLayer=function(f){return this.style.getLayer(f)},c.prototype.setLayerZoomRange=function(f,T,P){return this.style.setLayerZoomRange(f,T,P),this._update(!0)},c.prototype.setFilter=function(f,T,P){return P===void 0&&(P={}),this.style.setFilter(f,T,P),this._update(!0)},c.prototype.getFilter=function(f){return this.style.getFilter(f)},c.prototype.setPaintProperty=function(f,T,P,M){return M===void 0&&(M={}),this.style.setPaintProperty(f,T,P,M),this._update(!0)},c.prototype.getPaintProperty=function(f,T){return this.style.getPaintProperty(f,T)},c.prototype.setLayoutProperty=function(f,T,P,M){return M===void 0&&(M={}),this.style.setLayoutProperty(f,T,P,M),this._update(!0)},c.prototype.getLayoutProperty=function(f,T){return this.style.getLayoutProperty(f,T)},c.prototype.setLight=function(f,T){return T===void 0&&(T={}),this._lazyInitEmptyStyle(),this.style.setLight(f,T),this._update(!0)},c.prototype.getLight=function(){return this.style.getLight()},c.prototype.setFeatureState=function(f,T){return this.style.setFeatureState(f,T),this._update()},c.prototype.removeFeatureState=function(f,T){return this.style.removeFeatureState(f,T),this._update()},c.prototype.getFeatureState=function(f){return this.style.getFeatureState(f)},c.prototype.getContainer=function(){return this._container},c.prototype.getCanvasContainer=function(){return this._canvasContainer},c.prototype.getCanvas=function(){return this._canvas},c.prototype._containerDimensions=function(){var f=0,T=0;return this._container&&(f=this._container.clientWidth||400,T=this._container.clientHeight||300),[f,T]},c.prototype._detectMissingCSS=function(){m.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&m.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},c.prototype._setupContainer=function(){var f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=Z.create("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();var T=this._canvasContainer=Z.create("div","mapboxgl-canvas-container",f);this._interactive&&T.classList.add("mapboxgl-interactive"),this._canvas=Z.create("canvas","mapboxgl-canvas",T),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var P=this._containerDimensions();this._resizeCanvas(P[0],P[1]);var M=this._controlContainer=Z.create("div","mapboxgl-control-container",f),F=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(X){F[X]=Z.create("div","mapboxgl-ctrl-"+X,M)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},c.prototype._resizeCanvas=function(f,T){var P=m.browser.devicePixelRatio||1;this._canvas.width=P*f,this._canvas.height=P*T,this._canvas.style.width=f+"px",this._canvas.style.height=T+"px"},c.prototype._setupPainter=function(){var f=m.extend({},g.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),T=this._canvas.getContext("webgl",f)||this._canvas.getContext("experimental-webgl",f);T?(this.painter=new _r(T,this.transform),m.webpSupported.testSupport(T)):this.fire(new m.ErrorEvent(new Error("Failed to initialize WebGL")))},c.prototype._contextLost=function(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new m.Event("webglcontextlost",{originalEvent:f}))},c.prototype._contextRestored=function(f){this._setupPainter(),this.resize(),this._update(),this.fire(new m.Event("webglcontextrestored",{originalEvent:f}))},c.prototype._onMapScroll=function(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},c.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},c.prototype._update=function(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this},c.prototype._requestRenderFrame=function(f){return this._update(),this._renderTaskQueue.add(f)},c.prototype._cancelRenderFrame=function(f){this._renderTaskQueue.remove(f)},c.prototype._render=function(f){var T,P=this,M=0,F=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(T=F.createQueryEXT(),F.beginQueryEXT(F.TIME_ELAPSED_EXT,T),M=m.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),!this._removed){var X=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var Y=this.transform.zoom,le=m.browser.now();this.style.zoomHistory.update(Y,le);var ce=new m.EvaluationParameters(Y,{now:le,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),de=ce.crossFadingFactor();de===1&&de===this._crossFadingFactor||(X=!0,this._crossFadingFactor=de),this.style.update(ce)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new m.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new m.Event("load"))),this.style&&(this.style.hasTransitions()||X)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Ce=m.browser.now()-M;F.endQueryEXT(F.TIME_ELAPSED_EXT,T),setTimeout(function(){var xe=F.getQueryObjectEXT(T,F.QUERY_RESULT_EXT)/1e6;F.deleteQueryEXT(T),P.fire(new m.Event("gpu-timing-frame",{cpuTime:Ce,gpuTime:xe}))},50)}if(this.listens("gpu-timing-layer")){var Ae=this.painter.collectGpuTimers();setTimeout(function(){var xe=P.painter.queryGpuTimers(Ae);P.fire(new m.Event("gpu-timing-layer",{layerTimes:xe}))},50)}var ke=this._sourcesDirty||this._styleDirty||this._placementDirty;return ke||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new m.Event("idle")),!this._loaded||this._fullyLoaded||ke||(this._fullyLoaded=!0),this}},c.prototype.remove=function(){this._hash&&this._hash.remove();for(var f=0,T=this._controls;f<T.length;f+=1)T[f].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),m.window!==void 0&&(m.window.removeEventListener("resize",this._onWindowResize,!1),m.window.removeEventListener("orientationchange",this._onWindowResize,!1),m.window.removeEventListener("online",this._onWindowOnline,!1));var P=this.painter.context.gl.getExtension("WEBGL_lose_context");P&&P.loseContext(),V(this._canvasContainer),V(this._controlContainer),V(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new m.Event("remove"))},c.prototype.triggerRepaint=function(){var f=this;this.style&&!this._frame&&(this._frame=m.browser.frame(function(T){f._frame=null,f._render(T)}))},c.prototype._onWindowOnline=function(){this._update()},c.prototype._onWindowResize=function(f){this._trackResize&&this.resize({originalEvent:f})._update()},u.showTileBoundaries.get=function(){return!!this._showTileBoundaries},u.showTileBoundaries.set=function(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())},u.showPadding.get=function(){return!!this._showPadding},u.showPadding.set=function(f){this._showPadding!==f&&(this._showPadding=f,this._update())},u.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},u.showCollisionBoxes.set=function(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())},u.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},u.showOverdrawInspector.set=function(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())},u.repaint.get=function(){return!!this._repaint},u.repaint.set=function(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())},u.vertices.get=function(){return!!this._vertices},u.vertices.set=function(f){this._vertices=f,this._update()},c.prototype._setCacheLimits=function(f,T){m.setCacheLimits(f,T)},u.version.get=function(){return m.version},Object.defineProperties(c.prototype,u),c}(ul);function V(s){s.parentNode&&s.parentNode.removeChild(s)}var G={showCompass:!0,showZoom:!0,visualizePitch:!1},K=function(s){var c=this;this.options=m.extend({},G,s),this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(u){return u.preventDefault()}),this.options.showZoom&&(m.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(u){return c._map.zoomIn({},{originalEvent:u})}),Z.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(u){return c._map.zoomOut({},{originalEvent:u})}),Z.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(m.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(u){c.options.visualizePitch?c._map.resetNorthPitch({},{originalEvent:u}):c._map.resetNorth({},{originalEvent:u})}),this._compassIcon=Z.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};K.prototype._updateZoomButtons=function(){var s=this._map.getZoom(),c=s===this._map.getMaxZoom(),u=s===this._map.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},K.prototype._rotateCompassArrow=function(){var s=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=s},K.prototype.onAdd=function(s){return this._map=s,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Q(this._map,this._compass,this.options.visualizePitch)),this._container},K.prototype.onRemove=function(){Z.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},K.prototype._createButton=function(s,c){var u=Z.create("button",s,this._container);return u.type="button",u.addEventListener("click",c),u},K.prototype._setButtonTitle=function(s,c){var u=this._map._getUIString("NavigationControl."+c);s.title=u,s.setAttribute("aria-label",u)};var Q=function(s,c,u){u===void 0&&(u=!1),this._clickTolerance=10,this.element=c,this.mouseRotate=new Aa({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,u&&(this.mousePitch=new ll({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),m.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),Z.addEventListener(c,"mousedown",this.mousedown),Z.addEventListener(c,"touchstart",this.touchstart,{passive:!1}),Z.addEventListener(c,"touchmove",this.touchmove),Z.addEventListener(c,"touchend",this.touchend),Z.addEventListener(c,"touchcancel",this.reset)};function ae(s,c,u){if(s=new m.LngLat(s.lng,s.lat),c){var f=new m.LngLat(s.lng-360,s.lat),T=new m.LngLat(s.lng+360,s.lat),P=u.locationPoint(s).distSqr(c);u.locationPoint(f).distSqr(c)<P?s=f:u.locationPoint(T).distSqr(c)<P&&(s=T)}for(;Math.abs(s.lng-u.center.lng)>180;){var M=u.locationPoint(s);if(M.x>=0&&M.y>=0&&M.x<=u.width&&M.y<=u.height)break;s.lng>u.center.lng?s.lng-=360:s.lng+=360}return s}Q.prototype.down=function(s,c){this.mouseRotate.mousedown(s,c),this.mousePitch&&this.mousePitch.mousedown(s,c),Z.disableDrag()},Q.prototype.move=function(s,c){var u=this.map,f=this.mouseRotate.mousemoveWindow(s,c);if(f&&f.bearingDelta&&u.setBearing(u.getBearing()+f.bearingDelta),this.mousePitch){var T=this.mousePitch.mousemoveWindow(s,c);T&&T.pitchDelta&&u.setPitch(u.getPitch()+T.pitchDelta)}},Q.prototype.off=function(){var s=this.element;Z.removeEventListener(s,"mousedown",this.mousedown),Z.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),Z.removeEventListener(s,"touchmove",this.touchmove),Z.removeEventListener(s,"touchend",this.touchend),Z.removeEventListener(s,"touchcancel",this.reset),this.offTemp()},Q.prototype.offTemp=function(){Z.enableDrag(),Z.removeEventListener(m.window,"mousemove",this.mousemove),Z.removeEventListener(m.window,"mouseup",this.mouseup)},Q.prototype.mousedown=function(s){this.down(m.extend({},s,{ctrlKey:!0,preventDefault:function(){return s.preventDefault()}}),Z.mousePos(this.element,s)),Z.addEventListener(m.window,"mousemove",this.mousemove),Z.addEventListener(m.window,"mouseup",this.mouseup)},Q.prototype.mousemove=function(s){this.move(s,Z.mousePos(this.element,s))},Q.prototype.mouseup=function(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()},Q.prototype.touchstart=function(s){s.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Z.touchPos(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return s.preventDefault()}},this._startPos))},Q.prototype.touchmove=function(s){s.targetTouches.length!==1?this.reset():(this._lastPos=Z.touchPos(this.element,s.targetTouches)[0],this.move({preventDefault:function(){return s.preventDefault()}},this._lastPos))},Q.prototype.touchend=function(s){s.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Q.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var _e={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Le(s,c,u){var f=s.classList;for(var T in _e)f.remove("mapboxgl-"+u+"-anchor-"+T);f.add("mapboxgl-"+u+"-anchor-"+c)}var be,Me=function(s){function c(u,f){if(s.call(this),(u instanceof m.window.HTMLElement||f)&&(u=m.extend({element:u},f)),m.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=u&&u.anchor||"center",this._color=u&&u.color||"#3FB1CE",this._scale=u&&u.scale||1,this._draggable=u&&u.draggable||!1,this._clickTolerance=u&&u.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=u&&u.rotation||0,this._rotationAlignment=u&&u.rotationAlignment||"auto",this._pitchAlignment=u&&u.pitchAlignment&&u.pitchAlignment!=="auto"?u.pitchAlignment:this._rotationAlignment,u&&u.element)this._element=u.element,this._offset=m.Point.convert(u&&u.offset||[0,0]);else{this._defaultMarker=!0,this._element=Z.create("div"),this._element.setAttribute("aria-label","Map marker");var T=Z.createNS("http://www.w3.org/2000/svg","svg");T.setAttributeNS(null,"display","block"),T.setAttributeNS(null,"height","41px"),T.setAttributeNS(null,"width","27px"),T.setAttributeNS(null,"viewBox","0 0 27 41");var P=Z.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"stroke","none"),P.setAttributeNS(null,"stroke-width","1"),P.setAttributeNS(null,"fill","none"),P.setAttributeNS(null,"fill-rule","evenodd");var M=Z.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill-rule","nonzero");var F=Z.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"transform","translate(3.0, 29.0)"),F.setAttributeNS(null,"fill","#000000");for(var X=0,Y=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];X<Y.length;X+=1){var le=Y[X],ce=Z.createNS("http://www.w3.org/2000/svg","ellipse");ce.setAttributeNS(null,"opacity","0.04"),ce.setAttributeNS(null,"cx","10.5"),ce.setAttributeNS(null,"cy","5.80029008"),ce.setAttributeNS(null,"rx",le.rx),ce.setAttributeNS(null,"ry",le.ry),F.appendChild(ce)}var de=Z.createNS("http://www.w3.org/2000/svg","g");de.setAttributeNS(null,"fill",this._color);var Ce=Z.createNS("http://www.w3.org/2000/svg","path");Ce.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),de.appendChild(Ce);var Ae=Z.createNS("http://www.w3.org/2000/svg","g");Ae.setAttributeNS(null,"opacity","0.25"),Ae.setAttributeNS(null,"fill","#000000");var ke=Z.createNS("http://www.w3.org/2000/svg","path");ke.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Ae.appendChild(ke);var xe=Z.createNS("http://www.w3.org/2000/svg","g");xe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),xe.setAttributeNS(null,"fill","#FFFFFF");var ze=Z.createNS("http://www.w3.org/2000/svg","g");ze.setAttributeNS(null,"transform","translate(8.0, 8.0)");var Be=Z.createNS("http://www.w3.org/2000/svg","circle");Be.setAttributeNS(null,"fill","#000000"),Be.setAttributeNS(null,"opacity","0.25"),Be.setAttributeNS(null,"cx","5.5"),Be.setAttributeNS(null,"cy","5.5"),Be.setAttributeNS(null,"r","5.4999962");var Ge=Z.createNS("http://www.w3.org/2000/svg","circle");Ge.setAttributeNS(null,"fill","#FFFFFF"),Ge.setAttributeNS(null,"cx","5.5"),Ge.setAttributeNS(null,"cy","5.5"),Ge.setAttributeNS(null,"r","5.4999962"),ze.appendChild(Be),ze.appendChild(Ge),M.appendChild(F),M.appendChild(de),M.appendChild(Ae),M.appendChild(xe),M.appendChild(ze),T.appendChild(M),T.setAttributeNS(null,"height",41*this._scale+"px"),T.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(T),this._offset=m.Point.convert(u&&u.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Je){Je.preventDefault()}),this._element.addEventListener("mousedown",function(Je){Je.preventDefault()}),Le(this._element,this._anchor,"marker"),this._popup=null}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.addTo=function(u){return this.remove(),this._map=u,u.getCanvasContainer().appendChild(this._element),u.on("move",this._update),u.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},c.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Z.remove(this._element),this._popup&&this._popup.remove(),this},c.prototype.getLngLat=function(){return this._lngLat},c.prototype.setLngLat=function(u){return this._lngLat=m.LngLat.convert(u),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},c.prototype.getElement=function(){return this._element},c.prototype.setPopup=function(u){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),u){if(!("offset"in u.options)){var f=Math.sqrt(Math.pow(13.5,2)/2);u.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(24.6+f)],"bottom-right":[-f,-1*(24.6+f)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=u,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},c.prototype._onKeyPress=function(u){var f=u.code,T=u.charCode||u.keyCode;f!=="Space"&&f!=="Enter"&&T!==32&&T!==13||this.togglePopup()},c.prototype._onMapClick=function(u){var f=u.originalEvent.target,T=this._element;this._popup&&(f===T||T.contains(f))&&this.togglePopup()},c.prototype.getPopup=function(){return this._popup},c.prototype.togglePopup=function(){var u=this._popup;return u?(u.isOpen()?u.remove():u.addTo(this._map),this):this},c.prototype._update=function(u){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=ae(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var f="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?f="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(f="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var T="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?T="rotateX(0deg)":this._pitchAlignment==="map"&&(T="rotateX("+this._map.getPitch()+"deg)"),u&&u.type!=="moveend"||(this._pos=this._pos.round()),Z.setTransform(this._element,_e[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+T+" "+f)}},c.prototype.getOffset=function(){return this._offset},c.prototype.setOffset=function(u){return this._offset=m.Point.convert(u),this._update(),this},c.prototype._onMove=function(u){if(!this._isDragging){var f=this._clickTolerance||this._map._clickTolerance;this._isDragging=u.point.dist(this._pointerdownPos)>=f}this._isDragging&&(this._pos=u.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new m.Event("dragstart"))),this.fire(new m.Event("drag")))},c.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new m.Event("dragend")),this._state="inactive"},c.prototype._addDragHandler=function(u){this._element.contains(u.originalEvent.target)&&(u.preventDefault(),this._positionDelta=u.point.sub(this._pos).add(this._offset),this._pointerdownPos=u.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},c.prototype.setDraggable=function(u){return this._draggable=!!u,this._map&&(u?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},c.prototype.isDraggable=function(){return this._draggable},c.prototype.setRotation=function(u){return this._rotation=u||0,this._update(),this},c.prototype.getRotation=function(){return this._rotation},c.prototype.setRotationAlignment=function(u){return this._rotationAlignment=u||"auto",this._update(),this},c.prototype.getRotationAlignment=function(){return this._rotationAlignment},c.prototype.setPitchAlignment=function(u){return this._pitchAlignment=u&&u!=="auto"?u:this._rotationAlignment,this._update(),this},c.prototype.getPitchAlignment=function(){return this._pitchAlignment},c}(m.Evented),qe={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Ne=0,Ke=!1,Ze=function(s){function c(u){s.call(this),this.options=m.extend({},qe,u),m.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.onAdd=function(u){var f;return this._map=u,this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),f=this._setupUI,be!==void 0?f(be):m.window.navigator.permissions!==void 0?m.window.navigator.permissions.query({name:"geolocation"}).then(function(T){f(be=T.state!=="denied")}):f(be=!!m.window.navigator.geolocation),this._container},c.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Z.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ne=0,Ke=!1},c.prototype._isOutOfMapMaxBounds=function(u){var f=this._map.getMaxBounds(),T=u.coords;return f&&(T.longitude<f.getWest()||T.longitude>f.getEast()||T.latitude<f.getSouth()||T.latitude>f.getNorth())},c.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},c.prototype._onSuccess=function(u){if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new m.Event("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(u),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("geolocate",u)),this._finish()}},c.prototype._updateCamera=function(u){var f=new m.LngLat(u.coords.longitude,u.coords.latitude),T=u.coords.accuracy,P=this._map.getBearing(),M=m.extend({bearing:P},this.options.fitBoundsOptions);this._map.fitBounds(f.toBounds(T),M,{geolocateSource:!0})},c.prototype._updateMarker=function(u){if(u){var f=new m.LngLat(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(f).addTo(this._map),this._userLocationDotMarker.setLngLat(f).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},c.prototype._updateCircleRadius=function(){var u=this._map._container.clientHeight/2,f=this._map.unproject([0,u]),T=this._map.unproject([1,u]),P=f.distanceTo(T),M=Math.ceil(2*this._accuracy/P);this._circleElement.style.width=M+"px",this._circleElement.style.height=M+"px"},c.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},c.prototype._onError=function(u){if(this._map){if(this.options.trackUserLocation)if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&Ke)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("error",u)),this._finish()}},c.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},c.prototype._setupUI=function(u){var f=this;if(this._container.addEventListener("contextmenu",function(M){return M.preventDefault()}),this._geolocateButton=Z.create("button","mapboxgl-ctrl-geolocate",this._container),Z.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",u===!1){m.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var T=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=T,this._geolocateButton.setAttribute("aria-label",T)}else{var P=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=P,this._geolocateButton.setAttribute("aria-label",P)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Z.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Me(this._dotElement),this._circleElement=Z.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Me({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(M){M.geolocateSource||f._watchState!=="ACTIVE_LOCK"||M.originalEvent&&M.originalEvent.type==="resize"||(f._watchState="BACKGROUND",f._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),f._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),f.fire(new m.Event("trackuserlocationend")))})},c.prototype.trigger=function(){if(!this._setup)return m.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new m.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ne--,Ke=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new m.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new m.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var u;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Ne>1?(u={maximumAge:6e5,timeout:0},Ke=!0):(u=this.options.positionOptions,Ke=!1),this._geolocationWatchID=m.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,u)}}else m.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},c.prototype._clearWatch=function(){m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},c}(m.Evented),ut={maxWidth:100,unit:"metric"},rt=function(s){this.options=m.extend({},ut,s),m.bindAll(["_onMove","setUnit"],this)};function ot(s,c,u){var f=u&&u.maxWidth||100,T=s._container.clientHeight/2,P=s.unproject([0,T]),M=s.unproject([f,T]),F=P.distanceTo(M);if(u&&u.unit==="imperial"){var X=3.2808*F;X>5280?yt(c,f,X/5280,s._getUIString("ScaleControl.Miles")):yt(c,f,X,s._getUIString("ScaleControl.Feet"))}else u&&u.unit==="nautical"?yt(c,f,F/1852,s._getUIString("ScaleControl.NauticalMiles")):F>=1e3?yt(c,f,F/1e3,s._getUIString("ScaleControl.Kilometers")):yt(c,f,F,s._getUIString("ScaleControl.Meters"))}function yt(s,c,u,f){var T,P,M,F=(T=u,(P=Math.pow(10,(""+Math.floor(T)).length-1))*(M=(M=T/P)>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(X){var Y=Math.pow(10,Math.ceil(-Math.log(X)/Math.LN10));return Math.round(X*Y)/Y}(M)));s.style.width=c*(F/u)+"px",s.innerHTML=F+"&nbsp;"+f}rt.prototype.getDefaultPosition=function(){return"bottom-left"},rt.prototype._onMove=function(){ot(this._map,this._container,this.options)},rt.prototype.onAdd=function(s){return this._map=s,this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",s.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},rt.prototype.onRemove=function(){Z.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},rt.prototype.setUnit=function(s){this.options.unit=s,ot(this._map,this._container,this.options)};var Et=function(s){this._fullscreen=!1,s&&s.container&&(s.container instanceof m.window.HTMLElement?this._container=s.container:m.warnOnce("Full screen control 'container' must be a DOM element.")),m.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in m.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in m.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in m.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in m.window.document&&(this._fullscreenchange="MSFullscreenChange")};Et.prototype.onAdd=function(s){return this._map=s,this._container||(this._container=this._map.getContainer()),this._controlContainer=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",m.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Et.prototype.onRemove=function(){Z.remove(this._controlContainer),this._map=null,m.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Et.prototype._checkFullscreenSupport=function(){return!!(m.window.document.fullscreenEnabled||m.window.document.mozFullScreenEnabled||m.window.document.msFullscreenEnabled||m.window.document.webkitFullscreenEnabled)},Et.prototype._setupUI=function(){var s=this._fullscreenButton=Z.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Z.create("span","mapboxgl-ctrl-icon",s).setAttribute("aria-hidden",!0),s.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),m.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Et.prototype._updateTitle=function(){var s=this._getTitle();this._fullscreenButton.setAttribute("aria-label",s),this._fullscreenButton.title=s},Et.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Et.prototype._isFullscreen=function(){return this._fullscreen},Et.prototype._changeIcon=function(){(m.window.document.fullscreenElement||m.window.document.mozFullScreenElement||m.window.document.webkitFullscreenElement||m.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Et.prototype._onClickFullscreen=function(){this._isFullscreen()?m.window.document.exitFullscreen?m.window.document.exitFullscreen():m.window.document.mozCancelFullScreen?m.window.document.mozCancelFullScreen():m.window.document.msExitFullscreen?m.window.document.msExitFullscreen():m.window.document.webkitCancelFullScreen&&m.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var ct={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Kt=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Ot=function(s){function c(u){s.call(this),this.options=m.extend(Object.create(ct),u),m.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.addTo=function(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new m.Event("open")),this},c.prototype.isOpen=function(){return!!this._map},c.prototype.remove=function(){return this._content&&Z.remove(this._content),this._container&&(Z.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new m.Event("close")),this},c.prototype.getLngLat=function(){return this._lngLat},c.prototype.setLngLat=function(u){return this._lngLat=m.LngLat.convert(u),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},c.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},c.prototype.getElement=function(){return this._container},c.prototype.setText=function(u){return this.setDOMContent(m.window.document.createTextNode(u))},c.prototype.setHTML=function(u){var f,T=m.window.document.createDocumentFragment(),P=m.window.document.createElement("body");for(P.innerHTML=u;f=P.firstChild;)T.appendChild(f);return this.setDOMContent(T)},c.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},c.prototype.setMaxWidth=function(u){return this.options.maxWidth=u,this._update(),this},c.prototype.setDOMContent=function(u){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Z.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(u),this._createCloseButton(),this._update(),this._focusFirstElement(),this},c.prototype.addClassName=function(u){this._container&&this._container.classList.add(u)},c.prototype.removeClassName=function(u){this._container&&this._container.classList.remove(u)},c.prototype.setOffset=function(u){return this.options.offset=u,this._update(),this},c.prototype.toggleClassName=function(u){if(this._container)return this._container.classList.toggle(u)},c.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=Z.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},c.prototype._onMouseUp=function(u){this._update(u.point)},c.prototype._onMouseMove=function(u){this._update(u.point)},c.prototype._onDrag=function(u){this._update(u.point)},c.prototype._update=function(u){var f=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=Z.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=Z.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(ce){return f._container.classList.add(ce)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ae(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||u)){var T=this._pos=this._trackPointer&&u?u:this._map.project(this._lngLat),P=this.options.anchor,M=function ce(de){if(de){if(typeof de=="number"){var Ce=Math.round(Math.sqrt(.5*Math.pow(de,2)));return{center:new m.Point(0,0),top:new m.Point(0,de),"top-left":new m.Point(Ce,Ce),"top-right":new m.Point(-Ce,Ce),bottom:new m.Point(0,-de),"bottom-left":new m.Point(Ce,-Ce),"bottom-right":new m.Point(-Ce,-Ce),left:new m.Point(de,0),right:new m.Point(-de,0)}}if(de instanceof m.Point||Array.isArray(de)){var Ae=m.Point.convert(de);return{center:Ae,top:Ae,"top-left":Ae,"top-right":Ae,bottom:Ae,"bottom-left":Ae,"bottom-right":Ae,left:Ae,right:Ae}}return{center:m.Point.convert(de.center||[0,0]),top:m.Point.convert(de.top||[0,0]),"top-left":m.Point.convert(de["top-left"]||[0,0]),"top-right":m.Point.convert(de["top-right"]||[0,0]),bottom:m.Point.convert(de.bottom||[0,0]),"bottom-left":m.Point.convert(de["bottom-left"]||[0,0]),"bottom-right":m.Point.convert(de["bottom-right"]||[0,0]),left:m.Point.convert(de.left||[0,0]),right:m.Point.convert(de.right||[0,0])}}return ce(new m.Point(0,0))}(this.options.offset);if(!P){var F,X=this._container.offsetWidth,Y=this._container.offsetHeight;F=T.y+M.bottom.y<Y?["top"]:T.y>this._map.transform.height-Y?["bottom"]:[],T.x<X/2?F.push("left"):T.x>this._map.transform.width-X/2&&F.push("right"),P=F.length===0?"bottom":F.join("-")}var le=T.add(M[P]).round();Z.setTransform(this._container,_e[P]+" translate("+le.x+"px,"+le.y+"px)"),Le(this._container,P,"popup")}},c.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var u=this._container.querySelector(Kt);u&&u.focus()}},c.prototype._onClose=function(){this.remove()},c}(m.Evented),gi={version:m.version,supported:g,setRTLTextPlugin:m.setRTLTextPlugin,getRTLTextPluginStatus:m.getRTLTextPluginStatus,Map:R,NavigationControl:K,GeolocateControl:Ze,AttributionControl:Yr,ScaleControl:rt,FullscreenControl:Et,Popup:Ot,Marker:Me,Style:An,LngLat:m.LngLat,LngLatBounds:m.LngLatBounds,Point:m.Point,MercatorCoordinate:m.MercatorCoordinate,Evented:m.Evented,config:m.config,prewarm:function(){pe().acquire(j)},clearPrewarmedResources:function(){var s=se;s&&(s.isPreloaded()&&s.numActive()===1?(s.release(j),se=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return m.config.ACCESS_TOKEN},set accessToken(s){m.config.ACCESS_TOKEN=s},get baseApiUrl(){return m.config.API_URL},set baseApiUrl(s){m.config.API_URL=s},get workerCount(){return ee.workerCount},set workerCount(s){ee.workerCount=s},get maxParallelImageRequests(){return m.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(s){m.config.MAX_PARALLEL_IMAGE_REQUESTS=s},clearStorage:function(s){m.clearTileCache(s)},workerUrl:""};return gi}),U})})(lm);Object.defineProperty(cy,"__esModule",{value:!0});const A0=lm.exports;class I0{constructor(w){this.map=w,this.contents=[]}add(w,C,D){var U;let H=`
    <div class="mapboxgl-popup-layer-name">${D}</div>
    <div class="mapboxgl-popup-panel_area"><table class="mapboxgl-popup-table">
    ${Object.keys(C.properties).map(Z=>`<tr><th class="mapboxgl-popup-th">${Z.replace(/_/g," ").replace(/-/g," ")}</th><td class="mapboxgl-popup-td">${C.properties[Z]}</td></tr>`).join("")}
    </table></div>`;this.contents.push(H);let m;if(this.contents.length===1?m=this.contents[0]:m=`
      <div class="mapboxgl-popup-tab_wrap">
      ${this.contents.map(Z=>{let ve=this.contents.indexOf(Z)+1;return`<input id="mapboxgl-popup-tab${ve}" type="radio" name="tab_btn" ${ve===0?"checked":""}>`}).join("")}
      <div class="mapboxgl-popup-tab_area">
      ${this.contents.map(Z=>{let ve=this.contents.indexOf(Z)+1;return`<label class="mapboxgl-popup-tab${ve}_label" for="mapboxgl-popup-tab${ve}">${ve}</label>`}).join("")}
      </div>
      <div class="mapboxgl-popup-panel_area">
      ${this.contents.map(Z=>`<div id="mapboxgl-popup-panel${this.contents.indexOf(Z)+1}" class="mapboxgl-popup-tab_panel">${Z}</div>`).join("")}
      </div>
     </div>`,this.popup?this.popup.setHTML(m):this.popup=new A0.Popup().setLngLat(w).setHTML(m).setMaxWidth("400px").addTo(this.map),this.contents.length>1){const Z=document.getElementById("mapboxgl-popup-tab1");Z.checked=!0}var g=this;(U=g.popup)===null||U===void 0||U.on("close",function(){g.popup=null,g.contents=[]})}}class C0{constructor(w=[]){this.targets=w}createPopup(w,C){var D;let U=w.lngLat;const H=w.features[0];for(H.geometry.type==="Point"&&(U=H.geometry.coordinates.slice());Math.abs(w.lngLat.lng-U[0])>180;)U[0]+=w.lngLat.lng>U[0]?360:-360;!this.map||(D=this.popupManager)===null||D===void 0||D.add(U,H,C)}onAdd(w){if(this.map=w,this.popupManager=new I0(this.map),this.targets.length>0){const C=this;this.targets.forEach(D=>{w.on("click",D,function(U){C.createPopup(U,D)})})}return this.controlContainer=document.createElement("div"),this.controlContainer.className="mapboxgl-ctrl mapboxgl-ctrl-group",Object.assign(this.controlContainer,{style:"display:none"}),this.popupButton=document.createElement("button"),this.popupButton.className="mapboxgl-ctrl-icon",this.popupButton.type="button",this.controlContainer.appendChild(this.popupButton),this.controlContainer}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.popupButton||(this.controlContainer.parentNode.removeChild(this.controlContainer),this.map=void 0)}}var z0=cy.default=C0,um={};Object.defineProperty(um,"__esModule",{value:!0});var hy=um.MapboxStyleSwitcherControl=void 0;class Nh{constructor(w,C){this.styles=w||Nh.DEFAULT_STYLES,this.defaultStyle=C||Nh.DEFAULT_STYLE,this.styleUrl=new P0,this.defaultStyleFromUrl=this.styleUrl.get();let D=!1;for(const U of this.styles)U.title===this.defaultStyleFromUrl&&(D=!0);D||(this.styleUrl.delete(),this.defaultStyleFromUrl=null),this.onDocumentClick=this.onDocumentClick.bind(this)}getDefaultPosition(){return"top-right"}onAdd(w){this.map=w,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("mapboxgl-ctrl"),this.controlContainer.classList.add("mapboxgl-ctrl-group"),this.mapStyleContainer=document.createElement("div"),this.styleButton=document.createElement("button"),this.styleButton.type="button",this.mapStyleContainer.classList.add("mapboxgl-style-list");for(const C of this.styles){const D=document.createElement("button");D.type="button",D.innerText=C.title,D.classList.add(C.title.replace(/[^a-z0-9-]/gi,"_")),D.dataset.uri=JSON.stringify(C.uri),D.dataset.title=C.title,D.addEventListener("click",U=>{const H=U.srcElement;if(H.classList.contains("active"))return;this.map.setStyle(JSON.parse(H.dataset.uri)),this.styleUrl.set(H.dataset.title),this.mapStyleContainer.style.display="none",this.styleButton.style.display="block";const m=this.mapStyleContainer.getElementsByClassName("active");for(;m[0];)m[0].classList.remove("active");H.classList.add("active")}),C.title===this.defaultStyleFromUrl&&this.mapStyleContainer.getElementsByClassName("active").length===0&&(D.classList.add("active"),this.map.setStyle(C.uri)),!this.defaultStyleFromUrl&&C.title===this.defaultStyle&&this.mapStyleContainer.getElementsByClassName("active").length===0&&(D.classList.add("active"),this.map.setStyle(C.uri)),this.mapStyleContainer.appendChild(D)}return this.styleButton.classList.add("mapboxgl-ctrl-icon"),this.styleButton.classList.add("mapboxgl-style-switcher"),this.styleButton.addEventListener("click",()=>{this.styleButton.style.display="none",this.mapStyleContainer.style.display="block"}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.styleButton),this.controlContainer.appendChild(this.mapStyleContainer),this.controlContainer}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.styleButton||(this.styleButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.map=void 0)}onDocumentClick(w){this.controlContainer&&!this.controlContainer.contains(w.target)&&this.mapStyleContainer&&this.styleButton&&(this.mapStyleContainer.style.display="none",this.styleButton.style.display="block")}}hy=um.MapboxStyleSwitcherControl=Nh;Nh.DEFAULT_STYLE="Streets";Nh.DEFAULT_STYLES=[{title:"Dark",uri:"mapbox://styles/mapbox/dark-v10"},{title:"Light",uri:"mapbox://styles/mapbox/light-v10"},{title:"Outdoors",uri:"mapbox://styles/mapbox/outdoors-v11"},{title:"Satellite",uri:"mapbox://styles/mapbox/satellite-streets-v11"},{title:"Streets",uri:"mapbox://styles/mapbox/streets-v11"}];class P0{constructor(){this.STYLE_PATHNAME="style"}getUrl(){const w=window.location,C=new URL(w.href);return C.hash=w.hash,C}updateUrl(w){history.replaceState("","",w.toString())}get(){return this.getUrl().searchParams.get(this.STYLE_PATHNAME)}set(w){const C=this.getUrl();C.searchParams.set(this.STYLE_PATHNAME,w),this.updateUrl(C)}delete(){const w=this.getUrl();w.searchParams.delete(this.STYLE_PATHNAME),this.updateUrl(w)}}var py={},cm={},hm={},kd={},pm={exports:{}},dy=function(w,C){return function(){for(var U=new Array(arguments.length),H=0;H<U.length;H++)U[H]=arguments[H];return w.apply(C,U)}},k0=dy,sh=Object.prototype.toString;function dm(A){return sh.call(A)==="[object Array]"}function Wf(A){return typeof A=="undefined"}function M0(A){return A!==null&&!Wf(A)&&A.constructor!==null&&!Wf(A.constructor)&&typeof A.constructor.isBuffer=="function"&&A.constructor.isBuffer(A)}function L0(A){return sh.call(A)==="[object ArrayBuffer]"}function D0(A){return typeof FormData!="undefined"&&A instanceof FormData}function R0(A){var w;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?w=ArrayBuffer.isView(A):w=A&&A.buffer&&A.buffer instanceof ArrayBuffer,w}function B0(A){return typeof A=="string"}function O0(A){return typeof A=="number"}function fy(A){return A!==null&&typeof A=="object"}function xd(A){if(sh.call(A)!=="[object Object]")return!1;var w=Object.getPrototypeOf(A);return w===null||w===Object.prototype}function F0(A){return sh.call(A)==="[object Date]"}function U0(A){return sh.call(A)==="[object File]"}function V0(A){return sh.call(A)==="[object Blob]"}function my(A){return sh.call(A)==="[object Function]"}function N0(A){return fy(A)&&my(A.pipe)}function j0(A){return typeof URLSearchParams!="undefined"&&A instanceof URLSearchParams}function q0(A){return A.trim?A.trim():A.replace(/^\s+|\s+$/g,"")}function G0(){return typeof navigator!="undefined"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"}function fm(A,w){if(!(A===null||typeof A=="undefined"))if(typeof A!="object"&&(A=[A]),dm(A))for(var C=0,D=A.length;C<D;C++)w.call(null,A[C],C,A);else for(var U in A)Object.prototype.hasOwnProperty.call(A,U)&&w.call(null,A[U],U,A)}function Kf(){var A={};function w(U,H){xd(A[H])&&xd(U)?A[H]=Kf(A[H],U):xd(U)?A[H]=Kf({},U):dm(U)?A[H]=U.slice():A[H]=U}for(var C=0,D=arguments.length;C<D;C++)fm(arguments[C],w);return A}function Z0(A,w,C){return fm(w,function(U,H){C&&typeof U=="function"?A[H]=k0(U,C):A[H]=U}),A}function X0(A){return A.charCodeAt(0)===65279&&(A=A.slice(1)),A}var Es={isArray:dm,isArrayBuffer:L0,isBuffer:M0,isFormData:D0,isArrayBufferView:R0,isString:B0,isNumber:O0,isObject:fy,isPlainObject:xd,isUndefined:Wf,isDate:F0,isFile:U0,isBlob:V0,isFunction:my,isStream:N0,isURLSearchParams:j0,isStandardBrowserEnv:G0,forEach:fm,merge:Kf,extend:Z0,trim:q0,stripBOM:X0},Rh=Es;function hg(A){return encodeURIComponent(A).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var gy=function(w,C,D){if(!C)return w;var U;if(D)U=D(C);else if(Rh.isURLSearchParams(C))U=C.toString();else{var H=[];Rh.forEach(C,function(Z,ve){Z===null||typeof Z=="undefined"||(Rh.isArray(Z)?ve=ve+"[]":Z=[Z],Rh.forEach(Z,function(ye){Rh.isDate(ye)?ye=ye.toISOString():Rh.isObject(ye)&&(ye=JSON.stringify(ye)),H.push(hg(ve)+"="+hg(ye))}))}),U=H.join("&")}if(U){var m=w.indexOf("#");m!==-1&&(w=w.slice(0,m)),w+=(w.indexOf("?")===-1?"?":"&")+U}return w},$0=Es;function Md(){this.handlers=[]}Md.prototype.use=function(w,C,D){return this.handlers.push({fulfilled:w,rejected:C,synchronous:D?D.synchronous:!1,runWhen:D?D.runWhen:null}),this.handlers.length-1};Md.prototype.eject=function(w){this.handlers[w]&&(this.handlers[w]=null)};Md.prototype.forEach=function(w){$0.forEach(this.handlers,function(D){D!==null&&w(D)})};var H0=Md,W0=Es,K0=function(w,C){W0.forEach(w,function(U,H){H!==C&&H.toUpperCase()===C.toUpperCase()&&(w[C]=U,delete w[H])})},yy=function(w,C,D,U,H){return w.config=C,D&&(w.code=D),w.request=U,w.response=H,w.isAxiosError=!0,w.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},w},J0=yy,_y=function(w,C,D,U,H){var m=new Error(w);return J0(m,C,D,U,H)},Y0=_y,Q0=function(w,C,D){var U=D.config.validateStatus;!D.status||!U||U(D.status)?w(D):C(Y0("Request failed with status code "+D.status,D.config,null,D.request,D))},md=Es,e1=md.isStandardBrowserEnv()?function(){return{write:function(C,D,U,H,m,g){var Z=[];Z.push(C+"="+encodeURIComponent(D)),md.isNumber(U)&&Z.push("expires="+new Date(U).toGMTString()),md.isString(H)&&Z.push("path="+H),md.isString(m)&&Z.push("domain="+m),g===!0&&Z.push("secure"),document.cookie=Z.join("; ")},read:function(C){var D=document.cookie.match(new RegExp("(^|;\\s*)("+C+")=([^;]*)"));return D?decodeURIComponent(D[3]):null},remove:function(C){this.write(C,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),t1=function(w){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(w)},i1=function(w,C){return C?w.replace(/\/+$/,"")+"/"+C.replace(/^\/+/,""):w},r1=t1,n1=i1,o1=function(w,C){return w&&!r1(C)?n1(w,C):C},Ff=Es,a1=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],s1=function(w){var C={},D,U,H;return w&&Ff.forEach(w.split(`
`),function(g){if(H=g.indexOf(":"),D=Ff.trim(g.substr(0,H)).toLowerCase(),U=Ff.trim(g.substr(H+1)),D){if(C[D]&&a1.indexOf(D)>=0)return;D==="set-cookie"?C[D]=(C[D]?C[D]:[]).concat([U]):C[D]=C[D]?C[D]+", "+U:U}}),C},pg=Es,l1=pg.isStandardBrowserEnv()?function(){var w=/(msie|trident)/i.test(navigator.userAgent),C=document.createElement("a"),D;function U(H){var m=H;return w&&(C.setAttribute("href",m),m=C.href),C.setAttribute("href",m),{href:C.href,protocol:C.protocol?C.protocol.replace(/:$/,""):"",host:C.host,search:C.search?C.search.replace(/^\?/,""):"",hash:C.hash?C.hash.replace(/^#/,""):"",hostname:C.hostname,port:C.port,pathname:C.pathname.charAt(0)==="/"?C.pathname:"/"+C.pathname}}return D=U(window.location.href),function(m){var g=pg.isString(m)?U(m):m;return g.protocol===D.protocol&&g.host===D.host}}():function(){return function(){return!0}}(),gd=Es,u1=Q0,c1=e1,h1=gy,p1=o1,d1=s1,f1=l1,Uf=_y,dg=function(w){return new Promise(function(D,U){var H=w.data,m=w.headers,g=w.responseType;gd.isFormData(H)&&delete m["Content-Type"];var Z=new XMLHttpRequest;if(w.auth){var ve=w.auth.username||"",he=w.auth.password?unescape(encodeURIComponent(w.auth.password)):"";m.Authorization="Basic "+btoa(ve+":"+he)}var ye=p1(w.baseURL,w.url);Z.open(w.method.toUpperCase(),h1(ye,w.params,w.paramsSerializer),!0),Z.timeout=w.timeout;function re(){if(!!Z){var et="getAllResponseHeaders"in Z?d1(Z.getAllResponseHeaders()):null,St=!g||g==="text"||g==="json"?Z.responseText:Z.response,vt={data:St,status:Z.status,statusText:Z.statusText,headers:et,config:w,request:Z};u1(D,U,vt),Z=null}}if("onloadend"in Z?Z.onloadend=re:Z.onreadystatechange=function(){!Z||Z.readyState!==4||Z.status===0&&!(Z.responseURL&&Z.responseURL.indexOf("file:")===0)||setTimeout(re)},Z.onabort=function(){!Z||(U(Uf("Request aborted",w,"ECONNABORTED",Z)),Z=null)},Z.onerror=function(){U(Uf("Network Error",w,null,Z)),Z=null},Z.ontimeout=function(){var St="timeout of "+w.timeout+"ms exceeded";w.timeoutErrorMessage&&(St=w.timeoutErrorMessage),U(Uf(St,w,w.transitional&&w.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",Z)),Z=null},gd.isStandardBrowserEnv()){var it=(w.withCredentials||f1(ye))&&w.xsrfCookieName?c1.read(w.xsrfCookieName):void 0;it&&(m[w.xsrfHeaderName]=it)}"setRequestHeader"in Z&&gd.forEach(m,function(St,vt){typeof H=="undefined"&&vt.toLowerCase()==="content-type"?delete m[vt]:Z.setRequestHeader(vt,St)}),gd.isUndefined(w.withCredentials)||(Z.withCredentials=!!w.withCredentials),g&&g!=="json"&&(Z.responseType=w.responseType),typeof w.onDownloadProgress=="function"&&Z.addEventListener("progress",w.onDownloadProgress),typeof w.onUploadProgress=="function"&&Z.upload&&Z.upload.addEventListener("progress",w.onUploadProgress),w.cancelToken&&w.cancelToken.promise.then(function(St){!Z||(Z.abort(),U(St),Z=null)}),H||(H=null),Z.send(H)})},Ho=Es,fg=K0,m1=yy,g1={"Content-Type":"application/x-www-form-urlencoded"};function mg(A,w){!Ho.isUndefined(A)&&Ho.isUndefined(A["Content-Type"])&&(A["Content-Type"]=w)}function y1(){var A;return(typeof XMLHttpRequest!="undefined"||typeof process!="undefined"&&Object.prototype.toString.call(process)==="[object process]")&&(A=dg),A}function _1(A,w,C){if(Ho.isString(A))try{return(w||JSON.parse)(A),Ho.trim(A)}catch(D){if(D.name!=="SyntaxError")throw D}return(C||JSON.stringify)(A)}var Ld={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:y1(),transformRequest:[function(w,C){return fg(C,"Accept"),fg(C,"Content-Type"),Ho.isFormData(w)||Ho.isArrayBuffer(w)||Ho.isBuffer(w)||Ho.isStream(w)||Ho.isFile(w)||Ho.isBlob(w)?w:Ho.isArrayBufferView(w)?w.buffer:Ho.isURLSearchParams(w)?(mg(C,"application/x-www-form-urlencoded;charset=utf-8"),w.toString()):Ho.isObject(w)||C&&C["Content-Type"]==="application/json"?(mg(C,"application/json"),_1(w)):w}],transformResponse:[function(w){var C=this.transitional,D=C&&C.silentJSONParsing,U=C&&C.forcedJSONParsing,H=!D&&this.responseType==="json";if(H||U&&Ho.isString(w)&&w.length)try{return JSON.parse(w)}catch(m){if(H)throw m.name==="SyntaxError"?m1(m,this,"E_JSON_PARSE"):m}return w}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(w){return w>=200&&w<300}};Ld.headers={common:{Accept:"application/json, text/plain, */*"}};Ho.forEach(["delete","get","head"],function(w){Ld.headers[w]={}});Ho.forEach(["post","put","patch"],function(w){Ld.headers[w]=Ho.merge(g1)});var mm=Ld,v1=Es,x1=mm,b1=function(w,C,D){var U=this||x1;return v1.forEach(D,function(m){w=m.call(U,w,C)}),w},vy=function(w){return!!(w&&w.__CANCEL__)},gg=Es,Vf=b1,w1=vy,E1=mm;function Nf(A){A.cancelToken&&A.cancelToken.throwIfRequested()}var S1=function(w){Nf(w),w.headers=w.headers||{},w.data=Vf.call(w,w.data,w.headers,w.transformRequest),w.headers=gg.merge(w.headers.common||{},w.headers[w.method]||{},w.headers),gg.forEach(["delete","get","head","post","put","patch","common"],function(U){delete w.headers[U]});var C=w.adapter||E1.adapter;return C(w).then(function(U){return Nf(w),U.data=Vf.call(w,U.data,U.headers,w.transformResponse),U},function(U){return w1(U)||(Nf(w),U&&U.response&&(U.response.data=Vf.call(w,U.response.data,U.response.headers,w.transformResponse))),Promise.reject(U)})},pa=Es,xy=function(w,C){C=C||{};var D={},U=["url","method","data"],H=["headers","auth","proxy","params"],m=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],g=["validateStatus"];function Z(re,it){return pa.isPlainObject(re)&&pa.isPlainObject(it)?pa.merge(re,it):pa.isPlainObject(it)?pa.merge({},it):pa.isArray(it)?it.slice():it}function ve(re){pa.isUndefined(C[re])?pa.isUndefined(w[re])||(D[re]=Z(void 0,w[re])):D[re]=Z(w[re],C[re])}pa.forEach(U,function(it){pa.isUndefined(C[it])||(D[it]=Z(void 0,C[it]))}),pa.forEach(H,ve),pa.forEach(m,function(it){pa.isUndefined(C[it])?pa.isUndefined(w[it])||(D[it]=Z(void 0,w[it])):D[it]=Z(void 0,C[it])}),pa.forEach(g,function(it){it in C?D[it]=Z(w[it],C[it]):it in w&&(D[it]=Z(void 0,w[it]))});var he=U.concat(H).concat(m).concat(g),ye=Object.keys(w).concat(Object.keys(C)).filter(function(it){return he.indexOf(it)===-1});return pa.forEach(ye,ve),D};const T1="axios",A1="0.21.4",I1="Promise based HTTP client for the browser and node.js",C1="index.js",z1={test:"grunt test",start:"node ./sandbox/server.js",build:"NODE_ENV=production grunt build",preversion:"npm test",version:"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json",postversion:"git push && git push --tags",examples:"node ./examples/server.js",coveralls:"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js",fix:"eslint --fix lib/**/*.js"},P1={type:"git",url:"https://github.com/axios/axios.git"},k1=["xhr","http","ajax","promise","node"],M1="Matt Zabriskie",L1="MIT",D1={url:"https://github.com/axios/axios/issues"},R1="https://axios-http.com",B1={coveralls:"^3.0.0","es6-promise":"^4.2.4",grunt:"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1",karma:"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2",minimist:"^1.2.0",mocha:"^8.2.1",sinon:"^4.5.0","terser-webpack-plugin":"^4.2.3",typescript:"^4.0.5","url-search-params":"^0.10.0",webpack:"^4.44.2","webpack-dev-server":"^3.11.0"},O1={"./lib/adapters/http.js":"./lib/adapters/xhr.js"},F1="dist/axios.min.js",U1="dist/axios.min.js",V1="./index.d.ts",N1={"follow-redirects":"^1.14.0"},j1=[{path:"./dist/axios.min.js",threshold:"5kB"}];var q1={name:T1,version:A1,description:I1,main:C1,scripts:z1,repository:P1,keywords:k1,author:M1,license:L1,bugs:D1,homepage:R1,devDependencies:B1,browser:O1,jsdelivr:F1,unpkg:U1,typings:V1,dependencies:N1,bundlesize:j1},by=q1,gm={};["object","boolean","number","function","string","symbol"].forEach(function(A,w){gm[A]=function(D){return typeof D===A||"a"+(w<1?"n ":" ")+A}});var yg={},G1=by.version.split(".");function wy(A,w){for(var C=w?w.split("."):G1,D=A.split("."),U=0;U<3;U++){if(C[U]>D[U])return!0;if(C[U]<D[U])return!1}return!1}gm.transitional=function(w,C,D){var U=C&&wy(C);function H(m,g){return"[Axios v"+by.version+"] Transitional option '"+m+"'"+g+(D?". "+D:"")}return function(m,g,Z){if(w===!1)throw new Error(H(g," has been removed in "+C));return U&&!yg[g]&&(yg[g]=!0,console.warn(H(g," has been deprecated since v"+C+" and will be removed in the near future"))),w?w(m,g,Z):!0}};function Z1(A,w,C){if(typeof A!="object")throw new TypeError("options must be an object");for(var D=Object.keys(A),U=D.length;U-- >0;){var H=D[U],m=w[H];if(m){var g=A[H],Z=g===void 0||m(g,H,A);if(Z!==!0)throw new TypeError("option "+H+" must be "+Z);continue}if(C!==!0)throw Error("Unknown option "+H)}}var X1={isOlderVersion:wy,assertOptions:Z1,validators:gm},Ey=Es,$1=gy,_g=H0,vg=S1,Dd=xy,Sy=X1,Bh=Sy.validators;function Ap(A){this.defaults=A,this.interceptors={request:new _g,response:new _g}}Ap.prototype.request=function(w){typeof w=="string"?(w=arguments[1]||{},w.url=arguments[0]):w=w||{},w=Dd(this.defaults,w),w.method?w.method=w.method.toLowerCase():this.defaults.method?w.method=this.defaults.method.toLowerCase():w.method="get";var C=w.transitional;C!==void 0&&Sy.assertOptions(C,{silentJSONParsing:Bh.transitional(Bh.boolean,"1.0.0"),forcedJSONParsing:Bh.transitional(Bh.boolean,"1.0.0"),clarifyTimeoutError:Bh.transitional(Bh.boolean,"1.0.0")},!1);var D=[],U=!0;this.interceptors.request.forEach(function(re){typeof re.runWhen=="function"&&re.runWhen(w)===!1||(U=U&&re.synchronous,D.unshift(re.fulfilled,re.rejected))});var H=[];this.interceptors.response.forEach(function(re){H.push(re.fulfilled,re.rejected)});var m;if(!U){var g=[vg,void 0];for(Array.prototype.unshift.apply(g,D),g=g.concat(H),m=Promise.resolve(w);g.length;)m=m.then(g.shift(),g.shift());return m}for(var Z=w;D.length;){var ve=D.shift(),he=D.shift();try{Z=ve(Z)}catch(ye){he(ye);break}}try{m=vg(Z)}catch(ye){return Promise.reject(ye)}for(;H.length;)m=m.then(H.shift(),H.shift());return m};Ap.prototype.getUri=function(w){return w=Dd(this.defaults,w),$1(w.url,w.params,w.paramsSerializer).replace(/^\?/,"")};Ey.forEach(["delete","get","head","options"],function(w){Ap.prototype[w]=function(C,D){return this.request(Dd(D||{},{method:w,url:C,data:(D||{}).data}))}});Ey.forEach(["post","put","patch"],function(w){Ap.prototype[w]=function(C,D,U){return this.request(Dd(U||{},{method:w,url:C,data:D}))}});var H1=Ap;function ym(A){this.message=A}ym.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")};ym.prototype.__CANCEL__=!0;var Ty=ym,W1=Ty;function Ad(A){if(typeof A!="function")throw new TypeError("executor must be a function.");var w;this.promise=new Promise(function(U){w=U});var C=this;A(function(U){C.reason||(C.reason=new W1(U),w(C.reason))})}Ad.prototype.throwIfRequested=function(){if(this.reason)throw this.reason};Ad.source=function(){var w,C=new Ad(function(U){w=U});return{token:C,cancel:w}};var K1=Ad,J1=function(w){return function(D){return w.apply(null,D)}},Y1=function(w){return typeof w=="object"&&w.isAxiosError===!0},xg=Es,Q1=dy,bd=H1,eb=xy,tb=mm;function Ay(A){var w=new bd(A),C=Q1(bd.prototype.request,w);return xg.extend(C,bd.prototype,w),xg.extend(C,w),C}var Al=Ay(tb);Al.Axios=bd;Al.create=function(w){return Ay(eb(Al.defaults,w))};Al.Cancel=Ty;Al.CancelToken=K1;Al.isCancel=vy;Al.all=function(w){return Promise.all(w)};Al.spread=J1;Al.isAxiosError=Y1;pm.exports=Al;pm.exports.default=Al;var ib=pm.exports;(function(A){Object.defineProperty(A,"__esModule",{value:!0}),A.ContourType=A.Costing=void 0;const w=ib,C=lm.exports;A.Costing={Walking:"pedestrian",Bicycle:"bicycle",Car:"auto"},A.ContourType={Time:"time",Distance:"distance"};class D{constructor(H,m,g){this.contourSources=[],this.contourLayers=[],this.contourMaker=void 0,this.contours=[{time:5,distance:1,color:"ff0000"},{time:10,distance:3,color:"ffff00"},{time:15,distance:5,color:"0000ff"}],this.map=H,this.url=m,g&&(this.contours=g)}clearFeatures(){this.contourLayers&&this.contourLayers.length>0&&(this.contourLayers.forEach(H=>{var m;(m=this.map)===null||m===void 0||m.removeLayer(H)}),this.contourLayers=[]),this.contourSources&&this.contourSources.length>0&&(this.contourSources.forEach(H=>{var m;(m=this.map)===null||m===void 0||m.removeSource(H)}),this.contourSources=[]),this.contourMaker&&(this.contourMaker.remove(),this.contourMaker=void 0)}getIsochrone(H,m,g,Z,ve){this.clearFeatures();let he=JSON.parse(JSON.stringify(this.contours));ve&&(he=ve),he.forEach(re=>{g===A.ContourType.Time?delete re.distance:delete re.time});let ye="km";return g===A.ContourType.Time&&(ye="min"),new Promise((re,it)=>{const et={locations:[{lat:m,lon:H}],costing:Z,contours:he,polygons:!0},St=`${this.url}/isochrone?json=${JSON.stringify(et)}`;w.default.get(St).then(vt=>{vt.data.features.forEach(Wt=>{var _t,ui,qt,Zt;const si=`isochrone-${Wt.properties.contour}`;(_t=this.map)===null||_t===void 0||_t.addSource(si,{type:"geojson",data:Wt}),this.contourSources.push(si),(ui=this.map)===null||ui===void 0||ui.addLayer({id:`pg-${si}`,type:"fill",source:si,layout:{},paint:{"fill-color":Wt.properties.fillColor,"fill-opacity":.1}}),this.contourLayers.push(`pg-${si}`),(qt=this.map)===null||qt===void 0||qt.addLayer({id:`ls-${si}`,type:"line",source:si,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":Wt.properties.fillColor,"line-width":3}}),this.contourLayers.push(`ls-${si}`),(Zt=this.map)===null||Zt===void 0||Zt.addLayer({id:`symbol-${si}`,type:"symbol",source:si,layout:{"symbol-placement":"line","text-pitch-alignment":"viewport","text-font":["Roboto Bold"],"text-field":["concat",["get","contour"],` ${ye}`],"text-size":16},paint:{"text-color":"#000000","text-halo-width":1,"text-halo-color":"#FFFFFF"}}),this.contourLayers.push(`symbol-${si}`)}),this.map&&(this.contourMaker=new C.Marker().setLngLat([H,m]).addTo(this.map)),re()}).catch(vt=>it(vt))})}getContoursOption(){return this.contours}}A.default=D})(kd);var Rd={};Object.defineProperty(Rd,"__esModule",{value:!0});class rb{constructor(w){this.color="#535353",this.map=w}create(){this.updateValues(),this.map!==void 0?(this.map.on("resize",this.mapResize.bind(this)),this.createCanvas(this.map.getCanvasContainer())):console.error("map object is null")}updateValues(){var w,C;this.width=(w=this.map)===null||w===void 0?void 0:w.getCanvas().clientWidth,this.height=(C=this.map)===null||C===void 0?void 0:C.getCanvas().clientHeight}mapResize(){this.updateValues(),this.updateCanvas()}updateCanvas(){if(this.svgCanvas!==void 0&&this.yLine!==void 0&&this.xLine!==void 0&&this.width!==void 0&&this.height!==void 0){this.svgCanvas.setAttribute("width",`${this.width}px`),this.svgCanvas.setAttribute("height",`${this.height}px`);const w=this.width/2,C=this.height/2;this.yLine.setAttribute("x1",`${w}px`),this.yLine.setAttribute("y1","0px"),this.yLine.setAttribute("x2",`${w}px`),this.yLine.setAttribute("y2",`${this.height}px`),this.xLine.setAttribute("x1",`${0}px`),this.xLine.setAttribute("y1",`${C}px`),this.xLine.setAttribute("x2",`${this.width}px`),this.xLine.setAttribute("y2",`${C}px`)}}createCanvas(w){if(this.width!==void 0&&this.height!==void 0){const C=document.createElementNS("http://www.w3.org/2000/svg","svg");C.style.position="relative",C.setAttribute("width",`${this.width}px`),C.setAttribute("height",`${this.height}px`);const D=this.width/2,U=this.height/2;this.yLine=C.appendChild(this.createLine(D,0,D,this.height,this.color,"2px")),this.xLine=C.appendChild(this.createLine(0,U,this.width,U,this.color,"2px")),w==null||w.appendChild(C),this.svgCanvas=C}}createLine(w,C,D,U,H,m){const g=document.createElementNS("http://www.w3.org/2000/svg","line");return g.setAttribute("x1",w),g.setAttribute("y1",C),g.setAttribute("x2",D),g.setAttribute("y2",U),g.setAttribute("stroke-dasharray","5,5"),g.setAttribute("stroke",H),g.setAttribute("stroke-width",m),g}destroy(){this.xLine!==void 0&&(this.xLine.remove(),this.xLine=void 0),this.yLine!==void 0&&(this.yLine.remove(),this.yLine=void 0),this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map.off("resize",this.mapResize),this.map=void 0)}}Rd.default=rb;var rh={};Object.defineProperty(rh,"__esModule",{value:!0});rh.createTextbox=rh.createSelection=void 0;const nb=(A,w,C,D,U)=>{const H=document.createElement("label");H.textContent=w;const m=document.createElement("select");m.setAttribute("id",`mapbox-gl-valhalla-${C}`),m.style.width="100%",Object.keys(A).forEach(he=>{const ye=document.createElement("option");ye.setAttribute("value",U(A,he)),ye.appendChild(document.createTextNode(he)),ye.setAttribute("name",C),D===A[he]&&(ye.selected=!0),m.appendChild(ye)});const g=document.createElement("TR"),Z=document.createElement("TD"),ve=document.createElement("TD");return Z.appendChild(H),ve.appendChild(m),g.appendChild(Z),g.appendChild(ve),g};rh.createSelection=nb;const ob=(A,w,C,D,U)=>{const H=document.createElement("label");H.textContent=A,U||(U="text");const m=document.createElement("input");m.setAttribute("id",`mapbox-gl-valhalla-${w}`),m.setAttribute("type",U),m.setAttribute("value",C),m.readOnly=D;const g=document.createElement("TR"),Z=document.createElement("TD"),ve=document.createElement("TD");return Z.appendChild(H),ve.appendChild(m),g.appendChild(Z),g.appendChild(ve),g};rh.createTextbox=ob;Object.defineProperty(hm,"__esModule",{value:!0});const jf=kd,ab=Rd,yd=rh;class sb{constructor(w,C){this.map=w,this.valhalla=C,this.onDocumentClick=this.onDocumentClick.bind(this)}addTo(w){var C,D;this.map||console.error("map object is null"),this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("mapboxgl-ctrl"),this.controlContainer.classList.add("mapboxgl-ctrl-group"),this.mainContainer=document.createElement("div"),this.mainContainer.classList.add("mapboxgl-valhalla-list"),this.mainButton=document.createElement("button"),this.mainButton.classList.add("mapboxgl-ctrl-icon"),this.mainButton.classList.add("mapboxgl-valhalla-time-isochrone-control"),this.mainButton.addEventListener("click",()=>{this.mainButton.style.display="none",this.mainContainer.style.display="block",this.toggleCrosshair(!0)}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.mainButton),this.controlContainer.appendChild(this.mainContainer);const U=document.createElement("TABLE");U.className="valhalla-table",this.mainContainer.appendChild(U);const H=yd.createSelection(jf.Costing,"Means of transport","costing",jf.Costing.Walking,(he,ye)=>he[ye]);U.appendChild(H);const m=(C=this.map)===null||C===void 0?void 0:C.getCenter();if(m){const he=yd.createTextbox("Longitude","lon-time",m.lng,!0);U.appendChild(he);const ye=yd.createTextbox("Latitude","lat-time",m.lat,!0);U.appendChild(ye)}const g=this.valhalla.getContoursOption();for(let he=0;he<g.length;he+=1){const ye=g[he],re=yd.createTextbox(`Contour ${he+1} (min)`,`contour-time-${he}`,ye.time,!1,"number");U.appendChild(re)}const Z=document.createElement("button");Z.textContent="Clear",Z.classList.add("mapbox-valhalla-control-button"),Z.addEventListener("click",()=>{this.valhalla.clearFeatures()}),this.mainContainer.appendChild(Z);const ve=document.createElement("button");return ve.textContent="Calculate",ve.classList.add("mapbox-valhalla-control-button"),ve.addEventListener("click",()=>{const he=document.getElementById("mapbox-gl-valhalla-lon-time"),ye=document.getElementById("mapbox-gl-valhalla-lat-time"),re=document.getElementById("mapbox-gl-valhalla-costing"),it=this.valhalla.getContoursOption();for(let et=0;et<it.length;et+=1){const St=it[et],vt=document.getElementById(`mapbox-gl-valhalla-contour-time-${et}`);St.time=Number(vt.value)}this.valhalla.getIsochrone(Number(he.value),Number(ye.value),jf.ContourType.Time,re.value,it)}),this.mainContainer.appendChild(ve),(D=this.map)===null||D===void 0||D.on("moveend",()=>{var he;const ye=(he=this.map)===null||he===void 0?void 0:he.getCenter(),re=document.getElementById("mapbox-gl-valhalla-lon-time"),it=document.getElementById("mapbox-gl-valhalla-lat-time");ye||(re.setAttribute("value",""),it.setAttribute("value",""));const et=ye,St=et!=null&&et.lng?et.lng.toString():"";re.setAttribute("value",St);const vt=et!=null&&et.lat?et.lat.toString():"";it.setAttribute("value",vt)}),w.appendChild(this.controlContainer),w}onDocumentClick(w){this.controlContainer&&!this.controlContainer.contains(w.target)&&this.hide()}hide(){this.mainContainer&&this.mainButton&&(this.mainContainer.style.display="none",this.mainButton.style.display="block",this.toggleCrosshair(!1))}destroy(){!this.mainContainer||!this.mainContainer.parentNode||!this.map||!this.mainButton||(this.mainButton.removeEventListener("click",this.onDocumentClick),this.mainContainer.parentNode.removeChild(this.mainContainer),document.removeEventListener("click",this.onDocumentClick),this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0),this.map=void 0)}toggleCrosshair(w){w===!1?this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0):(this.crosshair=new ab.default(this.map),this.crosshair.create())}}hm.default=sb;var _m={};Object.defineProperty(_m,"__esModule",{value:!0});const bg=kd,lb=Rd,qf=rh;class ub{constructor(w,C){this.map=w,this.valhalla=C,this.onDocumentClick=this.onDocumentClick.bind(this)}addTo(w){var C,D;this.map||console.error("map object is null"),this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("mapboxgl-ctrl"),this.controlContainer.classList.add("mapboxgl-ctrl-group"),this.mainContainer=document.createElement("div"),this.mainContainer.classList.add("mapboxgl-valhalla-list"),this.mainButton=document.createElement("button"),this.mainButton.classList.add("mapboxgl-ctrl-icon"),this.mainButton.classList.add("mapboxgl-valhalla-distance-isochrone-control"),this.mainButton.addEventListener("click",()=>{this.mainButton.style.display="none",this.mainContainer.style.display="block",this.toggleCrosshair(!0)}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.mainButton),this.controlContainer.appendChild(this.mainContainer);const U=document.createElement("TABLE");U.className="valhalla-table",this.mainContainer.appendChild(U);const H=(C=this.map)===null||C===void 0?void 0:C.getCenter();if(H){const ve=qf.createTextbox("Longitude","lon-distance",H.lng,!0);U.appendChild(ve);const he=qf.createTextbox("Latitude","lat-distance",H.lat,!0);U.appendChild(he)}const m=this.valhalla.getContoursOption();for(let ve=0;ve<m.length;ve+=1){const he=m[ve],ye=qf.createTextbox(`Contour ${ve+1} (km)`,`contour-distance-${ve}`,he.distance,!1,"number");U.appendChild(ye)}const g=document.createElement("button");g.textContent="Clear",g.classList.add("mapbox-valhalla-control-button"),g.addEventListener("click",()=>{this.valhalla.clearFeatures()}),this.mainContainer.appendChild(g);const Z=document.createElement("button");return Z.textContent="Calculate",Z.classList.add("mapbox-valhalla-control-button"),Z.addEventListener("click",()=>{const ve=document.getElementById("mapbox-gl-valhalla-lon-distance"),he=document.getElementById("mapbox-gl-valhalla-lat-distance"),ye=this.valhalla.getContoursOption();for(let re=0;re<ye.length;re+=1){const it=ye[re],et=document.getElementById(`mapbox-gl-valhalla-contour-distance-${re}`);it.distance=Number(et.value)}this.valhalla.getIsochrone(Number(ve.value),Number(he.value),bg.ContourType.Distance,bg.Costing.Walking,ye)}),this.mainContainer.appendChild(Z),(D=this.map)===null||D===void 0||D.on("moveend",()=>{var ve;const he=(ve=this.map)===null||ve===void 0?void 0:ve.getCenter(),ye=document.getElementById("mapbox-gl-valhalla-lon-distance"),re=document.getElementById("mapbox-gl-valhalla-lat-distance");he||(ye.setAttribute("value",""),re.setAttribute("value",""));const it=he,et=it!=null&&it.lng?it.lng.toString():"";ye.setAttribute("value",et);const St=it!=null&&it.lat?it.lat.toString():"";re.setAttribute("value",St)}),w.appendChild(this.controlContainer),w}onDocumentClick(w){this.controlContainer&&!this.controlContainer.contains(w.target)&&this.hide()}hide(){this.mainContainer&&this.mainButton&&(this.mainContainer.style.display="none",this.mainButton.style.display="block",this.toggleCrosshair(!1))}destroy(){!this.mainContainer||!this.mainContainer.parentNode||!this.map||!this.mainButton||(this.mainButton.removeEventListener("click",this.onDocumentClick),this.mainContainer.parentNode.removeChild(this.mainContainer),document.removeEventListener("click",this.onDocumentClick),this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0),this.map=void 0)}toggleCrosshair(w){w===!1?this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0):(this.crosshair=new lb.default(this.map),this.crosshair.create())}}_m.default=ub;Object.defineProperty(cm,"__esModule",{value:!0});const cb=hm,hb=_m,pb=kd;class db{constructor(w,C){this.options={Contours:[{time:5,distance:1,color:"ff0000"},{time:10,distance:3,color:"ffff00"},{time:15,distance:5,color:"0000ff"}]},this.url=w,C&&(this.options=Object.assign(this.options,C)),this.onDocumentClick=this.onDocumentClick.bind(this)}getDefaultPosition(){return"top-right"}onAdd(w){return this.map=w,this.map&&(this.valhalla=new pb.default(this.map,this.url,this.options.Contours)),this.controlContainer=document.createElement("div"),this.timeIsochroneControl=new cb.default(this.map,this.valhalla),this.controlContainer=this.timeIsochroneControl.addTo(this.controlContainer),this.distanceIsochroneControl=new hb.default(this.map,this.valhalla),this.controlContainer=this.distanceIsochroneControl.addTo(this.controlContainer),document.addEventListener("click",this.onDocumentClick),this.controlContainer}onDocumentClick(w){this.controlContainer&&!this.controlContainer.contains(w.target)&&this.timeIsochroneControl&&this.distanceIsochroneControl&&(this.timeIsochroneControl.hide(),this.distanceIsochroneControl.hide())}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.timeIsochroneControl||!this.distanceIsochroneControl||(this.timeIsochroneControl.destroy(),this.distanceIsochroneControl.destroy(),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.map=void 0)}}cm.default=db;(function(A){Object.defineProperty(A,"__esModule",{value:!0}),A.MapboxValhallaControl=void 0;var w=cm;Object.defineProperty(A,"MapboxValhallaControl",{enumerable:!0,get:function(){return w.default}})})(py);function fb(A){let w,C;return{c(){w=zo("div"),C=zo("div"),this.h()},l(D){w=Po(D,"DIV",{class:!0});var U=vs(w);C=Po(U,"DIV",{class:!0,id:!0}),vs(C).forEach(ki),U.forEach(ki),this.h()},h(){On(C,"class","map svelte-1ljuzl6"),On(C,"id","map"),On(w,"class","map-wrap svelte-1ljuzl6")},m(D,U){cr(D,w,U),em(w,C),A[1](C)},p:Zu,i:Zu,o:Zu,d(D){D&&ki(w),A[1](null)}}}function mb(A,w,C){let D,U;Jf(async()=>{if(D=new th.exports.Map({container:U,style:Pr.styles[0].uri,center:Pr.center,zoom:Pr.zoom,hash:!0,attributionControl:!1}),D.addControl(new th.exports.NavigationControl({}),"top-right"),D.addControl(new th.exports.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),"top-right"),D.addControl(new th.exports.ScaleControl({maxWidth:80,unit:"metric"}),"bottom-left"),D.addControl(new th.exports.AttributionControl({compact:!0}),"bottom-right"),D.addControl(new hy(Pr.styles),"top-right"),D.addControl(new T0(Pr.areaSwitcher.areas),"top-right"),Pr.elevation){const ye=await(await kf(()=>import("./index-f21536e4.js").then(function(re){return re.i}),[])).default;D.addControl(new ye(Pr.elevation.url,Pr.elevation.options),"top-right")}const{MaplibreExportControl:m,Size:g,PageOrientation:Z,Format:ve,DPI:he}=await kf(()=>import("./index-1460d9a7.js").then(function(ye){return ye.i}),[]);if(D.addControl(new m({PageSize:g.A4,PageOrientation:Z.Landscape,Format:ve.PNG,DPI:he[96],Crosshair:!0,PrintableArea:!0}),"top-right"),Pr.valhalla&&D.addControl(new py.MapboxValhallaControl(Pr.valhalla.url,Pr.valhalla.options),"top-right"),Pr.legend){const{MaplibreLegendControl:ye}=await kf(()=>import("./index-8c22398c.js").then(function(re){return re.i}),[]);D.addControl(new ye(Pr.legend.targets,Pr.legend.options),"bottom-left")}Pr.popup&&D.addControl(new z0(Pr.popup.target)),Pr.search&&fetch(Pr.search.url).then(ye=>ye.json()).then(ye=>{const re=ye;function it(et){for(var St=[],vt=0;vt<re.features.length;vt++){var Xt=re.features[vt];Pr.search.target.forEach(Wt=>{var _t=Xt.properties[Wt];!_t||_t.toString().toLowerCase().search(et.toString().toLowerCase())!==-1&&(Xt.place_name=Pr.search.format(Xt.properties),Xt.center=Xt.geometry.coordinates,Xt.place_type=Pr.search.place_type,St.push(Xt))})}return St}D.addControl(new S0({localGeocoder:it,localGeocoderOnly:!0,zoom:Pr.search.zoom,placeholder:Pr.search.placeholder,mapboxgl:fv}),"top-left")})});function H(m){qs[m?"unshift":"push"](()=>{U=m,C(0,U)})}return[U,H]}class gb extends xs{constructor(w){super(),bs(this,w,mb,fb,ws,{})}}function yb(A){let w,C,D,U;return w=new pv({}),D=new gb({}),{c(){Wo(w.$$.fragment),C=Sl(),Wo(D.$$.fragment)},l(H){Ya(w.$$.fragment,H),C=Tl(H),Ya(D.$$.fragment,H)},m(H,m){Ko(w,H,m),cr(H,C,m),Ko(D,H,m),U=!0},p:Zu,i(H){U||(tn(w.$$.fragment,H),tn(D.$$.fragment,H),U=!0)},o(H){rn(w.$$.fragment,H),rn(D.$$.fragment,H),U=!1},d(H){Jo(w,H),H&&ki(C),Jo(D,H)}}}class wb extends xs{constructor(w){super(),bs(this,w,null,yb,ws,{})}}export{wb as R,ib as a,bb as b,js as c,dv as g,th as m};
