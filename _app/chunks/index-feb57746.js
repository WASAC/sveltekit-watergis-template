import{S as im,i as rm,s as nm,e as om,c as am,a as sm,d as Ip,b as Rf,g as lm,n as wp,w as by,K as wy,x as Ey,y as Sy,z as Ty,r as Iy,p as Ay,C as Cy}from"./index-0cdf69f9.js";import{_ as kd}from"./preload-helper-9dc53225.js";var Es=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function Bx(P){return P&&P.__esModule&&Object.prototype.hasOwnProperty.call(P,"default")?P.default:P}function zy(P){if(P.__esModule)return P;var M=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(P).forEach(function(j){var K=Object.getOwnPropertyDescriptor(P,j);Object.defineProperty(M,j,K.get?K:{enumerable:!0,get:function(){return P[j]}})}),M}var _c={exports:{}};(function(P,M){(function(j,K){P.exports=K()})(Es,function(){var j,K,te;function Ae(x,he){if(!j)j=he;else if(!K)K=he;else{var it="var sharedChunk = {}; ("+j+")(sharedChunk); ("+K+")(sharedChunk);",Ke={};j(Ke),te=he(Ke),typeof window!="undefined"&&(te.workerUrl=window.URL.createObjectURL(new Blob([it],{type:"text/javascript"})))}}Ae(["exports"],function(x){var he=it;function it(i,t,o,l){this.cx=3*i,this.bx=3*(o-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(l-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=o,this.p2y=l}function Ke(i,t,o,l){const p=new he(i,t,o,l);return function(m){return p.solve(m)}}it.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var o=i,l=0;l<8;l++){var p=this.sampleCurveX(o)-i;if(Math.abs(p)<t)return o;var m=this.sampleCurveDerivativeX(o);if(Math.abs(m)<1e-6)break;o-=p/m}var _=0,T=1;for(o=i,l=0;l<20&&(p=this.sampleCurveX(o),!(Math.abs(p-i)<t));l++)i>p?_=o:T=o,o=.5*(T-_)+_;return o},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};const Qe=Ke(.25,.1,.25,1);function Se(i,t,o){return Math.min(o,Math.max(t,i))}function It(i,t,o){const l=o-t,p=((i-t)%l+l)%l+t;return p===t?o:p}function yt(i,...t){for(const o of t)for(const l in o)i[l]=o[l];return i}let ti=1;function zt(i,t){i.forEach(o=>{t[o]&&(t[o]=t[o].bind(t))})}function Ei(i,t,o){const l={};for(const p in i)l[p]=t.call(o||this,i[p],p,i);return l}function mi(i,t,o){const l={};for(const p in i)t.call(o||this,i[p],p,i)&&(l[p]=i[p]);return l}function Ht(i){return Array.isArray(i)?i.map(Ht):typeof i=="object"&&i?Ei(i,Ht):i}const br={};function pi(i){br[i]||(typeof console!="undefined"&&console.warn(i),br[i]=!0)}function Si(i,t,o){return(o.y-i.y)*(t.x-i.x)>(t.y-i.y)*(o.x-i.x)}function Ni(i){let t=0;for(let o,l,p=0,m=i.length,_=m-1;p<m;_=p++)o=i[p],l=i[_],t+=(l.x-o.x)*(o.y+l.y);return t}function Lr(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function lr(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,l,p,m)=>{const _=p||m;return t[l]=!_||_.toLowerCase(),""}),t["max-age"]){const o=parseInt(t["max-age"],10);isNaN(o)?delete t["max-age"]:t["max-age"]=o}return t}let Fn,hn,no=null;function nr(i){if(no==null){const t=i.navigator?i.navigator.userAgent:null;no=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return no}function Ar(i){return typeof ImageBitmap!="undefined"&&i instanceof ImageBitmap}const Fo={now:typeof performance!="undefined"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(i){const t=requestAnimationFrame(i);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(i,t=0){const o=window.document.createElement("canvas"),l=o.getContext("2d");if(!l)throw new Error("failed to create canvas 2d context");return o.width=i.width,o.height=i.height,l.drawImage(i,0,0,i.width,i.height),l.getImageData(-t,-t,i.width+2*t,i.height+2*t)},resolveURL:i=>(Fn||(Fn=document.createElement("a")),Fn.href=i,Fn.href),hardwareConcurrency:typeof navigator!="undefined"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(hn==null&&(hn=matchMedia("(prefers-reduced-motion: reduce)")),hn.matches)}};var Yt=Un;function Un(i,t){this.x=i,this.y=t}Un.prototype={clone:function(){return new Un(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,o=i.y-this.y;return t*t+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),o=Math.sin(i),l=o*this.x+t*this.y;return this.x=t*this.x-o*this.y,this.y=l,this},_rotateAround:function(i,t){var o=Math.cos(i),l=Math.sin(i),p=t.y+l*(this.x-t.x)+o*(this.y-t.y);return this.x=t.x+o*(this.x-t.x)-l*(this.y-t.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Un.convert=function(i){return i instanceof Un?i:Array.isArray(i)?new Un(i[0],i[1]):i};const oo={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},Co="mapbox-tiles";let rn,pn,bn=500,kn=50;function Vn(){typeof caches=="undefined"||rn||(rn=caches.open(Co))}let Nn=1/0;const ao={supported:!1,testSupport:function(i){!Bi&&dn&&(so?Uo(i):_r=i)}};let _r,dn,Bi=!1,so=!1;function Uo(i){const t=i.createTexture();i.bindTexture(i.TEXTURE_2D,t);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,dn),i.isContextLost())return;ao.supported=!0}catch{}i.deleteTexture(t),Bi=!0}typeof document!="undefined"&&(dn=document.createElement("img"),dn.onload=function(){_r&&Uo(_r),_r=null,so=!0},dn.onerror=function(){Bi=!0,_r=null},dn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const jn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(jn);class ii extends Error{constructor(t,o,l,p){super(`AJAXError: ${o} (${t}): ${l}`),this.status=t,this.statusText=o,this.url=l,this.body=p}}const Mn=Lr()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function Gr(i,t){const o=new AbortController,l=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:Mn(),signal:o.signal});let p=!1,m=!1;return i.type==="json"&&l.headers.set("Accept","application/json"),((_,T,C)=>{if(m)return;const k=Date.now();fetch(l).then(R=>R.ok?((D,V,G)=>{(i.type==="arrayBuffer"?D.arrayBuffer():i.type==="json"?D.json():D.text()).then(Z=>{m||(V&&G&&function(ee,ae,we){if(Vn(),!rn)return;const ke={status:ae.status,statusText:ae.statusText,headers:new Headers};ae.headers.forEach((Be,$e)=>ke.headers.set($e,Be));const Re=lr(ae.headers.get("Cache-Control")||"");Re["no-store"]||(Re["max-age"]&&ke.headers.set("Expires",new Date(we+1e3*Re["max-age"]).toUTCString()),new Date(ke.headers.get("Expires")).getTime()-we<42e4||function(Be,$e){if(pn===void 0)try{new Response(new ReadableStream),pn=!0}catch{pn=!1}pn?$e(Be.body):Be.blob().then($e)}(ae,Be=>{const $e=new Response(Be,ke);Vn(),rn&&rn.then(Oe=>Oe.put(function(dt){const ht=dt.indexOf("?");return ht<0?dt:dt.slice(0,ht)}(ee.url),$e)).catch(Oe=>pi(Oe.message))}))}(l,V,G),p=!0,t(null,Z,D.headers.get("Cache-Control"),D.headers.get("Expires")))}).catch(Z=>{m||t(new Error(Z.message))})})(R,null,k):R.blob().then(D=>t(new ii(R.status,R.statusText,i.url,D)))).catch(R=>{R.code!==20&&t(new Error(R.message))})})(),{cancel:()=>{m=!0,p||o.abort()}}}const nn=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){if(Lr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,t);if(!Lr()){const l=i.url.substring(0,i.url.indexOf("://"));return(oo.REGISTERED_PROTOCOLS[l]||Gr)(i,t)}}if(!(/^file:/.test(o=i.url)||/^file:/.test(Mn())&&!/^\w+:/.test(o))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Gr(i,t);if(Lr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,t,void 0,!0)}var o;return function(l,p){const m=new XMLHttpRequest;m.open(l.method||"GET",l.url,!0),l.type==="arrayBuffer"&&(m.responseType="arraybuffer");for(const _ in l.headers)m.setRequestHeader(_,l.headers[_]);return l.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=l.credentials==="include",m.onerror=()=>{p(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let _=m.response;if(l.type==="json")try{_=JSON.parse(m.response)}catch(T){return p(T)}p(null,_,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else{const _=new Blob([m.response],{type:m.getResponseHeader("Content-Type")});p(new ii(m.status,m.statusText,l.url,_))}},m.send(l.body),{cancel:()=>m.abort()}}(i,t)},vo=function(i,t){return nn(yt(i,{type:"arrayBuffer"}),t)};function qn(i){const t=window.document.createElement("a");return t.href=i,t.protocol===window.document.location.protocol&&t.host===window.document.location.host}const lo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Dr,wn;Dr=[],wn=0;const Vo=function(i,t){if(ao.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),wn>=oo.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:i,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return Dr.push(m),m}wn++;let o=!1;const l=()=>{if(!o)for(o=!0,wn--;Dr.length&&wn<oo.MAX_PARALLEL_IMAGE_REQUESTS;){const m=Dr.shift(),{requestParameters:_,callback:T,cancelled:C}=m;C||(m.cancel=Vo(_,T).cancel)}},p=vo(i,(m,_,T,C)=>{l(),m?t(m):_&&function(k,R){typeof createImageBitmap=="function"?function(D,V){const G=new Blob([new Uint8Array(D)],{type:"image/png"});createImageBitmap(G).then(Z=>{V(null,Z)}).catch(Z=>{V(new Error(`Could not load image because of ${Z.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(k,R):function(D,V){const G=new Image;G.onload=()=>{V(null,G),URL.revokeObjectURL(G.src),G.onload=null,window.requestAnimationFrame(()=>{G.src=lo})},G.onerror=()=>V(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const Z=new Blob([new Uint8Array(D)],{type:"image/png"});G.src=D.byteLength?URL.createObjectURL(Z):lo}(k,R)}(_,(k,R)=>{k!=null?t(k):R!=null&&t(null,R,{cacheControl:T,expires:C})})});return{cancel:()=>{p.cancel(),l()}}};function yi(i,t,o){o[i]&&o[i].indexOf(t)!==-1||(o[i]=o[i]||[],o[i].push(t))}function on(i,t,o){if(o&&o[i]){const l=o[i].indexOf(t);l!==-1&&o[i].splice(l,1)}}class Gn{constructor(t,o={}){yt(this,o),this.type=t}}class fn extends Gn{constructor(t,o={}){super("error",yt({error:t},o))}}class xa{on(t,o){return this._listeners=this._listeners||{},yi(t,o,this._listeners),this}off(t,o){return on(t,o,this._listeners),on(t,o,this._oneTimeListeners),this}once(t,o){return this._oneTimeListeners=this._oneTimeListeners||{},yi(t,o,this._oneTimeListeners),this}fire(t,o){typeof t=="string"&&(t=new Gn(t,o||{}));const l=t.type;if(this.listens(l)){t.target=this;const p=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const T of p)T.call(this,t);const m=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const T of m)on(l,T,this._oneTimeListeners),T.call(this,t);const _=this._eventedParent;_&&(yt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(t))}else t instanceof fn&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,o){return this._eventedParent=t,this._eventedParentData=o,this}}var ot={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Lt{constructor(t,o,l,p){this.message=(t?`${t}: `:"")+l,p&&(this.identifier=p),o!=null&&o.__line__&&(this.line=o.__line__)}}function zo(i){const t=i.value;return t?[new Lt(i.key,t,"constants have been deprecated as of v8")]:[]}function Zn(i,...t){for(const o of t)for(const l in o)i[l]=o[l];return i}function Ki(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function mn(i){if(Array.isArray(i))return i.map(mn);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const o in i)t[o]=mn(i[o]);return t}return Ki(i)}class Zr extends Error{constructor(t,o){super(o),this.message=o,this.key=t}}class uo{constructor(t,o=[]){this.parent=t,this.bindings={};for(const[l,p]of o)this.bindings[l]=p}concat(t){return new uo(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const er={kind:"null"},Ct={kind:"number"},Ti={kind:"string"},gi={kind:"boolean"},Rr={kind:"color"},$r={kind:"object"},ui={kind:"value"},xo={kind:"collator"},Ln={kind:"formatted"},Ji={kind:"resolvedImage"};function X(i,t){return{kind:"array",itemType:i,N:t}}function Y(i){if(i.kind==="array"){const t=Y(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}const ie=[er,Ct,Ti,gi,Rr,Ln,$r,X(ui),Ji];function pe(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!pe(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(const o of ie)if(!pe(o,t))return null}}return`Expected ${Y(i)} but found ${Y(t)} instead.`}function xe(i,t){return t.some(o=>o.kind===i.kind)}function Me(i,t){return t.some(o=>o==="null"?i===null:o==="array"?Array.isArray(i):o==="object"?i&&!Array.isArray(i)&&typeof i=="object":o===typeof i)}var De,ce={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ie(i){return(i=Math.round(i))<0?0:i>255?255:i}function qe(i){return Ie(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function Q(i){return(t=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:t>1?1:t;var t}function F(i,t,o){return o<0?o+=1:o>1&&(o-=1),6*o<1?i+(t-i)*o*6:2*o<1?t:3*o<2?i+(t-i)*(2/3-o)*6:i}try{De={}.parseCSSColor=function(i){var t,o=i.replace(/ /g,"").toLowerCase();if(o in ce)return ce[o].slice();if(o[0]==="#")return o.length===4?(t=parseInt(o.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:o.length===7&&(t=parseInt(o.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var l=o.indexOf("("),p=o.indexOf(")");if(l!==-1&&p+1===o.length){var m=o.substr(0,l),_=o.substr(l+1,p-(l+1)).split(","),T=1;switch(m){case"rgba":if(_.length!==4)return null;T=Q(_.pop());case"rgb":return _.length!==3?null:[qe(_[0]),qe(_[1]),qe(_[2]),T];case"hsla":if(_.length!==4)return null;T=Q(_.pop());case"hsl":if(_.length!==3)return null;var C=(parseFloat(_[0])%360+360)%360/360,k=Q(_[1]),R=Q(_[2]),D=R<=.5?R*(k+1):R+k-R*k,V=2*R-D;return[Ie(255*F(V,D,C+1/3)),Ie(255*F(V,D,C)),Ie(255*F(V,D,C-1/3)),T];default:return null}}return null}}catch{}class U{constructor(t,o,l,p=1){this.r=t,this.g=o,this.b=l,this.a=p}static parse(t){if(!t)return;if(t instanceof U)return t;if(typeof t!="string")return;const o=De(t);return o?new U(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3]):void 0}toString(){const[t,o,l,p]=this.toArray();return`rgba(${Math.round(t)},${Math.round(o)},${Math.round(l)},${p})`}toArray(){const{r:t,g:o,b:l,a:p}=this;return p===0?[0,0,0,0]:[255*t/p,255*o/p,255*l/p,p]}}U.black=new U(0,0,0,1),U.white=new U(1,1,1,1),U.transparent=new U(0,0,0,0),U.red=new U(1,0,0,1);class J{constructor(t,o,l){this.sensitivity=t?o?"variant":"case":o?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,o){return this.collator.compare(t,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ne{constructor(t,o,l,p,m){this.text=t,this.image=o,this.scale=l,this.fontStack=p,this.textColor=m}}class de{constructor(t){this.sections=t}static fromString(t){return new de([new ne(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof de?t:de.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const o of this.sections){if(o.image){t.push(["image",o.image.name]);continue}t.push(o.text);const l={};o.fontStack&&(l["text-font"]=["literal",o.fontStack.split(",")]),o.scale&&(l["font-scale"]=o.scale),o.textColor&&(l["text-color"]=["rgba"].concat(o.textColor.toArray())),t.push(l)}return t}}class le{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new le({name:t,available:!1}):null}serialize(){return["image",this.name]}}function _e(i,t,o,l){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof o=="number"&&o>=0&&o<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[i,t,o,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[i,t,o,l]:[i,t,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ge(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof U||i instanceof J||i instanceof de||i instanceof le)return!0;if(Array.isArray(i)){for(const t of i)if(!ge(t))return!1;return!0}if(typeof i=="object"){for(const t in i)if(!ge(i[t]))return!1;return!0}return!1}function ve(i){if(i===null)return er;if(typeof i=="string")return Ti;if(typeof i=="boolean")return gi;if(typeof i=="number")return Ct;if(i instanceof U)return Rr;if(i instanceof J)return xo;if(i instanceof de)return Ln;if(i instanceof le)return Ji;if(Array.isArray(i)){const t=i.length;let o;for(const l of i){const p=ve(l);if(o){if(o===p)continue;o=ui;break}o=p}return X(o||ui,t)}return $r}function Ge(i){const t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof U||i instanceof de||i instanceof le?i.toString():JSON.stringify(i)}class Ue{constructor(t,o){this.type=t,this.value=o}static parse(t,o){if(t.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!ge(t[1]))return o.error("invalid value");const l=t[1];let p=ve(l);const m=o.expectedType;return p.kind!=="array"||p.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(p=m),new Ue(p,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof U?["rgba"].concat(this.value.toArray()):this.value instanceof de?this.value.serialize():this.value}}class Ze{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const bt={string:Ti,number:Ct,boolean:gi,object:$r};class pt{constructor(t,o){this.type=t,this.args=o}static parse(t,o){if(t.length<2)return o.error("Expected at least one argument.");let l,p=1;const m=t[0];if(m==="array"){let T,C;if(t.length>2){const k=t[1];if(typeof k!="string"||!(k in bt)||k==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);T=bt[k],p++}else T=ui;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return o.error('The length argument to "array" must be a positive integer literal',2);C=t[2],p++}l=X(T,C)}else l=bt[m];const _=[];for(;p<t.length;p++){const T=o.parse(t[p],p,ui);if(!T)return null;_.push(T)}return new pt(l,_)}evaluate(t){for(let o=0;o<this.args.length;o++){const l=this.args[o].evaluate(t);if(!pe(this.type,ve(l)))return l;if(o===this.args.length-1)throw new Ze(`Expected value to be of type ${Y(this.type)}, but found ${Y(ve(l))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,o=[t.kind];if(t.kind==="array"){const l=t.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){o.push(l.kind);const p=t.N;(typeof p=="number"||this.args.length>1)&&o.push(p)}}return o.concat(this.args.map(l=>l.serialize()))}}class vt{constructor(t){this.type=Ln,this.sections=t}static parse(t,o){if(t.length<2)return o.error("Expected at least one argument.");const l=t[1];if(!Array.isArray(l)&&typeof l=="object")return o.error("First argument must be an image or text section.");const p=[];let m=!1;for(let _=1;_<=t.length-1;++_){const T=t[_];if(m&&typeof T=="object"&&!Array.isArray(T)){m=!1;let C=null;if(T["font-scale"]&&(C=o.parse(T["font-scale"],1,Ct),!C))return null;let k=null;if(T["text-font"]&&(k=o.parse(T["text-font"],1,X(Ti)),!k))return null;let R=null;if(T["text-color"]&&(R=o.parse(T["text-color"],1,Rr),!R))return null;const D=p[p.length-1];D.scale=C,D.font=k,D.textColor=R}else{const C=o.parse(t[_],1,ui);if(!C)return null;const k=C.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,p.push({content:C,scale:null,font:null,textColor:null})}}return new vt(p)}evaluate(t){return new de(this.sections.map(o=>{const l=o.content.evaluate(t);return ve(l)===Ji?new ne("",l,null,null,null):new ne(Ge(l),null,o.scale?o.scale.evaluate(t):null,o.font?o.font.evaluate(t).join(","):null,o.textColor?o.textColor.evaluate(t):null)}))}eachChild(t){for(const o of this.sections)t(o.content),o.scale&&t(o.scale),o.font&&t(o.font),o.textColor&&t(o.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const o of this.sections){t.push(o.content.serialize());const l={};o.scale&&(l["font-scale"]=o.scale.serialize()),o.font&&(l["text-font"]=o.font.serialize()),o.textColor&&(l["text-color"]=o.textColor.serialize()),t.push(l)}return t}}class Et{constructor(t){this.type=Ji,this.input=t}static parse(t,o){if(t.length!==2)return o.error("Expected two arguments.");const l=o.parse(t[1],1,Ti);return l?new Et(l):o.error("No image name provided.")}evaluate(t){const o=this.input.evaluate(t),l=le.fromString(o);return l&&t.availableImages&&(l.available=t.availableImages.indexOf(o)>-1),l}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const di={"to-boolean":gi,"to-color":Rr,"to-number":Ct,"to-string":Ti};class $t{constructor(t,o){this.type=t,this.args=o}static parse(t,o){if(t.length<2)return o.error("Expected at least one argument.");const l=t[0];if((l==="to-boolean"||l==="to-string")&&t.length!==2)return o.error("Expected one argument.");const p=di[l],m=[];for(let _=1;_<t.length;_++){const T=o.parse(t[_],_,ui);if(!T)return null;m.push(T)}return new $t(p,m)}evaluate(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){let o,l;for(const p of this.args){if(o=p.evaluate(t),l=null,o instanceof U)return o;if(typeof o=="string"){const m=t.parseColor(o);if(m)return m}else if(Array.isArray(o)&&(l=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:_e(o[0],o[1],o[2],o[3]),!l))return new U(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Ze(l||`Could not parse color from value '${typeof o=="string"?o:String(JSON.stringify(o))}'`)}if(this.type.kind==="number"){let o=null;for(const l of this.args){if(o=l.evaluate(t),o===null)return 0;const p=Number(o);if(!isNaN(p))return p}throw new Ze(`Could not convert ${JSON.stringify(o)} to number.`)}return this.type.kind==="formatted"?de.fromString(Ge(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?le.fromString(Ge(this.args[0].evaluate(t))):Ge(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new vt([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Et(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild(o=>{t.push(o.serialize())}),t}}const Jt=["Unknown","Point","LineString","Polygon"];class Nt{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Jt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let o=this._parseColorCache[t];return o||(o=this._parseColorCache[t]=U.parse(t)),o}}class Pt{constructor(t,o,l,p){this.name=t,this.type=o,this._evaluate=l,this.args=p}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,o){const l=t[0],p=Pt.definitions[l];if(!p)return o.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(p)?p[0]:p.type,_=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,T=_.filter(([k])=>!Array.isArray(k)||k.length===t.length-1);let C=null;for(const[k,R]of T){C=new No(o.registry,o.path,null,o.scope);const D=[];let V=!1;for(let G=1;G<t.length;G++){const Z=t[G],ee=Array.isArray(k)?k[G-1]:k.type,ae=C.parse(Z,1+D.length,ee);if(!ae){V=!0;break}D.push(ae)}if(!V)if(Array.isArray(k)&&k.length!==D.length)C.error(`Expected ${k.length} arguments, but found ${D.length} instead.`);else{for(let G=0;G<D.length;G++){const Z=Array.isArray(k)?k[G]:k.type,ee=D[G];C.concat(G+1).checkSubtype(Z,ee.type)}if(C.errors.length===0)return new Pt(l,m,R,D)}}if(T.length===1)o.errors.push(...C.errors);else{const k=(T.length?T:_).map(([D])=>{return V=D,Array.isArray(V)?`(${V.map(Y).join(", ")})`:`(${Y(V.type)}...)`;var V}).join(" | "),R=[];for(let D=1;D<t.length;D++){const V=o.parse(t[D],1+R.length);if(!V)return null;R.push(Y(V.type))}o.error(`Expected arguments of type ${k}, but found (${R.join(", ")}) instead.`)}return null}static register(t,o){Pt.definitions=o;for(const l in o)t[l]=Pt}}class oi{constructor(t,o,l){this.type=xo,this.locale=l,this.caseSensitive=t,this.diacriticSensitive=o}static parse(t,o){if(t.length!==2)return o.error("Expected one argument.");const l=t[1];if(typeof l!="object"||Array.isArray(l))return o.error("Collator options argument must be an object.");const p=o.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,gi);if(!p)return null;const m=o.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,gi);if(!m)return null;let _=null;return l.locale&&(_=o.parse(l.locale,1,Ti),!_)?null:new oi(p,m,_)}evaluate(t){return new J(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const Oi=8192;function Cr(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function Fi(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function yn(i,t){const o=(180+i[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,p=Math.pow(2,t.z);return[Math.round(o*p*Oi),Math.round(l*p*Oi)]}function Ss(i,t,o){const l=i[0]-t[0],p=i[1]-t[1],m=i[0]-o[0],_=i[1]-o[1];return l*_-m*p==0&&l*m<=0&&p*_<=0}function $i(i,t){let o=!1;for(let _=0,T=t.length;_<T;_++){const C=t[_];for(let k=0,R=C.length;k<R-1;k++){if(Ss(i,C[k],C[k+1]))return!1;(p=C[k])[1]>(l=i)[1]!=(m=C[k+1])[1]>l[1]&&l[0]<(m[0]-p[0])*(l[1]-p[1])/(m[1]-p[1])+p[0]&&(o=!o)}}var l,p,m;return o}function wr(i,t){for(let o=0;o<t.length;o++)if($i(i,t[o]))return!0;return!1}function Ua(i,t,o,l){const p=l[0]-o[0],m=l[1]-o[1],_=(i[0]-o[0])*m-p*(i[1]-o[1]),T=(t[0]-o[0])*m-p*(t[1]-o[1]);return _>0&&T<0||_<0&&T>0}function En(i,t,o){for(const k of o)for(let R=0;R<k.length-1;++R)if((T=[(_=k[R+1])[0]-(m=k[R])[0],_[1]-m[1]])[0]*(C=[(p=t)[0]-(l=i)[0],p[1]-l[1]])[1]-T[1]*C[0]!=0&&Ua(l,p,m,_)&&Ua(m,_,l,p))return!0;var l,p,m,_,T,C;return!1}function Br(i,t){for(let o=0;o<i.length;++o)if(!$i(i[o],t))return!1;for(let o=0;o<i.length-1;++o)if(En(i[o],i[o+1],t))return!1;return!0}function co(i,t){for(let o=0;o<t.length;o++)if(Br(i,t[o]))return!0;return!1}function tr(i,t,o){const l=[];for(let p=0;p<i.length;p++){const m=[];for(let _=0;_<i[p].length;_++){const T=yn(i[p][_],o);Cr(t,T),m.push(T)}l.push(m)}return l}function ho(i,t,o){const l=[];for(let p=0;p<i.length;p++){const m=tr(i[p],t,o);l.push(m)}return l}function Dn(i,t,o,l){if(i[0]<o[0]||i[0]>o[2]){const p=.5*l;let m=i[0]-o[0]>p?-l:o[0]-i[0]>p?l:0;m===0&&(m=i[0]-o[2]>p?-l:o[2]-i[0]>p?l:0),i[0]+=m}Cr(t,i)}function Rl(i,t,o,l){const p=Math.pow(2,l.z)*Oi,m=[l.x*Oi,l.y*Oi],_=[];for(const T of i)for(const C of T){const k=[C.x+m[0],C.y+m[1]];Dn(k,t,o,p),_.push(k)}return _}function po(i,t,o,l){const p=Math.pow(2,l.z)*Oi,m=[l.x*Oi,l.y*Oi],_=[];for(const C of i){const k=[];for(const R of C){const D=[R.x+m[0],R.y+m[1]];Cr(t,D),k.push(D)}_.push(k)}if(t[2]-t[0]<=p/2){(T=t)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const C of _)for(const k of C)Dn(k,t,o,p)}var T;return _}class Va{constructor(t,o){this.type=gi,this.geojson=t,this.geometries=o}static parse(t,o){if(t.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ge(t[1])){const l=t[1];if(l.type==="FeatureCollection")for(let p=0;p<l.features.length;++p){const m=l.features[p].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Va(l,l.features[p].geometry)}else if(l.type==="Feature"){const p=l.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Va(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new Va(l,l)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(o,l){const p=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=o.canonicalID();if(l.type==="Polygon"){const T=tr(l.coordinates,m,_),C=Rl(o.geometry(),p,m,_);if(!Fi(p,m))return!1;for(const k of C)if(!$i(k,T))return!1}if(l.type==="MultiPolygon"){const T=ho(l.coordinates,m,_),C=Rl(o.geometry(),p,m,_);if(!Fi(p,m))return!1;for(const k of C)if(!wr(k,T))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(o,l){const p=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=o.canonicalID();if(l.type==="Polygon"){const T=tr(l.coordinates,m,_),C=po(o.geometry(),p,m,_);if(!Fi(p,m))return!1;for(const k of C)if(!Br(k,T))return!1}if(l.type==="MultiPolygon"){const T=ho(l.coordinates,m,_),C=po(o.geometry(),p,m,_);if(!Fi(p,m))return!1;for(const k of C)if(!co(k,T))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function bo(i){if(i instanceof Pt&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Va)return!1;let t=!0;return i.eachChild(o=>{t&&!bo(o)&&(t=!1)}),t}function Er(i){if(i instanceof Pt&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(o=>{t&&!Er(o)&&(t=!1)}),t}function $n(i,t){if(i instanceof Pt&&t.indexOf(i.name)>=0)return!1;let o=!0;return i.eachChild(l=>{o&&!$n(l,t)&&(o=!1)}),o}class Xr{constructor(t,o){this.type=o.type,this.name=t,this.boundExpression=o}static parse(t,o){if(t.length!==2||typeof t[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const l=t[1];return o.scope.has(l)?new Xr(l,o.scope.get(l)):o.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class No{constructor(t,o=[],l,p=new uo,m=[]){this.registry=t,this.path=o,this.key=o.map(_=>`[${_}]`).join(""),this.scope=p,this.errors=m,this.expectedType=l}parse(t,o,l,p,m={}){return o?this.concat(o,l,p)._parse(t,m):this._parse(t,m)}_parse(t,o){function l(p,m,_){return _==="assert"?new pt(m,[p]):_==="coerce"?new $t(m,[p]):p}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=t[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[p];if(m){let _=m.parse(t,this);if(!_)return null;if(this.expectedType){const T=this.expectedType,C=_.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||C.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||C.kind!=="value"&&C.kind!=="string"){if(this.checkSubtype(T,C))return null}else _=l(_,T,o.typeAnnotation||"coerce");else _=l(_,T,o.typeAnnotation||"assert")}if(!(_ instanceof Ue)&&_.type.kind!=="resolvedImage"&&Ts(_)){const T=new Nt;try{_=new Ue(_.type,_.evaluate(T))}catch(C){return this.error(C.message),null}}return _}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,o,l){const p=typeof t=="number"?this.path.concat(t):this.path,m=l?this.scope.concat(l):this.scope;return new No(this.registry,p,o||null,m,this.errors)}error(t,...o){const l=`${this.key}${o.map(p=>`[${p}]`).join("")}`;this.errors.push(new Zr(l,t))}checkSubtype(t,o){const l=pe(t,o);return l&&this.error(l),l}}function Ts(i){if(i instanceof Xr)return Ts(i.boundExpression);if(i instanceof Pt&&i.name==="error"||i instanceof oi||i instanceof Va)return!1;const t=i instanceof $t||i instanceof pt;let o=!0;return i.eachChild(l=>{o=t?o&&Ts(l):o&&l instanceof Ue}),!!o&&bo(i)&&$n(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ol(i,t){const o=i.length-1;let l,p,m=0,_=o,T=0;for(;m<=_;)if(T=Math.floor((m+_)/2),l=i[T],p=i[T+1],l<=t){if(T===o||t<p)return T;m=T+1}else{if(!(l>t))throw new Ze("Input is not a number.");_=T-1}return 0}class Na{constructor(t,o,l){this.type=t,this.input=o,this.labels=[],this.outputs=[];for(const[p,m]of l)this.labels.push(p),this.outputs.push(m)}static parse(t,o){if(t.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");const l=o.parse(t[1],1,Ct);if(!l)return null;const p=[];let m=null;o.expectedType&&o.expectedType.kind!=="value"&&(m=o.expectedType);for(let _=1;_<t.length;_+=2){const T=_===1?-1/0:t[_],C=t[_+1],k=_,R=_+1;if(typeof T!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(p.length&&p[p.length-1][0]>=T)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const D=o.parse(C,R,m);if(!D)return null;m=m||D.type,p.push([T,D])}return new Na(m,l,p)}evaluate(t){const o=this.labels,l=this.outputs;if(o.length===1)return l[0].evaluate(t);const p=this.input.evaluate(t);if(p<=o[0])return l[0].evaluate(t);const m=o.length;return p>=o[m-1]?l[m-1].evaluate(t):l[ol(o,p)].evaluate(t)}eachChild(t){t(this.input);for(const o of this.outputs)t(o)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let o=0;o<this.labels.length;o++)o>0&&t.push(this.labels[o]),t.push(this.outputs[o].serialize());return t}}function Vr(i,t,o){return i*(1-o)+t*o}var os=Object.freeze({__proto__:null,number:Vr,color:function(i,t,o){return new U(Vr(i.r,t.r,o),Vr(i.g,t.g,o),Vr(i.b,t.b,o),Vr(i.a,t.a,o))},array:function(i,t,o){return i.map((l,p)=>Vr(l,t[p],o))}});const Bl=.95047,Ol=1.08883,Fl=4/29,ia=6/29,Is=3*ia*ia,As=Math.PI/180,pu=180/Math.PI;function as(i){return i>.008856451679035631?Math.pow(i,1/3):i/Is+Fl}function Xn(i){return i>ia?i*i*i:Is*(i-Fl)}function jo(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function qo(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function ba(i){const t=qo(i.r),o=qo(i.g),l=qo(i.b),p=as((.4124564*t+.3575761*o+.1804375*l)/Bl),m=as((.2126729*t+.7151522*o+.072175*l)/1);return{l:116*m-16,a:500*(p-m),b:200*(m-as((.0193339*t+.119192*o+.9503041*l)/Ol)),alpha:i.a}}function Pi(i){let t=(i.l+16)/116,o=isNaN(i.a)?t:t+i.a/500,l=isNaN(i.b)?t:t-i.b/200;return t=1*Xn(t),o=Bl*Xn(o),l=Ol*Xn(l),new U(jo(3.2404542*o-1.5371385*t-.4985314*l),jo(-.969266*o+1.8760108*t+.041556*l),jo(.0556434*o-.2040259*t+1.0572252*l),i.alpha)}function wa(i,t,o){const l=t-i;return i+o*(l>180||l<-180?l-360*Math.round(l/360):l)}const Ea={forward:ba,reverse:Pi,interpolate:function(i,t,o){return{l:Vr(i.l,t.l,o),a:Vr(i.a,t.a,o),b:Vr(i.b,t.b,o),alpha:Vr(i.alpha,t.alpha,o)}}},an={forward:function(i){const{l:t,a:o,b:l}=ba(i),p=Math.atan2(l,o)*pu;return{h:p<0?p+360:p,c:Math.sqrt(o*o+l*l),l:t,alpha:i.a}},reverse:function(i){const t=i.h*As,o=i.c;return Pi({l:i.l,a:Math.cos(t)*o,b:Math.sin(t)*o,alpha:i.alpha})},interpolate:function(i,t,o){return{h:wa(i.h,t.h,o),c:Vr(i.c,t.c,o),l:Vr(i.l,t.l,o),alpha:Vr(i.alpha,t.alpha,o)}}};var Sr=Object.freeze({__proto__:null,lab:Ea,hcl:an});class sn{constructor(t,o,l,p,m){this.type=t,this.operator=o,this.interpolation=l,this.input=p,this.labels=[],this.outputs=[];for(const[_,T]of m)this.labels.push(_),this.outputs.push(T)}static interpolationFactor(t,o,l,p){let m=0;if(t.name==="exponential")m=al(o,t.base,l,p);else if(t.name==="linear")m=al(o,1,l,p);else if(t.name==="cubic-bezier"){const _=t.controlPoints;m=new he(_[0],_[1],_[2],_[3]).solve(al(o,1,l,p))}return m}static parse(t,o){let[l,p,m,..._]=t;if(!Array.isArray(p)||p.length===0)return o.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const k=p[1];if(typeof k!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:k}}else{if(p[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const k=p.slice(1);if(k.length!==4||k.some(R=>typeof R!="number"||R<0||R>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:k}}}if(t.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(m=o.parse(m,2,Ct),!m)return null;const T=[];let C=null;l==="interpolate-hcl"||l==="interpolate-lab"?C=Rr:o.expectedType&&o.expectedType.kind!=="value"&&(C=o.expectedType);for(let k=0;k<_.length;k+=2){const R=_[k],D=_[k+1],V=k+3,G=k+4;if(typeof R!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(T.length&&T[T.length-1][0]>=R)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',V);const Z=o.parse(D,G,C);if(!Z)return null;C=C||Z.type,T.push([R,Z])}return C.kind==="number"||C.kind==="color"||C.kind==="array"&&C.itemType.kind==="number"&&typeof C.N=="number"?new sn(C,l,p,m,T):o.error(`Type ${Y(C)} is not interpolatable.`)}evaluate(t){const o=this.labels,l=this.outputs;if(o.length===1)return l[0].evaluate(t);const p=this.input.evaluate(t);if(p<=o[0])return l[0].evaluate(t);const m=o.length;if(p>=o[m-1])return l[m-1].evaluate(t);const _=ol(o,p),T=sn.interpolationFactor(this.interpolation,p,o[_],o[_+1]),C=l[_].evaluate(t),k=l[_+1].evaluate(t);return this.operator==="interpolate"?os[this.type.kind.toLowerCase()](C,k,T):this.operator==="interpolate-hcl"?an.reverse(an.interpolate(an.forward(C),an.forward(k),T)):Ea.reverse(Ea.interpolate(Ea.forward(C),Ea.forward(k),T))}eachChild(t){t(this.input);for(const o of this.outputs)t(o)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const o=[this.operator,t,this.input.serialize()];for(let l=0;l<this.labels.length;l++)o.push(this.labels[l],this.outputs[l].serialize());return o}}function al(i,t,o,l){const p=l-o,m=i-o;return p===0?0:t===1?m/p:(Math.pow(t,m)-1)/(Math.pow(t,p)-1)}class sl{constructor(t,o){this.type=t,this.args=o}static parse(t,o){if(t.length<2)return o.error("Expectected at least one argument.");let l=null;const p=o.expectedType;p&&p.kind!=="value"&&(l=p);const m=[];for(const T of t.slice(1)){const C=o.parse(T,1+m.length,l,void 0,{typeAnnotation:"omit"});if(!C)return null;l=l||C.type,m.push(C)}const _=p&&m.some(T=>pe(p,T.type));return new sl(_?ui:l,m)}evaluate(t){let o,l=null,p=0;for(const m of this.args)if(p++,l=m.evaluate(t),l&&l instanceof le&&!l.available&&(o||(o=l.name),l=null,p===this.args.length&&(l=o)),l!==null)break;return l}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(o=>{t.push(o.serialize())}),t}}class ll{constructor(t,o){this.type=o.type,this.bindings=[].concat(t),this.result=o}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const o of this.bindings)t(o[1]);t(this.result)}static parse(t,o){if(t.length<4)return o.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const l=[];for(let m=1;m<t.length-1;m+=2){const _=t[m];if(typeof _!="string")return o.error(`Expected string, but found ${typeof _} instead.`,m);if(/[^a-zA-Z0-9_]/.test(_))return o.error("Variable names must contain only alphanumeric characters or '_'.",m);const T=o.parse(t[m+1],m+1);if(!T)return null;l.push([_,T])}const p=o.parse(t[t.length-1],t.length-1,o.expectedType,l);return p?new ll(l,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[o,l]of this.bindings)t.push(o,l.serialize());return t.push(this.result.serialize()),t}}class Cs{constructor(t,o,l){this.type=t,this.index=o,this.input=l}static parse(t,o){if(t.length!==3)return o.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=o.parse(t[1],1,Ct),p=o.parse(t[2],2,X(o.expectedType||ui));return l&&p?new Cs(p.type.itemType,l,p):null}evaluate(t){const o=this.index.evaluate(t),l=this.input.evaluate(t);if(o<0)throw new Ze(`Array index out of bounds: ${o} < 0.`);if(o>=l.length)throw new Ze(`Array index out of bounds: ${o} > ${l.length-1}.`);if(o!==Math.floor(o))throw new Ze(`Array index must be an integer, but found ${o} instead.`);return l[o]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class zs{constructor(t,o){this.type=gi,this.needle=t,this.haystack=o}static parse(t,o){if(t.length!==3)return o.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=o.parse(t[1],1,ui),p=o.parse(t[2],2,ui);return l&&p?xe(l.type,[gi,Ti,Ct,er,ui])?new zs(l,p):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Y(l.type)} instead`):null}evaluate(t){const o=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!l)return!1;if(!Me(o,["boolean","string","number","null"]))throw new Ze(`Expected first argument to be of type boolean, string, number or null, but found ${Y(ve(o))} instead.`);if(!Me(l,["string","array"]))throw new Ze(`Expected second argument to be of type array or string, but found ${Y(ve(l))} instead.`);return l.indexOf(o)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class ss{constructor(t,o,l){this.type=Ct,this.needle=t,this.haystack=o,this.fromIndex=l}static parse(t,o){if(t.length<=2||t.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=o.parse(t[1],1,ui),p=o.parse(t[2],2,ui);if(!l||!p)return null;if(!xe(l.type,[gi,Ti,Ct,er,ui]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Y(l.type)} instead`);if(t.length===4){const m=o.parse(t[3],3,Ct);return m?new ss(l,p,m):null}return new ss(l,p)}evaluate(t){const o=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!Me(o,["boolean","string","number","null"]))throw new Ze(`Expected first argument to be of type boolean, string, number or null, but found ${Y(ve(o))} instead.`);if(!Me(l,["string","array"]))throw new Ze(`Expected second argument to be of type array or string, but found ${Y(ve(l))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(t);return l.indexOf(o,p)}return l.indexOf(o)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Ps{constructor(t,o,l,p,m,_){this.inputType=t,this.type=o,this.input=l,this.cases=p,this.outputs=m,this.otherwise=_}static parse(t,o){if(t.length<5)return o.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return o.error("Expected an even number of arguments.");let l,p;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);const m={},_=[];for(let k=2;k<t.length-1;k+=2){let R=t[k];const D=t[k+1];Array.isArray(R)||(R=[R]);const V=o.concat(k);if(R.length===0)return V.error("Expected at least one branch label.");for(const Z of R){if(typeof Z!="number"&&typeof Z!="string")return V.error("Branch labels must be numbers or strings.");if(typeof Z=="number"&&Math.abs(Z)>Number.MAX_SAFE_INTEGER)return V.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Z=="number"&&Math.floor(Z)!==Z)return V.error("Numeric branch labels must be integer values.");if(l){if(V.checkSubtype(l,ve(Z)))return null}else l=ve(Z);if(m[String(Z)]!==void 0)return V.error("Branch labels must be unique.");m[String(Z)]=_.length}const G=o.parse(D,k,p);if(!G)return null;p=p||G.type,_.push(G)}const T=o.parse(t[1],1,ui);if(!T)return null;const C=o.parse(t[t.length-1],t.length-1,p);return C?T.type.kind!=="value"&&o.concat(1).checkSubtype(l,T.type)?null:new Ps(l,p,T,m,_,C):null}evaluate(t){const o=this.input.evaluate(t);return(ve(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],o=Object.keys(this.cases).sort(),l=[],p={};for(const _ of o){const T=p[this.cases[_]];T===void 0?(p[this.cases[_]]=l.length,l.push([this.cases[_],[_]])):l[T][1].push(_)}const m=_=>this.inputType.kind==="number"?Number(_):_;for(const[_,T]of l)t.push(T.length===1?m(T[0]):T.map(m)),t.push(this.outputs[_].serialize());return t.push(this.otherwise.serialize()),t}}class ul{constructor(t,o,l){this.type=t,this.branches=o,this.otherwise=l}static parse(t,o){if(t.length<4)return o.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return o.error("Expected an odd number of arguments.");let l;o.expectedType&&o.expectedType.kind!=="value"&&(l=o.expectedType);const p=[];for(let _=1;_<t.length-1;_+=2){const T=o.parse(t[_],_,gi);if(!T)return null;const C=o.parse(t[_+1],_+1,l);if(!C)return null;p.push([T,C]),l=l||C.type}const m=o.parse(t[t.length-1],t.length-1,l);return m?new ul(l,p,m):null}evaluate(t){for(const[o,l]of this.branches)if(o.evaluate(t))return l.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[o,l]of this.branches)t(o),t(l);t(this.otherwise)}outputDefined(){return this.branches.every(([t,o])=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(o=>{t.push(o.serialize())}),t}}class ks{constructor(t,o,l,p){this.type=t,this.input=o,this.beginIndex=l,this.endIndex=p}static parse(t,o){if(t.length<=2||t.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=o.parse(t[1],1,ui),p=o.parse(t[2],2,Ct);if(!l||!p)return null;if(!xe(l.type,[X(ui),Ti,ui]))return o.error(`Expected first argument to be of type array or string, but found ${Y(l.type)} instead`);if(t.length===4){const m=o.parse(t[3],3,Ct);return m?new ks(l.type,l,p,m):null}return new ks(l.type,l,p)}evaluate(t){const o=this.input.evaluate(t),l=this.beginIndex.evaluate(t);if(!Me(o,["string","array"]))throw new Ze(`Expected first argument to be of type array or string, but found ${Y(ve(o))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(t);return o.slice(l,p)}return o.slice(l)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function du(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function ls(i,t,o,l){return l.compare(t,o)===0}function Go(i,t,o){const l=i!=="=="&&i!=="!=";return class um{constructor(m,_,T){this.type=gi,this.lhs=m,this.rhs=_,this.collator=T,this.hasUntypedArgument=m.type.kind==="value"||_.type.kind==="value"}static parse(m,_){if(m.length!==3&&m.length!==4)return _.error("Expected two or three arguments.");const T=m[0];let C=_.parse(m[1],1,ui);if(!C)return null;if(!du(T,C.type))return _.concat(1).error(`"${T}" comparisons are not supported for type '${Y(C.type)}'.`);let k=_.parse(m[2],2,ui);if(!k)return null;if(!du(T,k.type))return _.concat(2).error(`"${T}" comparisons are not supported for type '${Y(k.type)}'.`);if(C.type.kind!==k.type.kind&&C.type.kind!=="value"&&k.type.kind!=="value")return _.error(`Cannot compare types '${Y(C.type)}' and '${Y(k.type)}'.`);l&&(C.type.kind==="value"&&k.type.kind!=="value"?C=new pt(k.type,[C]):C.type.kind!=="value"&&k.type.kind==="value"&&(k=new pt(C.type,[k])));let R=null;if(m.length===4){if(C.type.kind!=="string"&&k.type.kind!=="string"&&C.type.kind!=="value"&&k.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(R=_.parse(m[3],3,xo),!R)return null}return new um(C,k,R)}evaluate(m){const _=this.lhs.evaluate(m),T=this.rhs.evaluate(m);if(l&&this.hasUntypedArgument){const C=ve(_),k=ve(T);if(C.kind!==k.kind||C.kind!=="string"&&C.kind!=="number")throw new Ze(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${C.kind}, ${k.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const C=ve(_),k=ve(T);if(C.kind!=="string"||k.kind!=="string")return t(m,_,T)}return this.collator?o(m,_,T,this.collator.evaluate(m)):t(m,_,T)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[i];return this.eachChild(_=>{m.push(_.serialize())}),m}}}const fu=Go("==",function(i,t,o){return t===o},ls),ln=Go("!=",function(i,t,o){return t!==o},function(i,t,o,l){return!ls(0,t,o,l)}),Ul=Go("<",function(i,t,o){return t<o},function(i,t,o,l){return l.compare(t,o)<0}),Sa=Go(">",function(i,t,o){return t>o},function(i,t,o,l){return l.compare(t,o)>0}),Ta=Go("<=",function(i,t,o){return t<=o},function(i,t,o,l){return l.compare(t,o)<=0}),ja=Go(">=",function(i,t,o){return t>=o},function(i,t,o,l){return l.compare(t,o)>=0});class ra{constructor(t,o,l,p,m){this.type=Ti,this.number=t,this.locale=o,this.currency=l,this.minFractionDigits=p,this.maxFractionDigits=m}static parse(t,o){if(t.length!==3)return o.error("Expected two arguments.");const l=o.parse(t[1],1,Ct);if(!l)return null;const p=t[2];if(typeof p!="object"||Array.isArray(p))return o.error("NumberFormat options argument must be an object.");let m=null;if(p.locale&&(m=o.parse(p.locale,1,Ti),!m))return null;let _=null;if(p.currency&&(_=o.parse(p.currency,1,Ti),!_))return null;let T=null;if(p["min-fraction-digits"]&&(T=o.parse(p["min-fraction-digits"],1,Ct),!T))return null;let C=null;return p["max-fraction-digits"]&&(C=o.parse(p["max-fraction-digits"],1,Ct),!C)?null:new ra(l,m,_,T,C)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Zo{constructor(t){this.type=Ct,this.input=t}static parse(t,o){if(t.length!==2)return o.error(`Expected 1 argument, but found ${t.length-1} instead.`);const l=o.parse(t[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${Y(l.type)} instead.`):new Zo(l):null}evaluate(t){const o=this.input.evaluate(t);if(typeof o=="string"||Array.isArray(o))return o.length;throw new Ze(`Expected value to be of type string or array, but found ${Y(ve(o))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(o=>{t.push(o.serialize())}),t}}const wo={"==":fu,"!=":ln,">":Sa,"<":Ul,">=":ja,"<=":Ta,array:pt,at:Cs,boolean:pt,case:ul,coalesce:sl,collator:oi,format:vt,image:Et,in:zs,"index-of":ss,interpolate:sn,"interpolate-hcl":sn,"interpolate-lab":sn,length:Zo,let:ll,literal:Ue,match:Ps,number:pt,"number-format":ra,object:pt,slice:ks,step:Na,string:pt,"to-boolean":$t,"to-color":$t,"to-number":$t,"to-string":$t,var:Xr,within:Va};function Ia(i,[t,o,l,p]){t=t.evaluate(i),o=o.evaluate(i),l=l.evaluate(i);const m=p?p.evaluate(i):1,_=_e(t,o,l,m);if(_)throw new Ze(_);return new U(t/255*m,o/255*m,l/255*m,m)}function na(i,t){return i in t}function cl(i,t){const o=t[i];return o===void 0?null:o}function Aa(i){return{type:i}}function Xi(i){return{result:"success",value:i}}function qa(i){return{result:"error",value:i}}function oa(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Vl(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function hl(i){return!!i.expression&&i.expression.interpolated}function _i(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Ms(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Di(i){return i}function Po(i,t){const o=t.type==="color",l=i.stops&&typeof i.stops[0][0]=="object",p=l||!(l||i.property!==void 0),m=i.type||(hl(t)?"exponential":"interval");if(o&&((i=Zn({},i)).stops&&(i.stops=i.stops.map(k=>[k[0],U.parse(k[1])])),i.default=U.parse(i.default?i.default:t.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!Sr[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let _,T,C;if(m==="exponential")_=Ds;else if(m==="interval")_=Ls;else if(m==="categorical"){_=Tr,T=Object.create(null);for(const k of i.stops)T[k[0]]=k[1];C=typeof i.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);_=Ga}if(l){const k={},R=[];for(let G=0;G<i.stops.length;G++){const Z=i.stops[G],ee=Z[0].zoom;k[ee]===void 0&&(k[ee]={zoom:ee,type:i.type,property:i.property,default:i.default,stops:[]},R.push(ee)),k[ee].stops.push([Z[0].value,Z[1]])}const D=[];for(const G of R)D.push([k[G].zoom,Po(k[G],t)]);const V={name:"linear"};return{kind:"composite",interpolationType:V,interpolationFactor:sn.interpolationFactor.bind(void 0,V),zoomStops:D.map(G=>G[0]),evaluate:({zoom:G},Z)=>Ds({stops:D,base:i.base},t,G).evaluate(G,Z)}}if(p){const k=m==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:k,interpolationFactor:sn.interpolationFactor.bind(void 0,k),zoomStops:i.stops.map(R=>R[0]),evaluate:({zoom:R})=>_(i,t,R,T,C)}}return{kind:"source",evaluate(k,R){const D=R&&R.properties?R.properties[i.property]:void 0;return D===void 0?Yi(i.default,t.default):_(i,t,D,T,C)}}}function Yi(i,t,o){return i!==void 0?i:t!==void 0?t:o!==void 0?o:void 0}function Tr(i,t,o,l,p){return Yi(typeof o===p?l[o]:void 0,i.default,t.default)}function Ls(i,t,o){if(_i(o)!=="number")return Yi(i.default,t.default);const l=i.stops.length;if(l===1||o<=i.stops[0][0])return i.stops[0][1];if(o>=i.stops[l-1][0])return i.stops[l-1][1];const p=ol(i.stops.map(m=>m[0]),o);return i.stops[p][1]}function Ds(i,t,o){const l=i.base!==void 0?i.base:1;if(_i(o)!=="number")return Yi(i.default,t.default);const p=i.stops.length;if(p===1||o<=i.stops[0][0])return i.stops[0][1];if(o>=i.stops[p-1][0])return i.stops[p-1][1];const m=ol(i.stops.map(R=>R[0]),o),_=function(R,D,V,G){const Z=G-V,ee=R-V;return Z===0?0:D===1?ee/Z:(Math.pow(D,ee)-1)/(Math.pow(D,Z)-1)}(o,l,i.stops[m][0],i.stops[m+1][0]),T=i.stops[m][1],C=i.stops[m+1][1];let k=os[t.type]||Di;if(i.colorSpace&&i.colorSpace!=="rgb"){const R=Sr[i.colorSpace];k=(D,V)=>R.reverse(R.interpolate(R.forward(D),R.forward(V),_))}return typeof T.evaluate=="function"?{evaluate(...R){const D=T.evaluate.apply(void 0,R),V=C.evaluate.apply(void 0,R);if(D!==void 0&&V!==void 0)return k(D,V,_)}}:k(T,C,_)}function Ga(i,t,o){return t.type==="color"?o=U.parse(o):t.type==="formatted"?o=de.fromString(o.toString()):t.type==="resolvedImage"?o=le.fromString(o.toString()):_i(o)===t.type||t.type==="enum"&&t.values[o]||(o=void 0),Yi(o,i.default,t.default)}Pt.register(wo,{error:[{kind:"error"},[Ti],(i,[t])=>{throw new Ze(t.evaluate(i))}],typeof:[Ti,[ui],(i,[t])=>Y(ve(t.evaluate(i)))],"to-rgba":[X(Ct,4),[Rr],(i,[t])=>t.evaluate(i).toArray()],rgb:[Rr,[Ct,Ct,Ct],Ia],rgba:[Rr,[Ct,Ct,Ct,Ct],Ia],has:{type:gi,overloads:[[[Ti],(i,[t])=>na(t.evaluate(i),i.properties())],[[Ti,$r],(i,[t,o])=>na(t.evaluate(i),o.evaluate(i))]]},get:{type:ui,overloads:[[[Ti],(i,[t])=>cl(t.evaluate(i),i.properties())],[[Ti,$r],(i,[t,o])=>cl(t.evaluate(i),o.evaluate(i))]]},"feature-state":[ui,[Ti],(i,[t])=>cl(t.evaluate(i),i.featureState||{})],properties:[$r,[],i=>i.properties()],"geometry-type":[Ti,[],i=>i.geometryType()],id:[ui,[],i=>i.id()],zoom:[Ct,[],i=>i.globals.zoom],"heatmap-density":[Ct,[],i=>i.globals.heatmapDensity||0],"line-progress":[Ct,[],i=>i.globals.lineProgress||0],accumulated:[ui,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Ct,Aa(Ct),(i,t)=>{let o=0;for(const l of t)o+=l.evaluate(i);return o}],"*":[Ct,Aa(Ct),(i,t)=>{let o=1;for(const l of t)o*=l.evaluate(i);return o}],"-":{type:Ct,overloads:[[[Ct,Ct],(i,[t,o])=>t.evaluate(i)-o.evaluate(i)],[[Ct],(i,[t])=>-t.evaluate(i)]]},"/":[Ct,[Ct,Ct],(i,[t,o])=>t.evaluate(i)/o.evaluate(i)],"%":[Ct,[Ct,Ct],(i,[t,o])=>t.evaluate(i)%o.evaluate(i)],ln2:[Ct,[],()=>Math.LN2],pi:[Ct,[],()=>Math.PI],e:[Ct,[],()=>Math.E],"^":[Ct,[Ct,Ct],(i,[t,o])=>Math.pow(t.evaluate(i),o.evaluate(i))],sqrt:[Ct,[Ct],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[Ct,[Ct],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[Ct,[Ct],(i,[t])=>Math.log(t.evaluate(i))],log2:[Ct,[Ct],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[Ct,[Ct],(i,[t])=>Math.sin(t.evaluate(i))],cos:[Ct,[Ct],(i,[t])=>Math.cos(t.evaluate(i))],tan:[Ct,[Ct],(i,[t])=>Math.tan(t.evaluate(i))],asin:[Ct,[Ct],(i,[t])=>Math.asin(t.evaluate(i))],acos:[Ct,[Ct],(i,[t])=>Math.acos(t.evaluate(i))],atan:[Ct,[Ct],(i,[t])=>Math.atan(t.evaluate(i))],min:[Ct,Aa(Ct),(i,t)=>Math.min(...t.map(o=>o.evaluate(i)))],max:[Ct,Aa(Ct),(i,t)=>Math.max(...t.map(o=>o.evaluate(i)))],abs:[Ct,[Ct],(i,[t])=>Math.abs(t.evaluate(i))],round:[Ct,[Ct],(i,[t])=>{const o=t.evaluate(i);return o<0?-Math.round(-o):Math.round(o)}],floor:[Ct,[Ct],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[Ct,[Ct],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[gi,[Ti,ui],(i,[t,o])=>i.properties()[t.value]===o.value],"filter-id-==":[gi,[ui],(i,[t])=>i.id()===t.value],"filter-type-==":[gi,[Ti],(i,[t])=>i.geometryType()===t.value],"filter-<":[gi,[Ti,ui],(i,[t,o])=>{const l=i.properties()[t.value],p=o.value;return typeof l==typeof p&&l<p}],"filter-id-<":[gi,[ui],(i,[t])=>{const o=i.id(),l=t.value;return typeof o==typeof l&&o<l}],"filter->":[gi,[Ti,ui],(i,[t,o])=>{const l=i.properties()[t.value],p=o.value;return typeof l==typeof p&&l>p}],"filter-id->":[gi,[ui],(i,[t])=>{const o=i.id(),l=t.value;return typeof o==typeof l&&o>l}],"filter-<=":[gi,[Ti,ui],(i,[t,o])=>{const l=i.properties()[t.value],p=o.value;return typeof l==typeof p&&l<=p}],"filter-id-<=":[gi,[ui],(i,[t])=>{const o=i.id(),l=t.value;return typeof o==typeof l&&o<=l}],"filter->=":[gi,[Ti,ui],(i,[t,o])=>{const l=i.properties()[t.value],p=o.value;return typeof l==typeof p&&l>=p}],"filter-id->=":[gi,[ui],(i,[t])=>{const o=i.id(),l=t.value;return typeof o==typeof l&&o>=l}],"filter-has":[gi,[ui],(i,[t])=>t.value in i.properties()],"filter-has-id":[gi,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[gi,[X(Ti)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[gi,[X(ui)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[gi,[Ti,X(ui)],(i,[t,o])=>o.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[gi,[Ti,X(ui)],(i,[t,o])=>function(l,p,m,_){for(;m<=_;){const T=m+_>>1;if(p[T]===l)return!0;p[T]>l?_=T-1:m=T+1}return!1}(i.properties()[t.value],o.value,0,o.value.length-1)],all:{type:gi,overloads:[[[gi,gi],(i,[t,o])=>t.evaluate(i)&&o.evaluate(i)],[Aa(gi),(i,t)=>{for(const o of t)if(!o.evaluate(i))return!1;return!0}]]},any:{type:gi,overloads:[[[gi,gi],(i,[t,o])=>t.evaluate(i)||o.evaluate(i)],[Aa(gi),(i,t)=>{for(const o of t)if(o.evaluate(i))return!0;return!1}]]},"!":[gi,[gi],(i,[t])=>!t.evaluate(i)],"is-supported-script":[gi,[Ti],(i,[t])=>{const o=i.globals&&i.globals.isSupportedScript;return!o||o(t.evaluate(i))}],upcase:[Ti,[Ti],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[Ti,[Ti],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[Ti,Aa(ui),(i,t)=>t.map(o=>Ge(o.evaluate(i))).join("")],"resolved-locale":[Ti,[xo],(i,[t])=>t.evaluate(i).resolvedLocale()]});class pl{constructor(t,o){this.expression=t,this._warningHistory={},this._evaluator=new Nt,this._defaultValue=o?function(l){return l.type==="color"&&Ms(l.default)?new U(0,0,0,0):l.type==="color"?U.parse(l.default)||null:l.default===void 0?null:l.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null}evaluateWithoutErrorHandling(t,o,l,p,m,_){return this._evaluator.globals=t,this._evaluator.feature=o,this._evaluator.featureState=l,this._evaluator.canonical=p,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_,this.expression.evaluate(this._evaluator)}evaluate(t,o,l,p,m,_){this._evaluator.globals=t,this._evaluator.feature=o||null,this._evaluator.featureState=l||null,this._evaluator.canonical=p,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new Ze(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console!="undefined"&&console.warn(T.message)),this._defaultValue}}}function $o(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in wo}function Xo(i,t){const o=new No(wo,[],t?function(p){const m={color:Rr,string:Ti,number:Ct,enum:Ti,boolean:gi,formatted:Ln,resolvedImage:Ji};return p.type==="array"?X(m[p.value]||ui,p.length):m[p.type]}(t):void 0),l=o.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?Xi(new pl(l,t)):qa(o.errors)}class Rs{constructor(t,o){this.kind=t,this._styleExpression=o,this.isStateDependent=t!=="constant"&&!Er(o.expression)}evaluateWithoutErrorHandling(t,o,l,p,m,_){return this._styleExpression.evaluateWithoutErrorHandling(t,o,l,p,m,_)}evaluate(t,o,l,p,m,_){return this._styleExpression.evaluate(t,o,l,p,m,_)}}class Ca{constructor(t,o,l,p){this.kind=t,this.zoomStops=l,this._styleExpression=o,this.isStateDependent=t!=="camera"&&!Er(o.expression),this.interpolationType=p}evaluateWithoutErrorHandling(t,o,l,p,m,_){return this._styleExpression.evaluateWithoutErrorHandling(t,o,l,p,m,_)}evaluate(t,o,l,p,m,_){return this._styleExpression.evaluate(t,o,l,p,m,_)}interpolationFactor(t,o,l){return this.interpolationType?sn.interpolationFactor(this.interpolationType,t,o,l):0}}function Qi(i,t){const o=Xo(i,t);if(o.result==="error")return o;const l=o.value.expression,p=bo(l);if(!p&&!oa(t))return qa([new Zr("","data expressions not supported")]);const m=$n(l,["zoom"]);if(!m&&!Vl(t))return qa([new Zr("","zoom expressions not supported")]);const _=dl(l);return _||m?_ instanceof Zr?qa([_]):_ instanceof sn&&!hl(t)?qa([new Zr("",'"interpolate" expressions cannot be used with this property')]):Xi(_?new Ca(p?"camera":"composite",o.value,_.labels,_ instanceof sn?_.interpolation:void 0):new Rs(p?"constant":"source",o.value)):qa([new Zr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class aa{constructor(t,o){this._parameters=t,this._specification=o,Zn(this,Po(this._parameters,this._specification))}static deserialize(t){return new aa(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function dl(i){let t=null;if(i instanceof ll)t=dl(i.result);else if(i instanceof sl){for(const o of i.args)if(t=dl(o),t)break}else(i instanceof Na||i instanceof sn)&&i.input instanceof Pt&&i.input.name==="zoom"&&(t=i);return t instanceof Zr||i.eachChild(o=>{const l=dl(o);l instanceof Zr?t=l:!t&&l?t=new Zr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&l&&t!==l&&(t=new Zr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Sn(i){const t=i.key,o=i.value,l=i.valueSpec||{},p=i.objectElementValidators||{},m=i.style,_=i.styleSpec;let T=[];const C=_i(o);if(C!=="object")return[new Lt(t,o,`object expected, ${C} found`)];for(const k in o){const R=k.split(".")[0],D=l[R]||l["*"];let V;if(p[R])V=p[R];else if(l[R])V=In;else if(p["*"])V=p["*"];else{if(!l["*"]){T.push(new Lt(t,o[k],`unknown property "${k}"`));continue}V=In}T=T.concat(V({key:(t&&`${t}.`)+k,value:o[k],valueSpec:D,style:m,styleSpec:_,object:o,objectKey:k},o))}for(const k in l)p[k]||l[k].required&&l[k].default===void 0&&o[k]===void 0&&T.push(new Lt(t,o,`missing required property "${k}"`));return T}function Nl(i){const t=i.value,o=i.valueSpec,l=i.style,p=i.styleSpec,m=i.key,_=i.arrayElementValidator||In;if(_i(t)!=="array")return[new Lt(m,t,`array expected, ${_i(t)} found`)];if(o.length&&t.length!==o.length)return[new Lt(m,t,`array length ${o.length} expected, length ${t.length} found`)];if(o["min-length"]&&t.length<o["min-length"])return[new Lt(m,t,`array length at least ${o["min-length"]} expected, length ${t.length} found`)];let T={type:o.value,values:o.values};p.$version<7&&(T.function=o.function),_i(o.value)==="object"&&(T=o.value);let C=[];for(let k=0;k<t.length;k++)C=C.concat(_({array:t,arrayIndex:k,value:t[k],valueSpec:T,style:l,styleSpec:p,key:`${m}[${k}]`}));return C}function mu(i){const t=i.key,o=i.value,l=i.valueSpec;let p=_i(o);return p==="number"&&o!=o&&(p="NaN"),p!=="number"?[new Lt(t,o,`number expected, ${p} found`)]:"minimum"in l&&o<l.minimum?[new Lt(t,o,`${o} is less than the minimum value ${l.minimum}`)]:"maximum"in l&&o>l.maximum?[new Lt(t,o,`${o} is greater than the maximum value ${l.maximum}`)]:[]}function jl(i){const t=i.valueSpec,o=Ki(i.value.type);let l,p,m,_={};const T=o!=="categorical"&&i.value.property===void 0,C=!T,k=_i(i.value.stops)==="array"&&_i(i.value.stops[0])==="array"&&_i(i.value.stops[0][0])==="object",R=Sn({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(G){if(o==="identity")return[new Lt(G.key,G.value,'identity function may not have a "stops" property')];let Z=[];const ee=G.value;return Z=Z.concat(Nl({key:G.key,value:ee,valueSpec:G.valueSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:D})),_i(ee)==="array"&&ee.length===0&&Z.push(new Lt(G.key,ee,"array must have at least one stop")),Z},default:function(G){return In({key:G.key,value:G.value,valueSpec:t,style:G.style,styleSpec:G.styleSpec})}}});return o==="identity"&&T&&R.push(new Lt(i.key,i.value,'missing required property "property"')),o==="identity"||i.value.stops||R.push(new Lt(i.key,i.value,'missing required property "stops"')),o==="exponential"&&i.valueSpec.expression&&!hl(i.valueSpec)&&R.push(new Lt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(C&&!oa(i.valueSpec)?R.push(new Lt(i.key,i.value,"property functions not supported")):T&&!Vl(i.valueSpec)&&R.push(new Lt(i.key,i.value,"zoom functions not supported"))),o!=="categorical"&&!k||i.value.property!==void 0||R.push(new Lt(i.key,i.value,'"property" property is required')),R;function D(G){let Z=[];const ee=G.value,ae=G.key;if(_i(ee)!=="array")return[new Lt(ae,ee,`array expected, ${_i(ee)} found`)];if(ee.length!==2)return[new Lt(ae,ee,`array length 2 expected, length ${ee.length} found`)];if(k){if(_i(ee[0])!=="object")return[new Lt(ae,ee,`object expected, ${_i(ee[0])} found`)];if(ee[0].zoom===void 0)return[new Lt(ae,ee,"object stop key must have zoom")];if(ee[0].value===void 0)return[new Lt(ae,ee,"object stop key must have value")];if(m&&m>Ki(ee[0].zoom))return[new Lt(ae,ee[0].zoom,"stop zoom values must appear in ascending order")];Ki(ee[0].zoom)!==m&&(m=Ki(ee[0].zoom),p=void 0,_={}),Z=Z.concat(Sn({key:`${ae}[0]`,value:ee[0],valueSpec:{zoom:{}},style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:mu,value:V}}))}else Z=Z.concat(V({key:`${ae}[0]`,value:ee[0],valueSpec:{},style:G.style,styleSpec:G.styleSpec},ee));return $o(mn(ee[1]))?Z.concat([new Lt(`${ae}[1]`,ee[1],"expressions are not allowed in function stops.")]):Z.concat(In({key:`${ae}[1]`,value:ee[1],valueSpec:t,style:G.style,styleSpec:G.styleSpec}))}function V(G,Z){const ee=_i(G.value),ae=Ki(G.value),we=G.value!==null?G.value:Z;if(l){if(ee!==l)return[new Lt(G.key,we,`${ee} stop domain type must match previous stop domain type ${l}`)]}else l=ee;if(ee!=="number"&&ee!=="string"&&ee!=="boolean")return[new Lt(G.key,we,"stop domain value must be a number, string, or boolean")];if(ee!=="number"&&o!=="categorical"){let ke=`number expected, ${ee} found`;return oa(t)&&o===void 0&&(ke+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Lt(G.key,we,ke)]}return o!=="categorical"||ee!=="number"||isFinite(ae)&&Math.floor(ae)===ae?o!=="categorical"&&ee==="number"&&p!==void 0&&ae<p?[new Lt(G.key,we,"stop domain values must appear in ascending order")]:(p=ae,o==="categorical"&&ae in _?[new Lt(G.key,we,"stop domain values must be unique")]:(_[ae]=!0,[])):[new Lt(G.key,we,`integer expected, found ${ae}`)]}}function sa(i){const t=(i.expressionContext==="property"?Qi:Xo)(mn(i.value),i.valueSpec);if(t.result==="error")return t.value.map(l=>new Lt(`${i.key}${l.key}`,i.value,l.message));const o=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!o.outputDefined())return[new Lt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Er(o))return[new Lt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Er(o))return[new Lt(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!$n(o,["zoom","feature-state"]))return[new Lt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!bo(o))return[new Lt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function la(i){const t=i.key,o=i.value,l=i.valueSpec,p=[];return Array.isArray(l.values)?l.values.indexOf(Ki(o))===-1&&p.push(new Lt(t,o,`expected one of [${l.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(l.values).indexOf(Ki(o))===-1&&p.push(new Lt(t,o,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(o)} found`)),p}function Za(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!Za(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Bs={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function za(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Za(i)||(i=Wo(i));const t=Xo(i,Bs);if(t.result==="error")throw new Error(t.value.map(o=>`${o.key}: ${o.message}`).join(", "));return{filter:(o,l,p)=>t.value.evaluate(o,l,{},p),needGeometry:ql(i)}}function ua(i,t){return i<t?-1:i>t?1:0}function ql(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let t=1;t<i.length;t++)if(ql(i[t]))return!0;return!1}function Wo(i){if(!i)return!0;const t=i[0];return i.length<=1?t!=="any":t==="=="?fo(i[1],i[2],"=="):t==="!="?$a(fo(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?fo(i[1],i[2],t):t==="any"?(o=i.slice(1),["any"].concat(o.map(Wo))):t==="all"?["all"].concat(i.slice(1).map(Wo)):t==="none"?["all"].concat(i.slice(1).map(Wo).map($a)):t==="in"?Os(i[1],i.slice(2)):t==="!in"?$a(Os(i[1],i.slice(2))):t==="has"?Fs(i[1]):t==="!has"?$a(Fs(i[1])):t!=="within"||i;var o}function fo(i,t,o){switch(i){case"$type":return[`filter-type-${o}`,t];case"$id":return[`filter-id-${o}`,t];default:return[`filter-${o}`,i,t]}}function Os(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(o=>typeof o!=typeof t[0])?["filter-in-large",i,["literal",t.sort(ua)]]:["filter-in-small",i,["literal",t]]}}function Fs(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function $a(i){return["!",i]}function ko(i){return Za(mn(i.value))?sa(Zn({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):us(i)}function us(i){const t=i.value,o=i.key;if(_i(t)!=="array")return[new Lt(o,t,`array expected, ${_i(t)} found`)];const l=i.styleSpec;let p,m=[];if(t.length<1)return[new Lt(o,t,"filter array must have at least 1 element")];switch(m=m.concat(la({key:`${o}[0]`,value:t[0],valueSpec:l.filter_operator,style:i.style,styleSpec:i.styleSpec})),Ki(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Ki(t[1])==="$type"&&m.push(new Lt(o,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&m.push(new Lt(o,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(p=_i(t[1]),p!=="string"&&m.push(new Lt(`${o}[1]`,t[1],`string expected, ${p} found`)));for(let _=2;_<t.length;_++)p=_i(t[_]),Ki(t[1])==="$type"?m=m.concat(la({key:`${o}[${_}]`,value:t[_],valueSpec:l.geometry_type,style:i.style,styleSpec:i.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&m.push(new Lt(`${o}[${_}]`,t[_],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let _=1;_<t.length;_++)m=m.concat(us({key:`${o}[${_}]`,value:t[_],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":p=_i(t[1]),t.length!==2?m.push(new Lt(o,t,`filter array for "${t[0]}" operator must have 2 elements`)):p!=="string"&&m.push(new Lt(`${o}[1]`,t[1],`string expected, ${p} found`));break;case"within":p=_i(t[1]),t.length!==2?m.push(new Lt(o,t,`filter array for "${t[0]}" operator must have 2 elements`)):p!=="object"&&m.push(new Lt(`${o}[1]`,t[1],`object expected, ${p} found`))}return m}function Pa(i,t){const o=i.key,l=i.style,p=i.styleSpec,m=i.value,_=i.objectKey,T=p[`${t}_${i.layerType}`];if(!T)return[];const C=_.match(/^(.*)-transition$/);if(t==="paint"&&C&&T[C[1]]&&T[C[1]].transition)return In({key:o,value:m,valueSpec:p.transition,style:l,styleSpec:p});const k=i.valueSpec||T[_];if(!k)return[new Lt(o,m,`unknown property "${_}"`)];let R;if(_i(m)==="string"&&oa(k)&&!k.tokens&&(R=/^{([^}]+)}$/.exec(m)))return[new Lt(o,m,`"${_}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(R[1])} }\`.`)];const D=[];return i.layerType==="symbol"&&(_==="text-field"&&l&&!l.glyphs&&D.push(new Lt(o,m,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&Ms(mn(m))&&Ki(m.type)==="identity"&&D.push(new Lt(o,m,'"text-font" does not support identity functions'))),D.concat(In({key:i.key,value:m,valueSpec:k,style:l,styleSpec:p,expressionContext:"property",propertyType:t,propertyKey:_}))}function fl(i){return Pa(i,"paint")}function Us(i){return Pa(i,"layout")}function yu(i){let t=[];const o=i.value,l=i.key,p=i.style,m=i.styleSpec;o.type||o.ref||t.push(new Lt(l,o,'either "type" or "ref" is required'));let _=Ki(o.type);const T=Ki(o.ref);if(o.id){const C=Ki(o.id);for(let k=0;k<i.arrayIndex;k++){const R=p.layers[k];Ki(R.id)===C&&t.push(new Lt(l,o.id,`duplicate layer id "${o.id}", previously used at line ${R.id.__line__}`))}}if("ref"in o){let C;["type","source","source-layer","filter","layout"].forEach(k=>{k in o&&t.push(new Lt(l,o[k],`"${k}" is prohibited for ref layers`))}),p.layers.forEach(k=>{Ki(k.id)===T&&(C=k)}),C?C.ref?t.push(new Lt(l,o.ref,"ref cannot reference another ref layer")):_=Ki(C.type):t.push(new Lt(l,o.ref,`ref layer "${T}" not found`))}else if(_!=="background")if(o.source){const C=p.sources&&p.sources[o.source],k=C&&Ki(C.type);C?k==="vector"&&_==="raster"?t.push(new Lt(l,o.source,`layer "${o.id}" requires a raster source`)):k==="raster"&&_!=="raster"?t.push(new Lt(l,o.source,`layer "${o.id}" requires a vector source`)):k!=="vector"||o["source-layer"]?k==="raster-dem"&&_!=="hillshade"?t.push(new Lt(l,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):_!=="line"||!o.paint||!o.paint["line-gradient"]||k==="geojson"&&C.lineMetrics||t.push(new Lt(l,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Lt(l,o,`layer "${o.id}" must specify a "source-layer"`)):t.push(new Lt(l,o.source,`source "${o.source}" not found`))}else t.push(new Lt(l,o,'missing required property "source"'));return t=t.concat(Sn({key:l,value:o,valueSpec:m.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>In({key:`${l}.type`,value:o.type,valueSpec:m.layer.type,style:i.style,styleSpec:i.styleSpec,object:o,objectKey:"type"}),filter:ko,layout:C=>Sn({layer:o,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":k=>Us(Zn({layerType:_},k))}}),paint:C=>Sn({layer:o,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":k=>fl(Zn({layerType:_},k))}})}})),t}function ca(i){const t=i.value,o=i.key,l=_i(t);return l!=="string"?[new Lt(o,t,`string expected, ${l} found`)]:[]}const ml={promoteId:function({key:i,value:t}){if(_i(t)==="string")return ca({key:i,value:t});{const o=[];for(const l in t)o.push(...ca({key:`${i}.${l}`,value:t[l]}));return o}}};function cs(i){const t=i.value,o=i.key,l=i.styleSpec,p=i.style;if(!t.type)return[new Lt(o,t,'"type" is required')];const m=Ki(t.type);let _;switch(m){case"vector":case"raster":case"raster-dem":return _=Sn({key:o,value:t,valueSpec:l[`source_${m.replace("-","_")}`],style:i.style,styleSpec:l,objectElementValidators:ml}),_;case"geojson":if(_=Sn({key:o,value:t,valueSpec:l.source_geojson,style:p,styleSpec:l,objectElementValidators:ml}),t.cluster)for(const T in t.clusterProperties){const[C,k]=t.clusterProperties[T],R=typeof C=="string"?[C,["accumulated"],["get",T]]:C;_.push(...sa({key:`${o}.${T}.map`,value:k,expressionContext:"cluster-map"})),_.push(...sa({key:`${o}.${T}.reduce`,value:R,expressionContext:"cluster-reduce"}))}return _;case"video":return Sn({key:o,value:t,valueSpec:l.source_video,style:p,styleSpec:l});case"image":return Sn({key:o,value:t,valueSpec:l.source_image,style:p,styleSpec:l});case"canvas":return[new Lt(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return la({key:`${o}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:p,styleSpec:l})}}function hs(i){const t=i.value,o=i.styleSpec,l=o.light,p=i.style;let m=[];const _=_i(t);if(t===void 0)return m;if(_!=="object")return m=m.concat([new Lt("light",t,`object expected, ${_} found`)]),m;for(const T in t){const C=T.match(/^(.*)-transition$/);m=m.concat(C&&l[C[1]]&&l[C[1]].transition?In({key:T,value:t[T],valueSpec:o.transition,style:p,styleSpec:o}):l[T]?In({key:T,value:t[T],valueSpec:l[T],style:p,styleSpec:o}):[new Lt(T,t[T],`unknown property "${T}"`)])}return m}const Tn={"*":()=>[],array:Nl,boolean:function(i){const t=i.value,o=i.key,l=_i(t);return l!=="boolean"?[new Lt(o,t,`boolean expected, ${l} found`)]:[]},number:mu,color:function(i){const t=i.key,o=i.value,l=_i(o);return l!=="string"?[new Lt(t,o,`color expected, ${l} found`)]:De(o)===null?[new Lt(t,o,`color expected, "${o}" found`)]:[]},constants:zo,enum:la,filter:ko,function:jl,layer:yu,object:Sn,source:cs,light:hs,string:ca,formatted:function(i){return ca(i).length===0?[]:sa(i)},resolvedImage:function(i){return ca(i).length===0?[]:sa(i)}};function In(i){const t=i.value,o=i.valueSpec,l=i.styleSpec;return o.expression&&Ms(Ki(t))?jl(i):o.expression&&$o(mn(t))?sa(i):o.type&&Tn[o.type]?Tn[o.type](i):Sn(Zn({},i,{valueSpec:o.type?l[o.type]:o}))}function Gl(i){const t=i.value,o=i.key,l=ca(i);return l.length||(t.indexOf("{fontstack}")===-1&&l.push(new Lt(o,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&l.push(new Lt(o,t,'"glyphs" url must include a "{range}" token'))),l}function ha(i,t=ot){let o=[];return o=o.concat(In({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,objectElementValidators:{glyphs:Gl,"*":()=>[]}})),i.constants&&(o=o.concat(zo({key:"constants",value:i.constants,style:i,styleSpec:t}))),ps(o)}function ps(i){return[].concat(i).sort((t,o)=>t.line-o.line)}function Xa(i){return function(...t){return ps(i.apply(this,t))}}ha.source=Xa(cs),ha.light=Xa(hs),ha.layer=Xa(yu),ha.filter=Xa(ko),ha.paintProperty=Xa(fl),ha.layoutProperty=Xa(Us);const mo=ha,ur=mo.light,ds=mo.paintProperty,Wa=mo.layoutProperty;function pa(i,t){let o=!1;if(t&&t.length)for(const l of t)i.fire(new fn(new Error(l.message))),o=!0;return o}class bi{constructor(t,o,l){const p=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const _=new Int32Array(this.arrayBuffer);t=_[0],this.d=(o=_[1])+2*(l=_[2]);for(let C=0;C<this.d*this.d;C++){const k=_[3+C],R=_[3+C+1];p.push(k===R?null:_.subarray(k,R))}const T=_[3+p.length+1];this.keys=_.subarray(_[3+p.length],T),this.bboxes=_.subarray(T),this.insert=this._insertReadonly}else{this.d=o+2*l;for(let _=0;_<this.d*this.d;_++)p.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=t,this.padding=l,this.scale=o/t,this.uid=0;const m=l/o*t;this.min=-m,this.max=t+m}insert(t,o,l,p,m){this._forEachCell(o,l,p,m,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(o),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(m)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,o,l,p,m,_){this.cells[m].push(_)}query(t,o,l,p,m){const _=this.min,T=this.max;if(t<=_&&o<=_&&T<=l&&T<=p&&!m)return Array.prototype.slice.call(this.keys);{const C=[];return this._forEachCell(t,o,l,p,this._queryCell,C,{},m),C}}_queryCell(t,o,l,p,m,_,T,C){const k=this.cells[m];if(k!==null){const R=this.keys,D=this.bboxes;for(let V=0;V<k.length;V++){const G=k[V];if(T[G]===void 0){const Z=4*G;(C?C(D[Z+0],D[Z+1],D[Z+2],D[Z+3]):t<=D[Z+2]&&o<=D[Z+3]&&l>=D[Z+0]&&p>=D[Z+1])?(T[G]=!0,_.push(R[G])):T[G]=!1}}}}_forEachCell(t,o,l,p,m,_,T,C){const k=this._convertToCellCoord(t),R=this._convertToCellCoord(o),D=this._convertToCellCoord(l),V=this._convertToCellCoord(p);for(let G=k;G<=D;G++)for(let Z=R;Z<=V;Z++){const ee=this.d*Z+G;if((!C||C(this._convertFromCellCoord(G),this._convertFromCellCoord(Z),this._convertFromCellCoord(G+1),this._convertFromCellCoord(Z+1)))&&m.call(this,t,o,l,p,ee,_,T,C))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,o=3+this.cells.length+1+1;let l=0;for(let _=0;_<this.cells.length;_++)l+=this.cells[_].length;const p=new Int32Array(o+l+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;let m=o;for(let _=0;_<t.length;_++){const T=t[_];p[3+_]=m,p.set(T,m),m+=T.length}return p[3+t.length]=m,p.set(this.keys,m),m+=this.keys.length,p[3+t.length+1]=m,p.set(this.bboxes,m),m+=this.bboxes.length,p.buffer}static serialize(t,o){const l=t.toArrayBuffer();return o&&o.push(l),{buffer:l}}static deserialize(t){return new bi(t.buffer)}}const ji={};function kt(i,t,o={}){Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),ji[i]={klass:t,omit:o.omit||[],shallow:o.shallow||[]}}kt("Object",Object),kt("TransferableGridIndex",bi),kt("Color",U),kt("Error",Error),kt("AJAXError",ii),kt("ResolvedImage",le),kt("StylePropertyFunction",aa),kt("StyleExpression",pl,{omit:["_evaluator"]}),kt("ZoomDependentExpression",Ca),kt("ZoomConstantExpression",Rs),kt("CompoundExpression",Pt,{omit:["_evaluate"]});for(const i in wo)wo[i]._classRegistryKey||kt(`Expression_${i}`,wo[i]);function Ha(i){return i&&typeof ArrayBuffer!="undefined"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Ho(i,t){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob)return i;if(Ha(i)||Ar(i))return t&&t.push(i),i;if(ArrayBuffer.isView(i)){const o=i;return t&&t.push(o.buffer),o}if(i instanceof ImageData)return t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const o=[];for(const l of i)o.push(Ho(l,t));return o}if(typeof i=="object"){const o=i.constructor,l=o._classRegistryKey;if(!l)throw new Error("can't serialize object of unregistered class");const p=o.serialize?o.serialize(i,t):{};if(!o.serialize){for(const m in i){if(!i.hasOwnProperty(m)||ji[l].omit.indexOf(m)>=0)continue;const _=i[m];p[m]=ji[l].shallow.indexOf(m)>=0?_:Ho(_,t)}i instanceof Error&&(p.message=i.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(p.$name=l),p}throw new Error("can't serialize object of type "+typeof i)}function Mo(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||Ha(i)||Ar(i)||ArrayBuffer.isView(i)||i instanceof ImageData)return i;if(Array.isArray(i))return i.map(Mo);if(typeof i=="object"){const t=i.$name||"Object";if(!ji[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:o}=ji[t];if(!o)throw new Error(`can't deserialize unregistered class ${t}`);if(o.deserialize)return o.deserialize(i);const l=Object.create(o.prototype);for(const p of Object.keys(i)){if(p==="$name")continue;const m=i[p];l[p]=ji[t].shallow.indexOf(p)>=0?m:Mo(m)}return l}throw new Error("can't deserialize object of type "+typeof i)}class Vs{constructor(){this.first=!0}update(t,o){const l=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=o),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=l,!0))}}const Ot={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Ka(i){for(const t of i)if(dr(t.charCodeAt(0)))return!0;return!1}function fs(i){for(const t of i)if(!da(t.charCodeAt(0)))return!1;return!0}function da(i){return!(Ot.Arabic(i)||Ot["Arabic Supplement"](i)||Ot["Arabic Extended-A"](i)||Ot["Arabic Presentation Forms-A"](i)||Ot["Arabic Presentation Forms-B"](i))}function dr(i){return!(i!==746&&i!==747&&(i<4352||!(Ot["Bopomofo Extended"](i)||Ot.Bopomofo(i)||Ot["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Ot["CJK Compatibility Ideographs"](i)||Ot["CJK Compatibility"](i)||Ot["CJK Radicals Supplement"](i)||Ot["CJK Strokes"](i)||!(!Ot["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Ot["CJK Unified Ideographs Extension A"](i)||Ot["CJK Unified Ideographs"](i)||Ot["Enclosed CJK Letters and Months"](i)||Ot["Hangul Compatibility Jamo"](i)||Ot["Hangul Jamo Extended-A"](i)||Ot["Hangul Jamo Extended-B"](i)||Ot["Hangul Jamo"](i)||Ot["Hangul Syllables"](i)||Ot.Hiragana(i)||Ot["Ideographic Description Characters"](i)||Ot.Kanbun(i)||Ot["Kangxi Radicals"](i)||Ot["Katakana Phonetic Extensions"](i)||Ot.Katakana(i)&&i!==12540||!(!Ot["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Ot["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Ot["Unified Canadian Aboriginal Syllabics"](i)||Ot["Unified Canadian Aboriginal Syllabics Extended"](i)||Ot["Vertical Forms"](i)||Ot["Yijing Hexagram Symbols"](i)||Ot["Yi Syllables"](i)||Ot["Yi Radicals"](i))))}function ms(i){return!(dr(i)||function(t){return!!(Ot["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Ot["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Ot["Letterlike Symbols"](t)||Ot["Number Forms"](t)||Ot["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Ot["Control Pictures"](t)&&t!==9251||Ot["Optical Character Recognition"](t)||Ot["Enclosed Alphanumerics"](t)||Ot["Geometric Shapes"](t)||Ot["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Ot["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Ot["CJK Symbols and Punctuation"](t)||Ot.Katakana(t)||Ot["Private Use Area"](t)||Ot["CJK Compatibility Forms"](t)||Ot["Small Form Variants"](t)||Ot["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}function Zl(i){return i>=1424&&i<=2303||Ot["Arabic Presentation Forms-A"](i)||Ot["Arabic Presentation Forms-B"](i)}function zr(i,t){return!(!t&&Zl(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Ot.Khmer(i))}function Ut(i){for(const t of i)if(Zl(t.charCodeAt(0)))return!0;return!1}const gn="deferred",ys="loading",ka="loaded";let yo=null,cr="unavailable",Ko=null;const St=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(cr="error"),yo&&yo(i)};function Ns(){fa.fire(new Gn("pluginStateChange",{pluginStatus:cr,pluginURL:Ko}))}const fa=new xa,js=function(){return cr},Rn=function(){if(cr!==gn||!Ko)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");cr=ys,Ns(),Ko&&vo({url:Ko},i=>{i?St(i):(cr=ka,Ns())})},fr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>cr===ka||fr.applyArabicShaping!=null,isLoading:()=>cr===ys,setState(i){cr=i.pluginStatus,Ko=i.pluginURL},isParsed:()=>fr.applyArabicShaping!=null&&fr.processBidirectionalText!=null&&fr.processStyledBidirectionalText!=null,getPluginURL:()=>Ko};class or{constructor(t,o){this.zoom=t,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Vs,this.transition={})}isSupportedScript(t){return function(o,l){for(const p of o)if(!zr(p.charCodeAt(0),l))return!1;return!0}(t,fr.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,o=t-Math.floor(t),l=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*o}}}class Ja{constructor(t,o){this.property=t,this.value=o,this.expression=function(l,p){if(Ms(l))return new aa(l,p);if($o(l)){const m=Qi(l,p);if(m.result==="error")throw new Error(m.value.map(_=>`${_.key}: ${_.message}`).join(", "));return m.value}{let m=l;return typeof l=="string"&&p.type==="color"&&(m=U.parse(l)),{kind:"constant",evaluate:()=>m}}}(o===void 0?t.specification.default:o,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,o,l){return this.property.possiblyEvaluate(this,t,o,l)}}class _n{constructor(t){this.property=t,this.value=new Ja(t,void 0)}transitioned(t,o){return new $l(this.property,this.value,o,yt({},t.transition,this.transition),t.now)}untransitioned(){return new $l(this.property,this.value,null,{},0)}}class Lo{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Ht(this._values[t].value.value)}setValue(t,o){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new _n(this._values[t].property)),this._values[t].value=new Ja(this._values[t].property,o===null?void 0:Ht(o))}getTransition(t){return Ht(this._values[t].transition)}setTransition(t,o){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new _n(this._values[t].property)),this._values[t].transition=Ht(o)||void 0}serialize(){const t={};for(const o of Object.keys(this._values)){const l=this.getValue(o);l!==void 0&&(t[o]=l);const p=this.getTransition(o);p!==void 0&&(t[`${o}-transition`]=p)}return t}transitioned(t,o){const l=new gs(this._properties);for(const p of Object.keys(this._values))l._values[p]=this._values[p].transitioned(t,o._values[p]);return l}untransitioned(){const t=new gs(this._properties);for(const o of Object.keys(this._values))t._values[o]=this._values[o].untransitioned();return t}}class $l{constructor(t,o,l,p,m){this.property=t,this.value=o,this.begin=m+p.delay||0,this.end=this.begin+p.duration||0,t.specification.transition&&(p.delay||p.duration)&&(this.prior=l)}possiblyEvaluate(t,o,l){const p=t.now||0,m=this.value.possiblyEvaluate(t,o,l),_=this.prior;if(_){if(p>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(p<this.begin)return _.possiblyEvaluate(t,o,l);{const T=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(t,o,l),m,function(C){if(C<=0)return 0;if(C>=1)return 1;const k=C*C,R=k*C;return 4*(C<.5?R:3*(C-k)+R-.75)}(T))}}return m}}class gs{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,o,l){const p=new Wn(this._properties);for(const m of Object.keys(this._values))p._values[m]=this._values[m].possiblyEvaluate(t,o,l);return p}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Xl{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return Ht(this._values[t].value)}setValue(t,o){this._values[t]=new Ja(this._values[t].property,o===null?void 0:Ht(o))}serialize(){const t={};for(const o of Object.keys(this._values)){const l=this.getValue(o);l!==void 0&&(t[o]=l)}return t}possiblyEvaluate(t,o,l){const p=new Wn(this._properties);for(const m of Object.keys(this._values))p._values[m]=this._values[m].possiblyEvaluate(t,o,l);return p}}class Eo{constructor(t,o,l){this.property=t,this.value=o,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,o,l,p){return this.property.evaluate(this.value,this.parameters,t,o,l,p)}}class Wn{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Vt{constructor(t){this.specification=t}possiblyEvaluate(t,o){return t.expression.evaluate(o)}interpolate(t,o,l){const p=os[this.specification.type];return p?p(t,o,l):t}}class wt{constructor(t,o){this.specification=t,this.overrides=o}possiblyEvaluate(t,o,l,p){return new Eo(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(o,null,{},l,p)}:t.expression,o)}interpolate(t,o,l){if(t.value.kind!=="constant"||o.value.kind!=="constant")return t;if(t.value.value===void 0||o.value.value===void 0)return new Eo(this,{kind:"constant",value:void 0},t.parameters);const p=os[this.specification.type];return p?new Eo(this,{kind:"constant",value:p(t.value.value,o.value.value,l)},t.parameters):t}evaluate(t,o,l,p,m,_){return t.kind==="constant"?t.value:t.evaluate(o,l,p,m,_)}}class Hn extends wt{possiblyEvaluate(t,o,l,p){if(t.value===void 0)return new Eo(this,{kind:"constant",value:void 0},o);if(t.expression.kind==="constant"){const m=t.expression.evaluate(o,null,{},l,p),_=t.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,T=this._calculate(_,_,_,o);return new Eo(this,{kind:"constant",value:T},o)}if(t.expression.kind==="camera"){const m=this._calculate(t.expression.evaluate({zoom:o.zoom-1}),t.expression.evaluate({zoom:o.zoom}),t.expression.evaluate({zoom:o.zoom+1}),o);return new Eo(this,{kind:"constant",value:m},o)}return new Eo(this,t.expression,o)}evaluate(t,o,l,p,m,_){if(t.kind==="source"){const T=t.evaluate(o,l,p,m,_);return this._calculate(T,T,T,o)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(o.zoom)-1},l,p),t.evaluate({zoom:Math.floor(o.zoom)},l,p),t.evaluate({zoom:Math.floor(o.zoom)+1},l,p),o):t.value}_calculate(t,o,l,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:o}:{from:l,to:o}}interpolate(t){return t}}class An{constructor(t){this.specification=t}possiblyEvaluate(t,o,l,p){if(t.value!==void 0){if(t.expression.kind==="constant"){const m=t.expression.evaluate(o,null,{},l,p);return this._calculate(m,m,m,o)}return this._calculate(t.expression.evaluate(new or(Math.floor(o.zoom-1),o)),t.expression.evaluate(new or(Math.floor(o.zoom),o)),t.expression.evaluate(new or(Math.floor(o.zoom+1),o)),o)}}_calculate(t,o,l,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:o}:{from:l,to:o}}interpolate(t){return t}}class Nr{constructor(t){this.specification=t}possiblyEvaluate(t,o,l,p){return!!t.expression.evaluate(o,null,{},l,p)}interpolate(){return!1}}class mr{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const o in t){const l=t[o];l.specification.overridable&&this.overridableProperties.push(o);const p=this.defaultPropertyValues[o]=new Ja(l,void 0),m=this.defaultTransitionablePropertyValues[o]=new _n(l);this.defaultTransitioningPropertyValues[o]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=p.possiblyEvaluate({})}}}kt("DataDrivenProperty",wt),kt("DataConstantProperty",Vt),kt("CrossFadedDataDrivenProperty",Hn),kt("CrossFadedProperty",An),kt("ColorRampProperty",Nr);const Kn="-transition";class vr extends xa{constructor(t,o){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=(t=t).metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),o.layout&&(this._unevaluatedLayout=new Xl(o.layout)),o.paint)){this._transitionablePaint=new Lo(o.paint);for(const l in t.paint)this.setPaintProperty(l,t.paint[l],{validate:!1});for(const l in t.layout)this.setLayoutProperty(l,t.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Wn(o.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,o,l={}){o!=null&&this._validate(Wa,`layers.${this.id}.layout.${t}`,t,o,l)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,o):this.visibility=o)}getPaintProperty(t){return t.endsWith(Kn)?this._transitionablePaint.getTransition(t.slice(0,-Kn.length)):this._transitionablePaint.getValue(t)}setPaintProperty(t,o,l={}){if(o!=null&&this._validate(ds,`layers.${this.id}.paint.${t}`,t,o,l))return!1;if(t.endsWith(Kn))return this._transitionablePaint.setTransition(t.slice(0,-Kn.length),o||void 0),!1;{const p=this._transitionablePaint._values[t],m=p.property.specification["property-type"]==="cross-faded-data-driven",_=p.value.isDataDriven(),T=p.value;this._transitionablePaint.setValue(t,o),this._handleSpecialPaintPropertyUpdate(t);const C=this._transitionablePaint._values[t].value;return C.isDataDriven()||_||m||this._handleOverridablePaintPropertyUpdate(t,T,C)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,o,l){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,o){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,o)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),mi(t,(o,l)=>!(o===void 0||l==="layout"&&!Object.keys(o).length||l==="paint"&&!Object.keys(o).length))}_validate(t,o,l,p,m={}){return(!m||m.validate!==!1)&&pa(this,t.call(mo,{key:o,layerType:this.type,objectKey:l,value:p,styleSpec:ot,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const o=this.paint.get(t);if(o instanceof Eo&&oa(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}}const Cn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ma{constructor(t,o){this._structArray=t,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class At{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,o){return t._trim(),o&&(t.isTransferred=!0,o.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const o=Object.create(this.prototype);return o.arrayBuffer=t.arrayBuffer,o.length=t.length,o.capacity=t.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Tt(i,t=1){let o=0,l=0;return{members:i.map(p=>{const m=Cn[p.type].BYTES_PER_ELEMENT,_=o=qs(o,Math.max(t,m)),T=p.components||1;return l=Math.max(l,m),o+=m*T,{name:p.name,type:p.type,components:T,offset:_}}),size:qs(o,Math.max(l,t)),alignment:t}}function qs(i,t){return Math.ceil(i/t)*t}class Or extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o){const l=this.length;return this.resize(l+1),this.emplace(l,t,o)}emplace(t,o,l){const p=2*t;return this.int16[p+0]=o,this.int16[p+1]=l,t}}Or.prototype.bytesPerElement=4,kt("StructArrayLayout2i4",Or);class Bn extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,l,p){const m=this.length;return this.resize(m+1),this.emplace(m,t,o,l,p)}emplace(t,o,l,p,m){const _=4*t;return this.int16[_+0]=o,this.int16[_+1]=l,this.int16[_+2]=p,this.int16[_+3]=m,t}}Bn.prototype.bytesPerElement=8,kt("StructArrayLayout4i8",Bn);class b extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,l,p,m,_){const T=this.length;return this.resize(T+1),this.emplace(T,t,o,l,p,m,_)}emplace(t,o,l,p,m,_,T){const C=6*t;return this.int16[C+0]=o,this.int16[C+1]=l,this.int16[C+2]=p,this.int16[C+3]=m,this.int16[C+4]=_,this.int16[C+5]=T,t}}b.prototype.bytesPerElement=12,kt("StructArrayLayout2i4i12",b);class n extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,l,p,m,_){const T=this.length;return this.resize(T+1),this.emplace(T,t,o,l,p,m,_)}emplace(t,o,l,p,m,_,T){const C=4*t,k=8*t;return this.int16[C+0]=o,this.int16[C+1]=l,this.uint8[k+4]=p,this.uint8[k+5]=m,this.uint8[k+6]=_,this.uint8[k+7]=T,t}}n.prototype.bytesPerElement=8,kt("StructArrayLayout2i4ub8",n);class h extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o){const l=this.length;return this.resize(l+1),this.emplace(l,t,o)}emplace(t,o,l){const p=2*t;return this.float32[p+0]=o,this.float32[p+1]=l,t}}h.prototype.bytesPerElement=8,kt("StructArrayLayout2f8",h);class v extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,l,p,m,_,T,C,k,R){const D=this.length;return this.resize(D+1),this.emplace(D,t,o,l,p,m,_,T,C,k,R)}emplace(t,o,l,p,m,_,T,C,k,R,D){const V=10*t;return this.uint16[V+0]=o,this.uint16[V+1]=l,this.uint16[V+2]=p,this.uint16[V+3]=m,this.uint16[V+4]=_,this.uint16[V+5]=T,this.uint16[V+6]=C,this.uint16[V+7]=k,this.uint16[V+8]=R,this.uint16[V+9]=D,t}}v.prototype.bytesPerElement=20,kt("StructArrayLayout10ui20",v);class w extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,l,p,m,_,T,C,k,R,D,V){const G=this.length;return this.resize(G+1),this.emplace(G,t,o,l,p,m,_,T,C,k,R,D,V)}emplace(t,o,l,p,m,_,T,C,k,R,D,V,G){const Z=12*t;return this.int16[Z+0]=o,this.int16[Z+1]=l,this.int16[Z+2]=p,this.int16[Z+3]=m,this.uint16[Z+4]=_,this.uint16[Z+5]=T,this.uint16[Z+6]=C,this.uint16[Z+7]=k,this.int16[Z+8]=R,this.int16[Z+9]=D,this.int16[Z+10]=V,this.int16[Z+11]=G,t}}w.prototype.bytesPerElement=24,kt("StructArrayLayout4i4ui4i24",w);class I extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,o,l)}emplace(t,o,l,p){const m=3*t;return this.float32[m+0]=o,this.float32[m+1]=l,this.float32[m+2]=p,t}}I.prototype.bytesPerElement=12,kt("StructArrayLayout3f12",I);class L extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const o=this.length;return this.resize(o+1),this.emplace(o,t)}emplace(t,o){return this.uint32[1*t+0]=o,t}}L.prototype.bytesPerElement=4,kt("StructArrayLayout1ul4",L);class O extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,l,p,m,_,T,C,k){const R=this.length;return this.resize(R+1),this.emplace(R,t,o,l,p,m,_,T,C,k)}emplace(t,o,l,p,m,_,T,C,k,R){const D=10*t,V=5*t;return this.int16[D+0]=o,this.int16[D+1]=l,this.int16[D+2]=p,this.int16[D+3]=m,this.int16[D+4]=_,this.int16[D+5]=T,this.uint32[V+3]=C,this.uint16[D+8]=k,this.uint16[D+9]=R,t}}O.prototype.bytesPerElement=20,kt("StructArrayLayout6i1ul2ui20",O);class N extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,l,p,m,_){const T=this.length;return this.resize(T+1),this.emplace(T,t,o,l,p,m,_)}emplace(t,o,l,p,m,_,T){const C=6*t;return this.int16[C+0]=o,this.int16[C+1]=l,this.int16[C+2]=p,this.int16[C+3]=m,this.int16[C+4]=_,this.int16[C+5]=T,t}}N.prototype.bytesPerElement=12,kt("StructArrayLayout2i2i2i12",N);class $ extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,l,p,m){const _=this.length;return this.resize(_+1),this.emplace(_,t,o,l,p,m)}emplace(t,o,l,p,m,_){const T=4*t,C=8*t;return this.float32[T+0]=o,this.float32[T+1]=l,this.float32[T+2]=p,this.int16[C+6]=m,this.int16[C+7]=_,t}}$.prototype.bytesPerElement=16,kt("StructArrayLayout2f1f2i16",$);class H extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,l,p){const m=this.length;return this.resize(m+1),this.emplace(m,t,o,l,p)}emplace(t,o,l,p,m){const _=12*t,T=3*t;return this.uint8[_+0]=o,this.uint8[_+1]=l,this.float32[T+1]=p,this.float32[T+2]=m,t}}H.prototype.bytesPerElement=12,kt("StructArrayLayout2ub2f12",H);class re extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,o,l)}emplace(t,o,l,p){const m=3*t;return this.uint16[m+0]=o,this.uint16[m+1]=l,this.uint16[m+2]=p,t}}re.prototype.bytesPerElement=6,kt("StructArrayLayout3ui6",re);class fe extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,l,p,m,_,T,C,k,R,D,V,G,Z,ee,ae,we){const ke=this.length;return this.resize(ke+1),this.emplace(ke,t,o,l,p,m,_,T,C,k,R,D,V,G,Z,ee,ae,we)}emplace(t,o,l,p,m,_,T,C,k,R,D,V,G,Z,ee,ae,we,ke){const Re=24*t,Be=12*t,$e=48*t;return this.int16[Re+0]=o,this.int16[Re+1]=l,this.uint16[Re+2]=p,this.uint16[Re+3]=m,this.uint32[Be+2]=_,this.uint32[Be+3]=T,this.uint32[Be+4]=C,this.uint16[Re+10]=k,this.uint16[Re+11]=R,this.uint16[Re+12]=D,this.float32[Be+7]=V,this.float32[Be+8]=G,this.uint8[$e+36]=Z,this.uint8[$e+37]=ee,this.uint8[$e+38]=ae,this.uint32[Be+10]=we,this.int16[Re+22]=ke,t}}fe.prototype.bytesPerElement=48,kt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",fe);class Pe extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,l,p,m,_,T,C,k,R,D,V,G,Z,ee,ae,we,ke,Re,Be,$e,Oe,dt,ht,Ye,ct,nt,ft){const tt=this.length;return this.resize(tt+1),this.emplace(tt,t,o,l,p,m,_,T,C,k,R,D,V,G,Z,ee,ae,we,ke,Re,Be,$e,Oe,dt,ht,Ye,ct,nt,ft)}emplace(t,o,l,p,m,_,T,C,k,R,D,V,G,Z,ee,ae,we,ke,Re,Be,$e,Oe,dt,ht,Ye,ct,nt,ft,tt){const at=34*t,Bt=17*t;return this.int16[at+0]=o,this.int16[at+1]=l,this.int16[at+2]=p,this.int16[at+3]=m,this.int16[at+4]=_,this.int16[at+5]=T,this.int16[at+6]=C,this.int16[at+7]=k,this.uint16[at+8]=R,this.uint16[at+9]=D,this.uint16[at+10]=V,this.uint16[at+11]=G,this.uint16[at+12]=Z,this.uint16[at+13]=ee,this.uint16[at+14]=ae,this.uint16[at+15]=we,this.uint16[at+16]=ke,this.uint16[at+17]=Re,this.uint16[at+18]=Be,this.uint16[at+19]=$e,this.uint16[at+20]=Oe,this.uint16[at+21]=dt,this.uint16[at+22]=ht,this.uint32[Bt+12]=Ye,this.float32[Bt+13]=ct,this.float32[Bt+14]=nt,this.float32[Bt+15]=ft,this.float32[Bt+16]=tt,t}}Pe.prototype.bytesPerElement=68,kt("StructArrayLayout8i15ui1ul4f68",Pe);class ye extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const o=this.length;return this.resize(o+1),this.emplace(o,t)}emplace(t,o){return this.float32[1*t+0]=o,t}}ye.prototype.bytesPerElement=4,kt("StructArrayLayout1f4",ye);class ze extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,o,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,o,l)}emplace(t,o,l,p){const m=3*t;return this.int16[m+0]=o,this.int16[m+1]=l,this.int16[m+2]=p,t}}ze.prototype.bytesPerElement=6,kt("StructArrayLayout3i6",ze);class Ve extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o,l){const p=this.length;return this.resize(p+1),this.emplace(p,t,o,l)}emplace(t,o,l,p){const m=4*t;return this.uint32[2*t+0]=o,this.uint16[m+2]=l,this.uint16[m+3]=p,t}}Ve.prototype.bytesPerElement=8,kt("StructArrayLayout1ul2ui8",Ve);class Fe extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,o){const l=this.length;return this.resize(l+1),this.emplace(l,t,o)}emplace(t,o,l){const p=2*t;return this.uint16[p+0]=o,this.uint16[p+1]=l,t}}Fe.prototype.bytesPerElement=4,kt("StructArrayLayout2ui4",Fe);class Xe extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const o=this.length;return this.resize(o+1),this.emplace(o,t)}emplace(t,o){return this.uint16[1*t+0]=o,t}}Xe.prototype.bytesPerElement=2,kt("StructArrayLayout1ui2",Xe);class je extends At{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,o,l,p){const m=this.length;return this.resize(m+1),this.emplace(m,t,o,l,p)}emplace(t,o,l,p,m){const _=4*t;return this.float32[_+0]=o,this.float32[_+1]=l,this.float32[_+2]=p,this.float32[_+3]=m,t}}je.prototype.bytesPerElement=16,kt("StructArrayLayout4f16",je);class st extends ma{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Yt(this.anchorPointX,this.anchorPointY)}}st.prototype.size=20;class et extends O{get(t){return new st(this,t)}}kt("CollisionBoxArray",et);class rt extends ma{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}rt.prototype.size=48;class mt extends fe{get(t){return new rt(this,t)}}kt("PlacedSymbolArray",mt);class xt extends ma{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}xt.prototype.size=68;class lt extends Pe{get(t){return new xt(this,t)}}kt("SymbolInstanceArray",lt);class qt extends ye{getoffsetX(t){return this.float32[1*t+0]}}kt("GlyphOffsetArray",qt);class Rt extends ze{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}kt("SymbolLineVertexArray",Rt);class li extends ma{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}li.prototype.size=8;class s extends Ve{get(t){return new li(this,t)}}kt("FeatureIndexArray",s);class c extends Or{}class u extends Or{}class f extends b{}class S extends n{}class A extends h{}class z extends v{}class B extends w{}class q extends I{}class W extends L{}class oe extends N{}class se extends H{}class ue extends re{}class Ee extends Fe{}const be=Tt([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ce}=be;class me{constructor(t=[]){this.segments=t}prepareSegment(t,o,l,p){let m=this.segments[this.segments.length-1];return t>me.MAX_VERTEX_ARRAY_LENGTH&&pi(`Max vertices per segment is ${me.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!m||m.vertexLength+t>me.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==p)&&(m={vertexOffset:o.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},p!==void 0&&(m.sortKey=p),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const t of this.segments)for(const o in t.vaos)t.vaos[o].destroy()}static simpleSegment(t,o,l,p){return new me([{vertexOffset:t,primitiveOffset:o,vertexLength:l,primitiveLength:p,vaos:{},sortKey:0}])}}function Te(i,t){return 256*(i=Se(Math.floor(i),0,255))+Se(Math.floor(t),0,255)}me.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,kt("SegmentVector",me);const Le=Tt([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Ne={exports:{}},We={exports:{}};We.exports=function(i,t){var o,l,p,m,_,T,C,k;for(l=i.length-(o=3&i.length),p=t,_=3432918353,T=461845907,k=0;k<l;)C=255&i.charCodeAt(k)|(255&i.charCodeAt(++k))<<8|(255&i.charCodeAt(++k))<<16|(255&i.charCodeAt(++k))<<24,++k,p=27492+(65535&(m=5*(65535&(p=(p^=C=(65535&(C=(C=(65535&C)*_+(((C>>>16)*_&65535)<<16)&4294967295)<<15|C>>>17))*T+(((C>>>16)*T&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(C=0,o){case 3:C^=(255&i.charCodeAt(k+2))<<16;case 2:C^=(255&i.charCodeAt(k+1))<<8;case 1:p^=C=(65535&(C=(C=(65535&(C^=255&i.charCodeAt(k)))*_+(((C>>>16)*_&65535)<<16)&4294967295)<<15|C>>>17))*T+(((C>>>16)*T&65535)<<16)&4294967295}return p^=i.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0};var He={exports:{}};He.exports=function(i,t){for(var o,l=i.length,p=t^l,m=0;l>=4;)o=1540483477*(65535&(o=255&i.charCodeAt(m)|(255&i.charCodeAt(++m))<<8|(255&i.charCodeAt(++m))<<16|(255&i.charCodeAt(++m))<<24))+((1540483477*(o>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),l-=4,++m;switch(l){case 3:p^=(255&i.charCodeAt(m+2))<<16;case 2:p^=(255&i.charCodeAt(m+1))<<8;case 1:p=1540483477*(65535&(p^=255&i.charCodeAt(m)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};var Je=We.exports,ut=He.exports;Ne.exports=Je,Ne.exports.murmur3=Je,Ne.exports.murmur2=ut;var _t=Ne.exports;class gt{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,o,l,p){this.ids.push(Mt(t)),this.positions.push(o,l,p)}getPositions(t){const o=Mt(t);let l=0,p=this.ids.length-1;for(;l<p;){const _=l+p>>1;this.ids[_]>=o?p=_:l=_+1}const m=[];for(;this.ids[l]===o;)m.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return m}static serialize(t,o){const l=new Float64Array(t.ids),p=new Uint32Array(t.positions);return Zt(l,p,0,l.length-1),o&&o.push(l.buffer,p.buffer),{ids:l,positions:p}}static deserialize(t){const o=new gt;return o.ids=t.ids,o.positions=t.positions,o.indexed=!0,o}}function Mt(i){const t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:_t(String(i))}function Zt(i,t,o,l){for(;o<l;){const p=i[o+l>>1];let m=o-1,_=l+1;for(;;){do m++;while(i[m]<p);do _--;while(i[_]>p);if(m>=_)break;Wt(i,m,_),Wt(t,3*m,3*_),Wt(t,3*m+1,3*_+1),Wt(t,3*m+2,3*_+2)}_-o<l-_?(Zt(i,t,o,_),o=_+1):(Zt(i,t,_+1,l),l=_)}}function Wt(i,t,o){const l=i[t];i[t]=i[o],i[o]=l}kt("FeaturePositionMap",gt);class Gt{constructor(t,o){this.gl=t.gl,this.location=o}}class Ai extends Gt{constructor(t,o){super(t,o),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Ft extends Gt{constructor(t,o){super(t,o),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class ai extends Gt{constructor(t,o){super(t,o),this.current=U.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const wi=new Float32Array(16);function ni(i){return[Te(255*i.r,255*i.g),Te(255*i.b,255*i.a)]}class ei{constructor(t,o,l){this.value=t,this.uniformNames=o.map(p=>`u_${p}`),this.type=l}setUniform(t,o,l){t.set(l.constantOr(this.value))}getBinding(t,o,l){return this.type==="color"?new ai(t,o):new Ai(t,o)}}class ci{constructor(t,o){this.uniformNames=o.map(l=>`u_${l}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=t.tlbr}setUniform(t,o,l,p){const m=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&t.set(m)}getBinding(t,o,l){return l.substr(0,9)==="u_pattern"?new Ft(t,o):new Ai(t,o)}}class Kt{constructor(t,o,l,p){this.expression=t,this.type=l,this.maxValue=0,this.paintVertexAttributes=o.map(m=>({name:`a_${m}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(t,o,l,p,m){const _=this.paintVertexArray.length,T=this.expression.evaluate(new or(0),o,{},p,[],m);this.paintVertexArray.resize(t),this._setPaintValue(_,t,T)}updatePaintArray(t,o,l,p){const m=this.expression.evaluate({zoom:0},l,p);this._setPaintValue(t,o,m)}_setPaintValue(t,o,l){if(this.type==="color"){const p=ni(l);for(let m=t;m<o;m++)this.paintVertexArray.emplace(m,p[0],p[1])}else{for(let p=t;p<o;p++)this.paintVertexArray.emplace(p,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Xt{constructor(t,o,l,p,m,_){this.expression=t,this.uniformNames=o.map(T=>`u_${T}_t`),this.type=l,this.useIntegerZoom=p,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=o.map(T=>({name:`a_${T}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(t,o,l,p,m){const _=this.expression.evaluate(new or(this.zoom),o,{},p,[],m),T=this.expression.evaluate(new or(this.zoom+1),o,{},p,[],m),C=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(C,t,_,T)}updatePaintArray(t,o,l,p){const m=this.expression.evaluate({zoom:this.zoom},l,p),_=this.expression.evaluate({zoom:this.zoom+1},l,p);this._setPaintValue(t,o,m,_)}_setPaintValue(t,o,l,p){if(this.type==="color"){const m=ni(l),_=ni(p);for(let T=t;T<o;T++)this.paintVertexArray.emplace(T,m[0],m[1],_[0],_[1])}else{for(let m=t;m<o;m++)this.paintVertexArray.emplace(m,l,p);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(p))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,o){const l=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,p=Se(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);t.set(p)}getBinding(t,o,l){return new Ai(t,o)}}class yr{constructor(t,o,l,p,m,_){this.expression=t,this.type=o,this.useIntegerZoom=l,this.zoom=p,this.layerId=_,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(t,o,l){const p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(p,t,o.patterns&&o.patterns[this.layerId],l)}updatePaintArray(t,o,l,p,m){this._setPaintValues(t,o,l.patterns&&l.patterns[this.layerId],m)}_setPaintValues(t,o,l,p){if(!p||!l)return;const{min:m,mid:_,max:T}=l,C=p[m],k=p[_],R=p[T];if(C&&k&&R)for(let D=t;D<o;D++)this.zoomInPaintVertexArray.emplace(D,k.tl[0],k.tl[1],k.br[0],k.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],k.pixelRatio,C.pixelRatio),this.zoomOutPaintVertexArray.emplace(D,k.tl[0],k.tl[1],k.br[0],k.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],k.pixelRatio,R.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Le.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Le.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ir{constructor(t,o,l){this.binders={},this._buffers=[];const p=[];for(const m in t.paint._values){if(!l(m))continue;const _=t.paint.get(m);if(!(_ instanceof Eo&&oa(_.property.specification)))continue;const T=vn(m,t.type),C=_.value,k=_.property.specification.type,R=_.property.useIntegerZoom,D=_.property.specification["property-type"],V=D==="cross-faded"||D==="cross-faded-data-driven";if(C.kind==="constant")this.binders[m]=V?new ci(C.value,T):new ei(C.value,T,k),p.push(`/u_${m}`);else if(C.kind==="source"||V){const G=xr(m,k,"source");this.binders[m]=V?new yr(C,k,R,o,G,t.id):new Kt(C,T,k,G),p.push(`/a_${m}`)}else{const G=xr(m,k,"composite");this.binders[m]=new Xt(C,T,k,R,o,G),p.push(`/z_${m}`)}}this.cacheKey=p.sort().join("")}getMaxValue(t){const o=this.binders[t];return o instanceof Kt||o instanceof Xt?o.maxValue:0}populatePaintArrays(t,o,l,p,m){for(const _ in this.binders){const T=this.binders[_];(T instanceof Kt||T instanceof Xt||T instanceof yr)&&T.populatePaintArray(t,o,l,p,m)}}setConstantPatternPositions(t,o){for(const l in this.binders){const p=this.binders[l];p instanceof ci&&p.setConstantPatternPositions(t,o)}}updatePaintArrays(t,o,l,p,m){let _=!1;for(const T in t){const C=o.getPositions(T);for(const k of C){const R=l.feature(k.index);for(const D in this.binders){const V=this.binders[D];if((V instanceof Kt||V instanceof Xt||V instanceof yr)&&V.expression.isStateDependent===!0){const G=p.paint.get(D);V.expression=G.value,V.updatePaintArray(k.start,k.end,R,t[T],m),_=!0}}}}return _}defines(){const t=[];for(const o in this.binders){const l=this.binders[o];(l instanceof ei||l instanceof ci)&&t.push(...l.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return t}getBinderAttributes(){const t=[];for(const o in this.binders){const l=this.binders[o];if(l instanceof Kt||l instanceof Xt)for(let p=0;p<l.paintVertexAttributes.length;p++)t.push(l.paintVertexAttributes[p].name);else if(l instanceof yr)for(let p=0;p<Le.members.length;p++)t.push(Le.members[p].name)}return t}getBinderUniforms(){const t=[];for(const o in this.binders){const l=this.binders[o];if(l instanceof ei||l instanceof ci||l instanceof Xt)for(const p of l.uniformNames)t.push(p)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,o){const l=[];for(const p in this.binders){const m=this.binders[p];if(m instanceof ei||m instanceof ci||m instanceof Xt){for(const _ of m.uniformNames)if(o[_]){const T=m.getBinding(t,o[_],_);l.push({name:_,property:p,binding:T})}}}return l}setUniforms(t,o,l,p){for(const{name:m,property:_,binding:T}of o)this.binders[_].setUniform(T,p,l.get(_),m)}updatePaintBuffers(t){this._buffers=[];for(const o in this.binders){const l=this.binders[o];if(t&&l instanceof yr){const p=t.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(l instanceof Kt||l instanceof Xt)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(t){for(const o in this.binders){const l=this.binders[o];(l instanceof Kt||l instanceof Xt||l instanceof yr)&&l.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const o=this.binders[t];(o instanceof Kt||o instanceof Xt||o instanceof yr)&&o.destroy()}}}class Fr{constructor(t,o,l=()=>!0){this.programConfigurations={};for(const p of t)this.programConfigurations[p.id]=new Ir(p,o,l);this.needsUpload=!1,this._featureMap=new gt,this._bufferOffset=0}populatePaintArrays(t,o,l,p,m,_){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(t,o,p,m,_);o.id!==void 0&&this._featureMap.add(o.id,l,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,o,l,p){for(const m of l)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(t,this._featureMap,o,m,p)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function vn(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function xr(i,t,o){const l={color:{source:h,composite:je},number:{source:ye,composite:h}},p=function(m){return{"line-pattern":{source:z,composite:z},"fill-pattern":{source:z,composite:z},"fill-extrusion-pattern":{source:z,composite:z}}[m]}(i);return p&&p[o]||l[t][o]}kt("ConstantBinder",ei),kt("CrossFadedConstantBinder",ci),kt("SourceExpressionBinder",Kt),kt("CrossFadedCompositeBinder",yr),kt("CompositeExpressionBinder",Xt),kt("ProgramConfiguration",Ir,{omit:["_buffers"]}),kt("ProgramConfigurationSet",Fr);var zi=8192;const Jn=Math.pow(2,14)-1,On=-Jn-1;function So(i){const t=zi/i.extent,o=i.loadGeometry();for(let l=0;l<o.length;l++){const p=o[l];for(let m=0;m<p.length;m++){const _=p[m],T=Math.round(_.x*t),C=Math.round(_.y*t);_.x=Se(T,On,Jn),_.y=Se(C,On,Jn),(T<_.x||T>_.x+1||C<_.y||C>_.y+1)&&pi("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return o}function Wr(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?So(i):[]}}function To(i,t,o,l,p){i.emplaceBack(2*t+(l+1)/2,2*o+(p+1)/2)}class Io{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new c,this.indexArray=new ue,this.segments=new me,this.programConfigurations=new Fr(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(t,o,l){const p=this.layers[0],m=[];let _=null,T=!1;p.type==="circle"&&(_=p.layout.get("circle-sort-key"),T=!_.isConstant());for(const{feature:C,id:k,index:R,sourceLayerIndex:D}of t){const V=this.layers[0]._featureFilter.needGeometry,G=Wr(C,V);if(!this.layers[0]._featureFilter.filter(new or(this.zoom),G,l))continue;const Z=T?_.evaluate(G,{},l):void 0,ee={id:k,properties:C.properties,type:C.type,sourceLayerIndex:D,index:R,geometry:V?G.geometry:So(C),patterns:{},sortKey:Z};m.push(ee)}T&&m.sort((C,k)=>C.sortKey-k.sortKey);for(const C of m){const{geometry:k,index:R,sourceLayerIndex:D}=C,V=t[R].feature;this.addFeature(C,k,R,l),o.featureIndex.insert(V,k,R,D,this.index)}}update(t,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ce),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,o,l,p){for(const m of o)for(const _ of m){const T=_.x,C=_.y;if(T<0||T>=zi||C<0||C>=zi)continue;const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),R=k.vertexLength;To(this.layoutVertexArray,T,C,-1,-1),To(this.layoutVertexArray,T,C,1,-1),To(this.layoutVertexArray,T,C,1,1),To(this.layoutVertexArray,T,C,-1,1),this.indexArray.emplaceBack(R,R+1,R+2),this.indexArray.emplaceBack(R,R+3,R+2),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,{},p)}}function yl(i,t){for(let o=0;o<i.length;o++)if(Ao(t,i[o]))return!0;for(let o=0;o<t.length;o++)if(Ao(i,t[o]))return!0;return!!Gs(i,t)}function gl(i,t,o){return!!Ao(i,t)||!!Zs(t,i,o)}function Ya(i,t){if(i.length===1)return Hr(t,i[0]);for(let o=0;o<t.length;o++){const l=t[o];for(let p=0;p<l.length;p++)if(Ao(i,l[p]))return!0}for(let o=0;o<i.length;o++)if(Hr(t,i[o]))return!0;for(let o=0;o<t.length;o++)if(Gs(i,t[o]))return!0;return!1}function _l(i,t,o){if(i.length>1){if(Gs(i,t))return!0;for(let l=0;l<t.length;l++)if(Zs(t[l],i,o))return!0}for(let l=0;l<i.length;l++)if(Zs(i[l],t,o))return!0;return!1}function Gs(i,t){if(i.length===0||t.length===0)return!1;for(let o=0;o<i.length-1;o++){const l=i[o],p=i[o+1];for(let m=0;m<t.length-1;m++)if(Ma(l,p,t[m],t[m+1]))return!0}return!1}function Ma(i,t,o,l){return Si(i,o,l)!==Si(t,o,l)&&Si(i,t,o)!==Si(i,t,l)}function Zs(i,t,o){const l=o*o;if(t.length===1)return i.distSqr(t[0])<l;for(let p=1;p<t.length;p++)if(ya(i,t[p-1],t[p])<l)return!0;return!1}function ya(i,t,o){const l=t.distSqr(o);if(l===0)return i.distSqr(t);const p=((i.x-t.x)*(o.x-t.x)+(i.y-t.y)*(o.y-t.y))/l;return i.distSqr(p<0?t:p>1?o:o.sub(t)._mult(p)._add(t))}function Hr(i,t){let o,l,p,m=!1;for(let _=0;_<i.length;_++){o=i[_];for(let T=0,C=o.length-1;T<o.length;C=T++)l=o[T],p=o[C],l.y>t.y!=p.y>t.y&&t.x<(p.x-l.x)*(t.y-l.y)/(p.y-l.y)+l.x&&(m=!m)}return m}function Ao(i,t){let o=!1;for(let l=0,p=i.length-1;l<i.length;p=l++){const m=i[l],_=i[p];m.y>t.y!=_.y>t.y&&t.x<(_.x-m.x)*(t.y-m.y)/(_.y-m.y)+m.x&&(o=!o)}return o}function _s(i,t,o){const l=o[0],p=o[2];if(i.x<l.x&&t.x<l.x||i.x>p.x&&t.x>p.x||i.y<l.y&&t.y<l.y||i.y>p.y&&t.y>p.y)return!1;const m=Si(i,t,o[0]);return m!==Si(i,t,o[1])||m!==Si(i,t,o[2])||m!==Si(i,t,o[3])}function ga(i,t,o){const l=t.paint.get(i).value;return l.kind==="constant"?l.value:o.programConfigurations.get(t.id).getMaxValue(i)}function Ri(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Yn(i,t,o,l,p){if(!t[0]&&!t[1])return i;const m=Yt.convert(t)._mult(p);o==="viewport"&&m._rotate(-l);const _=[];for(let T=0;T<i.length;T++)_.push(i[T].sub(m));return _}kt("CircleBucket",Io,{omit:["layers"]});const go=new mr({"circle-sort-key":new wt(ot.layout_circle["circle-sort-key"])});var $s={paint:new mr({"circle-radius":new wt(ot.paint_circle["circle-radius"]),"circle-color":new wt(ot.paint_circle["circle-color"]),"circle-blur":new wt(ot.paint_circle["circle-blur"]),"circle-opacity":new wt(ot.paint_circle["circle-opacity"]),"circle-translate":new Vt(ot.paint_circle["circle-translate"]),"circle-translate-anchor":new Vt(ot.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Vt(ot.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Vt(ot.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new wt(ot.paint_circle["circle-stroke-width"]),"circle-stroke-color":new wt(ot.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new wt(ot.paint_circle["circle-stroke-opacity"])}),layout:go},vl=typeof Float32Array!="undefined"?Float32Array:Array;function xl(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function bc(i,t,o){var l=t[0],p=t[1],m=t[2],_=t[3],T=t[4],C=t[5],k=t[6],R=t[7],D=t[8],V=t[9],G=t[10],Z=t[11],ee=t[12],ae=t[13],we=t[14],ke=t[15],Re=o[0],Be=o[1],$e=o[2],Oe=o[3];return i[0]=Re*l+Be*T+$e*D+Oe*ee,i[1]=Re*p+Be*C+$e*V+Oe*ae,i[2]=Re*m+Be*k+$e*G+Oe*we,i[3]=Re*_+Be*R+$e*Z+Oe*ke,i[4]=(Re=o[4])*l+(Be=o[5])*T+($e=o[6])*D+(Oe=o[7])*ee,i[5]=Re*p+Be*C+$e*V+Oe*ae,i[6]=Re*m+Be*k+$e*G+Oe*we,i[7]=Re*_+Be*R+$e*Z+Oe*ke,i[8]=(Re=o[8])*l+(Be=o[9])*T+($e=o[10])*D+(Oe=o[11])*ee,i[9]=Re*p+Be*C+$e*V+Oe*ae,i[10]=Re*m+Be*k+$e*G+Oe*we,i[11]=Re*_+Be*R+$e*Z+Oe*ke,i[12]=(Re=o[12])*l+(Be=o[13])*T+($e=o[14])*D+(Oe=o[15])*ee,i[13]=Re*p+Be*C+$e*V+Oe*ae,i[14]=Re*m+Be*k+$e*G+Oe*we,i[15]=Re*_+Be*R+$e*Z+Oe*ke,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var Qa,wc=bc;function es(i,t,o){var l=t[0],p=t[1],m=t[2],_=t[3];return i[0]=o[0]*l+o[4]*p+o[8]*m+o[12]*_,i[1]=o[1]*l+o[5]*p+o[9]*m+o[13]*_,i[2]=o[2]*l+o[6]*p+o[10]*m+o[14]*_,i[3]=o[3]*l+o[7]*p+o[11]*m+o[15]*_,i}function Wl(i,t){const o=es([],[i.x,i.y,0,1],t);return new Yt(o[0]/o[3],o[1]/o[3])}Qa=new vl(4),vl!=Float32Array&&(Qa[0]=0,Qa[1]=0,Qa[2]=0,Qa[3]=0);class Ec extends Io{}kt("HeatmapBucket",Ec,{omit:["layers"]});var Hl={paint:new mr({"heatmap-radius":new wt(ot.paint_heatmap["heatmap-radius"]),"heatmap-weight":new wt(ot.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Vt(ot.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Nr(ot.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Vt(ot.paint_heatmap["heatmap-opacity"])})};function Qn(i,{width:t,height:o},l,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==t*o*l)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${t*o*l}`)}else p=new Uint8Array(t*o*l);return i.width=t,i.height=o,i.data=p,i}function Oh(i,{width:t,height:o},l){if(t===i.width&&o===i.height)return;const p=Qn({},{width:t,height:o},l);Sc(i,p,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,o)},l),i.width=t,i.height=o,i.data=p.data}function Sc(i,t,o,l,p,m){if(p.width===0||p.height===0)return t;if(p.width>i.width||p.height>i.height||o.x>i.width-p.width||o.y>i.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>t.width||p.height>t.height||l.x>t.width-p.width||l.y>t.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const _=i.data,T=t.data;for(let C=0;C<p.height;C++){const k=((o.y+C)*i.width+o.x)*m,R=((l.y+C)*t.width+l.x)*m;for(let D=0;D<p.width*m;D++)T[R+D]=_[k+D]}return t}class Zu{constructor(t,o){Qn(this,t,1,o)}resize(t){Oh(this,t,1)}clone(){return new Zu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,o,l,p,m){Sc(t,o,l,p,m,1)}}class _a{constructor(t,o){Qn(this,t,4,o)}resize(t){Oh(this,t,4)}replace(t,o){o?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new _a({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,o,l,p,m){Sc(t,o,l,p,m,4)}}function Fh(i){const t={},o=i.resolution||256,l=i.clips?i.clips.length:1,p=i.image||new _a({width:o,height:l}),m=(_,T,C)=>{t[i.evaluationKey]=C;const k=i.expression.evaluate(t);p.data[_+T+0]=Math.floor(255*k.r/k.a),p.data[_+T+1]=Math.floor(255*k.g/k.a),p.data[_+T+2]=Math.floor(255*k.b/k.a),p.data[_+T+3]=Math.floor(255*k.a)};if(i.clips)for(let _=0,T=0;_<l;++_,T+=4*o)for(let C=0,k=0;C<o;C++,k+=4){const R=C/(o-1),{start:D,end:V}=i.clips[_];m(T,k,D*(1-R)+V*R)}else for(let _=0,T=0;_<o;_++,T+=4)m(0,T,_/(o-1));return p}kt("AlphaImage",Zu),kt("RGBAImage",_a);var Op={paint:new mr({"hillshade-illumination-direction":new Vt(ot.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Vt(ot.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Vt(ot.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Vt(ot.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Vt(ot.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Vt(ot.paint_hillshade["hillshade-accent-color"])})};const th=Tt([{name:"a_pos",components:2,type:"Int16"}],4),{members:Fp}=th;var gu={exports:{}};function $u(i,t,o){o=o||2;var l,p,m,_,T,C,k,R=t&&t.length,D=R?t[0]*o:i.length,V=Xs(i,0,D,o,!0),G=[];if(!V||V.next===V.prev)return G;if(R&&(V=function(ee,ae,we,ke){var Re,Be,$e,Oe=[];for(Re=0,Be=ae.length;Re<Be;Re++)($e=Xs(ee,ae[Re]*ke,Re<Be-1?ae[Re+1]*ke:ee.length,ke,!1))===$e.next&&($e.steiner=!0),Oe.push(_u($e));for(Oe.sort(qp),Re=0;Re<Oe.length;Re++)we=La(we=Gp(Oe[Re],we),we.next);return we}(i,t,V,o)),i.length>80*o){l=m=i[0],p=_=i[1];for(var Z=o;Z<D;Z+=o)(T=i[Z])<l&&(l=T),(C=i[Z+1])<p&&(p=C),T>m&&(m=T),C>_&&(_=C);k=(k=Math.max(m-l,_-p))!==0?1/k:0}return Xu(V,G,o,l,p,k),G}function Xs(i,t,o,l,p){var m,_;if(p===oh(i,t,o,l)>0)for(m=t;m<o;m+=l)_=bu(m,i[m],i[m+1],_);else for(m=o-l;m>=t;m-=l)_=bu(m,i[m],i[m+1],_);return _&&Wu(_,_.next)&&(Jl(_),_=_.next),_}function La(i,t){if(!i)return i;t||(t=i);var o,l=i;do if(o=!1,l.steiner||!Wu(l,l.next)&&Pr(l.prev,l,l.next)!==0)l=l.next;else{if(Jl(l),(l=t=l.prev)===l.next)break;o=!0}while(o||l!==t);return t}function Xu(i,t,o,l,p,m,_){if(i){!_&&m&&function(R,D,V,G){var Z=R;do Z.z===null&&(Z.z=rh(Z.x,Z.y,D,V,G)),Z.prevZ=Z.prev,Z.nextZ=Z.next,Z=Z.next;while(Z!==R);Z.prevZ.nextZ=null,Z.prevZ=null,function(ee){var ae,we,ke,Re,Be,$e,Oe,dt,ht=1;do{for(we=ee,ee=null,Be=null,$e=0;we;){for($e++,ke=we,Oe=0,ae=0;ae<ht&&(Oe++,ke=ke.nextZ);ae++);for(dt=ht;Oe>0||dt>0&&ke;)Oe!==0&&(dt===0||!ke||we.z<=ke.z)?(Re=we,we=we.nextZ,Oe--):(Re=ke,ke=ke.nextZ,dt--),Be?Be.nextZ=Re:ee=Re,Re.prevZ=Be,Be=Re;we=ke}Be.nextZ=null,ht*=2}while($e>1)}(Z)}(i,l,p,m);for(var T,C,k=i;i.prev!==i.next;)if(T=i.prev,C=i.next,m?Vp(i,l,p,m):Up(i))t.push(T.i/o),t.push(i.i/o),t.push(C.i/o),Jl(i),i=C.next,k=C.next;else if((i=C)===k){_?_===1?Xu(i=Np(La(i),t,o),t,o,l,p,m,2):_===2&&jp(i,t,o,l,p,m):Xu(La(i),t,o,l,p,m,1);break}}}function Up(i){var t=i.prev,o=i,l=i.next;if(Pr(t,o,l)>=0)return!1;for(var p=i.next.next;p!==i.prev;){if(vu(t.x,t.y,o.x,o.y,l.x,l.y,p.x,p.y)&&Pr(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function Vp(i,t,o,l){var p=i.prev,m=i,_=i.next;if(Pr(p,m,_)>=0)return!1;for(var T=p.x>m.x?p.x>_.x?p.x:_.x:m.x>_.x?m.x:_.x,C=p.y>m.y?p.y>_.y?p.y:_.y:m.y>_.y?m.y:_.y,k=rh(p.x<m.x?p.x<_.x?p.x:_.x:m.x<_.x?m.x:_.x,p.y<m.y?p.y<_.y?p.y:_.y:m.y<_.y?m.y:_.y,t,o,l),R=rh(T,C,t,o,l),D=i.prevZ,V=i.nextZ;D&&D.z>=k&&V&&V.z<=R;){if(D!==i.prev&&D!==i.next&&vu(p.x,p.y,m.x,m.y,_.x,_.y,D.x,D.y)&&Pr(D.prev,D,D.next)>=0||(D=D.prevZ,V!==i.prev&&V!==i.next&&vu(p.x,p.y,m.x,m.y,_.x,_.y,V.x,V.y)&&Pr(V.prev,V,V.next)>=0))return!1;V=V.nextZ}for(;D&&D.z>=k;){if(D!==i.prev&&D!==i.next&&vu(p.x,p.y,m.x,m.y,_.x,_.y,D.x,D.y)&&Pr(D.prev,D,D.next)>=0)return!1;D=D.prevZ}for(;V&&V.z<=R;){if(V!==i.prev&&V!==i.next&&vu(p.x,p.y,m.x,m.y,_.x,_.y,V.x,V.y)&&Pr(V.prev,V,V.next)>=0)return!1;V=V.nextZ}return!0}function Np(i,t,o){var l=i;do{var p=l.prev,m=l.next.next;!Wu(p,m)&&Hu(p,l,l.next,m)&&xu(p,m)&&xu(m,p)&&(t.push(p.i/o),t.push(l.i/o),t.push(m.i/o),Jl(l),Jl(l.next),l=i=m),l=l.next}while(l!==i);return La(l)}function jp(i,t,o,l,p,m){var _=i;do{for(var T=_.next.next;T!==_.prev;){if(_.i!==T.i&&Kr(_,T)){var C=nh(_,T);return _=La(_,_.next),C=La(C,C.next),Xu(_,t,o,l,p,m),void Xu(C,t,o,l,p,m)}T=T.next}_=_.next}while(_!==i)}function qp(i,t){return i.x-t.x}function Gp(i,t){var o=function(m,_){var T,C=_,k=m.x,R=m.y,D=-1/0;do{if(R<=C.y&&R>=C.next.y&&C.next.y!==C.y){var V=C.x+(R-C.y)*(C.next.x-C.x)/(C.next.y-C.y);if(V<=k&&V>D){if(D=V,V===k){if(R===C.y)return C;if(R===C.next.y)return C.next}T=C.x<C.next.x?C:C.next}}C=C.next}while(C!==_);if(!T)return null;if(k===D)return T;var G,Z=T,ee=T.x,ae=T.y,we=1/0;C=T;do k>=C.x&&C.x>=ee&&k!==C.x&&vu(R<ae?k:D,R,ee,ae,R<ae?D:k,R,C.x,C.y)&&(G=Math.abs(R-C.y)/(k-C.x),xu(C,m)&&(G<we||G===we&&(C.x>T.x||C.x===T.x&&ih(T,C)))&&(T=C,we=G)),C=C.next;while(C!==Z);return T}(i,t);if(!o)return t;var l=nh(o,i),p=La(o,o.next);return La(l,l.next),t===o?p:t}function ih(i,t){return Pr(i.prev,i,t.prev)<0&&Pr(t.next,i,i.next)<0}function rh(i,t,o,l,p){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-o)*p)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-l)*p)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function _u(i){var t=i,o=i;do(t.x<o.x||t.x===o.x&&t.y<o.y)&&(o=t),t=t.next;while(t!==i);return o}function vu(i,t,o,l,p,m,_,T){return(p-_)*(t-T)-(i-_)*(m-T)>=0&&(i-_)*(l-T)-(o-_)*(t-T)>=0&&(o-_)*(m-T)-(p-_)*(l-T)>=0}function Kr(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(o,l){var p=o;do{if(p.i!==o.i&&p.next.i!==o.i&&p.i!==l.i&&p.next.i!==l.i&&Hu(p,p.next,o,l))return!0;p=p.next}while(p!==o);return!1}(i,t)&&(xu(i,t)&&xu(t,i)&&function(o,l){var p=o,m=!1,_=(o.x+l.x)/2,T=(o.y+l.y)/2;do p.y>T!=p.next.y>T&&p.next.y!==p.y&&_<(p.next.x-p.x)*(T-p.y)/(p.next.y-p.y)+p.x&&(m=!m),p=p.next;while(p!==o);return m}(i,t)&&(Pr(i.prev,i,t.prev)||Pr(i,t.prev,t))||Wu(i,t)&&Pr(i.prev,i,i.next)>0&&Pr(t.prev,t,t.next)>0)}function Pr(i,t,o){return(t.y-i.y)*(o.x-t.x)-(t.x-i.x)*(o.y-t.y)}function Wu(i,t){return i.x===t.x&&i.y===t.y}function Hu(i,t,o,l){var p=bl(Pr(i,t,o)),m=bl(Pr(i,t,l)),_=bl(Pr(o,l,i)),T=bl(Pr(o,l,t));return p!==m&&_!==T||!(p!==0||!Kl(i,o,t))||!(m!==0||!Kl(i,l,t))||!(_!==0||!Kl(o,i,l))||!(T!==0||!Kl(o,t,l))}function Kl(i,t,o){return t.x<=Math.max(i.x,o.x)&&t.x>=Math.min(i.x,o.x)&&t.y<=Math.max(i.y,o.y)&&t.y>=Math.min(i.y,o.y)}function bl(i){return i>0?1:i<0?-1:0}function xu(i,t){return Pr(i.prev,i,i.next)<0?Pr(i,t,i.next)>=0&&Pr(i,i.prev,t)>=0:Pr(i,t,i.prev)<0||Pr(i,i.next,t)<0}function nh(i,t){var o=new Ku(i.i,i.x,i.y),l=new Ku(t.i,t.x,t.y),p=i.next,m=t.prev;return i.next=t,t.prev=i,o.next=p,p.prev=o,l.next=o,o.prev=l,m.next=l,l.prev=m,l}function bu(i,t,o,l){var p=new Ku(i,t,o);return l?(p.next=l.next,p.prev=l,l.next.prev=p,l.next=p):(p.prev=p,p.next=p),p}function Jl(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Ku(i,t,o){this.i=i,this.x=t,this.y=o,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function oh(i,t,o,l){for(var p=0,m=t,_=o-l;m<o;m+=l)p+=(i[_]-i[m])*(i[m+1]+i[_+1]),_=m;return p}gu.exports=$u,gu.exports.default=$u,$u.deviation=function(i,t,o,l){var p=t&&t.length,m=Math.abs(oh(i,0,p?t[0]*o:i.length,o));if(p)for(var _=0,T=t.length;_<T;_++)m-=Math.abs(oh(i,t[_]*o,_<T-1?t[_+1]*o:i.length,o));var C=0;for(_=0;_<l.length;_+=3){var k=l[_]*o,R=l[_+1]*o,D=l[_+2]*o;C+=Math.abs((i[k]-i[D])*(i[R+1]-i[k+1])-(i[k]-i[R])*(i[D+1]-i[k+1]))}return m===0&&C===0?0:Math.abs((C-m)/m)},$u.flatten=function(i){for(var t=i[0][0].length,o={vertices:[],holes:[],dimensions:t},l=0,p=0;p<i.length;p++){for(var m=0;m<i[p].length;m++)for(var _=0;_<t;_++)o.vertices.push(i[p][m][_]);p>0&&o.holes.push(l+=i[p-1].length)}return o};var wu=gu.exports;function Zp(i,t,o,l,p){Tc(i,t,o||0,l||i.length-1,p||ah)}function Tc(i,t,o,l,p){for(;l>o;){if(l-o>600){var m=l-o+1,_=t-o+1,T=Math.log(m),C=.5*Math.exp(2*T/3),k=.5*Math.sqrt(T*C*(m-C)/m)*(_-m/2<0?-1:1);Tc(i,t,Math.max(o,Math.floor(t-_*C/m+k)),Math.min(l,Math.floor(t+(m-_)*C/m+k)),p)}var R=i[t],D=o,V=l;for(Ju(i,o,t),p(i[l],R)>0&&Ju(i,o,l);D<V;){for(Ju(i,D,V),D++,V--;p(i[D],R)<0;)D++;for(;p(i[V],R)>0;)V--}p(i[o],R)===0?Ju(i,o,V):Ju(i,++V,l),V<=t&&(o=V+1),t<=V&&(l=V-1)}}function Ju(i,t,o){var l=i[t];i[t]=i[o],i[o]=l}function ah(i,t){return i<t?-1:i>t?1:0}function Yu(i,t){const o=i.length;if(o<=1)return[i];const l=[];let p,m;for(let _=0;_<o;_++){const T=Ni(i[_]);T!==0&&(i[_].area=Math.abs(T),m===void 0&&(m=T<0),m===T<0?(p&&l.push(p),p=[i[_]]):p.push(i[_]))}if(p&&l.push(p),t>1)for(let _=0;_<l.length;_++)l[_].length<=t||(Zp(l[_],t,1,l[_].length-1,ts),l[_]=l[_].slice(0,t));return l}function ts(i,t){return t.area-i.area}function sh(i,t,o){const l=o.patternDependencies;let p=!1;for(const m of t){const _=m.paint.get(`${i}-pattern`);_.isConstant()||(p=!0);const T=_.constantOr(null);T&&(p=!0,l[T.to]=!0,l[T.from]=!0)}return p}function lh(i,t,o,l,p){const m=p.patternDependencies;for(const _ of t){const T=_.paint.get(`${i}-pattern`).value;if(T.kind!=="constant"){let C=T.evaluate({zoom:l-1},o,{},p.availableImages),k=T.evaluate({zoom:l},o,{},p.availableImages),R=T.evaluate({zoom:l+1},o,{},p.availableImages);C=C&&C.name?C.name:C,k=k&&k.name?k.name:k,R=R&&R.name?R.name:R,m[C]=!0,m[k]=!0,m[R]=!0,o.patterns[_.id]={min:C,mid:k,max:R}}}return o}class uh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new u,this.indexArray=new ue,this.indexArray2=new Ee,this.programConfigurations=new Fr(t.layers,t.zoom),this.segments=new me,this.segments2=new me,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(t,o,l){this.hasPattern=sh("fill",this.layers,o);const p=this.layers[0].layout.get("fill-sort-key"),m=!p.isConstant(),_=[];for(const{feature:T,id:C,index:k,sourceLayerIndex:R}of t){const D=this.layers[0]._featureFilter.needGeometry,V=Wr(T,D);if(!this.layers[0]._featureFilter.filter(new or(this.zoom),V,l))continue;const G=m?p.evaluate(V,{},l,o.availableImages):void 0,Z={id:C,properties:T.properties,type:T.type,sourceLayerIndex:R,index:k,geometry:D?V.geometry:So(T),patterns:{},sortKey:G};_.push(Z)}m&&_.sort((T,C)=>T.sortKey-C.sortKey);for(const T of _){const{geometry:C,index:k,sourceLayerIndex:R}=T;if(this.hasPattern){const D=lh("fill",this.layers,T,this.zoom,o);this.patternFeatures.push(D)}else this.addFeature(T,C,k,l,{});o.featureIndex.insert(t[k].feature,C,k,R,this.index)}}update(t,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,l)}addFeatures(t,o,l){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,o,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Fp),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,o,l,p,m){for(const _ of Yu(o,500)){let T=0;for(const G of _)T+=G.length;const C=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),k=C.vertexLength,R=[],D=[];for(const G of _){if(G.length===0)continue;G!==_[0]&&D.push(R.length/2);const Z=this.segments2.prepareSegment(G.length,this.layoutVertexArray,this.indexArray2),ee=Z.vertexLength;this.layoutVertexArray.emplaceBack(G[0].x,G[0].y),this.indexArray2.emplaceBack(ee+G.length-1,ee),R.push(G[0].x),R.push(G[0].y);for(let ae=1;ae<G.length;ae++)this.layoutVertexArray.emplaceBack(G[ae].x,G[ae].y),this.indexArray2.emplaceBack(ee+ae-1,ee+ae),R.push(G[ae].x),R.push(G[ae].y);Z.vertexLength+=G.length,Z.primitiveLength+=G.length}const V=wu(R,D);for(let G=0;G<V.length;G+=3)this.indexArray.emplaceBack(k+V[G],k+V[G+1],k+V[G+2]);C.vertexLength+=T,C.primitiveLength+=V.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,m,p)}}kt("FillBucket",uh,{omit:["layers","patternFeatures"]});const $p=new mr({"fill-sort-key":new wt(ot.layout_fill["fill-sort-key"])});var Uh={paint:new mr({"fill-antialias":new Vt(ot.paint_fill["fill-antialias"]),"fill-opacity":new wt(ot.paint_fill["fill-opacity"]),"fill-color":new wt(ot.paint_fill["fill-color"]),"fill-outline-color":new wt(ot.paint_fill["fill-outline-color"]),"fill-translate":new Vt(ot.paint_fill["fill-translate"]),"fill-translate-anchor":new Vt(ot.paint_fill["fill-translate-anchor"]),"fill-pattern":new Hn(ot.paint_fill["fill-pattern"])}),layout:$p};const Eu=Tt([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),{members:Xp}=Eu;var wl={},Vh=Yt,ch=Su;function Su(i,t,o,l,p){this.properties={},this.extent=o,this.type=0,this._pbf=i,this._geometry=-1,this._keys=l,this._values=p,i.readFields(Wp,this,t)}function Wp(i,t,o){i==1?t.id=o.readVarint():i==2?function(l,p){for(var m=l.readVarint()+l.pos;l.pos<m;){var _=p._keys[l.readVarint()],T=p._values[l.readVarint()];p.properties[_]=T}}(o,t):i==3?t.type=o.readVarint():i==4&&(t._geometry=o.pos)}function Tu(i){for(var t,o,l=0,p=0,m=i.length,_=m-1;p<m;_=p++)l+=((o=i[_]).x-(t=i[p]).x)*(t.y+o.y);return l}Su.types=["Unknown","Point","LineString","Polygon"],Su.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,o=i.readVarint()+i.pos,l=1,p=0,m=0,_=0,T=[];i.pos<o;){if(p<=0){var C=i.readVarint();l=7&C,p=C>>3}if(p--,l===1||l===2)m+=i.readSVarint(),_+=i.readSVarint(),l===1&&(t&&T.push(t),t=[]),t.push(new Vh(m,_));else{if(l!==7)throw new Error("unknown command "+l);t&&t.push(t[0].clone())}}return t&&T.push(t),T},Su.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,o=1,l=0,p=0,m=0,_=1/0,T=-1/0,C=1/0,k=-1/0;i.pos<t;){if(l<=0){var R=i.readVarint();o=7&R,l=R>>3}if(l--,o===1||o===2)(p+=i.readSVarint())<_&&(_=p),p>T&&(T=p),(m+=i.readSVarint())<C&&(C=m),m>k&&(k=m);else if(o!==7)throw new Error("unknown command "+o)}return[_,C,T,k]},Su.prototype.toGeoJSON=function(i,t,o){var l,p,m=this.extent*Math.pow(2,o),_=this.extent*i,T=this.extent*t,C=this.loadGeometry(),k=Su.types[this.type];function R(G){for(var Z=0;Z<G.length;Z++){var ee=G[Z];G[Z]=[360*(ee.x+_)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(ee.y+T)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var D=[];for(l=0;l<C.length;l++)D[l]=C[l][0];R(C=D);break;case 2:for(l=0;l<C.length;l++)R(C[l]);break;case 3:for(C=function(G){var Z=G.length;if(Z<=1)return[G];for(var ee,ae,we=[],ke=0;ke<Z;ke++){var Re=Tu(G[ke]);Re!==0&&(ae===void 0&&(ae=Re<0),ae===Re<0?(ee&&we.push(ee),ee=[G[ke]]):ee.push(G[ke]))}return ee&&we.push(ee),we}(C),l=0;l<C.length;l++)for(p=0;p<C[l].length;p++)R(C[l][p])}C.length===1?C=C[0]:k="Multi"+k;var V={type:"Feature",geometry:{type:k,coordinates:C},properties:this.properties};return"id"in this&&(V.id=this.id),V};var Hp=ch,Ic=Iu;function Iu(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(is,this,t),this.length=this._features.length}function is(i,t,o){i===15?t.version=o.readVarint():i===1?t.name=o.readString():i===5?t.extent=o.readVarint():i===2?t._features.push(o.pos):i===3?t._keys.push(o.readString()):i===4&&t._values.push(function(l){for(var p=null,m=l.readVarint()+l.pos;l.pos<m;){var _=l.readVarint()>>3;p=_===1?l.readString():_===2?l.readFloat():_===3?l.readDouble():_===4?l.readVarint64():_===5?l.readVarint():_===6?l.readSVarint():_===7?l.readBoolean():null}return p}(o))}Iu.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new Hp(this._pbf,t,this.extent,this._keys,this._values)};var Kp=Ic;function Jp(i,t,o){if(i===3){var l=new Kp(o,o.readVarint()+o.pos);l.length&&(t[l.name]=l)}}wl.VectorTile=function(i,t){this.layers=i.readFields(Jp,{},t)},wl.VectorTileFeature=ch,wl.VectorTileLayer=Ic;const Yp=wl.VectorTileFeature.types,Yl=Math.pow(2,13);function Au(i,t,o,l,p,m,_,T){i.emplaceBack(t,o,2*Math.floor(l*Yl)+_,p*Yl*2,m*Yl*2,Math.round(T))}class hh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new f,this.indexArray=new ue,this.programConfigurations=new Fr(t.layers,t.zoom),this.segments=new me,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(t,o,l){this.features=[],this.hasPattern=sh("fill-extrusion",this.layers,o);for(const{feature:p,id:m,index:_,sourceLayerIndex:T}of t){const C=this.layers[0]._featureFilter.needGeometry,k=Wr(p,C);if(!this.layers[0]._featureFilter.filter(new or(this.zoom),k,l))continue;const R={id:m,sourceLayerIndex:T,index:_,geometry:C?k.geometry:So(p),properties:p.properties,type:p.type,patterns:{}};this.hasPattern?this.features.push(lh("fill-extrusion",this.layers,R,this.zoom,o)):this.addFeature(R,R.geometry,_,l,{}),o.featureIndex.insert(p,R.geometry,_,T,this.index,!0)}}addFeatures(t,o,l){for(const p of this.features){const{geometry:m}=p;this.addFeature(p,m,p.index,o,l)}}update(t,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Xp),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,o,l,p,m){for(const _ of Yu(o,500)){let T=0;for(const G of _)T+=G.length;let C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const G of _){if(G.length===0||ed(G))continue;let Z=0;for(let ee=0;ee<G.length;ee++){const ae=G[ee];if(ee>=1){const we=G[ee-1];if(!Qp(ae,we)){C.vertexLength+4>me.MAX_VERTEX_ARRAY_LENGTH&&(C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ke=ae.sub(we)._perp()._unit(),Re=we.dist(ae);Z+Re>32768&&(Z=0),Au(this.layoutVertexArray,ae.x,ae.y,ke.x,ke.y,0,0,Z),Au(this.layoutVertexArray,ae.x,ae.y,ke.x,ke.y,0,1,Z),Z+=Re,Au(this.layoutVertexArray,we.x,we.y,ke.x,ke.y,0,0,Z),Au(this.layoutVertexArray,we.x,we.y,ke.x,ke.y,0,1,Z);const Be=C.vertexLength;this.indexArray.emplaceBack(Be,Be+2,Be+1),this.indexArray.emplaceBack(Be+1,Be+2,Be+3),C.vertexLength+=4,C.primitiveLength+=2}}}}if(C.vertexLength+T>me.MAX_VERTEX_ARRAY_LENGTH&&(C=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray)),Yp[t.type]!=="Polygon")continue;const k=[],R=[],D=C.vertexLength;for(const G of _)if(G.length!==0){G!==_[0]&&R.push(k.length/2);for(let Z=0;Z<G.length;Z++){const ee=G[Z];Au(this.layoutVertexArray,ee.x,ee.y,0,0,1,1,0),k.push(ee.x),k.push(ee.y)}}const V=wu(k,R);for(let G=0;G<V.length;G+=3)this.indexArray.emplaceBack(D+V[G],D+V[G+2],D+V[G+1]);C.primitiveLength+=V.length/3,C.vertexLength+=T}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,m,p)}}function Qp(i,t){return i.x===t.x&&(i.x<0||i.x>zi)||i.y===t.y&&(i.y<0||i.y>zi)}function ed(i){return i.every(t=>t.x<0)||i.every(t=>t.x>zi)||i.every(t=>t.y<0)||i.every(t=>t.y>zi)}kt("FillExtrusionBucket",hh,{omit:["layers","features"]});var td={paint:new mr({"fill-extrusion-opacity":new Vt(ot["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new wt(ot["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Vt(ot["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Vt(ot["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Hn(ot["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new wt(ot["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new wt(ot["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Vt(ot["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Cu(i,t){return i.x*t.x+i.y*t.y}function eo(i,t){if(i.length===1){let o=0;const l=t[o++];let p;for(;!p||l.equals(p);)if(p=t[o++],!p)return 1/0;for(;o<t.length;o++){const m=t[o],_=i[0],T=p.sub(l),C=m.sub(l),k=_.sub(l),R=Cu(T,T),D=Cu(T,C),V=Cu(C,C),G=Cu(k,T),Z=Cu(k,C),ee=R*V-D*D,ae=(V*G-D*Z)/ee,we=(R*Z-D*G)/ee,ke=l.z*(1-ae-we)+p.z*ae+m.z*we;if(isFinite(ke))return ke}return 1/0}{let o=1/0;for(const l of t)o=Math.min(o,l.z);return o}}const id=Tt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Nh}=id,jh=Tt([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:rd}=jh,qh=wl.VectorTileFeature.types,nd=Math.cos(Math.PI/180*37.5),Gh=Math.pow(2,14)/.5;class ph{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(o=>o.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new S,this.layoutVertexArray2=new A,this.indexArray=new ue,this.programConfigurations=new Fr(t.layers,t.zoom),this.segments=new me,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(t,o,l){this.hasPattern=sh("line",this.layers,o);const p=this.layers[0].layout.get("line-sort-key"),m=!p.isConstant(),_=[];for(const{feature:T,id:C,index:k,sourceLayerIndex:R}of t){const D=this.layers[0]._featureFilter.needGeometry,V=Wr(T,D);if(!this.layers[0]._featureFilter.filter(new or(this.zoom),V,l))continue;const G=m?p.evaluate(V,{},l):void 0,Z={id:C,properties:T.properties,type:T.type,sourceLayerIndex:R,index:k,geometry:D?V.geometry:So(T),patterns:{},sortKey:G};_.push(Z)}m&&_.sort((T,C)=>T.sortKey-C.sortKey);for(const T of _){const{geometry:C,index:k,sourceLayerIndex:R}=T;if(this.hasPattern){const D=lh("line",this.layers,T,this.zoom,o);this.patternFeatures.push(D)}else this.addFeature(T,C,k,l,{});o.featureIndex.insert(t[k].feature,C,k,R,this.index)}}update(t,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,l)}addFeatures(t,o,l){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,o,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,rd)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Nh),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,o,l,p,m){const _=this.layers[0].layout,T=_.get("line-join").evaluate(t,{}),C=_.get("line-cap"),k=_.get("line-miter-limit"),R=_.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const D of o)this.addLine(D,t,T,C,k,R);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,m,p)}addLine(t,o,l,p,m,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let we=0;we<t.length-1;we++)this.totalDistance+=t[we].dist(t[we+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=qh[o.type]==="Polygon";let C=t.length;for(;C>=2&&t[C-1].equals(t[C-2]);)C--;let k=0;for(;k<C-1&&t[k].equals(t[k+1]);)k++;if(C<(T?3:2))return;l==="bevel"&&(m=1.05);const R=this.overscaling<=16?122880/(512*this.overscaling):0,D=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let V,G,Z,ee,ae;this.e1=this.e2=-1,T&&(V=t[C-2],ae=t[k].sub(V)._unit()._perp());for(let we=k;we<C;we++){if(Z=we===C-1?T?t[k+1]:void 0:t[we+1],Z&&t[we].equals(Z))continue;ae&&(ee=ae),V&&(G=V),V=t[we],ae=Z?Z.sub(V)._unit()._perp():ee,ee=ee||ae;let ke=ee.add(ae);ke.x===0&&ke.y===0||ke._unit();const Re=ee.x*ae.x+ee.y*ae.y,Be=ke.x*ae.x+ke.y*ae.y,$e=Be!==0?1/Be:1/0,Oe=2*Math.sqrt(2-2*Be),dt=Be<nd&&G&&Z,ht=ee.x*ae.y-ee.y*ae.x>0;if(dt&&we>k){const nt=V.dist(G);if(nt>2*R){const ft=V.sub(V.sub(G)._mult(R/nt)._round());this.updateDistance(G,ft),this.addCurrentVertex(ft,ee,0,0,D),G=ft}}const Ye=G&&Z;let ct=Ye?l:T?"butt":p;if(Ye&&ct==="round"&&($e<_?ct="miter":$e<=2&&(ct="fakeround")),ct==="miter"&&$e>m&&(ct="bevel"),ct==="bevel"&&($e>2&&(ct="flipbevel"),$e<m&&(ct="miter")),G&&this.updateDistance(G,V),ct==="miter")ke._mult($e),this.addCurrentVertex(V,ke,0,0,D);else if(ct==="flipbevel"){if($e>100)ke=ae.mult(-1);else{const nt=$e*ee.add(ae).mag()/ee.sub(ae).mag();ke._perp()._mult(nt*(ht?-1:1))}this.addCurrentVertex(V,ke,0,0,D),this.addCurrentVertex(V,ke.mult(-1),0,0,D)}else if(ct==="bevel"||ct==="fakeround"){const nt=-Math.sqrt($e*$e-1),ft=ht?nt:0,tt=ht?0:nt;if(G&&this.addCurrentVertex(V,ee,ft,tt,D),ct==="fakeround"){const at=Math.round(180*Oe/Math.PI/20);for(let Bt=1;Bt<at;Bt++){let Dt=Bt/at;if(Dt!==.5){const ri=Dt-.5;Dt+=Dt*ri*(Dt-1)*((1.0904+Re*(Re*(3.55645-1.43519*Re)-3.2452))*ri*ri+(.848013+Re*(.215638*Re-1.06021)))}const Qt=ae.sub(ee)._mult(Dt)._add(ee)._unit()._mult(ht?-1:1);this.addHalfVertex(V,Qt.x,Qt.y,!1,ht,0,D)}}Z&&this.addCurrentVertex(V,ae,-ft,-tt,D)}else if(ct==="butt")this.addCurrentVertex(V,ke,0,0,D);else if(ct==="square"){const nt=G?1:-1;this.addCurrentVertex(V,ke,nt,nt,D)}else ct==="round"&&(G&&(this.addCurrentVertex(V,ee,0,0,D),this.addCurrentVertex(V,ee,1,1,D,!0)),Z&&(this.addCurrentVertex(V,ae,-1,-1,D,!0),this.addCurrentVertex(V,ae,0,0,D)));if(dt&&we<C-1){const nt=V.dist(Z);if(nt>2*R){const ft=V.add(Z.sub(V)._mult(R/nt)._round());this.updateDistance(V,ft),this.addCurrentVertex(ft,ae,0,0,D),V=ft}}}}addCurrentVertex(t,o,l,p,m,_=!1){const T=o.y*p-o.x,C=-o.y-o.x*p;this.addHalfVertex(t,o.x+o.y*l,o.y-o.x*l,_,!1,l,m),this.addHalfVertex(t,T,C,_,!0,-p,m),this.distance>Gh/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,o,l,p,m,_))}addHalfVertex({x:t,y:o},l,p,m,_,T,C){const k=.5*(this.lineClips?this.scaledDistance*(Gh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(m?1:0),(o<<1)+(_?1:0),Math.round(63*l)+128,Math.round(63*p)+128,1+(T===0?0:T<0?-1:1)|(63&k)<<2,k>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const R=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,R),C.primitiveLength++),_?this.e2=R:this.e1=R}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,o){this.distance+=t.dist(o),this.updateScaledDistance()}}kt("LineBucket",ph,{omit:["layers","patternFeatures"]});const Zh=new mr({"line-cap":new Vt(ot.layout_line["line-cap"]),"line-join":new wt(ot.layout_line["line-join"]),"line-miter-limit":new Vt(ot.layout_line["line-miter-limit"]),"line-round-limit":new Vt(ot.layout_line["line-round-limit"]),"line-sort-key":new wt(ot.layout_line["line-sort-key"])});var $h={paint:new mr({"line-opacity":new wt(ot.paint_line["line-opacity"]),"line-color":new wt(ot.paint_line["line-color"]),"line-translate":new Vt(ot.paint_line["line-translate"]),"line-translate-anchor":new Vt(ot.paint_line["line-translate-anchor"]),"line-width":new wt(ot.paint_line["line-width"]),"line-gap-width":new wt(ot.paint_line["line-gap-width"]),"line-offset":new wt(ot.paint_line["line-offset"]),"line-blur":new wt(ot.paint_line["line-blur"]),"line-dasharray":new An(ot.paint_line["line-dasharray"]),"line-pattern":new Hn(ot.paint_line["line-pattern"]),"line-gradient":new Nr(ot.paint_line["line-gradient"])}),layout:Zh};const Xh=new class extends wt{possiblyEvaluate(i,t){return t=new or(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),super.possiblyEvaluate(i,t)}evaluate(i,t,o,l){return t=yt({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(i,t,o,l)}}($h.paint.properties["line-width"].specification);function zu(i,t){return t>0?t+2*i:i}Xh.useIntegerZoom=!0;const Wh=Tt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Hh=Tt([{name:"a_projected_pos",components:3,type:"Float32"}],4);Tt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Ac=Tt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Tt([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ar=Tt([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Kh=Tt([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Ws(i,t,o){return i.sections.forEach(l=>{l.text=function(p,m,_){const T=m.layout.get("text-transform").evaluate(_,{});return T==="uppercase"?p=p.toLocaleUpperCase():T==="lowercase"&&(p=p.toLocaleLowerCase()),fr.applyArabicShaping&&(p=fr.applyArabicShaping(p)),p}(l.text,t,o)}),i}Tt([{name:"triangle",components:3,type:"Uint16"}]),Tt([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Tt([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Tt([{type:"Float32",name:"offsetX"}]),Tt([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const vs={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var zn=24,dh=hr,Jh=function(i,t,o,l,p){var m,_,T=8*p-l-1,C=(1<<T)-1,k=C>>1,R=-7,D=o?p-1:0,V=o?-1:1,G=i[t+D];for(D+=V,m=G&(1<<-R)-1,G>>=-R,R+=T;R>0;m=256*m+i[t+D],D+=V,R-=8);for(_=m&(1<<-R)-1,m>>=-R,R+=l;R>0;_=256*_+i[t+D],D+=V,R-=8);if(m===0)m=1-k;else{if(m===C)return _?NaN:1/0*(G?-1:1);_+=Math.pow(2,l),m-=k}return(G?-1:1)*_*Math.pow(2,m-l)},Yh=function(i,t,o,l,p,m){var _,T,C,k=8*m-p-1,R=(1<<k)-1,D=R>>1,V=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,G=l?0:m-1,Z=l?1:-1,ee=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(T=isNaN(t)?1:0,_=R):(_=Math.floor(Math.log(t)/Math.LN2),t*(C=Math.pow(2,-_))<1&&(_--,C*=2),(t+=_+D>=1?V/C:V*Math.pow(2,1-D))*C>=2&&(_++,C/=2),_+D>=R?(T=0,_=R):_+D>=1?(T=(t*C-1)*Math.pow(2,p),_+=D):(T=t*Math.pow(2,D-1)*Math.pow(2,p),_=0));p>=8;i[o+G]=255&T,G+=Z,T/=256,p-=8);for(_=_<<p|T,k+=p;k>0;i[o+G]=255&_,G+=Z,_/=256,k-=8);i[o+G-Z]|=128*ee};function hr(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}hr.Varint=0,hr.Fixed64=1,hr.Bytes=2,hr.Fixed32=5;var El,fh=4294967296,Qh=1/fh,ep=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Hs(i){return i.type===hr.Bytes?i.readVarint()+i.pos:i.pos+1}function Ks(i,t,o){return o?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function Ql(i,t,o){var l=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));o.realloc(l);for(var p=o.pos-1;p>=i;p--)o.buf[p+l]=o.buf[p]}function tp(i,t){for(var o=0;o<i.length;o++)t.writeVarint(i[o])}function od(i,t){for(var o=0;o<i.length;o++)t.writeSVarint(i[o])}function ad(i,t){for(var o=0;o<i.length;o++)t.writeFloat(i[o])}function sd(i,t){for(var o=0;o<i.length;o++)t.writeDouble(i[o])}function ip(i,t){for(var o=0;o<i.length;o++)t.writeBoolean(i[o])}function Cc(i,t){for(var o=0;o<i.length;o++)t.writeFixed32(i[o])}function Qu(i,t){for(var o=0;o<i.length;o++)t.writeSFixed32(i[o])}function ec(i,t){for(var o=0;o<i.length;o++)t.writeFixed64(i[o])}function Jo(i,t){for(var o=0;o<i.length;o++)t.writeSFixed64(i[o])}function Js(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function Jr(i,t,o){i[o]=t,i[o+1]=t>>>8,i[o+2]=t>>>16,i[o+3]=t>>>24}function tc(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}function zc(i,t,o){i===1&&o.readMessage(Do,t)}function Do(i,t,o){if(i===3){const{id:l,bitmap:p,width:m,height:_,left:T,top:C,advance:k}=o.readMessage(rp,{});t.push({id:l,bitmap:new Zu({width:m+6,height:_+6},p),metrics:{width:m,height:_,left:T,top:C,advance:k}})}}function rp(i,t,o){i===1?t.id=o.readVarint():i===2?t.bitmap=o.readBytes():i===3?t.width=o.readVarint():i===4?t.height=o.readVarint():i===5?t.left=o.readSVarint():i===6?t.top=o.readSVarint():i===7&&(t.advance=o.readVarint())}function mh(i){let t=0,o=0;for(const _ of i)t+=_.w*_.h,o=Math.max(o,_.w);i.sort((_,T)=>T.h-_.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),o),h:1/0}];let p=0,m=0;for(const _ of i)for(let T=l.length-1;T>=0;T--){const C=l[T];if(!(_.w>C.w||_.h>C.h)){if(_.x=C.x,_.y=C.y,m=Math.max(m,_.y+_.h),p=Math.max(p,_.x+_.w),_.w===C.w&&_.h===C.h){const k=l.pop();T<l.length&&(l[T]=k)}else _.h===C.h?(C.x+=_.w,C.w-=_.w):_.w===C.w?(C.y+=_.h,C.h-=_.h):(l.push({x:C.x+_.w,y:C.y,w:C.w-_.w,h:_.h}),C.y+=_.h,C.h-=_.h);break}}return{w:p,h:m,fill:t/(p*m)||0}}hr.prototype={destroy:function(){this.buf=null},readFields:function(i,t,o){for(o=o||this.length;this.pos<o;){var l=this.readVarint(),p=l>>3,m=this.pos;this.type=7&l,i(p,t,this),this.pos===m&&this.skip(l)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=Js(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=tc(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Js(this.buf,this.pos)+Js(this.buf,this.pos+4)*fh;return this.pos+=8,i},readSFixed64:function(){var i=Js(this.buf,this.pos)+tc(this.buf,this.pos+4)*fh;return this.pos+=8,i},readFloat:function(){var i=Jh(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Jh(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,o,l=this.buf;return t=127&(o=l[this.pos++]),o<128?t:(t|=(127&(o=l[this.pos++]))<<7,o<128?t:(t|=(127&(o=l[this.pos++]))<<14,o<128?t:(t|=(127&(o=l[this.pos++]))<<21,o<128?t:function(p,m,_){var T,C,k=_.buf;if(T=(112&(C=k[_.pos++]))>>4,C<128||(T|=(127&(C=k[_.pos++]))<<3,C<128)||(T|=(127&(C=k[_.pos++]))<<10,C<128)||(T|=(127&(C=k[_.pos++]))<<17,C<128)||(T|=(127&(C=k[_.pos++]))<<24,C<128)||(T|=(1&(C=k[_.pos++]))<<31,C<128))return Ks(p,T,m);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(o=l[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&ep?function(o,l,p){return ep.decode(o.subarray(l,p))}(this.buf,t,i):function(o,l,p){for(var m="",_=l;_<p;){var T,C,k,R=o[_],D=null,V=R>239?4:R>223?3:R>191?2:1;if(_+V>p)break;V===1?R<128&&(D=R):V===2?(192&(T=o[_+1]))==128&&(D=(31&R)<<6|63&T)<=127&&(D=null):V===3?(C=o[_+2],(192&(T=o[_+1]))==128&&(192&C)==128&&((D=(15&R)<<12|(63&T)<<6|63&C)<=2047||D>=55296&&D<=57343)&&(D=null)):V===4&&(C=o[_+2],k=o[_+3],(192&(T=o[_+1]))==128&&(192&C)==128&&(192&k)==128&&((D=(15&R)<<18|(63&T)<<12|(63&C)<<6|63&k)<=65535||D>=1114112)&&(D=null)),D===null?(D=65533,V=1):D>65535&&(D-=65536,m+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),m+=String.fromCharCode(D),_+=V}return m}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==hr.Bytes)return i.push(this.readVarint(t));var o=Hs(this);for(i=i||[];this.pos<o;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==hr.Bytes)return i.push(this.readSVarint());var t=Hs(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==hr.Bytes)return i.push(this.readBoolean());var t=Hs(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==hr.Bytes)return i.push(this.readFloat());var t=Hs(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==hr.Bytes)return i.push(this.readDouble());var t=Hs(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==hr.Bytes)return i.push(this.readFixed32());var t=Hs(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==hr.Bytes)return i.push(this.readSFixed32());var t=Hs(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==hr.Bytes)return i.push(this.readFixed64());var t=Hs(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==hr.Bytes)return i.push(this.readSFixed64());var t=Hs(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===hr.Varint)for(;this.buf[this.pos++]>127;);else if(t===hr.Bytes)this.pos=this.readVarint()+this.pos;else if(t===hr.Fixed32)this.pos+=4;else{if(t!==hr.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var o=new Uint8Array(t);o.set(this.buf),this.buf=o,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Jr(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Jr(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Jr(this.buf,-1&i,this.pos),Jr(this.buf,Math.floor(i*Qh),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Jr(this.buf,-1&i,this.pos),Jr(this.buf,Math.floor(i*Qh),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,o){var l,p;if(t>=0?(l=t%4294967296|0,p=t/4294967296|0):(p=~(-t/4294967296),4294967295^(l=~(-t%4294967296))?l=l+1|0:(l=0,p=p+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),function(m,_,T){T.buf[T.pos++]=127&m|128,m>>>=7,T.buf[T.pos++]=127&m|128,m>>>=7,T.buf[T.pos++]=127&m|128,m>>>=7,T.buf[T.pos++]=127&m|128,T.buf[T.pos]=127&(m>>>=7)}(l,0,o),function(m,_){var T=(7&m)<<4;_.buf[_.pos++]|=T|((m>>>=3)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m)))))}(p,o)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(l,p,m){for(var _,T,C=0;C<p.length;C++){if((_=p.charCodeAt(C))>55295&&_<57344){if(!T){_>56319||C+1===p.length?(l[m++]=239,l[m++]=191,l[m++]=189):T=_;continue}if(_<56320){l[m++]=239,l[m++]=191,l[m++]=189,T=_;continue}_=T-55296<<10|_-56320|65536,T=null}else T&&(l[m++]=239,l[m++]=191,l[m++]=189,T=null);_<128?l[m++]=_:(_<2048?l[m++]=_>>6|192:(_<65536?l[m++]=_>>12|224:(l[m++]=_>>18|240,l[m++]=_>>12&63|128),l[m++]=_>>6&63|128),l[m++]=63&_|128)}return m}(this.buf,i,this.pos);var o=this.pos-t;o>=128&&Ql(t,o,this),this.pos=t-1,this.writeVarint(o),this.pos+=o},writeFloat:function(i){this.realloc(4),Yh(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Yh(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var o=0;o<t;o++)this.buf[this.pos++]=i[o]},writeRawMessage:function(i,t){this.pos++;var o=this.pos;i(t,this);var l=this.pos-o;l>=128&&Ql(o,l,this),this.pos=o-1,this.writeVarint(l),this.pos+=l},writeMessage:function(i,t,o){this.writeTag(i,hr.Bytes),this.writeRawMessage(t,o)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,tp,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,od,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,ip,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,ad,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,sd,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,Cc,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,Qu,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,ec,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,Jo,t)},writeBytesField:function(i,t){this.writeTag(i,hr.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,hr.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,hr.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,hr.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,hr.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,hr.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,hr.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,hr.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,hr.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,hr.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,Boolean(t))}};class yh{constructor(t,{pixelRatio:o,version:l,stretchX:p,stretchY:m,content:_}){this.paddedRect=t,this.pixelRatio=o,this.stretchX=p,this.stretchY=m,this.content=_,this.version=l}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class gh{constructor(t,o){const l={},p={};this.haveRenderCallbacks=[];const m=[];this.addImages(t,l,m),this.addImages(o,p,m);const{w:_,h:T}=mh(m),C=new _a({width:_||1,height:T||1});for(const k in t){const R=t[k],D=l[k].paddedRect;_a.copy(R.data,C,{x:0,y:0},{x:D.x+1,y:D.y+1},R.data)}for(const k in o){const R=o[k],D=p[k].paddedRect,V=D.x+1,G=D.y+1,Z=R.data.width,ee=R.data.height;_a.copy(R.data,C,{x:0,y:0},{x:V,y:G},R.data),_a.copy(R.data,C,{x:0,y:ee-1},{x:V,y:G-1},{width:Z,height:1}),_a.copy(R.data,C,{x:0,y:0},{x:V,y:G+ee},{width:Z,height:1}),_a.copy(R.data,C,{x:Z-1,y:0},{x:V-1,y:G},{width:1,height:ee}),_a.copy(R.data,C,{x:0,y:0},{x:V+Z,y:G},{width:1,height:ee})}this.image=C,this.iconPositions=l,this.patternPositions=p}addImages(t,o,l){for(const p in t){const m=t[p],_={x:0,y:0,w:m.data.width+2,h:m.data.height+2};l.push(_),o[p]=new yh(_,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(t,o){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in t.updatedImages)this.patchUpdatedImage(this.iconPositions[l],t.getImage(l),o),this.patchUpdatedImage(this.patternPositions[l],t.getImage(l),o)}patchUpdatedImage(t,o,l){if(!t||!o||t.version===o.version)return;t.version=o.version;const[p,m]=t.tl;l.update(o.data,void 0,{x:p,y:m})}}kt("ImagePosition",yh),kt("ImageAtlas",gh),x.WritingMode=void 0,(El=x.WritingMode||(x.WritingMode={}))[El.none=0]="none",El[El.horizontal=1]="horizontal",El[El.vertical=2]="vertical",El[El.horizontalOnly=3]="horizontalOnly";const Pu=-17;class eu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,o){const l=new eu;return l.scale=t||1,l.fontStack=o,l}static forImage(t){const o=new eu;return o.imageName=t,o}}class ku{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,o){const l=new ku;for(let p=0;p<t.sections.length;p++){const m=t.sections[p];m.image?l.addImageSection(m):l.addTextSection(m,o)}return l}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let o="";for(let l=0;l<t.length;l++){const p=t.charCodeAt(l+1)||null,m=t.charCodeAt(l-1)||null;o+=p&&ms(p)&&!vs[t[l+1]]||m&&ms(m)&&!vs[t[l-1]]||!vs[t[l]]?t[l]:vs[t[l]]}return o}(this.text)}trim(){let t=0;for(let l=0;l<this.text.length&&Ys[this.text.charCodeAt(l)];l++)t++;let o=this.text.length;for(let l=this.text.length-1;l>=0&&l>=t&&Ys[this.text.charCodeAt(l)];l--)o--;this.text=this.text.substring(t,o),this.sectionIndex=this.sectionIndex.slice(t,o)}substring(t,o){const l=new ku;return l.text=this.text.substring(t,o),l.sectionIndex=this.sectionIndex.slice(t,o),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,o)=>Math.max(t,this.sections[o].scale),0)}addTextSection(t,o){this.text+=t.text,this.sections.push(eu.forText(t.scale,t.fontStack||o));const l=this.sections.length-1;for(let p=0;p<t.text.length;++p)this.sectionIndex.push(l)}addImageSection(t){const o=t.image?t.image.name:"";if(o.length===0)return void pi("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(eu.forImage(o)),this.sectionIndex.push(this.sections.length-1)):pi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ic(i,t,o,l,p,m,_,T,C,k,R,D,V,G,Z,ee){const ae=ku.fromFeature(i,p);let we;D===x.WritingMode.vertical&&ae.verticalizePunctuation();const{processBidirectionalText:ke,processStyledBidirectionalText:Re}=fr;if(ke&&ae.sections.length===1){we=[];const Oe=ke(ae.toString(),Pc(ae,k,m,t,l,G,Z));for(const dt of Oe){const ht=new ku;ht.text=dt,ht.sections=ae.sections;for(let Ye=0;Ye<dt.length;Ye++)ht.sectionIndex.push(0);we.push(ht)}}else if(Re){we=[];const Oe=Re(ae.text,ae.sectionIndex,Pc(ae,k,m,t,l,G,Z));for(const dt of Oe){const ht=new ku;ht.text=dt[0],ht.sectionIndex=dt[1],ht.sections=ae.sections,we.push(ht)}}else we=function(Oe,dt){const ht=[],Ye=Oe.text;let ct=0;for(const nt of dt)ht.push(Oe.substring(ct,nt)),ct=nt;return ct<Ye.length&&ht.push(Oe.substring(ct,Ye.length)),ht}(ae,Pc(ae,k,m,t,l,G,Z));const Be=[],$e={positionedLines:Be,text:ae.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:D,iconsInText:!1,verticalizable:!1};return function(Oe,dt,ht,Ye,ct,nt,ft,tt,at,Bt,Dt,Qt){let ri=0,vi=Pu,Ci=0,Ui=0;const Vi=tt==="right"?1:tt==="left"?0:.5;let Mi=0;for(const fi of ct){fi.trim();const xi=fi.getMaxScale(),hi=(xi-1)*zn,sr={positionedGlyphs:[],lineOffset:0};Oe.positionedLines[Mi]=sr;const ir=sr.positionedGlyphs;let ki=0;if(!fi.length()){vi+=nt,++Mi;continue}for(let qi=0;qi<fi.length();qi++){const jt=fi.getSection(qi),Qr=fi.getSectionIndex(qi),pr=fi.getCharCode(qi);let kr=0,Hi=null,Pn=null,cn=null,Yo=zn;const to=!(at===x.WritingMode.horizontal||!Dt&&!dr(pr)||Dt&&(Ys[pr]||(Gi=pr,Ot.Arabic(Gi)||Ot["Arabic Supplement"](Gi)||Ot["Arabic Extended-A"](Gi)||Ot["Arabic Presentation Forms-A"](Gi)||Ot["Arabic Presentation Forms-B"](Gi))));if(jt.imageName){const io=Ye[jt.imageName];if(!io)continue;cn=jt.imageName,Oe.iconsInText=Oe.iconsInText||!0,Pn=io.paddedRect;const en=io.displaySize;jt.scale=jt.scale*zn/Qt,Hi={width:en[0],height:en[1],left:1,top:-3,advance:to?en[1]:en[0]},kr=hi+(zn-en[1]*jt.scale),Yo=Hi.advance;const Qo=to?en[0]*jt.scale-zn*xi:en[1]*jt.scale-zn*xi;Qo>0&&Qo>ki&&(ki=Qo)}else{const io=ht[jt.fontStack],en=io&&io[pr];if(en&&en.rect)Pn=en.rect,Hi=en.metrics;else{const Qo=dt[jt.fontStack],Pl=Qo&&Qo[pr];if(!Pl)continue;Hi=Pl.metrics}kr=(xi-jt.scale)*zn}to?(Oe.verticalizable=!0,ir.push({glyph:pr,imageName:cn,x:ri,y:vi+kr,vertical:to,scale:jt.scale,fontStack:jt.fontStack,sectionIndex:Qr,metrics:Hi,rect:Pn}),ri+=Yo*jt.scale+Bt):(ir.push({glyph:pr,imageName:cn,x:ri,y:vi+kr,vertical:to,scale:jt.scale,fontStack:jt.fontStack,sectionIndex:Qr,metrics:Hi,rect:Pn}),ri+=Hi.advance*jt.scale+Bt)}ir.length!==0&&(Ci=Math.max(ri-Bt,Ci),ud(ir,0,ir.length-1,Vi,ki)),ri=0;const Ii=nt*xi+ki;sr.lineOffset=Math.max(ki,hi),vi+=Ii,Ui=Math.max(Ii,Ui),++Mi}var Gi;const Li=vi-Pu,{horizontalAlign:Zi,verticalAlign:si}=kc(ft);(function(fi,xi,hi,sr,ir,ki,Ii,qi,jt){const Qr=(xi-hi)*ir;let pr=0;pr=ki!==Ii?-qi*sr-Pu:(-sr*jt+.5)*Ii;for(const kr of fi)for(const Hi of kr.positionedGlyphs)Hi.x+=Qr,Hi.y+=pr})(Oe.positionedLines,Vi,Zi,si,Ci,Ui,nt,Li,ct.length),Oe.top+=-si*Li,Oe.bottom=Oe.top+Li,Oe.left+=-Zi*Ci,Oe.right=Oe.left+Ci}($e,t,o,l,we,_,T,C,D,k,V,ee),!function(Oe){for(const dt of Oe)if(dt.positionedGlyphs.length!==0)return!1;return!0}(Be)&&$e}const Ys={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},_h={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function vh(i,t,o,l,p,m){if(t.imageName){const _=l[t.imageName];return _?_.displaySize[0]*t.scale*zn/m+p:0}{const _=o[t.fontStack],T=_&&_[i];return T?T.metrics.advance*t.scale+p:0}}function xh(i,t,o,l){const p=Math.pow(i-t,2);return l?i<t?p/2:2*p:p+Math.abs(o)*o}function ld(i,t,o){let l=0;return i===10&&(l-=1e4),o&&(l+=150),i!==40&&i!==65288||(l+=50),t!==41&&t!==65289||(l+=50),l}function bh(i,t,o,l,p,m){let _=null,T=xh(t,o,p,m);for(const C of l){const k=xh(t-C.x,o,p,m)+C.badness;k<=T&&(_=C,T=k)}return{index:i,x:t,priorBreak:_,badness:T}}function wh(i){return i?wh(i.priorBreak).concat(i.index):[]}function Pc(i,t,o,l,p,m,_){if(m!=="point")return[];if(!i)return[];const T=[],C=function(V,G,Z,ee,ae,we){let ke=0;for(let Re=0;Re<V.length();Re++){const Be=V.getSection(Re);ke+=vh(V.getCharCode(Re),Be,ee,ae,G,we)}return ke/Math.max(1,Math.ceil(ke/Z))}(i,t,o,l,p,_),k=i.text.indexOf("\u200B")>=0;let R=0;for(let V=0;V<i.length();V++){const G=i.getSection(V),Z=i.getCharCode(V);if(Ys[Z]||(R+=vh(Z,G,l,p,t,_)),V<i.length()-1){const ee=!((D=Z)<11904||!(Ot["Bopomofo Extended"](D)||Ot.Bopomofo(D)||Ot["CJK Compatibility Forms"](D)||Ot["CJK Compatibility Ideographs"](D)||Ot["CJK Compatibility"](D)||Ot["CJK Radicals Supplement"](D)||Ot["CJK Strokes"](D)||Ot["CJK Symbols and Punctuation"](D)||Ot["CJK Unified Ideographs Extension A"](D)||Ot["CJK Unified Ideographs"](D)||Ot["Enclosed CJK Letters and Months"](D)||Ot["Halfwidth and Fullwidth Forms"](D)||Ot.Hiragana(D)||Ot["Ideographic Description Characters"](D)||Ot["Kangxi Radicals"](D)||Ot["Katakana Phonetic Extensions"](D)||Ot.Katakana(D)||Ot["Vertical Forms"](D)||Ot["Yi Radicals"](D)||Ot["Yi Syllables"](D)));(_h[Z]||ee||G.imageName)&&T.push(bh(V+1,R,C,T,ld(Z,i.getCharCode(V+1),ee&&k),!1))}}var D;return wh(bh(i.length(),R,C,T,0,!0))}function kc(i){let t=.5,o=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:t,verticalAlign:o}}function ud(i,t,o,l,p){if(!l&&!p)return;const m=i[o],_=(i[o].x+m.metrics.advance*m.scale)*l;for(let T=t;T<=o;T++)i[T].x-=_,i[T].y+=p}function cd(i,t,o){const{horizontalAlign:l,verticalAlign:p}=kc(o),m=t[0]-i.displaySize[0]*l,_=t[1]-i.displaySize[1]*p;return{image:i,top:_,bottom:_+i.displaySize[1],left:m,right:m+i.displaySize[0]}}function Eh(i,t,o,l,p,m){const _=i.image;let T;if(_.content){const ae=_.content,we=_.pixelRatio||1;T=[ae[0]/we,ae[1]/we,_.displaySize[0]-ae[2]/we,_.displaySize[1]-ae[3]/we]}const C=t.left*m,k=t.right*m;let R,D,V,G;o==="width"||o==="both"?(G=p[0]+C-l[3],D=p[0]+k+l[1]):(G=p[0]+(C+k-_.displaySize[0])/2,D=G+_.displaySize[0]);const Z=t.top*m,ee=t.bottom*m;return o==="height"||o==="both"?(R=p[1]+Z-l[0],V=p[1]+ee+l[2]):(R=p[1]+(Z+ee-_.displaySize[1])/2,V=R+_.displaySize[1]),{image:_,top:R,right:D,bottom:V,left:G,collisionPadding:T}}const xs=128;function rc(i,t){const{expression:o}=t;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new or(i+1))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:p}=o;let m=0;for(;m<l.length&&l[m]<=i;)m++;m=Math.max(0,m-1);let _=m;for(;_<l.length&&l[_]<i+1;)_++;_=Math.min(l.length-1,_);const T=l[m],C=l[_];return o.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:C,interpolationType:p}:{kind:"camera",minZoom:T,maxZoom:C,minSize:o.evaluate(new or(T)),maxSize:o.evaluate(new or(C)),interpolationType:p}}}class Qs extends Yt{constructor(t,o,l,p){super(t,o),this.angle=l,p!==void 0&&(this.segment=p)}clone(){return new Qs(this.x,this.y,this.angle,this.segment)}}function nc(i,t,o,l,p){if(t.segment===void 0)return!0;let m=t,_=t.segment+1,T=0;for(;T>-o/2;){if(_--,_<0)return!1;T-=i[_].dist(m),m=i[_]}T+=i[_].dist(i[_+1]),_++;const C=[];let k=0;for(;T<o/2;){const R=i[_],D=i[_+1];if(!D)return!1;let V=i[_-1].angleTo(R)-R.angleTo(D);for(V=Math.abs((V+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:T,angleDelta:V}),k+=V;T-C[0].distance>l;)k-=C.shift().angleDelta;if(k>p)return!1;_++,T+=R.dist(D)}return!0}function oc(i){let t=0;for(let o=0;o<i.length-1;o++)t+=i[o].dist(i[o+1]);return t}function ac(i,t,o){return i?.6*t*o:0}function tu(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function hd(i,t,o,l,p,m){const _=ac(o,p,m),T=tu(o,l)*m;let C=0;const k=oc(i)/2;for(let R=0;R<i.length-1;R++){const D=i[R],V=i[R+1],G=D.dist(V);if(C+G>k){const Z=(k-C)/G,ee=Vr(D.x,V.x,Z),ae=Vr(D.y,V.y,Z),we=new Qs(ee,ae,V.angleTo(D),R);return we._round(),!_||nc(i,we,T,_,t)?we:void 0}C+=G}}function pd(i,t,o,l,p,m,_,T,C){const k=ac(l,m,_),R=tu(l,p),D=R*_,V=i[0].x===0||i[0].x===C||i[0].y===0||i[0].y===C;return t-D<t/4&&(t=D+t/4),np(i,V?t/2*T%t:(R/2+2*m)*_*T%t,t,k,o,D,V,!1,C)}function np(i,t,o,l,p,m,_,T,C){const k=m/2,R=oc(i);let D=0,V=t-o,G=[];for(let Z=0;Z<i.length-1;Z++){const ee=i[Z],ae=i[Z+1],we=ee.dist(ae),ke=ae.angleTo(ee);for(;V+o<D+we;){V+=o;const Re=(V-D)/we,Be=Vr(ee.x,ae.x,Re),$e=Vr(ee.y,ae.y,Re);if(Be>=0&&Be<C&&$e>=0&&$e<C&&V-k>=0&&V+k<=R){const Oe=new Qs(Be,$e,ke,Z);Oe._round(),l&&!nc(i,Oe,m,l,p)||G.push(Oe)}}D+=we}return T||G.length||_||(G=np(i,D/2,o,l,p,m,_,!0,C)),G}function iu(i,t,o,l,p){const m=[];for(let _=0;_<i.length;_++){const T=i[_];let C;for(let k=0;k<T.length-1;k++){let R=T[k],D=T[k+1];R.x<t&&D.x<t||(R.x<t?R=new Yt(t,R.y+(t-R.x)/(D.x-R.x)*(D.y-R.y))._round():D.x<t&&(D=new Yt(t,R.y+(t-R.x)/(D.x-R.x)*(D.y-R.y))._round()),R.y<o&&D.y<o||(R.y<o?R=new Yt(R.x+(o-R.y)/(D.y-R.y)*(D.x-R.x),o)._round():D.y<o&&(D=new Yt(R.x+(o-R.y)/(D.y-R.y)*(D.x-R.x),o)._round()),R.x>=l&&D.x>=l||(R.x>=l?R=new Yt(l,R.y+(l-R.x)/(D.x-R.x)*(D.y-R.y))._round():D.x>=l&&(D=new Yt(l,R.y+(l-R.x)/(D.x-R.x)*(D.y-R.y))._round()),R.y>=p&&D.y>=p||(R.y>=p?R=new Yt(R.x+(p-R.y)/(D.y-R.y)*(D.x-R.x),p)._round():D.y>=p&&(D=new Yt(R.x+(p-R.y)/(D.y-R.y)*(D.x-R.x),p)._round()),C&&R.equals(C[C.length-1])||(C=[R],m.push(C)),C.push(D)))))}}return m}function Mc(i,t,o,l){const p=[],m=i.image,_=m.pixelRatio,T=m.paddedRect.w-2,C=m.paddedRect.h-2,k=i.right-i.left,R=i.bottom-i.top,D=m.stretchX||[[0,T]],V=m.stretchY||[[0,C]],G=(nt,ft)=>nt+ft[1]-ft[0],Z=D.reduce(G,0),ee=V.reduce(G,0),ae=T-Z,we=C-ee;let ke=0,Re=Z,Be=0,$e=ee,Oe=0,dt=ae,ht=0,Ye=we;if(m.content&&l){const nt=m.content;ke=sc(D,0,nt[0]),Be=sc(V,0,nt[1]),Re=sc(D,nt[0],nt[2]),$e=sc(V,nt[1],nt[3]),Oe=nt[0]-ke,ht=nt[1]-Be,dt=nt[2]-nt[0]-Re,Ye=nt[3]-nt[1]-$e}const ct=(nt,ft,tt,at)=>{const Bt=lc(nt.stretch-ke,Re,k,i.left),Dt=uc(nt.fixed-Oe,dt,nt.stretch,Z),Qt=lc(ft.stretch-Be,$e,R,i.top),ri=uc(ft.fixed-ht,Ye,ft.stretch,ee),vi=lc(tt.stretch-ke,Re,k,i.left),Ci=uc(tt.fixed-Oe,dt,tt.stretch,Z),Ui=lc(at.stretch-Be,$e,R,i.top),Vi=uc(at.fixed-ht,Ye,at.stretch,ee),Mi=new Yt(Bt,Qt),Gi=new Yt(vi,Qt),Li=new Yt(vi,Ui),Zi=new Yt(Bt,Ui),si=new Yt(Dt/_,ri/_),fi=new Yt(Ci/_,Vi/_),xi=t*Math.PI/180;if(xi){const ir=Math.sin(xi),ki=Math.cos(xi),Ii=[ki,-ir,ir,ki];Mi._matMult(Ii),Gi._matMult(Ii),Zi._matMult(Ii),Li._matMult(Ii)}const hi=nt.stretch+nt.fixed,sr=ft.stretch+ft.fixed;return{tl:Mi,tr:Gi,bl:Zi,br:Li,tex:{x:m.paddedRect.x+1+hi,y:m.paddedRect.y+1+sr,w:tt.stretch+tt.fixed-hi,h:at.stretch+at.fixed-sr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:si,pixelOffsetBR:fi,minFontScaleX:dt/_/k,minFontScaleY:Ye/_/R,isSDF:o}};if(l&&(m.stretchX||m.stretchY)){const nt=Lc(D,ae,Z),ft=Lc(V,we,ee);for(let tt=0;tt<nt.length-1;tt++){const at=nt[tt],Bt=nt[tt+1];for(let Dt=0;Dt<ft.length-1;Dt++)p.push(ct(at,ft[Dt],Bt,ft[Dt+1]))}}else p.push(ct({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:C+1}));return p}function sc(i,t,o){let l=0;for(const p of i)l+=Math.max(t,Math.min(o,p[1]))-Math.max(t,Math.min(o,p[0]));return l}function Lc(i,t,o){const l=[{fixed:-1,stretch:0}];for(const[p,m]of i){const _=l[l.length-1];l.push({fixed:p-_.stretch,stretch:_.stretch}),l.push({fixed:p-_.stretch,stretch:_.stretch+(m-p)})}return l.push({fixed:t+1,stretch:o}),l}function lc(i,t,o,l){return i/t*o+l}function uc(i,t,o,l){return i-t*o/l}kt("Anchor",Qs);class Dc{constructor(t,o,l,p,m,_,T,C,k,R){if(this.boxStartIndex=t.length,k){let D=_.top,V=_.bottom;const G=_.collisionPadding;G&&(D-=G[1],V+=G[3]);let Z=V-D;Z>0&&(Z=Math.max(10,Z),this.circleDiameter=Z)}else{let D=_.top*T-C,V=_.bottom*T+C,G=_.left*T-C,Z=_.right*T+C;const ee=_.collisionPadding;if(ee&&(G-=ee[0]*T,D-=ee[1]*T,Z+=ee[2]*T,V+=ee[3]*T),R){const ae=new Yt(G,D),we=new Yt(Z,D),ke=new Yt(G,V),Re=new Yt(Z,V),Be=R*Math.PI/180;ae._rotate(Be),we._rotate(Be),ke._rotate(Be),Re._rotate(Be),G=Math.min(ae.x,we.x,ke.x,Re.x),Z=Math.max(ae.x,we.x,ke.x,Re.x),D=Math.min(ae.y,we.y,ke.y,Re.y),V=Math.max(ae.y,we.y,ke.y,Re.y)}t.emplaceBack(o.x,o.y,G,D,Z,V,l,p,m)}this.boxEndIndex=t.length}}class dd{constructor(t=[],o=fd){if(this.data=t,this.length=this.data.length,this.compare=o,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:o,compare:l}=this,p=o[t];for(;t>0;){const m=t-1>>1,_=o[m];if(l(p,_)>=0)break;o[t]=_,t=m}o[t]=p}_down(t){const{data:o,compare:l}=this,p=this.length>>1,m=o[t];for(;t<p;){let _=1+(t<<1),T=o[_];const C=_+1;if(C<this.length&&l(o[C],T)<0&&(_=C,T=o[C]),l(T,m)>=0)break;o[t]=T,t=_}o[t]=m}}function fd(i,t){return i<t?-1:i>t?1:0}function Rc(i,t=1,o=!1){let l=1/0,p=1/0,m=-1/0,_=-1/0;const T=i[0];for(let G=0;G<T.length;G++){const Z=T[G];(!G||Z.x<l)&&(l=Z.x),(!G||Z.y<p)&&(p=Z.y),(!G||Z.x>m)&&(m=Z.x),(!G||Z.y>_)&&(_=Z.y)}const C=Math.min(m-l,_-p);let k=C/2;const R=new dd([],Sh);if(C===0)return new Yt(l,p);for(let G=l;G<m;G+=C)for(let Z=p;Z<_;Z+=C)R.push(new Mu(G+k,Z+k,k,i));let D=function(G){let Z=0,ee=0,ae=0;const we=G[0];for(let ke=0,Re=we.length,Be=Re-1;ke<Re;Be=ke++){const $e=we[ke],Oe=we[Be],dt=$e.x*Oe.y-Oe.x*$e.y;ee+=($e.x+Oe.x)*dt,ae+=($e.y+Oe.y)*dt,Z+=3*dt}return new Mu(ee/Z,ae/Z,0,G)}(i),V=R.length;for(;R.length;){const G=R.pop();(G.d>D.d||!D.d)&&(D=G,o&&console.log("found best %d after %d probes",Math.round(1e4*G.d)/1e4,V)),G.max-D.d<=t||(k=G.h/2,R.push(new Mu(G.p.x-k,G.p.y-k,k,i)),R.push(new Mu(G.p.x+k,G.p.y-k,k,i)),R.push(new Mu(G.p.x-k,G.p.y+k,k,i)),R.push(new Mu(G.p.x+k,G.p.y+k,k,i)),V+=4)}return o&&(console.log(`num probes: ${V}`),console.log(`best distance: ${D.d}`)),D.p}function Sh(i,t){return t.max-i.max}function Mu(i,t,o,l){this.p=new Yt(i,t),this.h=o,this.d=function(p,m){let _=!1,T=1/0;for(let C=0;C<m.length;C++){const k=m[C];for(let R=0,D=k.length,V=D-1;R<D;V=R++){const G=k[R],Z=k[V];G.y>p.y!=Z.y>p.y&&p.x<(Z.x-G.x)*(p.y-G.y)/(Z.y-G.y)+G.x&&(_=!_),T=Math.min(T,ya(p,G,Z))}}return(_?1:-1)*Math.sqrt(T)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}const Sl=Number.POSITIVE_INFINITY;function Lu(i,t){return t[1]!==Sl?function(o,l,p){let m=0,_=0;switch(l=Math.abs(l),p=Math.abs(p),o){case"top-right":case"top-left":case"top":_=p-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-p}switch(o){case"top-right":case"bottom-right":case"right":m=-l;break;case"top-left":case"bottom-left":case"left":m=l}return[m,_]}(i,t[0],t[1]):function(o,l){let p=0,m=0;l<0&&(l=0);const _=l/Math.sqrt(2);switch(o){case"top-right":case"top-left":m=_-7;break;case"bottom-right":case"bottom-left":m=7-_;break;case"bottom":m=7-l;break;case"top":m=l-7}switch(o){case"top-right":case"bottom-right":p=-_;break;case"top-left":case"bottom-left":p=_;break;case"left":p=l;break;case"right":p=-l}return[p,m]}(i,t[0])}function Wi(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function md(i,t,o,l,p,m,_,T,C,k,R){let D=m.textMaxSize.evaluate(t,{});D===void 0&&(D=_);const V=i.layers[0].layout,G=V.get("icon-offset").evaluate(t,{},R),Z=op(o.horizontal),ee=_/24,ae=i.tilePixelRatio*ee,we=i.tilePixelRatio*D/24,ke=i.tilePixelRatio*T,Re=i.tilePixelRatio*V.get("symbol-spacing"),Be=V.get("text-padding")*i.tilePixelRatio,$e=V.get("icon-padding")*i.tilePixelRatio,Oe=V.get("text-max-angle")/180*Math.PI,dt=V.get("text-rotation-alignment")!=="viewport"&&V.get("symbol-placement")!=="point",ht=V.get("icon-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",Ye=V.get("symbol-placement"),ct=Re/2,nt=V.get("icon-text-fit");let ft;l&&nt!=="none"&&(i.allowVerticalPlacement&&o.vertical&&(ft=Eh(l,o.vertical,nt,V.get("icon-text-fit-padding"),G,ee)),Z&&(l=Eh(l,Z,nt,V.get("icon-text-fit-padding"),G,ee)));const tt=(at,Bt)=>{Bt.x<0||Bt.x>=zi||Bt.y<0||Bt.y>=zi||function(Dt,Qt,ri,vi,Ci,Ui,Vi,Mi,Gi,Li,Zi,si,fi,xi,hi,sr,ir,ki,Ii,qi,jt,Qr,pr,kr,Hi){const Pn=Dt.addToLineVertexArray(Qt,ri);let cn,Yo,to,io,en=0,Qo=0,Pl=0,au=0,su=-1,Ou=-1;const Ra={};let ws=_t(""),lu=0,kl=0;if(Mi._unevaluatedLayout.getValue("text-radial-offset")===void 0?[lu,kl]=Mi.layout.get("text-offset").evaluate(jt,{},kr).map(ro=>ro*zn):(lu=Mi.layout.get("text-radial-offset").evaluate(jt,{},kr)*zn,kl=Sl),Dt.allowVerticalPlacement&&vi.vertical){const ro=Mi.layout.get("text-rotate").evaluate(jt,{},kr)+90;to=new Dc(Gi,Qt,Li,Zi,si,vi.vertical,fi,xi,hi,ro),Vi&&(io=new Dc(Gi,Qt,Li,Zi,si,Vi,ir,ki,hi,ro))}if(Ci){const ro=Mi.layout.get("icon-rotate").evaluate(jt,{}),Bo=Mi.layout.get("icon-text-fit")!=="none",il=Mc(Ci,ro,pr,Bo),rs=Vi?Mc(Vi,ro,pr,Bo):void 0;Yo=new Dc(Gi,Qt,Li,Zi,si,Ci,ir,ki,!1,ro),en=4*il.length;const Uu=Dt.iconSizeData;let Ba=null;Uu.kind==="source"?(Ba=[xs*Mi.layout.get("icon-size").evaluate(jt,{})],Ba[0]>bs&&pi(`${Dt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Uu.kind==="composite"&&(Ba=[xs*Qr.compositeIconSizes[0].evaluate(jt,{},kr),xs*Qr.compositeIconSizes[1].evaluate(jt,{},kr)],(Ba[0]>bs||Ba[1]>bs)&&pi(`${Dt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Dt.addSymbols(Dt.icon,il,Ba,qi,Ii,jt,x.WritingMode.none,Qt,Pn.lineStartIndex,Pn.lineLength,-1,kr),su=Dt.icon.placedSymbolArray.length-1,rs&&(Qo=4*rs.length,Dt.addSymbols(Dt.icon,rs,Ba,qi,Ii,jt,x.WritingMode.vertical,Qt,Pn.lineStartIndex,Pn.lineLength,-1,kr),Ou=Dt.icon.placedSymbolArray.length-1)}const tl=Object.keys(vi.horizontal);for(const ro of tl){const Bo=vi.horizontal[ro];if(!cn){ws=_t(Bo.text);const rs=Mi.layout.get("text-rotate").evaluate(jt,{},kr);cn=new Dc(Gi,Qt,Li,Zi,si,Bo,fi,xi,hi,rs)}const il=Bo.positionedLines.length===1;if(Pl+=ru(Dt,Qt,Bo,Ui,Mi,hi,jt,sr,Pn,vi.vertical?x.WritingMode.horizontal:x.WritingMode.horizontalOnly,il?tl:[ro],Ra,su,Qr,kr),il)break}vi.vertical&&(au+=ru(Dt,Qt,vi.vertical,Ui,Mi,hi,jt,sr,Pn,x.WritingMode.vertical,["vertical"],Ra,Ou,Qr,kr));const Fu=cn?cn.boxStartIndex:Dt.collisionBoxArray.length,Nc=cn?cn.boxEndIndex:Dt.collisionBoxArray.length,jc=to?to.boxStartIndex:Dt.collisionBoxArray.length,hc=to?to.boxEndIndex:Dt.collisionBoxArray.length,pc=Yo?Yo.boxStartIndex:Dt.collisionBoxArray.length,qc=Yo?Yo.boxEndIndex:Dt.collisionBoxArray.length,dc=io?io.boxStartIndex:Dt.collisionBoxArray.length,fc=io?io.boxEndIndex:Dt.collisionBoxArray.length;let Ro=-1;const uu=(ro,Bo)=>ro&&ro.circleDiameter?Math.max(ro.circleDiameter,Bo):Bo;Ro=uu(cn,Ro),Ro=uu(to,Ro),Ro=uu(Yo,Ro),Ro=uu(io,Ro);const cu=Ro>-1?1:0;cu&&(Ro*=Hi/zn),Dt.glyphOffsetArray.length>=nu.MAX_GLYPHS&&pi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),jt.sortKey!==void 0&&Dt.addToSortKeyRanges(Dt.symbolInstances.length,jt.sortKey),Dt.symbolInstances.emplaceBack(Qt.x,Qt.y,Ra.right>=0?Ra.right:-1,Ra.center>=0?Ra.center:-1,Ra.left>=0?Ra.left:-1,Ra.vertical||-1,su,Ou,ws,Fu,Nc,jc,hc,pc,qc,dc,fc,Li,Pl,au,en,Qo,cu,0,fi,lu,kl,Ro)}(i,Bt,at,o,l,p,ft,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,ae,Be,dt,C,ke,$e,ht,G,t,m,k,R,_)};if(Ye==="line")for(const at of iu(t.geometry,0,0,zi,zi)){const Bt=pd(at,Re,Oe,o.vertical||Z,l,24,we,i.overscaling,zi);for(const Dt of Bt){const Qt=Z;Qt&&yd(i,Qt.text,ct,Dt)||tt(at,Dt)}}else if(Ye==="line-center"){for(const at of t.geometry)if(at.length>1){const Bt=hd(at,Oe,o.vertical||Z,l,24,we);Bt&&tt(at,Bt)}}else if(t.type==="Polygon")for(const at of Yu(t.geometry,0)){const Bt=Rc(at,16);tt(at[0],new Qs(Bt.x,Bt.y,0))}else if(t.type==="LineString")for(const at of t.geometry)tt(at,new Qs(at[0].x,at[0].y,0));else if(t.type==="Point")for(const at of t.geometry)for(const Bt of at)tt([Bt],new Qs(Bt.x,Bt.y,0))}const bs=32640;function ru(i,t,o,l,p,m,_,T,C,k,R,D,V,G,Z){const ee=function(ke,Re,Be,$e,Oe,dt,ht,Ye){const ct=$e.layout.get("text-rotate").evaluate(dt,{})*Math.PI/180,nt=[];for(const ft of Re.positionedLines)for(const tt of ft.positionedGlyphs){if(!tt.rect)continue;const at=tt.rect||{};let Bt=4,Dt=!0,Qt=1,ri=0;const vi=(Oe||Ye)&&tt.vertical,Ci=tt.metrics.advance*tt.scale/2;if(Ye&&Re.verticalizable){const Ii=(tt.scale-1)*zn,qi=(zn-tt.metrics.width*tt.scale)/2;ri=ft.lineOffset/2-(tt.imageName?-qi:Ii)}if(tt.imageName){const Ii=ht[tt.imageName];Dt=Ii.sdf,Qt=Ii.pixelRatio,Bt=1/Qt}const Ui=Oe?[tt.x+Ci,tt.y]:[0,0];let Vi=Oe?[0,0]:[tt.x+Ci+Be[0],tt.y+Be[1]-ri],Mi=[0,0];vi&&(Mi=Vi,Vi=[0,0]);const Gi=(tt.metrics.left-Bt)*tt.scale-Ci+Vi[0],Li=(-tt.metrics.top-Bt)*tt.scale+Vi[1],Zi=Gi+at.w*tt.scale/Qt,si=Li+at.h*tt.scale/Qt,fi=new Yt(Gi,Li),xi=new Yt(Zi,Li),hi=new Yt(Gi,si),sr=new Yt(Zi,si);if(vi){const Ii=new Yt(-Ci,Ci-Pu),qi=-Math.PI/2,jt=12-Ci,Qr=new Yt(22-jt,-(tt.imageName?jt:0)),pr=new Yt(...Mi);fi._rotateAround(qi,Ii)._add(Qr)._add(pr),xi._rotateAround(qi,Ii)._add(Qr)._add(pr),hi._rotateAround(qi,Ii)._add(Qr)._add(pr),sr._rotateAround(qi,Ii)._add(Qr)._add(pr)}if(ct){const Ii=Math.sin(ct),qi=Math.cos(ct),jt=[qi,-Ii,Ii,qi];fi._matMult(jt),xi._matMult(jt),hi._matMult(jt),sr._matMult(jt)}const ir=new Yt(0,0),ki=new Yt(0,0);nt.push({tl:fi,tr:xi,bl:hi,br:sr,tex:at,writingMode:Re.writingMode,glyphOffset:Ui,sectionIndex:tt.sectionIndex,isSDF:Dt,pixelOffsetTL:ir,pixelOffsetBR:ki,minFontScaleX:0,minFontScaleY:0})}return nt}(0,o,T,p,m,_,l,i.allowVerticalPlacement),ae=i.textSizeData;let we=null;ae.kind==="source"?(we=[xs*p.layout.get("text-size").evaluate(_,{})],we[0]>bs&&pi(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ae.kind==="composite"&&(we=[xs*G.compositeTextSizes[0].evaluate(_,{},Z),xs*G.compositeTextSizes[1].evaluate(_,{},Z)],(we[0]>bs||we[1]>bs)&&pi(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,ee,we,T,m,_,k,t,C.lineStartIndex,C.lineLength,V,Z);for(const ke of R)D[ke]=i.text.placedSymbolArray.length-1;return 4*ee.length}function op(i){for(const t in i)return i[t];return null}function yd(i,t,o,l){const p=i.compareText;if(t in p){const m=p[t];for(let _=m.length-1;_>=0;_--)if(l.dist(m[_])<o)return!0}else p[t]=[];return p[t].push(l),!1}const gd=wl.VectorTileFeature.types,_d=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Bc(i,t,o,l,p,m,_,T,C,k,R,D,V){const G=T?Math.min(bs,Math.round(T[0])):0,Z=T?Math.min(bs,Math.round(T[1])):0;i.emplaceBack(t,o,Math.round(32*l),Math.round(32*p),m,_,(G<<1)+(C?1:0),Z,16*k,16*R,256*D,256*V)}function Th(i,t,o){i.emplaceBack(t.x,t.y,o),i.emplaceBack(t.x,t.y,o),i.emplaceBack(t.x,t.y,o),i.emplaceBack(t.x,t.y,o)}function vd(i){for(const t of i.sections)if(Ut(t.text))return!0;return!1}class Oc{constructor(t){this.layoutVertexArray=new B,this.indexArray=new ue,this.programConfigurations=t,this.segments=new me,this.dynamicLayoutVertexArray=new q,this.opacityVertexArray=new W,this.placedSymbolArray=new mt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,o,l,p){this.isEmpty()||(l&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Wh.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Hh.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,_d,!0),this.opacityVertexBuffer.itemSize=1),(l||p)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}kt("SymbolBuffers",Oc);class Fc{constructor(t,o,l){this.layoutVertexArray=new t,this.layoutAttributes=o,this.indexArray=new l,this.segments=new me,this.collisionVertexArray=new se}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Ac.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}kt("CollisionBuffers",Fc);class nu{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(_=>_.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=xl([]),this.placementViewportMatrix=xl([]);const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=rc(this.zoom,o["text-size"]),this.iconSizeData=rc(this.zoom,o["icon-size"]);const l=this.layers[0].layout,p=l.get("symbol-sort-key"),m=l.get("symbol-z-order");this.canOverlap=Il(l,"text-overlap","text-allow-overlap")!=="never"||Il(l,"icon-overlap","icon-allow-overlap")!=="never"||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&!p.isConstant(),this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map(_=>x.WritingMode[_])),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=t.sourceID}createArrays(){this.text=new Oc(new Fr(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Oc(new Fr(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new qt,this.lineVertexArray=new Rt,this.symbolInstances=new lt}calculateGlyphDependencies(t,o,l,p,m){for(let _=0;_<t.length;_++)if(o[t.charCodeAt(_)]=!0,(l||p)&&m){const T=vs[t.charAt(_)];T&&(o[T.charCodeAt(0)]=!0)}}populate(t,o,l){const p=this.layers[0],m=p.layout,_=m.get("text-font"),T=m.get("text-field"),C=m.get("icon-image"),k=(T.value.kind!=="constant"||T.value.value instanceof de&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(_.value.kind!=="constant"||_.value.value.length>0),R=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,D=m.get("symbol-sort-key");if(this.features=[],!k&&!R)return;const V=o.iconDependencies,G=o.glyphDependencies,Z=o.availableImages,ee=new or(this.zoom);for(const{feature:ae,id:we,index:ke,sourceLayerIndex:Re}of t){const Be=p._featureFilter.needGeometry,$e=Wr(ae,Be);if(!p._featureFilter.filter(ee,$e,l))continue;let Oe,dt;if(Be||($e.geometry=So(ae)),k){const Ye=p.getValueAndResolveTokens("text-field",$e,l,Z),ct=de.factory(Ye);vd(ct)&&(this.hasRTLText=!0),(!this.hasRTLText||js()==="unavailable"||this.hasRTLText&&fr.isParsed())&&(Oe=Ws(ct,p,$e))}if(R){const Ye=p.getValueAndResolveTokens("icon-image",$e,l,Z);dt=Ye instanceof le?Ye:le.fromString(Ye)}if(!Oe&&!dt)continue;const ht=this.sortFeaturesByKey?D.evaluate($e,{},l):void 0;if(this.features.push({id:we,text:Oe,icon:dt,index:ke,sourceLayerIndex:Re,geometry:$e.geometry,properties:ae.properties,type:gd[ae.type],sortKey:ht}),dt&&(V[dt.name]=!0),Oe){const Ye=_.evaluate($e,{},l).join(","),ct=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(x.WritingMode.vertical)>=0;for(const nt of Oe.sections)if(nt.image)V[nt.image.name]=!0;else{const ft=Ka(Oe.toString()),tt=nt.fontStack||Ye,at=G[tt]=G[tt]||{};this.calculateGlyphDependencies(nt.text,at,ct,this.allowVerticalPlacement,ft)}}}m.get("symbol-placement")==="line"&&(this.features=function(ae){const we={},ke={},Re=[];let Be=0;function $e(Ye){Re.push(ae[Ye]),Be++}function Oe(Ye,ct,nt){const ft=ke[Ye];return delete ke[Ye],ke[ct]=ft,Re[ft].geometry[0].pop(),Re[ft].geometry[0]=Re[ft].geometry[0].concat(nt[0]),ft}function dt(Ye,ct,nt){const ft=we[ct];return delete we[ct],we[Ye]=ft,Re[ft].geometry[0].shift(),Re[ft].geometry[0]=nt[0].concat(Re[ft].geometry[0]),ft}function ht(Ye,ct,nt){const ft=nt?ct[0][ct[0].length-1]:ct[0][0];return`${Ye}:${ft.x}:${ft.y}`}for(let Ye=0;Ye<ae.length;Ye++){const ct=ae[Ye],nt=ct.geometry,ft=ct.text?ct.text.toString():null;if(!ft){$e(Ye);continue}const tt=ht(ft,nt),at=ht(ft,nt,!0);if(tt in ke&&at in we&&ke[tt]!==we[at]){const Bt=dt(tt,at,nt),Dt=Oe(tt,at,Re[Bt].geometry);delete we[tt],delete ke[at],ke[ht(ft,Re[Dt].geometry,!0)]=Dt,Re[Bt].geometry=null}else tt in ke?Oe(tt,at,nt):at in we?dt(tt,at,nt):($e(Ye),we[tt]=Be-1,ke[at]=Be-1)}return Re.filter(Ye=>Ye.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ae,we)=>ae.sortKey-we.sortKey)}update(t,o,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,o,this.layers,l),this.icon.programConfigurations.updatePaintArrays(t,o,this.layers,l))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,o){const l=this.lineVertexArray.length;if(t.segment!==void 0){let p=t.dist(o[t.segment+1]),m=t.dist(o[t.segment]);const _={};for(let T=t.segment+1;T<o.length;T++)_[T]={x:o[T].x,y:o[T].y,tileUnitDistanceFromAnchor:p},T<o.length-1&&(p+=o[T+1].dist(o[T]));for(let T=t.segment||0;T>=0;T--)_[T]={x:o[T].x,y:o[T].y,tileUnitDistanceFromAnchor:m},T>0&&(m+=o[T-1].dist(o[T]));for(let T=0;T<o.length;T++){const C=_[T];this.lineVertexArray.emplaceBack(C.x,C.y,C.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(t,o,l,p,m,_,T,C,k,R,D,V){const G=t.indexArray,Z=t.layoutVertexArray,ee=t.segments.prepareSegment(4*o.length,Z,G,this.canOverlap?_.sortKey:void 0),ae=this.glyphOffsetArray.length,we=ee.vertexLength,ke=this.allowVerticalPlacement&&T===x.WritingMode.vertical?Math.PI/2:0,Re=_.text&&_.text.sections;for(let Be=0;Be<o.length;Be++){const{tl:$e,tr:Oe,bl:dt,br:ht,tex:Ye,pixelOffsetTL:ct,pixelOffsetBR:nt,minFontScaleX:ft,minFontScaleY:tt,glyphOffset:at,isSDF:Bt,sectionIndex:Dt}=o[Be],Qt=ee.vertexLength,ri=at[1];Bc(Z,C.x,C.y,$e.x,ri+$e.y,Ye.x,Ye.y,l,Bt,ct.x,ct.y,ft,tt),Bc(Z,C.x,C.y,Oe.x,ri+Oe.y,Ye.x+Ye.w,Ye.y,l,Bt,nt.x,ct.y,ft,tt),Bc(Z,C.x,C.y,dt.x,ri+dt.y,Ye.x,Ye.y+Ye.h,l,Bt,ct.x,nt.y,ft,tt),Bc(Z,C.x,C.y,ht.x,ri+ht.y,Ye.x+Ye.w,Ye.y+Ye.h,l,Bt,nt.x,nt.y,ft,tt),Th(t.dynamicLayoutVertexArray,C,ke),G.emplaceBack(Qt,Qt+1,Qt+2),G.emplaceBack(Qt+1,Qt+2,Qt+3),ee.vertexLength+=4,ee.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(at[0]),Be!==o.length-1&&Dt===o[Be+1].sectionIndex||t.programConfigurations.populatePaintArrays(Z.length,_,_.index,{},V,Re&&Re[Dt])}t.placedSymbolArray.emplaceBack(C.x,C.y,ae,this.glyphOffsetArray.length-ae,we,k,R,C.segment,l?l[0]:0,l?l[1]:0,p[0],p[1],T,0,!1,0,D)}_addCollisionDebugVertex(t,o,l,p,m,_){return o.emplaceBack(0,0),t.emplaceBack(l.x,l.y,p,m,Math.round(_.x),Math.round(_.y))}addCollisionDebugVertices(t,o,l,p,m,_,T){const C=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),k=C.vertexLength,R=m.layoutVertexArray,D=m.collisionVertexArray,V=T.anchorX,G=T.anchorY;this._addCollisionDebugVertex(R,D,_,V,G,new Yt(t,o)),this._addCollisionDebugVertex(R,D,_,V,G,new Yt(l,o)),this._addCollisionDebugVertex(R,D,_,V,G,new Yt(l,p)),this._addCollisionDebugVertex(R,D,_,V,G,new Yt(t,p)),C.vertexLength+=4;const Z=m.indexArray;Z.emplaceBack(k,k+1),Z.emplaceBack(k+1,k+2),Z.emplaceBack(k+2,k+3),Z.emplaceBack(k+3,k),C.primitiveLength+=4}addDebugCollisionBoxes(t,o,l,p){for(let m=t;m<o;m++){const _=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(_.x1,_.y1,_.x2,_.y2,p?this.textCollisionBox:this.iconCollisionBox,_.anchorPoint,l)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Fc(oe,ar.members,Ee),this.iconCollisionBox=new Fc(oe,ar.members,Ee);for(let t=0;t<this.symbolInstances.length;t++){const o=this.symbolInstances.get(t);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}}_deserializeCollisionBoxesForSymbol(t,o,l,p,m,_,T,C,k){const R={};for(let D=o;D<l;D++){const V=t.get(D);R.textBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},R.textFeatureIndex=V.featureIndex;break}for(let D=p;D<m;D++){const V=t.get(D);R.verticalTextBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},R.verticalTextFeatureIndex=V.featureIndex;break}for(let D=_;D<T;D++){const V=t.get(D);R.iconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},R.iconFeatureIndex=V.featureIndex;break}for(let D=C;D<k;D++){const V=t.get(D);R.verticalIconBox={x1:V.x1,y1:V.y1,x2:V.x2,y2:V.y2,anchorPointX:V.anchorPointX,anchorPointY:V.anchorPointY},R.verticalIconFeatureIndex=V.featureIndex;break}return R}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const l=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,o){const l=t.placedSymbolArray.get(o),p=l.vertexStartIndex+4*l.numGlyphs;for(let m=l.vertexStartIndex;m<p;m+=4)t.indexArray.emplaceBack(m,m+1,m+2),t.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(t),l=Math.cos(t),p=[],m=[],_=[];for(let T=0;T<this.symbolInstances.length;++T){_.push(T);const C=this.symbolInstances.get(T);p.push(0|Math.round(o*C.anchorX+l*C.anchorY)),m.push(C.featureIndex)}return _.sort((T,C)=>p[T]-p[C]||m[C]-m[T]),_}addToSortKeyRanges(t,o){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===o?l.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const l=this.symbolInstances.get(o);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach((p,m,_)=>{p>=0&&_.indexOf(p)===m&&this.addIndicesForPlacedSymbol(this.text,p)}),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}kt("SymbolBucket",nu,{omit:["layers","collisionBoxArray","features","compareText"]}),nu.MAX_GLYPHS=65535,nu.addDynamicAttributes=Th;const ap=new mr({"symbol-placement":new Vt(ot.layout_symbol["symbol-placement"]),"symbol-spacing":new Vt(ot.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Vt(ot.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new wt(ot.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Vt(ot.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Vt(ot.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Vt(ot.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Vt(ot.layout_symbol["icon-ignore-placement"]),"icon-optional":new Vt(ot.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Vt(ot.layout_symbol["icon-rotation-alignment"]),"icon-size":new wt(ot.layout_symbol["icon-size"]),"icon-text-fit":new Vt(ot.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Vt(ot.layout_symbol["icon-text-fit-padding"]),"icon-image":new wt(ot.layout_symbol["icon-image"]),"icon-rotate":new wt(ot.layout_symbol["icon-rotate"]),"icon-padding":new Vt(ot.layout_symbol["icon-padding"]),"icon-keep-upright":new Vt(ot.layout_symbol["icon-keep-upright"]),"icon-offset":new wt(ot.layout_symbol["icon-offset"]),"icon-anchor":new wt(ot.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Vt(ot.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Vt(ot.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Vt(ot.layout_symbol["text-rotation-alignment"]),"text-field":new wt(ot.layout_symbol["text-field"]),"text-font":new wt(ot.layout_symbol["text-font"]),"text-size":new wt(ot.layout_symbol["text-size"]),"text-max-width":new wt(ot.layout_symbol["text-max-width"]),"text-line-height":new Vt(ot.layout_symbol["text-line-height"]),"text-letter-spacing":new wt(ot.layout_symbol["text-letter-spacing"]),"text-justify":new wt(ot.layout_symbol["text-justify"]),"text-radial-offset":new wt(ot.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Vt(ot.layout_symbol["text-variable-anchor"]),"text-anchor":new wt(ot.layout_symbol["text-anchor"]),"text-max-angle":new Vt(ot.layout_symbol["text-max-angle"]),"text-writing-mode":new Vt(ot.layout_symbol["text-writing-mode"]),"text-rotate":new wt(ot.layout_symbol["text-rotate"]),"text-padding":new Vt(ot.layout_symbol["text-padding"]),"text-keep-upright":new Vt(ot.layout_symbol["text-keep-upright"]),"text-transform":new wt(ot.layout_symbol["text-transform"]),"text-offset":new wt(ot.layout_symbol["text-offset"]),"text-allow-overlap":new Vt(ot.layout_symbol["text-allow-overlap"]),"text-overlap":new Vt(ot.layout_symbol["text-overlap"]),"text-ignore-placement":new Vt(ot.layout_symbol["text-ignore-placement"]),"text-optional":new Vt(ot.layout_symbol["text-optional"])});var Du={paint:new mr({"icon-opacity":new wt(ot.paint_symbol["icon-opacity"]),"icon-color":new wt(ot.paint_symbol["icon-color"]),"icon-halo-color":new wt(ot.paint_symbol["icon-halo-color"]),"icon-halo-width":new wt(ot.paint_symbol["icon-halo-width"]),"icon-halo-blur":new wt(ot.paint_symbol["icon-halo-blur"]),"icon-translate":new Vt(ot.paint_symbol["icon-translate"]),"icon-translate-anchor":new Vt(ot.paint_symbol["icon-translate-anchor"]),"text-opacity":new wt(ot.paint_symbol["text-opacity"]),"text-color":new wt(ot.paint_symbol["text-color"],{runtimeType:Rr,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new wt(ot.paint_symbol["text-halo-color"]),"text-halo-width":new wt(ot.paint_symbol["text-halo-width"]),"text-halo-blur":new wt(ot.paint_symbol["text-halo-blur"]),"text-translate":new Vt(ot.paint_symbol["text-translate"]),"text-translate-anchor":new Vt(ot.paint_symbol["text-translate-anchor"])}),layout:ap};class Tl{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:er,this.defaultValue=t}evaluate(t){if(t.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(t.formattedSection))return o.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}kt("FormatSectionOverride",Tl,{omit:["defaultValue"]});class Ru extends vr{constructor(t){super(t,Du)}recalculate(t,o){if(super.recalculate(t,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const l=this.layout.get("text-writing-mode");if(l){const p=[];for(const m of l)p.indexOf(m)<0&&p.push(m);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,o,l,p){const m=this.layout.get(t).evaluate(o,{},l,p),_=this._unevaluatedLayout._values[t];return _.isDataDriven()||$o(_.value)||!m?m:function(T,C){return C.replace(/{([^{}]+)}/g,(k,R)=>R in T?String(T[R]):"")}(o.properties,m)}createBucket(t){return new nu(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of Du.paint.overridableProperties){if(!Ru.hasPaintOverride(this.layout,t))continue;const o=this.paint.get(t),l=new Tl(o),p=new pl(l,o.property.specification);let m=null;m=o.value.kind==="constant"||o.value.kind==="source"?new Rs("source",p):new Ca("composite",p,o.value.zoomStops,o.value._interpolationType),this.paint._values[t]=new Eo(o.property,m,o.parameters)}}_handleOverridablePaintPropertyUpdate(t,o,l){return!(!this.layout||o.isDataDriven()||l.isDataDriven())&&Ru.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,o){const l=t.get("text-field"),p=Du.paint.properties[o];let m=!1;const _=T=>{for(const C of T)if(p.overrides&&p.overrides.hasOverride(C))return void(m=!0)};if(l.value.kind==="constant"&&l.value.value instanceof de)_(l.value.value.sections);else if(l.value.kind==="source"){const T=k=>{m||(k instanceof Ue&&ve(k.value)===Ln?_(k.value.sections):k instanceof vt?_(k.sections):k.eachChild(T))},C=l.value;C._styleExpression&&T(C._styleExpression.expression)}return m}}function Il(i,t,o){let l="never";const p=i.get(t);return p?l=p:i.get(o)&&(l="always"),l}var sp={paint:new mr({"background-color":new Vt(ot.paint_background["background-color"]),"background-pattern":new An(ot.paint_background["background-pattern"]),"background-opacity":new Vt(ot.paint_background["background-opacity"])})},Yr={paint:new mr({"raster-opacity":new Vt(ot.paint_raster["raster-opacity"]),"raster-hue-rotate":new Vt(ot.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Vt(ot.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Vt(ot.paint_raster["raster-brightness-max"]),"raster-saturation":new Vt(ot.paint_raster["raster-saturation"]),"raster-contrast":new Vt(ot.paint_raster["raster-contrast"]),"raster-resampling":new Vt(ot.paint_raster["raster-resampling"]),"raster-fade-duration":new Vt(ot.paint_raster["raster-fade-duration"])})};class gr extends vr{constructor(t){super(t,{}),this.onAdd=o=>{this.implementation.onAdd&&this.implementation.onAdd(o,o.painter.context.gl)},this.onRemove=o=>{this.implementation.onRemove&&this.implementation.onRemove(o,o.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}}const lp={circle:class extends vr{constructor(i){super(i,$s)}createBucket(i){return new Io(i)}queryRadius(i){const t=i;return ga("circle-radius",this,t)+ga("circle-stroke-width",this,t)+Ri(this.paint.get("circle-translate"))}queryIntersectsFeature(i,t,o,l,p,m,_,T){const C=Yn(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,_),k=this.paint.get("circle-radius").evaluate(t,o)+this.paint.get("circle-stroke-width").evaluate(t,o),R=this.paint.get("circle-pitch-alignment")==="map",D=R?C:function(G,Z){return G.map(ee=>Wl(ee,Z))}(C,T),V=R?k*_:k;for(const G of l)for(const Z of G){const ee=R?Z:Wl(Z,T);let ae=V;const we=es([],[Z.x,Z.y,0,1],T);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ae*=we[3]/m.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ae*=m.cameraToCenterDistance/we[3]),gl(D,ee,ae))return!0}return!1}},heatmap:class extends vr{constructor(i){super(i,Hl),this._updateColorRamp()}createBucket(i){return new Ec(i)}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Fh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends vr{constructor(i){super(i,Op)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends vr{constructor(i){super(i,Uh)}recalculate(i,t){super.recalculate(i,t);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new uh(i)}queryRadius(){return Ri(this.paint.get("fill-translate"))}queryIntersectsFeature(i,t,o,l,p,m,_){return Ya(Yn(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,_),l)}isTileClipped(){return!0}},"fill-extrusion":class extends vr{constructor(i){super(i,td)}createBucket(i){return new hh(i)}queryRadius(){return Ri(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,t,o,l,p,m,_,T){const C=Yn(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,_),k=this.paint.get("fill-extrusion-height").evaluate(t,o),R=this.paint.get("fill-extrusion-base").evaluate(t,o),D=function(G,Z,ee,ae){const we=[];for(const ke of G){const Re=[ke.x,ke.y,0,1];es(Re,Re,Z),we.push(new Yt(Re[0]/Re[3],Re[1]/Re[3]))}return we}(C,T),V=function(G,Z,ee,ae){const we=[],ke=[],Re=ae[8]*Z,Be=ae[9]*Z,$e=ae[10]*Z,Oe=ae[11]*Z,dt=ae[8]*ee,ht=ae[9]*ee,Ye=ae[10]*ee,ct=ae[11]*ee;for(const nt of G){const ft=[],tt=[];for(const at of nt){const Bt=at.x,Dt=at.y,Qt=ae[0]*Bt+ae[4]*Dt+ae[12],ri=ae[1]*Bt+ae[5]*Dt+ae[13],vi=ae[2]*Bt+ae[6]*Dt+ae[14],Ci=ae[3]*Bt+ae[7]*Dt+ae[15],Ui=vi+$e,Vi=Ci+Oe,Mi=Qt+dt,Gi=ri+ht,Li=vi+Ye,Zi=Ci+ct,si=new Yt((Qt+Re)/Vi,(ri+Be)/Vi);si.z=Ui/Vi,ft.push(si);const fi=new Yt(Mi/Zi,Gi/Zi);fi.z=Li/Zi,tt.push(fi)}we.push(ft),ke.push(tt)}return[we,ke]}(l,R,k,T);return function(G,Z,ee){let ae=1/0;Ya(ee,Z)&&(ae=eo(ee,Z[0]));for(let we=0;we<Z.length;we++){const ke=Z[we],Re=G[we];for(let Be=0;Be<ke.length-1;Be++){const $e=ke[Be],Oe=[$e,ke[Be+1],Re[Be+1],Re[Be],$e];yl(ee,Oe)&&(ae=Math.min(ae,eo(ee,Oe)))}}return ae!==1/0&&ae}(V[0],V[1],D)}},line:class extends vr{constructor(i){super(i,$h),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){i==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Na,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,t){super.recalculate(i,t),this.paint._values["line-floorwidth"]=Xh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new ph(i)}queryRadius(i){const t=i,o=zu(ga("line-width",this,t),ga("line-gap-width",this,t)),l=ga("line-offset",this,t);return o/2+Math.abs(l)+Ri(this.paint.get("line-translate"))}queryIntersectsFeature(i,t,o,l,p,m,_){const T=Yn(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,_),C=_/2*zu(this.paint.get("line-width").evaluate(t,o),this.paint.get("line-gap-width").evaluate(t,o)),k=this.paint.get("line-offset").evaluate(t,o);return k&&(l=function(R,D){const V=[];for(let G=0;G<R.length;G++){const Z=R[G],ee=[];for(let ae=0;ae<Z.length;ae++){const we=Z[ae-1],ke=Z[ae],Re=Z[ae+1],Be=ae===0?new Yt(0,0):ke.sub(we)._unit()._perp(),$e=ae===Z.length-1?new Yt(0,0):Re.sub(ke)._unit()._perp(),Oe=Be._add($e)._unit(),dt=Oe.x*$e.x+Oe.y*$e.y;dt!==0&&Oe._mult(1/dt),ee.push(Oe._mult(D)._add(ke))}V.push(ee)}return V}(l,k*_)),function(R,D,V){for(let G=0;G<D.length;G++){const Z=D[G];if(R.length>=3){for(let ee=0;ee<Z.length;ee++)if(Ao(R,Z[ee]))return!0}if(_l(R,Z,V))return!0}return!1}(T,l,C)}isTileClipped(){return!0}},symbol:Ru,background:class extends vr{constructor(i){super(i,sp)}},raster:class extends vr{constructor(i){super(i,Yr)}}};class up{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Ih=63710088e-1;class Ur{constructor(t,o){if(isNaN(t)||isNaN(o))throw new Error(`Invalid LngLat object: (${t}, ${o})`);if(this.lng=+t,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ur(It(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const o=Math.PI/180,l=this.lat*o,p=t.lat*o,m=Math.sin(l)*Math.sin(p)+Math.cos(l)*Math.cos(p)*Math.cos((t.lng-this.lng)*o);return Ih*Math.acos(Math.min(m,1))}toBounds(t=0){const o=360*t/40075017,l=o/Math.cos(Math.PI/180*this.lat);return new Al(new Ur(this.lng-l,this.lat-o),new Ur(this.lng+l,this.lat+o))}static convert(t){if(t instanceof Ur)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Ur(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Ur(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Al{constructor(t,o){t&&(o?this.setSouthWest(t).setNorthEast(o):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof Ur?new Ur(t.lng,t.lat):Ur.convert(t),this}setSouthWest(t){return this._sw=t instanceof Ur?new Ur(t.lng,t.lat):Ur.convert(t),this}extend(t){const o=this._sw,l=this._ne;let p,m;if(t instanceof Ur)p=t,m=t;else{if(!(t instanceof Al))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Al.convert(t)):this.extend(Ur.convert(t)):this;if(p=t._sw,m=t._ne,!p||!m)return this}return o||l?(o.lng=Math.min(p.lng,o.lng),o.lat=Math.min(p.lat,o.lat),l.lng=Math.max(m.lng,l.lng),l.lat=Math.max(m.lat,l.lat)):(this._sw=new Ur(p.lng,p.lat),this._ne=new Ur(m.lng,m.lat)),this}getCenter(){return new Ur((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ur(this.getWest(),this.getNorth())}getSouthEast(){return new Ur(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:o,lat:l}=Ur.convert(t);let p=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&p}static convert(t){return t instanceof Al?t:t&&new Al(t)}}const Uc=2*Math.PI*Ih;function Cl(i){return Uc*Math.cos(i*Math.PI/180)}function zl(i){return(180+i)/360}function Ah(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function jr(i,t){return i/Cl(t)}function ou(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Da{constructor(t,o,l=0){this.x=+t,this.y=+o,this.z=+l}static fromLngLat(t,o=0){const l=Ur.convert(t);return new Da(zl(l.lng),Ah(l.lat),jr(o,l.lat))}toLngLat(){return new Ur(360*this.x-180,ou(this.y))}toAltitude(){return this.z*Cl(ou(this.y))}meterInMercatorCoordinateUnits(){return 1/Uc*(t=ou(this.y),1/Math.cos(t*Math.PI/180));var t}}function cc(i,t,o){var l=2*Math.PI*6378137/256/Math.pow(2,o);return[i*l-2*Math.PI*6378137/2,t*l-2*Math.PI*6378137/2]}class Bu{constructor(t,o,l){this.z=t,this.x=o,this.y=l,this.key=va(0,t,t,o,l)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,o,l){const p=(_=this.y,T=this.z,C=cc(256*(m=this.x),256*(_=Math.pow(2,T)-_-1),T),k=cc(256*(m+1),256*(_+1),T),C[0]+","+C[1]+","+k[0]+","+k[1]);var m,_,T,C,k;const R=function(D,V,G){let Z,ee="";for(let ae=D;ae>0;ae--)Z=1<<ae-1,ee+=(V&Z?1:0)+(G&Z?2:0);return ee}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,o>1?"@2x":"").replace(/{quadkey}/g,R).replace(/{bbox-epsg-3857}/g,p)}getTilePoint(t){const o=Math.pow(2,this.z);return new Yt((t.x*o-this.x)*zi,(t.y*o-this.y)*zi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Vc{constructor(t,o){this.wrap=t,this.canonical=o,this.key=va(t,o.z,o.z,o.x,o.y)}}class _o{constructor(t,o,l,p,m){this.overscaledZ=t,this.wrap=o,this.canonical=new Bu(l,+p,+m),this.key=va(o,t,l,p,m)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const o=this.canonical.z-t;return t>this.canonical.z?new _o(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new _o(t,this.wrap,t,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(t,o){const l=this.canonical.z-t;return t>this.canonical.z?va(this.wrap*+o,t,this.canonical.z,this.canonical.x,this.canonical.y):va(this.wrap*+o,t,t,this.canonical.x>>l,this.canonical.y>>l)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const o=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>o&&t.canonical.y===this.canonical.y>>o}children(t){if(this.overscaledZ>=t)return[new _o(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,l=2*this.canonical.x,p=2*this.canonical.y;return[new _o(o,this.wrap,o,l,p),new _o(o,this.wrap,o,l+1,p),new _o(o,this.wrap,o,l,p+1),new _o(o,this.wrap,o,l+1,p+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new _o(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new _o(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Vc(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Da(t.x-this.wrap,t.y))}}function va(i,t,o,l,p){(i*=2)<0&&(i=-1*i-1);const m=1<<o;return(m*m*i+m*p+l).toString(36)+o.toString(36)+t.toString(36)}kt("CanonicalTileID",Bu),kt("OverscaledTileID",_o,{omit:["posMatrix"]});class Ch{constructor(t,o,l){if(this.uid=t,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return void pi(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;const p=this.dim=o.height-2;this.data=new Uint32Array(o.data.buffer),this.encoding=l||"mapbox";for(let m=0;m<p;m++)this.data[this._idx(-1,m)]=this.data[this._idx(0,m)],this.data[this._idx(p,m)]=this.data[this._idx(p-1,m)],this.data[this._idx(m,-1)]=this.data[this._idx(m,0)],this.data[this._idx(m,p)]=this.data[this._idx(m,p-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(p,-1)]=this.data[this._idx(p-1,0)],this.data[this._idx(-1,p)]=this.data[this._idx(0,p-1)],this.data[this._idx(p,p)]=this.data[this._idx(p-1,p-1)]}get(t,o){const l=new Uint8Array(this.data.buffer),p=4*this._idx(t,o);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(l[p],l[p+1],l[p+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(t,o){if(t<-1||t>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(t+1)}_unpackMapbox(t,o,l){return(256*t*256+256*o+l)/10-1e4}_unpackTerrarium(t,o,l){return 256*t+o+l/256-32768}getPixels(){return new _a({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,o,l){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let p=o*this.dim,m=o*this.dim+this.dim,_=l*this.dim,T=l*this.dim+this.dim;switch(o){case-1:p=m-1;break;case 1:m=p+1}switch(l){case-1:_=T-1;break;case 1:T=_+1}const C=-o*this.dim,k=-l*this.dim;for(let R=_;R<T;R++)for(let D=p;D<m;D++)this.data[this._idx(D,R)]=t.data[this._idx(D+C,R+k)]}}kt("DEMData",Ch);class zh{constructor(t){this._stringToNumber={},this._numberToString=[];for(let o=0;o<t.length;o++){const l=t[o];this._stringToNumber[l]=o,this._numberToString[o]=l}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}class cp{constructor(t,o,l,p,m){this.type="Feature",this._vectorTileFeature=t,t._z=o,t._x=l,t._y=p,this.properties=t.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(t[o]=this[o]);return t}}class un{constructor(t,o){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new bi(zi,16,0),this.grid3D=new bi(zi,16,0),this.featureIndexArray=new s,this.promoteId=o}insert(t,o,l,p,m,_){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,p,m);const C=_?this.grid3D:this.grid;for(let k=0;k<o.length;k++){const R=o[k],D=[1/0,1/0,-1/0,-1/0];for(let V=0;V<R.length;V++){const G=R[V];D[0]=Math.min(D[0],G.x),D[1]=Math.min(D[1],G.y),D[2]=Math.max(D[2],G.x),D[3]=Math.max(D[3],G.y)}D[0]<zi&&D[1]<zi&&D[2]>=0&&D[3]>=0&&C.insert(T,D[0],D[1],D[2],D[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new wl.VectorTile(new dh(this.rawTileData)).layers,this.sourceLayerCoder=new zh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,o,l,p){this.loadVTLayers();const m=t.params||{},_=zi/t.tileSize/t.scale,T=za(m.filter),C=t.queryGeometry,k=t.queryPadding*_,R=Ph(C),D=this.grid.query(R.minX-k,R.minY-k,R.maxX+k,R.maxY+k),V=Ph(t.cameraQueryGeometry),G=this.grid3D.query(V.minX-k,V.minY-k,V.maxX+k,V.maxY+k,(ae,we,ke,Re)=>function(Be,$e,Oe,dt,ht){for(const ct of Be)if($e<=ct.x&&Oe<=ct.y&&dt>=ct.x&&ht>=ct.y)return!0;const Ye=[new Yt($e,Oe),new Yt($e,ht),new Yt(dt,ht),new Yt(dt,Oe)];if(Be.length>2){for(const ct of Ye)if(Ao(Be,ct))return!0}for(let ct=0;ct<Be.length-1;ct++)if(_s(Be[ct],Be[ct+1],Ye))return!0;return!1}(t.cameraQueryGeometry,ae-k,we-k,ke+k,Re+k));for(const ae of G)D.push(ae);D.sort(e);const Z={};let ee;for(let ae=0;ae<D.length;ae++){const we=D[ae];if(we===ee)continue;ee=we;const ke=this.featureIndexArray.get(we);let Re=null;this.loadMatchingFeature(Z,ke.bucketIndex,ke.sourceLayerIndex,ke.featureIndex,T,m.layers,m.availableImages,o,l,p,(Be,$e,Oe)=>(Re||(Re=So(Be)),$e.queryIntersectsFeature(C,Be,Oe,Re,this.z,t.transform,_,t.pixelPosMatrix)))}return Z}loadMatchingFeature(t,o,l,p,m,_,T,C,k,R,D){const V=this.bucketLayerIDs[o];if(_&&!function(ae,we){for(let ke=0;ke<ae.length;ke++)if(we.indexOf(ae[ke])>=0)return!0;return!1}(_,V))return;const G=this.sourceLayerCoder.decode(l),Z=this.vtLayers[G].feature(p);if(m.needGeometry){const ae=Wr(Z,!0);if(!m.filter(new or(this.tileID.overscaledZ),ae,this.tileID.canonical))return}else if(!m.filter(new or(this.tileID.overscaledZ),Z))return;const ee=this.getId(Z,G);for(let ae=0;ae<V.length;ae++){const we=V[ae];if(_&&_.indexOf(we)<0)continue;const ke=C[we];if(!ke)continue;let Re={};ee&&R&&(Re=R.getState(ke.sourceLayer||"_geojsonTileLayer",ee));const Be=yt({},k[we]);Be.paint=el(Be.paint,ke.paint,Z,Re,T),Be.layout=el(Be.layout,ke.layout,Z,Re,T);const $e=!D||D(Z,ke,Re);if(!$e)continue;const Oe=new cp(Z,this.z,this.x,this.y,ee);Oe.layer=Be;let dt=t[we];dt===void 0&&(dt=t[we]=[]),dt.push({featureIndex:p,feature:Oe,intersectionZ:$e})}}lookupSymbolFeatures(t,o,l,p,m,_,T,C){const k={};this.loadVTLayers();const R=za(m);for(const D of t)this.loadMatchingFeature(k,l,p,D,R,_,T,C,o);return k}hasLayer(t){for(const o of this.bucketLayerIDs)for(const l of o)if(t===l)return!0;return!1}getId(t,o){let l=t.id;return this.promoteId&&(l=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]],typeof l=="boolean"&&(l=Number(l))),l}}function el(i,t,o,l,p){return Ei(i,(m,_)=>{const T=t instanceof Wn?t.get(_):null;return T&&T.evaluate?T.evaluate(o,l,p):T})}function Ph(i){let t=1/0,o=1/0,l=-1/0,p=-1/0;for(const m of i)t=Math.min(t,m.x),o=Math.min(o,m.y),l=Math.max(l,m.x),p=Math.max(p,m.y);return{minX:t,minY:o,maxX:l,maxY:p}}function e(i,t){return t-i}var r;kt("FeatureIndex",un,{omit:["rawTileData","sourceLayerCoder"]}),x.PerformanceMarkers=void 0,(r=x.PerformanceMarkers||(x.PerformanceMarkers={})).create="create",r.load="load",r.fullLoad="fullLoad";let a=null,d=[];const g=1e3/30,E={mark(i){performance.mark(i)},frame(i){const t=i;a!=null&&d.push(t-a),a=t},clearMetrics(){a=null,d=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const i in x.PerformanceMarkers)performance.clearMarks(x.PerformanceMarkers[i])},getPerformanceMetrics(){performance.measure("loadTime",x.PerformanceMarkers.create,x.PerformanceMarkers.load),performance.measure("fullLoadTime",x.PerformanceMarkers.create,x.PerformanceMarkers.fullLoad);const i=performance.getEntriesByName("loadTime")[0].duration,t=performance.getEntriesByName("fullLoadTime")[0].duration,o=d.length,l=1/(d.reduce((m,_)=>m+_,0)/o/1e3),p=d.filter(m=>m>g).reduce((m,_)=>m+(_-g)/g,0);return{loadTime:i,fullLoadTime:t,fps:l,percentDroppedFrames:p/(o+p)*100}}};x.AJAXError=ii,x.ARRAY_TYPE=vl,x.Actor=class{constructor(i,t,o){this.target=i,this.parent=t,this.mapId=o,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},zt(["receive","process"],this),this.invoker=new up(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Lr()?i:window}send(i,t,o,l,p=!1){const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(this.callbacks[m]=o);const _=nr(this.globalScope)?void 0:[];return this.target.postMessage({id:m,type:i,hasCallback:!!o,targetMapId:l,mustQueue:p,sourceMapId:this.mapId,data:Ho(t,_)},_),{cancel:()=>{o&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(i){const t=i.data,o=t.id;if(o&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){delete this.tasks[o];const l=this.cancelCallbacks[o];delete this.cancelCallbacks[o],l&&l()}else Lr()||t.mustQueue?(this.tasks[o]=t,this.taskQueue.push(o),this.invoker.trigger()):this.processTask(o,t)}process(){if(!this.taskQueue.length)return;const i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){if(t.type==="<response>"){const o=this.callbacks[i];delete this.callbacks[i],o&&(t.error?o(Mo(t.error)):o(null,Mo(t.data)))}else{let o=!1;const l=nr(this.globalScope)?void 0:[],p=t.hasCallback?(T,C)=>{o=!0,delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:T?Ho(T):null,data:Ho(C,l)},l)}:T=>{o=!0};let m=null;const _=Mo(t.data);if(this.parent[t.type])m=this.parent[t.type](t.sourceMapId,_,p);else if(this.parent.getWorkerSource){const T=t.type.split(".");m=this.parent.getWorkerSource(t.sourceMapId,T[0],_.source)[T[1]](_,p)}else p(new Error(`Could not find function ${t.type}`));!o&&m&&m.cancel&&(this.cancelCallbacks[i]=m.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},x.AlphaImage=Zu,x.CanonicalTileID=Bu,x.CollisionBoxArray=et,x.CollisionCircleLayoutArray=class extends ${},x.Color=U,x.DEMData=Ch,x.DataConstantProperty=Vt,x.DictionaryCoder=zh,x.EXTENT=zi,x.ErrorEvent=fn,x.EvaluationParameters=or,x.Event=Gn,x.Evented=xa,x.FeatureIndex=un,x.FillBucket=uh,x.FillExtrusionBucket=hh,x.GeoJSONFeature=cp,x.ImageAtlas=gh,x.ImagePosition=yh,x.LineBucket=ph,x.LineStripIndexArray=class extends Xe{},x.LngLat=Ur,x.LngLatBounds=Al,x.MercatorCoordinate=Da,x.ONE_EM=zn,x.OverscaledTileID=_o,x.PerformanceUtils=E,x.PosArray=class extends Or{},x.Properties=mr,x.QuadTriangleArray=class extends re{},x.RGBAImage=_a,x.RasterBoundsArray=class extends Bn{},x.RequestPerformance=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},x.ResourceType=jn,x.SegmentVector=me,x.SymbolBucket=nu,x.Transitionable=Lo,x.TriangleIndexArray=ue,x.Uniform1f=Ai,x.Uniform1i=class extends Gt{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},x.Uniform2f=class extends Gt{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},x.Uniform3f=class extends Gt{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},x.Uniform4f=Ft,x.UniformColor=ai,x.UniformMatrix4f=class extends Gt{constructor(i,t){super(i,t),this.current=wi}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},x.UnwrappedTileID=Vc,x.ValidationError=Lt,x.ZoomHistory=Vs,x.addDynamicAttributes=Th,x.asyncAll=function(i,t,o){if(!i.length)return o(null,[]);let l=i.length;const p=new Array(i.length);let m=null;i.forEach((_,T)=>{t(_,(C,k)=>{C&&(m=C),p[T]=k,--l==0&&o(m,p)})})},x.bezier=Ke,x.bindAll=zt,x.cacheEntryPossiblyAdded=function(i){Nn++,Nn>kn&&(i.getActor().send("enforceCacheSizeLimit",bn),Nn=0)},x.clamp=Se,x.clearTileCache=function(i){const t=caches.delete(Co);i&&t.catch(i).then(()=>i())},x.clipLine=iu,x.clone=function(i){var t=new vl(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},x.clone$1=Ht,x.collisionCircleLayout=Kh,x.config=oo,x.create=function(){var i=new vl(16);return vl!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},x.createExpression=Xo,x.createFilter=za,x.createLayout=Tt,x.createStyleLayer=function(i){return i.type==="custom"?new gr(i):new lp[i.type](i)},x.dot=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]},x.ease=Qe,x.emitValidationErrors=pa,x.enforceCacheSizeLimit=function(i){Vn(),rn&&rn.then(t=>{t.keys().then(o=>{for(let l=0;l<o.length-i;l++)t.delete(o[l])})})},x.evaluateSizeForFeature=function(i,{uSize:t,uSizeT:o},{lowerSize:l,upperSize:p}){return i.kind==="source"?l/xs:i.kind==="composite"?Vr(l/xs,p/xs,o):t},x.evaluateSizeForZoom=function(i,t){let o=0,l=0;if(i.kind==="constant")l=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:p,minZoom:m,maxZoom:_}=i,T=p?Se(sn.interpolationFactor(p,t,m,_),0,1):0;i.kind==="camera"?l=Vr(i.minSize,i.maxSize,T):o=T}return{uSizeT:o,uSize:l}},x.evaluateVariableOffset=Lu,x.evented=fa,x.exported=Fo,x.exported$1=ao,x.extend=yt,x.filterObject=mi,x.getAnchorAlignment=kc,x.getAnchorJustification=Wi,x.getArrayBuffer=vo,x.getImage=Vo,x.getJSON=function(i,t){return nn(yt(i,{type:"json"}),t)},x.getOverlapMode=Il,x.getRTLTextPluginStatus=js,x.getReferrer=Mn,x.getVideo=function(i,t){const o=window.document.createElement("video");o.muted=!0,o.onloadstart=function(){t(null,o)};for(let l=0;l<i.length;l++){const p=window.document.createElement("source");qn(i[l])||(o.crossOrigin="Anonymous"),p.src=i[l],o.appendChild(p)}return{cancel:()=>{}}},x.identity=xl,x.invert=function(i,t){var o=t[0],l=t[1],p=t[2],m=t[3],_=t[4],T=t[5],C=t[6],k=t[7],R=t[8],D=t[9],V=t[10],G=t[11],Z=t[12],ee=t[13],ae=t[14],we=t[15],ke=o*T-l*_,Re=o*C-p*_,Be=o*k-m*_,$e=l*C-p*T,Oe=l*k-m*T,dt=p*k-m*C,ht=R*ee-D*Z,Ye=R*ae-V*Z,ct=R*we-G*Z,nt=D*ae-V*ee,ft=D*we-G*ee,tt=V*we-G*ae,at=ke*tt-Re*ft+Be*nt+$e*ct-Oe*Ye+dt*ht;return at?(i[0]=(T*tt-C*ft+k*nt)*(at=1/at),i[1]=(p*ft-l*tt-m*nt)*at,i[2]=(ee*dt-ae*Oe+we*$e)*at,i[3]=(V*Oe-D*dt-G*$e)*at,i[4]=(C*ct-_*tt-k*Ye)*at,i[5]=(o*tt-p*ct+m*Ye)*at,i[6]=(ae*Be-Z*dt-we*Re)*at,i[7]=(R*dt-V*Be+G*Re)*at,i[8]=(_*ft-T*ct+k*ht)*at,i[9]=(l*ct-o*ft-m*ht)*at,i[10]=(Z*Oe-ee*Be+we*ke)*at,i[11]=(D*Be-R*Oe-G*ke)*at,i[12]=(T*Ye-_*nt-C*ht)*at,i[13]=(o*nt-l*Ye+p*ht)*at,i[14]=(ee*Re-Z*$e-ae*ke)*at,i[15]=(R*$e-D*Re+V*ke)*at,i):null},x.isImageBitmap=Ar,x.isSafari=nr,x.keysDifference=function(i,t){const o=[];for(const l in i)l in t||o.push(l);return o},x.lazyLoadRTLTextPlugin=function(){fr.isLoading()||fr.isLoaded()||js()!=="deferred"||Rn()},x.makeRequest=nn,x.mapObject=Ei,x.mercatorXfromLng=zl,x.mercatorYfromLat=Ah,x.mercatorZfromAltitude=jr,x.mul=wc,x.multiply=bc,x.nextPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},x.number=Vr,x.ortho=function(i,t,o,l,p,m,_){var T=1/(t-o),C=1/(l-p),k=1/(m-_);return i[0]=-2*T,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*C,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*k,i[11]=0,i[12]=(t+o)*T,i[13]=(p+l)*C,i[14]=(_+m)*k,i[15]=1,i},x.parseCacheControl=lr,x.parseGlyphPBF=function(i){return new dh(i).readFields(zc,[])},x.pbf=dh,x.performSymbolLayout=function(i,t,o,l,p,m,_){i.createArrays(),i.tilePixelRatio=zi/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const T=i.layers[0].layout,C=i.layers[0]._unevaluatedLayout._values,k={layoutIconSize:C["icon-size"].possiblyEvaluate(new or(i.zoom+1),_),layoutTextSize:C["text-size"].possiblyEvaluate(new or(i.zoom+1),_),textMaxSize:C["text-size"].possiblyEvaluate(new or(18))};if(i.textSizeData.kind==="composite"){const{minZoom:Z,maxZoom:ee}=i.textSizeData;k.compositeTextSizes=[C["text-size"].possiblyEvaluate(new or(Z),_),C["text-size"].possiblyEvaluate(new or(ee),_)]}if(i.iconSizeData.kind==="composite"){const{minZoom:Z,maxZoom:ee}=i.iconSizeData;k.compositeIconSizes=[C["icon-size"].possiblyEvaluate(new or(Z),_),C["icon-size"].possiblyEvaluate(new or(ee),_)]}const R=T.get("text-line-height")*zn,D=T.get("text-rotation-alignment")!=="viewport"&&T.get("symbol-placement")!=="point",V=T.get("text-keep-upright"),G=T.get("text-size");for(const Z of i.features){const ee=T.get("text-font").evaluate(Z,{},_).join(","),ae=G.evaluate(Z,{},_),we=k.layoutTextSize.evaluate(Z,{},_),ke=k.layoutIconSize.evaluate(Z,{},_),Re={horizontal:{},vertical:void 0},Be=Z.text;let $e,Oe=[0,0];if(Be){const Ye=Be.toString(),ct=T.get("text-letter-spacing").evaluate(Z,{},_)*zn,nt=fs(Ye)?ct:0,ft=T.get("text-anchor").evaluate(Z,{},_),tt=T.get("text-variable-anchor");if(!tt){const ri=T.get("text-radial-offset").evaluate(Z,{},_);Oe=ri?Lu(ft,[ri*zn,Sl]):T.get("text-offset").evaluate(Z,{},_).map(vi=>vi*zn)}let at=D?"center":T.get("text-justify").evaluate(Z,{},_);const Bt=T.get("symbol-placement"),Dt=Bt==="point"?T.get("text-max-width").evaluate(Z,{},_)*zn:0,Qt=()=>{i.allowVerticalPlacement&&Ka(Ye)&&(Re.vertical=ic(Be,t,o,p,ee,Dt,R,ft,"left",nt,Oe,x.WritingMode.vertical,!0,Bt,we,ae))};if(!D&&tt){const ri=at==="auto"?tt.map(Ci=>Wi(Ci)):[at];let vi=!1;for(let Ci=0;Ci<ri.length;Ci++){const Ui=ri[Ci];if(!Re.horizontal[Ui])if(vi)Re.horizontal[Ui]=Re.horizontal[0];else{const Vi=ic(Be,t,o,p,ee,Dt,R,"center",Ui,nt,Oe,x.WritingMode.horizontal,!1,Bt,we,ae);Vi&&(Re.horizontal[Ui]=Vi,vi=Vi.positionedLines.length===1)}}Qt()}else{at==="auto"&&(at=Wi(ft));const ri=ic(Be,t,o,p,ee,Dt,R,ft,at,nt,Oe,x.WritingMode.horizontal,!1,Bt,we,ae);ri&&(Re.horizontal[at]=ri),Qt(),Ka(Ye)&&D&&V&&(Re.vertical=ic(Be,t,o,p,ee,Dt,R,ft,at,nt,Oe,x.WritingMode.vertical,!1,Bt,we,ae))}}let dt=!1;if(Z.icon&&Z.icon.name){const Ye=l[Z.icon.name];Ye&&($e=cd(p[Z.icon.name],T.get("icon-offset").evaluate(Z,{},_),T.get("icon-anchor").evaluate(Z,{},_)),dt=!!Ye.sdf,i.sdfIcons===void 0?i.sdfIcons=dt:i.sdfIcons!==dt&&pi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ye.pixelRatio!==i.pixelRatio||T.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const ht=op(Re.horizontal)||Re.vertical;i.iconsInText=!!ht&&ht.iconsInText,(ht||$e)&&md(i,Z,Re,$e,l,k,we,ke,Oe,dt,_)}m&&i.generateCollisionDebugBuffers()},x.perspective=function(i,t,o,l,p){var m,_=1/Math.tan(t/2);return i[0]=_/o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=_,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,p!=null&&p!==1/0?(i[10]=(p+l)*(m=1/(l-p)),i[14]=2*p*l*m):(i[10]=-1,i[14]=-2*l),i},x.pick=function(i,t){const o={};for(let l=0;l<t.length;l++){const p=t[l];p in i&&(o[p]=i[p])}return o},x.plugin=fr,x.pointGeometry=Yt,x.polygonIntersectsPolygon=yl,x.potpack=mh,x.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],x.register=kt,x.registerForPluginStateChange=function(i){return i({pluginStatus:cr,pluginURL:Ko}),fa.on("pluginStateChange",i),i},x.renderColorRamp=Fh,x.rotateX=function(i,t,o){var l=Math.sin(o),p=Math.cos(o),m=t[4],_=t[5],T=t[6],C=t[7],k=t[8],R=t[9],D=t[10],V=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=m*p+k*l,i[5]=_*p+R*l,i[6]=T*p+D*l,i[7]=C*p+V*l,i[8]=k*p-m*l,i[9]=R*p-_*l,i[10]=D*p-T*l,i[11]=V*p-C*l,i},x.rotateZ=function(i,t,o){var l=Math.sin(o),p=Math.cos(o),m=t[0],_=t[1],T=t[2],C=t[3],k=t[4],R=t[5],D=t[6],V=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=m*p+k*l,i[1]=_*p+R*l,i[2]=T*p+D*l,i[3]=C*p+V*l,i[4]=k*p-m*l,i[5]=R*p-_*l,i[6]=D*p-T*l,i[7]=V*p-C*l,i},x.scale=function(i,t,o){var l=o[0],p=o[1],m=o[2];return i[0]=t[0]*l,i[1]=t[1]*l,i[2]=t[2]*l,i[3]=t[3]*l,i[4]=t[4]*p,i[5]=t[5]*p,i[6]=t[6]*p,i[7]=t[7]*p,i[8]=t[8]*m,i[9]=t[9]*m,i[10]=t[10]*m,i[11]=t[11]*m,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},x.scale$1=function(i,t,o){return i[0]=t[0]*o,i[1]=t[1]*o,i[2]=t[2]*o,i[3]=t[3]*o,i},x.setCacheLimits=function(i,t){bn=i,kn=t},x.setRTLTextPlugin=function(i,t,o=!1){if(cr===gn||cr===ys||cr===ka)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ko=Fo.resolveURL(i),cr=gn,yo=t,Ns(),o||Rn()},x.spec=ot,x.sphericalToCartesian=function([i,t,o]){return t+=90,t*=Math.PI/180,o*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(o),y:i*Math.sin(t)*Math.sin(o),z:i*Math.cos(o)}},x.toEvaluationFeature=Wr,x.transformMat4=es,x.translate=function(i,t,o){var l,p,m,_,T,C,k,R,D,V,G,Z,ee=o[0],ae=o[1],we=o[2];return t===i?(i[12]=t[0]*ee+t[4]*ae+t[8]*we+t[12],i[13]=t[1]*ee+t[5]*ae+t[9]*we+t[13],i[14]=t[2]*ee+t[6]*ae+t[10]*we+t[14],i[15]=t[3]*ee+t[7]*ae+t[11]*we+t[15]):(p=t[1],m=t[2],_=t[3],T=t[4],C=t[5],k=t[6],R=t[7],D=t[8],V=t[9],G=t[10],Z=t[11],i[0]=l=t[0],i[1]=p,i[2]=m,i[3]=_,i[4]=T,i[5]=C,i[6]=k,i[7]=R,i[8]=D,i[9]=V,i[10]=G,i[11]=Z,i[12]=l*ee+T*ae+D*we+t[12],i[13]=p*ee+C*ae+V*we+t[13],i[14]=m*ee+k*ae+G*we+t[14],i[15]=_*ee+R*ae+Z*we+t[15]),i},x.triggerPluginCompletionEvent=St,x.unicodeBlockLookup=Ot,x.uniqueId=function(){return ti++},x.validateCustomStyleLayer=function(i){const t=[],o=i.id;return o===void 0&&t.push({message:`layers.${o}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${o}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),t},x.validateLight=ur,x.validateStyle=mo,x.vectorTile=wl,x.warnOnce=pi,x.wrap=It}),Ae(["./shared"],function(x){function he(Q){const F=typeof Q;if(F==="number"||F==="boolean"||F==="string"||Q==null)return JSON.stringify(Q);if(Array.isArray(Q)){let ne="[";for(const de of Q)ne+=`${he(de)},`;return`${ne}]`}const U=Object.keys(Q).sort();let J="{";for(let ne=0;ne<U.length;ne++)J+=`${JSON.stringify(U[ne])}:${he(Q[U[ne]])},`;return`${J}}`}function it(Q){let F="";for(const U of x.refProperties)F+=`/${he(Q[U])}`;return F}class Ke{constructor(F){this.keyCache={},F&&this.replace(F)}replace(F){this._layerConfigs={},this._layers={},this.update(F,[])}update(F,U){for(const ne of F){this._layerConfigs[ne.id]=ne;const de=this._layers[ne.id]=x.createStyleLayer(ne);de._featureFilter=x.createFilter(de.filter),this.keyCache[ne.id]&&delete this.keyCache[ne.id]}for(const ne of U)delete this.keyCache[ne],delete this._layerConfigs[ne],delete this._layers[ne];this.familiesBySource={};const J=function(ne,de){const le={};for(let ge=0;ge<ne.length;ge++){const ve=de&&de[ne[ge].id]||it(ne[ge]);de&&(de[ne[ge].id]=ve);let Ge=le[ve];Ge||(Ge=le[ve]=[]),Ge.push(ne[ge])}const _e=[];for(const ge in le)_e.push(le[ge]);return _e}(Object.values(this._layerConfigs),this.keyCache);for(const ne of J){const de=ne.map(Ue=>this._layers[Ue.id]),le=de[0];if(le.visibility==="none")continue;const _e=le.source||"";let ge=this.familiesBySource[_e];ge||(ge=this.familiesBySource[_e]={});const ve=le.sourceLayer||"_geojsonTileLayer";let Ge=ge[ve];Ge||(Ge=ge[ve]=[]),Ge.push(de)}}}class Qe{constructor(F){const U={},J=[];for(const _e in F){const ge=F[_e],ve=U[_e]={};for(const Ge in ge){const Ue=ge[+Ge];if(!Ue||Ue.bitmap.width===0||Ue.bitmap.height===0)continue;const Ze={x:0,y:0,w:Ue.bitmap.width+2,h:Ue.bitmap.height+2};J.push(Ze),ve[Ge]={rect:Ze,metrics:Ue.metrics}}}const{w:ne,h:de}=x.potpack(J),le=new x.AlphaImage({width:ne||1,height:de||1});for(const _e in F){const ge=F[_e];for(const ve in ge){const Ge=ge[+ve];if(!Ge||Ge.bitmap.width===0||Ge.bitmap.height===0)continue;const Ue=U[_e][ve].rect;x.AlphaImage.copy(Ge.bitmap,le,{x:0,y:0},{x:Ue.x+1,y:Ue.y+1},Ge.bitmap)}}this.image=le,this.positions=U}}x.register("GlyphAtlas",Qe);class Se{constructor(F){this.tileID=new x.OverscaledTileID(F.tileID.overscaledZ,F.tileID.wrap,F.tileID.canonical.z,F.tileID.canonical.x,F.tileID.canonical.y),this.uid=F.uid,this.zoom=F.zoom,this.pixelRatio=F.pixelRatio,this.tileSize=F.tileSize,this.source=F.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=F.showCollisionBoxes,this.collectResourceTiming=!!F.collectResourceTiming,this.returnDependencies=!!F.returnDependencies,this.promoteId=F.promoteId}parse(F,U,J,ne,de){this.status="parsing",this.data=F,this.collisionBoxArray=new x.CollisionBoxArray;const le=new x.DictionaryCoder(Object.keys(F.layers).sort()),_e=new x.FeatureIndex(this.tileID,this.promoteId);_e.bucketLayerIDs=[];const ge={},ve={featureIndex:_e,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:J},Ge=U.familiesBySource[this.source];for(const Jt in Ge){const Nt=F.layers[Jt];if(!Nt)continue;Nt.version===1&&x.warnOnce(`Vector tile source "${this.source}" layer "${Jt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Pt=le.encode(Jt),oi=[];for(let Oi=0;Oi<Nt.length;Oi++){const Cr=Nt.feature(Oi),Fi=_e.getId(Cr,Jt);oi.push({feature:Cr,id:Fi,index:Oi,sourceLayerIndex:Pt})}for(const Oi of Ge[Jt]){const Cr=Oi[0];Cr.minzoom&&this.zoom<Math.floor(Cr.minzoom)||Cr.maxzoom&&this.zoom>=Cr.maxzoom||Cr.visibility!=="none"&&(It(Oi,this.zoom,J),(ge[Cr.id]=Cr.createBucket({index:_e.bucketLayerIDs.length,layers:Oi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Pt,sourceID:this.source})).populate(oi,ve,this.tileID.canonical),_e.bucketLayerIDs.push(Oi.map(Fi=>Fi.id)))}}let Ue,Ze,bt,pt;const vt=x.mapObject(ve.glyphDependencies,Jt=>Object.keys(Jt).map(Number));Object.keys(vt).length?ne.send("getGlyphs",{uid:this.uid,stacks:vt},(Jt,Nt)=>{Ue||(Ue=Jt,Ze=Nt,$t.call(this))}):Ze={};const Et=Object.keys(ve.iconDependencies);Et.length?ne.send("getImages",{icons:Et,source:this.source,tileID:this.tileID,type:"icons"},(Jt,Nt)=>{Ue||(Ue=Jt,bt=Nt,$t.call(this))}):bt={};const di=Object.keys(ve.patternDependencies);function $t(){if(Ue)return de(Ue);if(Ze&&bt&&pt){const Jt=new Qe(Ze),Nt=new x.ImageAtlas(bt,pt);for(const Pt in ge){const oi=ge[Pt];oi instanceof x.SymbolBucket?(It(oi.layers,this.zoom,J),x.performSymbolLayout(oi,Ze,Jt.positions,bt,Nt.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):oi.hasPattern&&(oi instanceof x.LineBucket||oi instanceof x.FillBucket||oi instanceof x.FillExtrusionBucket)&&(It(oi.layers,this.zoom,J),oi.addFeatures(ve,this.tileID.canonical,Nt.patternPositions))}this.status="done",de(null,{buckets:Object.values(ge).filter(Pt=>!Pt.isEmpty()),featureIndex:_e,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Jt.image,imageAtlas:Nt,glyphMap:this.returnDependencies?Ze:null,iconMap:this.returnDependencies?bt:null,glyphPositions:this.returnDependencies?Jt.positions:null})}}di.length?ne.send("getImages",{icons:di,source:this.source,tileID:this.tileID,type:"patterns"},(Jt,Nt)=>{Ue||(Ue=Jt,pt=Nt,$t.call(this))}):pt={},$t.call(this)}}function It(Q,F,U){const J=new x.EvaluationParameters(F);for(const ne of Q)ne.recalculate(J,U)}function yt(Q,F){const U=x.getArrayBuffer(Q.request,(J,ne,de,le)=>{J?F(J):ne&&F(null,{vectorTile:new x.vectorTile.VectorTile(new x.pbf(ne)),rawData:ne,cacheControl:de,expires:le})});return()=>{U.cancel(),F()}}class ti{constructor(F,U,J,ne){this.actor=F,this.layerIndex=U,this.availableImages=J,this.loadVectorData=ne||yt,this.loading={},this.loaded={}}loadTile(F,U){const J=F.uid;this.loading||(this.loading={});const ne=!!(F&&F.request&&F.request.collectResourceTiming)&&new x.RequestPerformance(F.request),de=this.loading[J]=new Se(F);de.abort=this.loadVectorData(F,(le,_e)=>{if(delete this.loading[J],le||!_e)return de.status="done",this.loaded[J]=de,U(le);const ge=_e.rawData,ve={};_e.expires&&(ve.expires=_e.expires),_e.cacheControl&&(ve.cacheControl=_e.cacheControl);const Ge={};if(ne){const Ue=ne.finish();Ue&&(Ge.resourceTiming=JSON.parse(JSON.stringify(Ue)))}de.vectorTile=_e.vectorTile,de.parse(_e.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ue,Ze)=>{if(Ue||!Ze)return U(Ue);U(null,x.extend({rawTileData:ge.slice(0)},Ze,ve,Ge))}),this.loaded=this.loaded||{},this.loaded[J]=de})}reloadTile(F,U){const J=this.loaded,ne=F.uid,de=this;if(J&&J[ne]){const le=J[ne];le.showCollisionBoxes=F.showCollisionBoxes;const _e=(ge,ve)=>{const Ge=le.reloadCallback;Ge&&(delete le.reloadCallback,le.parse(le.vectorTile,de.layerIndex,this.availableImages,de.actor,Ge)),U(ge,ve)};le.status==="parsing"?le.reloadCallback=_e:le.status==="done"&&(le.vectorTile?le.parse(le.vectorTile,this.layerIndex,this.availableImages,this.actor,_e):_e())}}abortTile(F,U){const J=this.loading,ne=F.uid;J&&J[ne]&&J[ne].abort&&(J[ne].abort(),delete J[ne]),U()}removeTile(F,U){const J=this.loaded,ne=F.uid;J&&J[ne]&&delete J[ne],U()}}class zt{constructor(){this.loaded={}}loadTile(F,U){const{uid:J,encoding:ne,rawImageData:de}=F,le=x.isImageBitmap(de)?this.getImageData(de):de,_e=new x.DEMData(J,le,ne);this.loaded=this.loaded||{},this.loaded[J]=_e,U(null,_e)}getImageData(F){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(F.width,F.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=F.width,this.offscreenCanvas.height=F.height,this.offscreenCanvasContext.drawImage(F,0,0,F.width,F.height);const U=this.offscreenCanvasContext.getImageData(-1,-1,F.width+2,F.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new x.RGBAImage({width:U.width,height:U.height},U.data)}removeTile(F){const U=this.loaded,J=F.uid;U&&U[J]&&delete U[J]}}var Ei=function Q(F,U){var J,ne=F&&F.type;if(ne==="FeatureCollection")for(J=0;J<F.features.length;J++)Q(F.features[J],U);else if(ne==="GeometryCollection")for(J=0;J<F.geometries.length;J++)Q(F.geometries[J],U);else if(ne==="Feature")Q(F.geometry,U);else if(ne==="Polygon")mi(F.coordinates,U);else if(ne==="MultiPolygon")for(J=0;J<F.coordinates.length;J++)mi(F.coordinates[J],U);return F};function mi(Q,F){if(Q.length!==0){Ht(Q[0],F);for(var U=1;U<Q.length;U++)Ht(Q[U],!F)}}function Ht(Q,F){for(var U=0,J=0,ne=0,de=Q.length,le=de-1;ne<de;le=ne++){var _e=(Q[ne][0]-Q[le][0])*(Q[le][1]+Q[ne][1]),ge=U+_e;J+=Math.abs(U)>=Math.abs(_e)?U-ge+_e:_e-ge+U,U=ge}U+J>=0!=!!F&&Q.reverse()}const br=x.vectorTile.VectorTileFeature.prototype.toGeoJSON;class pi{constructor(F){this._feature=F,this.extent=x.EXTENT,this.type=F.type,this.properties=F.tags,"id"in F&&!isNaN(F.id)&&(this.id=parseInt(F.id,10))}loadGeometry(){if(this._feature.type===1){const F=[];for(const U of this._feature.geometry)F.push([new x.pointGeometry(U[0],U[1])]);return F}{const F=[];for(const U of this._feature.geometry){const J=[];for(const ne of U)J.push(new x.pointGeometry(ne[0],ne[1]));F.push(J)}return F}}toGeoJSON(F,U,J){return br.call(this,F,U,J)}}class Si{constructor(F){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=x.EXTENT,this.length=F.length,this._features=F}feature(F){return new pi(this._features[F])}}var Ni={exports:{}},Lr=x.pointGeometry,lr=x.vectorTile.VectorTileFeature,Fn=hn;function hn(Q,F){this.options=F||{},this.features=Q,this.length=Q.length}function no(Q,F){this.id=typeof Q.id=="number"?Q.id:void 0,this.type=Q.type,this.rawGeometry=Q.type===1?[Q.geometry]:Q.geometry,this.properties=Q.tags,this.extent=F||4096}hn.prototype.feature=function(Q){return new no(this.features[Q],this.options.extent)},no.prototype.loadGeometry=function(){var Q=this.rawGeometry;this.geometry=[];for(var F=0;F<Q.length;F++){for(var U=Q[F],J=[],ne=0;ne<U.length;ne++)J.push(new Lr(U[ne][0],U[ne][1]));this.geometry.push(J)}return this.geometry},no.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Q=this.geometry,F=1/0,U=-1/0,J=1/0,ne=-1/0,de=0;de<Q.length;de++)for(var le=Q[de],_e=0;_e<le.length;_e++){var ge=le[_e];F=Math.min(F,ge.x),U=Math.max(U,ge.x),J=Math.min(J,ge.y),ne=Math.max(ne,ge.y)}return[F,J,U,ne]},no.prototype.toGeoJSON=lr.prototype.toGeoJSON;var nr=x.pbf,Ar=Fn;function Fo(Q){var F=new nr;return function(U,J){for(var ne in U.layers)J.writeMessage(3,Yt,U.layers[ne])}(Q,F),F.finish()}function Yt(Q,F){var U;F.writeVarintField(15,Q.version||1),F.writeStringField(1,Q.name||""),F.writeVarintField(5,Q.extent||4096);var J={keys:[],values:[],keycache:{},valuecache:{}};for(U=0;U<Q.length;U++)J.feature=Q.feature(U),F.writeMessage(2,Un,J);var ne=J.keys;for(U=0;U<ne.length;U++)F.writeStringField(3,ne[U]);var de=J.values;for(U=0;U<de.length;U++)F.writeMessage(4,bn,de[U])}function Un(Q,F){var U=Q.feature;U.id!==void 0&&F.writeVarintField(1,U.id),F.writeMessage(2,oo,Q),F.writeVarintField(3,U.type),F.writeMessage(4,pn,U)}function oo(Q,F){var U=Q.feature,J=Q.keys,ne=Q.values,de=Q.keycache,le=Q.valuecache;for(var _e in U.properties){var ge=U.properties[_e],ve=de[_e];if(ge!==null){ve===void 0&&(J.push(_e),de[_e]=ve=J.length-1),F.writeVarint(ve);var Ge=typeof ge;Ge!=="string"&&Ge!=="boolean"&&Ge!=="number"&&(ge=JSON.stringify(ge));var Ue=Ge+":"+ge,Ze=le[Ue];Ze===void 0&&(ne.push(ge),le[Ue]=Ze=ne.length-1),F.writeVarint(Ze)}}}function Co(Q,F){return(F<<3)+(7&Q)}function rn(Q){return Q<<1^Q>>31}function pn(Q,F){for(var U=Q.loadGeometry(),J=Q.type,ne=0,de=0,le=U.length,_e=0;_e<le;_e++){var ge=U[_e],ve=1;J===1&&(ve=ge.length),F.writeVarint(Co(1,ve));for(var Ge=J===3?ge.length-1:ge.length,Ue=0;Ue<Ge;Ue++){Ue===1&&J!==1&&F.writeVarint(Co(2,Ge-1));var Ze=ge[Ue].x-ne,bt=ge[Ue].y-de;F.writeVarint(rn(Ze)),F.writeVarint(rn(bt)),ne+=Ze,de+=bt}J===3&&F.writeVarint(Co(7,1))}}function bn(Q,F){var U=typeof Q;U==="string"?F.writeStringField(1,Q):U==="boolean"?F.writeBooleanField(7,Q):U==="number"&&(Q%1!=0?F.writeDoubleField(3,Q):Q<0?F.writeSVarintField(6,Q):F.writeVarintField(5,Q))}Ni.exports=Fo,Ni.exports.fromVectorTileJs=Fo,Ni.exports.fromGeojsonVt=function(Q,F){F=F||{};var U={};for(var J in Q)U[J]=new Ar(Q[J].features,F),U[J].name=J,U[J].version=F.version,U[J].extent=F.extent;return Fo({layers:U})},Ni.exports.GeoJSONWrapper=Ar;var kn=Ni.exports;function Vn(Q,F,U,J,ne,de){if(ne-J<=U)return;const le=J+ne>>1;Nn(Q,F,le,J,ne,de%2),Vn(Q,F,U,J,le-1,de+1),Vn(Q,F,U,le+1,ne,de+1)}function Nn(Q,F,U,J,ne,de){for(;ne>J;){if(ne-J>600){const ve=ne-J+1,Ge=U-J+1,Ue=Math.log(ve),Ze=.5*Math.exp(2*Ue/3),bt=.5*Math.sqrt(Ue*Ze*(ve-Ze)/ve)*(Ge-ve/2<0?-1:1);Nn(Q,F,U,Math.max(J,Math.floor(U-Ge*Ze/ve+bt)),Math.min(ne,Math.floor(U+(ve-Ge)*Ze/ve+bt)),de)}const le=F[2*U+de];let _e=J,ge=ne;for(ao(Q,F,J,U),F[2*ne+de]>le&&ao(Q,F,J,ne);_e<ge;){for(ao(Q,F,_e,ge),_e++,ge--;F[2*_e+de]<le;)_e++;for(;F[2*ge+de]>le;)ge--}F[2*J+de]===le?ao(Q,F,J,ge):(ge++,ao(Q,F,ge,ne)),ge<=U&&(J=ge+1),U<=ge&&(ne=ge-1)}}function ao(Q,F,U,J){_r(Q,U,J),_r(F,2*U,2*J),_r(F,2*U+1,2*J+1)}function _r(Q,F,U){const J=Q[F];Q[F]=Q[U],Q[U]=J}function dn(Q,F,U,J){const ne=Q-U,de=F-J;return ne*ne+de*de}const Bi=Q=>Q[0],so=Q=>Q[1];class Uo{constructor(F,U=Bi,J=so,ne=64,de=Float64Array){this.nodeSize=ne,this.points=F;const le=F.length<65536?Uint16Array:Uint32Array,_e=this.ids=new le(F.length),ge=this.coords=new de(2*F.length);for(let ve=0;ve<F.length;ve++)_e[ve]=ve,ge[2*ve]=U(F[ve]),ge[2*ve+1]=J(F[ve]);Vn(_e,ge,ne,0,_e.length-1,0)}range(F,U,J,ne){return function(de,le,_e,ge,ve,Ge,Ue){const Ze=[0,de.length-1,0],bt=[];let pt,vt;for(;Ze.length;){const Et=Ze.pop(),di=Ze.pop(),$t=Ze.pop();if(di-$t<=Ue){for(let Pt=$t;Pt<=di;Pt++)pt=le[2*Pt],vt=le[2*Pt+1],pt>=_e&&pt<=ve&&vt>=ge&&vt<=Ge&&bt.push(de[Pt]);continue}const Jt=Math.floor(($t+di)/2);pt=le[2*Jt],vt=le[2*Jt+1],pt>=_e&&pt<=ve&&vt>=ge&&vt<=Ge&&bt.push(de[Jt]);const Nt=(Et+1)%2;(Et===0?_e<=pt:ge<=vt)&&(Ze.push($t),Ze.push(Jt-1),Ze.push(Nt)),(Et===0?ve>=pt:Ge>=vt)&&(Ze.push(Jt+1),Ze.push(di),Ze.push(Nt))}return bt}(this.ids,this.coords,F,U,J,ne,this.nodeSize)}within(F,U,J){return function(ne,de,le,_e,ge,ve){const Ge=[0,ne.length-1,0],Ue=[],Ze=ge*ge;for(;Ge.length;){const bt=Ge.pop(),pt=Ge.pop(),vt=Ge.pop();if(pt-vt<=ve){for(let Nt=vt;Nt<=pt;Nt++)dn(de[2*Nt],de[2*Nt+1],le,_e)<=Ze&&Ue.push(ne[Nt]);continue}const Et=Math.floor((vt+pt)/2),di=de[2*Et],$t=de[2*Et+1];dn(di,$t,le,_e)<=Ze&&Ue.push(ne[Et]);const Jt=(bt+1)%2;(bt===0?le-ge<=di:_e-ge<=$t)&&(Ge.push(vt),Ge.push(Et-1),Ge.push(Jt)),(bt===0?le+ge>=di:_e+ge>=$t)&&(Ge.push(Et+1),Ge.push(pt),Ge.push(Jt))}return Ue}(this.ids,this.coords,F,U,J,this.nodeSize)}}const jn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Q=>Q},ii=Math.fround||(Mn=new Float32Array(1),Q=>(Mn[0]=+Q,Mn[0]));var Mn;class Gr{constructor(F){this.options=yi(Object.create(jn),F),this.trees=new Array(this.options.maxZoom+1)}load(F){const{log:U,minZoom:J,maxZoom:ne,nodeSize:de}=this.options;U&&console.time("total time");const le=`prepare ${F.length} points`;U&&console.time(le),this.points=F;let _e=[];for(let ge=0;ge<F.length;ge++)F[ge].geometry&&_e.push(vo(F[ge],ge));this.trees[ne+1]=new Uo(_e,on,Gn,de,Float32Array),U&&console.timeEnd(le);for(let ge=ne;ge>=J;ge--){const ve=+Date.now();_e=this._cluster(_e,ge),this.trees[ge]=new Uo(_e,on,Gn,de,Float32Array),U&&console.log("z%d: %d clusters in %dms",ge,_e.length,+Date.now()-ve)}return U&&console.timeEnd("total time"),this}getClusters(F,U){let J=((F[0]+180)%360+360)%360-180;const ne=Math.max(-90,Math.min(90,F[1]));let de=F[2]===180?180:((F[2]+180)%360+360)%360-180;const le=Math.max(-90,Math.min(90,F[3]));if(F[2]-F[0]>=360)J=-180,de=180;else if(J>de){const Ge=this.getClusters([J,ne,180,le],U),Ue=this.getClusters([-180,ne,de,le],U);return Ge.concat(Ue)}const _e=this.trees[this._limitZoom(U)],ge=_e.range(Dr(J),wn(le),Dr(de),wn(ne)),ve=[];for(const Ge of ge){const Ue=_e.points[Ge];ve.push(Ue.numPoints?qn(Ue):this.points[Ue.index])}return ve}getChildren(F){const U=this._getOriginId(F),J=this._getOriginZoom(F),ne="No cluster with the specified id.",de=this.trees[J];if(!de)throw new Error(ne);const le=de.points[U];if(!le)throw new Error(ne);const _e=this.options.radius/(this.options.extent*Math.pow(2,J-1)),ge=de.within(le.x,le.y,_e),ve=[];for(const Ge of ge){const Ue=de.points[Ge];Ue.parentId===F&&ve.push(Ue.numPoints?qn(Ue):this.points[Ue.index])}if(ve.length===0)throw new Error(ne);return ve}getLeaves(F,U,J){const ne=[];return this._appendLeaves(ne,F,U=U||10,J=J||0,0),ne}getTile(F,U,J){const ne=this.trees[this._limitZoom(F)],de=Math.pow(2,F),{extent:le,radius:_e}=this.options,ge=_e/le,ve=(J-ge)/de,Ge=(J+1+ge)/de,Ue={features:[]};return this._addTileFeatures(ne.range((U-ge)/de,ve,(U+1+ge)/de,Ge),ne.points,U,J,de,Ue),U===0&&this._addTileFeatures(ne.range(1-ge/de,ve,1,Ge),ne.points,de,J,de,Ue),U===de-1&&this._addTileFeatures(ne.range(0,ve,ge/de,Ge),ne.points,-1,J,de,Ue),Ue.features.length?Ue:null}getClusterExpansionZoom(F){let U=this._getOriginZoom(F)-1;for(;U<=this.options.maxZoom;){const J=this.getChildren(F);if(U++,J.length!==1)break;F=J[0].properties.cluster_id}return U}_appendLeaves(F,U,J,ne,de){const le=this.getChildren(U);for(const _e of le){const ge=_e.properties;if(ge&&ge.cluster?de+ge.point_count<=ne?de+=ge.point_count:de=this._appendLeaves(F,ge.cluster_id,J,ne,de):de<ne?de++:F.push(_e),F.length===J)break}return de}_addTileFeatures(F,U,J,ne,de,le){for(const _e of F){const ge=U[_e],ve=ge.numPoints;let Ge,Ue,Ze;if(ve)Ge=lo(ge),Ue=ge.x,Ze=ge.y;else{const vt=this.points[ge.index];Ge=vt.properties,Ue=Dr(vt.geometry.coordinates[0]),Ze=wn(vt.geometry.coordinates[1])}const bt={type:1,geometry:[[Math.round(this.options.extent*(Ue*de-J)),Math.round(this.options.extent*(Ze*de-ne))]],tags:Ge};let pt;ve?pt=ge.id:this.options.generateId?pt=ge.index:this.points[ge.index].id&&(pt=this.points[ge.index].id),pt!==void 0&&(bt.id=pt),le.features.push(bt)}}_limitZoom(F){return Math.max(this.options.minZoom,Math.min(+F,this.options.maxZoom+1))}_cluster(F,U){const J=[],{radius:ne,extent:de,reduce:le,minPoints:_e}=this.options,ge=ne/(de*Math.pow(2,U));for(let ve=0;ve<F.length;ve++){const Ge=F[ve];if(Ge.zoom<=U)continue;Ge.zoom=U;const Ue=this.trees[U+1],Ze=Ue.within(Ge.x,Ge.y,ge),bt=Ge.numPoints||1;let pt=bt;for(const vt of Ze){const Et=Ue.points[vt];Et.zoom>U&&(pt+=Et.numPoints||1)}if(pt>bt&&pt>=_e){let vt=Ge.x*bt,Et=Ge.y*bt,di=le&&bt>1?this._map(Ge,!0):null;const $t=(ve<<5)+(U+1)+this.points.length;for(const Jt of Ze){const Nt=Ue.points[Jt];if(Nt.zoom<=U)continue;Nt.zoom=U;const Pt=Nt.numPoints||1;vt+=Nt.x*Pt,Et+=Nt.y*Pt,Nt.parentId=$t,le&&(di||(di=this._map(Ge,!0)),le(di,this._map(Nt)))}Ge.parentId=$t,J.push(nn(vt/pt,Et/pt,$t,pt,di))}else if(J.push(Ge),pt>1)for(const vt of Ze){const Et=Ue.points[vt];Et.zoom<=U||(Et.zoom=U,J.push(Et))}}return J}_getOriginId(F){return F-this.points.length>>5}_getOriginZoom(F){return(F-this.points.length)%32}_map(F,U){if(F.numPoints)return U?yi({},F.properties):F.properties;const J=this.points[F.index].properties,ne=this.options.map(J);return U&&ne===J?yi({},ne):ne}}function nn(Q,F,U,J,ne){return{x:ii(Q),y:ii(F),zoom:1/0,id:U,parentId:-1,numPoints:J,properties:ne}}function vo(Q,F){const[U,J]=Q.geometry.coordinates;return{x:ii(Dr(U)),y:ii(wn(J)),zoom:1/0,index:F,parentId:-1}}function qn(Q){return{type:"Feature",id:Q.id,properties:lo(Q),geometry:{type:"Point",coordinates:[(F=Q.x,360*(F-.5)),Vo(Q.y)]}};var F}function lo(Q){const F=Q.numPoints,U=F>=1e4?`${Math.round(F/1e3)}k`:F>=1e3?Math.round(F/100)/10+"k":F;return yi(yi({},Q.properties),{cluster:!0,cluster_id:Q.id,point_count:F,point_count_abbreviated:U})}function Dr(Q){return Q/360+.5}function wn(Q){const F=Math.sin(Q*Math.PI/180),U=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return U<0?0:U>1?1:U}function Vo(Q){const F=(180-360*Q)*Math.PI/180;return 360*Math.atan(Math.exp(F))/Math.PI-90}function yi(Q,F){for(const U in F)Q[U]=F[U];return Q}function on(Q){return Q.x}function Gn(Q){return Q.y}function fn(Q,F,U,J){for(var ne,de=J,le=U-F>>1,_e=U-F,ge=Q[F],ve=Q[F+1],Ge=Q[U],Ue=Q[U+1],Ze=F+3;Ze<U;Ze+=3){var bt=xa(Q[Ze],Q[Ze+1],ge,ve,Ge,Ue);if(bt>de)ne=Ze,de=bt;else if(bt===de){var pt=Math.abs(Ze-le);pt<_e&&(ne=Ze,_e=pt)}}de>J&&(ne-F>3&&fn(Q,F,ne,J),Q[ne+2]=de,U-ne>3&&fn(Q,ne,U,J))}function xa(Q,F,U,J,ne,de){var le=ne-U,_e=de-J;if(le!==0||_e!==0){var ge=((Q-U)*le+(F-J)*_e)/(le*le+_e*_e);ge>1?(U=ne,J=de):ge>0&&(U+=le*ge,J+=_e*ge)}return(le=Q-U)*le+(_e=F-J)*_e}function ot(Q,F,U,J){var ne={id:Q===void 0?null:Q,type:F,geometry:U,tags:J,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(de){var le=de.geometry,_e=de.type;if(_e==="Point"||_e==="MultiPoint"||_e==="LineString")Lt(de,le);else if(_e==="Polygon"||_e==="MultiLineString")for(var ge=0;ge<le.length;ge++)Lt(de,le[ge]);else if(_e==="MultiPolygon")for(ge=0;ge<le.length;ge++)for(var ve=0;ve<le[ge].length;ve++)Lt(de,le[ge][ve])}(ne),ne}function Lt(Q,F){for(var U=0;U<F.length;U+=3)Q.minX=Math.min(Q.minX,F[U]),Q.minY=Math.min(Q.minY,F[U+1]),Q.maxX=Math.max(Q.maxX,F[U]),Q.maxY=Math.max(Q.maxY,F[U+1])}function zo(Q,F,U,J){if(F.geometry){var ne=F.geometry.coordinates,de=F.geometry.type,le=Math.pow(U.tolerance/((1<<U.maxZoom)*U.extent),2),_e=[],ge=F.id;if(U.promoteId?ge=F.properties[U.promoteId]:U.generateId&&(ge=J||0),de==="Point")Zn(ne,_e);else if(de==="MultiPoint")for(var ve=0;ve<ne.length;ve++)Zn(ne[ve],_e);else if(de==="LineString")Ki(ne,_e,le,!1);else if(de==="MultiLineString"){if(U.lineMetrics){for(ve=0;ve<ne.length;ve++)Ki(ne[ve],_e=[],le,!1),Q.push(ot(ge,"LineString",_e,F.properties));return}mn(ne,_e,le,!1)}else if(de==="Polygon")mn(ne,_e,le,!0);else{if(de!=="MultiPolygon"){if(de==="GeometryCollection"){for(ve=0;ve<F.geometry.geometries.length;ve++)zo(Q,{id:ge,geometry:F.geometry.geometries[ve],properties:F.properties},U,J);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ve=0;ve<ne.length;ve++){var Ge=[];mn(ne[ve],Ge,le,!0),_e.push(Ge)}}Q.push(ot(ge,de,_e,F.properties))}}function Zn(Q,F){F.push(Zr(Q[0])),F.push(uo(Q[1])),F.push(0)}function Ki(Q,F,U,J){for(var ne,de,le=0,_e=0;_e<Q.length;_e++){var ge=Zr(Q[_e][0]),ve=uo(Q[_e][1]);F.push(ge),F.push(ve),F.push(0),_e>0&&(le+=J?(ne*ve-ge*de)/2:Math.sqrt(Math.pow(ge-ne,2)+Math.pow(ve-de,2))),ne=ge,de=ve}var Ge=F.length-3;F[2]=1,fn(F,0,Ge,U),F[Ge+2]=1,F.size=Math.abs(le),F.start=0,F.end=F.size}function mn(Q,F,U,J){for(var ne=0;ne<Q.length;ne++){var de=[];Ki(Q[ne],de,U,J),F.push(de)}}function Zr(Q){return Q/360+.5}function uo(Q){var F=Math.sin(Q*Math.PI/180),U=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return U<0?0:U>1?1:U}function er(Q,F,U,J,ne,de,le,_e){if(J/=F,de>=(U/=F)&&le<J)return Q;if(le<U||de>=J)return null;for(var ge=[],ve=0;ve<Q.length;ve++){var Ge=Q[ve],Ue=Ge.geometry,Ze=Ge.type,bt=ne===0?Ge.minX:Ge.minY,pt=ne===0?Ge.maxX:Ge.maxY;if(bt>=U&&pt<J)ge.push(Ge);else if(!(pt<U||bt>=J)){var vt=[];if(Ze==="Point"||Ze==="MultiPoint")Ct(Ue,vt,U,J,ne);else if(Ze==="LineString")Ti(Ue,vt,U,J,ne,!1,_e.lineMetrics);else if(Ze==="MultiLineString")Rr(Ue,vt,U,J,ne,!1);else if(Ze==="Polygon")Rr(Ue,vt,U,J,ne,!0);else if(Ze==="MultiPolygon")for(var Et=0;Et<Ue.length;Et++){var di=[];Rr(Ue[Et],di,U,J,ne,!0),di.length&&vt.push(di)}if(vt.length){if(_e.lineMetrics&&Ze==="LineString"){for(Et=0;Et<vt.length;Et++)ge.push(ot(Ge.id,Ze,vt[Et],Ge.tags));continue}Ze!=="LineString"&&Ze!=="MultiLineString"||(vt.length===1?(Ze="LineString",vt=vt[0]):Ze="MultiLineString"),Ze!=="Point"&&Ze!=="MultiPoint"||(Ze=vt.length===3?"Point":"MultiPoint"),ge.push(ot(Ge.id,Ze,vt,Ge.tags))}}}return ge.length?ge:null}function Ct(Q,F,U,J,ne){for(var de=0;de<Q.length;de+=3){var le=Q[de+ne];le>=U&&le<=J&&(F.push(Q[de]),F.push(Q[de+1]),F.push(Q[de+2]))}}function Ti(Q,F,U,J,ne,de,le){for(var _e,ge,ve=gi(Q),Ge=ne===0?ui:xo,Ue=Q.start,Ze=0;Ze<Q.length-3;Ze+=3){var bt=Q[Ze],pt=Q[Ze+1],vt=Q[Ze+2],Et=Q[Ze+3],di=Q[Ze+4],$t=ne===0?bt:pt,Jt=ne===0?Et:di,Nt=!1;le&&(_e=Math.sqrt(Math.pow(bt-Et,2)+Math.pow(pt-di,2))),$t<U?Jt>U&&(ge=Ge(ve,bt,pt,Et,di,U),le&&(ve.start=Ue+_e*ge)):$t>J?Jt<J&&(ge=Ge(ve,bt,pt,Et,di,J),le&&(ve.start=Ue+_e*ge)):$r(ve,bt,pt,vt),Jt<U&&$t>=U&&(ge=Ge(ve,bt,pt,Et,di,U),Nt=!0),Jt>J&&$t<=J&&(ge=Ge(ve,bt,pt,Et,di,J),Nt=!0),!de&&Nt&&(le&&(ve.end=Ue+_e*ge),F.push(ve),ve=gi(Q)),le&&(Ue+=_e)}var Pt=Q.length-3;bt=Q[Pt],pt=Q[Pt+1],vt=Q[Pt+2],($t=ne===0?bt:pt)>=U&&$t<=J&&$r(ve,bt,pt,vt),Pt=ve.length-3,de&&Pt>=3&&(ve[Pt]!==ve[0]||ve[Pt+1]!==ve[1])&&$r(ve,ve[0],ve[1],ve[2]),ve.length&&F.push(ve)}function gi(Q){var F=[];return F.size=Q.size,F.start=Q.start,F.end=Q.end,F}function Rr(Q,F,U,J,ne,de){for(var le=0;le<Q.length;le++)Ti(Q[le],F,U,J,ne,de,!1)}function $r(Q,F,U,J){Q.push(F),Q.push(U),Q.push(J)}function ui(Q,F,U,J,ne,de){var le=(de-F)/(J-F);return Q.push(de),Q.push(U+(ne-U)*le),Q.push(1),le}function xo(Q,F,U,J,ne,de){var le=(de-U)/(ne-U);return Q.push(F+(J-F)*le),Q.push(de),Q.push(1),le}function Ln(Q,F){for(var U=[],J=0;J<Q.length;J++){var ne,de=Q[J],le=de.type;if(le==="Point"||le==="MultiPoint"||le==="LineString")ne=Ji(de.geometry,F);else if(le==="MultiLineString"||le==="Polygon"){ne=[];for(var _e=0;_e<de.geometry.length;_e++)ne.push(Ji(de.geometry[_e],F))}else if(le==="MultiPolygon")for(ne=[],_e=0;_e<de.geometry.length;_e++){for(var ge=[],ve=0;ve<de.geometry[_e].length;ve++)ge.push(Ji(de.geometry[_e][ve],F));ne.push(ge)}U.push(ot(de.id,le,ne,de.tags))}return U}function Ji(Q,F){var U=[];U.size=Q.size,Q.start!==void 0&&(U.start=Q.start,U.end=Q.end);for(var J=0;J<Q.length;J+=3)U.push(Q[J]+F,Q[J+1],Q[J+2]);return U}function X(Q,F){if(Q.transformed)return Q;var U,J,ne,de=1<<Q.z,le=Q.x,_e=Q.y;for(U=0;U<Q.features.length;U++){var ge=Q.features[U],ve=ge.geometry,Ge=ge.type;if(ge.geometry=[],Ge===1)for(J=0;J<ve.length;J+=2)ge.geometry.push(Y(ve[J],ve[J+1],F,de,le,_e));else for(J=0;J<ve.length;J++){var Ue=[];for(ne=0;ne<ve[J].length;ne+=2)Ue.push(Y(ve[J][ne],ve[J][ne+1],F,de,le,_e));ge.geometry.push(Ue)}}return Q.transformed=!0,Q}function Y(Q,F,U,J,ne,de){return[Math.round(U*(Q*J-ne)),Math.round(U*(F*J-de))]}function ie(Q,F,U,J,ne){for(var de=F===ne.maxZoom?0:ne.tolerance/((1<<F)*ne.extent),le={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:U,y:J,z:F,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},_e=0;_e<Q.length;_e++){le.numFeatures++,pe(le,Q[_e],de,ne);var ge=Q[_e].minX,ve=Q[_e].minY,Ge=Q[_e].maxX,Ue=Q[_e].maxY;ge<le.minX&&(le.minX=ge),ve<le.minY&&(le.minY=ve),Ge>le.maxX&&(le.maxX=Ge),Ue>le.maxY&&(le.maxY=Ue)}return le}function pe(Q,F,U,J){var ne=F.geometry,de=F.type,le=[];if(de==="Point"||de==="MultiPoint")for(var _e=0;_e<ne.length;_e+=3)le.push(ne[_e]),le.push(ne[_e+1]),Q.numPoints++,Q.numSimplified++;else if(de==="LineString")xe(le,ne,Q,U,!1,!1);else if(de==="MultiLineString"||de==="Polygon")for(_e=0;_e<ne.length;_e++)xe(le,ne[_e],Q,U,de==="Polygon",_e===0);else if(de==="MultiPolygon")for(var ge=0;ge<ne.length;ge++){var ve=ne[ge];for(_e=0;_e<ve.length;_e++)xe(le,ve[_e],Q,U,!0,_e===0)}if(le.length){var Ge=F.tags||null;if(de==="LineString"&&J.lineMetrics){for(var Ue in Ge={},F.tags)Ge[Ue]=F.tags[Ue];Ge.mapbox_clip_start=ne.start/ne.size,Ge.mapbox_clip_end=ne.end/ne.size}var Ze={geometry:le,type:de==="Polygon"||de==="MultiPolygon"?3:de==="LineString"||de==="MultiLineString"?2:1,tags:Ge};F.id!==null&&(Ze.id=F.id),Q.features.push(Ze)}}function xe(Q,F,U,J,ne,de){var le=J*J;if(J>0&&F.size<(ne?le:J))U.numPoints+=F.length/3;else{for(var _e=[],ge=0;ge<F.length;ge+=3)(J===0||F[ge+2]>le)&&(U.numSimplified++,_e.push(F[ge]),_e.push(F[ge+1])),U.numPoints++;ne&&function(ve,Ge){for(var Ue=0,Ze=0,bt=ve.length,pt=bt-2;Ze<bt;pt=Ze,Ze+=2)Ue+=(ve[Ze]-ve[pt])*(ve[Ze+1]+ve[pt+1]);if(Ue>0===Ge)for(Ze=0,bt=ve.length;Ze<bt/2;Ze+=2){var vt=ve[Ze],Et=ve[Ze+1];ve[Ze]=ve[bt-2-Ze],ve[Ze+1]=ve[bt-1-Ze],ve[bt-2-Ze]=vt,ve[bt-1-Ze]=Et}}(_e,de),Q.push(_e)}}function Me(Q,F){var U=(F=this.options=function(ne,de){for(var le in de)ne[le]=de[le];return ne}(Object.create(this.options),F)).debug;if(U&&console.time("preprocess data"),F.maxZoom<0||F.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(F.promoteId&&F.generateId)throw new Error("promoteId and generateId cannot be used together.");var J=function(ne,de){var le=[];if(ne.type==="FeatureCollection")for(var _e=0;_e<ne.features.length;_e++)zo(le,ne.features[_e],de,_e);else zo(le,ne.type==="Feature"?ne:{geometry:ne},de);return le}(Q,F);this.tiles={},this.tileCoords=[],U&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",F.indexMaxZoom,F.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),J=function(ne,de){var le=de.buffer/de.extent,_e=ne,ge=er(ne,1,-1-le,le,0,-1,2,de),ve=er(ne,1,1-le,2+le,0,-1,2,de);return(ge||ve)&&(_e=er(ne,1,-le,1+le,0,-1,2,de)||[],ge&&(_e=Ln(ge,1).concat(_e)),ve&&(_e=_e.concat(Ln(ve,-1)))),_e}(J,F),J.length&&this.splitTile(J,0,0,0),U&&(J.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function De(Q,F,U){return 32*((1<<Q)*U+F)+Q}function ce(Q,F){const U=Q.tileID.canonical;if(!this._geoJSONIndex)return F(null,null);const J=this._geoJSONIndex.getTile(U.z,U.x,U.y);if(!J)return F(null,null);const ne=new Si(J.features);let de=kn(ne);de.byteOffset===0&&de.byteLength===de.buffer.byteLength||(de=new Uint8Array(de)),F(null,{vectorTile:ne,rawData:de.buffer})}Me.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Me.prototype.splitTile=function(Q,F,U,J,ne,de,le){for(var _e=[Q,F,U,J],ge=this.options,ve=ge.debug;_e.length;){J=_e.pop(),U=_e.pop(),F=_e.pop(),Q=_e.pop();var Ge=1<<F,Ue=De(F,U,J),Ze=this.tiles[Ue];if(!Ze&&(ve>1&&console.time("creation"),Ze=this.tiles[Ue]=ie(Q,F,U,J,ge),this.tileCoords.push({z:F,x:U,y:J}),ve)){ve>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",F,U,J,Ze.numFeatures,Ze.numPoints,Ze.numSimplified),console.timeEnd("creation"));var bt="z"+F;this.stats[bt]=(this.stats[bt]||0)+1,this.total++}if(Ze.source=Q,ne){if(F===ge.maxZoom||F===ne)continue;var pt=1<<ne-F;if(U!==Math.floor(de/pt)||J!==Math.floor(le/pt))continue}else if(F===ge.indexMaxZoom||Ze.numPoints<=ge.indexMaxPoints)continue;if(Ze.source=null,Q.length!==0){ve>1&&console.time("clipping");var vt,Et,di,$t,Jt,Nt,Pt=.5*ge.buffer/ge.extent,oi=.5-Pt,Oi=.5+Pt,Cr=1+Pt;vt=Et=di=$t=null,Jt=er(Q,Ge,U-Pt,U+Oi,0,Ze.minX,Ze.maxX,ge),Nt=er(Q,Ge,U+oi,U+Cr,0,Ze.minX,Ze.maxX,ge),Q=null,Jt&&(vt=er(Jt,Ge,J-Pt,J+Oi,1,Ze.minY,Ze.maxY,ge),Et=er(Jt,Ge,J+oi,J+Cr,1,Ze.minY,Ze.maxY,ge),Jt=null),Nt&&(di=er(Nt,Ge,J-Pt,J+Oi,1,Ze.minY,Ze.maxY,ge),$t=er(Nt,Ge,J+oi,J+Cr,1,Ze.minY,Ze.maxY,ge),Nt=null),ve>1&&console.timeEnd("clipping"),_e.push(vt||[],F+1,2*U,2*J),_e.push(Et||[],F+1,2*U,2*J+1),_e.push(di||[],F+1,2*U+1,2*J),_e.push($t||[],F+1,2*U+1,2*J+1)}}},Me.prototype.getTile=function(Q,F,U){var J=this.options,ne=J.extent,de=J.debug;if(Q<0||Q>24)return null;var le=1<<Q,_e=De(Q,F=(F%le+le)%le,U);if(this.tiles[_e])return X(this.tiles[_e],ne);de>1&&console.log("drilling down to z%d-%d-%d",Q,F,U);for(var ge,ve=Q,Ge=F,Ue=U;!ge&&ve>0;)ve--,Ge=Math.floor(Ge/2),Ue=Math.floor(Ue/2),ge=this.tiles[De(ve,Ge,Ue)];return ge&&ge.source?(de>1&&console.log("found parent tile z%d-%d-%d",ve,Ge,Ue),de>1&&console.time("drilling down"),this.splitTile(ge.source,ve,Ge,Ue,Q,F,U),de>1&&console.timeEnd("drilling down"),this.tiles[_e]?X(this.tiles[_e],ne):null):null};class Ie extends ti{constructor(F,U,J,ne){super(F,U,J,ce),ne&&(this.loadGeoJSON=ne)}loadData(F,U){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=U,this._pendingLoadDataParams=F,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())}_loadData(){if(!this._pendingCallback||!this._pendingLoadDataParams)return;const F=this._pendingCallback,U=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;const J=!!(U&&U.request&&U.request.collectResourceTiming)&&new x.RequestPerformance(U.request);this.loadGeoJSON(U,(ne,de)=>{if(ne||!de)return F(ne);if(typeof de!="object")return F(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));{Ei(de,!0);try{if(U.filter){const _e=x.createExpression(U.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(_e.result==="error")throw new Error(_e.value.map(ve=>`${ve.key}: ${ve.message}`).join(", "));const ge=de.features.filter(ve=>_e.value.evaluate({zoom:0},ve));de={type:"FeatureCollection",features:ge}}this._geoJSONIndex=U.cluster?new Gr(function({superclusterOptions:_e,clusterProperties:ge}){if(!ge||!_e)return _e;const ve={},Ge={},Ue={accumulated:null,zoom:0},Ze={properties:null},bt=Object.keys(ge);for(const pt of bt){const[vt,Et]=ge[pt],di=x.createExpression(Et),$t=x.createExpression(typeof vt=="string"?[vt,["accumulated"],["get",pt]]:vt);ve[pt]=di.value,Ge[pt]=$t.value}return _e.map=pt=>{Ze.properties=pt;const vt={};for(const Et of bt)vt[Et]=ve[Et].evaluate(Ue,Ze);return vt},_e.reduce=(pt,vt)=>{Ze.properties=vt;for(const Et of bt)Ue.accumulated=pt[Et],pt[Et]=Ge[Et].evaluate(Ue,Ze)},_e}(U)).load(de.features):function(_e,ge){return new Me(_e,ge)}(de,U.geojsonVtOptions)}catch(_e){return F(_e)}this.loaded={};const le={};if(J){const _e=J.finish();_e&&(le.resourceTiming={},le.resourceTiming[U.source]=JSON.parse(JSON.stringify(_e)))}F(null,le)}})}coalesce(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())}reloadTile(F,U){const J=this.loaded;return J&&J[F.uid]?super.reloadTile(F,U):this.loadTile(F,U)}loadGeoJSON(F,U){if(F.request)x.getJSON(F.request,U);else{if(typeof F.data!="string")return U(new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`));try{return U(null,JSON.parse(F.data))}catch{return U(new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`))}}}removeSource(F,U){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),U()}getClusterExpansionZoom(F,U){try{U(null,this._geoJSONIndex.getClusterExpansionZoom(F.clusterId))}catch(J){U(J)}}getClusterChildren(F,U){try{U(null,this._geoJSONIndex.getChildren(F.clusterId))}catch(J){U(J)}}getClusterLeaves(F,U){try{U(null,this._geoJSONIndex.getLeaves(F.clusterId,F.limit,F.offset))}catch(J){U(J)}}}class qe{constructor(F){this.self=F,this.actor=new x.Actor(F,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:ti,geojson:Ie},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(U,J)=>{if(this.workerSourceTypes[U])throw new Error(`Worker source with name "${U}" already registered.`);this.workerSourceTypes[U]=J},this.self.registerRTLTextPlugin=U=>{if(x.plugin.isParsed())throw new Error("RTL text plugin already registered.");x.plugin.applyArabicShaping=U.applyArabicShaping,x.plugin.processBidirectionalText=U.processBidirectionalText,x.plugin.processStyledBidirectionalText=U.processStyledBidirectionalText}}setReferrer(F,U){this.referrer=U}setImages(F,U,J){this.availableImages[F]=U;for(const ne in this.workerSources[F]){const de=this.workerSources[F][ne];for(const le in de)de[le].availableImages=U}J()}setLayers(F,U,J){this.getLayerIndex(F).replace(U),J()}updateLayers(F,U,J){this.getLayerIndex(F).update(U.layers,U.removedIds),J()}loadTile(F,U,J){this.getWorkerSource(F,U.type,U.source).loadTile(U,J)}loadDEMTile(F,U,J){this.getDEMWorkerSource(F,U.source).loadTile(U,J)}reloadTile(F,U,J){this.getWorkerSource(F,U.type,U.source).reloadTile(U,J)}abortTile(F,U,J){this.getWorkerSource(F,U.type,U.source).abortTile(U,J)}removeTile(F,U,J){this.getWorkerSource(F,U.type,U.source).removeTile(U,J)}removeDEMTile(F,U){this.getDEMWorkerSource(F,U.source).removeTile(U)}removeSource(F,U,J){if(!this.workerSources[F]||!this.workerSources[F][U.type]||!this.workerSources[F][U.type][U.source])return;const ne=this.workerSources[F][U.type][U.source];delete this.workerSources[F][U.type][U.source],ne.removeSource!==void 0?ne.removeSource(U,J):J()}loadWorkerSource(F,U,J){try{this.self.importScripts(U.url),J()}catch(ne){J(ne.toString())}}syncRTLPluginState(F,U,J){try{x.plugin.setState(U);const ne=x.plugin.getPluginURL();if(x.plugin.isLoaded()&&!x.plugin.isParsed()&&ne!=null){this.self.importScripts(ne);const de=x.plugin.isParsed();J(de?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ne}`),de)}}catch(ne){J(ne.toString())}}getAvailableImages(F){let U=this.availableImages[F];return U||(U=[]),U}getLayerIndex(F){let U=this.layerIndexes[F];return U||(U=this.layerIndexes[F]=new Ke),U}getWorkerSource(F,U,J){if(this.workerSources[F]||(this.workerSources[F]={}),this.workerSources[F][U]||(this.workerSources[F][U]={}),!this.workerSources[F][U][J]){const ne={send:(de,le,_e)=>{this.actor.send(de,le,_e,F)}};this.workerSources[F][U][J]=new this.workerSourceTypes[U](ne,this.getLayerIndex(F),this.getAvailableImages(F))}return this.workerSources[F][U][J]}getDEMWorkerSource(F,U){return this.demWorkerSources[F]||(this.demWorkerSources[F]={}),this.demWorkerSources[F][U]||(this.demWorkerSources[F][U]=new zt),this.demWorkerSources[F][U]}enforceCacheSizeLimit(F,U){x.enforceCacheSizeLimit(U)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new qe(self)),qe}),Ae(["./shared"],function(x){var he=it;function it(b){return!function(n){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,w,I=new Blob([""],{type:"text/javascript"}),L=URL.createObjectURL(I);try{w=new Worker(L),v=!0}catch{v=!1}return w&&w.terminate(),URL.revokeObjectURL(L),v}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var v=document.createElement("canvas");v.width=v.height=1;var w=v.getContext("2d");if(!w)return!1;var I=w.getImageData(0,0,1,1);return I&&I.width===v.width}()?(Ke[h=n&&n.failIfMajorPerformanceCaveat]===void 0&&(Ke[h]=function(v){var w,I=function(L){var O=document.createElement("canvas"),N=Object.create(it.webGLContextAttributes);return N.failIfMajorPerformanceCaveat=L,O.getContext("webgl",N)||O.getContext("experimental-webgl",N)}(v);if(!I)return!1;try{w=I.createShader(I.VERTEX_SHADER)}catch{return!1}return!(!w||I.isContextLost())&&(I.shaderSource(w,"void main() {}"),I.compileShader(w),I.getShaderParameter(w,I.COMPILE_STATUS)===!0)}(h)),Ke[h]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var h}(b)}var Ke={};function Qe(b,n){if(Array.isArray(b)){if(!Array.isArray(n)||b.length!==n.length)return!1;for(let h=0;h<b.length;h++)if(!Qe(b[h],n[h]))return!1;return!0}if(typeof b=="object"&&b!==null&&n!==null){if(typeof n!="object"||Object.keys(b).length!==Object.keys(n).length)return!1;for(const h in b)if(!Qe(b[h],n[h]))return!1;return!0}return b===n}it.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class Se{static testProp(n){if(!Se.docStyle)return n[0];for(let h=0;h<n.length;h++)if(n[h]in Se.docStyle)return n[h];return n[0]}static create(n,h,v){const w=window.document.createElement(n);return h!==void 0&&(w.className=h),v&&v.appendChild(w),w}static createNS(n,h){return window.document.createElementNS(n,h)}static disableDrag(){Se.docStyle&&Se.selectProp&&(Se.userSelect=Se.docStyle[Se.selectProp],Se.docStyle[Se.selectProp]="none")}static enableDrag(){Se.docStyle&&Se.selectProp&&(Se.docStyle[Se.selectProp]=Se.userSelect)}static setTransform(n,h){n.style[Se.transformProp]=h}static addEventListener(n,h,v,w={}){n.addEventListener(h,v,"passive"in w?w:w.capture)}static removeEventListener(n,h,v,w={}){n.removeEventListener(h,v,"passive"in w?w:w.capture)}static suppressClickInternal(n){n.preventDefault(),n.stopPropagation(),window.removeEventListener("click",Se.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Se.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",Se.suppressClickInternal,!0)},0)}static mousePos(n,h){const v=n.getBoundingClientRect();return new x.pointGeometry(h.clientX-v.left-n.clientLeft,h.clientY-v.top-n.clientTop)}static touchPos(n,h){const v=n.getBoundingClientRect(),w=[];for(let I=0;I<h.length;I++)w.push(new x.pointGeometry(h[I].clientX-v.left-n.clientLeft,h[I].clientY-v.top-n.clientTop));return w}static mouseButton(n){return n.button}static remove(n){n.parentNode&&n.parentNode.removeChild(n)}}Se.docStyle=typeof window!="undefined"&&window.document&&window.document.documentElement.style,Se.selectProp=Se.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Se.transformProp=Se.testProp(["transform","WebkitTransform"]);class It{constructor(n){this._transformRequestFn=n}transformRequest(n,h){return this._transformRequestFn&&this._transformRequestFn(n,h)||{url:n}}normalizeSpriteURL(n,h,v){const w=function(I){const L=I.match(yt);if(!L)throw new Error(`Unable to parse URL "${I}"`);return{protocol:L[1],authority:L[2],path:L[3]||"/",params:L[4]?L[4].split("&"):[]}}(n);return w.path+=`${h}${v}`,function(I){const L=I.params.length?`?${I.params.join("&")}`:"";return`${I.protocol}://${I.authority}${I.path}${L}`}(w)}setTransformRequest(n){this._transformRequestFn=n}}const yt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ti(b){var n=new x.ARRAY_TYPE(3);return n[0]=b[0],n[1]=b[1],n[2]=b[2],n}var zt,Ei=function(b,n,h){return b[0]=n[0]-h[0],b[1]=n[1]-h[1],b[2]=n[2]-h[2],b};zt=new x.ARRAY_TYPE(3),x.ARRAY_TYPE!=Float32Array&&(zt[0]=0,zt[1]=0,zt[2]=0);var mi=function(b){var n=b[0],h=b[1];return n*n+h*h};(function(){var b=new x.ARRAY_TYPE(2);x.ARRAY_TYPE!=Float32Array&&(b[0]=0,b[1]=0)})();class Ht{constructor(n,h,v,w){this.context=n,this.format=v,this.texture=n.gl.createTexture(),this.update(h,w)}update(n,h,v){const{width:w,height:I}=n,L=!(this.size&&this.size[0]===w&&this.size[1]===I||v),{context:O}=this,{gl:N}=O;if(this.useMipmap=Boolean(h&&h.useMipmap),N.bindTexture(N.TEXTURE_2D,this.texture),O.pixelStoreUnpackFlipY.set(!1),O.pixelStoreUnpack.set(1),O.pixelStoreUnpackPremultiplyAlpha.set(this.format===N.RGBA&&(!h||h.premultiply!==!1)),L)this.size=[w,I],n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||x.isImageBitmap(n)?N.texImage2D(N.TEXTURE_2D,0,this.format,this.format,N.UNSIGNED_BYTE,n):N.texImage2D(N.TEXTURE_2D,0,this.format,w,I,0,this.format,N.UNSIGNED_BYTE,n.data);else{const{x:$,y:H}=v||{x:0,y:0};n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||x.isImageBitmap(n)?N.texSubImage2D(N.TEXTURE_2D,0,$,H,N.RGBA,N.UNSIGNED_BYTE,n):N.texSubImage2D(N.TEXTURE_2D,0,$,H,w,I,N.RGBA,N.UNSIGNED_BYTE,n.data)}this.useMipmap&&this.isSizePowerOfTwo()&&N.generateMipmap(N.TEXTURE_2D)}bind(n,h,v){const{context:w}=this,{gl:I}=w;I.bindTexture(I.TEXTURE_2D,this.texture),v!==I.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(v=I.LINEAR),n!==this.filter&&(I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MAG_FILTER,n),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_MIN_FILTER,v||n),this.filter=n),h!==this.wrap&&(I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_S,h),I.texParameteri(I.TEXTURE_2D,I.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}function br(b){const{userImage:n}=b;return!!(n&&n.render&&n.render())&&(b.data.replace(new Uint8Array(n.data.buffer)),!0)}class pi extends x.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new x.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:h,callback:v}of this.requestors)this._notify(h,v);this.requestors=[]}}getImage(n){return this.images[n]}addImage(n,h){this._validate(n,h)&&(this.images[n]=h)}_validate(n,h){let v=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new x.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),v=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new x.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),v=!1),this._validateContent(h.content,h)||(this.fire(new x.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),v=!1),v}_validateStretch(n,h){if(!n)return!0;let v=0;for(const w of n){if(w[0]<v||w[1]<w[0]||h<w[1])return!1;v=w[1]}return!0}_validateContent(n,h){return!(n&&(n.length!==4||n[0]<0||h.data.width<n[0]||n[1]<0||h.data.height<n[1]||n[2]<0||h.data.width<n[2]||n[3]<0||h.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,h){h.version=this.images[n].version+1,this.images[n]=h,this.updatedImages[n]=!0}removeImage(n){const h=this.images[n];delete this.images[n],delete this.patterns[n],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,h){let v=!0;if(!this.isLoaded())for(const w of n)this.images[w]||(v=!1);this.isLoaded()||v?this._notify(n,h):this.requestors.push({ids:n,callback:h})}_notify(n,h){const v={};for(const w of n){this.images[w]||this.fire(new x.Event("styleimagemissing",{id:w}));const I=this.images[w];I?v[w]={data:I.data.clone(),pixelRatio:I.pixelRatio,sdf:I.sdf,version:I.version,stretchX:I.stretchX,stretchY:I.stretchY,content:I.content,hasRenderCallback:Boolean(I.userImage&&I.userImage.render)}:x.warnOnce(`Image "${w}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,v)}getPixelSize(){const{width:n,height:h}=this.atlasImage;return{width:n,height:h}}getPattern(n){const h=this.patterns[n],v=this.getImage(n);if(!v)return null;if(h&&h.position.version===v.version)return h.position;if(h)h.position.version=v.version;else{const w={w:v.data.width+2,h:v.data.height+2,x:0,y:0},I=new x.ImagePosition(w,v);this.patterns[n]={bin:w,position:I}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const h=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Ht(n,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const I in this.patterns)n.push(this.patterns[I].bin);const{w:h,h:v}=x.potpack(n),w=this.atlasImage;w.resize({width:h||1,height:v||1});for(const I in this.patterns){const{bin:L}=this.patterns[I],O=L.x+1,N=L.y+1,$=this.images[I].data,H=$.width,re=$.height;x.RGBAImage.copy($,w,{x:0,y:0},{x:O,y:N},{width:H,height:re}),x.RGBAImage.copy($,w,{x:0,y:re-1},{x:O,y:N-1},{width:H,height:1}),x.RGBAImage.copy($,w,{x:0,y:0},{x:O,y:N+re},{width:H,height:1}),x.RGBAImage.copy($,w,{x:H-1,y:0},{x:O-1,y:N},{width:1,height:re}),x.RGBAImage.copy($,w,{x:0,y:0},{x:O+H,y:N},{width:1,height:re})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const h of n){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const v=this.images[h];br(v)&&this.updateImage(h,v)}}}const Si=1e20;function Ni(b,n,h,v,w,I,L,O,N){for(let $=n;$<n+v;$++)Lr(b,h*I+$,I,w,L,O,N);for(let $=h;$<h+w;$++)Lr(b,$*I+n,1,v,L,O,N)}function Lr(b,n,h,v,w,I,L){I[0]=0,L[0]=-Si,L[1]=Si,w[0]=b[n];for(let O=1,N=0,$=0;O<v;O++){w[O]=b[n+O*h];const H=O*O;do{const re=I[N];$=(w[O]-w[re]+H-re*re)/(O-re)/2}while($<=L[N]&&--N>-1);N++,I[N]=O,L[N]=$,L[N+1]=Si}for(let O=0,N=0;O<v;O++){for(;L[N+1]<O;)N++;const $=I[N],H=O-$;b[n+O*h]=w[$]+H*H}}class lr{constructor(n,h){this.requestManager=n,this.localIdeographFontFamily=h,this.entries={}}setURL(n){this.url=n}getGlyphs(n,h){const v=[];for(const w in n)for(const I of n[w])v.push({stack:w,id:I});x.asyncAll(v,({stack:w,id:I},L)=>{let O=this.entries[w];O||(O=this.entries[w]={glyphs:{},requests:{},ranges:{}});let N=O.glyphs[I];if(N!==void 0)return void L(null,{stack:w,id:I,glyph:N});if(N=this._tinySDF(O,w,I),N)return O.glyphs[I]=N,void L(null,{stack:w,id:I,glyph:N});const $=Math.floor(I/256);if(256*$>65535)return void L(new Error("glyphs > 65535 not supported"));if(O.ranges[$])return void L(null,{stack:w,id:I,glyph:N});let H=O.requests[$];H||(H=O.requests[$]=[],lr.loadGlyphRange(w,$,this.url,this.requestManager,(re,fe)=>{if(fe){for(const Pe in fe)this._doesCharSupportLocalGlyph(+Pe)||(O.glyphs[+Pe]=fe[+Pe]);O.ranges[$]=!0}for(const Pe of H)Pe(re,fe);delete O.requests[$]})),H.push((re,fe)=>{re?L(re):fe&&L(null,{stack:w,id:I,glyph:fe[I]||null})})},(w,I)=>{if(w)h(w);else if(I){const L={};for(const{stack:O,id:N,glyph:$}of I)(L[O]||(L[O]={}))[N]=$&&{id:$.id,bitmap:$.bitmap.clone(),metrics:$.metrics};h(null,L)}})}_doesCharSupportLocalGlyph(n){return!!this.localIdeographFontFamily&&(x.unicodeBlockLookup["CJK Unified Ideographs"](n)||x.unicodeBlockLookup["Hangul Syllables"](n)||x.unicodeBlockLookup.Hiragana(n)||x.unicodeBlockLookup.Katakana(n))}_tinySDF(n,h,v){const w=this.localIdeographFontFamily;if(!w||!this._doesCharSupportLocalGlyph(v))return;let I=n.tinySDF;if(!I){let O="400";/bold/i.test(h)?O="900":/medium/i.test(h)?O="500":/light/i.test(h)&&(O="200"),I=n.tinySDF=new lr.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:w,fontWeight:O})}const L=I.draw(String.fromCharCode(v));return{id:v,bitmap:new x.AlphaImage({width:L.width||30,height:L.height||30},L.data),metrics:{width:L.glyphWidth||24,height:L.glyphHeight||24,left:L.glyphLeft||0,top:L.glyphTop-27||-8,advance:L.glyphAdvance||24}}}}lr.loadGlyphRange=function(b,n,h,v,w){const I=256*n,L=I+255,O=v.transformRequest(h.replace("{fontstack}",b).replace("{range}",`${I}-${L}`),x.ResourceType.Glyphs);x.getArrayBuffer(O,(N,$)=>{if(N)w(N);else if($){const H={};for(const re of x.parseGlyphPBF($))H[re.id]=re;w(null,H)}})},lr.TinySDF=class{constructor({fontSize:b=24,buffer:n=3,radius:h=8,cutoff:v=.25,fontFamily:w="sans-serif",fontWeight:I="normal",fontStyle:L="normal"}={}){this.buffer=n,this.cutoff=v,this.radius=h;const O=this.size=b+4*n,N=this._createCanvas(O),$=this.ctx=N.getContext("2d",{willReadFrequently:!0});$.font=`${L} ${I} ${b}px ${w}`,$.textBaseline="alphabetic",$.textAlign="left",$.fillStyle="black",this.gridOuter=new Float64Array(O*O),this.gridInner=new Float64Array(O*O),this.f=new Float64Array(O),this.z=new Float64Array(O+1),this.v=new Uint16Array(O)}_createCanvas(b){const n=document.createElement("canvas");return n.width=n.height=b,n}draw(b){const{width:n,actualBoundingBoxAscent:h,actualBoundingBoxDescent:v,actualBoundingBoxLeft:w,actualBoundingBoxRight:I}=this.ctx.measureText(b),L=Math.ceil(h),O=Math.min(this.size-this.buffer,Math.ceil(I-w)),N=Math.min(this.size-this.buffer,L+Math.ceil(v)),$=O+2*this.buffer,H=N+2*this.buffer,re=Math.max($*H,0),fe=new Uint8ClampedArray(re),Pe={data:fe,width:$,height:H,glyphWidth:O,glyphHeight:N,glyphTop:L,glyphLeft:0,glyphAdvance:n};if(O===0||N===0)return Pe;const{ctx:ye,buffer:ze,gridInner:Ve,gridOuter:Fe}=this;ye.clearRect(ze,ze,O,N),ye.fillText(b,ze,ze+L);const Xe=ye.getImageData(ze,ze,O,N);Fe.fill(Si,0,re),Ve.fill(0,0,re);for(let je=0;je<N;je++)for(let st=0;st<O;st++){const et=Xe.data[4*(je*O+st)+3]/255;if(et===0)continue;const rt=(je+ze)*$+st+ze;if(et===1)Fe[rt]=0,Ve[rt]=Si;else{const mt=.5-et;Fe[rt]=mt>0?mt*mt:0,Ve[rt]=mt<0?mt*mt:0}}Ni(Fe,0,0,$,H,$,this.f,this.v,this.z),Ni(Ve,ze,ze,O,N,$,this.f,this.v,this.z);for(let je=0;je<re;je++){const st=Math.sqrt(Fe[je])-Math.sqrt(Ve[je]);fe[je]=Math.round(255-255*(st/this.radius+this.cutoff))}return Pe}};const Fn=new x.Properties({anchor:new x.DataConstantProperty(x.spec.light.anchor),position:new class{constructor(){this.specification=x.spec.light.position}possiblyEvaluate(b,n){return x.sphericalToCartesian(b.expression.evaluate(n))}interpolate(b,n,h){return{x:x.number(b.x,n.x,h),y:x.number(b.y,n.y,h),z:x.number(b.z,n.z,h)}}},color:new x.DataConstantProperty(x.spec.light.color),intensity:new x.DataConstantProperty(x.spec.light.intensity)}),hn="-transition";class no extends x.Evented{constructor(n){super(),this._transitionable=new x.Transitionable(Fn),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,h={}){if(!this._validate(x.validateLight,n,h))for(const v in n){const w=n[v];v.endsWith(hn)?this._transitionable.setTransition(v.slice(0,-hn.length),w):this._transitionable.setValue(v,w)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,h,v){return(!v||v.validate!==!1)&&x.emitValidationErrors(this,n.call(x.validateStyle,x.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:x.spec})))}}class nr{constructor(n,h){this.width=n,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(n,h){const v=n.join(",")+String(h);return this.dashEntry[v]||(this.dashEntry[v]=this.addDash(n,h)),this.dashEntry[v]}getDashRanges(n,h,v){const w=[];let I=n.length%2==1?-n[n.length-1]*v:0,L=n[0]*v,O=!0;w.push({left:I,right:L,isDash:O,zeroLength:n[0]===0});let N=n[0];for(let $=1;$<n.length;$++){O=!O;const H=n[$];I=N*v,N+=H,L=N*v,w.push({left:I,right:L,isDash:O,zeroLength:H===0})}return w}addRoundDash(n,h,v){const w=h/2;for(let I=-v;I<=v;I++){const L=this.width*(this.nextRow+v+I);let O=0,N=n[O];for(let $=0;$<this.width;$++){$/N.right>1&&(N=n[++O]);const H=Math.abs($-N.left),re=Math.abs($-N.right),fe=Math.min(H,re);let Pe;const ye=I/v*(w+1);if(N.isDash){const ze=w-Math.abs(ye);Pe=Math.sqrt(fe*fe+ze*ze)}else Pe=w-Math.sqrt(fe*fe+ye*ye);this.data[L+$]=Math.max(0,Math.min(255,Pe+128))}}}addRegularDash(n){for(let O=n.length-1;O>=0;--O){const N=n[O],$=n[O+1];N.zeroLength?n.splice(O,1):$&&$.isDash===N.isDash&&($.left=N.left,n.splice(O,1))}const h=n[0],v=n[n.length-1];h.isDash===v.isDash&&(h.left=v.left-this.width,v.right=h.right+this.width);const w=this.width*this.nextRow;let I=0,L=n[I];for(let O=0;O<this.width;O++){O/L.right>1&&(L=n[++I]);const N=Math.abs(O-L.left),$=Math.abs(O-L.right),H=Math.min(N,$);this.data[w+O]=Math.max(0,Math.min(255,(L.isDash?H:-H)+128))}}addDash(n,h){const v=h?7:0,w=2*v+1;if(this.nextRow+w>this.height)return x.warnOnce("LineAtlas out of space"),null;let I=0;for(let O=0;O<n.length;O++)I+=n[O];if(I!==0){const O=this.width/I,N=this.getDashRanges(n,this.width,O);h?this.addRoundDash(N,O,v):this.addRegularDash(N)}const L={y:(this.nextRow+v+.5)/this.height,height:2*v/this.height,width:I};return this.nextRow+=w,this.dirty=!0,L}bind(n){const h=n.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}class Ar{constructor(n,h){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=x.uniqueId();const v=this.workerPool.acquire(this.id);for(let w=0;w<v.length;w++){const I=new Ar.Actor(v[w],h,this.id);I.name=`Worker ${w}`,this.actors.push(I)}}broadcast(n,h,v){x.asyncAll(this.actors,(w,I)=>{w.send(n,h,I)},v=v||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Fo(b,n,h){const v=function(w,I){if(w)return h(w);if(I){const L=x.pick(x.extend(I,b),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);I.vector_layers&&(L.vectorLayers=I.vector_layers,L.vectorLayerIds=L.vectorLayers.map(O=>O.id)),h(null,L)}};return b.url?x.getJSON(n.transformRequest(b.url,x.ResourceType.Source),v):x.exported.frame(()=>v(null,b))}Ar.Actor=x.Actor;class Yt{constructor(n,h,v){this.bounds=x.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=h||0,this.maxzoom=v||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const h=Math.pow(2,n.z),v=Math.floor(x.mercatorXfromLng(this.bounds.getWest())*h),w=Math.floor(x.mercatorYfromLat(this.bounds.getNorth())*h),I=Math.ceil(x.mercatorXfromLng(this.bounds.getEast())*h),L=Math.ceil(x.mercatorYfromLat(this.bounds.getSouth())*h);return n.x>=v&&n.x<I&&n.y>=w&&n.y<L}}class Un extends x.Evented{constructor(n,h,v,w){if(super(),this.id=n,this.dispatcher=v,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,x.extend(this,x.pick(h,["url","scheme","tileSize","promoteId"])),this._options=x.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w)}load(){this._loaded=!1,this.fire(new x.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Fo(this._options,this.map._requestManager,(n,h)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),n?this.fire(new x.ErrorEvent(n)):h&&(x.extend(this,h),h.bounds&&(this.tileBounds=new Yt(h.bounds,this.minzoom,this.maxzoom)),this.fire(new x.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new x.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}setSourceProperty(n){this._tileJSONRequest&&this._tileJSONRequest.cancel(),n(),this.load()}setTiles(n){return this.setSourceProperty(()=>{this._options.tiles=n}),this}setUrl(n){return this.setSourceProperty(()=>{this.url=n,this._options.url=n}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return x.extend({},this._options)}loadTile(n,h){const v=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),w={request:this.map._requestManager.transformRequest(v,x.ResourceType.Tile),uid:n.uid,tileID:n.tileID,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function I(L,O){return delete n.request,n.aborted?h(null):L&&L.status!==404?h(L):(O&&O.resourceTiming&&(n.resourceTiming=O.resourceTiming),this.map._refreshExpiredTiles&&O&&n.setExpiryData(O),n.loadVectorData(O,this.map.painter),x.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}w.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired"?n.state==="loading"?n.reloadCallback=h:n.request=n.actor.send("reloadTile",w,I.bind(this)):(n.actor=this.dispatcher.getActor(),n.request=n.actor.send("loadTile",w,I.bind(this)))}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id},void 0)}unloadTile(n){n.unloadVectorData(),n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class oo extends x.Evented{constructor(n,h,v,w){super(),this.id=n,this.dispatcher=v,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=x.extend({type:"raster"},h),x.extend(this,x.pick(h,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new x.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Fo(this._options,this.map._requestManager,(n,h)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new x.ErrorEvent(n)):h&&(x.extend(this,h),h.bounds&&(this.tileBounds=new Yt(h.bounds,this.minzoom,this.maxzoom)),this.fire(new x.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new x.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return x.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,h){const v=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);n.request=x.getImage(this.map._requestManager.transformRequest(v,x.ResourceType.Tile),(w,I,L)=>{if(delete n.request,n.aborted)n.state="unloaded",h(null);else if(w)n.state="errored",h(w);else if(I){this.map._refreshExpiredTiles&&n.setExpiryData(L);const O=this.map.painter.context,N=O.gl;n.texture=this.map.painter.getTileTexture(I.width),n.texture?n.texture.update(I,{useMipmap:!0}):(n.texture=new Ht(O,I,N.RGBA,{useMipmap:!0}),n.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),O.extTextureFilterAnisotropic&&N.texParameterf(N.TEXTURE_2D,O.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,O.extTextureFilterAnisotropicMax)),n.state="loaded",x.cacheEntryPossiblyAdded(this.dispatcher),h(null)}})}abortTile(n,h){n.request&&(n.request.cancel(),delete n.request),h()}unloadTile(n,h){n.texture&&this.map.painter.saveTileTexture(n.texture),h()}hasTransition(){return!1}}let Co;class rn extends oo{constructor(n,h,v,w){super(n,h,v,w),this.type="raster-dem",this.maxzoom=22,this._options=x.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(n,h){const v=n.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function w(I,L){I&&(n.state="errored",h(I)),L&&(n.dem=L,n.needsHillshadePrepare=!0,n.state="loaded",h(null))}n.request=x.getImage(this.map._requestManager.transformRequest(v,x.ResourceType.Tile),function(I,L){if(delete n.request,n.aborted)n.state="unloaded",h(null);else if(I)n.state="errored",h(I);else if(L){this.map._refreshExpiredTiles&&n.setExpiryData(L),delete L.cacheControl,delete L.expires;const O=x.isImageBitmap(L)&&(Co==null&&(Co=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Co)?L:x.exported.getImageData(L,1),N={uid:n.uid,coord:n.tileID,source:this.id,rawImageData:O,encoding:this.encoding};n.actor&&n.state!=="expired"||(n.actor=this.dispatcher.getActor(),n.actor.send("loadDEMTile",N,w.bind(this)))}}.bind(this)),n.neighboringTiles=this._getNeighboringTiles(n.tileID)}_getNeighboringTiles(n){const h=n.canonical,v=Math.pow(2,h.z),w=(h.x-1+v)%v,I=h.x===0?n.wrap-1:n.wrap,L=(h.x+1+v)%v,O=h.x+1===v?n.wrap+1:n.wrap,N={};return N[new x.OverscaledTileID(n.overscaledZ,I,h.z,w,h.y).key]={backfilled:!1},N[new x.OverscaledTileID(n.overscaledZ,O,h.z,L,h.y).key]={backfilled:!1},h.y>0&&(N[new x.OverscaledTileID(n.overscaledZ,I,h.z,w,h.y-1).key]={backfilled:!1},N[new x.OverscaledTileID(n.overscaledZ,n.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},N[new x.OverscaledTileID(n.overscaledZ,O,h.z,L,h.y-1).key]={backfilled:!1}),h.y+1<v&&(N[new x.OverscaledTileID(n.overscaledZ,I,h.z,w,h.y+1).key]={backfilled:!1},N[new x.OverscaledTileID(n.overscaledZ,n.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},N[new x.OverscaledTileID(n.overscaledZ,O,h.z,L,h.y+1).key]={backfilled:!1}),N}unloadTile(n){n.demTexture&&this.map.painter.saveTileTexture(n.demTexture),n.fbo&&(n.fbo.destroy(),delete n.fbo),n.dem&&delete n.dem,delete n.neighboringTiles,n.state="unloaded",n.actor&&n.actor.send("removeDEMTile",{uid:n.uid,source:this.id})}}class pn extends x.Evented{constructor(n,h,v,w){super(),this.id=n,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=v.getActor(),this.setEventedParent(w),this._data=h.data,this._options=x.extend({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const I=x.EXTENT/this.tileSize;this.workerOptions=x.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*I,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*I,extent:x.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:x.EXTENT,radius:(h.clusterRadius||50)*I,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(n){this.map=n,this.load()}setData(n){return this._data=n,this._updateWorkerData("content"),this}getClusterExpansionZoom(n,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:n,source:this.id},h),this}getClusterChildren(n,h){return this.actor.send("geojson.getClusterChildren",{clusterId:n,source:this.id},h),this}getClusterLeaves(n,h,v,w){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:n,limit:h,offset:v},w),this}_updateWorkerData(n){const h=x.extend({},this.workerOptions),v=this._data;typeof v=="string"?(h.request=this.map._requestManager.transformRequest(x.exported.resolveURL(v),x.ResourceType.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(v),this._pendingLoads++,this.fire(new x.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,h,(w,I)=>{if(this._pendingLoads--,this._removed||I&&I.abandoned)return;let L=null;if(I&&I.resourceTiming&&I.resourceTiming[this.id]&&(L=I.resourceTiming[this.id].slice(0)),this.actor.send(`${this.type}.coalesce`,{source:h.source},null),w)return void this.fire(new x.ErrorEvent(w));const O={dataType:"source",sourceDataType:n};this._collectResourceTiming&&L&&L.length>0&&x.extend(O,{resourceTiming:L}),this.fire(new x.Event("data",O))})}loaded(){return this._pendingLoads===0}loadTile(n,h){const v=n.actor?"reloadTile":"loadTile";n.actor=this.actor;const w={type:this.type,uid:n.uid,tileID:n.tileID,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};n.request=this.actor.send(v,w,(I,L)=>(delete n.request,n.unloadVectorData(),n.aborted?h(null):I?h(I):(n.loadVectorData(L,this.map.painter,v==="reloadTile"),h(null))))}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.aborted=!0}unloadTile(n){n.unloadVectorData(),this.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return x.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var bn=x.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class kn extends x.Evented{constructor(n,h,v,w){super(),this.id=n,this.dispatcher=v,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=h}load(n,h){this._loaded=!1,this.fire(new x.Event("dataloading",{dataType:"source"})),this.url=this.options.url,x.getImage(this.map._requestManager.transformRequest(this.url,x.ResourceType.Image),(v,w)=>{this._loaded=!0,v?this.fire(new x.ErrorEvent(v)):w&&(this.image=w,n&&(this.coordinates=n),h&&h(),this._finishLoading())})}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this.options.url=n.url,this.load(n.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new x.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}setCoordinates(n){this.coordinates=n;const h=n.map(x.MercatorCoordinate.fromLngLat);this.tileID=function(w){let I=1/0,L=1/0,O=-1/0,N=-1/0;for(const fe of w)I=Math.min(I,fe.x),L=Math.min(L,fe.y),O=Math.max(O,fe.x),N=Math.max(N,fe.y);const $=Math.max(O-I,N-L),H=Math.max(0,Math.floor(-Math.log($)/Math.LN2)),re=Math.pow(2,H);return new x.CanonicalTileID(H,Math.floor((I+O)/2*re),Math.floor((L+N)/2*re))}(h),this.minzoom=this.maxzoom=this.tileID.z;const v=h.map(w=>this.tileID.getTilePoint(w)._round());return this._boundsArray=new x.RasterBoundsArray,this._boundsArray.emplaceBack(v[0].x,v[0].y,0,0),this._boundsArray.emplaceBack(v[1].x,v[1].y,x.EXTENT,0),this._boundsArray.emplaceBack(v[3].x,v[3].y,0,x.EXTENT),this._boundsArray.emplaceBack(v[2].x,v[2].y,x.EXTENT,x.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new x.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const n=this.map.painter.context,h=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,bn.members)),this.boundsSegments||(this.boundsSegments=x.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Ht(n,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));for(const v in this.tiles){const w=this.tiles[v];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}loadTile(n,h){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},h(null)):(n.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Vn extends kn{constructor(n,h,v,w){super(n,h,v,w),this.roundZoom=!0,this.type="video",this.options=h}load(){this._loaded=!1;const n=this.options;this.urls=[];for(const h of n.urls)this.urls.push(this.map._requestManager.transformRequest(h,x.ResourceType.Source).url);x.getVideo(this.urls,(h,v)=>{this._loaded=!0,h?this.fire(new x.ErrorEvent(h)):v&&(this.video=v,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(n){if(this.video){const h=this.video.seekable;n<h.start(0)||n>h.end(0)?this.fire(new x.ErrorEvent(new x.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=n}}getVideo(){return this.video}onAdd(n){this.map||(this.map=n,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const n=this.map.painter.context,h=n.gl;this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,bn.members)),this.boundsSegments||(this.boundsSegments=x.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new Ht(n,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));for(const v in this.tiles){const w=this.tiles[v];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Nn extends kn{constructor(n,h,v,w){super(n,h,v,w),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(I=>!Array.isArray(I)||I.length!==2||I.some(L=>typeof L!="number"))||this.fire(new x.ErrorEvent(new x.ValidationError(`sources.${n}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new x.ErrorEvent(new x.ValidationError(`sources.${n}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new x.ErrorEvent(new x.ValidationError(`sources.${n}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new x.ErrorEvent(new x.ValidationError(`sources.${n}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new x.ErrorEvent(new x.ValidationError(`sources.${n}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new x.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(n){this.map=n,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let n=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,n=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,n=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,v=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,bn.members)),this.boundsSegments||(this.boundsSegments=x.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(n||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Ht(h,this.canvas,v.RGBA,{premultiply:!0});for(const w in this.tiles){const I=this.tiles[w];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const n of[this.canvas.width,this.canvas.height])if(isNaN(n)||n<=0)return!0;return!1}}const ao={vector:Un,raster:oo,"raster-dem":rn,geojson:pn,video:Vn,image:kn,canvas:Nn};function _r(b,n){const h=x.create();return x.translate(h,h,[1,1,0]),x.scale(h,h,[.5*b.width,.5*b.height,1]),x.multiply(h,h,b.calculatePosMatrix(n.toUnwrapped()))}function dn(b,n,h,v,w,I){const L=function(re,fe,Pe){if(re)for(const ye of re){const ze=fe[ye];if(ze&&ze.source===Pe&&ze.type==="fill-extrusion")return!0}else for(const ye in fe){const ze=fe[ye];if(ze.source===Pe&&ze.type==="fill-extrusion")return!0}return!1}(w&&w.layers,n,b.id),O=I.maxPitchScaleFactor(),N=b.tilesIn(v,O,L);N.sort(Bi);const $=[];for(const re of N)$.push({wrappedTileID:re.tileID.wrapped().key,queryResults:re.tile.queryRenderedFeatures(n,h,b._state,re.queryGeometry,re.cameraQueryGeometry,re.scale,w,I,O,_r(b.transform,re.tileID))});const H=function(re){const fe={},Pe={};for(const ye of re){const ze=ye.queryResults,Ve=ye.wrappedTileID,Fe=Pe[Ve]=Pe[Ve]||{};for(const Xe in ze){const je=ze[Xe],st=Fe[Xe]=Fe[Xe]||{},et=fe[Xe]=fe[Xe]||[];for(const rt of je)st[rt.featureIndex]||(st[rt.featureIndex]=!0,et.push(rt))}}return fe}($);for(const re in H)H[re].forEach(fe=>{const Pe=fe.feature,ye=b.getFeatureState(Pe.layer["source-layer"],Pe.id);Pe.source=Pe.layer.source,Pe.layer["source-layer"]&&(Pe.sourceLayer=Pe.layer["source-layer"]),Pe.state=ye});return H}function Bi(b,n){const h=b.tileID,v=n.tileID;return h.overscaledZ-v.overscaledZ||h.canonical.y-v.canonical.y||h.wrap-v.wrap||h.canonical.x-v.canonical.x}class so{constructor(n,h){this.tileID=n,this.uid=x.uniqueId(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(n){const h=n+this.timeAdded;h<x.exported.now()||this.fadeEndTime&&h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}loadVectorData(n,h,v){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(w,I){const L={};if(!I)return L;for(const O of w){const N=O.layerIds.map($=>I.getLayer($)).filter(Boolean);if(N.length!==0){O.layers=N,O.stateDependentLayerIds&&(O.stateDependentLayers=O.stateDependentLayerIds.map($=>N.filter(H=>H.id===$)[0]));for(const $ of N)L[$.id]=O}}return L}(n.buckets,h.style),this.hasSymbolBuckets=!1;for(const w in this.buckets){const I=this.buckets[w];if(I instanceof x.SymbolBucket){if(this.hasSymbolBuckets=!0,!v)break;I.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const w in this.buckets){const I=this.buckets[w];if(I instanceof x.SymbolBucket&&I.hasRTLText){this.hasRTLText=!0,x.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const w in this.buckets){const I=this.buckets[w];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(w).queryRadius(I))}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage)}else this.collisionBoxArray=new x.CollisionBoxArray}unloadVectorData(){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(n){return this.buckets[n.id]}upload(n){for(const v in this.buckets){const w=this.buckets[v];w.uploadPending()&&w.upload(n)}const h=n.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ht(n,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ht(n,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(n){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture)}queryRenderedFeatures(n,h,v,w,I,L,O,N,$,H){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:w,cameraQueryGeometry:I,scale:L,tileSize:this.tileSize,pixelPosMatrix:H,transform:N,params:O,queryPadding:this.queryPadding*$},n,h,v):{}}querySourceFeatures(n,h){const v=this.latestFeatureIndex;if(!v||!v.rawTileData)return;const w=v.loadVTLayers(),I=h?h.sourceLayer:"",L=w._geojsonTileLayer||w[I];if(!L)return;const O=x.createFilter(h&&h.filter),{z:N,x:$,y:H}=this.tileID.canonical,re={z:N,x:$,y:H};for(let fe=0;fe<L.length;fe++){const Pe=L.feature(fe);if(O.needGeometry){const Ve=x.toEvaluationFeature(Pe,!0);if(!O.filter(new x.EvaluationParameters(this.tileID.overscaledZ),Ve,this.tileID.canonical))continue}else if(!O.filter(new x.EvaluationParameters(this.tileID.overscaledZ),Pe))continue;const ye=v.getId(Pe,I),ze=new x.GeoJSONFeature(Pe,N,$,H,ye);ze.tile=re,n.push(ze)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){const h=this.expirationTime;if(n.cacheControl){const v=x.parseCacheControl(n.cacheControl);v["max-age"]&&(this.expirationTime=Date.now()+1e3*v["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const v=Date.now();let w=!1;if(this.expirationTime>v)w=!1;else if(h)if(this.expirationTime<h)w=!0;else{const I=this.expirationTime-h;I?this.expirationTime=v+Math.max(I,3e4):w=!0}else w=!0;w?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(n,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(n).length===0)return;const v=this.latestFeatureIndex.loadVTLayers();for(const w in this.buckets){if(!h.style.hasLayer(w))continue;const I=this.buckets[w],L=I.layers[0].sourceLayer||"_geojsonTileLayer",O=v[L],N=n[L];if(!O||!N||Object.keys(N).length===0)continue;I.update(N,O,this.imageAtlas&&this.imageAtlas.patternPositions||{});const $=h&&h.style&&h.style.getLayer(w);$&&(this.queryPadding=Math.max(this.queryPadding,$.queryRadius(I)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<x.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=x.exported.now()+n}setDependencies(n,h){const v={};for(const w of h)v[w]=!0;this.dependencies[n]=v}hasDependency(n,h){for(const v of n){const w=this.dependencies[v];if(w){for(const I of h)if(w[I])return!0}}return!1}}class Uo{constructor(n,h){this.max=n,this.onRemove=h,this.reset()}reset(){for(const n in this.data)for(const h of this.data[n])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(n,h,v){const w=n.wrapped().key;this.data[w]===void 0&&(this.data[w]=[]);const I={value:h,timeout:void 0};if(v!==void 0&&(I.timeout=setTimeout(()=>{this.remove(n,I)},v)),this.data[w].push(I),this.order.push(w),this.order.length>this.max){const L=this._getAndRemoveByKey(this.order[0]);L&&this.onRemove(L)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const h=this.data[n].shift();return h.timeout&&clearTimeout(h.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),h.value}getByKey(n){const h=this.data[n];return h?h[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,h){if(!this.has(n))return this;const v=n.wrapped().key,w=h===void 0?0:this.data[v].indexOf(h),I=this.data[v][w];return this.data[v].splice(w,1),I.timeout&&clearTimeout(I.timeout),this.data[v].length===0&&delete this.data[v],this.onRemove(I.value),this.order.splice(this.order.indexOf(v),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(n){const h=[];for(const v in this.data)for(const w of this.data[v])n(w.value)||h.push(w);for(const v of h)this.remove(v.value.tileID,v)}}class jn{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,h,v){const w=String(h);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][w]=this.stateChanges[n][w]||{},x.extend(this.stateChanges[n][w],v),this.deletedStates[n]===null){this.deletedStates[n]={};for(const I in this.state[n])I!==w&&(this.deletedStates[n][I]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][w]===null){this.deletedStates[n][w]={};for(const I in this.state[n][w])v[I]||(this.deletedStates[n][w][I]=null)}else for(const I in v)this.deletedStates[n]&&this.deletedStates[n][w]&&this.deletedStates[n][w][I]===null&&delete this.deletedStates[n][w][I]}removeFeatureState(n,h,v){if(this.deletedStates[n]===null)return;const w=String(h);if(this.deletedStates[n]=this.deletedStates[n]||{},v&&h!==void 0)this.deletedStates[n][w]!==null&&(this.deletedStates[n][w]=this.deletedStates[n][w]||{},this.deletedStates[n][w][v]=null);else if(h!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][w])for(v in this.deletedStates[n][w]={},this.stateChanges[n][w])this.deletedStates[n][w][v]=null;else this.deletedStates[n][w]=null;else this.deletedStates[n]=null}getState(n,h){const v=String(h),w=x.extend({},(this.state[n]||{})[v],(this.stateChanges[n]||{})[v]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){const I=this.deletedStates[n][h];if(I===null)return{};for(const L in I)delete w[L]}return w}initializeTileState(n,h){n.setFeatureState(this.state,h)}coalesceChanges(n,h){const v={};for(const w in this.stateChanges){this.state[w]=this.state[w]||{};const I={};for(const L in this.stateChanges[w])this.state[w][L]||(this.state[w][L]={}),x.extend(this.state[w][L],this.stateChanges[w][L]),I[L]=this.state[w][L];v[w]=I}for(const w in this.deletedStates){this.state[w]=this.state[w]||{};const I={};if(this.deletedStates[w]===null)for(const L in this.state[w])I[L]={},this.state[w][L]={};else for(const L in this.deletedStates[w]){if(this.deletedStates[w][L]===null)this.state[w][L]={};else for(const O of Object.keys(this.deletedStates[w][L]))delete this.state[w][L][O];I[L]=this.state[w][L]}v[w]=v[w]||{},x.extend(v[w],I)}if(this.stateChanges={},this.deletedStates={},Object.keys(v).length!==0)for(const w in n)n[w].setFeatureState(v,h)}}class ii extends x.Evented{constructor(n,h,v){super(),this.id=n,this.dispatcher=v,this.on("data",w=>{w.dataType==="source"&&w.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&w.dataType==="source"&&w.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(w,I,L,O){const N=new ao[I.type](w,I,L,O);if(N.id!==w)throw new Error(`Expected Source id to be ${w} instead of ${N.id}`);return x.bindAll(["load","abort","unload","serialize","prepare"],N),N}(n,h,v,this),this._tiles={},this._cache=new Uo(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new jn}onAdd(n){this.map=n,this._maxTileCacheSize=n?n._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(n)}onRemove(n){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(n)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles){const h=this._tiles[n];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,h){return this._source.loadTile(n,h)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n,()=>{})}_abortTile(n){this._source.abortTile&&this._source.abortTile(n,()=>{}),this._source.fire(new x.Event("dataabort",{tile:n,coord:n.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const v=this._tiles[h];v.upload(n),v.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(n=>n.tileID).sort(Mn).map(n=>n.key)}getRenderableIds(n){const h=[];for(const v in this._tiles)this._isIdRenderable(v,n)&&h.push(this._tiles[v]);return n?h.sort((v,w)=>{const I=v.tileID,L=w.tileID,O=new x.pointGeometry(I.canonical.x,I.canonical.y)._rotate(this.transform.angle),N=new x.pointGeometry(L.canonical.x,L.canonical.y)._rotate(this.transform.angle);return I.overscaledZ-L.overscaledZ||N.y-O.y||N.x-O.x}).map(v=>v.tileID.key):h.map(v=>v.tileID).sort(Mn).map(v=>v.key)}hasRenderableParent(n){const h=this.findLoadedParent(n,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(n,h){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(h||!this._tiles[n].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(n,"reloading")}}_reloadTile(n,h){const v=this._tiles[n];v&&(v.state!=="loading"&&(v.state=h),this._loadTile(v,this._tileLoaded.bind(this,v,n,h)))}_tileLoaded(n,h,v,w){if(w)return n.state="errored",void(w.status!==404?this._source.fire(new x.ErrorEvent(w,{tile:n})):this.update(this.transform));n.timeAdded=x.exported.now(),v==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(h,n),this.getSource().type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),n.aborted||this._source.fire(new x.Event("data",{dataType:"source",tile:n,coord:n.tileID}))}_backfillDEM(n){const h=this.getRenderableIds();for(let w=0;w<h.length;w++){const I=h[w];if(n.neighboringTiles&&n.neighboringTiles[I]){const L=this.getTileByID(I);v(n,L),v(L,n)}}function v(w,I){w.needsHillshadePrepare=!0;let L=I.tileID.canonical.x-w.tileID.canonical.x;const O=I.tileID.canonical.y-w.tileID.canonical.y,N=Math.pow(2,w.tileID.canonical.z),$=I.tileID.key;L===0&&O===0||Math.abs(O)>1||(Math.abs(L)>1&&(Math.abs(L+N)===1?L+=N:Math.abs(L-N)===1&&(L-=N)),I.dem&&w.dem&&(w.dem.backfillBorder(I.dem,L,O),w.neighboringTiles&&w.neighboringTiles[$]&&(w.neighboringTiles[$].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,h,v,w){for(const I in this._tiles){let L=this._tiles[I];if(w[I]||!L.hasData()||L.tileID.overscaledZ<=h||L.tileID.overscaledZ>v)continue;let O=L.tileID;for(;L&&L.tileID.overscaledZ>h+1;){const $=L.tileID.scaledTo(L.tileID.overscaledZ-1);L=this._tiles[$.key],L&&L.hasData()&&(O=$)}let N=O;for(;N.overscaledZ>h;)if(N=N.scaledTo(N.overscaledZ-1),n[N.key]){w[O.key]=O;break}}}findLoadedParent(n,h){if(n.key in this._loadedParentTiles){const v=this._loadedParentTiles[n.key];return v&&v.tileID.overscaledZ>=h?v:null}for(let v=n.overscaledZ-1;v>=h;v--){const w=n.scaledTo(v),I=this._getLoadedTile(w);if(I)return I}}_getLoadedTile(n){const h=this._tiles[n.key];return h&&h.hasData()?h:this._cache.getByKey(n.wrapped().key)}updateCacheSize(n){const h=Math.ceil(n.width/this._source.tileSize)+1,v=Math.ceil(n.height/this._source.tileSize)+1,w=Math.floor(h*v*5),I=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(I)}handleWrapJump(n){const h=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,h){const v={};for(const w in this._tiles){const I=this._tiles[w];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+h),v[I.tileID.key]=I}this._tiles=v;for(const w in this._timers)clearTimeout(this._timers[w]),delete this._timers[w];for(const w in this._tiles)this._setTileReloadTimer(w,this._tiles[w])}}update(n){if(this.transform=n,!this._sourceLoaded||this._paused)return;let h;this.updateCacheSize(n),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?h=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(N=>new x.OverscaledTileID(N.canonical.z,N.wrap,N.canonical.z,N.canonical.x,N.canonical.y)):(h=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(h=h.filter(N=>this._source.hasTile(N)))):h=[];const v=n.coveringZoomLevel(this._source),w=Math.max(v-ii.maxOverzooming,this._source.minzoom),I=Math.max(v+ii.maxUnderzooming,this._source.minzoom),L=this._updateRetainedTiles(h,v);if(Gr(this._source.type)){const N={},$={},H=Object.keys(L);for(const re of H){const fe=L[re],Pe=this._tiles[re];if(!Pe||Pe.fadeEndTime&&Pe.fadeEndTime<=x.exported.now())continue;const ye=this.findLoadedParent(fe,w);ye&&(this._addTile(ye.tileID),N[ye.tileID.key]=ye.tileID),$[re]=fe}this._retainLoadedChildren($,v,I,L);for(const re in N)L[re]||(this._coveredTiles[re]=!0,L[re]=N[re])}for(const N in L)this._tiles[N].clearFadeHold();const O=x.keysDifference(this._tiles,L);for(const N of O){const $=this._tiles[N];$.hasSymbolBuckets&&!$.holdingForFade()?$.setHoldDuration(this.map._fadeDuration):$.hasSymbolBuckets&&!$.symbolFadeFinished()||this._removeTile(N)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(n)}_updateRetainedTiles(n,h){const v={},w={},I=Math.max(h-ii.maxOverzooming,this._source.minzoom),L=Math.max(h+ii.maxUnderzooming,this._source.minzoom),O={};for(const N of n){const $=this._addTile(N);v[N.key]=N,$.hasData()||h<this._source.maxzoom&&(O[N.key]=N)}this._retainLoadedChildren(O,h,L,v);for(const N of n){let $=this._tiles[N.key];if($.hasData())continue;if(h+1>this._source.maxzoom){const re=N.children(this._source.maxzoom)[0],fe=this.getTile(re);if(fe&&fe.hasData()){v[re.key]=re;continue}}else{const re=N.children(this._source.maxzoom);if(v[re[0].key]&&v[re[1].key]&&v[re[2].key]&&v[re[3].key])continue}let H=$.wasRequested();for(let re=N.overscaledZ-1;re>=I;--re){const fe=N.scaledTo(re);if(w[fe.key]||(w[fe.key]=!0,$=this.getTile(fe),!$&&H&&($=this._addTile(fe)),$&&(v[fe.key]=fe,H=$.wasRequested(),$.hasData())))break}}return v}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const h=[];let v,w=this._tiles[n].tileID;for(;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){v=this._loadedParentTiles[w.key];break}h.push(w.key);const I=w.scaledTo(w.overscaledZ-1);if(v=this._getLoadedTile(I),v)break;w=I}for(const I of h)this._loadedParentTiles[I]=v}}_addTile(n){let h=this._tiles[n.key];if(h)return h;h=this._cache.getAndRemove(n),h&&(this._setTileReloadTimer(n.key,h),h.tileID=n,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,h)));const v=h;return h||(h=new so(n,this._source.tileSize*n.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,n.key,h.state))),h.uses++,this._tiles[n.key]=h,v||this._source.fire(new x.Event("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(n,h){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const v=h.getExpiryTimeout();v&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},v))}_removeTile(n){const h=this._tiles[n];h&&(h.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(n);this._cache.reset()}tilesIn(n,h,v){const w=[],I=this.transform;if(!I)return w;const L=v?I.getCameraQueryGeometry(n):n,O=n.map(ye=>I.pointCoordinate(ye)),N=L.map(ye=>I.pointCoordinate(ye)),$=this.getIds();let H=1/0,re=1/0,fe=-1/0,Pe=-1/0;for(const ye of N)H=Math.min(H,ye.x),re=Math.min(re,ye.y),fe=Math.max(fe,ye.x),Pe=Math.max(Pe,ye.y);for(let ye=0;ye<$.length;ye++){const ze=this._tiles[$[ye]];if(ze.holdingForFade())continue;const Ve=ze.tileID,Fe=Math.pow(2,I.zoom-ze.tileID.overscaledZ),Xe=h*ze.queryPadding*x.EXTENT/ze.tileSize/Fe,je=[Ve.getTilePoint(new x.MercatorCoordinate(H,re)),Ve.getTilePoint(new x.MercatorCoordinate(fe,Pe))];if(je[0].x-Xe<x.EXTENT&&je[0].y-Xe<x.EXTENT&&je[1].x+Xe>=0&&je[1].y+Xe>=0){const st=O.map(rt=>Ve.getTilePoint(rt)),et=N.map(rt=>Ve.getTilePoint(rt));w.push({tile:ze,tileID:Ve,queryGeometry:st,cameraQueryGeometry:et,scale:Fe})}}return w}getVisibleCoordinates(n){const h=this.getRenderableIds(n).map(v=>this._tiles[v].tileID);for(const v of h)v.posMatrix=this.transform.calculatePosMatrix(v.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(Gr(this._source.type))for(const n in this._tiles){const h=this._tiles[n];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=x.exported.now())return!0}return!1}setFeatureState(n,h,v){this._state.updateState(n=n||"_geojsonTileLayer",h,v)}removeFeatureState(n,h,v){this._state.removeFeatureState(n=n||"_geojsonTileLayer",h,v)}getFeatureState(n,h){return this._state.getState(n=n||"_geojsonTileLayer",h)}setDependencies(n,h,v){const w=this._tiles[n];w&&w.setDependencies(h,v)}reloadTilesForDependencies(n,h){for(const v in this._tiles)this._tiles[v].hasDependency(n,h)&&this._reloadTile(v,"reloading");this._cache.filter(v=>!v.hasDependency(n,h))}}function Mn(b,n){const h=Math.abs(2*b.wrap)-+(b.wrap<0),v=Math.abs(2*n.wrap)-+(n.wrap<0);return b.overscaledZ-n.overscaledZ||v-h||n.canonical.y-b.canonical.y||n.canonical.x-b.canonical.x}function Gr(b){return b==="raster"||b==="image"||b==="video"}ii.maxOverzooming=10,ii.maxUnderzooming=3;const nn="mapboxgl_preloaded_worker_pool";class vo{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<vo.workerCount;)this.workers.push(new Worker(Bn.workerUrl));return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[nn]}numActive(){return Object.keys(this.active).length}}const qn=Math.floor(x.exported.hardwareConcurrency/2);let lo;function Dr(){return lo||(lo=new vo),lo}function wn(b,n){const h={};for(const v in b)v!=="ref"&&(h[v]=b[v]);return x.refProperties.forEach(v=>{v in n&&(h[v]=n[v])}),h}function Vo(b){b=b.slice();const n=Object.create(null);for(let h=0;h<b.length;h++)n[b[h].id]=b[h];for(let h=0;h<b.length;h++)"ref"in b[h]&&(b[h]=wn(b[h],n[b[h].ref]));return b}vo.workerCount=Math.max(Math.min(qn,6),1);const yi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function on(b,n,h){h.push({command:yi.addSource,args:[b,n[b]]})}function Gn(b,n,h){n.push({command:yi.removeSource,args:[b]}),h[b]=!0}function fn(b,n,h,v){Gn(b,h,v),on(b,n,h)}function xa(b,n,h){let v;for(v in b[h])if(Object.prototype.hasOwnProperty.call(b[h],v)&&v!=="data"&&!Qe(b[h][v],n[h][v]))return!1;for(v in n[h])if(Object.prototype.hasOwnProperty.call(n[h],v)&&v!=="data"&&!Qe(b[h][v],n[h][v]))return!1;return!0}function ot(b,n,h,v,w,I){let L;for(L in n=n||{},b=b||{})Object.prototype.hasOwnProperty.call(b,L)&&(Qe(b[L],n[L])||h.push({command:I,args:[v,L,n[L],w]}));for(L in n)Object.prototype.hasOwnProperty.call(n,L)&&!Object.prototype.hasOwnProperty.call(b,L)&&(Qe(b[L],n[L])||h.push({command:I,args:[v,L,n[L],w]}))}function Lt(b){return b.id}function zo(b,n){return b[n.id]=n,b}class Zn{constructor(n,h){this.reset(n,h)}reset(n,h){this.points=n||[],this._distances=[0];for(let v=1;v<this.points.length;v++)this._distances[v]=this._distances[v-1]+this.points[v].dist(this.points[v-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=x.clamp(n,0,1);let h=1,v=this._distances[h];const w=n*this.paddedLength+this.padding;for(;v<w&&h<this._distances.length;)v=this._distances[++h];const I=h-1,L=this._distances[I],O=v-L,N=O>0?(w-L)/O:0;return this.points[I].mult(1-N).add(this.points[h].mult(N))}}function Ki(b,n){let h=!0;return b==="always"||b!=="never"&&n!=="never"||(h=!1),h}class mn{constructor(n,h,v){const w=this.boxCells=[],I=this.circleCells=[];this.xCellCount=Math.ceil(n/v),this.yCellCount=Math.ceil(h/v);for(let L=0;L<this.xCellCount*this.yCellCount;L++)w.push([]),I.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=h,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,h,v,w,I){this._forEachCell(h,v,w,I,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(h),this.bboxes.push(v),this.bboxes.push(w),this.bboxes.push(I)}insertCircle(n,h,v,w){this._forEachCell(h-w,v-w,h+w,v+w,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(h),this.circles.push(v),this.circles.push(w)}_insertBoxCell(n,h,v,w,I,L){this.boxCells[I].push(L)}_insertCircleCell(n,h,v,w,I,L){this.circleCells[I].push(L)}_query(n,h,v,w,I,L,O){if(v<0||n>this.width||w<0||h>this.height)return[];const N=[];if(n<=0&&h<=0&&this.width<=v&&this.height<=w){if(I)return[{key:null,x1:n,y1:h,x2:v,y2:w}];for(let $=0;$<this.boxKeys.length;$++)N.push({key:this.boxKeys[$],x1:this.bboxes[4*$],y1:this.bboxes[4*$+1],x2:this.bboxes[4*$+2],y2:this.bboxes[4*$+3]});for(let $=0;$<this.circleKeys.length;$++){const H=this.circles[3*$],re=this.circles[3*$+1],fe=this.circles[3*$+2];N.push({key:this.circleKeys[$],x1:H-fe,y1:re-fe,x2:H+fe,y2:re+fe})}}else this._forEachCell(n,h,v,w,this._queryCell,N,{hitTest:I,overlapMode:L,seenUids:{box:{},circle:{}}},O);return N}query(n,h,v,w){return this._query(n,h,v,w,!1,null)}hitTest(n,h,v,w,I,L){return this._query(n,h,v,w,!0,I,L).length>0}hitTestCircle(n,h,v,w,I){const L=n-v,O=n+v,N=h-v,$=h+v;if(O<0||L>this.width||$<0||N>this.height)return!1;const H=[];return this._forEachCell(L,N,O,$,this._queryCellCircle,H,{hitTest:!0,overlapMode:w,circle:{x:n,y:h,radius:v},seenUids:{box:{},circle:{}}},I),H.length>0}_queryCell(n,h,v,w,I,L,O,N){const{seenUids:$,hitTest:H,overlapMode:re}=O,fe=this.boxCells[I];if(fe!==null){const ye=this.bboxes;for(const ze of fe)if(!$.box[ze]){$.box[ze]=!0;const Ve=4*ze,Fe=this.boxKeys[ze];if(n<=ye[Ve+2]&&h<=ye[Ve+3]&&v>=ye[Ve+0]&&w>=ye[Ve+1]&&(!N||N(Fe))&&(!H||!Ki(re,Fe.overlapMode))&&(L.push({key:Fe,x1:ye[Ve],y1:ye[Ve+1],x2:ye[Ve+2],y2:ye[Ve+3]}),H))return!0}}const Pe=this.circleCells[I];if(Pe!==null){const ye=this.circles;for(const ze of Pe)if(!$.circle[ze]){$.circle[ze]=!0;const Ve=3*ze,Fe=this.circleKeys[ze];if(this._circleAndRectCollide(ye[Ve],ye[Ve+1],ye[Ve+2],n,h,v,w)&&(!N||N(Fe))&&(!H||!Ki(re,Fe.overlapMode))){const Xe=ye[Ve],je=ye[Ve+1],st=ye[Ve+2];if(L.push({key:Fe,x1:Xe-st,y1:je-st,x2:Xe+st,y2:je+st}),H)return!0}}}return!1}_queryCellCircle(n,h,v,w,I,L,O,N){const{circle:$,seenUids:H,overlapMode:re}=O,fe=this.boxCells[I];if(fe!==null){const ye=this.bboxes;for(const ze of fe)if(!H.box[ze]){H.box[ze]=!0;const Ve=4*ze,Fe=this.boxKeys[ze];if(this._circleAndRectCollide($.x,$.y,$.radius,ye[Ve+0],ye[Ve+1],ye[Ve+2],ye[Ve+3])&&(!N||N(Fe))&&!Ki(re,Fe.overlapMode))return L.push(!0),!0}}const Pe=this.circleCells[I];if(Pe!==null){const ye=this.circles;for(const ze of Pe)if(!H.circle[ze]){H.circle[ze]=!0;const Ve=3*ze,Fe=this.circleKeys[ze];if(this._circlesCollide(ye[Ve],ye[Ve+1],ye[Ve+2],$.x,$.y,$.radius)&&(!N||N(Fe))&&!Ki(re,Fe.overlapMode))return L.push(!0),!0}}}_forEachCell(n,h,v,w,I,L,O,N){const $=this._convertToXCellCoord(n),H=this._convertToYCellCoord(h),re=this._convertToXCellCoord(v),fe=this._convertToYCellCoord(w);for(let Pe=$;Pe<=re;Pe++)for(let ye=H;ye<=fe;ye++)if(I.call(this,n,h,v,w,this.xCellCount*ye+Pe,L,O,N))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,h,v,w,I,L){const O=w-n,N=I-h,$=v+L;return $*$>O*O+N*N}_circleAndRectCollide(n,h,v,w,I,L,O){const N=(L-w)/2,$=Math.abs(n-(w+N));if($>N+v)return!1;const H=(O-I)/2,re=Math.abs(h-(I+H));if(re>H+v)return!1;if($<=N||re<=H)return!0;const fe=$-N,Pe=re-H;return fe*fe+Pe*Pe<=v*v}}function Zr(b,n,h,v,w){const I=x.create();return n?(x.scale(I,I,[1/w,1/w,1]),h||x.rotateZ(I,I,v.angle)):x.multiply(I,v.labelPlaneMatrix,b),I}function uo(b,n,h,v,w){if(n){const I=x.clone(b);return x.scale(I,I,[w,w,1]),h||x.rotateZ(I,I,-v.angle),I}return v.glCoordMatrix}function er(b,n){const h=[b.x,b.y,0,1];Y(h,h,n);const v=h[3];return{point:new x.pointGeometry(h[0]/v,h[1]/v),signedDistanceFromCamera:v}}function Ct(b,n){return .5+b/n*.5}function Ti(b,n){const h=b[0]/b[3],v=b[1]/b[3];return h>=-n[0]&&h<=n[0]&&v>=-n[1]&&v<=n[1]}function gi(b,n,h,v,w,I,L,O,N){const $=v?b.textSizeData:b.iconSizeData,H=x.evaluateSizeForZoom($,h.transform.zoom),re=[256/h.width*2+1,256/h.height*2+1],fe=v?b.text.dynamicLayoutVertexArray:b.icon.dynamicLayoutVertexArray;fe.clear();const Pe=b.lineVertexArray,ye=v?b.text.placedSymbolArray:b.icon.placedSymbolArray,ze=h.transform.width/h.transform.height;let Ve=!1;for(let Fe=0;Fe<ye.length;Fe++){const Xe=ye.get(Fe);if(Xe.hidden||Xe.writingMode===x.WritingMode.vertical&&!Ve){X(Xe.numGlyphs,fe);continue}Ve=!1;const je=[Xe.anchorX,Xe.anchorY,0,1];if(x.transformMat4(je,je,n),!Ti(je,re)){X(Xe.numGlyphs,fe);continue}const st=Ct(h.transform.cameraToCenterDistance,je[3]),et=x.evaluateSizeForFeature($,H,Xe),rt=L?et/st:et*st,mt=new x.pointGeometry(Xe.anchorX,Xe.anchorY),xt=er(mt,w).point,lt={},qt=ui(Xe,rt,!1,O,n,w,I,b.glyphOffsetArray,Pe,fe,xt,mt,lt,ze,N);Ve=qt.useVertical,(qt.notEnoughRoom||Ve||qt.needsFlipping&&ui(Xe,rt,!0,O,n,w,I,b.glyphOffsetArray,Pe,fe,xt,mt,lt,ze,N).notEnoughRoom)&&X(Xe.numGlyphs,fe)}v?b.text.dynamicLayoutVertexBuffer.updateData(fe):b.icon.dynamicLayoutVertexBuffer.updateData(fe)}function Rr(b,n,h,v,w,I,L,O,N,$,H,re){const fe=O.glyphStartIndex+O.numGlyphs,Pe=O.lineStartIndex,ye=O.lineStartIndex+O.lineLength,ze=n.getoffsetX(O.glyphStartIndex),Ve=n.getoffsetX(fe-1),Fe=Ln(b*ze,h,v,w,I,L,O.segment,Pe,ye,N,$,H,re);if(!Fe)return null;const Xe=Ln(b*Ve,h,v,w,I,L,O.segment,Pe,ye,N,$,H,re);return Xe?{first:Fe,last:Xe}:null}function $r(b,n,h,v){return b===x.WritingMode.horizontal&&Math.abs(h.y-n.y)>Math.abs(h.x-n.x)*v?{useVertical:!0}:(b===x.WritingMode.vertical?n.y<h.y:n.x>h.x)?{needsFlipping:!0}:null}function ui(b,n,h,v,w,I,L,O,N,$,H,re,fe,Pe,ye){const ze=n/24,Ve=b.lineOffsetX*ze,Fe=b.lineOffsetY*ze;let Xe;if(b.numGlyphs>1){const je=b.glyphStartIndex+b.numGlyphs,st=b.lineStartIndex,et=b.lineStartIndex+b.lineLength,rt=Rr(ze,O,Ve,Fe,h,H,re,b,N,I,fe,ye);if(!rt)return{notEnoughRoom:!0};const mt=er(rt.first.point,L).point,xt=er(rt.last.point,L).point;if(v&&!h){const lt=$r(b.writingMode,mt,xt,Pe);if(lt)return lt}Xe=[rt.first];for(let lt=b.glyphStartIndex+1;lt<je-1;lt++)Xe.push(Ln(ze*O.getoffsetX(lt),Ve,Fe,h,H,re,b.segment,st,et,N,I,fe,ye));Xe.push(rt.last)}else{if(v&&!h){const st=er(re,w).point,et=b.lineStartIndex+b.segment+1,rt=new x.pointGeometry(N.getx(et),N.gety(et)),mt=er(rt,w),xt=mt.signedDistanceFromCamera>0?mt.point:xo(re,rt,st,1,w),lt=$r(b.writingMode,st,xt,Pe);if(lt)return lt}const je=Ln(ze*O.getoffsetX(b.glyphStartIndex),Ve,Fe,h,H,re,b.segment,b.lineStartIndex,b.lineStartIndex+b.lineLength,N,I,fe,ye);if(!je)return{notEnoughRoom:!0};Xe=[je]}for(const je of Xe)x.addDynamicAttributes($,je.point,je.angle);return{}}function xo(b,n,h,v,w){const I=er(b.add(b.sub(n)._unit()),w).point,L=h.sub(I);return h.add(L._mult(v/L.mag()))}function Ln(b,n,h,v,w,I,L,O,N,$,H,re,fe){const Pe=v?b-n:b+n;let ye=Pe>0?1:-1,ze=0;v&&(ye*=-1,ze=Math.PI),ye<0&&(ze+=Math.PI);let Ve=ye>0?O+L:O+L+1,Fe=w,Xe=w,je=0,st=0;const et=Math.abs(Pe),rt=[];for(;je+st<=et;){if(Ve+=ye,Ve<O||Ve>=N)return null;if(Xe=Fe,rt.push(Fe),Fe=re[Ve],Fe===void 0){const Rt=new x.pointGeometry($.getx(Ve),$.gety(Ve)),li=er(Rt,H);if(li.signedDistanceFromCamera>0)Fe=re[Ve]=li.point;else{const s=Ve-ye;Fe=xo(je===0?I:new x.pointGeometry($.getx(s),$.gety(s)),Rt,Xe,et-je+1,H)}}je+=st,st=Xe.dist(Fe)}const mt=(et-je)/st,xt=Fe.sub(Xe),lt=xt.mult(mt)._add(Xe);lt._add(xt._unit()._perp()._mult(h*ye));const qt=ze+Math.atan2(Fe.y-Xe.y,Fe.x-Xe.x);return rt.push(lt),{point:lt,angle:fe?qt:0,path:rt}}const Ji=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function X(b,n){for(let h=0;h<b;h++){const v=n.length;n.resize(v+4),n.float32.set(Ji,3*v)}}function Y(b,n,h){const v=n[0],w=n[1];return b[0]=h[0]*v+h[4]*w+h[12],b[1]=h[1]*v+h[5]*w+h[13],b[3]=h[3]*v+h[7]*w+h[15],b}const ie=100;class pe{constructor(n,h=new mn(n.width+200,n.height+200,25),v=new mn(n.width+200,n.height+200,25)){this.transform=n,this.grid=h,this.ignoredGrid=v,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+ie,this.screenBottomBoundary=n.height+ie,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200}placeCollisionBox(n,h,v,w,I){const L=this.projectAndGetPerspectiveRatio(w,n.anchorPointX,n.anchorPointY),O=v*L.perspectiveRatio,N=n.x1*O+L.point.x,$=n.y1*O+L.point.y,H=n.x2*O+L.point.x,re=n.y2*O+L.point.y;return!this.isInsideGrid(N,$,H,re)||h!=="always"&&this.grid.hitTest(N,$,H,re,h,I)?{box:[],offscreen:!1}:{box:[N,$,H,re],offscreen:this.isOffscreen(N,$,H,re)}}placeCollisionCircles(n,h,v,w,I,L,O,N,$,H,re,fe,Pe){const ye=[],ze=new x.pointGeometry(h.anchorX,h.anchorY),Ve=er(ze,L),Fe=Ct(this.transform.cameraToCenterDistance,Ve.signedDistanceFromCamera),Xe=(H?I/Fe:I*Fe)/x.ONE_EM,je=er(ze,O).point,st=Rr(Xe,w,h.lineOffsetX*Xe,h.lineOffsetY*Xe,!1,je,ze,h,v,O,{},!1);let et=!1,rt=!1,mt=!0;if(st){const xt=.5*fe*Fe+Pe,lt=new x.pointGeometry(-100,-100),qt=new x.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Rt=new Zn,li=st.first,s=st.last;let c=[];for(let S=li.path.length-1;S>=1;S--)c.push(li.path[S]);for(let S=1;S<s.path.length;S++)c.push(s.path[S]);const u=2.5*xt;if(N){const S=c.map(A=>er(A,N));c=S.some(A=>A.signedDistanceFromCamera<=0)?[]:S.map(A=>A.point)}let f=[];if(c.length>0){const S=c[0].clone(),A=c[0].clone();for(let z=1;z<c.length;z++)S.x=Math.min(S.x,c[z].x),S.y=Math.min(S.y,c[z].y),A.x=Math.max(A.x,c[z].x),A.y=Math.max(A.y,c[z].y);f=S.x>=lt.x&&A.x<=qt.x&&S.y>=lt.y&&A.y<=qt.y?[c]:A.x<lt.x||S.x>qt.x||A.y<lt.y||S.y>qt.y?[]:x.clipLine([c],lt.x,lt.y,qt.x,qt.y)}for(const S of f){Rt.reset(S,.25*xt);let A=0;A=Rt.length<=.5*xt?1:Math.ceil(Rt.paddedLength/u)+1;for(let z=0;z<A;z++){const B=z/Math.max(A-1,1),q=Rt.lerp(B),W=q.x+ie,oe=q.y+ie;ye.push(W,oe,xt,0);const se=W-xt,ue=oe-xt,Ee=W+xt,be=oe+xt;if(mt=mt&&this.isOffscreen(se,ue,Ee,be),rt=rt||this.isInsideGrid(se,ue,Ee,be),n!=="always"&&this.grid.hitTestCircle(W,oe,xt,n,re)&&(et=!0,!$))return{circles:[],offscreen:!1,collisionDetected:et}}}}return{circles:!$&&et||!rt?[]:ye,offscreen:mt,collisionDetected:et}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let v=1/0,w=1/0,I=-1/0,L=-1/0;for(const H of n){const re=new x.pointGeometry(H.x+ie,H.y+ie);v=Math.min(v,re.x),w=Math.min(w,re.y),I=Math.max(I,re.x),L=Math.max(L,re.y),h.push(re)}const O=this.grid.query(v,w,I,L).concat(this.ignoredGrid.query(v,w,I,L)),N={},$={};for(const H of O){const re=H.key;if(N[re.bucketInstanceId]===void 0&&(N[re.bucketInstanceId]={}),N[re.bucketInstanceId][re.featureIndex])continue;const fe=[new x.pointGeometry(H.x1,H.y1),new x.pointGeometry(H.x2,H.y1),new x.pointGeometry(H.x2,H.y2),new x.pointGeometry(H.x1,H.y2)];x.polygonIntersectsPolygon(h,fe)&&(N[re.bucketInstanceId][re.featureIndex]=!0,$[re.bucketInstanceId]===void 0&&($[re.bucketInstanceId]=[]),$[re.bucketInstanceId].push(re.featureIndex))}return $}insertCollisionBox(n,h,v,w,I,L){(v?this.ignoredGrid:this.grid).insert({bucketInstanceId:w,featureIndex:I,collisionGroupID:L,overlapMode:h},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,h,v,w,I,L){const O=v?this.ignoredGrid:this.grid,N={bucketInstanceId:w,featureIndex:I,collisionGroupID:L,overlapMode:h};for(let $=0;$<n.length;$+=4)O.insertCircle(N,n[$],n[$+1],n[$+2])}projectAndGetPerspectiveRatio(n,h,v){const w=[h,v,0,1];return Y(w,w,n),{point:new x.pointGeometry((w[0]/w[3]+1)/2*this.transform.width+ie,(-w[1]/w[3]+1)/2*this.transform.height+ie),perspectiveRatio:.5+this.transform.cameraToCenterDistance/w[3]*.5}}isOffscreen(n,h,v,w){return v<ie||n>=this.screenRightBoundary||w<ie||h>this.screenBottomBoundary}isInsideGrid(n,h,v,w){return v>=0&&n<this.gridRightBoundary&&w>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const n=x.identity([]);return x.translate(n,n,[-100,-100,0]),n}}function xe(b,n,h){return n*(x.EXTENT/(b.tileSize*Math.pow(2,h-b.tileID.overscaledZ)))}class Me{constructor(n,h,v,w){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?h:-h))):w&&v?1:0,this.placed=v}isHidden(){return this.opacity===0&&!this.placed}}class De{constructor(n,h,v,w,I){this.text=new Me(n?n.text:null,h,v,I),this.icon=new Me(n?n.icon:null,h,w,I)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ce{constructor(n,h,v){this.text=n,this.icon=h,this.skipFade=v}}class Ie{constructor(){this.invProjMatrix=x.create(),this.viewportMatrix=x.create(),this.circles=[]}}class qe{constructor(n,h,v,w,I){this.bucketInstanceId=n,this.featureIndex=h,this.sourceLayerIndex=v,this.bucketIndex=w,this.tileID=I}}class Q{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const h=++this.maxGroupID;this.collisionGroups[n]={ID:h,predicate:v=>v.collisionGroupID===h}}return this.collisionGroups[n]}}function F(b,n,h,v,w){const{horizontalAlign:I,verticalAlign:L}=x.getAnchorAlignment(b),O=-(I-.5)*n,N=-(L-.5)*h,$=x.evaluateVariableOffset(b,v);return new x.pointGeometry(O+$[0]*w,N+$[1]*w)}function U(b,n,h,v,w,I){const{x1:L,x2:O,y1:N,y2:$,anchorPointX:H,anchorPointY:re}=b,fe=new x.pointGeometry(n,h);return v&&fe._rotate(w?I:-I),{x1:L+fe.x,y1:N+fe.y,x2:O+fe.x,y2:$+fe.y,anchorPointX:H,anchorPointY:re}}class J{constructor(n,h,v,w){this.transform=n.clone(),this.collisionIndex=new pe(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new Q(v),this.collisionCircleArrays={},this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,h,v,w){const I=v.getBucket(h),L=v.latestFeatureIndex;if(!I||!L||h.id!==I.layerIds[0])return;const O=v.collisionBoxArray,N=I.layers[0].layout,$=Math.pow(2,this.transform.zoom-v.tileID.overscaledZ),H=v.tileSize/x.EXTENT,re=this.transform.calculatePosMatrix(v.tileID.toUnwrapped()),fe=N.get("text-pitch-alignment")==="map",Pe=N.get("text-rotation-alignment")==="map",ye=xe(v,1,this.transform.zoom),ze=Zr(re,fe,Pe,this.transform,ye);let Ve=null;if(fe){const Xe=uo(re,fe,Pe,this.transform,ye);Ve=x.multiply([],this.transform.labelPlaneMatrix,Xe)}this.retainedQueryData[I.bucketInstanceId]=new qe(I.bucketInstanceId,L,I.sourceLayerIndex,I.index,v.tileID);const Fe={bucket:I,layout:N,posMatrix:re,textLabelPlaneMatrix:ze,labelToScreenMatrix:Ve,scale:$,textPixelRatio:H,holdingForFade:v.holdingForFade(),collisionBoxArray:O,partiallyEvaluatedTextSize:x.evaluateSizeForZoom(I.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(I.sourceID)};if(w)for(const Xe of I.sortKeyRanges){const{sortKey:je,symbolInstanceStart:st,symbolInstanceEnd:et}=Xe;n.push({sortKey:je,symbolInstanceStart:st,symbolInstanceEnd:et,parameters:Fe})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:I.symbolInstances.length,parameters:Fe})}attemptAnchorPlacement(n,h,v,w,I,L,O,N,$,H,re,fe,Pe,ye,ze){const Ve=[fe.textOffset0,fe.textOffset1],Fe=F(n,v,w,Ve,I),Xe=this.collisionIndex.placeCollisionBox(U(h,Fe.x,Fe.y,L,O,this.transform.angle),re,N,$,H.predicate);if((!ze||this.collisionIndex.placeCollisionBox(U(ze,Fe.x,Fe.y,L,O,this.transform.angle),re,N,$,H.predicate).box.length!==0)&&Xe.box.length>0){let je;return this.prevPlacement&&this.prevPlacement.variableOffsets[fe.crossTileID]&&this.prevPlacement.placements[fe.crossTileID]&&this.prevPlacement.placements[fe.crossTileID].text&&(je=this.prevPlacement.variableOffsets[fe.crossTileID].anchor),this.variableOffsets[fe.crossTileID]={textOffset:Ve,width:v,height:w,anchor:n,textBoxScale:I,prevAnchor:je},this.markUsedJustification(Pe,n,fe,ye),Pe.allowVerticalPlacement&&(this.markUsedOrientation(Pe,ye,fe),this.placedOrientations[fe.crossTileID]=ye),{shift:Fe,placedGlyphBoxes:Xe}}}placeLayerBucketPart(n,h,v){const{bucket:w,layout:I,posMatrix:L,textLabelPlaneMatrix:O,labelToScreenMatrix:N,textPixelRatio:$,holdingForFade:H,collisionBoxArray:re,partiallyEvaluatedTextSize:fe,collisionGroup:Pe}=n.parameters,ye=I.get("text-optional"),ze=I.get("icon-optional"),Ve=x.getOverlapMode(I,"text-overlap","text-allow-overlap"),Fe=Ve==="always",Xe=x.getOverlapMode(I,"icon-overlap","icon-allow-overlap"),je=Xe==="always",st=I.get("text-rotation-alignment")==="map",et=I.get("text-pitch-alignment")==="map",rt=I.get("icon-text-fit")!=="none",mt=I.get("symbol-z-order")==="viewport-y",xt=Fe&&(je||!w.hasIconData()||ze),lt=je&&(Fe||!w.hasTextData()||ye);!w.collisionArrays&&re&&w.deserializeCollisionBoxes(re);const qt=(Rt,li)=>{if(h[Rt.crossTileID])return;if(H)return void(this.placements[Rt.crossTileID]=new ce(!1,!1,!1));let s=!1,c=!1,u=!0,f=null,S={box:null,offscreen:null},A={box:null,offscreen:null},z=null,B=null,q=null,W=0,oe=0,se=0;li.textFeatureIndex?W=li.textFeatureIndex:Rt.useRuntimeCollisionCircles&&(W=Rt.featureIndex),li.verticalTextFeatureIndex&&(oe=li.verticalTextFeatureIndex);const ue=li.textBox;if(ue){const Ce=Te=>{let Le=x.WritingMode.horizontal;if(w.allowVerticalPlacement&&!Te&&this.prevPlacement){const Ne=this.prevPlacement.placedOrientations[Rt.crossTileID];Ne&&(this.placedOrientations[Rt.crossTileID]=Ne,Le=Ne,this.markUsedOrientation(w,Le,Rt))}return Le},me=(Te,Le)=>{if(w.allowVerticalPlacement&&Rt.numVerticalGlyphVertices>0&&li.verticalTextBox){for(const Ne of w.writingModes)if(Ne===x.WritingMode.vertical?(S=Le(),A=S):S=Te(),S&&S.box&&S.box.length)break}else S=Te()};if(I.get("text-variable-anchor")){let Te=I.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Rt.crossTileID]){const We=this.prevPlacement.variableOffsets[Rt.crossTileID];Te.indexOf(We.anchor)>0&&(Te=Te.filter(He=>He!==We.anchor),Te.unshift(We.anchor))}const Le=(We,He,Je)=>{const ut=We.x2-We.x1,_t=We.y2-We.y1,gt=Rt.textBoxScale,Mt=rt&&Xe==="never"?He:null;let Zt={box:[],offscreen:!1};const Wt=Ve!=="never"?2*Te.length:Te.length;for(let Gt=0;Gt<Wt;++Gt){const Ai=this.attemptAnchorPlacement(Te[Gt%Te.length],We,ut,_t,gt,st,et,$,L,Pe,Gt>=Te.length?Ve:"never",Rt,w,Je,Mt);if(Ai&&(Zt=Ai.placedGlyphBoxes,Zt&&Zt.box&&Zt.box.length)){s=!0,f=Ai.shift;break}}return Zt};me(()=>Le(ue,li.iconBox,x.WritingMode.horizontal),()=>{const We=li.verticalTextBox;return w.allowVerticalPlacement&&!(S&&S.box&&S.box.length)&&Rt.numVerticalGlyphVertices>0&&We?Le(We,li.verticalIconBox,x.WritingMode.vertical):{box:null,offscreen:null}}),S&&(s=S.box,u=S.offscreen);const Ne=Ce(S&&S.box);if(!s&&this.prevPlacement){const We=this.prevPlacement.variableOffsets[Rt.crossTileID];We&&(this.variableOffsets[Rt.crossTileID]=We,this.markUsedJustification(w,We.anchor,Rt,Ne))}}else{const Te=(Le,Ne)=>{const We=this.collisionIndex.placeCollisionBox(Le,Ve,$,L,Pe.predicate);return We&&We.box&&We.box.length&&(this.markUsedOrientation(w,Ne,Rt),this.placedOrientations[Rt.crossTileID]=Ne),We};me(()=>Te(ue,x.WritingMode.horizontal),()=>{const Le=li.verticalTextBox;return w.allowVerticalPlacement&&Rt.numVerticalGlyphVertices>0&&Le?Te(Le,x.WritingMode.vertical):{box:null,offscreen:null}}),Ce(S&&S.box&&S.box.length)}}if(z=S,s=z&&z.box&&z.box.length>0,u=z&&z.offscreen,Rt.useRuntimeCollisionCircles){const Ce=w.text.placedSymbolArray.get(Rt.centerJustifiedTextSymbolIndex),me=x.evaluateSizeForFeature(w.textSizeData,fe,Ce),Te=I.get("text-padding");B=this.collisionIndex.placeCollisionCircles(Ve,Ce,w.lineVertexArray,w.glyphOffsetArray,me,L,O,N,v,et,Pe.predicate,Rt.collisionCircleDiameter,Te),s=Fe||B.circles.length>0&&!B.collisionDetected,u=u&&B.offscreen}if(li.iconFeatureIndex&&(se=li.iconFeatureIndex),li.iconBox){const Ce=me=>{const Te=rt&&f?U(me,f.x,f.y,st,et,this.transform.angle):me;return this.collisionIndex.placeCollisionBox(Te,Xe,$,L,Pe.predicate)};A&&A.box&&A.box.length&&li.verticalIconBox?(q=Ce(li.verticalIconBox),c=q.box.length>0):(q=Ce(li.iconBox),c=q.box.length>0),u=u&&q.offscreen}const Ee=ye||Rt.numHorizontalGlyphVertices===0&&Rt.numVerticalGlyphVertices===0,be=ze||Rt.numIconVertices===0;if(Ee||be?be?Ee||(c=c&&s):s=c&&s:c=s=c&&s,s&&z&&z.box&&this.collisionIndex.insertCollisionBox(z.box,Ve,I.get("text-ignore-placement"),w.bucketInstanceId,A&&A.box&&oe?oe:W,Pe.ID),c&&q&&this.collisionIndex.insertCollisionBox(q.box,Xe,I.get("icon-ignore-placement"),w.bucketInstanceId,se,Pe.ID),B&&(s&&this.collisionIndex.insertCollisionCircles(B.circles,Ve,I.get("text-ignore-placement"),w.bucketInstanceId,W,Pe.ID),v)){const Ce=w.bucketInstanceId;let me=this.collisionCircleArrays[Ce];me===void 0&&(me=this.collisionCircleArrays[Ce]=new Ie);for(let Te=0;Te<B.circles.length;Te+=4)me.circles.push(B.circles[Te+0]),me.circles.push(B.circles[Te+1]),me.circles.push(B.circles[Te+2]),me.circles.push(B.collisionDetected?1:0)}this.placements[Rt.crossTileID]=new ce(s||xt,c||lt,u||w.justReloaded),h[Rt.crossTileID]=!0};if(mt){const Rt=w.getSortedSymbolIndexes(this.transform.angle);for(let li=Rt.length-1;li>=0;--li){const s=Rt[li];qt(w.symbolInstances.get(s),w.collisionArrays[s])}}else for(let Rt=n.symbolInstanceStart;Rt<n.symbolInstanceEnd;Rt++)qt(w.symbolInstances.get(Rt),w.collisionArrays[Rt]);if(v&&w.bucketInstanceId in this.collisionCircleArrays){const Rt=this.collisionCircleArrays[w.bucketInstanceId];x.invert(Rt.invProjMatrix,L),Rt.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(n,h,v,w){let I;I=w===x.WritingMode.vertical?v.verticalPlacedTextSymbolIndex:{left:v.leftJustifiedTextSymbolIndex,center:v.centerJustifiedTextSymbolIndex,right:v.rightJustifiedTextSymbolIndex}[x.getAnchorJustification(h)];const L=[v.leftJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.rightJustifiedTextSymbolIndex,v.verticalPlacedTextSymbolIndex];for(const O of L)O>=0&&(n.text.placedSymbolArray.get(O).crossTileID=I>=0&&O!==I?0:v.crossTileID)}markUsedOrientation(n,h,v){const w=h===x.WritingMode.horizontal||h===x.WritingMode.horizontalOnly?h:0,I=h===x.WritingMode.vertical?h:0,L=[v.leftJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.rightJustifiedTextSymbolIndex];for(const O of L)n.text.placedSymbolArray.get(O).placedOrientation=w;v.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(v.verticalPlacedTextSymbolIndex).placedOrientation=I)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let v=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const w=h?h.symbolFadeChange(n):1,I=h?h.opacities:{},L=h?h.variableOffsets:{},O=h?h.placedOrientations:{};for(const N in this.placements){const $=this.placements[N],H=I[N];H?(this.opacities[N]=new De(H,w,$.text,$.icon),v=v||$.text!==H.text.placed||$.icon!==H.icon.placed):(this.opacities[N]=new De(null,w,$.text,$.icon,$.skipFade),v=v||$.text||$.icon)}for(const N in I){const $=I[N];if(!this.opacities[N]){const H=new De($,w,!1,!1);H.isHidden()||(this.opacities[N]=H,v=v||$.text.placed||$.icon.placed)}}for(const N in L)this.variableOffsets[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.variableOffsets[N]=L[N]);for(const N in O)this.placedOrientations[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.placedOrientations[N]=O[N]);v?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:n)}updateLayerOpacities(n,h){const v={};for(const w of h){const I=w.getBucket(n);I&&w.latestFeatureIndex&&n.id===I.layerIds[0]&&this.updateBucketOpacities(I,v,w.collisionBoxArray)}}updateBucketOpacities(n,h,v){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const w=n.layers[0].layout,I=new De(null,0,!1,!1,!0),L=w.get("text-allow-overlap"),O=w.get("icon-allow-overlap"),N=w.get("text-variable-anchor"),$=w.get("text-rotation-alignment")==="map",H=w.get("text-pitch-alignment")==="map",re=w.get("icon-text-fit")!=="none",fe=new De(null,0,L&&(O||!n.hasIconData()||w.get("icon-optional")),O&&(L||!n.hasTextData()||w.get("text-optional")),!0);!n.collisionArrays&&v&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(v);const Pe=(ye,ze,Ve)=>{for(let Fe=0;Fe<ze/4;Fe++)ye.opacityVertexArray.emplaceBack(Ve)};for(let ye=0;ye<n.symbolInstances.length;ye++){const ze=n.symbolInstances.get(ye),{numHorizontalGlyphVertices:Ve,numVerticalGlyphVertices:Fe,crossTileID:Xe}=ze;let je=this.opacities[Xe];h[Xe]?je=I:je||(je=fe,this.opacities[Xe]=je),h[Xe]=!0;const st=ze.numIconVertices>0,et=this.placedOrientations[ze.crossTileID],rt=et===x.WritingMode.vertical,mt=et===x.WritingMode.horizontal||et===x.WritingMode.horizontalOnly;if(Ve>0||Fe>0){const xt=Ze(je.text);Pe(n.text,Ve,rt?bt:xt),Pe(n.text,Fe,mt?bt:xt);const lt=je.text.isHidden();[ze.rightJustifiedTextSymbolIndex,ze.centerJustifiedTextSymbolIndex,ze.leftJustifiedTextSymbolIndex].forEach(li=>{li>=0&&(n.text.placedSymbolArray.get(li).hidden=lt||rt?1:0)}),ze.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(ze.verticalPlacedTextSymbolIndex).hidden=lt||mt?1:0);const qt=this.variableOffsets[ze.crossTileID];qt&&this.markUsedJustification(n,qt.anchor,ze,et);const Rt=this.placedOrientations[ze.crossTileID];Rt&&(this.markUsedJustification(n,"left",ze,Rt),this.markUsedOrientation(n,Rt,ze))}if(st){const xt=Ze(je.icon),lt=!(re&&ze.verticalPlacedIconSymbolIndex&&rt);ze.placedIconSymbolIndex>=0&&(Pe(n.icon,ze.numIconVertices,lt?xt:bt),n.icon.placedSymbolArray.get(ze.placedIconSymbolIndex).hidden=je.icon.isHidden()),ze.verticalPlacedIconSymbolIndex>=0&&(Pe(n.icon,ze.numVerticalIconVertices,lt?bt:xt),n.icon.placedSymbolArray.get(ze.verticalPlacedIconSymbolIndex).hidden=je.icon.isHidden())}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const xt=n.collisionArrays[ye];if(xt){let lt=new x.pointGeometry(0,0);if(xt.textBox||xt.verticalTextBox){let Rt=!0;if(N){const li=this.variableOffsets[Xe];li?(lt=F(li.anchor,li.width,li.height,li.textOffset,li.textBoxScale),$&&lt._rotate(H?this.transform.angle:-this.transform.angle)):Rt=!1}xt.textBox&&ne(n.textCollisionBox.collisionVertexArray,je.text.placed,!Rt||rt,lt.x,lt.y),xt.verticalTextBox&&ne(n.textCollisionBox.collisionVertexArray,je.text.placed,!Rt||mt,lt.x,lt.y)}const qt=Boolean(!mt&&xt.verticalIconBox);xt.iconBox&&ne(n.iconCollisionBox.collisionVertexArray,je.icon.placed,qt,re?lt.x:0,re?lt.y:0),xt.verticalIconBox&&ne(n.iconCollisionBox.collisionVertexArray,je.icon.placed,!qt,re?lt.x:0,re?lt.y:0)}}}if(n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const ye=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=ye.invProjMatrix,n.placementViewportMatrix=ye.viewportMatrix,n.collisionCircleArray=ye.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,h){const v=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*v>n}setStale(){this.stale=!0}}function ne(b,n,h,v,w){b.emplaceBack(n?1:0,h?1:0,v||0,w||0),b.emplaceBack(n?1:0,h?1:0,v||0,w||0),b.emplaceBack(n?1:0,h?1:0,v||0,w||0),b.emplaceBack(n?1:0,h?1:0,v||0,w||0)}const de=Math.pow(2,25),le=Math.pow(2,24),_e=Math.pow(2,17),ge=Math.pow(2,16),ve=Math.pow(2,9),Ge=Math.pow(2,8),Ue=Math.pow(2,1);function Ze(b){if(b.opacity===0&&!b.placed)return 0;if(b.opacity===1&&b.placed)return 4294967295;const n=b.placed?1:0,h=Math.floor(127*b.opacity);return h*de+n*le+h*_e+n*ge+h*ve+n*Ge+h*Ue+n}const bt=0;class pt{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&!n.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(n,h,v,w,I){const L=this._bucketParts;for(;this._currentTileIndex<n.length;)if(h.getBucketParts(L,w,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,I())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,L.sort((O,N)=>O.sortKey-N.sortKey));this._currentPartIndex<L.length;)if(h.placeLayerBucketPart(L[this._currentPartIndex],this._seenCrossTileIDs,v),this._currentPartIndex++,I())return!0;return!1}}class vt{constructor(n,h,v,w,I,L,O){this.placement=new J(n,I,L,O),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(n,h,v){const w=x.exported.now(),I=()=>{const L=x.exported.now()-w;return!this._forceFullPlacement&&L>2};for(;this._currentPlacementIndex>=0;){const L=h[n[this._currentPlacementIndex]],O=this.placement.collisionIndex.transform.zoom;if(L.type==="symbol"&&(!L.minzoom||L.minzoom<=O)&&(!L.maxzoom||L.maxzoom>O)){if(this._inProgressLayer||(this._inProgressLayer=new pt(L)),this._inProgressLayer.continuePlacement(v[L.source],this.placement,this._showCollisionBoxes,L,I))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Et=512/x.EXTENT/2;class di{constructor(n,h,v){this.tileID=n,this.indexedSymbolInstances={},this.bucketInstanceId=v;for(let w=0;w<h.length;w++){const I=h.get(w),L=I.key;this.indexedSymbolInstances[L]||(this.indexedSymbolInstances[L]=[]),this.indexedSymbolInstances[L].push({crossTileID:I.crossTileID,coord:this.getScaledCoordinates(I,n)})}}getScaledCoordinates(n,h){const v=Et/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*x.EXTENT+n.anchorX)*v),y:Math.floor((h.canonical.y*x.EXTENT+n.anchorY)*v)}}findMatches(n,h,v){const w=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let I=0;I<n.length;I++){const L=n.get(I);if(L.crossTileID)continue;const O=this.indexedSymbolInstances[L.key];if(!O)continue;const N=this.getScaledCoordinates(L,h);for(const $ of O)if(Math.abs($.coord.x-N.x)<=w&&Math.abs($.coord.y-N.y)<=w&&!v[$.crossTileID]){v[$.crossTileID]=!0,L.crossTileID=$.crossTileID;break}}}}class $t{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Jt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const h=Math.round((n-this.lng)/360);if(h!==0)for(const v in this.indexes){const w=this.indexes[v],I={};for(const L in w){const O=w[L];O.tileID=O.tileID.unwrapTo(O.tileID.wrap+h),I[O.tileID.key]=O}this.indexes[v]=I}this.lng=n}addBucket(n,h,v){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let I=0;I<h.symbolInstances.length;I++)h.symbolInstances.get(I).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});const w=this.usedCrossTileIDs[n.overscaledZ];for(const I in this.indexes){const L=this.indexes[I];if(Number(I)>n.overscaledZ)for(const O in L){const N=L[O];N.tileID.isChildOf(n)&&N.findMatches(h.symbolInstances,n,w)}else{const O=L[n.scaledTo(Number(I)).key];O&&O.findMatches(h.symbolInstances,n,w)}}for(let I=0;I<h.symbolInstances.length;I++){const L=h.symbolInstances.get(I);L.crossTileID||(L.crossTileID=v.generate(),w[L.crossTileID]=!0)}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new di(n,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(n,h){for(const v in h.indexedSymbolInstances)for(const w of h.indexedSymbolInstances[v])delete this.usedCrossTileIDs[n][w.crossTileID]}removeStaleBuckets(n){let h=!1;for(const v in this.indexes){const w=this.indexes[v];for(const I in w)n[w[I].bucketInstanceId]||(this.removeBucketCrossTileIDs(v,w[I]),delete w[I],h=!0)}return h}}class Nt{constructor(){this.layerIndexes={},this.crossTileIDs=new $t,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,h,v){let w=this.layerIndexes[n.id];w===void 0&&(w=this.layerIndexes[n.id]=new Jt);let I=!1;const L={};w.handleWrapJump(v);for(const O of h){const N=O.getBucket(n);N&&n.id===N.layerIds[0]&&(N.bucketInstanceId||(N.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(O.tileID,N,this.crossTileIDs)&&(I=!0),L[N.bucketInstanceId]=!0)}return w.removeStaleBuckets(L)&&(I=!0),I}pruneUnusedLayers(n){const h={};n.forEach(v=>{h[v]=!0});for(const v in this.layerIndexes)h[v]||delete this.layerIndexes[v]}}const Pt=(b,n)=>x.emitValidationErrors(b,n&&n.filter(h=>h.identifier!=="source.canvas")),oi=x.pick(yi,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Oi=x.pick(yi,["setCenter","setZoom","setBearing","setPitch"]),Cr=function(){const b={},n=x.spec.$version;for(const h in x.spec.$root){const v=x.spec.$root[h];if(v.required){let w=null;w=h==="version"?n:v.type==="array"?[]:{},w!=null&&(b[h]=w)}}return b}();class Fi extends x.Evented{constructor(n,h={}){super(),this.map=n,this.dispatcher=new Ar(Dr(),this),this.imageManager=new pi,this.imageManager.setEventedParent(this),this.glyphManager=new lr(n._requestManager,h.localIdeographFontFamily),this.lineAtlas=new nr(256,512),this.crossTileSymbolIndex=new Nt,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new x.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",x.getReferrer());const v=this;this._rtlTextPluginCallback=Fi.registerForPluginStateChange(w=>{v.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:w.pluginStatus,pluginURL:w.pluginURL},(I,L)=>{if(x.triggerPluginCompletionEvent(I),L&&L.every(O=>O))for(const O in v.sourceCaches)v.sourceCaches[O].reload()})}),this.on("data",w=>{if(w.dataType!=="source"||w.sourceDataType!=="metadata")return;const I=this.sourceCaches[w.sourceId];if(!I)return;const L=I.getSource();if(L&&L.vectorLayerIds)for(const O in this._layers){const N=this._layers[O];N.source===L.id&&this._validateLayer(N)}})}loadURL(n,h={}){this.fire(new x.Event("dataloading",{dataType:"style"}));const v=typeof h.validate!="boolean"||h.validate,w=this.map._requestManager.transformRequest(n,x.ResourceType.Style);this._request=x.getJSON(w,(I,L)=>{this._request=null,I?this.fire(new x.ErrorEvent(I)):L&&this._load(L,v)})}loadJSON(n,h={}){this.fire(new x.Event("dataloading",{dataType:"style"})),this._request=x.exported.frame(()=>{this._request=null,this._load(n,h.validate!==!1)})}loadEmpty(){this.fire(new x.Event("dataloading",{dataType:"style"})),this._load(Cr,!1)}_load(n,h){if(h&&Pt(this,x.validateStyle(n)))return;this._loaded=!0,this.stylesheet=n;for(const w in n.sources)this.addSource(w,n.sources[w],{validate:!1});n.sprite?this._loadSprite(n.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(n.glyphs);const v=Vo(this.stylesheet.layers);this._order=v.map(w=>w.id),this._layers={},this._serializedLayers={};for(let w of v)w=x.createStyleLayer(w),w.setEventedParent(this,{layer:{id:w.id}}),this._layers[w.id]=w,this._serializedLayers[w.id]=w.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new no(this.stylesheet.light),this.fire(new x.Event("data",{dataType:"style"})),this.fire(new x.Event("style.load"))}_loadSprite(n){this._spriteRequest=function(h,v,w,I){let L,O,N;const $=w>1?"@2x":"";let H=x.getJSON(v.transformRequest(v.normalizeSpriteURL(h,$,".json"),x.ResourceType.SpriteJSON),(Pe,ye)=>{H=null,N||(N=Pe,L=ye,fe())}),re=x.getImage(v.transformRequest(v.normalizeSpriteURL(h,$,".png"),x.ResourceType.SpriteImage),(Pe,ye)=>{re=null,N||(N=Pe,O=ye,fe())});function fe(){if(N)I(N);else if(L&&O){const Pe=x.exported.getImageData(O),ye={};for(const ze in L){const{width:Ve,height:Fe,x:Xe,y:je,sdf:st,pixelRatio:et,stretchX:rt,stretchY:mt,content:xt}=L[ze],lt=new x.RGBAImage({width:Ve,height:Fe});x.RGBAImage.copy(Pe,lt,{x:Xe,y:je},{x:0,y:0},{width:Ve,height:Fe}),ye[ze]={data:lt,pixelRatio:et,sdf:st,stretchX:rt,stretchY:mt,content:xt}}I(null,ye)}}return{cancel(){H&&(H.cancel(),H=null),re&&(re.cancel(),re=null)}}}(n,this.map._requestManager,this.map.getPixelRatio(),(h,v)=>{if(this._spriteRequest=null,h)this.fire(new x.ErrorEvent(h));else if(v)for(const w in v)this.imageManager.addImage(w,v[w]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new x.Event("data",{dataType:"style"}))})}_validateLayer(n){const h=this.sourceCaches[n.source];if(!h)return;const v=n.sourceLayer;if(!v)return;const w=h.getSource();(w.type==="geojson"||w.vectorLayerIds&&w.vectorLayerIds.indexOf(v)===-1)&&this.fire(new x.ErrorEvent(new Error(`Source layer "${v}" does not exist on source "${w.id}" as specified by style layer "${n.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this.sourceCaches)if(!this.sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){const h=[];for(const v of n){const w=this._layers[v];w.type!=="custom"&&h.push(w.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const n in this.sourceCaches)if(this.sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(n){if(!this._loaded)return;const h=this._changed;if(this._changed){const w=Object.keys(this._updatedLayers),I=Object.keys(this._removedLayers);(w.length||I.length)&&this._updateWorkerLayers(w,I);for(const L in this._updatedSources){const O=this._updatedSources[L];O==="reload"?this._reloadSource(L):O==="clear"&&this._clearSource(L)}this._updateTilesForChangedImages();for(const L in this._updatedPaintProps)this._layers[L].updateTransitions(n);this.light.updateTransitions(n),this._resetUpdates()}const v={};for(const w in this.sourceCaches){const I=this.sourceCaches[w];v[w]=I.used,I.used=!1}for(const w of this._order){const I=this._layers[w];I.recalculate(n,this._availableImages),!I.isHidden(n.zoom)&&I.source&&(this.sourceCaches[I.source].used=!0)}for(const w in v){const I=this.sourceCaches[w];v[w]!==I.used&&I.fire(new x.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:w}))}this.light.recalculate(n),this.z=n.zoom,h&&this.fire(new x.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(n){if(this._checkLoaded(),Pt(this,x.validateStyle(n)))return!1;(n=x.clone$1(n)).layers=Vo(n.layers);const h=function(w,I){if(!w)return[{command:yi.setStyle,args:[I]}];let L=[];try{if(!Qe(w.version,I.version))return[{command:yi.setStyle,args:[I]}];Qe(w.center,I.center)||L.push({command:yi.setCenter,args:[I.center]}),Qe(w.zoom,I.zoom)||L.push({command:yi.setZoom,args:[I.zoom]}),Qe(w.bearing,I.bearing)||L.push({command:yi.setBearing,args:[I.bearing]}),Qe(w.pitch,I.pitch)||L.push({command:yi.setPitch,args:[I.pitch]}),Qe(w.sprite,I.sprite)||L.push({command:yi.setSprite,args:[I.sprite]}),Qe(w.glyphs,I.glyphs)||L.push({command:yi.setGlyphs,args:[I.glyphs]}),Qe(w.transition,I.transition)||L.push({command:yi.setTransition,args:[I.transition]}),Qe(w.light,I.light)||L.push({command:yi.setLight,args:[I.light]});const O={},N=[];(function(H,re,fe,Pe){let ye;for(ye in re=re||{},H=H||{})Object.prototype.hasOwnProperty.call(H,ye)&&(Object.prototype.hasOwnProperty.call(re,ye)||Gn(ye,fe,Pe));for(ye in re)Object.prototype.hasOwnProperty.call(re,ye)&&(Object.prototype.hasOwnProperty.call(H,ye)?Qe(H[ye],re[ye])||(H[ye].type==="geojson"&&re[ye].type==="geojson"&&xa(H,re,ye)?fe.push({command:yi.setGeoJSONSourceData,args:[ye,re[ye].data]}):fn(ye,re,fe,Pe)):on(ye,re,fe))})(w.sources,I.sources,N,O);const $=[];w.layers&&w.layers.forEach(H=>{O[H.source]?L.push({command:yi.removeLayer,args:[H.id]}):$.push(H)}),L=L.concat(N),function(H,re,fe){re=re||[];const Pe=(H=H||[]).map(Lt),ye=re.map(Lt),ze=H.reduce(zo,{}),Ve=re.reduce(zo,{}),Fe=Pe.slice(),Xe=Object.create(null);let je,st,et,rt,mt,xt,lt;for(je=0,st=0;je<Pe.length;je++)et=Pe[je],Object.prototype.hasOwnProperty.call(Ve,et)?st++:(fe.push({command:yi.removeLayer,args:[et]}),Fe.splice(Fe.indexOf(et,st),1));for(je=0,st=0;je<ye.length;je++)et=ye[ye.length-1-je],Fe[Fe.length-1-je]!==et&&(Object.prototype.hasOwnProperty.call(ze,et)?(fe.push({command:yi.removeLayer,args:[et]}),Fe.splice(Fe.lastIndexOf(et,Fe.length-st),1)):st++,xt=Fe[Fe.length-je],fe.push({command:yi.addLayer,args:[Ve[et],xt]}),Fe.splice(Fe.length-je,0,et),Xe[et]=!0);for(je=0;je<ye.length;je++)if(et=ye[je],rt=ze[et],mt=Ve[et],!Xe[et]&&!Qe(rt,mt))if(Qe(rt.source,mt.source)&&Qe(rt["source-layer"],mt["source-layer"])&&Qe(rt.type,mt.type)){for(lt in ot(rt.layout,mt.layout,fe,et,null,yi.setLayoutProperty),ot(rt.paint,mt.paint,fe,et,null,yi.setPaintProperty),Qe(rt.filter,mt.filter)||fe.push({command:yi.setFilter,args:[et,mt.filter]}),Qe(rt.minzoom,mt.minzoom)&&Qe(rt.maxzoom,mt.maxzoom)||fe.push({command:yi.setLayerZoomRange,args:[et,mt.minzoom,mt.maxzoom]}),rt)Object.prototype.hasOwnProperty.call(rt,lt)&&lt!=="layout"&&lt!=="paint"&&lt!=="filter"&&lt!=="metadata"&&lt!=="minzoom"&&lt!=="maxzoom"&&(lt.indexOf("paint.")===0?ot(rt[lt],mt[lt],fe,et,lt.slice(6),yi.setPaintProperty):Qe(rt[lt],mt[lt])||fe.push({command:yi.setLayerProperty,args:[et,lt,mt[lt]]}));for(lt in mt)Object.prototype.hasOwnProperty.call(mt,lt)&&!Object.prototype.hasOwnProperty.call(rt,lt)&&lt!=="layout"&&lt!=="paint"&&lt!=="filter"&&lt!=="metadata"&&lt!=="minzoom"&&lt!=="maxzoom"&&(lt.indexOf("paint.")===0?ot(rt[lt],mt[lt],fe,et,lt.slice(6),yi.setPaintProperty):Qe(rt[lt],mt[lt])||fe.push({command:yi.setLayerProperty,args:[et,lt,mt[lt]]}))}else fe.push({command:yi.removeLayer,args:[et]}),xt=Fe[Fe.lastIndexOf(et)+1],fe.push({command:yi.addLayer,args:[mt,xt]})}($,I.layers,L)}catch(O){console.warn("Unable to compute style diff:",O),L=[{command:yi.setStyle,args:[I]}]}return L}(this.serialize(),n).filter(w=>!(w.command in Oi));if(h.length===0)return!1;const v=h.filter(w=>!(w.command in oi));if(v.length>0)throw new Error(`Unimplemented: ${v.map(w=>w.command).join(", ")}.`);return h.forEach(w=>{w.command!=="setTransition"&&this[w.command].apply(this,w.args)}),this.stylesheet=n,!0}addImage(n,h){if(this.getImage(n))return this.fire(new x.ErrorEvent(new Error(`An image named "${n}" already exists.`)));this.imageManager.addImage(n,h),this._afterImageUpdated(n)}updateImage(n,h){this.imageManager.updateImage(n,h)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){if(!this.getImage(n))return this.fire(new x.ErrorEvent(new Error(`An image named "${n}" does not exist.`)));this.imageManager.removeImage(n),this._afterImageUpdated(n)}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new x.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(n,h,v={}){if(this._checkLoaded(),this.sourceCaches[n]!==void 0)throw new Error(`Source "${n}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(x.validateStyle.source,`sources.${n}`,h,null,v))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const w=this.sourceCaches[n]=new ii(n,h,this.dispatcher);w.style=this,w.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:w.serialize(),sourceId:n})),w.onAdd(this.map),this._changed=!0}removeSource(n){if(this._checkLoaded(),this.sourceCaches[n]===void 0)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===n)return this.fire(new x.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${v}" is using it.`)));const h=this.sourceCaches[n];delete this.sourceCaches[n],delete this._updatedSources[n],h.fire(new x.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:n})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(n,h){this._checkLoaded(),this.sourceCaches[n].getSource().setData(h),this._changed=!0}getSource(n){return this.sourceCaches[n]&&this.sourceCaches[n].getSource()}addLayer(n,h,v={}){this._checkLoaded();const w=n.id;if(this.getLayer(w))return void this.fire(new x.ErrorEvent(new Error(`Layer "${w}" already exists on this map.`)));let I;if(n.type==="custom"){if(Pt(this,x.validateCustomStyleLayer(n)))return;I=x.createStyleLayer(n)}else{if(typeof n.source=="object"&&(this.addSource(w,n.source),n=x.clone$1(n),n=x.extend(n,{source:w})),this._validate(x.validateStyle.layer,`layers.${w}`,n,{arrayIndex:-1},v))return;I=x.createStyleLayer(n),this._validateLayer(I),I.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[I.id]=I.serialize()}const L=h?this._order.indexOf(h):this._order.length;if(h&&L===-1)this.fire(new x.ErrorEvent(new Error(`Cannot add layer "${w}" before non-existing layer "${h}".`)));else{if(this._order.splice(L,0,w),this._layerOrderChanged=!0,this._layers[w]=I,this._removedLayers[w]&&I.source&&I.type!=="custom"){const O=this._removedLayers[w];delete this._removedLayers[w],O.type!==I.type?this._updatedSources[I.source]="clear":(this._updatedSources[I.source]="reload",this.sourceCaches[I.source].pause())}this._updateLayer(I),I.onAdd&&I.onAdd(this.map)}}moveLayer(n,h){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new x.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===h)return;const v=this._order.indexOf(n);this._order.splice(v,1);const w=h?this._order.indexOf(h):this._order.length;h&&w===-1?this.fire(new x.ErrorEvent(new Error(`Cannot move layer "${n}" before non-existing layer "${h}".`))):(this._order.splice(w,0,n),this._layerOrderChanged=!0)}removeLayer(n){this._checkLoaded();const h=this._layers[n];if(!h)return void this.fire(new x.ErrorEvent(new Error(`Cannot remove non-existing layer "${n}".`)));h.setEventedParent(null);const v=this._order.indexOf(n);this._order.splice(v,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=h,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],h.onRemove&&h.onRemove(this.map)}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}setLayerZoomRange(n,h,v){this._checkLoaded();const w=this.getLayer(n);w?w.minzoom===h&&w.maxzoom===v||(h!=null&&(w.minzoom=h),v!=null&&(w.maxzoom=v),this._updateLayer(w)):this.fire(new x.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${n}".`)))}setFilter(n,h,v={}){this._checkLoaded();const w=this.getLayer(n);if(w){if(!Qe(w.filter,h))return h==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(x.validateStyle.filter,`layers.${w.id}.filter`,h,null,v)||(w.filter=x.clone$1(h),this._updateLayer(w)))}else this.fire(new x.ErrorEvent(new Error(`Cannot filter non-existing layer "${n}".`)))}getFilter(n){return x.clone$1(this.getLayer(n).filter)}setLayoutProperty(n,h,v,w={}){this._checkLoaded();const I=this.getLayer(n);I?Qe(I.getLayoutProperty(h),v)||(I.setLayoutProperty(h,v,w),this._updateLayer(I)):this.fire(new x.ErrorEvent(new Error(`Cannot style non-existing layer "${n}".`)))}getLayoutProperty(n,h){const v=this.getLayer(n);if(v)return v.getLayoutProperty(h);this.fire(new x.ErrorEvent(new Error(`Cannot get style of non-existing layer "${n}".`)))}setPaintProperty(n,h,v,w={}){this._checkLoaded();const I=this.getLayer(n);I?Qe(I.getPaintProperty(h),v)||(I.setPaintProperty(h,v,w)&&this._updateLayer(I),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new x.ErrorEvent(new Error(`Cannot style non-existing layer "${n}".`)))}getPaintProperty(n,h){return this.getLayer(n).getPaintProperty(h)}setFeatureState(n,h){this._checkLoaded();const v=n.source,w=n.sourceLayer,I=this.sourceCaches[v];if(I===void 0)return void this.fire(new x.ErrorEvent(new Error(`The source '${v}' does not exist in the map's style.`)));const L=I.getSource().type;L==="geojson"&&w?this.fire(new x.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):L!=="vector"||w?(n.id===void 0&&this.fire(new x.ErrorEvent(new Error("The feature id parameter must be provided."))),I.setFeatureState(w,n.id,h)):this.fire(new x.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(n,h){this._checkLoaded();const v=n.source,w=this.sourceCaches[v];if(w===void 0)return void this.fire(new x.ErrorEvent(new Error(`The source '${v}' does not exist in the map's style.`)));const I=w.getSource().type,L=I==="vector"?n.sourceLayer:void 0;I!=="vector"||L?h&&typeof n.id!="string"&&typeof n.id!="number"?this.fire(new x.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):w.removeFeatureState(L,n.id,h):this.fire(new x.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(n){this._checkLoaded();const h=n.source,v=n.sourceLayer,w=this.sourceCaches[h];if(w!==void 0)return w.getSource().type!=="vector"||v?(n.id===void 0&&this.fire(new x.ErrorEvent(new Error("The feature id parameter must be provided."))),w.getFeatureState(v,n.id)):void this.fire(new x.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new x.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return x.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return x.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:x.mapObject(this.sourceCaches,n=>n.serialize()),layers:this._serializeLayers(this._order)},n=>n!==void 0)}_updateLayer(n){this._updatedLayers[n.id]=!0,n.source&&!this._updatedSources[n.source]&&this.sourceCaches[n.source].getSource().type!=="raster"&&(this._updatedSources[n.source]="reload",this.sourceCaches[n.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(n){const h=L=>this._layers[L].type==="fill-extrusion",v={},w=[];for(let L=this._order.length-1;L>=0;L--){const O=this._order[L];if(h(O)){v[O]=L;for(const N of n){const $=N[O];if($)for(const H of $)w.push(H)}}}w.sort((L,O)=>O.intersectionZ-L.intersectionZ);const I=[];for(let L=this._order.length-1;L>=0;L--){const O=this._order[L];if(h(O))for(let N=w.length-1;N>=0;N--){const $=w[N].feature;if(v[$.layer.id]<L)break;I.push($),w.pop()}else for(const N of n){const $=N[O];if($)for(const H of $)I.push(H.feature)}}return I}queryRenderedFeatures(n,h,v){h&&h.filter&&this._validate(x.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);const w={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new x.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const L of h.layers){const O=this._layers[L];if(!O)return this.fire(new x.ErrorEvent(new Error(`The layer '${L}' does not exist in the map's style and cannot be queried for features.`))),[];w[O.source]=!0}}const I=[];h.availableImages=this._availableImages;for(const L in this.sourceCaches)h.layers&&!w[L]||I.push(dn(this.sourceCaches[L],this._layers,this._serializedLayers,n,h,v));return this.placement&&I.push(function(L,O,N,$,H,re,fe){const Pe={},ye=re.queryRenderedSymbols($),ze=[];for(const Ve of Object.keys(ye).map(Number))ze.push(fe[Ve]);ze.sort(Bi);for(const Ve of ze){const Fe=Ve.featureIndex.lookupSymbolFeatures(ye[Ve.bucketInstanceId],O,Ve.bucketIndex,Ve.sourceLayerIndex,H.filter,H.layers,H.availableImages,L);for(const Xe in Fe){const je=Pe[Xe]=Pe[Xe]||[],st=Fe[Xe];st.sort((et,rt)=>{const mt=Ve.featureSortOrder;if(mt){const xt=mt.indexOf(et.featureIndex);return mt.indexOf(rt.featureIndex)-xt}return rt.featureIndex-et.featureIndex});for(const et of st)je.push(et)}}for(const Ve in Pe)Pe[Ve].forEach(Fe=>{const Xe=Fe.feature,je=N[L[Ve].source].getFeatureState(Xe.layer["source-layer"],Xe.id);Xe.source=Xe.layer.source,Xe.layer["source-layer"]&&(Xe.sourceLayer=Xe.layer["source-layer"]),Xe.state=je});return Pe}(this._layers,this._serializedLayers,this.sourceCaches,n,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(I)}querySourceFeatures(n,h){h&&h.filter&&this._validate(x.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);const v=this.sourceCaches[n];return v?function(w,I){const L=w.getRenderableIds().map($=>w.getTileByID($)),O=[],N={};for(let $=0;$<L.length;$++){const H=L[$],re=H.tileID.canonical.key;N[re]||(N[re]=!0,H.querySourceFeatures(O,I))}return O}(v,h):[]}addSourceType(n,h,v){return Fi.getSourceType(n)?v(new Error(`A source type called "${n}" already exists.`)):(Fi.setSourceType(n,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:h.workerSourceURL},v):v(null,null))}getLight(){return this.light.getLight()}setLight(n,h={}){this._checkLoaded();const v=this.light.getLight();let w=!1;for(const L in n)if(!Qe(n[L],v[L])){w=!0;break}if(!w)return;const I={now:x.exported.now(),transition:x.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(n,h),this.light.updateTransitions(I)}_validate(n,h,v,w,I={}){return(!I||I.validate!==!1)&&Pt(this,n.call(x.validateStyle,x.extend({key:h,style:this.serialize(),value:v,styleSpec:x.spec},w)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),x.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this.sourceCaches){const h=this.sourceCaches[n];h.setEventedParent(null),h.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){this.sourceCaches[n].clearTiles()}_reloadSource(n){this.sourceCaches[n].resume(),this.sourceCaches[n].reload()}_updateSources(n){for(const h in this.sourceCaches)this.sourceCaches[h].update(n)}_generateCollisionBoxes(){for(const n in this.sourceCaches)this._reloadSource(n)}_updatePlacement(n,h,v,w,I=!1){let L=!1,O=!1;const N={};for(const $ of this._order){const H=this._layers[$];if(H.type!=="symbol")continue;if(!N[H.source]){const fe=this.sourceCaches[H.source];N[H.source]=fe.getRenderableIds(!0).map(Pe=>fe.getTileByID(Pe)).sort((Pe,ye)=>ye.tileID.overscaledZ-Pe.tileID.overscaledZ||(Pe.tileID.isLessThan(ye.tileID)?-1:1))}const re=this.crossTileSymbolIndex.addLayer(H,N[H.source],n.center.lng);L=L||re}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((I=I||this._layerOrderChanged||v===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(x.exported.now(),n.zoom))&&(this.pauseablePlacement=new vt(n,this._order,I,h,v,w,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,N),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(x.exported.now()),O=!0),L&&this.pauseablePlacement.placement.setStale()),O||L)for(const $ of this._order){const H=this._layers[$];H.type==="symbol"&&this.placement.updateLayerOpacities(H,N[H.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(x.exported.now())}_releaseSymbolFadeTiles(){for(const n in this.sourceCaches)this.sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,h,v){this.imageManager.getImages(h.icons,v),this._updateTilesForChangedImages();const w=this.sourceCaches[h.source];w&&w.setDependencies(h.tileID.key,h.type,h.icons)}getGlyphs(n,h,v){this.glyphManager.getGlyphs(h.stacks,v)}getResource(n,h,v){return x.makeRequest(h,v)}}Fi.getSourceType=function(b){return ao[b]},Fi.setSourceType=function(b,n){ao[b]=n},Fi.registerForPluginStateChange=x.registerForPluginStateChange;var yn=x.createLayout([{name:"a_pos",type:"Int16",components:2}]),Ss={prelude:$i(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),background:$i(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:$i(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:$i(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:$i("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:$i(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:$i(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:$i("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:$i("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:$i("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),fill:$i(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:$i(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:$i(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:$i(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:$i(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:$i(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:$i(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:$i(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:$i(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),lineGradient:$i(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),linePattern:$i(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:$i(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:$i(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:$i(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),symbolSDF:$i(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:$i(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`)};function $i(b,n){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,v=n.match(/attribute ([\w]+) ([\w]+)/g),w=b.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),I=n.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),L=I?I.concat(w):w,O={};return{fragmentSource:b=b.replace(h,(N,$,H,re,fe)=>(O[fe]=!0,$==="define"?`
#ifndef HAS_UNIFORM_u_${fe}
varying ${H} ${re} ${fe};
#else
uniform ${H} ${re} u_${fe};
#endif
`:`
#ifdef HAS_UNIFORM_u_${fe}
    ${H} ${re} ${fe} = u_${fe};
#endif
`)),vertexSource:n=n.replace(h,(N,$,H,re,fe)=>{const Pe=re==="float"?"vec2":"vec4",ye=fe.match(/color/)?"color":Pe;return O[fe]?$==="define"?`
#ifndef HAS_UNIFORM_u_${fe}
uniform lowp float u_${fe}_t;
attribute ${H} ${Pe} a_${fe};
varying ${H} ${re} ${fe};
#else
uniform ${H} ${re} u_${fe};
#endif
`:ye==="vec4"?`
#ifndef HAS_UNIFORM_u_${fe}
    ${fe} = a_${fe};
#else
    ${H} ${re} ${fe} = u_${fe};
#endif
`:`
#ifndef HAS_UNIFORM_u_${fe}
    ${fe} = unpack_mix_${ye}(a_${fe}, u_${fe}_t);
#else
    ${H} ${re} ${fe} = u_${fe};
#endif
`:$==="define"?`
#ifndef HAS_UNIFORM_u_${fe}
uniform lowp float u_${fe}_t;
attribute ${H} ${Pe} a_${fe};
#else
uniform ${H} ${re} u_${fe};
#endif
`:ye==="vec4"?`
#ifndef HAS_UNIFORM_u_${fe}
    ${H} ${re} ${fe} = a_${fe};
#else
    ${H} ${re} ${fe} = u_${fe};
#endif
`:`
#ifndef HAS_UNIFORM_u_${fe}
    ${H} ${re} ${fe} = unpack_mix_${ye}(a_${fe}, u_${fe}_t);
#else
    ${H} ${re} ${fe} = u_${fe};
#endif
`}),staticAttributes:v,staticUniforms:L}}class wr{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(n,h,v,w,I,L,O,N){this.context=n;let $=this.boundPaintVertexBuffers.length!==w.length;for(let H=0;!$&&H<w.length;H++)this.boundPaintVertexBuffers[H]!==w[H]&&($=!0);n.extVertexArrayObject&&this.vao&&this.boundProgram===h&&this.boundLayoutVertexBuffer===v&&!$&&this.boundIndexBuffer===I&&this.boundVertexOffset===L&&this.boundDynamicVertexBuffer===O&&this.boundDynamicVertexBuffer2===N?(n.bindVertexArrayOES.set(this.vao),O&&O.bind(),I&&I.dynamicDraw&&I.bind(),N&&N.bind()):this.freshBind(h,v,w,I,L,O,N)}freshBind(n,h,v,w,I,L,O){let N;const $=n.numAttributes,H=this.context,re=H.gl;if(H.extVertexArrayObject)this.vao&&this.destroy(),this.vao=H.extVertexArrayObject.createVertexArrayOES(),H.bindVertexArrayOES.set(this.vao),N=0,this.boundProgram=n,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=v,this.boundIndexBuffer=w,this.boundVertexOffset=I,this.boundDynamicVertexBuffer=L,this.boundDynamicVertexBuffer2=O;else{N=H.currentNumAttributes||0;for(let fe=$;fe<N;fe++)re.disableVertexAttribArray(fe)}h.enableAttributes(re,n);for(const fe of v)fe.enableAttributes(re,n);L&&L.enableAttributes(re,n),O&&O.enableAttributes(re,n),h.bind(),h.setVertexAttribPointers(re,n,I);for(const fe of v)fe.bind(),fe.setVertexAttribPointers(re,n,I);L&&(L.bind(),L.setVertexAttribPointers(re,n,I)),w&&w.bind(),O&&(O.bind(),O.setVertexAttribPointers(re,n,I)),H.currentNumAttributes=$}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Ua(b){const n=[];for(let h=0;h<b.length;h++){if(b[h]===null)continue;const v=b[h].split(" ");n.push(v.pop())}return n}class En{constructor(n,h,v,w,I,L){const O=n.gl;this.program=O.createProgram();const N=Ua(v.staticAttributes),$=w?w.getBinderAttributes():[],H=N.concat($),re=v.staticUniforms?Ua(v.staticUniforms):[],fe=w?w.getBinderUniforms():[],Pe=re.concat(fe),ye=[];for(const et of Pe)ye.indexOf(et)<0&&ye.push(et);const ze=w?w.defines():[];L&&ze.push("#define OVERDRAW_INSPECTOR;");const Ve=ze.concat(Ss.prelude.fragmentSource,v.fragmentSource).join(`
`),Fe=ze.concat(Ss.prelude.vertexSource,v.vertexSource).join(`
`),Xe=O.createShader(O.FRAGMENT_SHADER);if(O.isContextLost())return void(this.failedToCreate=!0);O.shaderSource(Xe,Ve),O.compileShader(Xe),O.attachShader(this.program,Xe);const je=O.createShader(O.VERTEX_SHADER);if(O.isContextLost())return void(this.failedToCreate=!0);O.shaderSource(je,Fe),O.compileShader(je),O.attachShader(this.program,je),this.attributes={};const st={};this.numAttributes=H.length;for(let et=0;et<this.numAttributes;et++)H[et]&&(O.bindAttribLocation(this.program,et,H[et]),this.attributes[H[et]]=et);O.linkProgram(this.program),O.deleteShader(je),O.deleteShader(Xe);for(let et=0;et<ye.length;et++){const rt=ye[et];if(rt&&!st[rt]){const mt=O.getUniformLocation(this.program,rt);mt&&(st[rt]=mt)}}this.fixedUniforms=I(n,st),this.binderUniforms=w?w.getUniforms(n,st):[]}draw(n,h,v,w,I,L,O,N,$,H,re,fe,Pe,ye,ze,Ve){const Fe=n.gl;if(this.failedToCreate)return;n.program.set(this.program),n.setDepthMode(v),n.setStencilMode(w),n.setColorMode(I),n.setCullFace(L);for(const je in this.fixedUniforms)this.fixedUniforms[je].set(O[je]);ye&&ye.setUniforms(n,this.binderUniforms,fe,{zoom:Pe});const Xe={[Fe.LINES]:2,[Fe.TRIANGLES]:3,[Fe.LINE_STRIP]:1}[h];for(const je of re.get()){const st=je.vaos||(je.vaos={});(st[N]||(st[N]=new wr)).bind(n,this,$,ye?ye.getPaintVertexBuffers():[],H,je.vertexOffset,ze,Ve),Fe.drawElements(h,je.primitiveLength*Xe,Fe.UNSIGNED_SHORT,je.primitiveOffset*Xe*2)}}}function Br(b,n,h){const v=1/xe(h,1,n.transform.tileZoom),w=Math.pow(2,h.tileID.overscaledZ),I=h.tileSize*Math.pow(2,n.transform.tileZoom)/w,L=I*(h.tileID.canonical.x+h.tileID.wrap*w),O=I*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[v,b.fromScale,b.toScale],u_fade:b.t,u_pixel_coord_upper:[L>>16,O>>16],u_pixel_coord_lower:[65535&L,65535&O]}}const co=(b,n,h,v)=>{const w=n.style.light,I=w.properties.get("position"),L=[I.x,I.y,I.z],O=function(){var $=new x.ARRAY_TYPE(9);return x.ARRAY_TYPE!=Float32Array&&($[1]=0,$[2]=0,$[3]=0,$[5]=0,$[6]=0,$[7]=0),$[0]=1,$[4]=1,$[8]=1,$}();w.properties.get("anchor")==="viewport"&&function($,H){var re=Math.sin(H),fe=Math.cos(H);$[0]=fe,$[1]=re,$[2]=0,$[3]=-re,$[4]=fe,$[5]=0,$[6]=0,$[7]=0,$[8]=1}(O,-n.transform.angle),function($,H,re){var fe=H[0],Pe=H[1],ye=H[2];$[0]=fe*re[0]+Pe*re[3]+ye*re[6],$[1]=fe*re[1]+Pe*re[4]+ye*re[7],$[2]=fe*re[2]+Pe*re[5]+ye*re[8]}(L,L,O);const N=w.properties.get("color");return{u_matrix:b,u_lightpos:L,u_lightintensity:w.properties.get("intensity"),u_lightcolor:[N.r,N.g,N.b],u_vertical_gradient:+h,u_opacity:v}},tr=(b,n,h,v,w,I,L)=>x.extend(co(b,n,h,v),Br(I,n,L),{u_height_factor:-Math.pow(2,w.overscaledZ)/L.tileSize/8}),ho=b=>({u_matrix:b}),Dn=(b,n,h,v)=>x.extend(ho(b),Br(h,n,v)),Rl=(b,n)=>({u_matrix:b,u_world:n}),po=(b,n,h,v,w)=>x.extend(Dn(b,n,h,v),{u_world:w}),Va=(b,n,h,v)=>{const w=b.transform;let I,L;if(v.paint.get("circle-pitch-alignment")==="map"){const O=xe(h,1,w.zoom);I=!0,L=[O,O]}else I=!1,L=w.pixelsToGLUnits;return{u_camera_to_center_distance:w.cameraToCenterDistance,u_scale_with_map:+(v.paint.get("circle-pitch-scale")==="map"),u_matrix:b.translatePosMatrix(n.posMatrix,h,v.paint.get("circle-translate"),v.paint.get("circle-translate-anchor")),u_pitch_with_map:+I,u_device_pixel_ratio:b.pixelRatio,u_extrude_scale:L}},bo=(b,n,h)=>{const v=xe(h,1,n.zoom),w=Math.pow(2,n.zoom-h.tileID.overscaledZ),I=h.tileID.overscaleFactor();return{u_matrix:b,u_camera_to_center_distance:n.cameraToCenterDistance,u_pixels_to_tile_units:v,u_extrude_scale:[n.pixelsToGLUnits[0]/(v*w),n.pixelsToGLUnits[1]/(v*w)],u_overscale_factor:I}},Er=(b,n,h=1)=>({u_matrix:b,u_color:n,u_overlay:0,u_overlay_scale:h}),$n=b=>({u_matrix:b}),Xr=(b,n,h,v)=>({u_matrix:b,u_extrude_scale:xe(n,1,h),u_intensity:v});function No(b,n){const h=Math.pow(2,n.canonical.z),v=n.canonical.y;return[new x.MercatorCoordinate(0,v/h).toLngLat().lat,new x.MercatorCoordinate(0,(v+1)/h).toLngLat().lat]}const Ts=(b,n,h)=>{const v=b.transform;return{u_matrix:Bl(b,n,h),u_ratio:1/xe(n,1,v.zoom),u_device_pixel_ratio:b.pixelRatio,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},ol=(b,n,h,v)=>x.extend(Ts(b,n,h),{u_image:0,u_image_height:v}),Na=(b,n,h,v)=>{const w=b.transform,I=os(n,w);return{u_matrix:Bl(b,n,h),u_texsize:n.imageAtlasTexture.size,u_ratio:1/xe(n,1,w.zoom),u_device_pixel_ratio:b.pixelRatio,u_image:0,u_scale:[I,v.fromScale,v.toScale],u_fade:v.t,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]]}},Vr=(b,n,h,v,w)=>{const I=b.lineAtlas,L=os(n,b.transform),O=h.layout.get("line-cap")==="round",N=I.getDash(v.from,O),$=I.getDash(v.to,O),H=N.width*w.fromScale,re=$.width*w.toScale;return x.extend(Ts(b,n,h),{u_patternscale_a:[L/H,-N.height/2],u_patternscale_b:[L/re,-$.height/2],u_sdfgamma:I.width/(256*Math.min(H,re)*b.pixelRatio)/2,u_image:0,u_tex_y_a:N.y,u_tex_y_b:$.y,u_mix:w.t})};function os(b,n){return 1/xe(b,1,n.tileZoom)}function Bl(b,n,h){return b.translatePosMatrix(n.tileID.posMatrix,n,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const Ol=(b,n,h,v,w)=>{return{u_matrix:b,u_tl_parent:n,u_scale_parent:h,u_buffer_scale:1,u_fade_t:v.mix,u_opacity:v.opacity*w.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:w.paint.get("raster-brightness-min"),u_brightness_high:w.paint.get("raster-brightness-max"),u_saturation_factor:(L=w.paint.get("raster-saturation"),L>0?1-1/(1.001-L):-L),u_contrast_factor:(I=w.paint.get("raster-contrast"),I>0?1/(1-I):1+I),u_spin_weights:Fl(w.paint.get("raster-hue-rotate"))};var I,L};function Fl(b){b*=Math.PI/180;const n=Math.sin(b),h=Math.cos(b);return[(2*h+1)/3,(-Math.sqrt(3)*n-h+1)/3,(Math.sqrt(3)*n-h+1)/3]}const ia=(b,n,h,v,w,I,L,O,N,$)=>{const H=w.transform;return{u_is_size_zoom_constant:+(b==="constant"||b==="source"),u_is_size_feature_constant:+(b==="constant"||b==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:H.cameraToCenterDistance,u_pitch:H.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:H.width/H.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:I,u_label_plane_matrix:L,u_coord_matrix:O,u_is_text:+N,u_pitch_with_map:+v,u_texsize:$,u_texture:0}},Is=(b,n,h,v,w,I,L,O,N,$,H)=>{const re=w.transform;return x.extend(ia(b,n,h,v,w,I,L,O,N,$),{u_gamma_scale:v?Math.cos(re._pitch)*re.cameraToCenterDistance:1,u_device_pixel_ratio:w.pixelRatio,u_is_halo:+H})},As=(b,n,h,v,w,I,L,O,N,$)=>x.extend(Is(b,n,h,v,w,I,L,O,!0,N,!0),{u_texsize_icon:$,u_texture_icon:1}),pu=(b,n,h)=>({u_matrix:b,u_opacity:n,u_color:h}),as=(b,n,h,v,w,I)=>x.extend(function(L,O,N,$){const H=N.imageManager.getPattern(L.from.toString()),re=N.imageManager.getPattern(L.to.toString()),{width:fe,height:Pe}=N.imageManager.getPixelSize(),ye=Math.pow(2,$.tileID.overscaledZ),ze=$.tileSize*Math.pow(2,N.transform.tileZoom)/ye,Ve=ze*($.tileID.canonical.x+$.tileID.wrap*ye),Fe=ze*$.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:H.tl,u_pattern_br_a:H.br,u_pattern_tl_b:re.tl,u_pattern_br_b:re.br,u_texsize:[fe,Pe],u_mix:O.t,u_pattern_size_a:H.displaySize,u_pattern_size_b:re.displaySize,u_scale_a:O.fromScale,u_scale_b:O.toScale,u_tile_units_to_pixels:1/xe($,1,N.transform.tileZoom),u_pixel_coord_upper:[Ve>>16,Fe>>16],u_pixel_coord_lower:[65535&Ve,65535&Fe]}}(v,I,h,w),{u_matrix:b,u_opacity:n}),Xn={fillExtrusion:(b,n)=>({u_matrix:new x.UniformMatrix4f(b,n.u_matrix),u_lightpos:new x.Uniform3f(b,n.u_lightpos),u_lightintensity:new x.Uniform1f(b,n.u_lightintensity),u_lightcolor:new x.Uniform3f(b,n.u_lightcolor),u_vertical_gradient:new x.Uniform1f(b,n.u_vertical_gradient),u_opacity:new x.Uniform1f(b,n.u_opacity)}),fillExtrusionPattern:(b,n)=>({u_matrix:new x.UniformMatrix4f(b,n.u_matrix),u_lightpos:new x.Uniform3f(b,n.u_lightpos),u_lightintensity:new x.Uniform1f(b,n.u_lightintensity),u_lightcolor:new x.Uniform3f(b,n.u_lightcolor),u_vertical_gradient:new x.Uniform1f(b,n.u_vertical_gradient),u_height_factor:new x.Uniform1f(b,n.u_height_factor),u_image:new x.Uniform1i(b,n.u_image),u_texsize:new x.Uniform2f(b,n.u_texsize),u_pixel_coord_upper:new x.Uniform2f(b,n.u_pixel_coord_upper),u_pixel_coord_lower:new x.Uniform2f(b,n.u_pixel_coord_lower),u_scale:new x.Uniform3f(b,n.u_scale),u_fade:new x.Uniform1f(b,n.u_fade),u_opacity:new x.Uniform1f(b,n.u_opacity)}),fill:(b,n)=>({u_matrix:new x.UniformMatrix4f(b,n.u_matrix)}),fillPattern:(b,n)=>({u_matrix:new x.UniformMatrix4f(b,n.u_matrix),u_image:new x.Uniform1i(b,n.u_image),u_texsize:new x.Uniform2f(b,n.u_texsize),u_pixel_coord_upper:new x.Uniform2f(b,n.u_pixel_coord_upper),u_pixel_coord_lower:new x.Uniform2f(b,n.u_pixel_coord_lower),u_scale:new x.Uniform3f(b,n.u_scale),u_fade:new x.Uniform1f(b,n.u_fade)}),fillOutline:(b,n)=>({u_matrix:new x.UniformMatrix4f(b,n.u_matrix),u_world:new x.Uniform2f(b,n.u_world)}),fillOutlinePattern:(b,n)=>({u_matrix:new x.UniformMatrix4f(b,n.u_matrix),u_world:new x.Uniform2f(b,n.u_world),u_image:new x.Uniform1i(b,n.u_image),u_texsize:new x.Uniform2f(b,n.u_texsize),u_pixel_coord_upper:new x.Uniform2f(b,n.u_pixel_coord_upper),u_pixel_coord_lower:new x.Uniform2f(b,n.u_pixel_coord_lower),u_scale:new x.Uniform3f(b,n.u_scale),u_fade:new x.Uniform1f(b,n.u_fade)}),circle:(b,n)=>({u_camera_to_center_distance:new x.Uniform1f(b,n.u_camera_to_center_distance),u_scale_with_map:new x.Uniform1i(b,n.u_scale_with_map),u_pitch_with_map:new x.Uniform1i(b,n.u_pitch_with_map),u_extrude_scale:new x.Uniform2f(b,n.u_extrude_scale),u_device_pixel_ratio:new x.Uniform1f(b,n.u_device_pixel_ratio),u_matrix:new x.UniformMatrix4f(b,n.u_matrix)}),collisionBox:(b,n)=>({u_matrix:new x.UniformMatrix4f(b,n.u_matrix),u_camera_to_center_distance:new x.Uniform1f(b,n.u_camera_to_center_distance),u_pixels_to_tile_units:new x.Uniform1f(b,n.u_pixels_to_tile_units),u_extrude_scale:new x.Uniform2f(b,n.u_extrude_scale),u_overscale_factor:new x.Uniform1f(b,n.u_overscale_factor)}),collisionCircle:(b,n)=>({u_matrix:new x.UniformMatrix4f(b,n.u_matrix),u_inv_matrix:new x.UniformMatrix4f(b,n.u_inv_matrix),u_camera_to_center_distance:new x.Uniform1f(b,n.u_camera_to_center_distance),u_viewport_size:new x.Uniform2f(b,n.u_viewport_size)}),debug:(b,n)=>({u_color:new x.UniformColor(b,n.u_color),u_matrix:new x.UniformMatrix4f(b,n.u_matrix),u_overlay:new x.Uniform1i(b,n.u_overlay),u_overlay_scale:new x.Uniform1f(b,n.u_overlay_scale)}),clippingMask:(b,n)=>({u_matrix:new x.UniformMatrix4f(b,n.u_matrix)}),heatmap:(b,n)=>({u_extrude_scale:new x.Uniform1f(b,n.u_extrude_scale),u_intensity:new x.Uniform1f(b,n.u_intensity),u_matrix:new x.UniformMatrix4f(b,n.u_matrix)}),heatmapTexture:(b,n)=>({u_matrix:new x.UniformMatrix4f(b,n.u_matrix),u_world:new x.Uniform2f(b,n.u_world),u_image:new x.Uniform1i(b,n.u_image),u_color_ramp:new x.Uniform1i(b,n.u_color_ramp),u_opacity:new x.Uniform1f(b,n.u_opacity)}),hillshade:(b,n)=>({u_matrix:new x.UniformMatrix4f(b,n.u_matrix),u_image:new x.Uniform1i(b,n.u_image),u_latrange:new x.Uniform2f(b,n.u_latrange),u_light:new x.Uniform2f(b,n.u_light),u_shadow:new x.UniformColor(b,n.u_shadow),u_highlight:new x.UniformColor(b,n.u_highlight),u_accent:new x.UniformColor(b,n.u_accent)}),hillshadePrepare:(b,n)=>({u_matrix:new x.UniformMatrix4f(b,n.u_matrix),u_image:new x.Uniform1i(b,n.u_image),u_dimension:new x.Uniform2f(b,n.u_dimension),u_zoom:new x.Uniform1f(b,n.u_zoom),u_unpack:new x.Uniform4f(b,n.u_unpack)}),line:(b,n)=>({u_matrix:new x.UniformMatrix4f(b,n.u_matrix),u_ratio:new x.Uniform1f(b,n.u_ratio),u_device_pixel_ratio:new x.Uniform1f(b,n.u_device_pixel_ratio),u_units_to_pixels:new x.Uniform2f(b,n.u_units_to_pixels)}),lineGradient:(b,n)=>({u_matrix:new x.UniformMatrix4f(b,n.u_matrix),u_ratio:new x.Uniform1f(b,n.u_ratio),u_device_pixel_ratio:new x.Uniform1f(b,n.u_device_pixel_ratio),u_units_to_pixels:new x.Uniform2f(b,n.u_units_to_pixels),u_image:new x.Uniform1i(b,n.u_image),u_image_height:new x.Uniform1f(b,n.u_image_height)}),linePattern:(b,n)=>({u_matrix:new x.UniformMatrix4f(b,n.u_matrix),u_texsize:new x.Uniform2f(b,n.u_texsize),u_ratio:new x.Uniform1f(b,n.u_ratio),u_device_pixel_ratio:new x.Uniform1f(b,n.u_device_pixel_ratio),u_image:new x.Uniform1i(b,n.u_image),u_units_to_pixels:new x.Uniform2f(b,n.u_units_to_pixels),u_scale:new x.Uniform3f(b,n.u_scale),u_fade:new x.Uniform1f(b,n.u_fade)}),lineSDF:(b,n)=>({u_matrix:new x.UniformMatrix4f(b,n.u_matrix),u_ratio:new x.Uniform1f(b,n.u_ratio),u_device_pixel_ratio:new x.Uniform1f(b,n.u_device_pixel_ratio),u_units_to_pixels:new x.Uniform2f(b,n.u_units_to_pixels),u_patternscale_a:new x.Uniform2f(b,n.u_patternscale_a),u_patternscale_b:new x.Uniform2f(b,n.u_patternscale_b),u_sdfgamma:new x.Uniform1f(b,n.u_sdfgamma),u_image:new x.Uniform1i(b,n.u_image),u_tex_y_a:new x.Uniform1f(b,n.u_tex_y_a),u_tex_y_b:new x.Uniform1f(b,n.u_tex_y_b),u_mix:new x.Uniform1f(b,n.u_mix)}),raster:(b,n)=>({u_matrix:new x.UniformMatrix4f(b,n.u_matrix),u_tl_parent:new x.Uniform2f(b,n.u_tl_parent),u_scale_parent:new x.Uniform1f(b,n.u_scale_parent),u_buffer_scale:new x.Uniform1f(b,n.u_buffer_scale),u_fade_t:new x.Uniform1f(b,n.u_fade_t),u_opacity:new x.Uniform1f(b,n.u_opacity),u_image0:new x.Uniform1i(b,n.u_image0),u_image1:new x.Uniform1i(b,n.u_image1),u_brightness_low:new x.Uniform1f(b,n.u_brightness_low),u_brightness_high:new x.Uniform1f(b,n.u_brightness_high),u_saturation_factor:new x.Uniform1f(b,n.u_saturation_factor),u_contrast_factor:new x.Uniform1f(b,n.u_contrast_factor),u_spin_weights:new x.Uniform3f(b,n.u_spin_weights)}),symbolIcon:(b,n)=>({u_is_size_zoom_constant:new x.Uniform1i(b,n.u_is_size_zoom_constant),u_is_size_feature_constant:new x.Uniform1i(b,n.u_is_size_feature_constant),u_size_t:new x.Uniform1f(b,n.u_size_t),u_size:new x.Uniform1f(b,n.u_size),u_camera_to_center_distance:new x.Uniform1f(b,n.u_camera_to_center_distance),u_pitch:new x.Uniform1f(b,n.u_pitch),u_rotate_symbol:new x.Uniform1i(b,n.u_rotate_symbol),u_aspect_ratio:new x.Uniform1f(b,n.u_aspect_ratio),u_fade_change:new x.Uniform1f(b,n.u_fade_change),u_matrix:new x.UniformMatrix4f(b,n.u_matrix),u_label_plane_matrix:new x.UniformMatrix4f(b,n.u_label_plane_matrix),u_coord_matrix:new x.UniformMatrix4f(b,n.u_coord_matrix),u_is_text:new x.Uniform1i(b,n.u_is_text),u_pitch_with_map:new x.Uniform1i(b,n.u_pitch_with_map),u_texsize:new x.Uniform2f(b,n.u_texsize),u_texture:new x.Uniform1i(b,n.u_texture)}),symbolSDF:(b,n)=>({u_is_size_zoom_constant:new x.Uniform1i(b,n.u_is_size_zoom_constant),u_is_size_feature_constant:new x.Uniform1i(b,n.u_is_size_feature_constant),u_size_t:new x.Uniform1f(b,n.u_size_t),u_size:new x.Uniform1f(b,n.u_size),u_camera_to_center_distance:new x.Uniform1f(b,n.u_camera_to_center_distance),u_pitch:new x.Uniform1f(b,n.u_pitch),u_rotate_symbol:new x.Uniform1i(b,n.u_rotate_symbol),u_aspect_ratio:new x.Uniform1f(b,n.u_aspect_ratio),u_fade_change:new x.Uniform1f(b,n.u_fade_change),u_matrix:new x.UniformMatrix4f(b,n.u_matrix),u_label_plane_matrix:new x.UniformMatrix4f(b,n.u_label_plane_matrix),u_coord_matrix:new x.UniformMatrix4f(b,n.u_coord_matrix),u_is_text:new x.Uniform1i(b,n.u_is_text),u_pitch_with_map:new x.Uniform1i(b,n.u_pitch_with_map),u_texsize:new x.Uniform2f(b,n.u_texsize),u_texture:new x.Uniform1i(b,n.u_texture),u_gamma_scale:new x.Uniform1f(b,n.u_gamma_scale),u_device_pixel_ratio:new x.Uniform1f(b,n.u_device_pixel_ratio),u_is_halo:new x.Uniform1i(b,n.u_is_halo)}),symbolTextAndIcon:(b,n)=>({u_is_size_zoom_constant:new x.Uniform1i(b,n.u_is_size_zoom_constant),u_is_size_feature_constant:new x.Uniform1i(b,n.u_is_size_feature_constant),u_size_t:new x.Uniform1f(b,n.u_size_t),u_size:new x.Uniform1f(b,n.u_size),u_camera_to_center_distance:new x.Uniform1f(b,n.u_camera_to_center_distance),u_pitch:new x.Uniform1f(b,n.u_pitch),u_rotate_symbol:new x.Uniform1i(b,n.u_rotate_symbol),u_aspect_ratio:new x.Uniform1f(b,n.u_aspect_ratio),u_fade_change:new x.Uniform1f(b,n.u_fade_change),u_matrix:new x.UniformMatrix4f(b,n.u_matrix),u_label_plane_matrix:new x.UniformMatrix4f(b,n.u_label_plane_matrix),u_coord_matrix:new x.UniformMatrix4f(b,n.u_coord_matrix),u_is_text:new x.Uniform1i(b,n.u_is_text),u_pitch_with_map:new x.Uniform1i(b,n.u_pitch_with_map),u_texsize:new x.Uniform2f(b,n.u_texsize),u_texsize_icon:new x.Uniform2f(b,n.u_texsize_icon),u_texture:new x.Uniform1i(b,n.u_texture),u_texture_icon:new x.Uniform1i(b,n.u_texture_icon),u_gamma_scale:new x.Uniform1f(b,n.u_gamma_scale),u_device_pixel_ratio:new x.Uniform1f(b,n.u_device_pixel_ratio),u_is_halo:new x.Uniform1i(b,n.u_is_halo)}),background:(b,n)=>({u_matrix:new x.UniformMatrix4f(b,n.u_matrix),u_opacity:new x.Uniform1f(b,n.u_opacity),u_color:new x.UniformColor(b,n.u_color)}),backgroundPattern:(b,n)=>({u_matrix:new x.UniformMatrix4f(b,n.u_matrix),u_opacity:new x.Uniform1f(b,n.u_opacity),u_image:new x.Uniform1i(b,n.u_image),u_pattern_tl_a:new x.Uniform2f(b,n.u_pattern_tl_a),u_pattern_br_a:new x.Uniform2f(b,n.u_pattern_br_a),u_pattern_tl_b:new x.Uniform2f(b,n.u_pattern_tl_b),u_pattern_br_b:new x.Uniform2f(b,n.u_pattern_br_b),u_texsize:new x.Uniform2f(b,n.u_texsize),u_mix:new x.Uniform1f(b,n.u_mix),u_pattern_size_a:new x.Uniform2f(b,n.u_pattern_size_a),u_pattern_size_b:new x.Uniform2f(b,n.u_pattern_size_b),u_scale_a:new x.Uniform1f(b,n.u_scale_a),u_scale_b:new x.Uniform1f(b,n.u_scale_b),u_pixel_coord_upper:new x.Uniform2f(b,n.u_pixel_coord_upper),u_pixel_coord_lower:new x.Uniform2f(b,n.u_pixel_coord_lower),u_tile_units_to_pixels:new x.Uniform1f(b,n.u_tile_units_to_pixels)})};class jo{constructor(n,h,v){this.context=n;const w=n.gl;this.buffer=w.createBuffer(),this.dynamicDraw=Boolean(v),this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const qo={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ba{constructor(n,h,v,w){this.length=h.length,this.attributes=v,this.itemSize=h.bytesPerElement,this.dynamicDraw=w,this.context=n;const I=n.gl;this.buffer=I.createBuffer(),n.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,h){for(let v=0;v<this.attributes.length;v++){const w=h.attributes[this.attributes[v].name];w!==void 0&&n.enableVertexAttribArray(w)}}setVertexAttribPointers(n,h,v){for(let w=0;w<this.attributes.length;w++){const I=this.attributes[w],L=h.attributes[I.name];L!==void 0&&n.vertexAttribPointer(L,I.components,n[qo[I.type]],!1,this.itemSize,I.offset+this.itemSize*(v||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Pi{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class wa extends Pi{getDefault(){return x.Color.transparent}set(n){const h=this.current;(n.r!==h.r||n.g!==h.g||n.b!==h.b||n.a!==h.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Ea extends Pi{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class an extends Pi{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Sr extends Pi{getDefault(){return[!0,!0,!0,!0]}set(n){const h=this.current;(n[0]!==h[0]||n[1]!==h[1]||n[2]!==h[2]||n[3]!==h[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class sn extends Pi{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class al extends Pi{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class sl extends Pi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const h=this.current;(n.func!==h.func||n.ref!==h.ref||n.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class ll extends Pi{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const h=this.current;(n[0]!==h[0]||n[1]!==h[1]||n[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Cs extends Pi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;n?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=n,this.dirty=!1}}class zs extends Pi{getDefault(){return[0,1]}set(n){const h=this.current;(n[0]!==h[0]||n[1]!==h[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class ss extends Pi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;n?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=n,this.dirty=!1}}class Ps extends Pi{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class ul extends Pi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;n?h.enable(h.BLEND):h.disable(h.BLEND),this.current=n,this.dirty=!1}}class ks extends Pi{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const h=this.current;(n[0]!==h[0]||n[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class du extends Pi{getDefault(){return x.Color.transparent}set(n){const h=this.current;(n.r!==h.r||n.g!==h.g||n.b!==h.b||n.a!==h.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class ls extends Pi{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class Go extends Pi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;n?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=n,this.dirty=!1}}class fu extends Pi{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class ln extends Pi{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}class Ul extends Pi{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}}class Sa extends Pi{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class Ta extends Pi{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const h=this.current;(n[0]!==h[0]||n[1]!==h[1]||n[2]!==h[2]||n[3]!==h[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class ja extends Pi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class ra extends Pi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Zo extends Pi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class wo extends Pi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Ia extends Pi{getDefault(){return null}set(n){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class na extends Pi{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class cl extends Pi{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class Aa extends Pi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class Xi extends Pi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class qa extends Pi{constructor(n,h){super(n),this.context=n,this.parent=h}getDefault(){return null}}class oa extends qa{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class Vl extends qa{set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class hl{constructor(n,h,v,w){this.context=n,this.width=h,this.height=v;const I=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new oa(n,I),w&&(this.depthAttachment=new Vl(n,I))}destroy(){const n=this.context.gl,h=this.colorAttachment.get();if(h&&n.deleteTexture(h),this.depthAttachment){const v=this.depthAttachment.get();v&&n.deleteRenderbuffer(v)}n.deleteFramebuffer(this.framebuffer)}}class _i{constructor(n,h,v){this.blendFunction=n,this.blendColor=h,this.mask=v}}_i.Replace=[1,0],_i.disabled=new _i(_i.Replace,x.Color.transparent,[!1,!1,!1,!1]),_i.unblended=new _i(_i.Replace,x.Color.transparent,[!0,!0,!0,!0]),_i.alphaBlended=new _i([1,771],x.Color.transparent,[!0,!0,!0,!0]);class Ms{constructor(n){this.gl=n,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new wa(this),this.clearDepth=new Ea(this),this.clearStencil=new an(this),this.colorMask=new Sr(this),this.depthMask=new sn(this),this.stencilMask=new al(this),this.stencilFunc=new sl(this),this.stencilOp=new ll(this),this.stencilTest=new Cs(this),this.depthRange=new zs(this),this.depthTest=new ss(this),this.depthFunc=new Ps(this),this.blend=new ul(this),this.blendFunc=new ks(this),this.blendColor=new du(this),this.blendEquation=new ls(this),this.cullFace=new Go(this),this.cullFaceSide=new fu(this),this.frontFace=new ln(this),this.program=new Ul(this),this.activeTexture=new Sa(this),this.viewport=new Ta(this),this.bindFramebuffer=new ja(this),this.bindRenderbuffer=new ra(this),this.bindTexture=new Zo(this),this.bindVertexBuffer=new wo(this),this.bindElementBuffer=new Ia(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new na(this),this.pixelStoreUnpack=new cl(this),this.pixelStoreUnpackPremultiplyAlpha=new Aa(this),this.pixelStoreUnpackFlipY=new Xi(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=n.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(n.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,h){return new jo(this,n,h)}createVertexBuffer(n,h,v){return new ba(this,n,h,v)}createRenderbuffer(n,h,v){const w=this.gl,I=w.createRenderbuffer();return this.bindRenderbuffer.set(I),w.renderbufferStorage(w.RENDERBUFFER,n,h,v),this.bindRenderbuffer.set(null),I}createFramebuffer(n,h,v){return new hl(this,n,h,v)}clear({color:n,depth:h}){const v=this.gl;let w=0;n&&(w|=v.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(w|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),v.clear(w)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){Qe(n.blendFunction,_i.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Di{constructor(n,h,v){this.func=n,this.mask=h,this.range=v}}Di.ReadOnly=!1,Di.ReadWrite=!0,Di.disabled=new Di(519,Di.ReadOnly,[0,1]);const Po=7680;class Yi{constructor(n,h,v,w,I,L){this.test=n,this.ref=h,this.mask=v,this.fail=w,this.depthFail=I,this.pass=L}}Yi.disabled=new Yi({func:519,mask:0},0,0,Po,Po,Po);class Tr{constructor(n,h,v){this.enable=n,this.mode=h,this.frontFace=v}}let Ls;function Ds(b,n,h,v,w,I,L){const O=b.context,N=O.gl,$=b.useProgram("collisionBox"),H=[];let re=0,fe=0;for(let je=0;je<v.length;je++){const st=v[je],et=n.getTile(st),rt=et.getBucket(h);if(!rt)continue;let mt=st.posMatrix;w[0]===0&&w[1]===0||(mt=b.translatePosMatrix(st.posMatrix,et,w,I));const xt=L?rt.textCollisionBox:rt.iconCollisionBox,lt=rt.collisionCircleArray;if(lt.length>0){const qt=x.create(),Rt=mt;x.mul(qt,rt.placementInvProjMatrix,b.transform.glCoordMatrix),x.mul(qt,qt,rt.placementViewportMatrix),H.push({circleArray:lt,circleOffset:fe,transform:Rt,invTransform:qt}),re+=lt.length/4,fe=re}xt&&$.draw(O,N.LINES,Di.disabled,Yi.disabled,b.colorModeForRenderPass(),Tr.disabled,bo(mt,b.transform,et),h.id,xt.layoutVertexBuffer,xt.indexBuffer,xt.segments,null,b.transform.zoom,null,null,xt.collisionVertexBuffer)}if(!L||!H.length)return;const Pe=b.useProgram("collisionCircle"),ye=new x.CollisionCircleLayoutArray;ye.resize(4*re),ye._trim();let ze=0;for(const je of H)for(let st=0;st<je.circleArray.length/4;st++){const et=4*st,rt=je.circleArray[et+0],mt=je.circleArray[et+1],xt=je.circleArray[et+2],lt=je.circleArray[et+3];ye.emplace(ze++,rt,mt,xt,lt,0),ye.emplace(ze++,rt,mt,xt,lt,1),ye.emplace(ze++,rt,mt,xt,lt,2),ye.emplace(ze++,rt,mt,xt,lt,3)}(!Ls||Ls.length<2*re)&&(Ls=function(je){const st=2*je,et=new x.QuadTriangleArray;et.resize(st),et._trim();for(let rt=0;rt<st;rt++){const mt=6*rt;et.uint16[mt+0]=4*rt+0,et.uint16[mt+1]=4*rt+1,et.uint16[mt+2]=4*rt+2,et.uint16[mt+3]=4*rt+2,et.uint16[mt+4]=4*rt+3,et.uint16[mt+5]=4*rt+0}return et}(re));const Ve=O.createIndexBuffer(Ls,!0),Fe=O.createVertexBuffer(ye,x.collisionCircleLayout.members,!0);for(const je of H){const st={u_matrix:je.transform,u_inv_matrix:je.invTransform,u_camera_to_center_distance:(Xe=b.transform).cameraToCenterDistance,u_viewport_size:[Xe.width,Xe.height]};Pe.draw(O,N.TRIANGLES,Di.disabled,Yi.disabled,b.colorModeForRenderPass(),Tr.disabled,st,h.id,Fe,Ve,x.SegmentVector.simpleSegment(0,2*je.circleOffset,je.circleArray.length,je.circleArray.length/2),null,b.transform.zoom,null,null,null)}var Xe;Fe.destroy(),Ve.destroy()}Tr.disabled=new Tr(!1,1029,2305),Tr.backCCW=new Tr(!0,1029,2305);const Ga=x.identity(new Float32Array(16));function pl(b,n,h,v,w,I){const{horizontalAlign:L,verticalAlign:O}=x.getAnchorAlignment(b),N=-(L-.5)*n,$=-(O-.5)*h,H=x.evaluateVariableOffset(b,v);return new x.pointGeometry((N/w+H[0])*I,($/w+H[1])*I)}function $o(b,n,h,v,w,I,L,O,N,$){const H=b.text.placedSymbolArray,re=b.text.dynamicLayoutVertexArray,fe=b.icon.dynamicLayoutVertexArray,Pe={};re.clear();for(let ye=0;ye<H.length;ye++){const ze=H.get(ye),Ve=b.allowVerticalPlacement&&!ze.placedOrientation,Fe=ze.hidden||!ze.crossTileID||Ve?null:v[ze.crossTileID];if(Fe){const Xe=new x.pointGeometry(ze.anchorX,ze.anchorY),je=er(Xe,h?L:I),st=Ct(w.cameraToCenterDistance,je.signedDistanceFromCamera);let et=x.evaluateSizeForFeature(b.textSizeData,N,ze)*st/x.ONE_EM;h&&(et*=b.tilePixelRatio/O);const{width:rt,height:mt,anchor:xt,textOffset:lt,textBoxScale:qt}=Fe,Rt=pl(xt,rt,mt,lt,qt,et),li=h?er(Xe.add(Rt),I).point:je.point.add(n?Rt.rotate(-w.angle):Rt),s=b.allowVerticalPlacement&&ze.placedOrientation===x.WritingMode.vertical?Math.PI/2:0;for(let c=0;c<ze.numGlyphs;c++)x.addDynamicAttributes(re,li,s);$&&ze.associatedIconIndex>=0&&(Pe[ze.associatedIconIndex]={shiftedAnchor:li,angle:s})}else X(ze.numGlyphs,re)}if($){fe.clear();const ye=b.icon.placedSymbolArray;for(let ze=0;ze<ye.length;ze++){const Ve=ye.get(ze);if(Ve.hidden)X(Ve.numGlyphs,fe);else{const Fe=Pe[ze];if(Fe)for(let Xe=0;Xe<Ve.numGlyphs;Xe++)x.addDynamicAttributes(fe,Fe.shiftedAnchor,Fe.angle);else X(Ve.numGlyphs,fe)}}b.icon.dynamicLayoutVertexBuffer.updateData(fe)}b.text.dynamicLayoutVertexBuffer.updateData(re)}function Xo(b,n,h){return h.iconsInText&&n?"symbolTextAndIcon":b?"symbolSDF":"symbolIcon"}function Rs(b,n,h,v,w,I,L,O,N,$,H,re){const fe=b.context,Pe=fe.gl,ye=b.transform,ze=O==="map",Ve=N==="map",Fe=O!=="viewport"&&h.layout.get("symbol-placement")!=="point",Xe=ze&&!Ve&&!Fe,je=!h.layout.get("symbol-sort-key").isConstant();let st=!1;const et=b.depthModeForSublayer(0,Di.ReadOnly),rt=h.layout.get("text-variable-anchor"),mt=[];for(const xt of v){const lt=n.getTile(xt),qt=lt.getBucket(h);if(!qt)continue;const Rt=w?qt.text:qt.icon;if(!Rt||!Rt.segments.get().length)continue;const li=Rt.programConfigurations.get(h.id),s=w||qt.sdfIcons,c=w?qt.textSizeData:qt.iconSizeData,u=Ve||ye.pitch!==0,f=b.useProgram(Xo(s,w,qt),li),S=x.evaluateSizeForZoom(c,ye.zoom);let A,z,B,q,W=[0,0],oe=null;if(w){if(z=lt.glyphAtlasTexture,B=Pe.LINEAR,A=lt.glyphAtlasTexture.size,qt.iconsInText){W=lt.imageAtlasTexture.size,oe=lt.imageAtlasTexture;const Je=c.kind==="composite"||c.kind==="camera";q=u||b.options.rotating||b.options.zooming||Je?Pe.LINEAR:Pe.NEAREST}}else{const Je=h.layout.get("icon-size").constantOr(0)!==1||qt.iconsNeedLinear;z=lt.imageAtlasTexture,B=s||b.options.rotating||b.options.zooming||Je||u?Pe.LINEAR:Pe.NEAREST,A=lt.imageAtlasTexture.size}const se=xe(lt,1,b.transform.zoom),ue=Zr(xt.posMatrix,Ve,ze,b.transform,se),Ee=uo(xt.posMatrix,Ve,ze,b.transform,se),be=rt&&qt.hasTextData(),Ce=h.layout.get("icon-text-fit")!=="none"&&be&&qt.hasIconData();if(Fe){const Je=h.layout.get("text-rotation-alignment")==="map";gi(qt,xt.posMatrix,b,w,ue,Ee,Ve,$,Je)}const me=b.translatePosMatrix(xt.posMatrix,lt,I,L),Te=Fe||w&&rt||Ce?Ga:ue,Le=b.translatePosMatrix(Ee,lt,I,L,!0),Ne=s&&h.paint.get(w?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let We;We=s?qt.iconsInText?As(c.kind,S,Xe,Ve,b,me,Te,Le,A,W):Is(c.kind,S,Xe,Ve,b,me,Te,Le,w,A,!0):ia(c.kind,S,Xe,Ve,b,me,Te,Le,w,A);const He={program:f,buffers:Rt,uniformValues:We,atlasTexture:z,atlasTextureIcon:oe,atlasInterpolation:B,atlasInterpolationIcon:q,isSDF:s,hasHalo:Ne};if(je&&qt.canOverlap){st=!0;const Je=Rt.segments.get();for(const ut of Je)mt.push({segments:new x.SegmentVector([ut]),sortKey:ut.sortKey,state:He})}else mt.push({segments:Rt.segments,sortKey:0,state:He})}st&&mt.sort((xt,lt)=>xt.sortKey-lt.sortKey);for(const xt of mt){const lt=xt.state;if(fe.activeTexture.set(Pe.TEXTURE0),lt.atlasTexture.bind(lt.atlasInterpolation,Pe.CLAMP_TO_EDGE),lt.atlasTextureIcon&&(fe.activeTexture.set(Pe.TEXTURE1),lt.atlasTextureIcon&&lt.atlasTextureIcon.bind(lt.atlasInterpolationIcon,Pe.CLAMP_TO_EDGE)),lt.isSDF){const qt=lt.uniformValues;lt.hasHalo&&(qt.u_is_halo=1,Ca(lt.buffers,xt.segments,h,b,lt.program,et,H,re,qt)),qt.u_is_halo=0}Ca(lt.buffers,xt.segments,h,b,lt.program,et,H,re,lt.uniformValues)}}function Ca(b,n,h,v,w,I,L,O,N){const $=v.context;w.draw($,$.gl.TRIANGLES,I,L,O,Tr.disabled,N,h.id,b.layoutVertexBuffer,b.indexBuffer,n,h.paint,v.transform.zoom,b.programConfigurations.get(h.id),b.dynamicLayoutVertexBuffer,b.opacityVertexBuffer)}function Qi(b,n,h,v,w,I,L){const O=b.context.gl,N=h.paint.get("fill-pattern"),$=N&&N.constantOr(1),H=h.getCrossfadeParameters();let re,fe,Pe,ye,ze;L?(fe=$&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",re=O.LINES):(fe=$?"fillPattern":"fill",re=O.TRIANGLES);for(const Ve of v){const Fe=n.getTile(Ve);if($&&!Fe.patternsLoaded())continue;const Xe=Fe.getBucket(h);if(!Xe)continue;const je=Xe.programConfigurations.get(h.id),st=b.useProgram(fe,je);$&&(b.context.activeTexture.set(O.TEXTURE0),Fe.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),je.updatePaintBuffers(H));const et=N.constantOr(null);if(et&&Fe.imageAtlas){const mt=Fe.imageAtlas,xt=mt.patternPositions[et.to.toString()],lt=mt.patternPositions[et.from.toString()];xt&&lt&&je.setConstantPatternPositions(xt,lt)}const rt=b.translatePosMatrix(Ve.posMatrix,Fe,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(L){ye=Xe.indexBuffer2,ze=Xe.segments2;const mt=[O.drawingBufferWidth,O.drawingBufferHeight];Pe=fe==="fillOutlinePattern"&&$?po(rt,b,H,Fe,mt):Rl(rt,mt)}else ye=Xe.indexBuffer,ze=Xe.segments,Pe=$?Dn(rt,b,H,Fe):ho(rt);st.draw(b.context,re,w,b.stencilModeForClipping(Ve),I,Tr.disabled,Pe,h.id,Xe.layoutVertexBuffer,ye,ze,h.paint,b.transform.zoom,je)}}function aa(b,n,h,v,w,I,L){const O=b.context,N=O.gl,$=h.paint.get("fill-extrusion-pattern"),H=$.constantOr(1),re=h.getCrossfadeParameters(),fe=h.paint.get("fill-extrusion-opacity");for(const Pe of v){const ye=n.getTile(Pe),ze=ye.getBucket(h);if(!ze)continue;const Ve=ze.programConfigurations.get(h.id),Fe=b.useProgram(H?"fillExtrusionPattern":"fillExtrusion",Ve);H&&(b.context.activeTexture.set(N.TEXTURE0),ye.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),Ve.updatePaintBuffers(re));const Xe=$.constantOr(null);if(Xe&&ye.imageAtlas){const rt=ye.imageAtlas,mt=rt.patternPositions[Xe.to.toString()],xt=rt.patternPositions[Xe.from.toString()];mt&&xt&&Ve.setConstantPatternPositions(mt,xt)}const je=b.translatePosMatrix(Pe.posMatrix,ye,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),st=h.paint.get("fill-extrusion-vertical-gradient"),et=H?tr(je,b,st,fe,Pe,re,ye):co(je,b,st,fe);Fe.draw(O,O.gl.TRIANGLES,w,I,L,Tr.backCCW,et,h.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,h.paint,b.transform.zoom,Ve)}}function dl(b,n,h,v,w,I){const L=b.context,O=L.gl,N=n.fbo;if(!N)return;const $=b.useProgram("hillshade");L.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,N.colorAttachment.get());const H=((re,fe,Pe)=>{const ye=Pe.paint.get("hillshade-shadow-color"),ze=Pe.paint.get("hillshade-highlight-color"),Ve=Pe.paint.get("hillshade-accent-color");let Fe=Pe.paint.get("hillshade-illumination-direction")*(Math.PI/180);Pe.paint.get("hillshade-illumination-anchor")==="viewport"&&(Fe-=re.transform.angle);const Xe=!re.options.moving;return{u_matrix:re.transform.calculatePosMatrix(fe.tileID.toUnwrapped(),Xe),u_image:0,u_latrange:No(0,fe.tileID),u_light:[Pe.paint.get("hillshade-exaggeration"),Fe],u_shadow:ye,u_highlight:ze,u_accent:Ve}})(b,n,h);$.draw(L,O.TRIANGLES,v,w,I,Tr.disabled,H,h.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments)}function Sn(b,n,h,v,w,I){const L=b.context,O=L.gl,N=n.dem;if(N&&N.data){const $=N.dim,H=N.stride,re=N.getPixels();if(L.activeTexture.set(O.TEXTURE1),L.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||b.getTileTexture(H),n.demTexture){const Pe=n.demTexture;Pe.update(re,{premultiply:!1}),Pe.bind(O.NEAREST,O.CLAMP_TO_EDGE)}else n.demTexture=new Ht(L,re,O.RGBA,{premultiply:!1}),n.demTexture.bind(O.NEAREST,O.CLAMP_TO_EDGE);L.activeTexture.set(O.TEXTURE0);let fe=n.fbo;if(!fe){const Pe=new Ht(L,{width:$,height:$,data:null},O.RGBA);Pe.bind(O.LINEAR,O.CLAMP_TO_EDGE),fe=n.fbo=L.createFramebuffer($,$,!0),fe.colorAttachment.set(Pe.texture)}L.bindFramebuffer.set(fe.framebuffer),L.viewport.set([0,0,$,$]),b.useProgram("hillshadePrepare").draw(L,O.TRIANGLES,v,w,I,Tr.disabled,((Pe,ye)=>{const ze=ye.stride,Ve=x.create();return x.ortho(Ve,0,x.EXTENT,-x.EXTENT,0,0,1),x.translate(Ve,Ve,[0,-x.EXTENT,0]),{u_matrix:Ve,u_image:1,u_dimension:[ze,ze],u_zoom:Pe.overscaledZ,u_unpack:ye.getUnpackVector()}})(n.tileID,N),h.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments),n.needsHillshadePrepare=!1}}function Nl(b,n,h,v,w){const I=v.paint.get("raster-fade-duration");if(I>0){const L=x.exported.now(),O=(L-b.timeAdded)/I,N=n?(L-n.timeAdded)/I:-1,$=h.getSource(),H=w.coveringZoomLevel({tileSize:$.tileSize,roundZoom:$.roundZoom}),re=!n||Math.abs(n.tileID.overscaledZ-H)>Math.abs(b.tileID.overscaledZ-H),fe=re&&b.refreshedUponExpiration?1:x.clamp(re?O:1-N,0,1);return b.refreshedUponExpiration&&O>=1&&(b.refreshedUponExpiration=!1),n?{opacity:1,mix:1-fe}:{opacity:fe,mix:0}}return{opacity:1,mix:0}}const mu=new x.Color(1,0,0,1),jl=new x.Color(0,1,0,1),sa=new x.Color(0,0,1,1),la=new x.Color(1,0,1,1),Za=new x.Color(0,1,1,1);function Bs(b,n,h,v){ua(b,0,n+h/2,b.transform.width,h,v)}function za(b,n,h,v){ua(b,n-h/2,0,h,b.transform.height,v)}function ua(b,n,h,v,w,I){const L=b.context,O=L.gl;O.enable(O.SCISSOR_TEST),O.scissor(n*b.pixelRatio,h*b.pixelRatio,v*b.pixelRatio,w*b.pixelRatio),L.clear({color:I}),O.disable(O.SCISSOR_TEST)}function ql(b,n,h){const v=b.context,w=v.gl,I=h.posMatrix,L=b.useProgram("debug"),O=Di.disabled,N=Yi.disabled,$=b.colorModeForRenderPass(),H="$debug";v.activeTexture.set(w.TEXTURE0),b.emptyTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),L.draw(v,w.LINE_STRIP,O,N,$,Tr.disabled,Er(I,x.Color.red),H,b.debugBuffer,b.tileBorderIndexBuffer,b.debugSegments);const re=n.getTileByID(h.key).latestRawTileData,fe=Math.floor((re&&re.byteLength||0)/1024),Pe=n.getTile(h).tileSize,ye=512/Math.min(Pe,512)*(h.overscaledZ/b.transform.zoom)*.5;let ze=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(ze+=` => ${h.overscaledZ}`),function(Ve,Fe){Ve.initDebugOverlayCanvas();const Xe=Ve.debugOverlayCanvas,je=Ve.context.gl,st=Ve.debugOverlayCanvas.getContext("2d");st.clearRect(0,0,Xe.width,Xe.height),st.shadowColor="white",st.shadowBlur=2,st.lineWidth=1.5,st.strokeStyle="white",st.textBaseline="top",st.font="bold 36px Open Sans, sans-serif",st.fillText(Fe,5,5),st.strokeText(Fe,5,5),Ve.debugOverlayTexture.update(Xe),Ve.debugOverlayTexture.bind(je.LINEAR,je.CLAMP_TO_EDGE)}(b,`${ze} ${fe}kb`),L.draw(v,w.TRIANGLES,O,N,_i.alphaBlended,Tr.disabled,Er(I,x.Color.transparent,ye),H,b.debugBuffer,b.quadTriangleIndexBuffer,b.debugSegments)}const Wo={symbol:function(b,n,h,v,w){if(b.renderPass!=="translucent")return;const I=Yi.disabled,L=b.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(O,N,$,H,re,fe,Pe){const ye=N.transform,ze=re==="map",Ve=fe==="map";for(const Fe of O){const Xe=H.getTile(Fe),je=Xe.getBucket($);if(!je||!je.text||!je.text.segments.get().length)continue;const st=x.evaluateSizeForZoom(je.textSizeData,ye.zoom),et=xe(Xe,1,N.transform.zoom),rt=Zr(Fe.posMatrix,Ve,ze,N.transform,et),mt=$.layout.get("icon-text-fit")!=="none"&&je.hasIconData();if(st){const xt=Math.pow(2,ye.zoom-Xe.tileID.overscaledZ);$o(je,ze,Ve,Pe,ye,rt,Fe.posMatrix,xt,st,mt)}}}(v,b,h,n,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),w),h.paint.get("icon-opacity").constantOr(1)!==0&&Rs(b,n,h,v,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),I,L),h.paint.get("text-opacity").constantOr(1)!==0&&Rs(b,n,h,v,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),I,L),n.map.showCollisionBoxes&&(Ds(b,n,h,v,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),Ds(b,n,h,v,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(b,n,h,v){if(b.renderPass!=="translucent")return;const w=h.paint.get("circle-opacity"),I=h.paint.get("circle-stroke-width"),L=h.paint.get("circle-stroke-opacity"),O=!h.layout.get("circle-sort-key").isConstant();if(w.constantOr(1)===0&&(I.constantOr(1)===0||L.constantOr(1)===0))return;const N=b.context,$=N.gl,H=b.depthModeForSublayer(0,Di.ReadOnly),re=Yi.disabled,fe=b.colorModeForRenderPass(),Pe=[];for(let ye=0;ye<v.length;ye++){const ze=v[ye],Ve=n.getTile(ze),Fe=Ve.getBucket(h);if(!Fe)continue;const Xe=Fe.programConfigurations.get(h.id),je={programConfiguration:Xe,program:b.useProgram("circle",Xe),layoutVertexBuffer:Fe.layoutVertexBuffer,indexBuffer:Fe.indexBuffer,uniformValues:Va(b,ze,Ve,h)};if(O){const st=Fe.segments.get();for(const et of st)Pe.push({segments:new x.SegmentVector([et]),sortKey:et.sortKey,state:je})}else Pe.push({segments:Fe.segments,sortKey:0,state:je})}O&&Pe.sort((ye,ze)=>ye.sortKey-ze.sortKey);for(const ye of Pe){const{programConfiguration:ze,program:Ve,layoutVertexBuffer:Fe,indexBuffer:Xe,uniformValues:je}=ye.state;Ve.draw(N,$.TRIANGLES,H,re,fe,Tr.disabled,je,h.id,Fe,Xe,ye.segments,h.paint,b.transform.zoom,ze)}},heatmap:function(b,n,h,v){if(h.paint.get("heatmap-opacity")!==0)if(b.renderPass==="offscreen"){const w=b.context,I=w.gl,L=Yi.disabled,O=new _i([I.ONE,I.ONE],x.Color.transparent,[!0,!0,!0,!0]);(function(N,$,H){const re=N.gl;N.activeTexture.set(re.TEXTURE1),N.viewport.set([0,0,$.width/4,$.height/4]);let fe=H.heatmapFbo;if(fe)re.bindTexture(re.TEXTURE_2D,fe.colorAttachment.get()),N.bindFramebuffer.set(fe.framebuffer);else{const Pe=re.createTexture();re.bindTexture(re.TEXTURE_2D,Pe),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_WRAP_S,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_WRAP_T,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_MIN_FILTER,re.LINEAR),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_MAG_FILTER,re.LINEAR),fe=H.heatmapFbo=N.createFramebuffer($.width/4,$.height/4,!1),function(ye,ze,Ve,Fe){const Xe=ye.gl;Xe.texImage2D(Xe.TEXTURE_2D,0,Xe.RGBA,ze.width/4,ze.height/4,0,Xe.RGBA,ye.extRenderToTextureHalfFloat?ye.extTextureHalfFloat.HALF_FLOAT_OES:Xe.UNSIGNED_BYTE,null),Fe.colorAttachment.set(Ve)}(N,$,Pe,fe)}})(w,b,h),w.clear({color:x.Color.transparent});for(let N=0;N<v.length;N++){const $=v[N];if(n.hasRenderableParent($))continue;const H=n.getTile($),re=H.getBucket(h);if(!re)continue;const fe=re.programConfigurations.get(h.id),Pe=b.useProgram("heatmap",fe),{zoom:ye}=b.transform;Pe.draw(w,I.TRIANGLES,Di.disabled,L,O,Tr.disabled,Xr($.posMatrix,H,ye,h.paint.get("heatmap-intensity")),h.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,h.paint,b.transform.zoom,fe)}w.viewport.set([0,0,b.width,b.height])}else b.renderPass==="translucent"&&(b.context.setColorMode(b.colorModeForRenderPass()),function(w,I){const L=w.context,O=L.gl,N=I.heatmapFbo;if(!N)return;L.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,N.colorAttachment.get()),L.activeTexture.set(O.TEXTURE1);let $=I.colorRampTexture;$||($=I.colorRampTexture=new Ht(L,I.colorRamp,O.RGBA)),$.bind(O.LINEAR,O.CLAMP_TO_EDGE),w.useProgram("heatmapTexture").draw(L,O.TRIANGLES,Di.disabled,Yi.disabled,w.colorModeForRenderPass(),Tr.disabled,((H,re,fe,Pe)=>{const ye=x.create();x.ortho(ye,0,H.width,H.height,0,0,1);const ze=H.context.gl;return{u_matrix:ye,u_world:[ze.drawingBufferWidth,ze.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:re.paint.get("heatmap-opacity")}})(w,I),I.id,w.viewportBuffer,w.quadTriangleIndexBuffer,w.viewportSegments,I.paint,w.transform.zoom)}(b,h))},line:function(b,n,h,v){if(b.renderPass!=="translucent")return;const w=h.paint.get("line-opacity"),I=h.paint.get("line-width");if(w.constantOr(1)===0||I.constantOr(1)===0)return;const L=b.depthModeForSublayer(0,Di.ReadOnly),O=b.colorModeForRenderPass(),N=h.paint.get("line-dasharray"),$=h.paint.get("line-pattern"),H=$.constantOr(1),re=h.paint.get("line-gradient"),fe=h.getCrossfadeParameters(),Pe=H?"linePattern":N?"lineSDF":re?"lineGradient":"line",ye=b.context,ze=ye.gl;let Ve=!0;for(const Fe of v){const Xe=n.getTile(Fe);if(H&&!Xe.patternsLoaded())continue;const je=Xe.getBucket(h);if(!je)continue;const st=je.programConfigurations.get(h.id),et=b.context.program.get(),rt=b.useProgram(Pe,st),mt=Ve||rt.program!==et,xt=$.constantOr(null);if(xt&&Xe.imageAtlas){const qt=Xe.imageAtlas,Rt=qt.patternPositions[xt.to.toString()],li=qt.patternPositions[xt.from.toString()];Rt&&li&&st.setConstantPatternPositions(Rt,li)}const lt=H?Na(b,Xe,h,fe):N?Vr(b,Xe,h,N,fe):re?ol(b,Xe,h,je.lineClipsArray.length):Ts(b,Xe,h);if(H)ye.activeTexture.set(ze.TEXTURE0),Xe.imageAtlasTexture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),st.updatePaintBuffers(fe);else if(N&&(mt||b.lineAtlas.dirty))ye.activeTexture.set(ze.TEXTURE0),b.lineAtlas.bind(ye);else if(re){const qt=je.gradients[h.id];let Rt=qt.texture;if(h.gradientVersion!==qt.version){let li=256;if(h.stepInterpolant){const s=n.getSource().maxzoom,c=Fe.canonical.z===s?Math.ceil(1<<b.transform.maxZoom-Fe.canonical.z):1;li=x.clamp(x.nextPowerOfTwo(je.maxLineLength/x.EXTENT*1024*c),256,ye.maxTextureSize)}qt.gradient=x.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:li,image:qt.gradient||void 0,clips:je.lineClipsArray}),qt.texture?qt.texture.update(qt.gradient):qt.texture=new Ht(ye,qt.gradient,ze.RGBA),qt.version=h.gradientVersion,Rt=qt.texture}ye.activeTexture.set(ze.TEXTURE0),Rt.bind(h.stepInterpolant?ze.NEAREST:ze.LINEAR,ze.CLAMP_TO_EDGE)}rt.draw(ye,ze.TRIANGLES,L,b.stencilModeForClipping(Fe),O,Tr.disabled,lt,h.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,h.paint,b.transform.zoom,st,je.layoutVertexBuffer2),Ve=!1}},fill:function(b,n,h,v){const w=h.paint.get("fill-color"),I=h.paint.get("fill-opacity");if(I.constantOr(1)===0)return;const L=b.colorModeForRenderPass(),O=h.paint.get("fill-pattern"),N=b.opaquePassEnabledForLayer()&&!O.constantOr(1)&&w.constantOr(x.Color.transparent).a===1&&I.constantOr(0)===1?"opaque":"translucent";if(b.renderPass===N){const $=b.depthModeForSublayer(1,b.renderPass==="opaque"?Di.ReadWrite:Di.ReadOnly);Qi(b,n,h,v,$,L,!1)}if(b.renderPass==="translucent"&&h.paint.get("fill-antialias")){const $=b.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,Di.ReadOnly);Qi(b,n,h,v,$,L,!0)}},"fill-extrusion":function(b,n,h,v){const w=h.paint.get("fill-extrusion-opacity");if(w!==0&&b.renderPass==="translucent"){const I=new Di(b.context.gl.LEQUAL,Di.ReadWrite,b.depthRangeFor3D);if(w!==1||h.paint.get("fill-extrusion-pattern").constantOr(1))aa(b,n,h,v,I,Yi.disabled,_i.disabled),aa(b,n,h,v,I,b.stencilModeFor3D(),b.colorModeForRenderPass());else{const L=b.colorModeForRenderPass();aa(b,n,h,v,I,Yi.disabled,L)}}},hillshade:function(b,n,h,v){if(b.renderPass!=="offscreen"&&b.renderPass!=="translucent")return;const w=b.context,I=b.depthModeForSublayer(0,Di.ReadOnly),L=b.colorModeForRenderPass(),[O,N]=b.renderPass==="translucent"?b.stencilConfigForOverlap(v):[{},v];for(const $ of N){const H=n.getTile($);H.needsHillshadePrepare&&b.renderPass==="offscreen"?Sn(b,H,h,I,Yi.disabled,L):b.renderPass==="translucent"&&dl(b,H,h,I,O[$.overscaledZ],L)}w.viewport.set([0,0,b.width,b.height])},raster:function(b,n,h,v){if(b.renderPass!=="translucent"||h.paint.get("raster-opacity")===0||!v.length)return;const w=b.context,I=w.gl,L=n.getSource(),O=b.useProgram("raster"),N=b.colorModeForRenderPass(),[$,H]=L instanceof kn?[{},v]:b.stencilConfigForOverlap(v),re=H[H.length-1].overscaledZ,fe=!b.options.moving;for(const Pe of H){const ye=b.depthModeForSublayer(Pe.overscaledZ-re,h.paint.get("raster-opacity")===1?Di.ReadWrite:Di.ReadOnly,I.LESS),ze=n.getTile(Pe),Ve=b.transform.calculatePosMatrix(Pe.toUnwrapped(),fe);ze.registerFadeDuration(h.paint.get("raster-fade-duration"));const Fe=n.findLoadedParent(Pe,0),Xe=Nl(ze,Fe,n,h,b.transform);let je,st;const et=h.paint.get("raster-resampling")==="nearest"?I.NEAREST:I.LINEAR;w.activeTexture.set(I.TEXTURE0),ze.texture.bind(et,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),w.activeTexture.set(I.TEXTURE1),Fe?(Fe.texture.bind(et,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),je=Math.pow(2,Fe.tileID.overscaledZ-ze.tileID.overscaledZ),st=[ze.tileID.canonical.x*je%1,ze.tileID.canonical.y*je%1]):ze.texture.bind(et,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST);const rt=Ol(Ve,st||[0,0],je||1,Xe,h);L instanceof kn?O.draw(w,I.TRIANGLES,ye,Yi.disabled,N,Tr.disabled,rt,h.id,L.boundsBuffer,b.quadTriangleIndexBuffer,L.boundsSegments):O.draw(w,I.TRIANGLES,ye,$[Pe.overscaledZ],N,Tr.disabled,rt,h.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments)}},background:function(b,n,h){const v=h.paint.get("background-color"),w=h.paint.get("background-opacity");if(w===0)return;const I=b.context,L=I.gl,O=b.transform,N=O.tileSize,$=h.paint.get("background-pattern");if(b.isPatternMissing($))return;const H=!$&&v.a===1&&w===1&&b.opaquePassEnabledForLayer()?"opaque":"translucent";if(b.renderPass!==H)return;const re=Yi.disabled,fe=b.depthModeForSublayer(0,H==="opaque"?Di.ReadWrite:Di.ReadOnly),Pe=b.colorModeForRenderPass(),ye=b.useProgram($?"backgroundPattern":"background"),ze=O.coveringTiles({tileSize:N});$&&(I.activeTexture.set(L.TEXTURE0),b.imageManager.bind(b.context));const Ve=h.getCrossfadeParameters();for(const Fe of ze){const Xe=b.transform.calculatePosMatrix(Fe.toUnwrapped()),je=$?as(Xe,w,b,$,{tileID:Fe,tileSize:N},Ve):pu(Xe,w,v);ye.draw(I,L.TRIANGLES,fe,re,Pe,Tr.disabled,je,h.id,b.tileExtentBuffer,b.quadTriangleIndexBuffer,b.tileExtentSegments)}},debug:function(b,n,h){for(let v=0;v<h.length;v++)ql(b,n,h[v])},custom:function(b,n,h){const v=b.context,w=h.implementation;if(b.renderPass==="offscreen"){const I=w.prerender;I&&(b.setCustomLayerDefaults(),v.setColorMode(b.colorModeForRenderPass()),I.call(w,v.gl,b.transform.customLayerMatrix()),v.setDirty(),b.setBaseState())}else if(b.renderPass==="translucent"){b.setCustomLayerDefaults(),v.setColorMode(b.colorModeForRenderPass()),v.setStencilMode(Yi.disabled);const I=w.renderingMode==="3d"?new Di(b.context.gl.LEQUAL,Di.ReadWrite,b.depthRangeFor3D):b.depthModeForSublayer(0,Di.ReadOnly);v.setDepthMode(I),w.render(v.gl,b.transform.customLayerMatrix()),v.setDirty(),b.setBaseState(),v.bindFramebuffer.set(null)}}};class fo{constructor(n,h){this.context=new Ms(n),this.transform=h,this._tileTextures={},this.setup(),this.numSublayers=ii.maxUnderzooming+ii.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Nt,this.gpuTimers={}}resize(n,h,v){if(this.width=n*v,this.height=h*v,this.pixelRatio=v,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const w of this.style._order)this.style._layers[w].resize()}setup(){const n=this.context,h=new x.PosArray;h.emplaceBack(0,0),h.emplaceBack(x.EXTENT,0),h.emplaceBack(0,x.EXTENT),h.emplaceBack(x.EXTENT,x.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(h,yn.members),this.tileExtentSegments=x.SegmentVector.simpleSegment(0,0,4,2);const v=new x.PosArray;v.emplaceBack(0,0),v.emplaceBack(x.EXTENT,0),v.emplaceBack(0,x.EXTENT),v.emplaceBack(x.EXTENT,x.EXTENT),this.debugBuffer=n.createVertexBuffer(v,yn.members),this.debugSegments=x.SegmentVector.simpleSegment(0,0,4,5);const w=new x.RasterBoundsArray;w.emplaceBack(0,0,0,0),w.emplaceBack(x.EXTENT,0,x.EXTENT,0),w.emplaceBack(0,x.EXTENT,0,x.EXTENT),w.emplaceBack(x.EXTENT,x.EXTENT,x.EXTENT,x.EXTENT),this.rasterBoundsBuffer=n.createVertexBuffer(w,bn.members),this.rasterBoundsSegments=x.SegmentVector.simpleSegment(0,0,4,2);const I=new x.PosArray;I.emplaceBack(0,0),I.emplaceBack(1,0),I.emplaceBack(0,1),I.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(I,yn.members),this.viewportSegments=x.SegmentVector.simpleSegment(0,0,4,2);const L=new x.LineStripIndexArray;L.emplaceBack(0),L.emplaceBack(1),L.emplaceBack(3),L.emplaceBack(2),L.emplaceBack(0),this.tileBorderIndexBuffer=n.createIndexBuffer(L);const O=new x.TriangleIndexArray;O.emplaceBack(0,1,2),O.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(O),this.emptyTexture=new Ht(n,{width:1,height:1,data:new Uint8Array([0,0,0,0])},n.gl.RGBA);const N=this.context.gl;this.stencilClearMode=new Yi({func:N.ALWAYS,mask:0},0,255,N.ZERO,N.ZERO,N.ZERO)}clearStencil(){const n=this.context,h=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const v=x.create();x.ortho(v,0,this.width,this.height,0,0,1),x.scale(v,v,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(n,h.TRIANGLES,Di.disabled,this.stencilClearMode,_i.disabled,Tr.disabled,$n(v),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(n,h){if(this.currentStencilSource===n.source||!n.isTileClipped()||!h||!h.length)return;this.currentStencilSource=n.source;const v=this.context,w=v.gl;this.nextStencilID+h.length>256&&this.clearStencil(),v.setColorMode(_i.disabled),v.setDepthMode(Di.disabled);const I=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const L of h){const O=this._tileClippingMaskIDs[L.key]=this.nextStencilID++;I.draw(v,w.TRIANGLES,Di.disabled,new Yi({func:w.ALWAYS,mask:0},O,255,w.KEEP,w.KEEP,w.REPLACE),_i.disabled,Tr.disabled,$n(L.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,h=this.context.gl;return new Yi({func:h.NOTEQUAL,mask:255},n,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(n){const h=this.context.gl;return new Yi({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(n){const h=this.context.gl,v=n.sort((L,O)=>O.overscaledZ-L.overscaledZ),w=v[v.length-1].overscaledZ,I=v[0].overscaledZ-w+1;if(I>1){this.currentStencilSource=void 0,this.nextStencilID+I>256&&this.clearStencil();const L={};for(let O=0;O<I;O++)L[O+w]=new Yi({func:h.GEQUAL,mask:255},O+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=I,[L,v]}return[{[w]:Yi.disabled},v]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new _i([n.CONSTANT_COLOR,n.ONE],new x.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?_i.unblended:_i.alphaBlended}depthModeForSublayer(n,h,v){if(!this.opaquePassEnabledForLayer())return Di.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new Di(v||this.context.gl.LEQUAL,h,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,h){this.style=n,this.options=h,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(x.exported.now()),this.imageManager.beginFrame();const v=this.style._order,w=this.style.sourceCaches;for(const N in w){const $=w[N];$.used&&$.prepare(this.context)}const I={},L={},O={};for(const N in w){const $=w[N];I[N]=$.getVisibleCoordinates(),L[N]=I[N].slice().reverse(),O[N]=$.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let N=0;N<v.length;N++)if(this.style._layers[v[N]].is3D()){this.opaquePassCutoff=N;break}this.renderPass="offscreen";for(const N of v){const $=this.style._layers[N];if(!$.hasOffscreenPass()||$.isHidden(this.transform.zoom))continue;const H=L[$.source];($.type==="custom"||H.length)&&this.renderLayer(this,w[$.source],$,H)}for(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?x.Color.black:x.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(n._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){const N=this.style._layers[v[this.currentLayer]],$=w[N.source],H=I[N.source];this._renderTileClippingMasks(N,H),this.renderLayer(this,$,N,H)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){const N=this.style._layers[v[this.currentLayer]],$=w[N.source],H=(N.type==="symbol"?O:L)[N.source];this._renderTileClippingMasks(N,I[N.source]),this.renderLayer(this,$,N,H)}if(this.options.showTileBoundaries){let N,$;Object.values(this.style._layers).forEach(H=>{H.source&&!H.isHidden(this.transform.zoom)&&(H.source!==($&&$.id)&&($=this.style.sourceCaches[H.source]),(!N||N.getSource().maxzoom<$.getSource().maxzoom)&&(N=$))}),N&&Wo.debug(this,N,N.getVisibleCoordinates())}this.options.showPadding&&function(N){const $=N.transform.padding;Bs(N,N.transform.height-($.top||0),3,mu),Bs(N,$.bottom||0,3,jl),za(N,$.left||0,3,sa),za(N,N.transform.width-($.right||0),3,la);const H=N.transform.centerPoint;(function(re,fe,Pe,ye){ua(re,fe-1,Pe-10,2,20,ye),ua(re,fe-10,Pe-1,20,2,ye)})(N,H.x,N.transform.height-H.y,Za)}(this),this.context.setDefault()}renderLayer(n,h,v,w){v.isHidden(this.transform.zoom)||(v.type==="background"||v.type==="custom"||w.length)&&(this.id=v.id,this.gpuTimingStart(v),Wo[v.type](n,h,v,w,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let v=this.gpuTimers[n.id];v||(v=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),v.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,v.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}queryGpuTimers(n){const h={};for(const v in n){const w=n[v],I=this.context.extTimerQuery,L=I.getQueryObjectEXT(w.query,I.QUERY_RESULT_EXT)/1e6;I.deleteQueryEXT(w.query),h[v]=L}return h}translatePosMatrix(n,h,v,w,I){if(!v[0]&&!v[1])return n;const L=I?w==="map"?this.transform.angle:0:w==="viewport"?-this.transform.angle:0;if(L){const $=Math.sin(L),H=Math.cos(L);v=[v[0]*H-v[1]*$,v[0]*$+v[1]*H]}const O=[I?v[0]:xe(h,v[0],this.transform.zoom),I?v[1]:xe(h,v[1],this.transform.zoom),0],N=new Float32Array(16);return x.translate(N,n,O),N}saveTileTexture(n){const h=this._tileTextures[n.size[0]];h?h.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const h=this._tileTextures[n];return h&&h.length>0?h.pop():null}isPatternMissing(n){if(!n)return!1;if(!n.from||!n.to)return!0;const h=this.imageManager.getPattern(n.from.toString()),v=this.imageManager.getPattern(n.to.toString());return!h||!v}useProgram(n,h){this.cache=this.cache||{};const v=`${n}${h?h.cacheKey:""}${this._showOverdrawInspector?"/overdraw":""}`;return this.cache[v]||(this.cache[v]=new En(this.context,n,Ss[n],h,Xn[n],this._showOverdrawInspector)),this.cache[v]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Ht(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class Os{constructor(n,h){this.points=n,this.planes=h}static fromInvProjectionMatrix(n,h,v){const w=Math.pow(2,v),I=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(O=>x.transformMat4([],O,n)).map(O=>x.scale$1([],O,1/O[3]/h*w)),L=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(O=>{const N=function(fe,Pe){var ye=Pe[0],ze=Pe[1],Ve=Pe[2],Fe=ye*ye+ze*ze+Ve*Ve;return Fe>0&&(Fe=1/Math.sqrt(Fe)),fe[0]=Pe[0]*Fe,fe[1]=Pe[1]*Fe,fe[2]=Pe[2]*Fe,fe}([],function(fe,Pe,ye){var ze=Pe[0],Ve=Pe[1],Fe=Pe[2],Xe=ye[0],je=ye[1],st=ye[2];return fe[0]=Ve*st-Fe*je,fe[1]=Fe*Xe-ze*st,fe[2]=ze*je-Ve*Xe,fe}([],Ei([],I[O[0]],I[O[1]]),Ei([],I[O[2]],I[O[1]]))),$=-((H=N)[0]*(re=I[O[1]])[0]+H[1]*re[1]+H[2]*re[2]);var H,re;return N.concat($)});return new Os(I,L)}}class Fs{constructor(n,h){this.min=n,this.max=h,this.center=function(v,w,I){return v[0]=.5*w[0],v[1]=.5*w[1],v[2]=.5*w[2],v}([],function(v,w,I){return v[0]=w[0]+I[0],v[1]=w[1]+I[1],v[2]=w[2]+I[2],v}([],this.min,this.max))}quadrant(n){const h=[n%2==0,n<2],v=ti(this.min),w=ti(this.max);for(let I=0;I<h.length;I++)v[I]=h[I]?this.min[I]:this.center[I],w[I]=h[I]?this.center[I]:this.max[I];return w[2]=this.max[2],new Fs(v,w)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}intersects(n){const h=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]];let v=!0;for(let w=0;w<n.planes.length;w++){const I=n.planes[w];let L=0;for(let O=0;O<h.length;O++)x.dot(I,h[O])>=0&&L++;if(L===0)return 0;L!==h.length&&(v=!1)}if(v)return 2;for(let w=0;w<3;w++){let I=Number.MAX_VALUE,L=-Number.MAX_VALUE;for(let O=0;O<n.points.length;O++){const N=n.points[O][w]-this.min[w];I=Math.min(I,N),L=Math.max(L,N)}if(L<0||I>this.max[w]-this.min[w])return 0}return 1}}class $a{constructor(n=0,h=0,v=0,w=0){if(isNaN(n)||n<0||isNaN(h)||h<0||isNaN(v)||v<0||isNaN(w)||w<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=h,this.left=v,this.right=w}interpolate(n,h,v){return h.top!=null&&n.top!=null&&(this.top=x.number(n.top,h.top,v)),h.bottom!=null&&n.bottom!=null&&(this.bottom=x.number(n.bottom,h.bottom,v)),h.left!=null&&n.left!=null&&(this.left=x.number(n.left,h.left,v)),h.right!=null&&n.right!=null&&(this.right=x.number(n.right,h.right,v)),this}getCenter(n,h){const v=x.clamp((this.left+n-this.right)/2,0,n),w=x.clamp((this.top+h-this.bottom)/2,0,h);return new x.pointGeometry(v,w)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new $a(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class ko{constructor(n,h,v,w,I){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=I===void 0||!!I,this._minZoom=n||0,this._maxZoom=h||22,this._minPitch=v==null?0:v,this._maxPitch=w==null?60:w,this.setMaxBounds(),this.width=0,this.height=0,this._center=new x.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new $a,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const n=new ko(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return n.tileSize=this.tileSize,n.latRange=this.latRange,n.width=this.width,n.height=this.height,n._center=this._center,n.zoom=this.zoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._calcMatrices(),n}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new x.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(n){const h=-x.wrap(n,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=function(){var v=new x.ARRAY_TYPE(4);return x.ARRAY_TYPE!=Float32Array&&(v[1]=0,v[2]=0),v[0]=1,v[3]=1,v}(),function(v,w,I){var L=w[0],O=w[1],N=w[2],$=w[3],H=Math.sin(I),re=Math.cos(I);v[0]=L*re+N*H,v[1]=O*re+$*H,v[2]=L*-H+N*re,v[3]=O*-H+$*re}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const h=x.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=n/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(n){const h=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.scale=this.zoomScale(h),this.tileZoom=Math.floor(h),this.zoomFraction=h-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,h,v){this._unmodified=!1,this._edgeInsets.interpolate(n,h,v),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const h=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(n){const h=[new x.UnwrappedTileID(0,n)];if(this._renderWorldCopies){const v=this.pointCoordinate(new x.pointGeometry(0,0)),w=this.pointCoordinate(new x.pointGeometry(this.width,0)),I=this.pointCoordinate(new x.pointGeometry(this.width,this.height)),L=this.pointCoordinate(new x.pointGeometry(0,this.height)),O=Math.floor(Math.min(v.x,w.x,I.x,L.x)),N=Math.floor(Math.max(v.x,w.x,I.x,L.x)),$=1;for(let H=O-$;H<=N+$;H++)H!==0&&h.push(new x.UnwrappedTileID(H,n))}return h}coveringTiles(n){let h=this.coveringZoomLevel(n);const v=h;if(n.minzoom!==void 0&&h<n.minzoom)return[];n.maxzoom!==void 0&&h>n.maxzoom&&(h=n.maxzoom);const w=x.MercatorCoordinate.fromLngLat(this.center),I=Math.pow(2,h),L=[I*w.x,I*w.y,0],O=Os.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h);let N=n.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(N=h);const $=ye=>({aabb:new Fs([ye*I,0,0],[(ye+1)*I,I,0]),zoom:0,x:0,y:0,wrap:ye,fullyVisible:!1}),H=[],re=[],fe=h,Pe=n.reparseOverscaled?v:h;if(this._renderWorldCopies)for(let ye=1;ye<=3;ye++)H.push($(-ye)),H.push($(ye));for(H.push($(0));H.length>0;){const ye=H.pop(),ze=ye.x,Ve=ye.y;let Fe=ye.fullyVisible;if(!Fe){const rt=ye.aabb.intersects(O);if(rt===0)continue;Fe=rt===2}const Xe=ye.aabb.distanceX(L),je=ye.aabb.distanceY(L),st=Math.max(Math.abs(Xe),Math.abs(je)),et=3+(1<<fe-ye.zoom)-2;if(ye.zoom===fe||st>et&&ye.zoom>=N)re.push({tileID:new x.OverscaledTileID(ye.zoom===fe?Pe:ye.zoom,ye.wrap,ye.zoom,ze,Ve),distanceSq:mi([L[0]-.5-ze,L[1]-.5-Ve])});else for(let rt=0;rt<4;rt++){const mt=(ze<<1)+rt%2,xt=(Ve<<1)+(rt>>1);H.push({aabb:ye.aabb.quadrant(rt),zoom:ye.zoom+1,x:mt,y:xt,wrap:ye.wrap,fullyVisible:Fe})}}return re.sort((ye,ze)=>ye.distanceSq-ze.distanceSq).map(ye=>ye.tileID)}resize(n,h){this.width=n,this.height=h,this.pixelsToGLUnits=[2/n,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const h=x.clamp(n.lat,-this.maxValidLatitude,this.maxValidLatitude);return new x.pointGeometry(x.mercatorXfromLng(n.lng)*this.worldSize,x.mercatorYfromLat(h)*this.worldSize)}unproject(n){return new x.MercatorCoordinate(n.x/this.worldSize,n.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}setLocationAtPoint(n,h){const v=this.pointCoordinate(h),w=this.pointCoordinate(this.centerPoint),I=this.locationCoordinate(n),L=new x.MercatorCoordinate(I.x-(v.x-w.x),I.y-(v.y-w.y));this.center=this.coordinateLocation(L),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(n){return this.coordinatePoint(this.locationCoordinate(n))}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}locationCoordinate(n){return x.MercatorCoordinate.fromLngLat(n)}coordinateLocation(n){return n.toLngLat()}pointCoordinate(n){const h=[n.x,n.y,0,1],v=[n.x,n.y,1,1];x.transformMat4(h,h,this.pixelMatrixInverse),x.transformMat4(v,v,this.pixelMatrixInverse);const w=h[3],I=v[3],L=h[1]/w,O=v[1]/I,N=h[2]/w,$=v[2]/I,H=N===$?0:(0-N)/($-N);return new x.MercatorCoordinate(x.number(h[0]/w,v[0]/I,H)/this.worldSize,x.number(L,O,H)/this.worldSize)}coordinatePoint(n){const h=[n.x*this.worldSize,n.y*this.worldSize,0,1];return x.transformMat4(h,h,this.pixelMatrix),new x.pointGeometry(h[0]/h[3],h[1]/h[3])}getBounds(){return new x.LngLatBounds().extend(this.pointLocation(new x.pointGeometry(0,0))).extend(this.pointLocation(new x.pointGeometry(this.width,0))).extend(this.pointLocation(new x.pointGeometry(this.width,this.height))).extend(this.pointLocation(new x.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new x.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}setMaxBounds(n){n?(this.lngRange=[n.getWest(),n.getEast()],this.latRange=[n.getSouth(),n.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(n,h=!1){const v=n.key,w=h?this._alignedPosMatrixCache:this._posMatrixCache;if(w[v])return w[v];const I=n.canonical,L=this.worldSize/this.zoomScale(I.z),O=I.x+Math.pow(2,I.z)*n.wrap,N=x.identity(new Float64Array(16));return x.translate(N,N,[O*L,I.y*L,0]),x.scale(N,N,[L/x.EXTENT,L/x.EXTENT,1]),x.multiply(N,h?this.alignedProjMatrix:this.projMatrix,N),w[v]=new Float32Array(N),w[v]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let n,h,v,w,I=-90,L=90,O=-180,N=180;const $=this.size,H=this._unmodified;if(this.latRange){const Pe=this.latRange;I=x.mercatorYfromLat(Pe[1])*this.worldSize,L=x.mercatorYfromLat(Pe[0])*this.worldSize,n=L-I<$.y?$.y/(L-I):0}if(this.lngRange){const Pe=this.lngRange;O=x.mercatorXfromLng(Pe[0])*this.worldSize,N=x.mercatorXfromLng(Pe[1])*this.worldSize,h=N-O<$.x?$.x/(N-O):0}const re=this.point,fe=Math.max(h||0,n||0);if(fe)return this.center=this.unproject(new x.pointGeometry(h?(N+O)/2:re.x,n?(L+I)/2:re.y)),this.zoom+=this.scaleZoom(fe),this._unmodified=H,void(this._constraining=!1);if(this.latRange){const Pe=re.y,ye=$.y/2;Pe-ye<I&&(w=I+ye),Pe+ye>L&&(w=L-ye)}if(this.lngRange){const Pe=re.x,ye=$.x/2;Pe-ye<O&&(v=O+ye),Pe+ye>N&&(v=N-ye)}v===void 0&&w===void 0||(this.center=this.unproject(new x.pointGeometry(v!==void 0?v:re.x,w!==void 0?w:re.y))),this._unmodified=H,this._constraining=!1}_calcMatrices(){if(!this.height)return;const n=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const h=Math.PI/2+this._pitch,v=this._fov*(.5+n.y/this.height),w=Math.sin(v)*this.cameraToCenterDistance/Math.sin(x.clamp(Math.PI-h-v,.01,Math.PI-.01)),I=this.point,L=I.x,O=I.y,N=1.01*(Math.cos(Math.PI/2-this._pitch)*w+this.cameraToCenterDistance),$=this.height/50;let H=new Float64Array(16);x.perspective(H,this._fov,this.width/this.height,$,N),H[8]=2*-n.x/this.width,H[9]=2*n.y/this.height,x.scale(H,H,[1,-1,1]),x.translate(H,H,[0,0,-this.cameraToCenterDistance]),x.rotateX(H,H,this._pitch),x.rotateZ(H,H,this.angle),x.translate(H,H,[-L,-O,0]),this.mercatorMatrix=x.scale([],H,[this.worldSize,this.worldSize,this.worldSize]),x.scale(H,H,[1,1,x.mercatorZfromAltitude(1,this.center.lat)*this.worldSize]),this.projMatrix=H,this.invProjMatrix=x.invert([],this.projMatrix);const re=this.width%2/2,fe=this.height%2/2,Pe=Math.cos(this.angle),ye=Math.sin(this.angle),ze=L-Math.round(L)+Pe*re+ye*fe,Ve=O-Math.round(O)+Pe*fe+ye*re,Fe=new Float64Array(H);if(x.translate(Fe,Fe,[ze>.5?ze-1:ze,Ve>.5?Ve-1:Ve,0]),this.alignedProjMatrix=Fe,H=x.create(),x.scale(H,H,[this.width/2,-this.height/2,1]),x.translate(H,H,[1,-1,0]),this.labelPlaneMatrix=H,H=x.create(),x.scale(H,H,[1,-1,1]),x.translate(H,H,[-1,-1,0]),x.scale(H,H,[2/this.width,2/this.height,1]),this.glCoordMatrix=H,this.pixelMatrix=x.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),H=x.invert(new Float64Array(16),this.pixelMatrix),!H)throw new Error("failed to invert matrix");this.pixelMatrixInverse=H,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const n=this.pointCoordinate(new x.pointGeometry(0,0)),h=[n.x*this.worldSize,n.y*this.worldSize,0,1];return x.transformMat4(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new x.pointGeometry(0,n))}getCameraQueryGeometry(n){const h=this.getCameraPoint();if(n.length===1)return[n[0],h];{let v=h.x,w=h.y,I=h.x,L=h.y;for(const O of n)v=Math.min(v,O.x),w=Math.min(w,O.y),I=Math.max(I,O.x),L=Math.max(L,O.y);return[new x.pointGeometry(v,w),new x.pointGeometry(I,w),new x.pointGeometry(I,L),new x.pointGeometry(v,L),new x.pointGeometry(v,w)]}}}class us{constructor(n){this._hashName=n&&encodeURIComponent(n),x.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(h,v){let w=!1,I=null;const L=()=>{I=null,w&&(h(),I=setTimeout(L,300),w=!1)};return()=>(w=!0,I||L(),I)}(this._updateHashUnthrottled.bind(this))}addTo(n){return this._map=n,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(n){const h=this._map.getCenter(),v=Math.round(100*this._map.getZoom())/100,w=Math.ceil((v*Math.LN2+Math.log(512/360/.5))/Math.LN10),I=Math.pow(10,w),L=Math.round(h.lng*I)/I,O=Math.round(h.lat*I)/I,N=this._map.getBearing(),$=this._map.getPitch();let H="";if(H+=n?`/${L}/${O}/${v}`:`${v}/${O}/${L}`,(N||$)&&(H+="/"+Math.round(10*N)/10),$&&(H+=`/${Math.round($)}`),this._hashName){const re=this._hashName;let fe=!1;const Pe=window.location.hash.slice(1).split("&").map(ye=>{const ze=ye.split("=")[0];return ze===re?(fe=!0,`${ze}=${H}`):ye}).filter(ye=>ye);return fe||Pe.push(`${re}=${H}`),`#${Pe.join("&")}`}return`#${H}`}_getCurrentHash(){const n=window.location.hash.replace("#","");if(this._hashName){let h;return n.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(h=v)}),(h&&h[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._getCurrentHash();if(n.length>=3&&!n.some(h=>isNaN(h))){const h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:h,pitch:+(n[4]||0)}),!0}return!1}_updateHashUnthrottled(){const n=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,n)}catch{}}}const Pa={linearity:.3,easing:x.bezier(0,0,.3,1)},fl=x.extend({deceleration:2500,maxSpeed:1400},Pa),Us=x.extend({deceleration:20,maxSpeed:1400},Pa),yu=x.extend({deceleration:1e3,maxSpeed:360},Pa),ca=x.extend({deceleration:1e3,maxSpeed:90},Pa);class ml{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:x.exported.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,h=x.exported.now();for(;n.length>0&&h-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new x.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:I}of this._inertiaBuffer)h.zoom+=I.zoomDelta||0,h.bearing+=I.bearingDelta||0,h.pitch+=I.pitchDelta||0,I.panDelta&&h.pan._add(I.panDelta),I.around&&(h.around=I.around),I.pinchAround&&(h.pinchAround=I.pinchAround);const v=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,w={};if(h.pan.mag()){const I=hs(h.pan.mag(),v,x.extend({},fl,n||{}));w.offset=h.pan.mult(I.amount/h.pan.mag()),w.center=this._map.transform.center,cs(w,I)}if(h.zoom){const I=hs(h.zoom,v,Us);w.zoom=this._map.transform.zoom+I.amount,cs(w,I)}if(h.bearing){const I=hs(h.bearing,v,yu);w.bearing=this._map.transform.bearing+x.clamp(I.amount,-179,179),cs(w,I)}if(h.pitch){const I=hs(h.pitch,v,ca);w.pitch=this._map.transform.pitch+I.amount,cs(w,I)}if(w.zoom||w.bearing){const I=h.pinchAround===void 0?h.around:h.pinchAround;w.around=I?this._map.unproject(I):this._map.getCenter()}return this.clear(),x.extend(w,{noMoveStart:!0})}}function cs(b,n){(!b.duration||b.duration<n.duration)&&(b.duration=n.duration,b.easing=n.easing)}function hs(b,n,h){const{maxSpeed:v,linearity:w,deceleration:I}=h,L=x.clamp(b*w/(n/1e3),-v,v),O=Math.abs(L)/(I*w);return{easing:h.easing,duration:1e3*O,amount:L*(O/2)}}class Tn extends x.Event{constructor(n,h,v,w={}){const I=Se.mousePos(h.getCanvasContainer(),v),L=h.unproject(I);super(n,x.extend({point:I,lngLat:L,originalEvent:v},w)),this._defaultPrevented=!1,this.target=h}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class In extends x.Event{constructor(n,h,v){const w=n==="touchend"?v.changedTouches:v.touches,I=Se.touchPos(h.getCanvasContainer(),w),L=I.map(N=>h.unproject(N)),O=I.reduce((N,$,H,re)=>N.add($.div(re.length)),new x.pointGeometry(0,0));super(n,{points:I,point:O,lngLats:L,lngLat:h.unproject(O),originalEvent:v}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Gl extends x.Event{constructor(n,h,v){super(n,{originalEvent:v}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class ha{constructor(n,h){this._map=n,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(n){return this._firePreventable(new Gl(n.type,this._map,n))}mousedown(n,h){return this._mousedownPos=h,this._firePreventable(new Tn(n.type,this._map,n))}mouseup(n){this._map.fire(new Tn(n.type,this._map,n))}click(n,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new Tn(n.type,this._map,n))}dblclick(n){return this._firePreventable(new Tn(n.type,this._map,n))}mouseover(n){this._map.fire(new Tn(n.type,this._map,n))}mouseout(n){this._map.fire(new Tn(n.type,this._map,n))}touchstart(n){return this._firePreventable(new In(n.type,this._map,n))}touchmove(n){this._map.fire(new In(n.type,this._map,n))}touchend(n){this._map.fire(new In(n.type,this._map,n))}touchcancel(n){this._map.fire(new In(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ps{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(n){this._map.fire(new Tn(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Tn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new Tn(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Xa{constructor(n,h){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,h){this.isEnabled()&&n.shiftKey&&n.button===0&&(Se.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(n,h){if(!this._active)return;const v=h;if(this._lastPos.equals(v)||!this._box&&v.dist(this._startPos)<this._clickTolerance)return;const w=this._startPos;this._lastPos=v,this._box||(this._box=Se.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const I=Math.min(w.x,v.x),L=Math.max(w.x,v.x),O=Math.min(w.y,v.y),N=Math.max(w.y,v.y);Se.setTransform(this._box,`translate(${I}px,${O}px)`),this._box.style.width=L-I+"px",this._box.style.height=N-O+"px"}mouseupWindow(n,h){if(!this._active||n.button!==0)return;const v=this._startPos,w=h;if(this.reset(),Se.suppressClick(),v.x!==w.x||v.y!==w.y)return this._map.fire(new x.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:I=>I.fitScreenCoordinates(v,w,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",n)}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(Se.remove(this._box),this._box=null),Se.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(n,h){return this._map.fire(new x.Event(n,{originalEvent:h}))}}function mo(b,n){const h={};for(let v=0;v<b.length;v++)h[b[v].identifier]=n[v];return h}class ur{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(n,h,v){(this.centroid||v.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=n.timeStamp),v.length===this.numTouches&&(this.centroid=function(w){const I=new x.pointGeometry(0,0);for(const L of w)I._add(L);return I.div(w.length)}(h),this.touches=mo(v,h)))}touchmove(n,h,v){if(this.aborted||!this.centroid)return;const w=mo(v,h);for(const I in this.touches){const L=this.touches[I],O=w[I];(!O||O.dist(L)>30)&&(this.aborted=!0)}}touchend(n,h,v){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),v.length===0){const w=!this.aborted&&this.centroid;if(this.reset(),w)return w}}}class ds{constructor(n){this.singleTap=new ur(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(n,h,v){this.singleTap.touchstart(n,h,v)}touchmove(n,h,v){this.singleTap.touchmove(n,h,v)}touchend(n,h,v){const w=this.singleTap.touchend(n,h,v);if(w){const I=n.timeStamp-this.lastTime<500,L=!this.lastTap||this.lastTap.dist(w)<30;if(I&&L||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=w,this.count===this.numTaps)return this.reset(),w}}}class Wa{constructor(){this._zoomIn=new ds({numTouches:1,numTaps:2}),this._zoomOut=new ds({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,h,v){this._zoomIn.touchstart(n,h,v),this._zoomOut.touchstart(n,h,v)}touchmove(n,h,v){this._zoomIn.touchmove(n,h,v),this._zoomOut.touchmove(n,h,v)}touchend(n,h,v){const w=this._zoomIn.touchend(n,h,v),I=this._zoomOut.touchend(n,h,v);return w?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:L=>L.easeTo({duration:300,zoom:L.getZoom()+1,around:L.unproject(w)},{originalEvent:n})}):I?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:L=>L.easeTo({duration:300,zoom:L.getZoom()-1,around:L.unproject(I)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const pa={0:1,2:2};class bi{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(n,h){return!1}_move(n,h){return{}}mousedown(n,h){if(this._lastPoint)return;const v=Se.mouseButton(n);this._correctButton(n,v)&&(this._lastPoint=h,this._eventButton=v)}mousemoveWindow(n,h){const v=this._lastPoint;if(v){if(n.preventDefault(),function(w,I){const L=pa[I];return w.buttons===void 0||(w.buttons&L)!==L}(n,this._eventButton))this.reset();else if(this._moved||!(h.dist(v)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(v,h)}}mouseupWindow(n){this._lastPoint&&Se.mouseButton(n)===this._eventButton&&(this._moved&&Se.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ji extends bi{mousedown(n,h){super.mousedown(n,h),this._lastPoint&&(this._active=!0)}_correctButton(n,h){return h===0&&!n.ctrlKey}_move(n,h){return{around:h,panDelta:h.sub(n)}}}class kt extends bi{_correctButton(n,h){return h===0&&n.ctrlKey||h===2}_move(n,h){const v=.8*(h.x-n.x);if(v)return this._active=!0,{bearingDelta:v}}contextmenu(n){n.preventDefault()}}class Ha extends bi{_correctButton(n,h){return h===0&&n.ctrlKey||h===2}_move(n,h){const v=-.5*(h.y-n.y);if(v)return this._active=!0,{pitchDelta:v}}contextmenu(n){n.preventDefault()}}class Ho{constructor(n){this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new x.pointGeometry(0,0)}touchstart(n,h,v){return this._calculateTransform(n,h,v)}touchmove(n,h,v){if(this._active&&!(v.length<this._minTouches))return n.preventDefault(),this._calculateTransform(n,h,v)}touchend(n,h,v){this._calculateTransform(n,h,v),this._active&&v.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,h,v){v.length>0&&(this._active=!0);const w=mo(v,h),I=new x.pointGeometry(0,0),L=new x.pointGeometry(0,0);let O=0;for(const $ in w){const H=w[$],re=this._touches[$];re&&(I._add(H),L._add(H.sub(re)),O++,w[$]=H)}if(this._touches=w,O<this._minTouches||!L.mag())return;const N=L.div(O);return this._sum._add(N),this._sum.mag()<this._clickTolerance?void 0:{around:I.div(O),panDelta:N}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(n){}_move(n,h,v){return{}}touchstart(n,h,v){this._firstTwoTouches||v.length<2||(this._firstTwoTouches=[v[0].identifier,v[1].identifier],this._start([h[0],h[1]]))}touchmove(n,h,v){if(!this._firstTwoTouches)return;n.preventDefault();const[w,I]=this._firstTwoTouches,L=Vs(v,h,w),O=Vs(v,h,I);if(!L||!O)return;const N=this._aroundCenter?null:L.add(O).div(2);return this._move([L,O],N,n)}touchend(n,h,v){if(!this._firstTwoTouches)return;const[w,I]=this._firstTwoTouches,L=Vs(v,h,w),O=Vs(v,h,I);L&&O||(this._active&&Se.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Vs(b,n,h){for(let v=0;v<b.length;v++)if(b[v].identifier===h)return n[v]}function Ot(b,n){return Math.log(b/n)/Math.LN2}class Ka extends Mo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,h){const v=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(Ot(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ot(this._distance,v),pinchAround:h}}}function fs(b,n){return 180*b.angleWith(n)/Math.PI}class da extends Mo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,h){const v=this._vector;if(this._vector=n[0].sub(n[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:fs(this._vector,v),pinchAround:h}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const h=25/(Math.PI*this._minDiameter)*360,v=fs(n,this._startVector);return Math.abs(v)<h}}function dr(b){return Math.abs(b.y)>Math.abs(b.x)}class ms extends Mo{reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(n){this._lastPoints=n,dr(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,h,v){const w=n[0].sub(this._lastPoints[0]),I=n[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(w,I,v.timeStamp),this._valid)return this._lastPoints=n,this._active=!0,{pitchDelta:(w.y+I.y)/2*-.5}}gestureBeginsVertically(n,h,v){if(this._valid!==void 0)return this._valid;const w=n.mag()>=2,I=h.mag()>=2;if(!w&&!I)return;if(!w||!I)return this._firstMove===void 0&&(this._firstMove=v),v-this._firstMove<100&&void 0;const L=n.y>0==h.y>0;return dr(n)&&dr(h)&&L}}const Zl={panStep:100,bearingStep:15,pitchStep:10};class zr{constructor(){const n=Zl;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let h=0,v=0,w=0,I=0,L=0;switch(n.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:n.shiftKey?v=-1:(n.preventDefault(),I=-1);break;case 39:n.shiftKey?v=1:(n.preventDefault(),I=1);break;case 38:n.shiftKey?w=1:(n.preventDefault(),L=-1);break;case 40:n.shiftKey?w=-1:(n.preventDefault(),L=1);break;default:return}return this._rotationDisabled&&(v=0,w=0),{cameraAnimation:O=>{const N=O.getZoom();O.easeTo({duration:300,easeId:"keyboardHandler",easing:Ut,zoom:h?Math.round(N)+h*(n.shiftKey?2:1):N,bearing:O.getBearing()+v*this._bearingStep,pitch:O.getPitch()+w*this._pitchStep,offset:[-I*this._panStep,-L*this._panStep],center:O.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ut(b){return b*(2-b)}const gn=4.000244140625;class ys{constructor(n,h){this._map=n,this._el=n.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,x.bindAll(["_onTimeout"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=n&&n.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(n){if(!this.isEnabled())return;let h=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const v=x.exported.now(),w=v-(this._lastWheelEventTime||0);this._lastWheelEventTime=v,h!==0&&h%gn==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":w>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(w*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),n.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=n,this._delta-=h,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=Se.mousePos(this._el,n);this._around=x.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(h)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;if(this._delta!==0){const O=this._type==="wheel"&&Math.abs(this._delta)>gn?this._wheelZoomRate:this._defaultZoomRate;let N=2/(1+Math.exp(-Math.abs(this._delta*O)));this._delta<0&&N!==0&&(N=1/N);const $=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):n.scale;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom($*N))),this._type==="wheel"&&(this._startZoom=n.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:n.zoom,v=this._startZoom,w=this._easing;let I,L=!1;if(this._type==="wheel"&&v&&w){const O=Math.min((x.exported.now()-this._lastWheelEventTime)/200,1),N=w(O);I=x.number(v,h,N),O<1?this._frameId||(this._frameId=!0):L=!0}else I=h,L=!0;return this._active=!0,L&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!L,zoomDelta:I-n.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let h=x.ease;if(this._prevEase){const v=this._prevEase,w=(x.exported.now()-v.start)/v.duration,I=v.easing(w+.01)-v.easing(w),L=.27/Math.sqrt(I*I+1e-4)*.01,O=Math.sqrt(.0729-L*L);h=x.bezier(L,O,.25,1)}return this._prevEase={start:x.exported.now(),duration:n,easing:h},h}reset(){this._active=!1}}class ka{constructor(n,h){this._clickZoom=n,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class yo{constructor(){this.reset()}reset(){this._active=!1}dblclick(n,h){return n.preventDefault(),{cameraAnimation:v=>{v.easeTo({duration:300,zoom:v.getZoom()+(n.shiftKey?-1:1),around:v.unproject(h)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cr{constructor(){this._tap=new ds({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(n,h,v){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?v.length>0&&(this._swipePoint=h[0],this._swipeTouch=v[0].identifier):this._tap.touchstart(n,h,v))}touchmove(n,h,v){if(this._tapTime){if(this._swipePoint){if(v[0].identifier!==this._swipeTouch)return;const w=h[0],I=w.y-this._swipePoint.y;return this._swipePoint=w,n.preventDefault(),this._active=!0,{zoomDelta:I/128}}}else this._tap.touchmove(n,h,v)}touchend(n,h,v){this._tapTime?this._swipePoint&&v.length===0&&this.reset():this._tap.touchend(n,h,v)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ko{constructor(n,h,v){this._el=n,this._mousePan=h,this._touchPan=v}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class St{constructor(n,h,v){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=h,this._mousePitch=v}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ns{constructor(n,h,v,w){this._el=n,this._touchZoom=h,this._touchRotate=v,this._tapDragZoom=w,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const fa=b=>b.zoom||b.drag||b.pitch||b.rotate;class js extends x.Event{}function Rn(b){return b.panDelta&&b.panDelta.mag()||b.zoomDelta||b.bearingDelta||b.pitchDelta}class fr{constructor(n,h){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ml(n),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h),x.bindAll(["handleEvent","handleWindowEvent"],this);const v=this._el;this._listeners=[[v,"touchstart",{passive:!0}],[v,"touchmove",{passive:!1}],[v,"touchend",void 0],[v,"touchcancel",void 0],[v,"mousedown",void 0],[v,"mousemove",void 0],[v,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[v,"mouseover",void 0],[v,"mouseout",void 0],[v,"dblclick",void 0],[v,"click",void 0],[v,"keydown",{capture:!1}],[v,"keyup",void 0],[v,"wheel",{passive:!1}],[v,"contextmenu",void 0],[window,"blur",void 0]];for(const[w,I,L]of this._listeners)Se.addEventListener(w,I,w===document?this.handleWindowEvent:this.handleEvent,L)}destroy(){for(const[n,h,v]of this._listeners)Se.removeEventListener(n,h,n===document?this.handleWindowEvent:this.handleEvent,v)}_addDefaultHandlers(n){const h=this._map,v=h.getCanvasContainer();this._add("mapEvent",new ha(h,n));const w=h.boxZoom=new Xa(h,n);this._add("boxZoom",w);const I=new Wa,L=new yo;h.doubleClickZoom=new ka(L,I),this._add("tapZoom",I),this._add("clickZoom",L);const O=new cr;this._add("tapDragZoom",O);const N=h.touchPitch=new ms;this._add("touchPitch",N);const $=new kt(n),H=new Ha(n);h.dragRotate=new St(n,$,H),this._add("mouseRotate",$,["mousePitch"]),this._add("mousePitch",H,["mouseRotate"]);const re=new ji(n),fe=new Ho(n);h.dragPan=new Ko(v,re,fe),this._add("mousePan",re),this._add("touchPan",fe,["touchZoom","touchRotate"]);const Pe=new da,ye=new Ka;h.touchZoomRotate=new Ns(v,ye,Pe,O),this._add("touchRotate",Pe,["touchPan","touchZoom"]),this._add("touchZoom",ye,["touchPan","touchRotate"]);const ze=h.scrollZoom=new ys(h,this);this._add("scrollZoom",ze,["mousePan"]);const Ve=h.keyboard=new zr;this._add("keyboard",Ve),this._add("blockableMapEvent",new ps(h));for(const Fe of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[Fe]&&h[Fe].enable(n[Fe])}_add(n,h,v){this._handlers.push({handlerName:n,handler:h,allowed:v}),this._handlersById[n]=h}stop(n){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(fa(this._eventsInProgress))||this.isZooming()}_blockedByActive(n,h,v){for(const w in n)if(w!==v&&(!h||h.indexOf(w)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const h=[];for(const v of n)this._el.contains(v.target)&&h.push(v);return h}handleEvent(n,h){if(n.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const v=n.type==="renderFrame"?void 0:n,w={needsRenderFrame:!1},I={},L={},O=n.touches,N=O?this._getMapTouches(O):void 0,$=N?Se.touchPos(this._el,N):Se.mousePos(this._el,n);for(const{handlerName:fe,handler:Pe,allowed:ye}of this._handlers){if(!Pe.isEnabled())continue;let ze;this._blockedByActive(L,ye,fe)?Pe.reset():Pe[h||n.type]&&(ze=Pe[h||n.type](n,$,N),this.mergeHandlerResult(w,I,ze,fe,v),ze&&ze.needsRenderFrame&&this._triggerRenderFrame()),(ze||Pe.isActive())&&(L[fe]=Pe)}const H={};for(const fe in this._previousActiveHandlers)L[fe]||(H[fe]=v);this._previousActiveHandlers=L,(Object.keys(H).length||Rn(w))&&(this._changes.push([w,I,H]),this._triggerRenderFrame()),(Object.keys(L).length||Rn(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:re}=w;re&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],re(this._map))}mergeHandlerResult(n,h,v,w,I){if(!v)return;x.extend(n,v);const L={handlerName:w,originalEvent:v.originalEvent||I};v.zoomDelta!==void 0&&(h.zoom=L),v.panDelta!==void 0&&(h.drag=L),v.pitchDelta!==void 0&&(h.pitch=L),v.bearingDelta!==void 0&&(h.rotate=L)}_applyChanges(){const n={},h={},v={};for(const[w,I,L]of this._changes)w.panDelta&&(n.panDelta=(n.panDelta||new x.pointGeometry(0,0))._add(w.panDelta)),w.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+w.zoomDelta),w.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+w.bearingDelta),w.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+w.pitchDelta),w.around!==void 0&&(n.around=w.around),w.pinchAround!==void 0&&(n.pinchAround=w.pinchAround),w.noInertia&&(n.noInertia=w.noInertia),x.extend(h,I),x.extend(v,L);this._updateMapTransform(n,h,v),this._changes=[]}_updateMapTransform(n,h,v){const w=this._map,I=w.transform;if(!Rn(n))return this._fireEvents(h,v,!0);let{panDelta:L,zoomDelta:O,bearingDelta:N,pitchDelta:$,around:H,pinchAround:re}=n;re!==void 0&&(H=re),w._stop(!0),H=H||w.transform.centerPoint;const fe=I.pointLocation(L?H.sub(L):H);N&&(I.bearing+=N),$&&(I.pitch+=$),O&&(I.zoom+=O),I.setLocationAtPoint(fe,H),this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(h,v,!0)}_fireEvents(n,h,v){const w=fa(this._eventsInProgress),I=fa(n),L={};for(const H in n){const{originalEvent:re}=n[H];this._eventsInProgress[H]||(L[`${H}start`]=re),this._eventsInProgress[H]=n[H]}!w&&I&&this._fireEvent("movestart",I.originalEvent);for(const H in L)this._fireEvent(H,L[H]);I&&this._fireEvent("move",I.originalEvent);for(const H in n){const{originalEvent:re}=n[H];this._fireEvent(H,re)}const O={};let N;for(const H in this._eventsInProgress){const{handlerName:re,originalEvent:fe}=this._eventsInProgress[H];this._handlersById[re].isActive()||(delete this._eventsInProgress[H],N=h[re]||fe,O[`${H}end`]=N)}for(const H in O)this._fireEvent(H,O[H]);const $=fa(this._eventsInProgress);if(v&&(w||I)&&!$){this._updatingCamera=!0;const H=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),re=fe=>fe!==0&&-this._bearingSnap<fe&&fe<this._bearingSnap;H?(re(H.bearing||this._map.getBearing())&&(H.bearing=0),this._map.easeTo(H,{originalEvent:N})):(this._map.fire(new x.Event("moveend",{originalEvent:N})),re(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,h){this._map.fire(new x.Event(n,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{delete this._frameId,this.handleEvent(new js("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const or={extend:(b,...n)=>x.extend(b,...n),run(b){b()},logToElement(b,n=!1,h="log"){const v=window.document.getElementById(h);v&&(n&&(v.innerHTML=""),v.innerHTML+=`<br>${b}`)}};class Ja extends x.Evented{constructor(n,h){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=h.bearingSnap,x.bindAll(["_renderFrameCallback"],this)}getCenter(){return new x.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,h){return this.jumpTo({center:n},h)}panBy(n,h,v){return n=x.pointGeometry.convert(n).mult(-1),this.panTo(this.transform.center,x.extend({offset:n},h),v)}panTo(n,h,v){return this.easeTo(x.extend({center:n},h),v)}getZoom(){return this.transform.zoom}setZoom(n,h){return this.jumpTo({zoom:n},h),this}zoomTo(n,h,v){return this.easeTo(x.extend({zoom:n},h),v)}zoomIn(n,h){return this.zoomTo(this.getZoom()+1,n,h),this}zoomOut(n,h){return this.zoomTo(this.getZoom()-1,n,h),this}getBearing(){return this.transform.bearing}setBearing(n,h){return this.jumpTo({bearing:n},h),this}getPadding(){return this.transform.padding}setPadding(n,h){return this.jumpTo({padding:n},h),this}rotateTo(n,h,v){return this.easeTo(x.extend({bearing:n},h),v)}resetNorth(n,h){return this.rotateTo(0,x.extend({duration:1e3},n),h),this}resetNorthPitch(n,h){return this.easeTo(x.extend({bearing:0,pitch:0,duration:1e3},n),h),this}snapToNorth(n,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,h):this}getPitch(){return this.transform.pitch}setPitch(n,h){return this.jumpTo({pitch:n},h),this}cameraForBounds(n,h){n=x.LngLatBounds.convert(n);const v=h&&h.bearing||0;return this._cameraForBoxAndBearing(n.getNorthWest(),n.getSouthEast(),v,h)}_cameraForBoxAndBearing(n,h,v,w){const I={top:0,bottom:0,right:0,left:0};if(typeof(w=x.extend({padding:I,offset:[0,0],maxZoom:this.transform.maxZoom},w)).padding=="number"){const et=w.padding;w.padding={top:et,bottom:et,right:et,left:et}}w.padding=x.extend(I,w.padding);const L=this.transform,O=L.padding,N=L.project(x.LngLat.convert(n)),$=L.project(x.LngLat.convert(h)),H=N.rotate(-v*Math.PI/180),re=$.rotate(-v*Math.PI/180),fe=new x.pointGeometry(Math.max(H.x,re.x),Math.max(H.y,re.y)),Pe=new x.pointGeometry(Math.min(H.x,re.x),Math.min(H.y,re.y)),ye=fe.sub(Pe),ze=(L.width-(O.left+O.right+w.padding.left+w.padding.right))/ye.x,Ve=(L.height-(O.top+O.bottom+w.padding.top+w.padding.bottom))/ye.y;if(Ve<0||ze<0)return void x.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Fe=Math.min(L.scaleZoom(L.scale*Math.min(ze,Ve)),w.maxZoom),Xe=x.pointGeometry.convert(w.offset),je=new x.pointGeometry((w.padding.left-w.padding.right)/2,(w.padding.top-w.padding.bottom)/2).rotate(v*Math.PI/180),st=Xe.add(je).mult(L.scale/L.zoomScale(Fe));return{center:L.unproject(N.add($).div(2).sub(st)),zoom:Fe,bearing:v}}fitBounds(n,h,v){return this._fitInternal(this.cameraForBounds(n,h),h,v)}fitScreenCoordinates(n,h,v,w,I){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(x.pointGeometry.convert(n)),this.transform.pointLocation(x.pointGeometry.convert(h)),v,w),w,I)}_fitInternal(n,h,v){return n?(delete(h=x.extend(n,h)).padding,h.linear?this.easeTo(h,v):this.flyTo(h,v)):this}jumpTo(n,h){this.stop();const v=this.transform;let w=!1,I=!1,L=!1;return"zoom"in n&&v.zoom!==+n.zoom&&(w=!0,v.zoom=+n.zoom),n.center!==void 0&&(v.center=x.LngLat.convert(n.center)),"bearing"in n&&v.bearing!==+n.bearing&&(I=!0,v.bearing=+n.bearing),"pitch"in n&&v.pitch!==+n.pitch&&(L=!0,v.pitch=+n.pitch),n.padding==null||v.isPaddingEqual(n.padding)||(v.padding=n.padding),this.fire(new x.Event("movestart",h)).fire(new x.Event("move",h)),w&&this.fire(new x.Event("zoomstart",h)).fire(new x.Event("zoom",h)).fire(new x.Event("zoomend",h)),I&&this.fire(new x.Event("rotatestart",h)).fire(new x.Event("rotate",h)).fire(new x.Event("rotateend",h)),L&&this.fire(new x.Event("pitchstart",h)).fire(new x.Event("pitch",h)).fire(new x.Event("pitchend",h)),this.fire(new x.Event("moveend",h))}easeTo(n,h){this._stop(!1,n.easeId),((n=x.extend({offset:[0,0],duration:500,easing:x.ease},n)).animate===!1||!n.essential&&x.exported.prefersReducedMotion)&&(n.duration=0);const v=this.transform,w=this.getZoom(),I=this.getBearing(),L=this.getPitch(),O=this.getPadding(),N="zoom"in n?+n.zoom:w,$="bearing"in n?this._normalizeBearing(n.bearing,I):I,H="pitch"in n?+n.pitch:L,re="padding"in n?n.padding:v.padding,fe=x.pointGeometry.convert(n.offset);let Pe=v.centerPoint.add(fe);const ye=v.pointLocation(Pe),ze=x.LngLat.convert(n.center||ye);this._normalizeCenter(ze);const Ve=v.project(ye),Fe=v.project(ze).sub(Ve),Xe=v.zoomScale(N-w);let je,st;n.around&&(je=x.LngLat.convert(n.around),st=v.locationPoint(je));const et={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||N!==w,this._rotating=this._rotating||I!==$,this._pitching=this._pitching||H!==L,this._padding=!v.isPaddingEqual(re),this._easeId=n.easeId,this._prepareEase(h,n.noMoveStart,et),this._ease(rt=>{if(this._zooming&&(v.zoom=x.number(w,N,rt)),this._rotating&&(v.bearing=x.number(I,$,rt)),this._pitching&&(v.pitch=x.number(L,H,rt)),this._padding&&(v.interpolatePadding(O,re,rt),Pe=v.centerPoint.add(fe)),je)v.setLocationAtPoint(je,st);else{const mt=v.zoomScale(v.zoom-w),xt=N>w?Math.min(2,Xe):Math.max(.5,Xe),lt=Math.pow(xt,1-rt),qt=v.unproject(Ve.add(Fe.mult(rt*lt)).mult(mt));v.setLocationAtPoint(v.renderWorldCopies?qt.wrap():qt,Pe)}this._fireMoveEvents(h)},rt=>{this._afterEase(h,rt)},n),this}_prepareEase(n,h,v={}){this._moving=!0,h||v.moving||this.fire(new x.Event("movestart",n)),this._zooming&&!v.zooming&&this.fire(new x.Event("zoomstart",n)),this._rotating&&!v.rotating&&this.fire(new x.Event("rotatestart",n)),this._pitching&&!v.pitching&&this.fire(new x.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new x.Event("move",n)),this._zooming&&this.fire(new x.Event("zoom",n)),this._rotating&&this.fire(new x.Event("rotate",n)),this._pitching&&this.fire(new x.Event("pitch",n))}_afterEase(n,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const v=this._zooming,w=this._rotating,I=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,v&&this.fire(new x.Event("zoomend",n)),w&&this.fire(new x.Event("rotateend",n)),I&&this.fire(new x.Event("pitchend",n)),this.fire(new x.Event("moveend",n))}flyTo(n,h){if(!n.essential&&x.exported.prefersReducedMotion){const u=x.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(u,h)}this.stop(),n=x.extend({offset:[0,0],speed:1.2,curve:1.42,easing:x.ease},n);const v=this.transform,w=this.getZoom(),I=this.getBearing(),L=this.getPitch(),O=this.getPadding(),N="zoom"in n?x.clamp(+n.zoom,v.minZoom,v.maxZoom):w,$="bearing"in n?this._normalizeBearing(n.bearing,I):I,H="pitch"in n?+n.pitch:L,re="padding"in n?n.padding:v.padding,fe=v.zoomScale(N-w),Pe=x.pointGeometry.convert(n.offset);let ye=v.centerPoint.add(Pe);const ze=v.pointLocation(ye),Ve=x.LngLat.convert(n.center||ze);this._normalizeCenter(Ve);const Fe=v.project(ze),Xe=v.project(Ve).sub(Fe);let je=n.curve;const st=Math.max(v.width,v.height),et=st/fe,rt=Xe.mag();if("minZoom"in n){const u=x.clamp(Math.min(n.minZoom,w,N),v.minZoom,v.maxZoom),f=st/v.zoomScale(u-w);je=Math.sqrt(f/rt*2)}const mt=je*je;function xt(u){const f=(et*et-st*st+(u?-1:1)*mt*mt*rt*rt)/(2*(u?et:st)*mt*rt);return Math.log(Math.sqrt(f*f+1)-f)}function lt(u){return(Math.exp(u)-Math.exp(-u))/2}function qt(u){return(Math.exp(u)+Math.exp(-u))/2}const Rt=xt(0);let li=function(u){return qt(Rt)/qt(Rt+je*u)},s=function(u){return st*((qt(Rt)*(lt(f=Rt+je*u)/qt(f))-lt(Rt))/mt)/rt;var f},c=(xt(1)-Rt)/je;if(Math.abs(rt)<1e-6||!isFinite(c)){if(Math.abs(st-et)<1e-6)return this.easeTo(n,h);const u=et<st?-1:1;c=Math.abs(Math.log(et/st))/je,s=function(){return 0},li=function(f){return Math.exp(u*je*f)}}return n.duration="duration"in n?+n.duration:1e3*c/("screenSpeed"in n?+n.screenSpeed/je:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0),this._zooming=!0,this._rotating=I!==$,this._pitching=H!==L,this._padding=!v.isPaddingEqual(re),this._prepareEase(h,!1),this._ease(u=>{const f=u*c,S=1/li(f);v.zoom=u===1?N:w+v.scaleZoom(S),this._rotating&&(v.bearing=x.number(I,$,u)),this._pitching&&(v.pitch=x.number(L,H,u)),this._padding&&(v.interpolatePadding(O,re,u),ye=v.centerPoint.add(Pe));const A=u===1?Ve:v.unproject(Fe.add(Xe.mult(s(f))).mult(S));v.setLocationAtPoint(v.renderWorldCopies?A.wrap():A,ye),this._fireMoveEvents(h)},()=>this._afterEase(h),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const v=this._onEaseEnd;delete this._onEaseEnd,v.call(this,h)}if(!n){const v=this.handlers;v&&v.stop(!1)}return this}_ease(n,h,v){v.animate===!1||v.duration===0?(n(1),h()):(this._easeStart=x.exported.now(),this._easeOptions=v,this._onEaseFrame=n,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((x.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,h){n=x.wrap(n,-180,180);const v=Math.abs(n-h);return Math.abs(n-360-h)<v&&(n-=360),Math.abs(n+360-h)<v&&(n+=360),n}_normalizeCenter(n){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const v=n.lng-h.center.lng;n.lng+=v>180?-360:v<-180?360:0}}class _n{constructor(n={}){this.options=n,x.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){return this._map=n,this._compact=this.options&&this.options.compact,this._container=Se.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Se.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Se.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Se.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(n,h){const v=this._map._getUIString(`AttributionControl.${h}`);n.title=v,n.setAttribute("aria-label",v)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let n=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=n.concat(this.options.customAttribution.map(w=>typeof w!="string"?"":w)):typeof this.options.customAttribution=="string"&&n.push(this.options.customAttribution)),this._map.style.stylesheet){const w=this._map.style.stylesheet;this.styleOwner=w.owner,this.styleId=w.id}const h=this._map.style.sourceCaches;for(const w in h){const I=h[w];if(I.used){const L=I.getSource();L.attribution&&n.indexOf(L.attribution)<0&&n.push(L.attribution)}}n=n.filter(w=>String(w).trim()),n.sort((w,I)=>w.length-I.length),n=n.filter((w,I)=>{for(let L=I+1;L<n.length;L++)if(n[L].indexOf(w)>=0)return!1;return!0});const v=n.join(" | ");v!==this._attribHTML&&(this._attribHTML=v,n.length?(this._innerContainer.innerHTML=v,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class Lo{constructor(n={}){this.options=n,x.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(n){this._map=n,this._compact=this.options&&this.options.compact,this._container=Se.create("div","maplibregl-ctrl mapboxgl-ctrl");const h=Se.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Se.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const n=this._container.children;if(n.length){const h=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&h.classList.add("maplibregl-compact","mapboxgl-compact"):h.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class $l{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const h=++this._id;return this._queue.push({callback:n,id:h,cancelled:!1}),h}remove(n){const h=this._currentlyRunning,v=h?this._queue.concat(h):this._queue;for(const w of v)if(w.id===n)return void(w.cancelled=!0)}run(n=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const v of h)if(!v.cancelled&&(v.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const gs={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Xl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},Eo={showCompass:!0,showZoom:!0,visualizePitch:!1};class Wn{constructor(n,h,v=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new kt({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,v&&(this.mousePitch=new Ha({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),x.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),Se.addEventListener(h,"mousedown",this.mousedown),Se.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),Se.addEventListener(h,"touchmove",this.touchmove),Se.addEventListener(h,"touchend",this.touchend),Se.addEventListener(h,"touchcancel",this.reset)}down(n,h){this.mouseRotate.mousedown(n,h),this.mousePitch&&this.mousePitch.mousedown(n,h),Se.disableDrag()}move(n,h){const v=this.map,w=this.mouseRotate.mousemoveWindow(n,h);if(w&&w.bearingDelta&&v.setBearing(v.getBearing()+w.bearingDelta),this.mousePitch){const I=this.mousePitch.mousemoveWindow(n,h);I&&I.pitchDelta&&v.setPitch(v.getPitch()+I.pitchDelta)}}off(){const n=this.element;Se.removeEventListener(n,"mousedown",this.mousedown),Se.removeEventListener(n,"touchstart",this.touchstart,{passive:!1}),Se.removeEventListener(n,"touchmove",this.touchmove),Se.removeEventListener(n,"touchend",this.touchend),Se.removeEventListener(n,"touchcancel",this.reset),this.offTemp()}offTemp(){Se.enableDrag(),Se.removeEventListener(window,"mousemove",this.mousemove),Se.removeEventListener(window,"mouseup",this.mouseup)}mousedown(n){this.down(x.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),Se.mousePos(this.element,n)),Se.addEventListener(window,"mousemove",this.mousemove),Se.addEventListener(window,"mouseup",this.mouseup)}mousemove(n){this.move(n,Se.mousePos(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Se.touchPos(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=Se.touchPos(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Vt(b,n,h){if(b=new x.LngLat(b.lng,b.lat),n){const v=new x.LngLat(b.lng-360,b.lat),w=new x.LngLat(b.lng+360,b.lat),I=h.locationPoint(b).distSqr(n);h.locationPoint(v).distSqr(n)<I?b=v:h.locationPoint(w).distSqr(n)<I&&(b=w)}for(;Math.abs(b.lng-h.center.lng)>180;){const v=h.locationPoint(b);if(v.x>=0&&v.y>=0&&v.x<=h.width&&v.y<=h.height)break;b.lng>h.center.lng?b.lng-=360:b.lng+=360}return b}const wt={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Hn(b,n,h){const v=b.classList;for(const w in wt)v.remove(`maplibregl-${h}-anchor-${w}`,`mapboxgl-${h}-anchor-${w}`);v.add(`maplibregl-${h}-anchor-${n}`,`mapboxgl-${h}-anchor-${n}`)}class An extends x.Evented{constructor(n,h){if(super(),(n instanceof HTMLElement||h)&&(n=x.extend({element:n},h)),x.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment!=="auto"?n.pitchAlignment:this._rotationAlignment,n&&n.element)this._element=n.element,this._offset=x.pointGeometry.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=Se.create("div"),this._element.setAttribute("aria-label","Map marker");const v=Se.createNS("http://www.w3.org/2000/svg","svg"),w=41,I=27;v.setAttributeNS(null,"display","block"),v.setAttributeNS(null,"height",`${w}px`),v.setAttributeNS(null,"width",`${I}px`),v.setAttributeNS(null,"viewBox",`0 0 ${I} ${w}`);const L=Se.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"stroke","none"),L.setAttributeNS(null,"stroke-width","1"),L.setAttributeNS(null,"fill","none"),L.setAttributeNS(null,"fill-rule","evenodd");const O=Se.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"fill-rule","nonzero");const N=Se.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"transform","translate(3.0, 29.0)"),N.setAttributeNS(null,"fill","#000000");const $=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Xe of $){const je=Se.createNS("http://www.w3.org/2000/svg","ellipse");je.setAttributeNS(null,"opacity","0.04"),je.setAttributeNS(null,"cx","10.5"),je.setAttributeNS(null,"cy","5.80029008"),je.setAttributeNS(null,"rx",Xe.rx),je.setAttributeNS(null,"ry",Xe.ry),N.appendChild(je)}const H=Se.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"fill",this._color);const re=Se.createNS("http://www.w3.org/2000/svg","path");re.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),H.appendChild(re);const fe=Se.createNS("http://www.w3.org/2000/svg","g");fe.setAttributeNS(null,"opacity","0.25"),fe.setAttributeNS(null,"fill","#000000");const Pe=Se.createNS("http://www.w3.org/2000/svg","path");Pe.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),fe.appendChild(Pe);const ye=Se.createNS("http://www.w3.org/2000/svg","g");ye.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ye.setAttributeNS(null,"fill","#FFFFFF");const ze=Se.createNS("http://www.w3.org/2000/svg","g");ze.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Ve=Se.createNS("http://www.w3.org/2000/svg","circle");Ve.setAttributeNS(null,"fill","#000000"),Ve.setAttributeNS(null,"opacity","0.25"),Ve.setAttributeNS(null,"cx","5.5"),Ve.setAttributeNS(null,"cy","5.5"),Ve.setAttributeNS(null,"r","5.4999962");const Fe=Se.createNS("http://www.w3.org/2000/svg","circle");Fe.setAttributeNS(null,"fill","#FFFFFF"),Fe.setAttributeNS(null,"cx","5.5"),Fe.setAttributeNS(null,"cy","5.5"),Fe.setAttributeNS(null,"r","5.4999962"),ze.appendChild(Ve),ze.appendChild(Fe),O.appendChild(N),O.appendChild(H),O.appendChild(fe),O.appendChild(ye),O.appendChild(ze),v.appendChild(O),v.setAttributeNS(null,"height",w*this._scale+"px"),v.setAttributeNS(null,"width",I*this._scale+"px"),this._element.appendChild(v),this._offset=x.pointGeometry.convert(n&&n.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()}),Hn(this._element,this._anchor,"marker"),this._popup=null}addTo(n){return this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._update),n.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Se.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=x.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const w=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[w,-1*(38.1-13.5+w)],"bottom-right":[-w,-1*(38.1-13.5+w)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(n){const h=n.code,v=n.charCode||n.keyCode;h!=="Space"&&h!=="Enter"&&v!==32&&v!==13||this.togglePopup()}_onMapClick(n){const h=n.originalEvent.target,v=this._element;this._popup&&(h===v||v.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?n.remove():n.addTo(this._map),this):this}_update(n){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Vt(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let v="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?v="rotateX(0deg)":this._pitchAlignment==="map"&&(v=`rotateX(${this._map.getPitch()}deg)`),n&&n.type!=="moveend"||(this._pos=this._pos.round()),Se.setTransform(this._element,`${wt[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${v} ${h}`)}getOffset(){return this._offset}setOffset(n){return this._offset=x.pointGeometry.convert(n),this._update(),this}_onMove(n){if(!this._isDragging){const h=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new x.Event("dragstart"))),this.fire(new x.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new x.Event("dragend")),this._state="inactive"}_addDragHandler(n){this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(n){return this._draggable=!!n,this._map&&(n?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n&&n!=="auto"?n:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Nr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let mr,Kn=0,vr=!1;const Cn={maxWidth:100,unit:"metric"};function ma(b,n,h){const v=h&&h.maxWidth||100,w=b._container.clientHeight/2,I=b.unproject([0,w]),L=b.unproject([v,w]),O=I.distanceTo(L);if(h&&h.unit==="imperial"){const N=3.2808*O;N>5280?At(n,v,N/5280,b._getUIString("ScaleControl.Miles")):At(n,v,N,b._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?At(n,v,O/1852,b._getUIString("ScaleControl.NauticalMiles")):O>=1e3?At(n,v,O/1e3,b._getUIString("ScaleControl.Kilometers")):At(n,v,O,b._getUIString("ScaleControl.Meters"))}function At(b,n,h,v){const w=function(I){const L=Math.pow(10,`${Math.floor(I)}`.length-1);let O=I/L;return O=O>=10?10:O>=5?5:O>=3?3:O>=2?2:O>=1?1:function(N){const $=Math.pow(10,Math.ceil(-Math.log(N)/Math.LN10));return Math.round(N*$)/$}(O),L*O}(h);b.style.width=n*(w/h)+"px",b.innerHTML=`${w}&nbsp;${v}`}const Tt={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},qs=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Or(b){if(b){if(typeof b=="number"){const n=Math.round(Math.sqrt(.5*Math.pow(b,2)));return{center:new x.pointGeometry(0,0),top:new x.pointGeometry(0,b),"top-left":new x.pointGeometry(n,n),"top-right":new x.pointGeometry(-n,n),bottom:new x.pointGeometry(0,-b),"bottom-left":new x.pointGeometry(n,-n),"bottom-right":new x.pointGeometry(-n,-n),left:new x.pointGeometry(b,0),right:new x.pointGeometry(-b,0)}}if(b instanceof x.pointGeometry||Array.isArray(b)){const n=x.pointGeometry.convert(b);return{center:n,top:n,"top-left":n,"top-right":n,bottom:n,"bottom-left":n,"bottom-right":n,left:n,right:n}}return{center:x.pointGeometry.convert(b.center||[0,0]),top:x.pointGeometry.convert(b.top||[0,0]),"top-left":x.pointGeometry.convert(b["top-left"]||[0,0]),"top-right":x.pointGeometry.convert(b["top-right"]||[0,0]),bottom:x.pointGeometry.convert(b.bottom||[0,0]),"bottom-left":x.pointGeometry.convert(b["bottom-left"]||[0,0]),"bottom-right":x.pointGeometry.convert(b["bottom-right"]||[0,0]),left:x.pointGeometry.convert(b.left||[0,0]),right:x.pointGeometry.convert(b.right||[0,0])}}return Or(new x.pointGeometry(0,0))}const Bn={supported:he,setRTLTextPlugin:x.setRTLTextPlugin,getRTLTextPluginStatus:x.getRTLTextPluginStatus,Map:class extends Ja{constructor(b){var n;if(x.PerformanceUtils.mark(x.PerformanceMarkers.create),(b=x.extend({},Xl,b)).minZoom!=null&&b.maxZoom!=null&&b.minZoom>b.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(b.minPitch!=null&&b.maxPitch!=null&&b.minPitch>b.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(b.minPitch!=null&&b.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(b.maxPitch!=null&&b.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ko(b.minZoom,b.maxZoom,b.minPitch,b.maxPitch,b.renderWorldCopies),{bearingSnap:b.bearingSnap}),this._interactive=b.interactive,this._maxTileCacheSize=b.maxTileCacheSize,this._failIfMajorPerformanceCaveat=b.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=b.preserveDrawingBuffer,this._antialias=b.antialias,this._trackResize=b.trackResize,this._bearingSnap=b.bearingSnap,this._refreshExpiredTiles=b.refreshExpiredTiles,this._fadeDuration=b.fadeDuration,this._crossSourceCollisions=b.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=b.collectResourceTiming,this._renderTaskQueue=new $l,this._controls=[],this._mapId=x.uniqueId(),this._locale=x.extend({},gs,b.locale),this._clickTolerance=b.clickTolerance,this._pixelRatio=(n=b.pixelRatio)!==null&&n!==void 0?n:devicePixelRatio,this._requestManager=new It(b.transformRequest),typeof b.container=="string"){if(this._container=document.getElementById(b.container),!this._container)throw new Error(`Container '${b.container}' not found.`)}else{if(!(b.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=b.container}if(b.maxBounds&&this.setMaxBounds(b.maxBounds),x.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),typeof window!="undefined"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new fr(this,b),this._hash=b.hash&&new us(typeof b.hash=="string"&&b.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:b.center,zoom:b.zoom,bearing:b.bearing,pitch:b.pitch}),b.bounds&&(this.resize(),this.fitBounds(b.bounds,x.extend({},b.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=b.localIdeographFontFamily,b.style&&this.setStyle(b.style,{localIdeographFontFamily:b.localIdeographFontFamily}),b.attributionControl&&this.addControl(new _n({customAttribution:b.customAttribution})),b.maplibreLogo&&this.addControl(new Lo,b.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new x.Event(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new x.Event(`${h.dataType}dataloading`,h))}),this.on("dataabort",h=>{this.fire(new x.Event("sourcedataabort",h))})}_getMapId(){return this._mapId}addControl(b,n){if(n===void 0&&(n=b.getDefaultPosition?b.getDefaultPosition():"top-right"),!b||!b.onAdd)return this.fire(new x.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=b.onAdd(this);this._controls.push(b);const v=this._controlPositions[n];return n.indexOf("bottom")!==-1?v.insertBefore(h,v.firstChild):v.appendChild(h),this}removeControl(b){if(!b||!b.onRemove)return this.fire(new x.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(b);return n>-1&&this._controls.splice(n,1),b.onRemove(this),this}hasControl(b){return this._controls.indexOf(b)>-1}resize(b){const n=this._containerDimensions(),h=n[0],v=n[1];this._resizeCanvas(h,v,this.getPixelRatio()),this.transform.resize(h,v),this.painter.resize(h,v,this.getPixelRatio());const w=!this._moving;return w&&(this.stop(),this.fire(new x.Event("movestart",b)).fire(new x.Event("move",b))),this.fire(new x.Event("resize",b)),w&&this.fire(new x.Event("moveend",b)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(b){const[n,h]=this._containerDimensions();this._pixelRatio=b,this._resizeCanvas(n,h,b),this.painter.resize(n,h,b)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(b){return this.transform.setMaxBounds(x.LngLatBounds.convert(b)),this._update()}setMinZoom(b){if((b=b==null?-2:b)>=-2&&b<=this.transform.maxZoom)return this.transform.minZoom=b,this._update(),this.getZoom()<b&&this.setZoom(b),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(b){if((b=b==null?22:b)>=this.transform.minZoom)return this.transform.maxZoom=b,this._update(),this.getZoom()>b&&this.setZoom(b),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(b){if((b=b==null?0:b)<0)throw new Error("minPitch must be greater than or equal to 0");if(b>=0&&b<=this.transform.maxPitch)return this.transform.minPitch=b,this._update(),this.getPitch()<b&&this.setPitch(b),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(b){if((b=b==null?60:b)>85)throw new Error("maxPitch must be less than or equal to 85");if(b>=this.transform.minPitch)return this.transform.maxPitch=b,this._update(),this.getPitch()>b&&this.setPitch(b),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(b){return this.transform.renderWorldCopies=b,this._update()}project(b){return this.transform.locationPoint(x.LngLat.convert(b))}unproject(b){return this.transform.pointLocation(x.pointGeometry.convert(b))}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(b,n,h){if(b==="mouseenter"||b==="mouseover"){let v=!1;return{layer:n,listener:h,delegates:{mousemove:I=>{const L=this.getLayer(n)?this.queryRenderedFeatures(I.point,{layers:[n]}):[];L.length?v||(v=!0,h.call(this,new Tn(b,this,I.originalEvent,{features:L}))):v=!1},mouseout:()=>{v=!1}}}}if(b==="mouseleave"||b==="mouseout"){let v=!1;return{layer:n,listener:h,delegates:{mousemove:L=>{(this.getLayer(n)?this.queryRenderedFeatures(L.point,{layers:[n]}):[]).length?v=!0:v&&(v=!1,h.call(this,new Tn(b,this,L.originalEvent)))},mouseout:L=>{v&&(v=!1,h.call(this,new Tn(b,this,L.originalEvent)))}}}}{const v=w=>{const I=this.getLayer(n)?this.queryRenderedFeatures(w.point,{layers:[n]}):[];I.length&&(w.features=I,h.call(this,w),delete w.features)};return{layer:n,listener:h,delegates:{[b]:v}}}}on(b,n,h){if(h===void 0)return super.on(b,n);const v=this._createDelegatedListener(b,n,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[b]=this._delegatedListeners[b]||[],this._delegatedListeners[b].push(v);for(const w in v.delegates)this.on(w,v.delegates[w]);return this}once(b,n,h){if(h===void 0)return super.once(b,n);const v=this._createDelegatedListener(b,n,h);for(const w in v.delegates)this.once(w,v.delegates[w]);return this}off(b,n,h){return h===void 0?super.off(b,n):(this._delegatedListeners&&this._delegatedListeners[b]&&(v=>{const w=this._delegatedListeners[b];for(let I=0;I<w.length;I++){const L=w[I];if(L.layer===n&&L.listener===h){for(const O in L.delegates)this.off(O,L.delegates[O]);return w.splice(I,1),this}}})(),this)}queryRenderedFeatures(b,n){if(!this.style)return[];let h;if(n!==void 0||b===void 0||b instanceof x.pointGeometry||Array.isArray(b)||(n=b,b=void 0),n=n||{},(b=b||[[0,0],[this.transform.width,this.transform.height]])instanceof x.pointGeometry||typeof b[0]=="number")h=[x.pointGeometry.convert(b)];else{const v=x.pointGeometry.convert(b[0]),w=x.pointGeometry.convert(b[1]);h=[v,new x.pointGeometry(w.x,v.y),w,new x.pointGeometry(v.x,w.y),v]}return this.style.queryRenderedFeatures(h,n,this.transform)}querySourceFeatures(b,n){return this.style.querySourceFeatures(b,n)}setStyle(b,n){return(n=x.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&b?(this._diffStyle(b,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(b,n))}setTransformRequest(b){return this._requestManager.setTransformRequest(b),this}_getUIString(b){const n=this._locale[b];if(n==null)throw new Error(`Missing UI string '${b}'`);return n}_updateStyle(b,n){return this.style&&(this.style.setEventedParent(null),this.style._remove()),b?(this.style=new Fi(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof b=="string"?this.style.loadURL(b):this.style.loadJSON(b),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Fi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(b,n){if(typeof b=="string"){const h=this._requestManager.transformRequest(b,x.ResourceType.Style);x.getJSON(h,(v,w)=>{v?this.fire(new x.ErrorEvent(v)):w&&this._updateDiff(w,n)})}else typeof b=="object"&&this._updateDiff(b,n)}_updateDiff(b,n){try{this.style.setState(b)&&this._update(!0)}catch(h){x.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(b,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():x.warnOnce("There is no style added to the map.")}addSource(b,n){return this._lazyInitEmptyStyle(),this.style.addSource(b,n),this._update(!0)}isSourceLoaded(b){const n=this.style&&this.style.sourceCaches[b];if(n!==void 0)return n.loaded();this.fire(new x.ErrorEvent(new Error(`There is no source with ID '${b}'`)))}areTilesLoaded(){const b=this.style&&this.style.sourceCaches;for(const n in b){const h=b[n]._tiles;for(const v in h){const w=h[v];if(w.state!=="loaded"&&w.state!=="errored")return!1}}return!0}addSourceType(b,n,h){return this._lazyInitEmptyStyle(),this.style.addSourceType(b,n,h)}removeSource(b){return this.style.removeSource(b),this._update(!0)}getSource(b){return this.style.getSource(b)}addImage(b,n,{pixelRatio:h=1,sdf:v=!1,stretchX:w,stretchY:I,content:L}={}){if(this._lazyInitEmptyStyle(),n instanceof HTMLImageElement||x.isImageBitmap(n)){const{width:O,height:N,data:$}=x.exported.getImageData(n);this.style.addImage(b,{data:new x.RGBAImage({width:O,height:N},$),pixelRatio:h,stretchX:w,stretchY:I,content:L,sdf:v,version:0})}else{if(n.width===void 0||n.height===void 0)return this.fire(new x.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:O,height:N,data:$}=n,H=n;this.style.addImage(b,{data:new x.RGBAImage({width:O,height:N},new Uint8Array($)),pixelRatio:h,stretchX:w,stretchY:I,content:L,sdf:v,version:0,userImage:H}),H.onAdd&&H.onAdd(this,b)}}}updateImage(b,n){const h=this.style.getImage(b);if(!h)return this.fire(new x.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=n instanceof HTMLImageElement||x.isImageBitmap(n)?x.exported.getImageData(n):n,{width:w,height:I,data:L}=v;if(w===void 0||I===void 0)return this.fire(new x.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(w!==h.data.width||I!==h.data.height)return this.fire(new x.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const O=!(n instanceof HTMLImageElement||x.isImageBitmap(n));h.data.replace(L,O),this.style.updateImage(b,h)}hasImage(b){return b?!!this.style.getImage(b):(this.fire(new x.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(b){this.style.removeImage(b)}loadImage(b,n){x.getImage(this._requestManager.transformRequest(b,x.ResourceType.Image),n)}listImages(){return this.style.listImages()}addLayer(b,n){return this._lazyInitEmptyStyle(),this.style.addLayer(b,n),this._update(!0)}moveLayer(b,n){return this.style.moveLayer(b,n),this._update(!0)}removeLayer(b){return this.style.removeLayer(b),this._update(!0)}getLayer(b){return this.style.getLayer(b)}setLayerZoomRange(b,n,h){return this.style.setLayerZoomRange(b,n,h),this._update(!0)}setFilter(b,n,h={}){return this.style.setFilter(b,n,h),this._update(!0)}getFilter(b){return this.style.getFilter(b)}setPaintProperty(b,n,h,v={}){return this.style.setPaintProperty(b,n,h,v),this._update(!0)}getPaintProperty(b,n){return this.style.getPaintProperty(b,n)}setLayoutProperty(b,n,h,v={}){return this.style.setLayoutProperty(b,n,h,v),this._update(!0)}getLayoutProperty(b,n){return this.style.getLayoutProperty(b,n)}setLight(b,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(b,n),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(b,n){return this.style.setFeatureState(b,n),this._update()}removeFeatureState(b,n){return this.style.removeFeatureState(b,n),this._update()}getFeatureState(b){return this.style.getFeatureState(b)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let b=0,n=0;return this._container&&(b=this._container.clientWidth||400,n=this._container.clientHeight||300),[b,n]}_setupContainer(){const b=this._container;b.classList.add("maplibregl-map","mapboxgl-map");const n=this._canvasContainer=Se.create("div","maplibregl-canvas-container mapboxgl-canvas-container",b);this._interactive&&n.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=Se.create("canvas","maplibregl-canvas mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const h=this._containerDimensions();this._resizeCanvas(h[0],h[1],this.getPixelRatio());const v=this._controlContainer=Se.create("div","maplibregl-control-container mapboxgl-control-container",b),w=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(I=>{w[I]=Se.create("div",`maplibregl-ctrl-${I} mapboxgl-ctrl-${I}`,v)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(b,n,h){this._canvas.width=h*b,this._canvas.height=h*n,this._canvas.style.width=`${b}px`,this._canvas.style.height=`${n}px`}_setupPainter(){const b=x.extend({},he.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl",b)||this._canvas.getContext("experimental-webgl",b);n?(this.painter=new fo(n,this.transform),x.exported$1.testSupport(n)):this.fire(new x.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(b){b.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new x.Event("webglcontextlost",{originalEvent:b}))}_contextRestored(b){this._setupPainter(),this.resize(),this._update(),this.fire(new x.Event("webglcontextrestored",{originalEvent:b}))}_onMapScroll(b){if(b.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(b){return this.style?(this._styleDirty=this._styleDirty||b,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(b){return this._update(),this._renderTaskQueue.add(b)}_cancelRenderFrame(b){this._renderTaskQueue.remove(b)}_render(b){let n,h=0;const v=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(n=v.createQueryEXT(),v.beginQueryEXT(v.TIME_ELAPSED_EXT,n),h=x.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(b),this._removed)return;let w=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const L=this.transform.zoom,O=x.exported.now();this.style.zoomHistory.update(L,O);const N=new x.EvaluationParameters(L,{now:O,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),$=N.crossFadingFactor();$===1&&$===this._crossFadingFactor||(w=!0,this._crossFadingFactor=$),this.style.update(N)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new x.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,x.PerformanceUtils.mark(x.PerformanceMarkers.load),this.fire(new x.Event("load"))),this.style&&(this.style.hasTransitions()||w)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const L=x.exported.now()-h;v.endQueryEXT(v.TIME_ELAPSED_EXT,n),setTimeout(()=>{const O=v.getQueryObjectEXT(n,v.QUERY_RESULT_EXT)/1e6;v.deleteQueryEXT(n),this.fire(new x.Event("gpu-timing-frame",{cpuTime:L,gpuTime:O}))},50)}if(this.listens("gpu-timing-layer")){const L=this.painter.collectGpuTimers();setTimeout(()=>{const O=this.painter.queryGpuTimers(L);this.fire(new x.Event("gpu-timing-layer",{layerTimes:O}))},50)}const I=this._sourcesDirty||this._styleDirty||this._placementDirty;return I||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new x.Event("idle")),!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,x.PerformanceUtils.mark(x.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window!="undefined"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const b=this.painter.context.gl.getExtension("WEBGL_lose_context");b&&b.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Se.remove(this._canvasContainer),Se.remove(this._controlContainer),this._container.classList.remove("maplibregl-map","mapboxgl-map"),x.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new x.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=x.exported.frame(b=>{x.PerformanceUtils.frame(b),this._frame=null,this._render(b)}))}_onWindowOnline(){this._update()}_onWindowResize(b){this._trackResize&&this.resize({originalEvent:b})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(b){this._showTileBoundaries!==b&&(this._showTileBoundaries=b,this._update())}get showPadding(){return!!this._showPadding}set showPadding(b){this._showPadding!==b&&(this._showPadding=b,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(b){this._showCollisionBoxes!==b&&(this._showCollisionBoxes=b,b?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(b){this._showOverdrawInspector!==b&&(this._showOverdrawInspector=b,this._update())}get repaint(){return!!this._repaint}set repaint(b){this._repaint!==b&&(this._repaint=b,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(b){this._vertices=b,this._update()}_setCacheLimits(b,n){x.setCacheLimits(b,n)}},NavigationControl:class{constructor(b){this.options=x.extend({},Eo,b),this._container=Se.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(x.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",n=>this._map.zoomIn({},{originalEvent:n})),Se.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",n=>this._map.zoomOut({},{originalEvent:n})),Se.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(x.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",n=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:n}):this._map.resetNorth({},{originalEvent:n})}),this._compassIcon=Se.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const b=this._map.getZoom(),n=b===this._map.getMaxZoom(),h=b===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const b=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=b}onAdd(b){return this._map=b,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Wn(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Se.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(b,n){const h=Se.create("button",b,this._container);return h.type="button",h.addEventListener("click",n),h}_setButtonTitle(b,n){const h=this._map._getUIString(`NavigationControl.${n}`);b.title=h,b.setAttribute("aria-label",h)}},GeolocateControl:class extends x.Evented{constructor(b){super(),this.options=x.extend({},Nr,b),x.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(b){var n;return this._map=b,this._container=Se.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),n=this._setupUI,mr!==void 0?n(mr):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(h=>{mr=h.state!=="denied",n(mr)}):(mr=!!window.navigator.geolocation,n(mr)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Se.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Kn=0,vr=!1}_isOutOfMapMaxBounds(b){const n=this._map.getMaxBounds(),h=b.coords;return n&&(h.longitude<n.getWest()||h.longitude>n.getEast()||h.latitude<n.getSouth()||h.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(b){if(this._map){if(this._isOutOfMapMaxBounds(b))return this._setErrorState(),this.fire(new x.Event("outofmaxbounds",b)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=b,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(b),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(b),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new x.Event("geolocate",b)),this._finish()}}_updateCamera(b){const n=new x.LngLat(b.coords.longitude,b.coords.latitude),h=b.coords.accuracy,v=this._map.getBearing(),w=x.extend({bearing:v},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(h),w,{geolocateSource:!0})}_updateMarker(b){if(b){const n=new x.LngLat(b.coords.longitude,b.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=b.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const b=this._map._container.clientHeight/2,n=this._map.unproject([0,b]),h=this._map.unproject([1,b]),v=n.distanceTo(h),w=Math.ceil(2*this._accuracy/v);this._circleElement.style.width=`${w}px`,this._circleElement.style.height=`${w}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(b){if(this._map){if(this.options.trackUserLocation)if(b.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(b.code===3&&vr)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new x.Event("error",b)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(b){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=Se.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),Se.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",b===!1){x.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Se.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new An(this._dotElement),this._circleElement=Se.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new An({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new x.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return x.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new x.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Kn--,vr=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new x.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new x.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let b;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Kn++,Kn>1?(b={maximumAge:6e5,timeout:0},vr=!0):(b=this.options.positionOptions,vr=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,b)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:_n,LogoControl:Lo,ScaleControl:class{constructor(b){this.options=x.extend({},Cn,b),x.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){ma(this._map,this._container,this.options)}onAdd(b){return this._map=b,this._container=Se.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",b.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Se.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(b){this.options.unit=b,ma(this._map,this._container,this.options)}},FullscreenControl:class{constructor(b){this._fullscreen=!1,b&&b.container&&(b.container instanceof HTMLElement?this._container=b.container:x.warnOnce("Full screen control 'container' must be a DOM element.")),x.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(b){return this._map=b,this._container||(this._container=this._map.getContainer()),this._controlContainer=Se.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",x.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){Se.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const b=this._fullscreenButton=Se.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);Se.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",b).setAttribute("aria-hidden","true"),b.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const b=this._getTitle();this._fullscreenButton.setAttribute("aria-label",b),this._fullscreenButton.title=b}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends x.Evented{constructor(b){super(),this.options=x.extend(Object.create(Tt),b),x.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(b){return this._map&&this.remove(),this._map=b,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new x.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&Se.remove(this._content),this._container&&(Se.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new x.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(b){return this._lngLat=x.LngLat.convert(b),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(b){return this.setDOMContent(document.createTextNode(b))}setHTML(b){const n=document.createDocumentFragment(),h=document.createElement("body");let v;for(h.innerHTML=b;v=h.firstChild,v;)n.appendChild(v);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(b){return this.options.maxWidth=b,this._update(),this}setDOMContent(b){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Se.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(b),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(b){this._container&&this._container.classList.add(b)}removeClassName(b){this._container&&this._container.classList.remove(b)}setOffset(b){return this.options.offset=b,this._update(),this}toggleClassName(b){if(this._container)return this._container.classList.toggle(b)}_createCloseButton(){this.options.closeButton&&(this._closeButton=Se.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(b){this._update(b.point)}_onMouseMove(b){this._update(b.point)}_onDrag(b){this._update(b.point)}_update(b){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=Se.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=Se.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(I=>this._container.classList.add(I)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Vt(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!b))return;const n=this._pos=this._trackPointer&&b?b:this._map.project(this._lngLat);let h=this.options.anchor;const v=Or(this.options.offset);if(!h){const I=this._container.offsetWidth,L=this._container.offsetHeight;let O;O=n.y+v.bottom.y<L?["top"]:n.y>this._map.transform.height-L?["bottom"]:[],n.x<I/2?O.push("left"):n.x>this._map.transform.width-I/2&&O.push("right"),h=O.length===0?"bottom":O.join("-")}const w=n.add(v[h]).round();Se.setTransform(this._container,`${wt[h]} translate(${w.x}px,${w.y}px)`),Hn(this._container,h,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const b=this._container.querySelector(qs);b&&b.focus()}_onClose(){this.remove()}},Marker:An,Style:Fi,LngLat:x.LngLat,LngLatBounds:x.LngLatBounds,Point:x.pointGeometry,MercatorCoordinate:x.MercatorCoordinate,Evented:x.Evented,AJAXError:x.AJAXError,config:x.config,CanvasSource:Nn,GeoJSONSource:pn,ImageSource:kn,RasterDEMTileSource:rn,RasterTileSource:oo,VectorTileSource:Un,VideoSource:Vn,prewarm:function(){Dr().acquire(nn)},clearPrewarmedResources:function(){const b=lo;b&&(b.isPreloaded()&&b.numActive()===1?(b.release(nn),lo=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get workerCount(){return vo.workerCount},set workerCount(b){vo.workerCount=b},get maxParallelImageRequests(){return x.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(b){x.config.MAX_PARALLEL_IMAGE_REQUESTS=b},clearStorage(b){x.clearTileCache(b)},workerUrl:"",addProtocol(b,n){x.config.REGISTERED_PROTOCOLS[b]=n},removeProtocol(b){delete x.config.REGISTERED_PROTOCOLS[b]}};return or.extend(Bn,{isSafari:x.isSafari,getPerformanceMetrics:x.PerformanceUtils.getPerformanceMetrics}),Bn});var y=te;return y})})(_c);var Py=_c.exports,eh=My,ky=Object.prototype.hasOwnProperty;function My(){for(var P={},M=0;M<arguments.length;M++){var j=arguments[M];for(var K in j)ky.call(j,K)&&(P[K]=j[K])}return P}var cm={exports:{}};(function(P,M){(function(){var j={};P.exports=j,j.simpleFilter=function(K,te){return te.filter(function(Ae){return j.test(K,Ae)})},j.test=function(K,te){return j.match(K,te)!==null},j.match=function(K,te,Ae){Ae=Ae||{};var y=0,x=[],he=te.length,it=0,Ke=0,Qe=Ae.pre||"",Se=Ae.post||"",It=Ae.caseSensitive&&te||te.toLowerCase(),yt;K=Ae.caseSensitive&&K||K.toLowerCase();for(var ti=0;ti<he;ti++)yt=te[ti],It[ti]===K[y]?(yt=Qe+yt+Se,y+=1,Ke+=1+Ke):Ke=0,it+=Ke,x[x.length]=yt;return y===K.length?(it=It===K?1/0:it,{rendered:x.join(""),score:it}):null},j.filter=function(K,te,Ae){return!te||te.length===0?[]:typeof K!="string"?te:(Ae=Ae||{},te.reduce(function(y,x,he,it){var Ke=x;Ae.extract&&(Ke=Ae.extract(x));var Qe=j.match(K,Ke,Ae);return Qe!=null&&(y[y.length]={string:Qe.rendered,score:Qe.score,index:he,original:x}),y},[]).sort(function(y,x){var he=x.score-y.score;return he||y.index-x.index}))}})()})(cm);var Fa=function(P){return this.component=P,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,P.el.parentNode.insertBefore(this.wrapper,P.el.nextSibling),this};Fa.prototype.show=function(){this.element.style.display="block"};Fa.prototype.hide=function(){this.element.style.display="none"};Fa.prototype.add=function(P){this.items.push(P)};Fa.prototype.clear=function(){this.items=[],this.active=0};Fa.prototype.isEmpty=function(){return!this.items.length};Fa.prototype.isVisible=function(){return this.element.style.display==="block"};Fa.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var P=0;P<this.items.length;P++)this.drawItem(this.items[P],this.active===P);this.show()};Fa.prototype.drawItem=function(P,M){var j=document.createElement("li"),K=document.createElement("a");M&&(j.className+=" active"),K.innerHTML=P.string,j.appendChild(K),this.element.appendChild(j),j.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),j.addEventListener("mouseup",function(){this.handleMouseUp.call(this,P)}.bind(this))};Fa.prototype.handleMouseUp=function(P){this.selectingListItem=!1,this.component.value(P.original),this.clear(),this.draw()};Fa.prototype.move=function(P){this.active=P,this.draw()};Fa.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};Fa.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};Fa.prototype.drawError=function(P){var M=document.createElement("li");M.innerHTML=P,this.element.appendChild(M),this.show()};var Ly=Fa,Dy=eh,Ry=cm.exports,By=Ly,ta=function(P,M,j){return j=j||{},this.options=Dy({minLength:2,limit:5,filter:!0,hideOnBlur:!0},j),this.el=P,this.data=M||[],this.list=new By(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(K){this.handleKeyUp(K.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(K){this.handleKeyDown(K)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(K){this.handlePaste(K)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};ta.prototype.handleKeyUp=function(P){P===40||P===38||P===27||P===13||P===9||this.handleInputChange(this.el.value)};ta.prototype.handleKeyDown=function(P){switch(P.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&P.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};ta.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};ta.prototype.handlePaste=function(P){if(P.clipboardData)this.handleInputChange(P.clipboardData.getData("Text"));else{var M=this;setTimeout(function(){M.handleInputChange(P.target.value)},100)}};ta.prototype.handleInputChange=function(P){if(this.query=this.normalize(P),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates(function(M){for(var j=0;j<M.length&&(this.list.add(M[j]),j!==this.options.limit-1);j++);this.list.draw()}.bind(this))};ta.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};ta.prototype.update=function(P){this.data=P,this.handleKeyUp()};ta.prototype.clear=function(){this.data=[],this.list.clear()};ta.prototype.normalize=function(P){return P=P.toLowerCase(),P};ta.prototype.match=function(P,M){return P.indexOf(M)>-1};ta.prototype.value=function(P){if(this.selected=P,this.el.value=this.getItemValue(P),document.createEvent){var M=document.createEvent("HTMLEvents");M.initEvent("change",!0,!1),this.el.dispatchEvent(M)}else this.el.fireEvent("onchange")};ta.prototype.getCandidates=function(P){var M={pre:"<strong>",post:"</strong>",extract:function(K){return this.getItemValue(K)}.bind(this)},j;this.options.filter?(j=Ry.filter(this.query,this.data,M),j=j.map(function(K){return{original:K.original,string:this.render(K.original,K.string)}}.bind(this))):j=this.data.map(function(K){var te=this.render(K);return{original:K,string:te}}.bind(this)),P(j)};ta.prototype.getItemValue=function(P){return P};ta.prototype.render=function(P,M){if(M)return M;for(var j=P.original?this.getItemValue(P.original):this.getItemValue(P),K=this.normalize(j),te=K.lastIndexOf(this.query);te>-1;){var Ae=te+this.query.length;j=j.slice(0,te)+"<strong>"+j.slice(te,Ae)+"</strong>"+j.slice(Ae),te=K.slice(0,te).lastIndexOf(this.query)}return j};ta.prototype.renderError=function(P){this.list.drawError(P)};var Oy=ta,hm=Oy,Fy=hm;typeof window!="undefined"&&(window.Suggestions=hm);var Uy="Expected a function",Bf=0/0,Vy="[object Symbol]",Ny=/^\s+|\s+$/g,jy=/^[-+]0x[0-9a-f]+$/i,qy=/^0b[01]+$/i,Gy=/^0o[0-7]+$/i,Zy=parseInt,$y=typeof Es=="object"&&Es&&Es.Object===Object&&Es,Xy=typeof self=="object"&&self&&self.Object===Object&&self,Wy=$y||Xy||Function("return this")(),Hy=Object.prototype,Ky=Hy.toString,Jy=Math.max,Yy=Math.min,Md=function(){return Wy.Date.now()};function Qy(P,M,j){var K,te,Ae,y,x,he,it=0,Ke=!1,Qe=!1,Se=!0;if(typeof P!="function")throw new TypeError(Uy);M=Of(M)||0,Gd(j)&&(Ke=!!j.leading,Qe="maxWait"in j,Ae=Qe?Jy(Of(j.maxWait)||0,M):Ae,Se="trailing"in j?!!j.trailing:Se);function It(Si){var Ni=K,Lr=te;return K=te=void 0,it=Si,y=P.apply(Lr,Ni),y}function yt(Si){return it=Si,x=setTimeout(Ei,M),Ke?It(Si):y}function ti(Si){var Ni=Si-he,Lr=Si-it,lr=M-Ni;return Qe?Yy(lr,Ae-Lr):lr}function zt(Si){var Ni=Si-he,Lr=Si-it;return he===void 0||Ni>=M||Ni<0||Qe&&Lr>=Ae}function Ei(){var Si=Md();if(zt(Si))return mi(Si);x=setTimeout(Ei,ti(Si))}function mi(Si){return x=void 0,Se&&K?It(Si):(K=te=void 0,y)}function Ht(){x!==void 0&&clearTimeout(x),it=0,K=he=te=x=void 0}function br(){return x===void 0?y:mi(Md())}function pi(){var Si=Md(),Ni=zt(Si);if(K=arguments,te=this,he=Si,Ni){if(x===void 0)return yt(he);if(Qe)return x=setTimeout(Ei,M),It(he)}return x===void 0&&(x=setTimeout(Ei,M)),y}return pi.cancel=Ht,pi.flush=br,pi}function Gd(P){var M=typeof P;return!!P&&(M=="object"||M=="function")}function eg(P){return!!P&&typeof P=="object"}function tg(P){return typeof P=="symbol"||eg(P)&&Ky.call(P)==Vy}function Of(P){if(typeof P=="number")return P;if(tg(P))return Bf;if(Gd(P)){var M=typeof P.valueOf=="function"?P.valueOf():P;P=Gd(M)?M+"":M}if(typeof P!="string")return P===0?P:+P;P=P.replace(Ny,"");var j=qy.test(P);return j||Gy.test(P)?Zy(P.slice(2),j?2:8):jy.test(P)?Bf:+P}var ig=Qy,Wd={exports:{}},Kc=typeof Reflect=="object"?Reflect:null,Ff=Kc&&typeof Kc.apply=="function"?Kc.apply:function(M,j,K){return Function.prototype.apply.call(M,j,K)},Ep;Kc&&typeof Kc.ownKeys=="function"?Ep=Kc.ownKeys:Object.getOwnPropertySymbols?Ep=function(M){return Object.getOwnPropertyNames(M).concat(Object.getOwnPropertySymbols(M))}:Ep=function(M){return Object.getOwnPropertyNames(M)};function rg(P){console&&console.warn&&console.warn(P)}var pm=Number.isNaN||function(M){return M!==M};function Mr(){Mr.init.call(this)}Wd.exports=Mr;Wd.exports.once=sg;Mr.EventEmitter=Mr;Mr.prototype._events=void 0;Mr.prototype._eventsCount=0;Mr.prototype._maxListeners=void 0;var Uf=10;function Pp(P){if(typeof P!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof P)}Object.defineProperty(Mr,"defaultMaxListeners",{enumerable:!0,get:function(){return Uf},set:function(P){if(typeof P!="number"||P<0||pm(P))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+P+".");Uf=P}});Mr.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Mr.prototype.setMaxListeners=function(M){if(typeof M!="number"||M<0||pm(M))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+M+".");return this._maxListeners=M,this};function dm(P){return P._maxListeners===void 0?Mr.defaultMaxListeners:P._maxListeners}Mr.prototype.getMaxListeners=function(){return dm(this)};Mr.prototype.emit=function(M){for(var j=[],K=1;K<arguments.length;K++)j.push(arguments[K]);var te=M==="error",Ae=this._events;if(Ae!==void 0)te=te&&Ae.error===void 0;else if(!te)return!1;if(te){var y;if(j.length>0&&(y=j[0]),y instanceof Error)throw y;var x=new Error("Unhandled error."+(y?" ("+y.message+")":""));throw x.context=y,x}var he=Ae[M];if(he===void 0)return!1;if(typeof he=="function")Ff(he,this,j);else for(var it=he.length,Ke=_m(he,it),K=0;K<it;++K)Ff(Ke[K],this,j);return!0};function fm(P,M,j,K){var te,Ae,y;if(Pp(j),Ae=P._events,Ae===void 0?(Ae=P._events=Object.create(null),P._eventsCount=0):(Ae.newListener!==void 0&&(P.emit("newListener",M,j.listener?j.listener:j),Ae=P._events),y=Ae[M]),y===void 0)y=Ae[M]=j,++P._eventsCount;else if(typeof y=="function"?y=Ae[M]=K?[j,y]:[y,j]:K?y.unshift(j):y.push(j),te=dm(P),te>0&&y.length>te&&!y.warned){y.warned=!0;var x=new Error("Possible EventEmitter memory leak detected. "+y.length+" "+String(M)+" listeners added. Use emitter.setMaxListeners() to increase limit");x.name="MaxListenersExceededWarning",x.emitter=P,x.type=M,x.count=y.length,rg(x)}return P}Mr.prototype.addListener=function(M,j){return fm(this,M,j,!1)};Mr.prototype.on=Mr.prototype.addListener;Mr.prototype.prependListener=function(M,j){return fm(this,M,j,!0)};function ng(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function mm(P,M,j){var K={fired:!1,wrapFn:void 0,target:P,type:M,listener:j},te=ng.bind(K);return te.listener=j,K.wrapFn=te,te}Mr.prototype.once=function(M,j){return Pp(j),this.on(M,mm(this,M,j)),this};Mr.prototype.prependOnceListener=function(M,j){return Pp(j),this.prependListener(M,mm(this,M,j)),this};Mr.prototype.removeListener=function(M,j){var K,te,Ae,y,x;if(Pp(j),te=this._events,te===void 0)return this;if(K=te[M],K===void 0)return this;if(K===j||K.listener===j)--this._eventsCount===0?this._events=Object.create(null):(delete te[M],te.removeListener&&this.emit("removeListener",M,K.listener||j));else if(typeof K!="function"){for(Ae=-1,y=K.length-1;y>=0;y--)if(K[y]===j||K[y].listener===j){x=K[y].listener,Ae=y;break}if(Ae<0)return this;Ae===0?K.shift():og(K,Ae),K.length===1&&(te[M]=K[0]),te.removeListener!==void 0&&this.emit("removeListener",M,x||j)}return this};Mr.prototype.off=Mr.prototype.removeListener;Mr.prototype.removeAllListeners=function(M){var j,K,te;if(K=this._events,K===void 0)return this;if(K.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):K[M]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete K[M]),this;if(arguments.length===0){var Ae=Object.keys(K),y;for(te=0;te<Ae.length;++te)y=Ae[te],y!=="removeListener"&&this.removeAllListeners(y);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(j=K[M],typeof j=="function")this.removeListener(M,j);else if(j!==void 0)for(te=j.length-1;te>=0;te--)this.removeListener(M,j[te]);return this};function ym(P,M,j){var K=P._events;if(K===void 0)return[];var te=K[M];return te===void 0?[]:typeof te=="function"?j?[te.listener||te]:[te]:j?ag(te):_m(te,te.length)}Mr.prototype.listeners=function(M){return ym(this,M,!0)};Mr.prototype.rawListeners=function(M){return ym(this,M,!1)};Mr.listenerCount=function(P,M){return typeof P.listenerCount=="function"?P.listenerCount(M):gm.call(P,M)};Mr.prototype.listenerCount=gm;function gm(P){var M=this._events;if(M!==void 0){var j=M[P];if(typeof j=="function")return 1;if(j!==void 0)return j.length}return 0}Mr.prototype.eventNames=function(){return this._eventsCount>0?Ep(this._events):[]};function _m(P,M){for(var j=new Array(M),K=0;K<M;++K)j[K]=P[K];return j}function og(P,M){for(;M+1<P.length;M++)P[M]=P[M+1];P.pop()}function ag(P){for(var M=new Array(P.length),j=0;j<M.length;++j)M[j]=P[j].listener||P[j];return M}function sg(P,M){return new Promise(function(j,K){function te(y){P.removeListener(M,Ae),K(y)}function Ae(){typeof P.removeListener=="function"&&P.removeListener("error",te),j([].slice.call(arguments))}vm(P,M,Ae,{once:!0}),M!=="error"&&lg(P,te,{once:!0})})}function lg(P,M,j){typeof P.on=="function"&&vm(P,"error",M,j)}function vm(P,M,j,K){if(typeof P.on=="function")K.once?P.once(M,j):P.on(M,j);else if(typeof P.addEventListener=="function")P.addEventListener(M,function te(Ae){K.once&&P.removeEventListener(M,te),j(Ae)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof P)}var ug={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function cg(P){var M=P.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return M?{key:M[1],value:M[2]}:null}function hg(P){var M=P.match(/<?([^>]*)>(.*)/);if(!M)return null;var j=M[1],K=M[2].split(";"),te=null,Ae=K.reduce(function(y,x){var he=cg(x);return he?he.key==="rel"?(te||(te=he.value),y):(y[he.key]=he.value,y):y},{});return te?{url:j,rel:te,params:Ae}:null}function pg(P){return P?P.split(/,\s*</).reduce(function(M,j){var K=hg(j);if(!K)return M;var te=K.rel.split(/\s+/);return te.forEach(function(Ae){M[Ae]||(M[Ae]={url:K.url,params:K.params})}),M},{}):{}}var dg=pg,fg=dg;function Hd(P,M){this.request=P,this.headers=M.headers,this.rawBody=M.body,this.statusCode=M.statusCode;try{this.body=JSON.parse(M.body||"{}")}catch{this.body=M.body}this.links=fg(this.headers.link)}Hd.prototype.hasNextPage=function(){return!!this.links.next};Hd.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var mg=Hd,kp={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},Vf=kp;function yg(P){var M=P.type||Vf.ERROR_HTTP,j;if(P.body)try{j=JSON.parse(P.body)}catch{j=P.body}else j=null;var K=P.message||null;K||(typeof j=="string"?K=j:j&&typeof j.message=="string"?K=j.message:M===Vf.ERROR_REQUEST_ABORTED&&(K="Request aborted")),this.message=K,this.type=M,this.statusCode=P.statusCode||null,this.request=P.request,this.body=j}var gg=yg;function _g(P){var M=P.indexOf(":"),j=P.substring(0,M).trim().toLowerCase(),K=P.substring(M+1).trim();return{name:j,value:K}}function vg(P){var M={};return P&&P.trim().split(/[\r|\n]+/).forEach(function(j){var K=_g(j);M[K.name]=K.value}),M}var xg=vg,bg=mg,Nf=gg,Ld=kp,wg=xg,Ap={};function Eg(P){var M=Ap[P.id];!M||(M.abort(),delete Ap[P.id])}function Sg(P,M){return new bg(P,{body:M.response,headers:wg(M.getAllResponseHeaders()),statusCode:M.status})}function jf(P){var M=P.total,j=P.loaded,K=100*j/M;return{total:M,transferred:j,percent:K}}function xm(P,M){return new Promise(function(j,K){M.onprogress=function(y){P.emitter.emit(Ld.EVENT_PROGRESS_DOWNLOAD,jf(y))};var te=P.file;te&&(M.upload.onprogress=function(y){P.emitter.emit(Ld.EVENT_PROGRESS_UPLOAD,jf(y))}),M.onerror=function(y){K(y)},M.onabort=function(){var y=new Nf({request:P,type:Ld.ERROR_REQUEST_ABORTED});K(y)},M.onload=function(){if(delete Ap[P.id],M.status<200||M.status>=400){var y=new Nf({request:P,body:M.response,statusCode:M.status});K(y);return}j(M)};var Ae=P.body;typeof Ae=="string"?M.send(Ae):Ae?M.send(JSON.stringify(Ae)):te?M.send(te):M.send(),Ap[P.id]=M}).then(function(j){return Sg(P,j)})}function bm(P,M){var j=P.url(M),K=new window.XMLHttpRequest;return K.open(P.method,j),Object.keys(P.headers).forEach(function(te){K.setRequestHeader(te,P.headers[te])}),K}function Tg(P){return Promise.resolve().then(function(){var M=bm(P,P.client.accessToken);return xm(P,M)})}var Ig={browserAbort:Eg,sendRequestXhr:xm,browserSend:Tg,createRequestXhr:bm},Zd={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */(function(P,M){(function(j){var K=M,te=P&&P.exports==K&&P,Ae=typeof Es=="object"&&Es;(Ae.global===Ae||Ae.window===Ae)&&(j=Ae);var y=function(yt){this.message=yt};y.prototype=new Error,y.prototype.name="InvalidCharacterError";var x=function(yt){throw new y(yt)},he="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",it=/[\t\n\f\r ]/g,Ke=function(yt){yt=String(yt).replace(it,"");var ti=yt.length;ti%4==0&&(yt=yt.replace(/==?$/,""),ti=yt.length),(ti%4==1||/[^+a-zA-Z0-9/]/.test(yt))&&x("Invalid character: the string to be decoded is not correctly encoded.");for(var zt=0,Ei,mi,Ht="",br=-1;++br<ti;)mi=he.indexOf(yt.charAt(br)),Ei=zt%4?Ei*64+mi:mi,zt++%4&&(Ht+=String.fromCharCode(255&Ei>>(-2*zt&6)));return Ht},Qe=function(yt){yt=String(yt),/[^\0-\xFF]/.test(yt)&&x("The string to be encoded contains characters outside of the Latin1 range.");for(var ti=yt.length%3,zt="",Ei=-1,mi,Ht,br,pi,Si=yt.length-ti;++Ei<Si;)mi=yt.charCodeAt(Ei)<<16,Ht=yt.charCodeAt(++Ei)<<8,br=yt.charCodeAt(++Ei),pi=mi+Ht+br,zt+=he.charAt(pi>>18&63)+he.charAt(pi>>12&63)+he.charAt(pi>>6&63)+he.charAt(pi&63);return ti==2?(mi=yt.charCodeAt(Ei)<<8,Ht=yt.charCodeAt(++Ei),pi=mi+Ht,zt+=he.charAt(pi>>10)+he.charAt(pi>>4&63)+he.charAt(pi<<2&63)+"="):ti==1&&(pi=yt.charCodeAt(Ei),zt+=he.charAt(pi>>2)+he.charAt(pi<<4&63)+"=="),zt},Se={encode:Qe,decode:Ke,version:"0.1.0"};if(K&&!K.nodeType)if(te)te.exports=Se;else for(var It in Se)Se.hasOwnProperty(It)&&(K[It]=Se[It]);else j.base64=Se})(Es)})(Zd,Zd.exports);var Ag=Zd.exports,Dd={};function Cg(P){if(Dd[P])return Dd[P];var M=P.split("."),j=M[0],K=M[1];if(!K)throw new Error("Invalid token");var te=zg(K),Ae={usage:j,user:te.u};return yc(te,"a")&&(Ae.authorization=te.a),yc(te,"exp")&&(Ae.expires=te.exp*1e3),yc(te,"iat")&&(Ae.created=te.iat*1e3),yc(te,"scopes")&&(Ae.scopes=te.scopes),yc(te,"client")&&(Ae.client=te.client),yc(te,"ll")&&(Ae.lastLogin=te.ll),yc(te,"iu")&&(Ae.impersonator=te.iu),Dd[P]=Ae,Ae}function zg(P){try{return JSON.parse(Ag.decode(P))}catch{throw new Error("Invalid token")}}function yc(P,M){return Object.prototype.hasOwnProperty.call(P,M)}var wm=Cg,Em={exports:{}};(function(P){var M=Object.prototype.hasOwnProperty,j="~";function K(){}Object.create&&(K.prototype=Object.create(null),new K().__proto__||(j=!1));function te(he,it,Ke){this.fn=he,this.context=it,this.once=Ke||!1}function Ae(he,it,Ke,Qe,Se){if(typeof Ke!="function")throw new TypeError("The listener must be a function");var It=new te(Ke,Qe||he,Se),yt=j?j+it:it;return he._events[yt]?he._events[yt].fn?he._events[yt]=[he._events[yt],It]:he._events[yt].push(It):(he._events[yt]=It,he._eventsCount++),he}function y(he,it){--he._eventsCount===0?he._events=new K:delete he._events[it]}function x(){this._events=new K,this._eventsCount=0}x.prototype.eventNames=function(){var it=[],Ke,Qe;if(this._eventsCount===0)return it;for(Qe in Ke=this._events)M.call(Ke,Qe)&&it.push(j?Qe.slice(1):Qe);return Object.getOwnPropertySymbols?it.concat(Object.getOwnPropertySymbols(Ke)):it},x.prototype.listeners=function(it){var Ke=j?j+it:it,Qe=this._events[Ke];if(!Qe)return[];if(Qe.fn)return[Qe.fn];for(var Se=0,It=Qe.length,yt=new Array(It);Se<It;Se++)yt[Se]=Qe[Se].fn;return yt},x.prototype.listenerCount=function(it){var Ke=j?j+it:it,Qe=this._events[Ke];return Qe?Qe.fn?1:Qe.length:0},x.prototype.emit=function(it,Ke,Qe,Se,It,yt){var ti=j?j+it:it;if(!this._events[ti])return!1;var zt=this._events[ti],Ei=arguments.length,mi,Ht;if(zt.fn){switch(zt.once&&this.removeListener(it,zt.fn,void 0,!0),Ei){case 1:return zt.fn.call(zt.context),!0;case 2:return zt.fn.call(zt.context,Ke),!0;case 3:return zt.fn.call(zt.context,Ke,Qe),!0;case 4:return zt.fn.call(zt.context,Ke,Qe,Se),!0;case 5:return zt.fn.call(zt.context,Ke,Qe,Se,It),!0;case 6:return zt.fn.call(zt.context,Ke,Qe,Se,It,yt),!0}for(Ht=1,mi=new Array(Ei-1);Ht<Ei;Ht++)mi[Ht-1]=arguments[Ht];zt.fn.apply(zt.context,mi)}else{var br=zt.length,pi;for(Ht=0;Ht<br;Ht++)switch(zt[Ht].once&&this.removeListener(it,zt[Ht].fn,void 0,!0),Ei){case 1:zt[Ht].fn.call(zt[Ht].context);break;case 2:zt[Ht].fn.call(zt[Ht].context,Ke);break;case 3:zt[Ht].fn.call(zt[Ht].context,Ke,Qe);break;case 4:zt[Ht].fn.call(zt[Ht].context,Ke,Qe,Se);break;default:if(!mi)for(pi=1,mi=new Array(Ei-1);pi<Ei;pi++)mi[pi-1]=arguments[pi];zt[Ht].fn.apply(zt[Ht].context,mi)}}return!0},x.prototype.on=function(it,Ke,Qe){return Ae(this,it,Ke,Qe,!1)},x.prototype.once=function(it,Ke,Qe){return Ae(this,it,Ke,Qe,!0)},x.prototype.removeListener=function(it,Ke,Qe,Se){var It=j?j+it:it;if(!this._events[It])return this;if(!Ke)return y(this,It),this;var yt=this._events[It];if(yt.fn)yt.fn===Ke&&(!Se||yt.once)&&(!Qe||yt.context===Qe)&&y(this,It);else{for(var ti=0,zt=[],Ei=yt.length;ti<Ei;ti++)(yt[ti].fn!==Ke||Se&&!yt[ti].once||Qe&&yt[ti].context!==Qe)&&zt.push(yt[ti]);zt.length?this._events[It]=zt.length===1?zt[0]:zt:y(this,It)}return this},x.prototype.removeAllListeners=function(it){var Ke;return it?(Ke=j?j+it:it,this._events[Ke]&&y(this,Ke)):(this._events=new K,this._eventsCount=0),this},x.prototype.off=x.prototype.removeListener,x.prototype.addListener=x.prototype.on,x.prefixed=j,x.EventEmitter=x,P.exports=x})(Em);function Pg(P){return P.map(encodeURIComponent).join(",")}function Sm(P){return Array.isArray(P)?Pg(P):encodeURIComponent(String(P))}function Tm(P,M,j){if(j===!1||j===null)return P;var K=/\?/.test(P)?"&":"?",te=encodeURIComponent(M);return j!==void 0&&j!==""&&j!==!0&&(te+="="+Sm(j)),""+P+K+te}function kg(P,M){if(!M)return P;var j=P;return Object.keys(M).forEach(function(K){var te=M[K];te!==void 0&&(Array.isArray(te)&&(te=te.filter(function(Ae){return Ae!=null}).join(",")),j=Tm(j,K,te))}),j}function Mg(P,M){if(!M||P.slice(0,4)==="http")return P;var j=P[0]==="/"?"":"/";return""+M.replace(/\/$/,"")+j+P}function Lg(P,M){return M?P.replace(/\/:([a-zA-Z0-9]+)/g,function(j,K){var te=M[K];if(te===void 0)throw new Error("Unspecified route parameter "+K);var Ae=Sm(te);return"/"+Ae}):P}var Dg={appendQueryObject:kg,appendQueryParam:Tm,prependOrigin:Mg,interpolateRouteParams:Lg},Rg=wm,Kd=eh,Bg=Em.exports,_p=Dg,qf=kp,Og=1;function qu(P,M){if(!P)throw new Error("MapiRequest requires a client");if(!M||!M.path||!M.method)throw new Error("MapiRequest requires an options object with path and method properties");var j={};M.body&&(j["content-type"]="application/json");var K=Kd(j,M.headers),te=Object.keys(K).reduce(function(Ae,y){return Ae[y.toLowerCase()]=K[y],Ae},{});this.id=Og++,this._options=M,this.emitter=new Bg,this.client=P,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=M.path,this.method=M.method,this.origin=M.origin||P.origin,this.query=M.query||{},this.params=M.params||{},this.body=M.body||null,this.file=M.file||null,this.encoding=M.encoding||"utf8",this.sendFileAs=M.sendFileAs||null,this.headers=te}qu.prototype.url=function(M){var j=_p.prependOrigin(this.path,this.origin);j=_p.appendQueryObject(j,this.query);var K=this.params,te=M==null?this.client.accessToken:M;if(te){j=_p.appendQueryParam(j,"access_token",te);var Ae=Rg(te).user;K=Kd({ownerId:Ae},K)}return j=_p.interpolateRouteParams(j,K),j};qu.prototype.send=function(){var M=this;if(M.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return M.sent=!0,M.client.sendRequest(M).then(function(j){return M.response=j,M.emitter.emit(qf.EVENT_RESPONSE,j),j},function(j){throw M.error=j,M.emitter.emit(qf.EVENT_ERROR,j),j})};qu.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};qu.prototype.eachPage=function(M){var j=this;function K(y){function x(){delete j._nextPageRequest;var he=y.nextPage();he&&(j._nextPageRequest=he,Ae(he))}M(null,y,x)}function te(y){M(y,null,function(){})}function Ae(y){y.send().then(K,te)}Ae(this)};qu.prototype.clone=function(){return this._extend()};qu.prototype._extend=function(M){var j=Kd(this._options,M);return new qu(this.client,j)};var Fg=qu,Ug=wm,Vg=Fg,Ng=kp;function Im(P){if(!P||!P.accessToken)throw new Error("Cannot create a client without an access token");Ug(P.accessToken),this.accessToken=P.accessToken,this.origin=P.origin||Ng.API_ORIGIN}Im.prototype.createRequest=function(M){return new Vg(this,M)};var Am=Im,Cm=Ig,zm=Am;function Yc(P){zm.call(this,P)}Yc.prototype=Object.create(zm.prototype);Yc.prototype.constructor=Yc;Yc.prototype.sendRequest=Cm.browserSend;Yc.prototype.abortRequest=Cm.browserAbort;function jg(P){return new Yc(P)}var Pm=jg,qg=Pm,Gg=qg,Zg=Object.prototype.toString,$g=function(P){var M;return Zg.call(P)==="[object Object]"&&(M=Object.getPrototypeOf(P),M===null||M===Object.getPrototypeOf({}))},Xg=$g,Wg=eh,km="value",Rd=`
  `,qr={};qr.assert=function(P,M){return M=M||{},function(j){var K=Gu(P,j);if(!!K){var te=Jd(K,M);throw M.apiName&&(te=M.apiName+": "+te),new Error(te)}}};qr.shape=function(M){var j=Yg(M);return function(te){var Ae=Gu(qr.plainObject,te);if(Ae)return Ae;for(var y,x,he=[],it=0;it<j.length;it++)y=j[it].key,x=j[it].value,Ae=Gu(x,te[y]),Ae&&he.push([y].concat(Ae));return he.length<2?he[0]:function(Ke){he=he.map(function(It){var yt=It[0],ti=Jd(It,Ke).split(`
`).join(Rd);return"- "+yt+": "+ti});var Qe=Ke.path.join("."),Se=Qe===km?"":" of "+Qe;return"The following properties"+Se+" have invalid values:"+Rd+he.join(Rd)}}};qr.strictShape=function(M){var j=qr.shape(M);return function(te){var Ae=j(te);if(Ae)return Ae;var y=Object.keys(te).reduce(function(x,he){return M[he]===void 0&&x.push(he),x},[]);if(y.length!==0)return function(){return"The following keys are invalid: "+y.join(", ")}}};qr.arrayOf=function(M){return Mm(M)};qr.tuple=function(){var M=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return Mm(M)};function Mm(P){var M=Array.isArray(P),j=function(K){return M?P[K]:P};return function(te){var Ae=Gu(qr.plainArray,te);if(Ae)return Ae;if(M&&te.length!==P.length)return"an array with "+P.length+" items";for(var y=0;y<te.length;y++)if(Ae=Gu(j(y),te[y]),Ae)return[y].concat(Ae)}}qr.required=function(M){function j(K){return K==null?function(te){return Lm(te,Dm(te.path)?"cannot be undefined/null.":"is required.")}:M.apply(this,arguments)}return j.__required=!0,j};qr.oneOfType=function(){var M=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(K){var te=M.map(function(Ae){return Gu(Ae,K)}).filter(Boolean);if(te.length===M.length)return te.every(function(Ae){return Ae.length===1&&typeof Ae[0]=="string"})?Hg(te.map(function(Ae){return Ae[0]})):te.reduce(function(Ae,y){return y.length>Ae.length?y:Ae})}};qr.equal=function(M){return function(K){if(K!==M)return JSON.stringify(M)}};qr.oneOf=function(){var M=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),j=M.map(function(K){return qr.equal(K)});return qr.oneOfType.apply(this,j)};qr.range=function(M){var j=M[0],K=M[1];return function(Ae){var y=Gu(qr.number,Ae);if(y||Ae<j||Ae>K)return"number between "+j+" & "+K+" (inclusive)"}};qr.any=function(){};qr.boolean=function(M){if(typeof M!="boolean")return"boolean"};qr.number=function(M){if(typeof M!="number")return"number"};qr.plainArray=function(M){if(!Array.isArray(M))return"array"};qr.plainObject=function(M){if(!Xg(M))return"object"};qr.string=function(M){if(typeof M!="string")return"string"};qr.func=function(M){if(typeof M!="function")return"function"};function Gu(P,M){if(!(M==null&&!P.hasOwnProperty("__required"))){var j=P(M);if(j)return Array.isArray(j)?j:[j]}}function Jd(P,M){var j=P.length,K=P[j-1],te=P.slice(0,j-1);return te.length===0&&(te=[km]),M=Wg(M,{path:te}),typeof K=="function"?K(M):Lm(M,Kg(K))}function Hg(P){return P.length<2?P[0]:P.length===2?P.join(" or "):P.slice(0,-1).join(", ")+", or "+P.slice(-1)}function Kg(P){return"must be "+Jg(P)+"."}function Jg(P){return/^an? /.test(P)?P:/^[aeiou]/i.test(P)?"an "+P:/^[a-z]/i.test(P)?"a "+P:P}function Lm(P,M){var j=Dm(P.path),K=P.path.join(".")+" "+M,te=j?"Item at position ":"";return te+K}function Dm(P){return typeof P[P.length-1]=="number"||typeof P[0]=="number"}function Yg(P){return Object.keys(P||{}).map(function(M){return{key:M,value:P[M]}})}qr.validate=Gu;qr.processMessage=Jd;var Qg=qr,e_=eh,Jc=Qg;function t_(P){if(typeof window!="undefined")return P instanceof Es.Blob||P instanceof Es.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof P=="string"||P.pipe!==void 0))return"Filename or Readable stream"}function i_(P,M){return Jc.assert(Jc.strictShape(P),M)}function r_(P){var M="date";if(typeof P=="boolean")return M;try{var j=new Date(P);if(j.getTime&&isNaN(j.getTime()))return M}catch{return M}}function n_(P){return Jc.tuple(Jc.number,Jc.number)(P)}var o_=e_(Jc,{file:t_,date:r_,coordinates:n_,assertShape:i_});function a_(P,M){var j=function(K,te){return M.indexOf(K)!==-1&&te!==void 0};return typeof M=="function"&&(j=M),Object.keys(P).filter(function(K){return j(K,P[K])}).reduce(function(K,te){return K[te]=P[te],K},{})}var s_=a_;function l_(P,M){return Object.keys(P).reduce(function(j,K){return j[K]=M(K,P[K]),j},{})}var u_=l_,c_=u_;function h_(P){return c_(P,function(M,j){return typeof j=="boolean"?JSON.stringify(j):j})}var p_=h_,d_=Am,f_=Pm;function m_(P){return function(M){var j;d_.prototype.isPrototypeOf(M)?j=M:j=f_(M);var K=Object.create(P);return K.client=j,K}}var y_=m_,Rm=eh,rr=o_,Cp=s_,Bm=p_,g_=y_,Yd={},Om=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];Yd.forwardGeocode=function(P){rr.assertShape({query:rr.required(rr.string),mode:rr.oneOf("mapbox.places","mapbox.places-permanent"),countries:rr.arrayOf(rr.string),proximity:rr.oneOf(rr.coordinates,"ip"),types:rr.arrayOf(rr.oneOf(Om)),autocomplete:rr.boolean,bbox:rr.arrayOf(rr.number),limit:rr.number,language:rr.arrayOf(rr.string),routing:rr.boolean,fuzzyMatch:rr.boolean,worldview:rr.string})(P),P.mode=P.mode||"mapbox.places";var M=Bm(Rm({country:P.countries},Cp(P,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:Cp(P,["mode","query"]),query:M})};Yd.reverseGeocode=function(P){rr.assertShape({query:rr.required(rr.coordinates),mode:rr.oneOf("mapbox.places","mapbox.places-permanent"),countries:rr.arrayOf(rr.string),types:rr.arrayOf(rr.oneOf(Om)),bbox:rr.arrayOf(rr.number),limit:rr.number,language:rr.arrayOf(rr.string),reverseMode:rr.oneOf("distance","score"),routing:rr.boolean,worldview:rr.string})(P),P.mode=P.mode||"mapbox.places";var M=Bm(Rm({country:P.countries},Cp(P,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:Cp(P,["mode","query"]),query:M})};var __=g_(Yd);let v_="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",Fm=P=>crypto.getRandomValues(new Uint8Array(P)),Um=(P,M,j)=>{let K=(2<<Math.log(P.length-1)/Math.LN2)-1,te=-~(1.6*K*M/P.length);return(Ae=M)=>{let y="";for(;;){let x=j(te),he=te;for(;he--;)if(y+=P[x[he]&K]||"",y.length===Ae)return y}}},x_=(P,M=21)=>Um(P,M,Fm),b_=(P=21)=>{let M="",j=crypto.getRandomValues(new Uint8Array(P));for(;P--;){let K=j[P]&63;K<36?M+=K.toString(36):K<62?M+=(K-26).toString(36).toUpperCase():K<63?M+="_":M+="-"}return M};var w_=Object.freeze(Object.defineProperty({__proto__:null,nanoid:b_,customAlphabet:x_,customRandom:Um,urlAlphabet:v_,random:Fm},Symbol.toStringTag,{value:"Module"})),E_=zy(w_),S_=E_.nanoid;function Vm(P){this.origin=P.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=P.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=P,this.send=this.send.bind(this),this.countries=P.countries?P.countries.split(","):null,this.types=P.types?P.types.split(","):null,this.bbox=P.bbox?P.bbox:null,this.language=P.language?P.language.split(","):null,this.limit=P.limit?+P.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(P),this.eventQueue=new Array,this.flushInterval=P.flushInterval||1e3,this.maxQueueSize=P.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}Vm.prototype={select:function(P,M){var j=this.getSelectedIndex(P,M),K=this.getEventPayload("search.select",M);if(K.resultIndex=j,K.resultPlaceName=P.place_name,K.resultId=P.id,!(j===this.lastSentIndex&&K.queryString===this.lastSentInput||j==-1)&&(this.lastSentIndex=j,this.lastSentInput=K.queryString,!!K.queryString))return this.push(K)},start:function(P){var M=this.getEventPayload("search.start",P);if(!!M.queryString)return this.push(M)},keyevent:function(P,M){if(!!P.key&&!(P.metaKey||[9,27,37,39,13,38,40].indexOf(P.keyCode)!==-1)){var j=this.getEventPayload("search.keystroke",M);if(j.lastAction=P.key,!!j.queryString)return this.push(j)}},send:function(P,M){if(!this.enableEventLogging)return M?M():void 0;var j=this.getRequestOptions(P);this.request(j,function(K){if(K)return this.handleError(K,M);if(M)return M()}.bind(this))},getRequestOptions:function(P){Array.isArray(P)||(P=[P]);var M={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(P)};return M},getEventPayload:function(P,M){var j;M.options.proximity?typeof M.options.proximity=="object"?j=[M.options.proximity.longitude,M.options.proximity.latitude]:M.options.proximity==="ip"?j=[999,999]:j=M.options.proximity:j=null;var K=M._map?M._map.getZoom():void 0,te={event:P,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:M.options.autocomplete,fuzzyMatch:M.options.fuzzyMatch,proximity:j,limit:M.options.limit,routing:M.options.routing,worldview:M.options.worldview,mapZoom:K,keyboardLocale:this.locale};return P==="search.select"?te.queryString=M.inputString:P!="search.select"&&M._inputEl?te.queryString=M._inputEl.value:te.queryString=M.inputString,te},request:function(P,M){var j=new XMLHttpRequest;j.onreadystatechange=function(){if(this.readyState==4)return this.status==204?M(null):M(this.statusText)},j.open(P.method,P.host+"/"+P.path,!0);for(var K in P.headers){var te=P.headers[K];j.setRequestHeader(K,te)}j.send(P.body)},handleError:function(P,M){if(M)return M(P)},generateSessionID:function(){return S_()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(P,M){if(!!M._typeahead){var j=M._typeahead.data,K=P.id,te=j.map(function(y){return y.id}),Ae=te.indexOf(K);return Ae}},shouldEnableLogging:function(P){return!(P.enableEventLogging===!1||P.origin&&P.origin.indexOf("api.mapbox.com")==-1||P.localGeocoder||P.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(P,M){this.eventQueue.push(P),(this.eventQueue.length>=this.maxQueueSize||M)&&this.flush()},remove:function(){this.flush()}};var T_=Vm,I_={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"\u05DC\u05D7\u05E4\u05E9",ja:"\u30B5\u30FC\u30C1",lv:"Mekl\u0113t",pt:"Procurar",sr:"\u041F\u0440\u0435\u0442\u0440\u0430\u0433\u0430",zh:"\u641C\u7D22",cs:"Vyhled\xE1v\xE1n\xED",hu:"Keres\xE9s",ka:"\u10EB\u10D8\u10D4\u10D1\u10D0",nb:"S\xF8ke",sk:"Vyh\u013Ead\xE1vanie",th:"\u0E04\u0E49\u0E19\u0E2B\u0E32",fi:"Hae",is:"Leita",ko:"\uC218\uC0C9",pl:"Szukaj",sl:"Iskanje",fa:"\u062C\u0633\u062A\u062C\u0648",ru:"\u041F\u043E\u0438\u0441\u043A"},A_={placeholder:I_},Nm={exports:{}};(function(P){(function(M,j,K){P.exports?P.exports=K():M[j]=K()})(Es,"subtag",function(){var M="",j=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function K(he){return he.match(j)||[]}function te(he){return K(he).filter(function(it,Ke){return it&&Ke})}function Ae(he){return he=K(he),{language:he[1]||M,extlang:he[2]||M,script:he[3]||M,region:he[4]||M}}function y(he,it,Ke){Object.defineProperty(he,it,{value:Ke,enumerable:!0})}function x(he,it,Ke){function Qe(Se){return K(Se)[he]||M}y(Qe,"pattern",it),y(Ae,Ke,Qe)}return x(1,/^[a-zA-Z]{2,3}$/,"language"),x(2,/^[a-zA-Z]{3}$/,"extlang"),x(3,/^[a-zA-Z]{4}$/,"script"),x(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),y(Ae,"split",te),Ae})})(Nm);function jm(){}jm.prototype={isSupport:function(){return Boolean(window.navigator.geolocation)},getCurrentPosition:function(){const P={enableHighAccuracy:!0};return new Promise(function(M,j){window.navigator.geolocation.getCurrentPosition(M,j,P)})}};var C_=jm;function z_(P,M){const j=qm(P),K=["address","street","place","country"];var te;if(typeof M=="function")return M(j);const Ae=K.indexOf(M);return Ae===-1?te=K:te=K.slice(Ae),te.reduce(function(y,x){return j[x]?(y!==""&&(y=y+", "),y+j[x]):y},"")}function qm(P){const M=P.address||"",j=P.text||"",K=P.place_name||"",Ae={address:K.split(",")[0],houseNumber:M,street:j,placeName:K};return P.context.forEach(function(y){const x=y.id.split(".")[0];Ae[x]=y.text}),Ae}var P_={transformFeatureToGeolocationText:z_,getAddressInfo:qm},k_=Fy,M_=ig,gc=eh,L_=Wd.exports.EventEmitter,Gf=ug,Bd=Gg,Od=__,D_=T_,R_=A_,B_=Nm.exports,O_=C_,F_=P_;const Nu={FORWARD:0,LOCAL:1,REVERSE:2};function U_(){var P=document.createElement("div");return P.className="mapboxgl-ctrl-geocoder--powered-by",P.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',P}function Gm(P){this._eventEmitter=new L_,this.options=gc({},this.options,P),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new O_}Gm.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(P){return P.place_name},render:function(P){var M=P.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+M[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+M.splice(1,M.length).join(",")+"</div></div>"}},addTo:function(P){function M(j,K){if(!document.body.contains(K))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const te=j.onAdd();K.appendChild(te)}if(P._controlContainer)P.addControl(this);else if(P instanceof HTMLElement)M(this,P);else if(typeof P=="string"){const j=document.querySelectorAll(P);if(j.length===0)throw new Error("Element ",P,"not found.");if(j.length>1)throw new Error("Geocoder can only be added to a single html element");M(this,j[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(P){if(P&&typeof P!="string"&&(this._map=P),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=Od(Bd({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new D_(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var M=this.container=document.createElement("div");M.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var j=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",M_(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(it){this.eventManager.keyevent(it,this)}.bind(this));var K=document.createElement("div");K.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var te=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(te),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),K.appendChild(this._clearEl),K.appendChild(this._loadingEl),M.appendChild(j),M.appendChild(this._inputEl),M.appendChild(K),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var Ae=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(Ae),K.appendChild(this._geolocateEl),this._showGeolocateButton()}var y=this._typeahead=new k_(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),y.getItemValue=this.options.getItemValue;var x=y.list.draw,he=this._footerNode=U_();return y.list.draw=function(){x.call(this),he.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),he.addEventListener("mouseup",function(){this.selectingListItem=!1}.bind(this)),this.element.appendChild(he)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),M},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then(function(P){this._hideLoadingIcon();const M={geometry:{type:"Point",coordinates:[P.coords.longitude,P.coords.latitude]}};this._handleMarker(M),this._fly(M),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(M),this._showClearButton(),this.fresh=!1;const j={limit:1,language:[this.options.language],query:M.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const K=M.geometry.coordinates[0]+","+M.geometry.coordinates[1];this._setInputValue(K),this._eventEmitter.emit("result",{result:M})}else this.geocoderService.reverseGeocode(j).send().then(function(K){const te=K.body.features[0];if(te){const Ae=F_.transformFeatureToGeolocationText(te,this.options.addressAccuracy);this._setInputValue(Ae),te.user_coordinates=M.geometry.coordinates,this._eventEmitter.emit("result",{result:te})}else this._eventEmitter.emit("result",{result:{user_coordinates:M.geometry.coordinates}})}.bind(this))}.bind(this)).catch(function(P){P.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}.bind(this))},createIcon:function(P,M){var j=document.createElementNS("http://www.w3.org/2000/svg","svg");return j.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+P),j.setAttribute("viewBox","0 0 18 18"),j.setAttribute("xml:space","preserve"),j.setAttribute("width",18),j.setAttribute("height",18),j.innerHTML=M,j},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(P){this._inputEl.value=P,setTimeout(function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}.bind(this),1)},_onPaste:function(P){var M=(P.clipboardData||window.clipboardData).getData("text");M.length>=this.options.minLength&&this._geocode(M)},_onKeyDown:function(P){var M=27,j=9;if(P.keyCode===M&&this.options.clearAndBlurOnEsc)return this._clear(P),this._inputEl.blur();var K=P.target&&P.target.shadowRoot?P.target.shadowRoot.activeElement:P.target,te=K?K.value:"";if(!te)return this.fresh=!0,P.keyCode!==j&&this.clear(P),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(P.metaKey||[j,M,37,39,13,38,40].indexOf(P.keyCode)!==-1)&&K.value.length>=this.options.minLength&&this._geocode(K.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(P){this.options.clearOnBlur&&this._clearOnBlur(P),this.options.collapsed&&this._collapse()},_onChange:function(){var P=this._typeahead.selected;P&&JSON.stringify(P)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(P),this.options.marker&&this._mapboxgl&&this._handleMarker(P),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(P),this._eventEmitter.emit("result",{result:P}),this.eventManager.select(P,this))},_fly:function(P){var M;if(P.properties&&Gf[P.properties.short_code])M=gc({},this.options.flyTo),this._map&&this._map.fitBounds(Gf[P.properties.short_code].bbox,M);else if(P.bbox){var j=P.bbox;M=gc({},this.options.flyTo),this._map&&this._map.fitBounds([[j[0],j[1]],[j[2],j[3]]],M)}else{var K={zoom:this.options.zoom};M=gc({},K,this.options.flyTo),P.center?M.center=P.center:P.geometry&&P.geometry.type&&P.geometry.type==="Point"&&P.geometry.coordinates&&(M.center=P.geometry.coordinates),this._map&&this._map.flyTo(M)}},_requestType:function(P,M){var j;const K=/^[ ]*(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/;return P.localGeocoderOnly?j=Nu.LOCAL:P.reverseGeocode&&K.test(M)?j=Nu.REVERSE:j=Nu.FORWARD,j},_setupConfig:function(P,M){const j=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],K=/[\s,]+/;var te=this,Ae=j.reduce(function(x,he){if(te.options[he]===void 0||te.options[he]===null)return x;["countries","types","language"].indexOf(he)>-1?x[he]=te.options[he].split(K):x[he]=te.options[he];const it=typeof te.options[he].longitude=="number"&&typeof te.options[he].latitude=="number";if(he==="proximity"&&it){const Ke=te.options[he].longitude,Qe=te.options[he].latitude;x[he]=[Ke,Qe]}return x},{});switch(P){case Nu.REVERSE:{var y=M.split(K).map(function(x){return parseFloat(x,10)});te.options.flipCoordinates||y.reverse(),Ae.types&&Ae.types[0],Ae=gc(Ae,{query:y,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(x){x in Ae&&delete Ae[x]})}break;case Nu.FORWARD:/^[ ]*(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)*[ ]*$/.test(M)&&(M=M.replace(/,/g," ")),Ae=gc(Ae,{query:M});break}return Ae},_geocode:function(P){this.inputString=P,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:P});const M=this._requestType(this.options,P),j=this._setupConfig(M,P);var K;switch(M){case Nu.LOCAL:K=Promise.resolve();break;case Nu.FORWARD:K=this.geocoderService.forwardGeocode(j).send();break;case Nu.REVERSE:K=this.geocoderService.reverseGeocode(j).send();break}var te=this.options.localGeocoder?this.options.localGeocoder(P)||[]:[],Ae=[],y=null;return K.catch(function(x){y=x}.bind(this)).then(function(x){this._hideLoadingIcon();var he={};return x?x.statusCode=="200"&&(he=x.body,he.request=x.request,he.headers=x.headers):he={type:"FeatureCollection",features:[]},he.config=j,this.fresh&&(this.eventManager.start(this),this.fresh=!1),he.features=he.features?te.concat(he.features):te,this.options.externalGeocoder?(Ae=this.options.externalGeocoder(P,he.features)||Promise.resolve([]),Ae.then(function(it){return he.features=he.features?it.concat(he.features):it,he},function(){return he})):he}.bind(this)).then(function(x){if(y)throw y;this.options.filter&&x.features.length&&(x.features=x.features.filter(this.options.filter)),x.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",x),this._typeahead.update(x.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",x))}.bind(this)).catch(function(x){this._hideLoadingIcon(),this._hideAttribution(),te.length&&this.options.localGeocoder||Ae.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(te)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:te}),this._eventEmitter.emit("error",{error:x})}.bind(this)),K},_clear:function(P){P&&P.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(P){this._clear(P),this._inputEl.focus()},_clearOnBlur:function(P){var M=this;P.relatedTarget&&M._clear(P)},_onQueryResult:function(P){var M=P.body;if(!!M.features.length){var j=M.features[0];this._typeahead.selected=j,this._inputEl.value=j.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var P=this._map.getCenter().wrap();this.setProximity({longitude:P.lng,latitude:P.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(P){return this._geocode(P).then(this._onQueryResult),this},_renderError:function(){var P="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(P)},_renderLocationError:function(){var P="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(P)},_renderNoResults:function(){var P="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(P)},_renderUserDeniedGeolocationError:function(){var P="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(P)},_renderMessage:function(P){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(P)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var P=this.options.language.split(",")[0],M=B_.language(P),j=R_.placeholder[M];if(j)return j}return"Search"},setInput:function(P){return this._inputEl.value=P,this._typeahead.selected=null,this._typeahead.clear(),P.length>=this.options.minLength&&this._geocode(P),this},setProximity:function(P,M=!0){return this.options.proximity=P,M&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(P){return P&&typeof P=="function"&&(this._typeahead.render=P),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(P){var M=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=P||this.options.language||M,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(P){return this.options.zoom=P,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(P){return this.options.flyTo=P,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(P){return this.placeholder=P||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(P){return this.options.bbox=P,this},getCountries:function(){return this.options.countries},setCountries:function(P){return this.options.countries=P,this},getTypes:function(){return this.options.types},setTypes:function(P){return this.options.types=P,this},getMinLength:function(){return this.options.minLength},setMinLength:function(P){return this.options.minLength=P,this._typeahead&&(this._typeahead.options.minLength=P),this},getLimit:function(){return this.options.limit},setLimit:function(P){return this.options.limit=P,this._typeahead&&(this._typeahead.options.limit=P),this},getFilter:function(){return this.options.filter},setFilter:function(P){return this.options.filter=P,this},setOrigin:function(P){return this.options.origin=P,this.geocoderService=Od(Bd({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(P){return this.options.accessToken=P,this.geocoderService=Od(Bd({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(P){return this.options.autocomplete=P,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(P){return this.options.fuzzyMatch=P,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(P){return this.options.routing=P,this},getRouting:function(){return this.options.routing},setWorldview:function(P){return this.options.worldview=P,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(P){if(!!this._map){this._removeMarker();var M={color:"#4668F2"},j=gc({},M,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(j),P.center?this.mapMarker.setLngLat(P.center).addTo(this._map):P.geometry&&P.geometry.type&&P.geometry.type==="Point"&&P.geometry.coordinates&&this.mapMarker.setLngLat(P.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(P,M){return this._eventEmitter.on(P,M),this},off:function(P,M){return this._eventEmitter.removeListener(P,M),this.eventManager.remove(),this}};var V_=Gm,Zm={};Object.defineProperty(Zm,"__esModule",{value:!0});class ju{constructor(M,j){this.areas=M||ju.DEFAULT_AREAS,this.limit_no_areas=j||ju.DEFAULT_NO_AREAS,this.onDocumentClick=this.onDocumentClick.bind(this)}getDefaultPosition(){return"top-right"}onAdd(M){this.map=M;const j=this;if(this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("mapboxgl-ctrl"),this.controlContainer.classList.add("mapboxgl-ctrl-group"),this.areas.length<=this.limit_no_areas){this.mapAreaContainer=document.createElement("div"),this.areaButton=document.createElement("button"),this.mapAreaContainer.classList.add("mapboxgl-area-list");for(const K of this.areas){const te=document.createElement("button");te.innerText=K.title,te.classList.add(K.title.replace(/[^a-z0-9-]/gi,"_")),te.value=JSON.stringify({center:K.latlng,zoom:K.zoom}),te.addEventListener("click",Ae=>{const y=Ae.srcElement;this.map.jumpTo(JSON.parse(y.value)),this.mapAreaContainer.style.display="none",this.areaButton.style.display="block";const x=this.mapAreaContainer.getElementsByClassName("active");for(;x[0];)x[0].classList.remove("active");y.classList.add("active")}),K.title===ju.DEFAULT_AREA&&te.classList.add("active"),this.mapAreaContainer.appendChild(te)}this.areaButton.classList.add("mapboxgl-ctrl-icon"),this.areaButton.classList.add("mapboxgl-area-switcher"),this.areaButton.addEventListener("click",()=>{this.areaButton.style.display="none",this.mapAreaContainer.style.display="block"}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.areaButton),this.controlContainer.appendChild(this.mapAreaContainer)}else this.controlContainer.classList.add("mapboxgl-ctrl-area-switch"),this.select=document.createElement("select"),this.select.setAttribute("type","select"),this.select.addEventListener("change",function(K){!K.target||j.map.flyTo(JSON.parse(K.target[this.selectedIndex].value))}),this.controlContainer.appendChild(this.select),this.areas.forEach(function(K){var te=document.createElement("option");te.setAttribute("type","option"),te.text=K.title,te.value=JSON.stringify({center:K.latlng,zoom:K.zoom}),j.select.appendChild(te)});return this.controlContainer}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.areaButton||(this.areaButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.map=void 0)}onDocumentClick(M){this.controlContainer&&!this.controlContainer.contains(M.target)&&this.mapAreaContainer&&this.areaButton&&(this.mapAreaContainer.style.display="none",this.areaButton.style.display="block")}}var N_=Zm.default=ju;ju.DEFAULT_AREA="Narok";ju.DEFAULT_AREAS=[{title:"Narok",latlng:[35.86974,-1.08707],zoom:13},{title:"Nairobi",latlng:[36.8034,-1.2809],zoom:11},{title:"Mombasa",latlng:[39.65449,-4.05099],zoom:12}];ju.DEFAULT_NO_AREAS=5;var $m={},Qd={exports:{}};(function(P,M){(function(j,K){P.exports=K()})(Es,function(){var j,K,te;function Ae(y,x){if(!j)j=x;else if(!K)K=x;else{var he="var sharedChunk = {}; ("+j+")(sharedChunk); ("+K+")(sharedChunk);",it={};j(it),te=x(it),typeof window!="undefined"&&(te.workerUrl=window.URL.createObjectURL(new Blob([he],{type:"text/javascript"})))}}return Ae(["exports"],function(y){function x(e,r){return e(r={exports:{}},r.exports),r.exports}var he=it;function it(e,r,a,d){this.cx=3*e,this.bx=3*(a-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(d-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=d,this.p2x=a,this.p2y=d}it.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},it.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},it.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},it.prototype.solveCurveX=function(e,r){var a,d,g,E,i;for(r===void 0&&(r=1e-6),g=e,i=0;i<8;i++){if(E=this.sampleCurveX(g)-e,Math.abs(E)<r)return g;var t=this.sampleCurveDerivativeX(g);if(Math.abs(t)<1e-6)break;g-=E/t}if((g=e)<(a=0))return a;if(g>(d=1))return d;for(;a<d;){if(E=this.sampleCurveX(g),Math.abs(E-e)<r)return g;e>E?a=g:d=g,g=.5*(d-a)+a}return g},it.prototype.solve=function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))};var Ke=Qe;function Qe(e,r){this.x=e,this.y=r}Qe.prototype={clone:function(){return new Qe(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,r){return this.clone()._rotateAround(e,r)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var r=e.x-this.x,a=e.y-this.y;return r*r+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,r){return Math.atan2(this.x*r-this.y*e,this.x*e+this.y*r)},_matMult:function(e){var r=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=r,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var r=Math.cos(e),a=Math.sin(e),d=a*this.x+r*this.y;return this.x=r*this.x-a*this.y,this.y=d,this},_rotateAround:function(e,r){var a=Math.cos(e),d=Math.sin(e),g=r.y+d*(this.x-r.x)+a*(this.y-r.y);return this.x=r.x+a*(this.x-r.x)-d*(this.y-r.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Qe.convert=function(e){return e instanceof Qe?e:Array.isArray(e)?new Qe(e[0],e[1]):e};var Se=typeof self!="undefined"?self:{},It=Math.pow(2,53)-1;function yt(e,r,a,d){var g=new he(e,r,a,d);return function(E){return g.solve(E)}}var ti=yt(.25,.1,.25,1);function zt(e,r,a){return Math.min(a,Math.max(r,e))}function Ei(e,r,a){var d=a-r,g=((e-r)%d+d)%d+r;return g===r?a:g}function mi(e){for(var r=[],a=arguments.length-1;a-- >0;)r[a]=arguments[a+1];for(var d=0,g=r;d<g.length;d+=1){var E=g[d];for(var i in E)e[i]=E[i]}return e}var Ht=1;function br(){return Ht++}function pi(){return function e(r){return r?(r^16*Math.random()>>r/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function Si(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function Ni(e,r){e.forEach(function(a){r[a]&&(r[a]=r[a].bind(r))})}function Lr(e,r){return e.indexOf(r,e.length-r.length)!==-1}function lr(e,r,a){var d={};for(var g in e)d[g]=r.call(a||this,e[g],g,e);return d}function Fn(e,r,a){var d={};for(var g in e)r.call(a||this,e[g],g,e)&&(d[g]=e[g]);return d}function hn(e){return Array.isArray(e)?e.map(hn):typeof e=="object"&&e?lr(e,hn):e}var no={};function nr(e){no[e]||(typeof console!="undefined"&&console.warn(e),no[e]=!0)}function Ar(e,r,a){return(a.y-e.y)*(r.x-e.x)>(r.y-e.y)*(a.x-e.x)}function Fo(e){for(var r=0,a=0,d=e.length,g=d-1,E=void 0,i=void 0;a<d;g=a++)r+=((i=e[g]).x-(E=e[a]).x)*(E.y+i.y);return r}function Yt(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Un(e){var r={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(d,g,E,i){var t=E||i;return r[g]=!t||t.toLowerCase(),""}),r["max-age"]){var a=parseInt(r["max-age"],10);isNaN(a)?delete r["max-age"]:r["max-age"]=a}return r}var oo=null;function Co(e){if(oo==null){var r=e.navigator?e.navigator.userAgent:null;oo=!!e.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return oo}function rn(e){try{var r=Se[e];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch{return!1}}var pn,bn,kn,Vn,Nn=Se.performance&&Se.performance.now?Se.performance.now.bind(Se.performance):Date.now.bind(Date),ao=Se.requestAnimationFrame||Se.mozRequestAnimationFrame||Se.webkitRequestAnimationFrame||Se.msRequestAnimationFrame,_r=Se.cancelAnimationFrame||Se.mozCancelAnimationFrame||Se.webkitCancelAnimationFrame||Se.msCancelAnimationFrame,dn={now:Nn,frame:function(e){var r=ao(e);return{cancel:function(){return _r(r)}}},getImageData:function(e,r){r===void 0&&(r=0);var a=Se.document.createElement("canvas"),d=a.getContext("2d");if(!d)throw new Error("failed to create canvas 2d context");return a.width=e.width,a.height=e.height,d.drawImage(e,0,0,e.width,e.height),d.getImageData(-r,-r,e.width+2*r,e.height+2*r)},resolveURL:function(e){return pn||(pn=Se.document.createElement("a")),pn.href=e,pn.href},hardwareConcurrency:Se.navigator&&Se.navigator.hardwareConcurrency||4,get devicePixelRatio(){return Se.devicePixelRatio},get prefersReducedMotion(){return!!Se.matchMedia&&(bn==null&&(bn=Se.matchMedia("(prefers-reduced-motion: reduce)")),bn.matches)}},Bi={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},so={supported:!1,testSupport:function(e){!Uo&&Vn&&(jn?ii(e):kn=e)}},Uo=!1,jn=!1;function ii(e){var r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,Vn),e.isContextLost())return;so.supported=!0}catch{}e.deleteTexture(r),Uo=!0}Se.document&&((Vn=Se.document.createElement("img")).onload=function(){kn&&ii(kn),kn=null,jn=!0},Vn.onerror=function(){Uo=!0,kn=null},Vn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Mn="01",Gr=function(e,r){this._transformRequestFn=e,this._customAccessToken=r,this._createSkuToken()};function nn(e){return e.indexOf("mapbox:")===0}Gr.prototype._createSkuToken=function(){var e=function(){for(var r="",a=0;a<10;a++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Mn,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt},Gr.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Gr.prototype.transformRequest=function(e,r){return this._transformRequestFn&&this._transformRequestFn(e,r)||{url:e}},Gr.prototype.normalizeStyleURL=function(e,r){if(!nn(e))return e;var a=Dr(e);return a.path="/styles/v1"+a.path,this._makeAPIURL(a,this._customAccessToken||r)},Gr.prototype.normalizeGlyphsURL=function(e,r){if(!nn(e))return e;var a=Dr(e);return a.path="/fonts/v1"+a.path,this._makeAPIURL(a,this._customAccessToken||r)},Gr.prototype.normalizeSourceURL=function(e,r){if(!nn(e))return e;var a=Dr(e);return a.path="/v4/"+a.authority+".json",a.params.push("secure"),this._makeAPIURL(a,this._customAccessToken||r)},Gr.prototype.normalizeSpriteURL=function(e,r,a,d){var g=Dr(e);return nn(e)?(g.path="/styles/v1"+g.path+"/sprite"+r+a,this._makeAPIURL(g,this._customAccessToken||d)):(g.path+=""+r+a,wn(g))},Gr.prototype.normalizeTileURL=function(e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!nn(e))return e;var a=Dr(e);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,(dn.devicePixelRatio>=2||r===512?"@2x":"")+(so.supported?".webp":"$1")),a.path=a.path.replace(/^.+\/v4\//,"/"),a.path="/v4"+a.path;var d=this._customAccessToken||function(g){for(var E=0,i=g;E<i.length;E+=1){var t=i[E].match(/^access_token=(.*)$/);if(t)return t[1]}return null}(a.params)||Bi.ACCESS_TOKEN;return Bi.REQUIRE_ACCESS_TOKEN&&d&&this._skuToken&&a.params.push("sku="+this._skuToken),this._makeAPIURL(a,d)},Gr.prototype.canonicalizeTileURL=function(e,r){var a=Dr(e);if(!a.path.match(/(^\/v4\/)/)||!a.path.match(/\.[\w]+$/))return e;var d="mapbox://tiles/";d+=a.path.replace("/v4/","");var g=a.params;return r&&(g=g.filter(function(E){return!E.match(/^access_token=/)})),g.length&&(d+="?"+g.join("&")),d},Gr.prototype.canonicalizeTileset=function(e,r){for(var a=!!r&&nn(r),d=[],g=0,E=e.tiles||[];g<E.length;g+=1){var i=E[g];qn(i)?d.push(this.canonicalizeTileURL(i,a)):d.push(i)}return d},Gr.prototype._makeAPIURL=function(e,r){var a="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",d=Dr(Bi.API_URL);if(e.protocol=d.protocol,e.authority=d.authority,e.protocol==="http"){var g=e.params.indexOf("secure");g>=0&&e.params.splice(g,1)}if(d.path!=="/"&&(e.path=""+d.path+e.path),!Bi.REQUIRE_ACCESS_TOKEN)return wn(e);if(!(r=r||Bi.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+a);if(r[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+a);return e.params=e.params.filter(function(E){return E.indexOf("access_token")===-1}),e.params.push("access_token="+r),wn(e)};var vo=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function qn(e){return vo.test(e)}var lo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Dr(e){var r=e.match(lo);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function wn(e){var r=e.params.length?"?"+e.params.join("&"):"";return e.protocol+"://"+e.authority+e.path+r}function Vo(e){if(!e)return null;var r=e.split(".");if(!r||r.length!==3)return null;try{return JSON.parse(decodeURIComponent(Se.atob(r[1]).split("").map(function(a){return"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch{return null}}var yi=function(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};yi.prototype.getStorageKey=function(e){var r,a=Vo(Bi.ACCESS_TOKEN);return r=a&&a.u?Se.btoa(encodeURIComponent(a.u).replace(/%([0-9A-F]{2})/g,function(d,g){return String.fromCharCode(Number("0x"+g))})):Bi.ACCESS_TOKEN||"",e?"mapbox.eventData."+e+":"+r:"mapbox.eventData:"+r},yi.prototype.fetchEventData=function(){var e=rn("localStorage"),r=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{var d=Se.localStorage.getItem(r);d&&(this.eventData=JSON.parse(d));var g=Se.localStorage.getItem(a);g&&(this.anonId=g)}catch{nr("Unable to read from LocalStorage")}},yi.prototype.saveEventData=function(){var e=rn("localStorage"),r=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{Se.localStorage.setItem(a,this.anonId),Object.keys(this.eventData).length>=1&&Se.localStorage.setItem(r,JSON.stringify(this.eventData))}catch{nr("Unable to write to LocalStorage")}},yi.prototype.processRequests=function(e){},yi.prototype.postEvent=function(e,r,a,d){var g=this;if(Bi.EVENTS_URL){var E=Dr(Bi.EVENTS_URL);E.params.push("access_token="+(d||Bi.ACCESS_TOKEN||""));var i={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:Mn,userId:this.anonId},t=r?mi(i,r):i,o={url:wn(E),headers:{"Content-Type":"text/plain"},body:JSON.stringify([t])};this.pendingRequest=Ji(o,function(l){g.pendingRequest=null,a(l),g.saveEventData(),g.processRequests(d)})}},yi.prototype.queueRequest=function(e,r){this.queue.push(e),this.processRequests(r)};var on,Gn,fn=function(e){function r(){e.call(this,"map.load"),this.success={},this.skuToken=""}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.postMapLoadEvent=function(a,d,g,E){this.skuToken=g,(Bi.EVENTS_URL&&E||Bi.ACCESS_TOKEN&&Array.isArray(a)&&a.some(function(i){return nn(i)||qn(i)}))&&this.queueRequest({id:d,timestamp:Date.now()},E)},r.prototype.processRequests=function(a){var d=this;if(!this.pendingRequest&&this.queue.length!==0){var g=this.queue.shift(),E=g.id,i=g.timestamp;E&&this.success[E]||(this.anonId||this.fetchEventData(),Si(this.anonId)||(this.anonId=pi()),this.postEvent(i,{skuToken:this.skuToken},function(t){t||E&&(d.success[E]=!0)},a))}},r}(yi),xa=new(function(e){function r(a){e.call(this,"appUserTurnstile"),this._customAccessToken=a}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.postTurnstileEvent=function(a,d){Bi.EVENTS_URL&&Bi.ACCESS_TOKEN&&Array.isArray(a)&&a.some(function(g){return nn(g)||qn(g)})&&this.queueRequest(Date.now(),d)},r.prototype.processRequests=function(a){var d=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var g=Vo(Bi.ACCESS_TOKEN),E=g?g.u:Bi.ACCESS_TOKEN,i=E!==this.eventData.tokenU;Si(this.anonId)||(this.anonId=pi(),i=!0);var t=this.queue.shift();if(this.eventData.lastSuccess){var o=new Date(this.eventData.lastSuccess),l=new Date(t),p=(t-this.eventData.lastSuccess)/864e5;i=i||p>=1||p<-1||o.getDate()!==l.getDate()}else i=!0;if(!i)return this.processRequests();this.postEvent(t,{"enabled.telemetry":!1},function(m){m||(d.eventData.lastSuccess=t,d.eventData.tokenU=E)},a)}},r}(yi)),ot=xa.postTurnstileEvent.bind(xa),Lt=new fn,zo=Lt.postMapLoadEvent.bind(Lt),Zn=500,Ki=50;function mn(){Se.caches&&!on&&(on=Se.caches.open("mapbox-tiles"))}function Zr(e){var r=e.indexOf("?");return r<0?e:e.slice(0,r)}var uo,er=1/0;function Ct(){return uo==null&&(uo=Se.OffscreenCanvas&&new Se.OffscreenCanvas(1,1).getContext("2d")&&typeof Se.createImageBitmap=="function"),uo}var Ti={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Ti);var gi=function(e){function r(a,d,g){d===401&&qn(g)&&(a+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),e.call(this,a),this.status=d,this.url=g,this.name=this.constructor.name,this.message=a}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},r}(Error),Rr=Yt()?function(){return self.worker&&self.worker.referrer}:function(){return(Se.location.protocol==="blob:"?Se.parent:Se).location.href},$r,ui,xo=function(e,r){if(!(/^file:/.test(a=e.url)||/^file:/.test(Rr())&&!/^\w+:/.test(a))){if(Se.fetch&&Se.Request&&Se.AbortController&&Se.Request.prototype.hasOwnProperty("signal"))return function(d,g){var E,i=new Se.AbortController,t=new Se.Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,referrer:Rr(),signal:i.signal}),o=!1,l=!1,p=(E=t.url).indexOf("sku=")>0&&qn(E);d.type==="json"&&t.headers.set("Accept","application/json");var m=function(T,C,k){if(!l){if(T&&T.message!=="SecurityError"&&nr(T),C&&k)return _(C);var R=Date.now();Se.fetch(t).then(function(D){if(D.ok){var V=p?D.clone():null;return _(D,V,R)}return g(new gi(D.statusText,D.status,d.url))}).catch(function(D){D.code!==20&&g(new Error(D.message))})}},_=function(T,C,k){(d.type==="arrayBuffer"?T.arrayBuffer():d.type==="json"?T.json():T.text()).then(function(R){l||(C&&k&&function(D,V,G){if(mn(),on){var Z={status:V.status,statusText:V.statusText,headers:new Se.Headers};V.headers.forEach(function(ae,we){return Z.headers.set(we,ae)});var ee=Un(V.headers.get("Cache-Control")||"");ee["no-store"]||(ee["max-age"]&&Z.headers.set("Expires",new Date(G+1e3*ee["max-age"]).toUTCString()),new Date(Z.headers.get("Expires")).getTime()-G<42e4||function(ae,we){if(Gn===void 0)try{new Response(new ReadableStream),Gn=!0}catch{Gn=!1}Gn?we(ae.body):ae.blob().then(we)}(V,function(ae){var we=new Se.Response(ae,Z);mn(),on&&on.then(function(ke){return ke.put(Zr(D.url),we)}).catch(function(ke){return nr(ke.message)})}))}}(t,C,k),o=!0,g(null,R,T.headers.get("Cache-Control"),T.headers.get("Expires")))}).catch(function(R){l||g(new Error(R.message))})};return p?function(T,C){if(mn(),!on)return C(null);var k=Zr(T.url);on.then(function(R){R.match(k).then(function(D){var V=function(G){if(!G)return!1;var Z=new Date(G.headers.get("Expires")||0),ee=Un(G.headers.get("Cache-Control")||"");return Z>Date.now()&&!ee["no-cache"]}(D);R.delete(k),V&&R.put(k,D.clone()),C(null,D,V)}).catch(C)}).catch(C)}(t,m):m(null,null),{cancel:function(){l=!0,o||i.abort()}}}(e,r);if(Yt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,r,void 0,!0)}var a;return function(d,g){var E=new Se.XMLHttpRequest;for(var i in E.open(d.method||"GET",d.url,!0),d.type==="arrayBuffer"&&(E.responseType="arraybuffer"),d.headers)E.setRequestHeader(i,d.headers[i]);return d.type==="json"&&(E.responseType="text",E.setRequestHeader("Accept","application/json")),E.withCredentials=d.credentials==="include",E.onerror=function(){g(new Error(E.statusText))},E.onload=function(){if((E.status>=200&&E.status<300||E.status===0)&&E.response!==null){var t=E.response;if(d.type==="json")try{t=JSON.parse(E.response)}catch(o){return g(o)}g(null,t,E.getResponseHeader("Cache-Control"),E.getResponseHeader("Expires"))}else g(new gi(E.statusText,E.status,d.url))},E.send(d.body),{cancel:function(){return E.abort()}}}(e,r)},Ln=function(e,r){return xo(mi(e,{type:"arrayBuffer"}),r)},Ji=function(e,r){return xo(mi(e,{method:"POST"}),r)},X="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";$r=[],ui=0;var Y=function(e,r){if(so.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),ui>=Bi.MAX_PARALLEL_IMAGE_REQUESTS){var a={requestParameters:e,callback:r,cancelled:!1,cancel:function(){this.cancelled=!0}};return $r.push(a),a}ui++;var d=!1,g=function(){if(!d)for(d=!0,ui--;$r.length&&ui<Bi.MAX_PARALLEL_IMAGE_REQUESTS;){var i=$r.shift();i.cancelled||(i.cancel=Y(i.requestParameters,i.callback).cancel)}},E=Ln(e,function(i,t,o,l){g(),i?r(i):t&&(Ct()?function(p,m){var _=new Se.Blob([new Uint8Array(p)],{type:"image/png"});Se.createImageBitmap(_).then(function(T){m(null,T)}).catch(function(T){m(new Error("Could not load image because of "+T.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(t,r):function(p,m,_,T){var C=new Se.Image,k=Se.URL;C.onload=function(){m(null,C),k.revokeObjectURL(C.src),C.onload=null,Se.requestAnimationFrame(function(){C.src=X})},C.onerror=function(){return m(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var R=new Se.Blob([new Uint8Array(p)],{type:"image/png"});C.cacheControl=_,C.expires=T,C.src=p.byteLength?k.createObjectURL(R):X}(t,r,o,l))});return{cancel:function(){E.cancel(),g()}}};function ie(e,r,a){a[e]&&a[e].indexOf(r)!==-1||(a[e]=a[e]||[],a[e].push(r))}function pe(e,r,a){if(a&&a[e]){var d=a[e].indexOf(r);d!==-1&&a[e].splice(d,1)}}var xe=function(e,r){r===void 0&&(r={}),mi(this,r),this.type=e},Me=function(e){function r(a,d){d===void 0&&(d={}),e.call(this,"error",mi({error:a},d))}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r}(xe),De=function(){};De.prototype.on=function(e,r){return this._listeners=this._listeners||{},ie(e,r,this._listeners),this},De.prototype.off=function(e,r){return pe(e,r,this._listeners),pe(e,r,this._oneTimeListeners),this},De.prototype.once=function(e,r){return this._oneTimeListeners=this._oneTimeListeners||{},ie(e,r,this._oneTimeListeners),this},De.prototype.fire=function(e,r){typeof e=="string"&&(e=new xe(e,r||{}));var a=e.type;if(this.listens(a)){e.target=this;for(var d=0,g=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];d<g.length;d+=1)g[d].call(this,e);for(var E=0,i=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];E<i.length;E+=1){var t=i[E];pe(a,t,this._oneTimeListeners),t.call(this,e)}var o=this._eventedParent;o&&(mi(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),o.fire(e))}else e instanceof Me&&console.error(e.error);return this},De.prototype.listens=function(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)},De.prototype.setEventedParent=function(e,r){return this._eventedParent=e,this._eventedParentData=r,this};var ce={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Ie=function(e,r,a,d){this.message=(e?e+": ":"")+a,d&&(this.identifier=d),r!=null&&r.__line__&&(this.line=r.__line__)};function qe(e){var r=e.value;return r?[new Ie(e.key,r,"constants have been deprecated as of v8")]:[]}function Q(e){for(var r=[],a=arguments.length-1;a-- >0;)r[a]=arguments[a+1];for(var d=0,g=r;d<g.length;d+=1){var E=g[d];for(var i in E)e[i]=E[i]}return e}function F(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function U(e){if(Array.isArray(e))return e.map(U);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){var r={};for(var a in e)r[a]=U(e[a]);return r}return F(e)}var J=function(e){function r(a,d){e.call(this,d),this.message=d,this.key=a}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r}(Error),ne=function(e,r){r===void 0&&(r=[]),this.parent=e,this.bindings={};for(var a=0,d=r;a<d.length;a+=1){var g=d[a];this.bindings[g[0]]=g[1]}};ne.prototype.concat=function(e){return new ne(this,e)},ne.prototype.get=function(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(e+" not found in scope.")},ne.prototype.has=function(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)};var de={kind:"null"},le={kind:"number"},_e={kind:"string"},ge={kind:"boolean"},ve={kind:"color"},Ge={kind:"object"},Ue={kind:"value"},Ze={kind:"collator"},bt={kind:"formatted"},pt={kind:"resolvedImage"};function vt(e,r){return{kind:"array",itemType:e,N:r}}function Et(e){if(e.kind==="array"){var r=Et(e.itemType);return typeof e.N=="number"?"array<"+r+", "+e.N+">":e.itemType.kind==="value"?"array":"array<"+r+">"}return e.kind}var di=[de,le,_e,ge,ve,bt,Ge,vt(Ue),pt];function $t(e,r){if(r.kind==="error")return null;if(e.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!$t(e.itemType,r.itemType))&&(typeof e.N!="number"||e.N===r.N))return null}else{if(e.kind===r.kind)return null;if(e.kind==="value"){for(var a=0,d=di;a<d.length;a+=1)if(!$t(d[a],r))return null}}return"Expected "+Et(e)+" but found "+Et(r)+" instead."}function Jt(e,r){return r.some(function(a){return a.kind===e.kind})}function Nt(e,r){return r.some(function(a){return a==="null"?e===null:a==="array"?Array.isArray(e):a==="object"?e&&!Array.isArray(e)&&typeof e=="object":a===typeof e})}var Pt=x(function(e,r){var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function d(t){return(t=Math.round(t))<0?0:t>255?255:t}function g(t){return d(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function E(t){return(o=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:o>1?1:o;var o}function i(t,o,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?t+(o-t)*l*6:2*l<1?o:3*l<2?t+(o-t)*(2/3-l)*6:t}try{r.parseCSSColor=function(t){var o,l=t.replace(/ /g,"").toLowerCase();if(l in a)return a[l].slice();if(l[0]==="#")return l.length===4?(o=parseInt(l.substr(1),16))>=0&&o<=4095?[(3840&o)>>4|(3840&o)>>8,240&o|(240&o)>>4,15&o|(15&o)<<4,1]:null:l.length===7&&(o=parseInt(l.substr(1),16))>=0&&o<=16777215?[(16711680&o)>>16,(65280&o)>>8,255&o,1]:null;var p=l.indexOf("("),m=l.indexOf(")");if(p!==-1&&m+1===l.length){var _=l.substr(0,p),T=l.substr(p+1,m-(p+1)).split(","),C=1;switch(_){case"rgba":if(T.length!==4)return null;C=E(T.pop());case"rgb":return T.length!==3?null:[g(T[0]),g(T[1]),g(T[2]),C];case"hsla":if(T.length!==4)return null;C=E(T.pop());case"hsl":if(T.length!==3)return null;var k=(parseFloat(T[0])%360+360)%360/360,R=E(T[1]),D=E(T[2]),V=D<=.5?D*(R+1):D+R-D*R,G=2*D-V;return[d(255*i(G,V,k+1/3)),d(255*i(G,V,k)),d(255*i(G,V,k-1/3)),C];default:return null}}return null}}catch{}}).parseCSSColor,oi=function(e,r,a,d){d===void 0&&(d=1),this.r=e,this.g=r,this.b=a,this.a=d};oi.parse=function(e){if(e){if(e instanceof oi)return e;if(typeof e=="string"){var r=Pt(e);if(r)return new oi(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3])}}},oi.prototype.toString=function(){var e=this.toArray(),r=e[1],a=e[2],d=e[3];return"rgba("+Math.round(e[0])+","+Math.round(r)+","+Math.round(a)+","+d+")"},oi.prototype.toArray=function(){var e=this.a;return e===0?[0,0,0,0]:[255*this.r/e,255*this.g/e,255*this.b/e,e]},oi.black=new oi(0,0,0,1),oi.white=new oi(1,1,1,1),oi.transparent=new oi(0,0,0,0),oi.red=new oi(1,0,0,1);var Oi=function(e,r,a){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Oi.prototype.compare=function(e,r){return this.collator.compare(e,r)},Oi.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Cr=function(e,r,a,d,g){this.text=e,this.image=r,this.scale=a,this.fontStack=d,this.textColor=g},Fi=function(e){this.sections=e};Fi.fromString=function(e){return new Fi([new Cr(e,null,null,null,null)])},Fi.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(e){return e.text.length!==0||e.image&&e.image.name.length!==0})},Fi.factory=function(e){return e instanceof Fi?e:Fi.fromString(e)},Fi.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(e){return e.text}).join("")},Fi.prototype.serialize=function(){for(var e=["format"],r=0,a=this.sections;r<a.length;r+=1){var d=a[r];if(d.image)e.push(["image",d.image.name]);else{e.push(d.text);var g={};d.fontStack&&(g["text-font"]=["literal",d.fontStack.split(",")]),d.scale&&(g["font-scale"]=d.scale),d.textColor&&(g["text-color"]=["rgba"].concat(d.textColor.toArray())),e.push(g)}}return e};var yn=function(e){this.name=e.name,this.available=e.available};function Ss(e,r,a,d){return typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof a=="number"&&a>=0&&a<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:"Invalid rgba value ["+[e,r,a,d].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof d=="number"?[e,r,a,d]:[e,r,a]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function $i(e){if(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||e instanceof oi||e instanceof Oi||e instanceof Fi||e instanceof yn)return!0;if(Array.isArray(e)){for(var r=0,a=e;r<a.length;r+=1)if(!$i(a[r]))return!1;return!0}if(typeof e=="object"){for(var d in e)if(!$i(e[d]))return!1;return!0}return!1}function wr(e){if(e===null)return de;if(typeof e=="string")return _e;if(typeof e=="boolean")return ge;if(typeof e=="number")return le;if(e instanceof oi)return ve;if(e instanceof Oi)return Ze;if(e instanceof Fi)return bt;if(e instanceof yn)return pt;if(Array.isArray(e)){for(var r,a=e.length,d=0,g=e;d<g.length;d+=1){var E=wr(g[d]);if(r){if(r===E)continue;r=Ue;break}r=E}return vt(r||Ue,a)}return Ge}function Ua(e){var r=typeof e;return e===null?"":r==="string"||r==="number"||r==="boolean"?String(e):e instanceof oi||e instanceof Fi||e instanceof yn?e.toString():JSON.stringify(e)}yn.prototype.toString=function(){return this.name},yn.fromString=function(e){return e?new yn({name:e,available:!1}):null},yn.prototype.serialize=function(){return["image",this.name]};var En=function(e,r){this.type=e,this.value=r};En.parse=function(e,r){if(e.length!==2)return r.error("'literal' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(!$i(e[1]))return r.error("invalid value");var a=e[1],d=wr(a),g=r.expectedType;return d.kind!=="array"||d.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(d=g),new En(d,a)},En.prototype.evaluate=function(){return this.value},En.prototype.eachChild=function(){},En.prototype.outputDefined=function(){return!0},En.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof oi?["rgba"].concat(this.value.toArray()):this.value instanceof Fi?this.value.serialize():this.value};var Br=function(e){this.name="ExpressionEvaluationError",this.message=e};Br.prototype.toJSON=function(){return this.message};var co={string:_e,number:le,boolean:ge,object:Ge},tr=function(e,r){this.type=e,this.args=r};tr.parse=function(e,r){if(e.length<2)return r.error("Expected at least one argument.");var a,d=1,g=e[0];if(g==="array"){var E,i;if(e.length>2){var t=e[1];if(typeof t!="string"||!(t in co)||t==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);E=co[t],d++}else E=Ue;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);i=e[2],d++}a=vt(E,i)}else a=co[g];for(var o=[];d<e.length;d++){var l=r.parse(e[d],d,Ue);if(!l)return null;o.push(l)}return new tr(a,o)},tr.prototype.evaluate=function(e){for(var r=0;r<this.args.length;r++){var a=this.args[r].evaluate(e);if(!$t(this.type,wr(a)))return a;if(r===this.args.length-1)throw new Br("Expected value to be of type "+Et(this.type)+", but found "+Et(wr(a))+" instead.")}return null},tr.prototype.eachChild=function(e){this.args.forEach(e)},tr.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},tr.prototype.serialize=function(){var e=this.type,r=[e.kind];if(e.kind==="array"){var a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){r.push(a.kind);var d=e.N;(typeof d=="number"||this.args.length>1)&&r.push(d)}}return r.concat(this.args.map(function(g){return g.serialize()}))};var ho=function(e){this.type=bt,this.sections=e};ho.parse=function(e,r){if(e.length<2)return r.error("Expected at least one argument.");var a=e[1];if(!Array.isArray(a)&&typeof a=="object")return r.error("First argument must be an image or text section.");for(var d=[],g=!1,E=1;E<=e.length-1;++E){var i=e[E];if(g&&typeof i=="object"&&!Array.isArray(i)){g=!1;var t=null;if(i["font-scale"]&&!(t=r.parse(i["font-scale"],1,le)))return null;var o=null;if(i["text-font"]&&!(o=r.parse(i["text-font"],1,vt(_e))))return null;var l=null;if(i["text-color"]&&!(l=r.parse(i["text-color"],1,ve)))return null;var p=d[d.length-1];p.scale=t,p.font=o,p.textColor=l}else{var m=r.parse(e[E],1,Ue);if(!m)return null;var _=m.type.kind;if(_!=="string"&&_!=="value"&&_!=="null"&&_!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,d.push({content:m,scale:null,font:null,textColor:null})}}return new ho(d)},ho.prototype.evaluate=function(e){return new Fi(this.sections.map(function(r){var a=r.content.evaluate(e);return wr(a)===pt?new Cr("",a,null,null,null):new Cr(Ua(a),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))},ho.prototype.eachChild=function(e){for(var r=0,a=this.sections;r<a.length;r+=1){var d=a[r];e(d.content),d.scale&&e(d.scale),d.font&&e(d.font),d.textColor&&e(d.textColor)}},ho.prototype.outputDefined=function(){return!1},ho.prototype.serialize=function(){for(var e=["format"],r=0,a=this.sections;r<a.length;r+=1){var d=a[r];e.push(d.content.serialize());var g={};d.scale&&(g["font-scale"]=d.scale.serialize()),d.font&&(g["text-font"]=d.font.serialize()),d.textColor&&(g["text-color"]=d.textColor.serialize()),e.push(g)}return e};var Dn=function(e){this.type=pt,this.input=e};Dn.parse=function(e,r){if(e.length!==2)return r.error("Expected two arguments.");var a=r.parse(e[1],1,_e);return a?new Dn(a):r.error("No image name provided.")},Dn.prototype.evaluate=function(e){var r=this.input.evaluate(e),a=yn.fromString(r);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(r)>-1),a},Dn.prototype.eachChild=function(e){e(this.input)},Dn.prototype.outputDefined=function(){return!1},Dn.prototype.serialize=function(){return["image",this.input.serialize()]};var Rl={"to-boolean":ge,"to-color":ve,"to-number":le,"to-string":_e},po=function(e,r){this.type=e,this.args=r};po.parse=function(e,r){if(e.length<2)return r.error("Expected at least one argument.");var a=e[0];if((a==="to-boolean"||a==="to-string")&&e.length!==2)return r.error("Expected one argument.");for(var d=Rl[a],g=[],E=1;E<e.length;E++){var i=r.parse(e[E],E,Ue);if(!i)return null;g.push(i)}return new po(d,g)},po.prototype.evaluate=function(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){for(var r,a,d=0,g=this.args;d<g.length;d+=1){if(a=null,(r=g[d].evaluate(e))instanceof oi)return r;if(typeof r=="string"){var E=e.parseColor(r);if(E)return E}else if(Array.isArray(r)&&!(a=r.length<3||r.length>4?"Invalid rbga value "+JSON.stringify(r)+": expected an array containing either three or four numeric values.":Ss(r[0],r[1],r[2],r[3])))return new oi(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Br(a||"Could not parse color from value '"+(typeof r=="string"?r:String(JSON.stringify(r)))+"'")}if(this.type.kind==="number"){for(var i=null,t=0,o=this.args;t<o.length;t+=1){if((i=o[t].evaluate(e))===null)return 0;var l=Number(i);if(!isNaN(l))return l}throw new Br("Could not convert "+JSON.stringify(i)+" to number.")}return this.type.kind==="formatted"?Fi.fromString(Ua(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?yn.fromString(Ua(this.args[0].evaluate(e))):Ua(this.args[0].evaluate(e))},po.prototype.eachChild=function(e){this.args.forEach(e)},po.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},po.prototype.serialize=function(){if(this.type.kind==="formatted")return new ho([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Dn(this.args[0]).serialize();var e=["to-"+this.type.kind];return this.eachChild(function(r){e.push(r.serialize())}),e};var Va=["Unknown","Point","LineString","Polygon"],bo=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};bo.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},bo.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Va[this.feature.type]:this.feature.type:null},bo.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},bo.prototype.canonicalID=function(){return this.canonical},bo.prototype.properties=function(){return this.feature&&this.feature.properties||{}},bo.prototype.parseColor=function(e){var r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=oi.parse(e)),r};var Er=function(e,r,a,d){this.name=e,this.type=r,this._evaluate=a,this.args=d};Er.prototype.evaluate=function(e){return this._evaluate(e,this.args)},Er.prototype.eachChild=function(e){this.args.forEach(e)},Er.prototype.outputDefined=function(){return!1},Er.prototype.serialize=function(){return[this.name].concat(this.args.map(function(e){return e.serialize()}))},Er.parse=function(e,r){var a,d=e[0],g=Er.definitions[d];if(!g)return r.error('Unknown expression "'+d+'". If you wanted a literal array, use ["literal", [...]].',0);for(var E=Array.isArray(g)?g[0]:g.type,i=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,t=i.filter(function($e){var Oe=$e[0];return!Array.isArray(Oe)||Oe.length===e.length-1}),o=null,l=0,p=t;l<p.length;l+=1){var m=p[l],_=m[0],T=m[1];o=new wa(r.registry,r.path,null,r.scope);for(var C=[],k=!1,R=1;R<e.length;R++){var D=e[R],V=Array.isArray(_)?_[R-1]:_.type,G=o.parse(D,1+C.length,V);if(!G){k=!0;break}C.push(G)}if(!k)if(Array.isArray(_)&&_.length!==C.length)o.error("Expected "+_.length+" arguments, but found "+C.length+" instead.");else{for(var Z=0;Z<C.length;Z++){var ee=Array.isArray(_)?_[Z]:_.type,ae=C[Z];o.concat(Z+1).checkSubtype(ee,ae.type)}if(o.errors.length===0)return new Er(d,E,T,C)}}if(t.length===1)(a=r.errors).push.apply(a,o.errors);else{for(var we=(t.length?t:i).map(function($e){var Oe;return Oe=$e[0],Array.isArray(Oe)?"("+Oe.map(Et).join(", ")+")":"("+Et(Oe.type)+"...)"}).join(" | "),ke=[],Re=1;Re<e.length;Re++){var Be=r.parse(e[Re],1+ke.length);if(!Be)return null;ke.push(Et(Be.type))}r.error("Expected arguments of type "+we+", but found ("+ke.join(", ")+") instead.")}return null},Er.register=function(e,r){for(var a in Er.definitions=r,r)e[a]=Er};var $n=function(e,r,a){this.type=Ze,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=r};function Xr(e,r){e[0]=Math.min(e[0],r[0]),e[1]=Math.min(e[1],r[1]),e[2]=Math.max(e[2],r[0]),e[3]=Math.max(e[3],r[1])}function No(e,r){return!(e[0]<=r[0]||e[2]>=r[2]||e[1]<=r[1]||e[3]>=r[3])}function Ts(e,r){var a=(180+e[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,g=Math.pow(2,r.z);return[Math.round(a*g*8192),Math.round(d*g*8192)]}function ol(e,r,a){return r[1]>e[1]!=a[1]>e[1]&&e[0]<(a[0]-r[0])*(e[1]-r[1])/(a[1]-r[1])+r[0]}function Na(e,r){for(var a,d,g,E,i,t,o,l=!1,p=0,m=r.length;p<m;p++)for(var _=r[p],T=0,C=_.length;T<C-1;T++){if((E=(a=e)[0]-(d=_[T])[0])*(o=a[1]-(g=_[T+1])[1])-(t=a[0]-g[0])*(i=a[1]-d[1])==0&&E*t<=0&&i*o<=0)return!1;ol(e,_[T],_[T+1])&&(l=!l)}return l}function Vr(e,r){for(var a=0;a<r.length;a++)if(Na(e,r[a]))return!0;return!1}function os(e,r,a,d){var g=d[0]-a[0],E=d[1]-a[1],i=(e[0]-a[0])*E-g*(e[1]-a[1]),t=(r[0]-a[0])*E-g*(r[1]-a[1]);return i>0&&t<0||i<0&&t>0}function Bl(e,r,a){for(var d=0,g=a;d<g.length;d+=1)for(var E=g[d],i=0;i<E.length-1;++i)if((m=[(p=E[i+1])[0]-(l=E[i])[0],p[1]-l[1]])[0]*(_=[(o=r)[0]-(t=e)[0],o[1]-t[1]])[1]-m[1]*_[0]!=0&&os(t,o,l,p)&&os(l,p,t,o))return!0;var t,o,l,p,m,_;return!1}function Ol(e,r){for(var a=0;a<e.length;++a)if(!Na(e[a],r))return!1;for(var d=0;d<e.length-1;++d)if(Bl(e[d],e[d+1],r))return!1;return!0}function Fl(e,r){for(var a=0;a<r.length;a++)if(Ol(e,r[a]))return!0;return!1}function ia(e,r,a){for(var d=[],g=0;g<e.length;g++){for(var E=[],i=0;i<e[g].length;i++){var t=Ts(e[g][i],a);Xr(r,t),E.push(t)}d.push(E)}return d}function Is(e,r,a){for(var d=[],g=0;g<e.length;g++){var E=ia(e[g],r,a);d.push(E)}return d}function As(e,r,a,d){if(e[0]<a[0]||e[0]>a[2]){var g=.5*d,E=e[0]-a[0]>g?-d:a[0]-e[0]>g?d:0;E===0&&(E=e[0]-a[2]>g?-d:a[2]-e[0]>g?d:0),e[0]+=E}Xr(r,e)}function pu(e,r,a,d){for(var g=8192*Math.pow(2,d.z),E=[8192*d.x,8192*d.y],i=[],t=0,o=e;t<o.length;t+=1)for(var l=0,p=o[t];l<p.length;l+=1){var m=p[l],_=[m.x+E[0],m.y+E[1]];As(_,r,a,g),i.push(_)}return i}function as(e,r,a,d){for(var g,E=8192*Math.pow(2,d.z),i=[8192*d.x,8192*d.y],t=[],o=0,l=e;o<l.length;o+=1){for(var p=[],m=0,_=l[o];m<_.length;m+=1){var T=_[m],C=[T.x+i[0],T.y+i[1]];Xr(r,C),p.push(C)}t.push(p)}if(r[2]-r[0]<=E/2){(g=r)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(var k=0,R=t;k<R.length;k+=1)for(var D=0,V=R[k];D<V.length;D+=1)As(V[D],r,a,E)}return t}$n.parse=function(e,r){if(e.length!==2)return r.error("Expected one argument.");var a=e[1];if(typeof a!="object"||Array.isArray(a))return r.error("Collator options argument must be an object.");var d=r.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,ge);if(!d)return null;var g=r.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,ge);if(!g)return null;var E=null;return a.locale&&!(E=r.parse(a.locale,1,_e))?null:new $n(d,g,E)},$n.prototype.evaluate=function(e){return new Oi(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)},$n.prototype.eachChild=function(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)},$n.prototype.outputDefined=function(){return!1},$n.prototype.serialize=function(){var e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]};var Xn=function(e,r){this.type=ge,this.geojson=e,this.geometries=r};function jo(e){if(e instanceof Er&&(e.name==="get"&&e.args.length===1||e.name==="feature-state"||e.name==="has"&&e.args.length===1||e.name==="properties"||e.name==="geometry-type"||e.name==="id"||/^filter-/.test(e.name))||e instanceof Xn)return!1;var r=!0;return e.eachChild(function(a){r&&!jo(a)&&(r=!1)}),r}function qo(e){if(e instanceof Er&&e.name==="feature-state")return!1;var r=!0;return e.eachChild(function(a){r&&!qo(a)&&(r=!1)}),r}function ba(e,r){if(e instanceof Er&&r.indexOf(e.name)>=0)return!1;var a=!0;return e.eachChild(function(d){a&&!ba(d,r)&&(a=!1)}),a}Xn.parse=function(e,r){if(e.length!==2)return r.error("'within' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if($i(e[1])){var a=e[1];if(a.type==="FeatureCollection")for(var d=0;d<a.features.length;++d){var g=a.features[d].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Xn(a,a.features[d].geometry)}else if(a.type==="Feature"){var E=a.geometry.type;if(E==="Polygon"||E==="MultiPolygon")return new Xn(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new Xn(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Xn.prototype.evaluate=function(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,a){var d=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],E=r.canonicalID();if(a.type==="Polygon"){var i=ia(a.coordinates,g,E),t=pu(r.geometry(),d,g,E);if(!No(d,g))return!1;for(var o=0,l=t;o<l.length;o+=1)if(!Na(l[o],i))return!1}if(a.type==="MultiPolygon"){var p=Is(a.coordinates,g,E),m=pu(r.geometry(),d,g,E);if(!No(d,g))return!1;for(var _=0,T=m;_<T.length;_+=1)if(!Vr(T[_],p))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,a){var d=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],E=r.canonicalID();if(a.type==="Polygon"){var i=ia(a.coordinates,g,E),t=as(r.geometry(),d,g,E);if(!No(d,g))return!1;for(var o=0,l=t;o<l.length;o+=1)if(!Ol(l[o],i))return!1}if(a.type==="MultiPolygon"){var p=Is(a.coordinates,g,E),m=as(r.geometry(),d,g,E);if(!No(d,g))return!1;for(var _=0,T=m;_<T.length;_+=1)if(!Fl(T[_],p))return!1}return!0}(e,this.geometries)}return!1},Xn.prototype.eachChild=function(){},Xn.prototype.outputDefined=function(){return!0},Xn.prototype.serialize=function(){return["within",this.geojson]};var Pi=function(e,r){this.type=r.type,this.name=e,this.boundExpression=r};Pi.parse=function(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");var a=e[1];return r.scope.has(a)?new Pi(a,r.scope.get(a)):r.error('Unknown variable "'+a+'". Make sure "'+a+'" has been bound in an enclosing "let" expression before using it.',1)},Pi.prototype.evaluate=function(e){return this.boundExpression.evaluate(e)},Pi.prototype.eachChild=function(){},Pi.prototype.outputDefined=function(){return!1},Pi.prototype.serialize=function(){return["var",this.name]};var wa=function(e,r,a,d,g){r===void 0&&(r=[]),d===void 0&&(d=new ne),g===void 0&&(g=[]),this.registry=e,this.path=r,this.key=r.map(function(E){return"["+E+"]"}).join(""),this.scope=d,this.errors=g,this.expectedType=a};function Ea(e,r){for(var a,d=e.length-1,g=0,E=d,i=0;g<=E;)if((a=e[i=Math.floor((g+E)/2)])<=r){if(i===d||r<e[i+1])return i;g=i+1}else{if(!(a>r))throw new Br("Input is not a number.");E=i-1}return 0}wa.prototype.parse=function(e,r,a,d,g){return g===void 0&&(g={}),r?this.concat(r,a,d)._parse(e,g):this._parse(e,g)},wa.prototype._parse=function(e,r){function a(l,p,m){return m==="assert"?new tr(p,[l]):m==="coerce"?new po(p,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var d=e[0];if(typeof d!="string")return this.error("Expression name must be a string, but found "+typeof d+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var g=this.registry[d];if(g){var E=g.parse(e,this);if(!E)return null;if(this.expectedType){var i=this.expectedType,t=E.type;if(i.kind!=="string"&&i.kind!=="number"&&i.kind!=="boolean"&&i.kind!=="object"&&i.kind!=="array"||t.kind!=="value")if(i.kind!=="color"&&i.kind!=="formatted"&&i.kind!=="resolvedImage"||t.kind!=="value"&&t.kind!=="string"){if(this.checkSubtype(i,t))return null}else E=a(E,i,r.typeAnnotation||"coerce");else E=a(E,i,r.typeAnnotation||"assert")}if(!(E instanceof En)&&E.type.kind!=="resolvedImage"&&function l(p){if(p instanceof Pi)return l(p.boundExpression);if(p instanceof Er&&p.name==="error"||p instanceof $n||p instanceof Xn)return!1;var m=p instanceof po||p instanceof tr,_=!0;return p.eachChild(function(T){_=m?_&&l(T):_&&T instanceof En}),!!_&&jo(p)&&ba(p,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(E)){var o=new bo;try{E=new En(E.type,E.evaluate(o))}catch(l){return this.error(l.message),null}}return E}return this.error('Unknown expression "'+d+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof e+" instead.")},wa.prototype.concat=function(e,r,a){var d=typeof e=="number"?this.path.concat(e):this.path,g=a?this.scope.concat(a):this.scope;return new wa(this.registry,d,r||null,g,this.errors)},wa.prototype.error=function(e){for(var r=[],a=arguments.length-1;a-- >0;)r[a]=arguments[a+1];var d=""+this.key+r.map(function(g){return"["+g+"]"}).join("");this.errors.push(new J(d,e))},wa.prototype.checkSubtype=function(e,r){var a=$t(e,r);return a&&this.error(a),a};var an=function(e,r,a){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(var d=0,g=a;d<g.length;d+=1){var E=g[d],i=E[1];this.labels.push(E[0]),this.outputs.push(i)}};function Sr(e,r,a){return e*(1-a)+r*a}an.parse=function(e,r){if(e.length-1<4)return r.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");var a=r.parse(e[1],1,le);if(!a)return null;var d=[],g=null;r.expectedType&&r.expectedType.kind!=="value"&&(g=r.expectedType);for(var E=1;E<e.length;E+=2){var i=E===1?-1/0:e[E],t=e[E+1],o=E,l=E+1;if(typeof i!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',o);if(d.length&&d[d.length-1][0]>=i)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',o);var p=r.parse(t,l,g);if(!p)return null;g=g||p.type,d.push([i,p])}return new an(g,a,d)},an.prototype.evaluate=function(e){var r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);var d=this.input.evaluate(e);if(d<=r[0])return a[0].evaluate(e);var g=r.length;return d>=r[g-1]?a[g-1].evaluate(e):a[Ea(r,d)].evaluate(e)},an.prototype.eachChild=function(e){e(this.input);for(var r=0,a=this.outputs;r<a.length;r+=1)e(a[r])},an.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},an.prototype.serialize=function(){for(var e=["step",this.input.serialize()],r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e};var sn=Object.freeze({__proto__:null,number:Sr,color:function(e,r,a){return new oi(Sr(e.r,r.r,a),Sr(e.g,r.g,a),Sr(e.b,r.b,a),Sr(e.a,r.a,a))},array:function(e,r,a){return e.map(function(d,g){return Sr(d,r[g],a)})}}),al=6/29*3*(6/29),sl=Math.PI/180,ll=180/Math.PI;function Cs(e){return e>.008856451679035631?Math.pow(e,1/3):e/al+4/29}function zs(e){return e>6/29?e*e*e:al*(e-4/29)}function ss(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Ps(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function ul(e){var r=Ps(e.r),a=Ps(e.g),d=Ps(e.b),g=Cs((.4124564*r+.3575761*a+.1804375*d)/.95047),E=Cs((.2126729*r+.7151522*a+.072175*d)/1);return{l:116*E-16,a:500*(g-E),b:200*(E-Cs((.0193339*r+.119192*a+.9503041*d)/1.08883)),alpha:e.a}}function ks(e){var r=(e.l+16)/116,a=isNaN(e.a)?r:r+e.a/500,d=isNaN(e.b)?r:r-e.b/200;return r=1*zs(r),a=.95047*zs(a),d=1.08883*zs(d),new oi(ss(3.2404542*a-1.5371385*r-.4985314*d),ss(-.969266*a+1.8760108*r+.041556*d),ss(.0556434*a-.2040259*r+1.0572252*d),e.alpha)}function du(e,r,a){var d=r-e;return e+a*(d>180||d<-180?d-360*Math.round(d/360):d)}var ls={forward:ul,reverse:ks,interpolate:function(e,r,a){return{l:Sr(e.l,r.l,a),a:Sr(e.a,r.a,a),b:Sr(e.b,r.b,a),alpha:Sr(e.alpha,r.alpha,a)}}},Go={forward:function(e){var r=ul(e),a=r.l,d=r.a,g=r.b,E=Math.atan2(g,d)*ll;return{h:E<0?E+360:E,c:Math.sqrt(d*d+g*g),l:a,alpha:e.a}},reverse:function(e){var r=e.h*sl,a=e.c;return ks({l:e.l,a:Math.cos(r)*a,b:Math.sin(r)*a,alpha:e.alpha})},interpolate:function(e,r,a){return{h:du(e.h,r.h,a),c:Sr(e.c,r.c,a),l:Sr(e.l,r.l,a),alpha:Sr(e.alpha,r.alpha,a)}}},fu=Object.freeze({__proto__:null,lab:ls,hcl:Go}),ln=function(e,r,a,d,g){this.type=e,this.operator=r,this.interpolation=a,this.input=d,this.labels=[],this.outputs=[];for(var E=0,i=g;E<i.length;E+=1){var t=i[E],o=t[1];this.labels.push(t[0]),this.outputs.push(o)}};function Ul(e,r,a,d){var g=d-a,E=e-a;return g===0?0:r===1?E/g:(Math.pow(r,E)-1)/(Math.pow(r,g)-1)}ln.interpolationFactor=function(e,r,a,d){var g=0;if(e.name==="exponential")g=Ul(r,e.base,a,d);else if(e.name==="linear")g=Ul(r,1,a,d);else if(e.name==="cubic-bezier"){var E=e.controlPoints;g=new he(E[0],E[1],E[2],E[3]).solve(Ul(r,1,a,d))}return g},ln.parse=function(e,r){var a=e[0],d=e[1],g=e[2],E=e.slice(3);if(!Array.isArray(d)||d.length===0)return r.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){var i=d[1];if(typeof i!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:i}}else{if(d[0]!=="cubic-bezier")return r.error("Unknown interpolation type "+String(d[0]),1,0);var t=d.slice(1);if(t.length!==4||t.some(function(R){return typeof R!="number"||R<0||R>1}))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:t}}if(e.length-1<4)return r.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(!(g=r.parse(g,2,le)))return null;var o=[],l=null;a==="interpolate-hcl"||a==="interpolate-lab"?l=ve:r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);for(var p=0;p<E.length;p+=2){var m=E[p],_=E[p+1],T=p+3,C=p+4;if(typeof m!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(o.length&&o[o.length-1][0]>=m)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',T);var k=r.parse(_,C,l);if(!k)return null;l=l||k.type,o.push([m,k])}return l.kind==="number"||l.kind==="color"||l.kind==="array"&&l.itemType.kind==="number"&&typeof l.N=="number"?new ln(l,a,d,g,o):r.error("Type "+Et(l)+" is not interpolatable.")},ln.prototype.evaluate=function(e){var r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);var d=this.input.evaluate(e);if(d<=r[0])return a[0].evaluate(e);var g=r.length;if(d>=r[g-1])return a[g-1].evaluate(e);var E=Ea(r,d),i=ln.interpolationFactor(this.interpolation,d,r[E],r[E+1]),t=a[E].evaluate(e),o=a[E+1].evaluate(e);return this.operator==="interpolate"?sn[this.type.kind.toLowerCase()](t,o,i):this.operator==="interpolate-hcl"?Go.reverse(Go.interpolate(Go.forward(t),Go.forward(o),i)):ls.reverse(ls.interpolate(ls.forward(t),ls.forward(o),i))},ln.prototype.eachChild=function(e){e(this.input);for(var r=0,a=this.outputs;r<a.length;r+=1)e(a[r])},ln.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},ln.prototype.serialize=function(){var e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var r=[this.operator,e,this.input.serialize()],a=0;a<this.labels.length;a++)r.push(this.labels[a],this.outputs[a].serialize());return r};var Sa=function(e,r){this.type=e,this.args=r};Sa.parse=function(e,r){if(e.length<2)return r.error("Expectected at least one argument.");var a=null,d=r.expectedType;d&&d.kind!=="value"&&(a=d);for(var g=[],E=0,i=e.slice(1);E<i.length;E+=1){var t=r.parse(i[E],1+g.length,a,void 0,{typeAnnotation:"omit"});if(!t)return null;a=a||t.type,g.push(t)}var o=d&&g.some(function(l){return $t(d,l.type)});return new Sa(o?Ue:a,g)},Sa.prototype.evaluate=function(e){for(var r,a=null,d=0,g=0,E=this.args;g<E.length&&(d++,(a=E[g].evaluate(e))&&a instanceof yn&&!a.available&&(r||(r=a.name),a=null,d===this.args.length&&(a=r)),a===null);g+=1);return a},Sa.prototype.eachChild=function(e){this.args.forEach(e)},Sa.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},Sa.prototype.serialize=function(){var e=["coalesce"];return this.eachChild(function(r){e.push(r.serialize())}),e};var Ta=function(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r};Ta.prototype.evaluate=function(e){return this.result.evaluate(e)},Ta.prototype.eachChild=function(e){for(var r=0,a=this.bindings;r<a.length;r+=1)e(a[r][1]);e(this.result)},Ta.parse=function(e,r){if(e.length<4)return r.error("Expected at least 3 arguments, but found "+(e.length-1)+" instead.");for(var a=[],d=1;d<e.length-1;d+=2){var g=e[d];if(typeof g!="string")return r.error("Expected string, but found "+typeof g+" instead.",d);if(/[^a-zA-Z0-9_]/.test(g))return r.error("Variable names must contain only alphanumeric characters or '_'.",d);var E=r.parse(e[d+1],d+1);if(!E)return null;a.push([g,E])}var i=r.parse(e[e.length-1],e.length-1,r.expectedType,a);return i?new Ta(a,i):null},Ta.prototype.outputDefined=function(){return this.result.outputDefined()},Ta.prototype.serialize=function(){for(var e=["let"],r=0,a=this.bindings;r<a.length;r+=1){var d=a[r];e.push(d[0],d[1].serialize())}return e.push(this.result.serialize()),e};var ja=function(e,r,a){this.type=e,this.index=r,this.input=a};ja.parse=function(e,r){if(e.length!==3)return r.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var a=r.parse(e[1],1,le),d=r.parse(e[2],2,vt(r.expectedType||Ue));return a&&d?new ja(d.type.itemType,a,d):null},ja.prototype.evaluate=function(e){var r=this.index.evaluate(e),a=this.input.evaluate(e);if(r<0)throw new Br("Array index out of bounds: "+r+" < 0.");if(r>=a.length)throw new Br("Array index out of bounds: "+r+" > "+(a.length-1)+".");if(r!==Math.floor(r))throw new Br("Array index must be an integer, but found "+r+" instead.");return a[r]},ja.prototype.eachChild=function(e){e(this.index),e(this.input)},ja.prototype.outputDefined=function(){return!1},ja.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var ra=function(e,r){this.type=ge,this.needle=e,this.haystack=r};ra.parse=function(e,r){if(e.length!==3)return r.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var a=r.parse(e[1],1,Ue),d=r.parse(e[2],2,Ue);return a&&d?Jt(a.type,[ge,_e,le,de,Ue])?new ra(a,d):r.error("Expected first argument to be of type boolean, string, number or null, but found "+Et(a.type)+" instead"):null},ra.prototype.evaluate=function(e){var r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!a)return!1;if(!Nt(r,["boolean","string","number","null"]))throw new Br("Expected first argument to be of type boolean, string, number or null, but found "+Et(wr(r))+" instead.");if(!Nt(a,["string","array"]))throw new Br("Expected second argument to be of type array or string, but found "+Et(wr(a))+" instead.");return a.indexOf(r)>=0},ra.prototype.eachChild=function(e){e(this.needle),e(this.haystack)},ra.prototype.outputDefined=function(){return!0},ra.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Zo=function(e,r,a){this.type=le,this.needle=e,this.haystack=r,this.fromIndex=a};Zo.parse=function(e,r){if(e.length<=2||e.length>=5)return r.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var a=r.parse(e[1],1,Ue),d=r.parse(e[2],2,Ue);if(!a||!d)return null;if(!Jt(a.type,[ge,_e,le,de,Ue]))return r.error("Expected first argument to be of type boolean, string, number or null, but found "+Et(a.type)+" instead");if(e.length===4){var g=r.parse(e[3],3,le);return g?new Zo(a,d,g):null}return new Zo(a,d)},Zo.prototype.evaluate=function(e){var r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!Nt(r,["boolean","string","number","null"]))throw new Br("Expected first argument to be of type boolean, string, number or null, but found "+Et(wr(r))+" instead.");if(!Nt(a,["string","array"]))throw new Br("Expected second argument to be of type array or string, but found "+Et(wr(a))+" instead.");if(this.fromIndex){var d=this.fromIndex.evaluate(e);return a.indexOf(r,d)}return a.indexOf(r)},Zo.prototype.eachChild=function(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)},Zo.prototype.outputDefined=function(){return!1},Zo.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var wo=function(e,r,a,d,g,E){this.inputType=e,this.type=r,this.input=a,this.cases=d,this.outputs=g,this.otherwise=E};wo.parse=function(e,r){if(e.length<5)return r.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if(e.length%2!=1)return r.error("Expected an even number of arguments.");var a,d;r.expectedType&&r.expectedType.kind!=="value"&&(d=r.expectedType);for(var g={},E=[],i=2;i<e.length-1;i+=2){var t=e[i],o=e[i+1];Array.isArray(t)||(t=[t]);var l=r.concat(i);if(t.length===0)return l.error("Expected at least one branch label.");for(var p=0,m=t;p<m.length;p+=1){var _=m[p];if(typeof _!="number"&&typeof _!="string")return l.error("Branch labels must be numbers or strings.");if(typeof _=="number"&&Math.abs(_)>Number.MAX_SAFE_INTEGER)return l.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof _=="number"&&Math.floor(_)!==_)return l.error("Numeric branch labels must be integer values.");if(a){if(l.checkSubtype(a,wr(_)))return null}else a=wr(_);if(g[String(_)]!==void 0)return l.error("Branch labels must be unique.");g[String(_)]=E.length}var T=r.parse(o,i,d);if(!T)return null;d=d||T.type,E.push(T)}var C=r.parse(e[1],1,Ue);if(!C)return null;var k=r.parse(e[e.length-1],e.length-1,d);return k?C.type.kind!=="value"&&r.concat(1).checkSubtype(a,C.type)?null:new wo(a,d,C,g,E,k):null},wo.prototype.evaluate=function(e){var r=this.input.evaluate(e);return(wr(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)},wo.prototype.eachChild=function(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)},wo.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})&&this.otherwise.outputDefined()},wo.prototype.serialize=function(){for(var e=this,r=["match",this.input.serialize()],a=[],d={},g=0,E=Object.keys(this.cases).sort();g<E.length;g+=1){var i=E[g];(m=d[this.cases[i]])===void 0?(d[this.cases[i]]=a.length,a.push([this.cases[i],[i]])):a[m][1].push(i)}for(var t=function(T){return e.inputType.kind==="number"?Number(T):T},o=0,l=a;o<l.length;o+=1){var p=l[o],m=p[0],_=p[1];r.push(_.length===1?t(_[0]):_.map(t)),r.push(this.outputs[outputIndex$1].serialize())}return r.push(this.otherwise.serialize()),r};var Ia=function(e,r,a){this.type=e,this.branches=r,this.otherwise=a};Ia.parse=function(e,r){if(e.length<4)return r.error("Expected at least 3 arguments, but found only "+(e.length-1)+".");if(e.length%2!=0)return r.error("Expected an odd number of arguments.");var a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);for(var d=[],g=1;g<e.length-1;g+=2){var E=r.parse(e[g],g,ge);if(!E)return null;var i=r.parse(e[g+1],g+1,a);if(!i)return null;d.push([E,i]),a=a||i.type}var t=r.parse(e[e.length-1],e.length-1,a);return t?new Ia(a,d,t):null},Ia.prototype.evaluate=function(e){for(var r=0,a=this.branches;r<a.length;r+=1){var d=a[r],g=d[1];if(d[0].evaluate(e))return g.evaluate(e)}return this.otherwise.evaluate(e)},Ia.prototype.eachChild=function(e){for(var r=0,a=this.branches;r<a.length;r+=1){var d=a[r],g=d[1];e(d[0]),e(g)}e(this.otherwise)},Ia.prototype.outputDefined=function(){return this.branches.every(function(e){return e[1].outputDefined()})&&this.otherwise.outputDefined()},Ia.prototype.serialize=function(){var e=["case"];return this.eachChild(function(r){e.push(r.serialize())}),e};var na=function(e,r,a,d){this.type=e,this.input=r,this.beginIndex=a,this.endIndex=d};function cl(e,r){return e==="=="||e==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function Aa(e,r,a,d){return d.compare(r,a)===0}function Xi(e,r,a){var d=e!=="=="&&e!=="!=";return function(){function g(E,i,t){this.type=ge,this.lhs=E,this.rhs=i,this.collator=t,this.hasUntypedArgument=E.type.kind==="value"||i.type.kind==="value"}return g.parse=function(E,i){if(E.length!==3&&E.length!==4)return i.error("Expected two or three arguments.");var t=E[0],o=i.parse(E[1],1,Ue);if(!o)return null;if(!cl(t,o.type))return i.concat(1).error('"'+t+`" comparisons are not supported for type '`+Et(o.type)+"'.");var l=i.parse(E[2],2,Ue);if(!l)return null;if(!cl(t,l.type))return i.concat(2).error('"'+t+`" comparisons are not supported for type '`+Et(l.type)+"'.");if(o.type.kind!==l.type.kind&&o.type.kind!=="value"&&l.type.kind!=="value")return i.error("Cannot compare types '"+Et(o.type)+"' and '"+Et(l.type)+"'.");d&&(o.type.kind==="value"&&l.type.kind!=="value"?o=new tr(l.type,[o]):o.type.kind!=="value"&&l.type.kind==="value"&&(l=new tr(o.type,[l])));var p=null;if(E.length===4){if(o.type.kind!=="string"&&l.type.kind!=="string"&&o.type.kind!=="value"&&l.type.kind!=="value")return i.error("Cannot use collator to compare non-string types.");if(!(p=i.parse(E[3],3,Ze)))return null}return new g(o,l,p)},g.prototype.evaluate=function(E){var i=this.lhs.evaluate(E),t=this.rhs.evaluate(E);if(d&&this.hasUntypedArgument){var o=wr(i),l=wr(t);if(o.kind!==l.kind||o.kind!=="string"&&o.kind!=="number")throw new Br('Expected arguments for "'+e+'" to be (string, string) or (number, number), but found ('+o.kind+", "+l.kind+") instead.")}if(this.collator&&!d&&this.hasUntypedArgument){var p=wr(i),m=wr(t);if(p.kind!=="string"||m.kind!=="string")return r(E,i,t)}return this.collator?a(E,i,t,this.collator.evaluate(E)):r(E,i,t)},g.prototype.eachChild=function(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)},g.prototype.outputDefined=function(){return!0},g.prototype.serialize=function(){var E=[e];return this.eachChild(function(i){E.push(i.serialize())}),E},g}()}na.parse=function(e,r){if(e.length<=2||e.length>=5)return r.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var a=r.parse(e[1],1,Ue),d=r.parse(e[2],2,le);if(!a||!d)return null;if(!Jt(a.type,[vt(Ue),_e,Ue]))return r.error("Expected first argument to be of type array or string, but found "+Et(a.type)+" instead");if(e.length===4){var g=r.parse(e[3],3,le);return g?new na(a.type,a,d,g):null}return new na(a.type,a,d)},na.prototype.evaluate=function(e){var r=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!Nt(r,["string","array"]))throw new Br("Expected first argument to be of type array or string, but found "+Et(wr(r))+" instead.");if(this.endIndex){var d=this.endIndex.evaluate(e);return r.slice(a,d)}return r.slice(a)},na.prototype.eachChild=function(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)},na.prototype.outputDefined=function(){return!1},na.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var qa=Xi("==",function(e,r,a){return r===a},Aa),oa=Xi("!=",function(e,r,a){return r!==a},function(e,r,a,d){return!Aa(0,r,a,d)}),Vl=Xi("<",function(e,r,a){return r<a},function(e,r,a,d){return d.compare(r,a)<0}),hl=Xi(">",function(e,r,a){return r>a},function(e,r,a,d){return d.compare(r,a)>0}),_i=Xi("<=",function(e,r,a){return r<=a},function(e,r,a,d){return d.compare(r,a)<=0}),Ms=Xi(">=",function(e,r,a){return r>=a},function(e,r,a,d){return d.compare(r,a)>=0}),Di=function(e,r,a,d,g){this.type=_e,this.number=e,this.locale=r,this.currency=a,this.minFractionDigits=d,this.maxFractionDigits=g};Di.parse=function(e,r){if(e.length!==3)return r.error("Expected two arguments.");var a=r.parse(e[1],1,le);if(!a)return null;var d=e[2];if(typeof d!="object"||Array.isArray(d))return r.error("NumberFormat options argument must be an object.");var g=null;if(d.locale&&!(g=r.parse(d.locale,1,_e)))return null;var E=null;if(d.currency&&!(E=r.parse(d.currency,1,_e)))return null;var i=null;if(d["min-fraction-digits"]&&!(i=r.parse(d["min-fraction-digits"],1,le)))return null;var t=null;return d["max-fraction-digits"]&&!(t=r.parse(d["max-fraction-digits"],1,le))?null:new Di(a,g,E,i,t)},Di.prototype.evaluate=function(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))},Di.prototype.eachChild=function(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)},Di.prototype.outputDefined=function(){return!1},Di.prototype.serialize=function(){var e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]};var Po=function(e){this.type=le,this.input=e};Po.parse=function(e,r){if(e.length!==2)return r.error("Expected 1 argument, but found "+(e.length-1)+" instead.");var a=r.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?r.error("Expected argument of type string or array, but found "+Et(a.type)+" instead."):new Po(a):null},Po.prototype.evaluate=function(e){var r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Br("Expected value to be of type string or array, but found "+Et(wr(r))+" instead.")},Po.prototype.eachChild=function(e){e(this.input)},Po.prototype.outputDefined=function(){return!1},Po.prototype.serialize=function(){var e=["length"];return this.eachChild(function(r){e.push(r.serialize())}),e};var Yi={"==":qa,"!=":oa,">":hl,"<":Vl,">=":Ms,"<=":_i,array:tr,at:ja,boolean:tr,case:Ia,coalesce:Sa,collator:$n,format:ho,image:Dn,in:ra,"index-of":Zo,interpolate:ln,"interpolate-hcl":ln,"interpolate-lab":ln,length:Po,let:Ta,literal:En,match:wo,number:tr,"number-format":Di,object:tr,slice:na,step:an,string:tr,"to-boolean":po,"to-color":po,"to-number":po,"to-string":po,var:Pi,within:Xn};function Tr(e,r){var a=r[0],d=r[1],g=r[2],E=r[3];a=a.evaluate(e),d=d.evaluate(e),g=g.evaluate(e);var i=E?E.evaluate(e):1,t=Ss(a,d,g,i);if(t)throw new Br(t);return new oi(a/255*i,d/255*i,g/255*i,i)}function Ls(e,r){return e in r}function Ds(e,r){var a=r[e];return a===void 0?null:a}function Ga(e){return{type:e}}function pl(e){return{result:"success",value:e}}function $o(e){return{result:"error",value:e}}function Xo(e){return e["property-type"]==="data-driven"||e["property-type"]==="cross-faded-data-driven"}function Rs(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Ca(e){return!!e.expression&&e.expression.interpolated}function Qi(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":e===null?"null":typeof e}function aa(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function dl(e){return e}function Sn(e,r,a){return e!==void 0?e:r!==void 0?r:a!==void 0?a:void 0}function Nl(e,r,a,d,g){return Sn(typeof a===g?d[a]:void 0,e.default,r.default)}function mu(e,r,a){if(Qi(a)!=="number")return Sn(e.default,r.default);var d=e.stops.length;if(d===1||a<=e.stops[0][0])return e.stops[0][1];if(a>=e.stops[d-1][0])return e.stops[d-1][1];var g=Ea(e.stops.map(function(E){return E[0]}),a);return e.stops[g][1]}function jl(e,r,a){var d=e.base!==void 0?e.base:1;if(Qi(a)!=="number")return Sn(e.default,r.default);var g=e.stops.length;if(g===1||a<=e.stops[0][0])return e.stops[0][1];if(a>=e.stops[g-1][0])return e.stops[g-1][1];var E=Ea(e.stops.map(function(m){return m[0]}),a),i=function(m,_,T,C){var k=C-T,R=m-T;return k===0?0:_===1?R/k:(Math.pow(_,R)-1)/(Math.pow(_,k)-1)}(a,d,e.stops[E][0],e.stops[E+1][0]),t=e.stops[E][1],o=e.stops[E+1][1],l=sn[r.type]||dl;if(e.colorSpace&&e.colorSpace!=="rgb"){var p=fu[e.colorSpace];l=function(m,_){return p.reverse(p.interpolate(p.forward(m),p.forward(_),i))}}return typeof t.evaluate=="function"?{evaluate:function(){for(var m=[],_=arguments.length;_--;)m[_]=arguments[_];var T=t.evaluate.apply(void 0,m),C=o.evaluate.apply(void 0,m);if(T!==void 0&&C!==void 0)return l(T,C,i)}}:l(t,o,i)}function sa(e,r,a){return r.type==="color"?a=oi.parse(a):r.type==="formatted"?a=Fi.fromString(a.toString()):r.type==="resolvedImage"?a=yn.fromString(a.toString()):Qi(a)===r.type||r.type==="enum"&&r.values[a]||(a=void 0),Sn(a,e.default,r.default)}Er.register(Yi,{error:[{kind:"error"},[_e],function(e,r){throw new Br(r[0].evaluate(e))}],typeof:[_e,[Ue],function(e,r){return Et(wr(r[0].evaluate(e)))}],"to-rgba":[vt(le,4),[ve],function(e,r){return r[0].evaluate(e).toArray()}],rgb:[ve,[le,le,le],Tr],rgba:[ve,[le,le,le,le],Tr],has:{type:ge,overloads:[[[_e],function(e,r){return Ls(r[0].evaluate(e),e.properties())}],[[_e,Ge],function(e,r){var a=r[1];return Ls(r[0].evaluate(e),a.evaluate(e))}]]},get:{type:Ue,overloads:[[[_e],function(e,r){return Ds(r[0].evaluate(e),e.properties())}],[[_e,Ge],function(e,r){var a=r[1];return Ds(r[0].evaluate(e),a.evaluate(e))}]]},"feature-state":[Ue,[_e],function(e,r){return Ds(r[0].evaluate(e),e.featureState||{})}],properties:[Ge,[],function(e){return e.properties()}],"geometry-type":[_e,[],function(e){return e.geometryType()}],id:[Ue,[],function(e){return e.id()}],zoom:[le,[],function(e){return e.globals.zoom}],"heatmap-density":[le,[],function(e){return e.globals.heatmapDensity||0}],"line-progress":[le,[],function(e){return e.globals.lineProgress||0}],accumulated:[Ue,[],function(e){return e.globals.accumulated===void 0?null:e.globals.accumulated}],"+":[le,Ga(le),function(e,r){for(var a=0,d=0,g=r;d<g.length;d+=1)a+=g[d].evaluate(e);return a}],"*":[le,Ga(le),function(e,r){for(var a=1,d=0,g=r;d<g.length;d+=1)a*=g[d].evaluate(e);return a}],"-":{type:le,overloads:[[[le,le],function(e,r){var a=r[1];return r[0].evaluate(e)-a.evaluate(e)}],[[le],function(e,r){return-r[0].evaluate(e)}]]},"/":[le,[le,le],function(e,r){var a=r[1];return r[0].evaluate(e)/a.evaluate(e)}],"%":[le,[le,le],function(e,r){var a=r[1];return r[0].evaluate(e)%a.evaluate(e)}],ln2:[le,[],function(){return Math.LN2}],pi:[le,[],function(){return Math.PI}],e:[le,[],function(){return Math.E}],"^":[le,[le,le],function(e,r){var a=r[1];return Math.pow(r[0].evaluate(e),a.evaluate(e))}],sqrt:[le,[le],function(e,r){return Math.sqrt(r[0].evaluate(e))}],log10:[le,[le],function(e,r){return Math.log(r[0].evaluate(e))/Math.LN10}],ln:[le,[le],function(e,r){return Math.log(r[0].evaluate(e))}],log2:[le,[le],function(e,r){return Math.log(r[0].evaluate(e))/Math.LN2}],sin:[le,[le],function(e,r){return Math.sin(r[0].evaluate(e))}],cos:[le,[le],function(e,r){return Math.cos(r[0].evaluate(e))}],tan:[le,[le],function(e,r){return Math.tan(r[0].evaluate(e))}],asin:[le,[le],function(e,r){return Math.asin(r[0].evaluate(e))}],acos:[le,[le],function(e,r){return Math.acos(r[0].evaluate(e))}],atan:[le,[le],function(e,r){return Math.atan(r[0].evaluate(e))}],min:[le,Ga(le),function(e,r){return Math.min.apply(Math,r.map(function(a){return a.evaluate(e)}))}],max:[le,Ga(le),function(e,r){return Math.max.apply(Math,r.map(function(a){return a.evaluate(e)}))}],abs:[le,[le],function(e,r){return Math.abs(r[0].evaluate(e))}],round:[le,[le],function(e,r){var a=r[0].evaluate(e);return a<0?-Math.round(-a):Math.round(a)}],floor:[le,[le],function(e,r){return Math.floor(r[0].evaluate(e))}],ceil:[le,[le],function(e,r){return Math.ceil(r[0].evaluate(e))}],"filter-==":[ge,[_e,Ue],function(e,r){var a=r[0],d=r[1];return e.properties()[a.value]===d.value}],"filter-id-==":[ge,[Ue],function(e,r){var a=r[0];return e.id()===a.value}],"filter-type-==":[ge,[_e],function(e,r){var a=r[0];return e.geometryType()===a.value}],"filter-<":[ge,[_e,Ue],function(e,r){var a=r[0],d=r[1],g=e.properties()[a.value],E=d.value;return typeof g==typeof E&&g<E}],"filter-id-<":[ge,[Ue],function(e,r){var a=r[0],d=e.id(),g=a.value;return typeof d==typeof g&&d<g}],"filter->":[ge,[_e,Ue],function(e,r){var a=r[0],d=r[1],g=e.properties()[a.value],E=d.value;return typeof g==typeof E&&g>E}],"filter-id->":[ge,[Ue],function(e,r){var a=r[0],d=e.id(),g=a.value;return typeof d==typeof g&&d>g}],"filter-<=":[ge,[_e,Ue],function(e,r){var a=r[0],d=r[1],g=e.properties()[a.value],E=d.value;return typeof g==typeof E&&g<=E}],"filter-id-<=":[ge,[Ue],function(e,r){var a=r[0],d=e.id(),g=a.value;return typeof d==typeof g&&d<=g}],"filter->=":[ge,[_e,Ue],function(e,r){var a=r[0],d=r[1],g=e.properties()[a.value],E=d.value;return typeof g==typeof E&&g>=E}],"filter-id->=":[ge,[Ue],function(e,r){var a=r[0],d=e.id(),g=a.value;return typeof d==typeof g&&d>=g}],"filter-has":[ge,[Ue],function(e,r){return r[0].value in e.properties()}],"filter-has-id":[ge,[],function(e){return e.id()!==null&&e.id()!==void 0}],"filter-type-in":[ge,[vt(_e)],function(e,r){return r[0].value.indexOf(e.geometryType())>=0}],"filter-id-in":[ge,[vt(Ue)],function(e,r){return r[0].value.indexOf(e.id())>=0}],"filter-in-small":[ge,[_e,vt(Ue)],function(e,r){var a=r[0];return r[1].value.indexOf(e.properties()[a.value])>=0}],"filter-in-large":[ge,[_e,vt(Ue)],function(e,r){var a=r[0],d=r[1];return function(g,E,i,t){for(;i<=t;){var o=i+t>>1;if(E[o]===g)return!0;E[o]>g?t=o-1:i=o+1}return!1}(e.properties()[a.value],d.value,0,d.value.length-1)}],all:{type:ge,overloads:[[[ge,ge],function(e,r){var a=r[1];return r[0].evaluate(e)&&a.evaluate(e)}],[Ga(ge),function(e,r){for(var a=0,d=r;a<d.length;a+=1)if(!d[a].evaluate(e))return!1;return!0}]]},any:{type:ge,overloads:[[[ge,ge],function(e,r){var a=r[1];return r[0].evaluate(e)||a.evaluate(e)}],[Ga(ge),function(e,r){for(var a=0,d=r;a<d.length;a+=1)if(d[a].evaluate(e))return!0;return!1}]]},"!":[ge,[ge],function(e,r){return!r[0].evaluate(e)}],"is-supported-script":[ge,[_e],function(e,r){var a=e.globals&&e.globals.isSupportedScript;return!a||a(r[0].evaluate(e))}],upcase:[_e,[_e],function(e,r){return r[0].evaluate(e).toUpperCase()}],downcase:[_e,[_e],function(e,r){return r[0].evaluate(e).toLowerCase()}],concat:[_e,Ga(Ue),function(e,r){return r.map(function(a){return Ua(a.evaluate(e))}).join("")}],"resolved-locale":[_e,[Ze],function(e,r){return r[0].evaluate(e).resolvedLocale()}]});var la=function(e,r){this.expression=e,this._warningHistory={},this._evaluator=new bo,this._defaultValue=r?function(a){return a.type==="color"&&aa(a.default)?new oi(0,0,0,0):a.type==="color"?oi.parse(a.default)||null:a.default===void 0?null:a.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null};function Za(e){return Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0]in Yi}function Bs(e,r){var a=new wa(Yi,[],r?function(g){var E={color:ve,string:_e,number:le,enum:_e,boolean:ge,formatted:bt,resolvedImage:pt};return g.type==="array"?vt(E[g.value]||Ue,g.length):E[g.type]}(r):void 0),d=a.parse(e,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?pl(new la(d,r)):$o(a.errors)}la.prototype.evaluateWithoutErrorHandling=function(e,r,a,d,g,E){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=d,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=E,this.expression.evaluate(this._evaluator)},la.prototype.evaluate=function(e,r,a,d,g,E){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=d,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=E||null;try{var i=this.expression.evaluate(this._evaluator);if(i==null||typeof i=="number"&&i!=i)return this._defaultValue;if(this._enumValues&&!(i in this._enumValues))throw new Br("Expected value to be one of "+Object.keys(this._enumValues).map(function(t){return JSON.stringify(t)}).join(", ")+", but found "+JSON.stringify(i)+" instead.");return i}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,typeof console!="undefined"&&console.warn(t.message)),this._defaultValue}};var za=function(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!qo(r.expression)};za.prototype.evaluateWithoutErrorHandling=function(e,r,a,d,g,E){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,d,g,E)},za.prototype.evaluate=function(e,r,a,d,g,E){return this._styleExpression.evaluate(e,r,a,d,g,E)};var ua=function(e,r,a,d){this.kind=e,this.zoomStops=a,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!qo(r.expression),this.interpolationType=d};function ql(e,r){if((e=Bs(e,r)).result==="error")return e;var a=e.value.expression,d=jo(a);if(!d&&!Xo(r))return $o([new J("","data expressions not supported")]);var g=ba(a,["zoom"]);if(!g&&!Rs(r))return $o([new J("","zoom expressions not supported")]);var E=function i(t){var o=null;if(t instanceof Ta)o=i(t.result);else if(t instanceof Sa)for(var l=0,p=t.args;l<p.length&&!(o=i(p[l]));l+=1);else(t instanceof an||t instanceof ln)&&t.input instanceof Er&&t.input.name==="zoom"&&(o=t);return o instanceof J||t.eachChild(function(m){var _=i(m);_ instanceof J?o=_:!o&&_?o=new J("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&_&&o!==_&&(o=new J("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}(a);return E||g?E instanceof J?$o([E]):E instanceof ln&&!Ca(r)?$o([new J("",'"interpolate" expressions cannot be used with this property')]):pl(E?new ua(d?"camera":"composite",e.value,E.labels,E instanceof ln?E.interpolation:void 0):new za(d?"constant":"source",e.value)):$o([new J("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}ua.prototype.evaluateWithoutErrorHandling=function(e,r,a,d,g,E){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,d,g,E)},ua.prototype.evaluate=function(e,r,a,d,g,E){return this._styleExpression.evaluate(e,r,a,d,g,E)},ua.prototype.interpolationFactor=function(e,r,a){return this.interpolationType?ln.interpolationFactor(this.interpolationType,e,r,a):0};var Wo=function(e,r){this._parameters=e,this._specification=r,Q(this,function a(d,g){var E,i,t,o=g.type==="color",l=d.stops&&typeof d.stops[0][0]=="object",p=l||!(l||d.property!==void 0),m=d.type||(Ca(g)?"exponential":"interval");if(o&&((d=Q({},d)).stops&&(d.stops=d.stops.map(function(Be){return[Be[0],oi.parse(Be[1])]})),d.default=oi.parse(d.default?d.default:g.default)),d.colorSpace&&d.colorSpace!=="rgb"&&!fu[d.colorSpace])throw new Error("Unknown color space: "+d.colorSpace);if(m==="exponential")E=jl;else if(m==="interval")E=mu;else if(m==="categorical"){E=Nl,i=Object.create(null);for(var _=0,T=d.stops;_<T.length;_+=1){var C=T[_];i[C[0]]=C[1]}t=typeof d.stops[0][0]}else{if(m!=="identity")throw new Error('Unknown function type "'+m+'"');E=sa}if(l){for(var k={},R=[],D=0;D<d.stops.length;D++){var V=d.stops[D],G=V[0].zoom;k[G]===void 0&&(k[G]={zoom:G,type:d.type,property:d.property,default:d.default,stops:[]},R.push(G)),k[G].stops.push([V[0].value,V[1]])}for(var Z=[],ee=0,ae=R;ee<ae.length;ee+=1){var we=ae[ee];Z.push([k[we].zoom,a(k[we],g)])}var ke={name:"linear"};return{kind:"composite",interpolationType:ke,interpolationFactor:ln.interpolationFactor.bind(void 0,ke),zoomStops:Z.map(function(Be){return Be[0]}),evaluate:function(Be,$e){var Oe=Be.zoom;return jl({stops:Z,base:d.base},g,Oe).evaluate(Oe,$e)}}}if(p){var Re=m==="exponential"?{name:"exponential",base:d.base!==void 0?d.base:1}:null;return{kind:"camera",interpolationType:Re,interpolationFactor:ln.interpolationFactor.bind(void 0,Re),zoomStops:d.stops.map(function(Be){return Be[0]}),evaluate:function(Be){return E(d,g,Be.zoom,i,t)}}}return{kind:"source",evaluate:function(Be,$e){var Oe=$e&&$e.properties?$e.properties[d.property]:void 0;return Oe===void 0?Sn(d.default,g.default):E(d,g,Oe,i,t)}}}(this._parameters,this._specification))};function fo(e){var r=e.key,a=e.value,d=e.valueSpec||{},g=e.objectElementValidators||{},E=e.style,i=e.styleSpec,t=[],o=Qi(a);if(o!=="object")return[new Ie(r,a,"object expected, "+o+" found")];for(var l in a){var p=l.split(".")[0],m=d[p]||d["*"],_=void 0;if(g[p])_=g[p];else if(d[p])_=bi;else if(g["*"])_=g["*"];else{if(!d["*"]){t.push(new Ie(r,a[l],'unknown property "'+l+'"'));continue}_=bi}t=t.concat(_({key:(r&&r+".")+l,value:a[l],valueSpec:m,style:E,styleSpec:i,object:a,objectKey:l},a))}for(var T in d)g[T]||d[T].required&&d[T].default===void 0&&a[T]===void 0&&t.push(new Ie(r,a,'missing required property "'+T+'"'));return t}function Os(e){var r=e.value,a=e.valueSpec,d=e.style,g=e.styleSpec,E=e.key,i=e.arrayElementValidator||bi;if(Qi(r)!=="array")return[new Ie(E,r,"array expected, "+Qi(r)+" found")];if(a.length&&r.length!==a.length)return[new Ie(E,r,"array length "+a.length+" expected, length "+r.length+" found")];if(a["min-length"]&&r.length<a["min-length"])return[new Ie(E,r,"array length at least "+a["min-length"]+" expected, length "+r.length+" found")];var t={type:a.value,values:a.values};g.$version<7&&(t.function=a.function),Qi(a.value)==="object"&&(t=a.value);for(var o=[],l=0;l<r.length;l++)o=o.concat(i({array:r,arrayIndex:l,value:r[l],valueSpec:t,style:d,styleSpec:g,key:E+"["+l+"]"}));return o}function Fs(e){var r=e.key,a=e.value,d=e.valueSpec,g=Qi(a);return g==="number"&&a!=a&&(g="NaN"),g!=="number"?[new Ie(r,a,"number expected, "+g+" found")]:"minimum"in d&&a<d.minimum?[new Ie(r,a,a+" is less than the minimum value "+d.minimum)]:"maximum"in d&&a>d.maximum?[new Ie(r,a,a+" is greater than the maximum value "+d.maximum)]:[]}function $a(e){var r,a,d,g=e.valueSpec,E=F(e.value.type),i={},t=E!=="categorical"&&e.value.property===void 0,o=!t,l=Qi(e.value.stops)==="array"&&Qi(e.value.stops[0])==="array"&&Qi(e.value.stops[0][0])==="object",p=fo({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(T){if(E==="identity")return[new Ie(T.key,T.value,'identity function may not have a "stops" property')];var C=[],k=T.value;return C=C.concat(Os({key:T.key,value:k,valueSpec:T.valueSpec,style:T.style,styleSpec:T.styleSpec,arrayElementValidator:m})),Qi(k)==="array"&&k.length===0&&C.push(new Ie(T.key,k,"array must have at least one stop")),C},default:function(T){return bi({key:T.key,value:T.value,valueSpec:g,style:T.style,styleSpec:T.styleSpec})}}});return E==="identity"&&t&&p.push(new Ie(e.key,e.value,'missing required property "property"')),E==="identity"||e.value.stops||p.push(new Ie(e.key,e.value,'missing required property "stops"')),E==="exponential"&&e.valueSpec.expression&&!Ca(e.valueSpec)&&p.push(new Ie(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(o&&!Xo(e.valueSpec)?p.push(new Ie(e.key,e.value,"property functions not supported")):t&&!Rs(e.valueSpec)&&p.push(new Ie(e.key,e.value,"zoom functions not supported"))),E!=="categorical"&&!l||e.value.property!==void 0||p.push(new Ie(e.key,e.value,'"property" property is required')),p;function m(T){var C=[],k=T.value,R=T.key;if(Qi(k)!=="array")return[new Ie(R,k,"array expected, "+Qi(k)+" found")];if(k.length!==2)return[new Ie(R,k,"array length 2 expected, length "+k.length+" found")];if(l){if(Qi(k[0])!=="object")return[new Ie(R,k,"object expected, "+Qi(k[0])+" found")];if(k[0].zoom===void 0)return[new Ie(R,k,"object stop key must have zoom")];if(k[0].value===void 0)return[new Ie(R,k,"object stop key must have value")];if(d&&d>F(k[0].zoom))return[new Ie(R,k[0].zoom,"stop zoom values must appear in ascending order")];F(k[0].zoom)!==d&&(d=F(k[0].zoom),a=void 0,i={}),C=C.concat(fo({key:R+"[0]",value:k[0],valueSpec:{zoom:{}},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{zoom:Fs,value:_}}))}else C=C.concat(_({key:R+"[0]",value:k[0],valueSpec:{},style:T.style,styleSpec:T.styleSpec},k));return Za(U(k[1]))?C.concat([new Ie(R+"[1]",k[1],"expressions are not allowed in function stops.")]):C.concat(bi({key:R+"[1]",value:k[1],valueSpec:g,style:T.style,styleSpec:T.styleSpec}))}function _(T,C){var k=Qi(T.value),R=F(T.value),D=T.value!==null?T.value:C;if(r){if(k!==r)return[new Ie(T.key,D,k+" stop domain type must match previous stop domain type "+r)]}else r=k;if(k!=="number"&&k!=="string"&&k!=="boolean")return[new Ie(T.key,D,"stop domain value must be a number, string, or boolean")];if(k!=="number"&&E!=="categorical"){var V="number expected, "+k+" found";return Xo(g)&&E===void 0&&(V+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ie(T.key,D,V)]}return E!=="categorical"||k!=="number"||isFinite(R)&&Math.floor(R)===R?E!=="categorical"&&k==="number"&&a!==void 0&&R<a?[new Ie(T.key,D,"stop domain values must appear in ascending order")]:(a=R,E==="categorical"&&R in i?[new Ie(T.key,D,"stop domain values must be unique")]:(i[R]=!0,[])):[new Ie(T.key,D,"integer expected, found "+R)]}}function ko(e){var r=(e.expressionContext==="property"?ql:Bs)(U(e.value),e.valueSpec);if(r.result==="error")return r.value.map(function(d){return new Ie(""+e.key+d.key,e.value,d.message)});var a=r.value.expression||r.value._styleExpression.expression;if(e.expressionContext==="property"&&e.propertyKey==="text-font"&&!a.outputDefined())return[new Ie(e.key,e.value,'Invalid data expression for "'+e.propertyKey+'". Output values must be contained as literals within the expression.')];if(e.expressionContext==="property"&&e.propertyType==="layout"&&!qo(a))return[new Ie(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if(e.expressionContext==="filter"&&!qo(a))return[new Ie(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&e.expressionContext.indexOf("cluster")===0){if(!ba(a,["zoom","feature-state"]))return[new Ie(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(e.expressionContext==="cluster-initial"&&!jo(a))return[new Ie(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function us(e){var r=e.key,a=e.value,d=e.valueSpec,g=[];return Array.isArray(d.values)?d.values.indexOf(F(a))===-1&&g.push(new Ie(r,a,"expected one of ["+d.values.join(", ")+"], "+JSON.stringify(a)+" found")):Object.keys(d.values).indexOf(F(a))===-1&&g.push(new Ie(r,a,"expected one of ["+Object.keys(d.values).join(", ")+"], "+JSON.stringify(a)+" found")),g}function Pa(e){if(e===!0||e===!1)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case"has":return e.length>=2&&e[1]!=="$id"&&e[1]!=="$type";case"in":return e.length>=3&&(typeof e[1]!="string"||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(var r=0,a=e.slice(1);r<a.length;r+=1){var d=a[r];if(!Pa(d)&&typeof d!="boolean")return!1}return!0;default:return!0}}Wo.deserialize=function(e){return new Wo(e._parameters,e._specification)},Wo.serialize=function(e){return{_parameters:e._parameters,_specification:e._specification}};var fl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Us(e){if(e==null)return{filter:function(){return!0},needGeometry:!1};Pa(e)||(e=ca(e));var r=Bs(e,fl);if(r.result==="error")throw new Error(r.value.map(function(a){return a.key+": "+a.message}).join(", "));return{filter:function(a,d,g){return r.value.evaluate(a,d,{},g)},needGeometry:function a(d){if(!Array.isArray(d))return!1;if(d[0]==="within")return!0;for(var g=1;g<d.length;g++)if(a(d[g]))return!0;return!1}(e)}}function yu(e,r){return e<r?-1:e>r?1:0}function ca(e){if(!e)return!0;var r,a=e[0];return e.length<=1?a!=="any":a==="=="?ml(e[1],e[2],"=="):a==="!="?Tn(ml(e[1],e[2],"==")):a==="<"||a===">"||a==="<="||a===">="?ml(e[1],e[2],a):a==="any"?(r=e.slice(1),["any"].concat(r.map(ca))):a==="all"?["all"].concat(e.slice(1).map(ca)):a==="none"?["all"].concat(e.slice(1).map(ca).map(Tn)):a==="in"?cs(e[1],e.slice(2)):a==="!in"?Tn(cs(e[1],e.slice(2))):a==="has"?hs(e[1]):a==="!has"?Tn(hs(e[1])):a!=="within"||e}function ml(e,r,a){switch(e){case"$type":return["filter-type-"+a,r];case"$id":return["filter-id-"+a,r];default:return["filter-"+a,e,r]}}function cs(e,r){if(r.length===0)return!1;switch(e){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(function(a){return typeof a!=typeof r[0]})?["filter-in-large",e,["literal",r.sort(yu)]]:["filter-in-small",e,["literal",r]]}}function hs(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Tn(e){return["!",e]}function In(e){return Pa(U(e.value))?ko(Q({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function r(a){var d=a.value,g=a.key;if(Qi(d)!=="array")return[new Ie(g,d,"array expected, "+Qi(d)+" found")];var E,i=a.styleSpec,t=[];if(d.length<1)return[new Ie(g,d,"filter array must have at least 1 element")];switch(t=t.concat(us({key:g+"[0]",value:d[0],valueSpec:i.filter_operator,style:a.style,styleSpec:a.styleSpec})),F(d[0])){case"<":case"<=":case">":case">=":d.length>=2&&F(d[1])==="$type"&&t.push(new Ie(g,d,'"$type" cannot be use with operator "'+d[0]+'"'));case"==":case"!=":d.length!==3&&t.push(new Ie(g,d,'filter array for operator "'+d[0]+'" must have 3 elements'));case"in":case"!in":d.length>=2&&(E=Qi(d[1]))!=="string"&&t.push(new Ie(g+"[1]",d[1],"string expected, "+E+" found"));for(var o=2;o<d.length;o++)E=Qi(d[o]),F(d[1])==="$type"?t=t.concat(us({key:g+"["+o+"]",value:d[o],valueSpec:i.geometry_type,style:a.style,styleSpec:a.styleSpec})):E!=="string"&&E!=="number"&&E!=="boolean"&&t.push(new Ie(g+"["+o+"]",d[o],"string, number, or boolean expected, "+E+" found"));break;case"any":case"all":case"none":for(var l=1;l<d.length;l++)t=t.concat(r({key:g+"["+l+"]",value:d[l],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":E=Qi(d[1]),d.length!==2?t.push(new Ie(g,d,'filter array for "'+d[0]+'" operator must have 2 elements')):E!=="string"&&t.push(new Ie(g+"[1]",d[1],"string expected, "+E+" found"));break;case"within":E=Qi(d[1]),d.length!==2?t.push(new Ie(g,d,'filter array for "'+d[0]+'" operator must have 2 elements')):E!=="object"&&t.push(new Ie(g+"[1]",d[1],"object expected, "+E+" found"))}return t}(e)}function Gl(e,r){var a=e.key,d=e.style,g=e.styleSpec,E=e.value,i=e.objectKey,t=g[r+"_"+e.layerType];if(!t)return[];var o=i.match(/^(.*)-transition$/);if(r==="paint"&&o&&t[o[1]]&&t[o[1]].transition)return bi({key:a,value:E,valueSpec:g.transition,style:d,styleSpec:g});var l,p=e.valueSpec||t[i];if(!p)return[new Ie(a,E,'unknown property "'+i+'"')];if(Qi(E)==="string"&&Xo(p)&&!p.tokens&&(l=/^{([^}]+)}$/.exec(E)))return[new Ie(a,E,'"'+i+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(l[1])+" }`.")];var m=[];return e.layerType==="symbol"&&(i==="text-field"&&d&&!d.glyphs&&m.push(new Ie(a,E,'use of "text-field" requires a style "glyphs" property')),i==="text-font"&&aa(U(E))&&F(E.type)==="identity"&&m.push(new Ie(a,E,'"text-font" does not support identity functions'))),m.concat(bi({key:e.key,value:E,valueSpec:p,style:d,styleSpec:g,expressionContext:"property",propertyType:r,propertyKey:i}))}function ha(e){return Gl(e,"paint")}function ps(e){return Gl(e,"layout")}function Xa(e){var r=[],a=e.value,d=e.key,g=e.style,E=e.styleSpec;a.type||a.ref||r.push(new Ie(d,a,'either "type" or "ref" is required'));var i,t=F(a.type),o=F(a.ref);if(a.id)for(var l=F(a.id),p=0;p<e.arrayIndex;p++){var m=g.layers[p];F(m.id)===l&&r.push(new Ie(d,a.id,'duplicate layer id "'+a.id+'", previously used at line '+m.id.__line__))}if("ref"in a)["type","source","source-layer","filter","layout"].forEach(function(C){C in a&&r.push(new Ie(d,a[C],'"'+C+'" is prohibited for ref layers'))}),g.layers.forEach(function(C){F(C.id)===o&&(i=C)}),i?i.ref?r.push(new Ie(d,a.ref,"ref cannot reference another ref layer")):t=F(i.type):r.push(new Ie(d,a.ref,'ref layer "'+o+'" not found'));else if(t!=="background")if(a.source){var _=g.sources&&g.sources[a.source],T=_&&F(_.type);_?T==="vector"&&t==="raster"?r.push(new Ie(d,a.source,'layer "'+a.id+'" requires a raster source')):T==="raster"&&t!=="raster"?r.push(new Ie(d,a.source,'layer "'+a.id+'" requires a vector source')):T!=="vector"||a["source-layer"]?T==="raster-dem"&&t!=="hillshade"?r.push(new Ie(d,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):t!=="line"||!a.paint||!a.paint["line-gradient"]||T==="geojson"&&_.lineMetrics||r.push(new Ie(d,a,'layer "'+a.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):r.push(new Ie(d,a,'layer "'+a.id+'" must specify a "source-layer"')):r.push(new Ie(d,a.source,'source "'+a.source+'" not found'))}else r.push(new Ie(d,a,'missing required property "source"'));return r=r.concat(fo({key:d,value:a,valueSpec:E.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return bi({key:d+".type",value:a.type,valueSpec:E.layer.type,style:e.style,styleSpec:e.styleSpec,object:a,objectKey:"type"})},filter:In,layout:function(C){return fo({layer:a,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":function(k){return ps(Q({layerType:t},k))}}})},paint:function(C){return fo({layer:a,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":function(k){return ha(Q({layerType:t},k))}}})}}}))}function mo(e){var r=e.value,a=e.key,d=Qi(r);return d!=="string"?[new Ie(a,r,"string expected, "+d+" found")]:[]}var ur={promoteId:function(e){var r=e.key,a=e.value;if(Qi(a)==="string")return mo({key:r,value:a});var d=[];for(var g in a)d.push.apply(d,mo({key:r+"."+g,value:a[g]}));return d}};function ds(e){var r=e.value,a=e.key,d=e.styleSpec,g=e.style;if(!r.type)return[new Ie(a,r,'"type" is required')];var E,i=F(r.type);switch(i){case"vector":case"raster":case"raster-dem":return fo({key:a,value:r,valueSpec:d["source_"+i.replace("-","_")],style:e.style,styleSpec:d,objectElementValidators:ur});case"geojson":if(E=fo({key:a,value:r,valueSpec:d.source_geojson,style:g,styleSpec:d,objectElementValidators:ur}),r.cluster)for(var t in r.clusterProperties){var o=r.clusterProperties[t],l=o[0],p=typeof l=="string"?[l,["accumulated"],["get",t]]:l;E.push.apply(E,ko({key:a+"."+t+".map",value:o[1],expressionContext:"cluster-map"})),E.push.apply(E,ko({key:a+"."+t+".reduce",value:p,expressionContext:"cluster-reduce"}))}return E;case"video":return fo({key:a,value:r,valueSpec:d.source_video,style:g,styleSpec:d});case"image":return fo({key:a,value:r,valueSpec:d.source_image,style:g,styleSpec:d});case"canvas":return[new Ie(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return us({key:a+".type",value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,styleSpec:d})}}function Wa(e){var r=e.value,a=e.styleSpec,d=a.light,g=e.style,E=[],i=Qi(r);if(r===void 0)return E;if(i!=="object")return E.concat([new Ie("light",r,"object expected, "+i+" found")]);for(var t in r){var o=t.match(/^(.*)-transition$/);E=E.concat(o&&d[o[1]]&&d[o[1]].transition?bi({key:t,value:r[t],valueSpec:a.transition,style:g,styleSpec:a}):d[t]?bi({key:t,value:r[t],valueSpec:d[t],style:g,styleSpec:a}):[new Ie(t,r[t],'unknown property "'+t+'"')])}return E}var pa={"*":function(){return[]},array:Os,boolean:function(e){var r=e.value,a=e.key,d=Qi(r);return d!=="boolean"?[new Ie(a,r,"boolean expected, "+d+" found")]:[]},number:Fs,color:function(e){var r=e.key,a=e.value,d=Qi(a);return d!=="string"?[new Ie(r,a,"color expected, "+d+" found")]:Pt(a)===null?[new Ie(r,a,'color expected, "'+a+'" found')]:[]},constants:qe,enum:us,filter:In,function:$a,layer:Xa,object:fo,source:ds,light:Wa,string:mo,formatted:function(e){return mo(e).length===0?[]:ko(e)},resolvedImage:function(e){return mo(e).length===0?[]:ko(e)}};function bi(e){var r=e.value,a=e.valueSpec,d=e.styleSpec;return a.expression&&aa(F(r))?$a(e):a.expression&&Za(U(r))?ko(e):a.type&&pa[a.type]?pa[a.type](e):fo(Q({},e,{valueSpec:a.type?d[a.type]:a}))}function ji(e){var r=e.value,a=e.key,d=mo(e);return d.length||(r.indexOf("{fontstack}")===-1&&d.push(new Ie(a,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&d.push(new Ie(a,r,'"glyphs" url must include a "{range}" token'))),d}function kt(e,r){r===void 0&&(r=ce);var a=[];return a=a.concat(bi({key:"",value:e,valueSpec:r.$root,styleSpec:r,style:e,objectElementValidators:{glyphs:ji,"*":function(){return[]}}})),e.constants&&(a=a.concat(qe({key:"constants",value:e.constants,style:e,styleSpec:r}))),Ha(a)}function Ha(e){return[].concat(e).sort(function(r,a){return r.line-a.line})}function Ho(e){return function(){for(var r=[],a=arguments.length;a--;)r[a]=arguments[a];return Ha(e.apply(this,r))}}kt.source=Ho(ds),kt.light=Ho(Wa),kt.layer=Ho(Xa),kt.filter=Ho(In),kt.paintProperty=Ho(ha),kt.layoutProperty=Ho(ps);var Mo=kt,Vs=Mo.light,Ot=Mo.paintProperty,Ka=Mo.layoutProperty;function fs(e,r){var a=!1;if(r&&r.length)for(var d=0,g=r;d<g.length;d+=1)e.fire(new Me(new Error(g[d].message))),a=!0;return a}var da=dr;function dr(e,r,a){var d=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var g=new Int32Array(this.arrayBuffer);e=g[0],this.d=(r=g[1])+2*(a=g[2]);for(var E=0;E<this.d*this.d;E++){var i=g[3+E],t=g[3+E+1];d.push(i===t?null:g.subarray(i,t))}var o=g[3+d.length+1];this.keys=g.subarray(g[3+d.length],o),this.bboxes=g.subarray(o),this.insert=this._insertReadonly}else{this.d=r+2*a;for(var l=0;l<this.d*this.d;l++)d.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=a,this.scale=r/e,this.uid=0;var p=a/r*e;this.min=-p,this.max=e+p}dr.prototype.insert=function(e,r,a,d,g){this._forEachCell(r,a,d,g,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(d),this.bboxes.push(g)},dr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},dr.prototype._insertCell=function(e,r,a,d,g,E){this.cells[g].push(E)},dr.prototype.query=function(e,r,a,d,g){var E=this.min,i=this.max;if(e<=E&&r<=E&&i<=a&&i<=d&&!g)return Array.prototype.slice.call(this.keys);var t=[];return this._forEachCell(e,r,a,d,this._queryCell,t,{},g),t},dr.prototype._queryCell=function(e,r,a,d,g,E,i,t){var o=this.cells[g];if(o!==null)for(var l=this.keys,p=this.bboxes,m=0;m<o.length;m++){var _=o[m];if(i[_]===void 0){var T=4*_;(t?t(p[T+0],p[T+1],p[T+2],p[T+3]):e<=p[T+2]&&r<=p[T+3]&&a>=p[T+0]&&d>=p[T+1])?(i[_]=!0,E.push(l[_])):i[_]=!1}}},dr.prototype._forEachCell=function(e,r,a,d,g,E,i,t){for(var o=this._convertToCellCoord(e),l=this._convertToCellCoord(r),p=this._convertToCellCoord(a),m=this._convertToCellCoord(d),_=o;_<=p;_++)for(var T=l;T<=m;T++){var C=this.d*T+_;if((!t||t(this._convertFromCellCoord(_),this._convertFromCellCoord(T),this._convertFromCellCoord(_+1),this._convertFromCellCoord(T+1)))&&g.call(this,e,r,a,d,C,E,i,t))return}},dr.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},dr.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},dr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,r=3+this.cells.length+1+1,a=0,d=0;d<this.cells.length;d++)a+=this.cells[d].length;var g=new Int32Array(r+a+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var E=r,i=0;i<e.length;i++){var t=e[i];g[3+i]=E,g.set(t,E),E+=t.length}return g[3+e.length]=E,g.set(this.keys,E),g[3+e.length+1]=E+=this.keys.length,g.set(this.bboxes,E),E+=this.bboxes.length,g.buffer};var ms=Se.ImageData,Zl=Se.ImageBitmap,zr={};function Ut(e,r,a){a===void 0&&(a={}),Object.defineProperty(r,"_classRegistryKey",{value:e,writeable:!1}),zr[e]={klass:r,omit:a.omit||[],shallow:a.shallow||[]}}for(var gn in Ut("Object",Object),da.serialize=function(e,r){var a=e.toArrayBuffer();return r&&r.push(a),{buffer:a}},da.deserialize=function(e){return new da(e.buffer)},Ut("Grid",da),Ut("Color",oi),Ut("Error",Error),Ut("ResolvedImage",yn),Ut("StylePropertyFunction",Wo),Ut("StyleExpression",la,{omit:["_evaluator"]}),Ut("ZoomDependentExpression",ua),Ut("ZoomConstantExpression",za),Ut("CompoundExpression",Er,{omit:["_evaluate"]}),Yi)Yi[gn]._classRegistryKey||Ut("Expression_"+gn,Yi[gn]);function ys(e){return e&&typeof ArrayBuffer!="undefined"&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name==="ArrayBuffer")}function ka(e){return Zl&&e instanceof Zl}function yo(e,r){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(ys(e)||ka(e))return r&&r.push(e),e;if(ArrayBuffer.isView(e)){var a=e;return r&&r.push(a.buffer),a}if(e instanceof ms)return r&&r.push(e.data.buffer),e;if(Array.isArray(e)){for(var d=[],g=0,E=e;g<E.length;g+=1)d.push(yo(E[g],r));return d}if(typeof e=="object"){var i=e.constructor,t=i._classRegistryKey;if(!t)throw new Error("can't serialize object of unregistered class");var o=i.serialize?i.serialize(e,r):{};if(!i.serialize){for(var l in e)if(e.hasOwnProperty(l)&&!(zr[t].omit.indexOf(l)>=0)){var p=e[l];o[l]=zr[t].shallow.indexOf(l)>=0?p:yo(p,r)}e instanceof Error&&(o.message=e.message)}if(o.$name)throw new Error("$name property is reserved for worker serialization logic.");return t!=="Object"&&(o.$name=t),o}throw new Error("can't serialize object of type "+typeof e)}function cr(e){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||ys(e)||ka(e)||ArrayBuffer.isView(e)||e instanceof ms)return e;if(Array.isArray(e))return e.map(cr);if(typeof e=="object"){var r=e.$name||"Object",a=zr[r].klass;if(!a)throw new Error("can't deserialize unregistered class "+r);if(a.deserialize)return a.deserialize(e);for(var d=Object.create(a.prototype),g=0,E=Object.keys(e);g<E.length;g+=1){var i=E[g];if(i!=="$name"){var t=e[i];d[i]=zr[r].shallow.indexOf(i)>=0?t:cr(t)}}return d}throw new Error("can't deserialize object of type "+typeof e)}var Ko=function(){this.first=!0};Ko.prototype.update=function(e,r){var a=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=a,!0))};var St={"Latin-1 Supplement":function(e){return e>=128&&e<=255},Arabic:function(e){return e>=1536&&e<=1791},"Arabic Supplement":function(e){return e>=1872&&e<=1919},"Arabic Extended-A":function(e){return e>=2208&&e<=2303},"Hangul Jamo":function(e){return e>=4352&&e<=4607},"Unified Canadian Aboriginal Syllabics":function(e){return e>=5120&&e<=5759},Khmer:function(e){return e>=6016&&e<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(e){return e>=6320&&e<=6399},"General Punctuation":function(e){return e>=8192&&e<=8303},"Letterlike Symbols":function(e){return e>=8448&&e<=8527},"Number Forms":function(e){return e>=8528&&e<=8591},"Miscellaneous Technical":function(e){return e>=8960&&e<=9215},"Control Pictures":function(e){return e>=9216&&e<=9279},"Optical Character Recognition":function(e){return e>=9280&&e<=9311},"Enclosed Alphanumerics":function(e){return e>=9312&&e<=9471},"Geometric Shapes":function(e){return e>=9632&&e<=9727},"Miscellaneous Symbols":function(e){return e>=9728&&e<=9983},"Miscellaneous Symbols and Arrows":function(e){return e>=11008&&e<=11263},"CJK Radicals Supplement":function(e){return e>=11904&&e<=12031},"Kangxi Radicals":function(e){return e>=12032&&e<=12255},"Ideographic Description Characters":function(e){return e>=12272&&e<=12287},"CJK Symbols and Punctuation":function(e){return e>=12288&&e<=12351},Hiragana:function(e){return e>=12352&&e<=12447},Katakana:function(e){return e>=12448&&e<=12543},Bopomofo:function(e){return e>=12544&&e<=12591},"Hangul Compatibility Jamo":function(e){return e>=12592&&e<=12687},Kanbun:function(e){return e>=12688&&e<=12703},"Bopomofo Extended":function(e){return e>=12704&&e<=12735},"CJK Strokes":function(e){return e>=12736&&e<=12783},"Katakana Phonetic Extensions":function(e){return e>=12784&&e<=12799},"Enclosed CJK Letters and Months":function(e){return e>=12800&&e<=13055},"CJK Compatibility":function(e){return e>=13056&&e<=13311},"CJK Unified Ideographs Extension A":function(e){return e>=13312&&e<=19903},"Yijing Hexagram Symbols":function(e){return e>=19904&&e<=19967},"CJK Unified Ideographs":function(e){return e>=19968&&e<=40959},"Yi Syllables":function(e){return e>=40960&&e<=42127},"Yi Radicals":function(e){return e>=42128&&e<=42191},"Hangul Jamo Extended-A":function(e){return e>=43360&&e<=43391},"Hangul Syllables":function(e){return e>=44032&&e<=55215},"Hangul Jamo Extended-B":function(e){return e>=55216&&e<=55295},"Private Use Area":function(e){return e>=57344&&e<=63743},"CJK Compatibility Ideographs":function(e){return e>=63744&&e<=64255},"Arabic Presentation Forms-A":function(e){return e>=64336&&e<=65023},"Vertical Forms":function(e){return e>=65040&&e<=65055},"CJK Compatibility Forms":function(e){return e>=65072&&e<=65103},"Small Form Variants":function(e){return e>=65104&&e<=65135},"Arabic Presentation Forms-B":function(e){return e>=65136&&e<=65279},"Halfwidth and Fullwidth Forms":function(e){return e>=65280&&e<=65519}};function Ns(e){for(var r=0,a=e;r<a.length;r+=1)if(fa(a[r].charCodeAt(0)))return!0;return!1}function fa(e){return!(e!==746&&e!==747&&(e<4352||!(St["Bopomofo Extended"](e)||St.Bopomofo(e)||St["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||St["CJK Compatibility Ideographs"](e)||St["CJK Compatibility"](e)||St["CJK Radicals Supplement"](e)||St["CJK Strokes"](e)||!(!St["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||e===12336)||St["CJK Unified Ideographs Extension A"](e)||St["CJK Unified Ideographs"](e)||St["Enclosed CJK Letters and Months"](e)||St["Hangul Compatibility Jamo"](e)||St["Hangul Jamo Extended-A"](e)||St["Hangul Jamo Extended-B"](e)||St["Hangul Jamo"](e)||St["Hangul Syllables"](e)||St.Hiragana(e)||St["Ideographic Description Characters"](e)||St.Kanbun(e)||St["Kangxi Radicals"](e)||St["Katakana Phonetic Extensions"](e)||St.Katakana(e)&&e!==12540||!(!St["Halfwidth and Fullwidth Forms"](e)||e===65288||e===65289||e===65293||e>=65306&&e<=65310||e===65339||e===65341||e===65343||e>=65371&&e<=65503||e===65507||e>=65512&&e<=65519)||!(!St["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||St["Unified Canadian Aboriginal Syllabics"](e)||St["Unified Canadian Aboriginal Syllabics Extended"](e)||St["Vertical Forms"](e)||St["Yijing Hexagram Symbols"](e)||St["Yi Syllables"](e)||St["Yi Radicals"](e))))}function js(e){return!(fa(e)||function(r){return!!(St["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||St["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||St["Letterlike Symbols"](r)||St["Number Forms"](r)||St["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||St["Control Pictures"](r)&&r!==9251||St["Optical Character Recognition"](r)||St["Enclosed Alphanumerics"](r)||St["Geometric Shapes"](r)||St["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||St["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||St["CJK Symbols and Punctuation"](r)||St.Katakana(r)||St["Private Use Area"](r)||St["CJK Compatibility Forms"](r)||St["Small Form Variants"](r)||St["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)}(e))}function Rn(e){return e>=1424&&e<=2303||St["Arabic Presentation Forms-A"](e)||St["Arabic Presentation Forms-B"](e)}function fr(e,r){return!(!r&&Rn(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||St.Khmer(e))}function or(e){for(var r=0,a=e;r<a.length;r+=1)if(Rn(a[r].charCodeAt(0)))return!0;return!1}var Ja=null,_n="unavailable",Lo=null,$l=function(e){e&&typeof e=="string"&&e.indexOf("NetworkError")>-1&&(_n="error"),Ja&&Ja(e)};function gs(){Xl.fire(new xe("pluginStateChange",{pluginStatus:_n,pluginURL:Lo}))}var Xl=new De,Eo=function(){return _n},Wn=function(){if(_n!=="deferred"||!Lo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");_n="loading",gs(),Lo&&Ln({url:Lo},function(e){e?$l(e):(_n="loaded",gs())})},Vt={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return _n==="loaded"||Vt.applyArabicShaping!=null},isLoading:function(){return _n==="loading"},setState:function(e){_n=e.pluginStatus,Lo=e.pluginURL},isParsed:function(){return Vt.applyArabicShaping!=null&&Vt.processBidirectionalText!=null&&Vt.processStyledBidirectionalText!=null},getPluginURL:function(){return Lo}},wt=function(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ko,this.transition={})};wt.prototype.isSupportedScript=function(e){return function(r,a){for(var d=0,g=r;d<g.length;d+=1)if(!fr(g[d].charCodeAt(0),a))return!1;return!0}(e,Vt.isLoaded())},wt.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},wt.prototype.getCrossfadeParameters=function(){var e=this.zoom,r=e-Math.floor(e),a=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*r}};var Hn=function(e,r){this.property=e,this.value=r,this.expression=function(a,d){if(aa(a))return new Wo(a,d);if(Za(a)){var g=ql(a,d);if(g.result==="error")throw new Error(g.value.map(function(i){return i.key+": "+i.message}).join(", "));return g.value}var E=a;return typeof a=="string"&&d.type==="color"&&(E=oi.parse(a)),{kind:"constant",evaluate:function(){return E}}}(r===void 0?e.specification.default:r,e.specification)};Hn.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Hn.prototype.possiblyEvaluate=function(e,r,a){return this.property.possiblyEvaluate(this,e,r,a)};var An=function(e){this.property=e,this.value=new Hn(e,void 0)};An.prototype.transitioned=function(e,r){return new mr(this.property,this.value,r,mi({},e.transition,this.transition),e.now)},An.prototype.untransitioned=function(){return new mr(this.property,this.value,null,{},0)};var Nr=function(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)};Nr.prototype.getValue=function(e){return hn(this._values[e].value.value)},Nr.prototype.setValue=function(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new An(this._values[e].property)),this._values[e].value=new Hn(this._values[e].property,r===null?void 0:hn(r))},Nr.prototype.getTransition=function(e){return hn(this._values[e].transition)},Nr.prototype.setTransition=function(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new An(this._values[e].property)),this._values[e].transition=hn(r)||void 0},Nr.prototype.serialize=function(){for(var e={},r=0,a=Object.keys(this._values);r<a.length;r+=1){var d=a[r],g=this.getValue(d);g!==void 0&&(e[d]=g);var E=this.getTransition(d);E!==void 0&&(e[d+"-transition"]=E)}return e},Nr.prototype.transitioned=function(e,r){for(var a=new Kn(this._properties),d=0,g=Object.keys(this._values);d<g.length;d+=1){var E=g[d];a._values[E]=this._values[E].transitioned(e,r._values[E])}return a},Nr.prototype.untransitioned=function(){for(var e=new Kn(this._properties),r=0,a=Object.keys(this._values);r<a.length;r+=1){var d=a[r];e._values[d]=this._values[d].untransitioned()}return e};var mr=function(e,r,a,d,g){this.property=e,this.value=r,this.begin=g+d.delay||0,this.end=this.begin+d.duration||0,e.specification.transition&&(d.delay||d.duration)&&(this.prior=a)};mr.prototype.possiblyEvaluate=function(e,r,a){var d=e.now||0,g=this.value.possiblyEvaluate(e,r,a),E=this.prior;if(E){if(d>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(d<this.begin)return E.possiblyEvaluate(e,r,a);var i=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(E.possiblyEvaluate(e,r,a),g,function(t){if(t<=0)return 0;if(t>=1)return 1;var o=t*t,l=o*t;return 4*(t<.5?l:3*(t-o)+l-.75)}(i))}return g};var Kn=function(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)};Kn.prototype.possiblyEvaluate=function(e,r,a){for(var d=new ma(this._properties),g=0,E=Object.keys(this._values);g<E.length;g+=1){var i=E[g];d._values[i]=this._values[i].possiblyEvaluate(e,r,a)}return d},Kn.prototype.hasTransition=function(){for(var e=0,r=Object.keys(this._values);e<r.length;e+=1)if(this._values[r[e]].prior)return!0;return!1};var vr=function(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)};vr.prototype.getValue=function(e){return hn(this._values[e].value)},vr.prototype.setValue=function(e,r){this._values[e]=new Hn(this._values[e].property,r===null?void 0:hn(r))},vr.prototype.serialize=function(){for(var e={},r=0,a=Object.keys(this._values);r<a.length;r+=1){var d=a[r],g=this.getValue(d);g!==void 0&&(e[d]=g)}return e},vr.prototype.possiblyEvaluate=function(e,r,a){for(var d=new ma(this._properties),g=0,E=Object.keys(this._values);g<E.length;g+=1){var i=E[g];d._values[i]=this._values[i].possiblyEvaluate(e,r,a)}return d};var Cn=function(e,r,a){this.property=e,this.value=r,this.parameters=a};Cn.prototype.isConstant=function(){return this.value.kind==="constant"},Cn.prototype.constantOr=function(e){return this.value.kind==="constant"?this.value.value:e},Cn.prototype.evaluate=function(e,r,a,d){return this.property.evaluate(this.value,this.parameters,e,r,a,d)};var ma=function(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)};ma.prototype.get=function(e){return this._values[e]};var At=function(e){this.specification=e};At.prototype.possiblyEvaluate=function(e,r){return e.expression.evaluate(r)},At.prototype.interpolate=function(e,r,a){var d=sn[this.specification.type];return d?d(e,r,a):e};var Tt=function(e,r){this.specification=e,this.overrides=r};Tt.prototype.possiblyEvaluate=function(e,r,a,d){return new Cn(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},a,d)}:e.expression,r)},Tt.prototype.interpolate=function(e,r,a){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new Cn(this,{kind:"constant",value:void 0},e.parameters);var d=sn[this.specification.type];return d?new Cn(this,{kind:"constant",value:d(e.value.value,r.value.value,a)},e.parameters):e},Tt.prototype.evaluate=function(e,r,a,d,g,E){return e.kind==="constant"?e.value:e.evaluate(r,a,d,g,E)};var qs=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.possiblyEvaluate=function(a,d,g,E){if(a.value===void 0)return new Cn(this,{kind:"constant",value:void 0},d);if(a.expression.kind==="constant"){var i=a.expression.evaluate(d,null,{},g,E),t=a.property.specification.type==="resolvedImage"&&typeof i!="string"?i.name:i,o=this._calculate(t,t,t,d);return new Cn(this,{kind:"constant",value:o},d)}if(a.expression.kind==="camera"){var l=this._calculate(a.expression.evaluate({zoom:d.zoom-1}),a.expression.evaluate({zoom:d.zoom}),a.expression.evaluate({zoom:d.zoom+1}),d);return new Cn(this,{kind:"constant",value:l},d)}return new Cn(this,a.expression,d)},r.prototype.evaluate=function(a,d,g,E,i,t){if(a.kind==="source"){var o=a.evaluate(d,g,E,i,t);return this._calculate(o,o,o,d)}return a.kind==="composite"?this._calculate(a.evaluate({zoom:Math.floor(d.zoom)-1},g,E),a.evaluate({zoom:Math.floor(d.zoom)},g,E),a.evaluate({zoom:Math.floor(d.zoom)+1},g,E),d):a.value},r.prototype._calculate=function(a,d,g,E){return E.zoom>E.zoomHistory.lastIntegerZoom?{from:a,to:d}:{from:g,to:d}},r.prototype.interpolate=function(a){return a},r}(Tt),Or=function(e){this.specification=e};Or.prototype.possiblyEvaluate=function(e,r,a,d){if(e.value!==void 0){if(e.expression.kind==="constant"){var g=e.expression.evaluate(r,null,{},a,d);return this._calculate(g,g,g,r)}return this._calculate(e.expression.evaluate(new wt(Math.floor(r.zoom-1),r)),e.expression.evaluate(new wt(Math.floor(r.zoom),r)),e.expression.evaluate(new wt(Math.floor(r.zoom+1),r)),r)}},Or.prototype._calculate=function(e,r,a,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:a,to:r}},Or.prototype.interpolate=function(e){return e};var Bn=function(e){this.specification=e};Bn.prototype.possiblyEvaluate=function(e,r,a,d){return!!e.expression.evaluate(r,null,{},a,d)},Bn.prototype.interpolate=function(){return!1};var b=function(e){for(var r in this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],e){var a=e[r];a.specification.overridable&&this.overridableProperties.push(r);var d=this.defaultPropertyValues[r]=new Hn(a,void 0),g=this.defaultTransitionablePropertyValues[r]=new An(a);this.defaultTransitioningPropertyValues[r]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=d.possiblyEvaluate({})}};Ut("DataDrivenProperty",Tt),Ut("DataConstantProperty",At),Ut("CrossFadedDataDrivenProperty",qs),Ut("CrossFadedProperty",Or),Ut("ColorRampProperty",Bn);var n=function(e){function r(a,d){if(e.call(this),this.id=a.id,this.type=a.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},a.type!=="custom"&&(this.metadata=(a=a).metadata,this.minzoom=a.minzoom,this.maxzoom=a.maxzoom,a.type!=="background"&&(this.source=a.source,this.sourceLayer=a["source-layer"],this.filter=a.filter),d.layout&&(this._unevaluatedLayout=new vr(d.layout)),d.paint)){for(var g in this._transitionablePaint=new Nr(d.paint),a.paint)this.setPaintProperty(g,a.paint[g],{validate:!1});for(var E in a.layout)this.setLayoutProperty(E,a.layout[E],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ma(d.paint)}}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},r.prototype.getLayoutProperty=function(a){return a==="visibility"?this.visibility:this._unevaluatedLayout.getValue(a)},r.prototype.setLayoutProperty=function(a,d,g){g===void 0&&(g={}),d!=null&&this._validate(Ka,"layers."+this.id+".layout."+a,a,d,g)||(a!=="visibility"?this._unevaluatedLayout.setValue(a,d):this.visibility=d)},r.prototype.getPaintProperty=function(a){return Lr(a,"-transition")?this._transitionablePaint.getTransition(a.slice(0,-11)):this._transitionablePaint.getValue(a)},r.prototype.setPaintProperty=function(a,d,g){if(g===void 0&&(g={}),d!=null&&this._validate(Ot,"layers."+this.id+".paint."+a,a,d,g))return!1;if(Lr(a,"-transition"))return this._transitionablePaint.setTransition(a.slice(0,-11),d||void 0),!1;var E=this._transitionablePaint._values[a],i=E.property.specification["property-type"]==="cross-faded-data-driven",t=E.value.isDataDriven(),o=E.value;this._transitionablePaint.setValue(a,d),this._handleSpecialPaintPropertyUpdate(a);var l=this._transitionablePaint._values[a].value;return l.isDataDriven()||t||i||this._handleOverridablePaintPropertyUpdate(a,o,l)},r.prototype._handleSpecialPaintPropertyUpdate=function(a){},r.prototype._handleOverridablePaintPropertyUpdate=function(a,d,g){return!1},r.prototype.isHidden=function(a){return!!(this.minzoom&&a<this.minzoom)||!!(this.maxzoom&&a>=this.maxzoom)||this.visibility==="none"},r.prototype.updateTransitions=function(a){this._transitioningPaint=this._transitionablePaint.transitioned(a,this._transitioningPaint)},r.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},r.prototype.recalculate=function(a,d){a.getCrossfadeParameters&&(this._crossfadeParameters=a.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(a,void 0,d)),this.paint=this._transitioningPaint.possiblyEvaluate(a,void 0,d)},r.prototype.serialize=function(){var a={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(a.layout=a.layout||{},a.layout.visibility=this.visibility),Fn(a,function(d,g){return!(d===void 0||g==="layout"&&!Object.keys(d).length||g==="paint"&&!Object.keys(d).length)})},r.prototype._validate=function(a,d,g,E,i){return i===void 0&&(i={}),(!i||i.validate!==!1)&&fs(this,a.call(Mo,{key:d,layerType:this.type,objectKey:g,value:E,styleSpec:ce,style:{glyphs:!0,sprite:!0}}))},r.prototype.is3D=function(){return!1},r.prototype.isTileClipped=function(){return!1},r.prototype.hasOffscreenPass=function(){return!1},r.prototype.resize=function(){},r.prototype.isStateDependent=function(){for(var a in this.paint._values){var d=this.paint.get(a);if(d instanceof Cn&&Xo(d.property.specification)&&(d.value.kind==="source"||d.value.kind==="composite")&&d.value.isStateDependent)return!0}return!1},r}(De),h={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},v=function(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},w=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function I(e,r){r===void 0&&(r=1);var a=0,d=0;return{members:e.map(function(g){var E=h[g.type].BYTES_PER_ELEMENT,i=a=L(a,Math.max(r,E)),t=g.components||1;return d=Math.max(d,E),a+=E*t,{name:g.name,type:g.type,components:t,offset:i}}),size:L(a,Math.max(d,r)),alignment:r}}function L(e,r){return Math.ceil(e/r)*r}w.serialize=function(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}},w.deserialize=function(e){var r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r},w.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},w.prototype.clear=function(){this.length=0},w.prototype.resize=function(e){this.reserve(e),this.length=e},w.prototype.reserve=function(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}},w.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var O=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d){var g=this.length;return this.resize(g+1),this.emplace(g,a,d)},r.prototype.emplace=function(a,d,g){var E=2*a;return this.int16[E+0]=d,this.int16[E+1]=g,a},r}(w);O.prototype.bytesPerElement=4,Ut("StructArrayLayout2i4",O);var N=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d,g,E){var i=this.length;return this.resize(i+1),this.emplace(i,a,d,g,E)},r.prototype.emplace=function(a,d,g,E,i){var t=4*a;return this.int16[t+0]=d,this.int16[t+1]=g,this.int16[t+2]=E,this.int16[t+3]=i,a},r}(w);N.prototype.bytesPerElement=8,Ut("StructArrayLayout4i8",N);var $=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d,g,E,i,t){var o=this.length;return this.resize(o+1),this.emplace(o,a,d,g,E,i,t)},r.prototype.emplace=function(a,d,g,E,i,t,o){var l=6*a;return this.int16[l+0]=d,this.int16[l+1]=g,this.int16[l+2]=E,this.int16[l+3]=i,this.int16[l+4]=t,this.int16[l+5]=o,a},r}(w);$.prototype.bytesPerElement=12,Ut("StructArrayLayout2i4i12",$);var H=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d,g,E,i,t){var o=this.length;return this.resize(o+1),this.emplace(o,a,d,g,E,i,t)},r.prototype.emplace=function(a,d,g,E,i,t,o){var l=4*a,p=8*a;return this.int16[l+0]=d,this.int16[l+1]=g,this.uint8[p+4]=E,this.uint8[p+5]=i,this.uint8[p+6]=t,this.uint8[p+7]=o,a},r}(w);H.prototype.bytesPerElement=8,Ut("StructArrayLayout2i4ub8",H);var re=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d){var g=this.length;return this.resize(g+1),this.emplace(g,a,d)},r.prototype.emplace=function(a,d,g){var E=2*a;return this.float32[E+0]=d,this.float32[E+1]=g,a},r}(w);re.prototype.bytesPerElement=8,Ut("StructArrayLayout2f8",re);var fe=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d,g,E,i,t,o,l,p,m){var _=this.length;return this.resize(_+1),this.emplace(_,a,d,g,E,i,t,o,l,p,m)},r.prototype.emplace=function(a,d,g,E,i,t,o,l,p,m,_){var T=10*a;return this.uint16[T+0]=d,this.uint16[T+1]=g,this.uint16[T+2]=E,this.uint16[T+3]=i,this.uint16[T+4]=t,this.uint16[T+5]=o,this.uint16[T+6]=l,this.uint16[T+7]=p,this.uint16[T+8]=m,this.uint16[T+9]=_,a},r}(w);fe.prototype.bytesPerElement=20,Ut("StructArrayLayout10ui20",fe);var Pe=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d,g,E,i,t,o,l,p,m,_,T){var C=this.length;return this.resize(C+1),this.emplace(C,a,d,g,E,i,t,o,l,p,m,_,T)},r.prototype.emplace=function(a,d,g,E,i,t,o,l,p,m,_,T,C){var k=12*a;return this.int16[k+0]=d,this.int16[k+1]=g,this.int16[k+2]=E,this.int16[k+3]=i,this.uint16[k+4]=t,this.uint16[k+5]=o,this.uint16[k+6]=l,this.uint16[k+7]=p,this.int16[k+8]=m,this.int16[k+9]=_,this.int16[k+10]=T,this.int16[k+11]=C,a},r}(w);Pe.prototype.bytesPerElement=24,Ut("StructArrayLayout4i4ui4i24",Pe);var ye=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d,g){var E=this.length;return this.resize(E+1),this.emplace(E,a,d,g)},r.prototype.emplace=function(a,d,g,E){var i=3*a;return this.float32[i+0]=d,this.float32[i+1]=g,this.float32[i+2]=E,a},r}(w);ye.prototype.bytesPerElement=12,Ut("StructArrayLayout3f12",ye);var ze=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a){var d=this.length;return this.resize(d+1),this.emplace(d,a)},r.prototype.emplace=function(a,d){return this.uint32[1*a+0]=d,a},r}(w);ze.prototype.bytesPerElement=4,Ut("StructArrayLayout1ul4",ze);var Ve=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d,g,E,i,t,o,l,p){var m=this.length;return this.resize(m+1),this.emplace(m,a,d,g,E,i,t,o,l,p)},r.prototype.emplace=function(a,d,g,E,i,t,o,l,p,m){var _=10*a,T=5*a;return this.int16[_+0]=d,this.int16[_+1]=g,this.int16[_+2]=E,this.int16[_+3]=i,this.int16[_+4]=t,this.int16[_+5]=o,this.uint32[T+3]=l,this.uint16[_+8]=p,this.uint16[_+9]=m,a},r}(w);Ve.prototype.bytesPerElement=20,Ut("StructArrayLayout6i1ul2ui20",Ve);var Fe=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d,g,E,i,t){var o=this.length;return this.resize(o+1),this.emplace(o,a,d,g,E,i,t)},r.prototype.emplace=function(a,d,g,E,i,t,o){var l=6*a;return this.int16[l+0]=d,this.int16[l+1]=g,this.int16[l+2]=E,this.int16[l+3]=i,this.int16[l+4]=t,this.int16[l+5]=o,a},r}(w);Fe.prototype.bytesPerElement=12,Ut("StructArrayLayout2i2i2i12",Fe);var Xe=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d,g,E,i){var t=this.length;return this.resize(t+1),this.emplace(t,a,d,g,E,i)},r.prototype.emplace=function(a,d,g,E,i,t){var o=4*a,l=8*a;return this.float32[o+0]=d,this.float32[o+1]=g,this.float32[o+2]=E,this.int16[l+6]=i,this.int16[l+7]=t,a},r}(w);Xe.prototype.bytesPerElement=16,Ut("StructArrayLayout2f1f2i16",Xe);var je=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d,g,E){var i=this.length;return this.resize(i+1),this.emplace(i,a,d,g,E)},r.prototype.emplace=function(a,d,g,E,i){var t=12*a,o=3*a;return this.uint8[t+0]=d,this.uint8[t+1]=g,this.float32[o+1]=E,this.float32[o+2]=i,a},r}(w);je.prototype.bytesPerElement=12,Ut("StructArrayLayout2ub2f12",je);var st=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d,g){var E=this.length;return this.resize(E+1),this.emplace(E,a,d,g)},r.prototype.emplace=function(a,d,g,E){var i=3*a;return this.uint16[i+0]=d,this.uint16[i+1]=g,this.uint16[i+2]=E,a},r}(w);st.prototype.bytesPerElement=6,Ut("StructArrayLayout3ui6",st);var et=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d,g,E,i,t,o,l,p,m,_,T,C,k,R,D,V){var G=this.length;return this.resize(G+1),this.emplace(G,a,d,g,E,i,t,o,l,p,m,_,T,C,k,R,D,V)},r.prototype.emplace=function(a,d,g,E,i,t,o,l,p,m,_,T,C,k,R,D,V,G){var Z=24*a,ee=12*a,ae=48*a;return this.int16[Z+0]=d,this.int16[Z+1]=g,this.uint16[Z+2]=E,this.uint16[Z+3]=i,this.uint32[ee+2]=t,this.uint32[ee+3]=o,this.uint32[ee+4]=l,this.uint16[Z+10]=p,this.uint16[Z+11]=m,this.uint16[Z+12]=_,this.float32[ee+7]=T,this.float32[ee+8]=C,this.uint8[ae+36]=k,this.uint8[ae+37]=R,this.uint8[ae+38]=D,this.uint32[ee+10]=V,this.int16[Z+22]=G,a},r}(w);et.prototype.bytesPerElement=48,Ut("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",et);var rt=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d,g,E,i,t,o,l,p,m,_,T,C,k,R,D,V,G,Z,ee,ae,we,ke,Re,Be,$e,Oe,dt){var ht=this.length;return this.resize(ht+1),this.emplace(ht,a,d,g,E,i,t,o,l,p,m,_,T,C,k,R,D,V,G,Z,ee,ae,we,ke,Re,Be,$e,Oe,dt)},r.prototype.emplace=function(a,d,g,E,i,t,o,l,p,m,_,T,C,k,R,D,V,G,Z,ee,ae,we,ke,Re,Be,$e,Oe,dt,ht){var Ye=34*a,ct=17*a;return this.int16[Ye+0]=d,this.int16[Ye+1]=g,this.int16[Ye+2]=E,this.int16[Ye+3]=i,this.int16[Ye+4]=t,this.int16[Ye+5]=o,this.int16[Ye+6]=l,this.int16[Ye+7]=p,this.uint16[Ye+8]=m,this.uint16[Ye+9]=_,this.uint16[Ye+10]=T,this.uint16[Ye+11]=C,this.uint16[Ye+12]=k,this.uint16[Ye+13]=R,this.uint16[Ye+14]=D,this.uint16[Ye+15]=V,this.uint16[Ye+16]=G,this.uint16[Ye+17]=Z,this.uint16[Ye+18]=ee,this.uint16[Ye+19]=ae,this.uint16[Ye+20]=we,this.uint16[Ye+21]=ke,this.uint16[Ye+22]=Re,this.uint32[ct+12]=Be,this.float32[ct+13]=$e,this.float32[ct+14]=Oe,this.float32[ct+15]=dt,this.float32[ct+16]=ht,a},r}(w);rt.prototype.bytesPerElement=68,Ut("StructArrayLayout8i15ui1ul4f68",rt);var mt=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a){var d=this.length;return this.resize(d+1),this.emplace(d,a)},r.prototype.emplace=function(a,d){return this.float32[1*a+0]=d,a},r}(w);mt.prototype.bytesPerElement=4,Ut("StructArrayLayout1f4",mt);var xt=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d,g){var E=this.length;return this.resize(E+1),this.emplace(E,a,d,g)},r.prototype.emplace=function(a,d,g,E){var i=3*a;return this.int16[i+0]=d,this.int16[i+1]=g,this.int16[i+2]=E,a},r}(w);xt.prototype.bytesPerElement=6,Ut("StructArrayLayout3i6",xt);var lt=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d,g){var E=this.length;return this.resize(E+1),this.emplace(E,a,d,g)},r.prototype.emplace=function(a,d,g,E){var i=4*a;return this.uint32[2*a+0]=d,this.uint16[i+2]=g,this.uint16[i+3]=E,a},r}(w);lt.prototype.bytesPerElement=8,Ut("StructArrayLayout1ul2ui8",lt);var qt=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d){var g=this.length;return this.resize(g+1),this.emplace(g,a,d)},r.prototype.emplace=function(a,d,g){var E=2*a;return this.uint16[E+0]=d,this.uint16[E+1]=g,a},r}(w);qt.prototype.bytesPerElement=4,Ut("StructArrayLayout2ui4",qt);var Rt=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a){var d=this.length;return this.resize(d+1),this.emplace(d,a)},r.prototype.emplace=function(a,d){return this.uint16[1*a+0]=d,a},r}(w);Rt.prototype.bytesPerElement=2,Ut("StructArrayLayout1ui2",Rt);var li=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},r.prototype.emplaceBack=function(a,d,g,E){var i=this.length;return this.resize(i+1),this.emplace(i,a,d,g,E)},r.prototype.emplace=function(a,d,g,E,i){var t=4*a;return this.float32[t+0]=d,this.float32[t+1]=g,this.float32[t+2]=E,this.float32[t+3]=i,a},r}(w);li.prototype.bytesPerElement=16,Ut("StructArrayLayout4f16",li);var s=function(e){function r(){e.apply(this,arguments)}e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r;var a={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return a.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},a.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},a.x1.get=function(){return this._structArray.int16[this._pos2+2]},a.y1.get=function(){return this._structArray.int16[this._pos2+3]},a.x2.get=function(){return this._structArray.int16[this._pos2+4]},a.y2.get=function(){return this._structArray.int16[this._pos2+5]},a.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},a.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},a.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},a.anchorPoint.get=function(){return new Ke(this.anchorPointX,this.anchorPointY)},Object.defineProperties(r.prototype,a),r}(v);s.prototype.size=20;var c=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.get=function(a){return new s(this,a)},r}(Ve);Ut("CollisionBoxArray",c);var u=function(e){function r(){e.apply(this,arguments)}e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r;var a={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return a.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},a.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},a.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},a.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},a.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},a.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},a.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},a.segment.get=function(){return this._structArray.uint16[this._pos2+10]},a.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},a.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},a.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},a.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},a.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},a.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},a.placedOrientation.set=function(d){this._structArray.uint8[this._pos1+37]=d},a.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},a.hidden.set=function(d){this._structArray.uint8[this._pos1+38]=d},a.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},a.crossTileID.set=function(d){this._structArray.uint32[this._pos4+10]=d},a.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(r.prototype,a),r}(v);u.prototype.size=48;var f=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.get=function(a){return new u(this,a)},r}(et);Ut("PlacedSymbolArray",f);var S=function(e){function r(){e.apply(this,arguments)}e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r;var a={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return a.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},a.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},a.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},a.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},a.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},a.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},a.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},a.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},a.key.get=function(){return this._structArray.uint16[this._pos2+8]},a.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},a.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},a.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},a.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},a.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},a.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},a.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},a.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},a.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},a.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},a.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},a.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},a.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},a.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},a.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},a.crossTileID.set=function(d){this._structArray.uint32[this._pos4+12]=d},a.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},a.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},a.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},a.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(r.prototype,a),r}(v);S.prototype.size=68;var A=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.get=function(a){return new S(this,a)},r}(rt);Ut("SymbolInstanceArray",A);var z=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.getoffsetX=function(a){return this.float32[1*a+0]},r}(mt);Ut("GlyphOffsetArray",z);var B=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.getx=function(a){return this.int16[3*a+0]},r.prototype.gety=function(a){return this.int16[3*a+1]},r.prototype.gettileUnitDistanceFromAnchor=function(a){return this.int16[3*a+2]},r}(xt);Ut("SymbolLineVertexArray",B);var q=function(e){function r(){e.apply(this,arguments)}e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r;var a={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return a.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},a.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},a.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(r.prototype,a),r}(v);q.prototype.size=8;var W=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.get=function(a){return new q(this,a)},r}(lt);Ut("FeatureIndexArray",W);var oe=I([{name:"a_pos",components:2,type:"Int16"}],4).members,se=function(e){e===void 0&&(e=[]),this.segments=e};function ue(e,r){return 256*(e=zt(Math.floor(e),0,255))+zt(Math.floor(r),0,255)}se.prototype.prepareSegment=function(e,r,a,d){var g=this.segments[this.segments.length-1];return e>se.MAX_VERTEX_ARRAY_LENGTH&&nr("Max vertices per segment is "+se.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+e),(!g||g.vertexLength+e>se.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==d)&&(g={vertexOffset:r.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},d!==void 0&&(g.sortKey=d),this.segments.push(g)),g},se.prototype.get=function(){return this.segments},se.prototype.destroy=function(){for(var e=0,r=this.segments;e<r.length;e+=1){var a=r[e];for(var d in a.vaos)a.vaos[d].destroy()}},se.simpleSegment=function(e,r,a,d){return new se([{vertexOffset:e,primitiveOffset:r,vertexLength:a,primitiveLength:d,vaos:{},sortKey:0}])},se.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ut("SegmentVector",se);var Ee=I([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),be=x(function(e){e.exports=function(r,a){var d,g,E,i,t,o,l,p;for(g=r.length-(d=3&r.length),E=a,t=3432918353,o=461845907,p=0;p<g;)l=255&r.charCodeAt(p)|(255&r.charCodeAt(++p))<<8|(255&r.charCodeAt(++p))<<16|(255&r.charCodeAt(++p))<<24,++p,E=27492+(65535&(i=5*(65535&(E=(E^=l=(65535&(l=(l=(65535&l)*t+(((l>>>16)*t&65535)<<16)&4294967295)<<15|l>>>17))*o+(((l>>>16)*o&65535)<<16)&4294967295)<<13|E>>>19))+((5*(E>>>16)&65535)<<16)&4294967295))+((58964+(i>>>16)&65535)<<16);switch(l=0,d){case 3:l^=(255&r.charCodeAt(p+2))<<16;case 2:l^=(255&r.charCodeAt(p+1))<<8;case 1:E^=l=(65535&(l=(l=(65535&(l^=255&r.charCodeAt(p)))*t+(((l>>>16)*t&65535)<<16)&4294967295)<<15|l>>>17))*o+(((l>>>16)*o&65535)<<16)&4294967295}return E^=r.length,E=2246822507*(65535&(E^=E>>>16))+((2246822507*(E>>>16)&65535)<<16)&4294967295,E=3266489909*(65535&(E^=E>>>13))+((3266489909*(E>>>16)&65535)<<16)&4294967295,(E^=E>>>16)>>>0}}),Ce=x(function(e){e.exports=function(r,a){for(var d,g=r.length,E=a^g,i=0;g>=4;)d=1540483477*(65535&(d=255&r.charCodeAt(i)|(255&r.charCodeAt(++i))<<8|(255&r.charCodeAt(++i))<<16|(255&r.charCodeAt(++i))<<24))+((1540483477*(d>>>16)&65535)<<16),E=1540483477*(65535&E)+((1540483477*(E>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),g-=4,++i;switch(g){case 3:E^=(255&r.charCodeAt(i+2))<<16;case 2:E^=(255&r.charCodeAt(i+1))<<8;case 1:E=1540483477*(65535&(E^=255&r.charCodeAt(i)))+((1540483477*(E>>>16)&65535)<<16)}return E=1540483477*(65535&(E^=E>>>13))+((1540483477*(E>>>16)&65535)<<16),(E^=E>>>15)>>>0}}),me=be,Te=Ce;me.murmur3=be,me.murmur2=Te;var Le=function(){this.ids=[],this.positions=[],this.indexed=!1};Le.prototype.add=function(e,r,a,d){this.ids.push(We(e)),this.positions.push(r,a,d)},Le.prototype.getPositions=function(e){for(var r=We(e),a=0,d=this.ids.length-1;a<d;){var g=a+d>>1;this.ids[g]>=r?d=g:a=g+1}for(var E=[];this.ids[a]===r;)E.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return E},Le.serialize=function(e,r){var a=new Float64Array(e.ids),d=new Uint32Array(e.positions);return function g(E,i,t,o){for(;t<o;){for(var l=E[t+o>>1],p=t-1,m=o+1;;){do p++;while(E[p]<l);do m--;while(E[m]>l);if(p>=m)break;He(E,p,m),He(i,3*p,3*m),He(i,3*p+1,3*m+1),He(i,3*p+2,3*m+2)}m-t<o-m?(g(E,i,t,m),t=m+1):(g(E,i,m+1,o),o=m)}}(a,d,0,a.length-1),r&&r.push(a.buffer,d.buffer),{ids:a,positions:d}},Le.deserialize=function(e){var r=new Le;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r};var Ne=Math.pow(2,53)-1;function We(e){var r=+e;return!isNaN(r)&&r<=Ne?r:me(String(e))}function He(e,r,a){var d=e[r];e[r]=e[a],e[a]=d}Ut("FeaturePositionMap",Le);var Je=function(e,r){this.gl=e.gl,this.location=r},ut=function(e){function r(a,d){e.call(this,a,d),this.current=0}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.set=function(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))},r}(Je),_t=function(e){function r(a,d){e.call(this,a,d),this.current=0}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.set=function(a){this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))},r}(Je),gt=function(e){function r(a,d){e.call(this,a,d),this.current=[0,0]}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.set=function(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))},r}(Je),Mt=function(e){function r(a,d){e.call(this,a,d),this.current=[0,0,0]}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.set=function(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))},r}(Je),Zt=function(e){function r(a,d){e.call(this,a,d),this.current=[0,0,0,0]}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.set=function(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3]))},r}(Je),Wt=function(e){function r(a,d){e.call(this,a,d),this.current=oi.transparent}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.set=function(a){a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a))},r}(Je),Gt=new Float32Array(16),Ai=function(e){function r(a,d){e.call(this,a,d),this.current=Gt}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.set=function(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(var d=1;d<16;d++)if(a[d]!==this.current[d]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}},r}(Je);function Ft(e){return[ue(255*e.r,255*e.g),ue(255*e.b,255*e.a)]}var ai=function(e,r,a){this.value=e,this.uniformNames=r.map(function(d){return"u_"+d}),this.type=a};ai.prototype.setUniform=function(e,r,a){e.set(a.constantOr(this.value))},ai.prototype.getBinding=function(e,r,a){return this.type==="color"?new Wt(e,r):new _t(e,r)};var wi=function(e,r){this.uniformNames=r.map(function(a){return"u_"+a}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};wi.prototype.setConstantPatternPositions=function(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr},wi.prototype.setUniform=function(e,r,a,d){var g=d==="u_pattern_to"?this.patternTo:d==="u_pattern_from"?this.patternFrom:d==="u_pixel_ratio_to"?this.pixelRatioTo:d==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&e.set(g)},wi.prototype.getBinding=function(e,r,a){return a.substr(0,9)==="u_pattern"?new Zt(e,r):new _t(e,r)};var ni=function(e,r,a,d){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map(function(g){return{name:"a_"+g,type:"Float32",components:a==="color"?2:1,offset:0}}),this.paintVertexArray=new d};ni.prototype.populatePaintArray=function(e,r,a,d,g){var E=this.paintVertexArray.length,i=this.expression.evaluate(new wt(0),r,{},d,[],g);this.paintVertexArray.resize(e),this._setPaintValue(E,e,i)},ni.prototype.updatePaintArray=function(e,r,a,d){var g=this.expression.evaluate({zoom:0},a,d);this._setPaintValue(e,r,g)},ni.prototype._setPaintValue=function(e,r,a){if(this.type==="color")for(var d=Ft(a),g=e;g<r;g++)this.paintVertexArray.emplace(g,d[0],d[1]);else{for(var E=e;E<r;E++)this.paintVertexArray.emplace(E,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}},ni.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ni.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var ei=function(e,r,a,d,g,E){this.expression=e,this.uniformNames=r.map(function(i){return"u_"+i+"_t"}),this.type=a,this.useIntegerZoom=d,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=r.map(function(i){return{name:"a_"+i,type:"Float32",components:a==="color"?4:2,offset:0}}),this.paintVertexArray=new E};ei.prototype.populatePaintArray=function(e,r,a,d,g){var E=this.expression.evaluate(new wt(this.zoom),r,{},d,[],g),i=this.expression.evaluate(new wt(this.zoom+1),r,{},d,[],g),t=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(t,e,E,i)},ei.prototype.updatePaintArray=function(e,r,a,d){var g=this.expression.evaluate({zoom:this.zoom},a,d),E=this.expression.evaluate({zoom:this.zoom+1},a,d);this._setPaintValue(e,r,g,E)},ei.prototype._setPaintValue=function(e,r,a,d){if(this.type==="color")for(var g=Ft(a),E=Ft(d),i=e;i<r;i++)this.paintVertexArray.emplace(i,g[0],g[1],E[0],E[1]);else{for(var t=e;t<r;t++)this.paintVertexArray.emplace(t,a,d);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(d))}},ei.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ei.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},ei.prototype.setUniform=function(e,r){var a=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,d=zt(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);e.set(d)},ei.prototype.getBinding=function(e,r,a){return new _t(e,r)};var ci=function(e,r,a,d,g,E){this.expression=e,this.type=r,this.useIntegerZoom=a,this.zoom=d,this.layerId=E,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g};ci.prototype.populatePaintArray=function(e,r,a){var d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(d,e,r.patterns&&r.patterns[this.layerId],a)},ci.prototype.updatePaintArray=function(e,r,a,d,g){this._setPaintValues(e,r,a.patterns&&a.patterns[this.layerId],g)},ci.prototype._setPaintValues=function(e,r,a,d){if(d&&a){var g=d[a.min],E=d[a.mid],i=d[a.max];if(g&&E&&i)for(var t=e;t<r;t++)this.zoomInPaintVertexArray.emplace(t,E.tl[0],E.tl[1],E.br[0],E.br[1],g.tl[0],g.tl[1],g.br[0],g.br[1],E.pixelRatio,g.pixelRatio),this.zoomOutPaintVertexArray.emplace(t,E.tl[0],E.tl[1],E.br[0],E.br[1],i.tl[0],i.tl[1],i.br[0],i.br[1],E.pixelRatio,i.pixelRatio)}},ci.prototype.upload=function(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Ee.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Ee.members,this.expression.isStateDependent))},ci.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Kt=function(e,r,a){this.binders={},this._buffers=[];var d=[];for(var g in e.paint._values)if(a(g)){var E=e.paint.get(g);if(E instanceof Cn&&Xo(E.property.specification)){var i=yr(g,e.type),t=E.value,o=E.property.specification.type,l=E.property.useIntegerZoom,p=E.property.specification["property-type"],m=p==="cross-faded"||p==="cross-faded-data-driven";if(t.kind==="constant")this.binders[g]=m?new wi(t.value,i):new ai(t.value,i,o),d.push("/u_"+g);else if(t.kind==="source"||m){var _=Ir(g,o,"source");this.binders[g]=m?new ci(t,o,l,r,_,e.id):new ni(t,i,o,_),d.push("/a_"+g)}else{var T=Ir(g,o,"composite");this.binders[g]=new ei(t,i,o,l,r,T),d.push("/z_"+g)}}}this.cacheKey=d.sort().join("")};Kt.prototype.getMaxValue=function(e){var r=this.binders[e];return r instanceof ni||r instanceof ei?r.maxValue:0},Kt.prototype.populatePaintArrays=function(e,r,a,d,g){for(var E in this.binders){var i=this.binders[E];(i instanceof ni||i instanceof ei||i instanceof ci)&&i.populatePaintArray(e,r,a,d,g)}},Kt.prototype.setConstantPatternPositions=function(e,r){for(var a in this.binders){var d=this.binders[a];d instanceof wi&&d.setConstantPatternPositions(e,r)}},Kt.prototype.updatePaintArrays=function(e,r,a,d,g){var E=!1;for(var i in e)for(var t=0,o=r.getPositions(i);t<o.length;t+=1){var l=o[t],p=a.feature(l.index);for(var m in this.binders){var _=this.binders[m];if((_ instanceof ni||_ instanceof ei||_ instanceof ci)&&_.expression.isStateDependent===!0){var T=d.paint.get(m);_.expression=T.value,_.updatePaintArray(l.start,l.end,p,e[i],g),E=!0}}}return E},Kt.prototype.defines=function(){var e=[];for(var r in this.binders){var a=this.binders[r];(a instanceof ai||a instanceof wi)&&e.push.apply(e,a.uniformNames.map(function(d){return"#define HAS_UNIFORM_"+d}))}return e},Kt.prototype.getBinderAttributes=function(){var e=[];for(var r in this.binders){var a=this.binders[r];if(a instanceof ni||a instanceof ei)for(var d=0;d<a.paintVertexAttributes.length;d++)e.push(a.paintVertexAttributes[d].name);else if(a instanceof ci)for(var g=0;g<Ee.members.length;g++)e.push(Ee.members[g].name)}return e},Kt.prototype.getBinderUniforms=function(){var e=[];for(var r in this.binders){var a=this.binders[r];if(a instanceof ai||a instanceof wi||a instanceof ei)for(var d=0,g=a.uniformNames;d<g.length;d+=1)e.push(g[d])}return e},Kt.prototype.getPaintVertexBuffers=function(){return this._buffers},Kt.prototype.getUniforms=function(e,r){var a=[];for(var d in this.binders){var g=this.binders[d];if(g instanceof ai||g instanceof wi||g instanceof ei)for(var E=0,i=g.uniformNames;E<i.length;E+=1){var t=i[E];if(r[t]){var o=g.getBinding(e,r[t],t);a.push({name:t,property:d,binding:o})}}}return a},Kt.prototype.setUniforms=function(e,r,a,d){for(var g=0,E=r;g<E.length;g+=1){var i=E[g],t=i.name,o=i.property;this.binders[o].setUniform(i.binding,d,a.get(o),t)}},Kt.prototype.updatePaintBuffers=function(e){for(var r in this._buffers=[],this.binders){var a=this.binders[r];if(e&&a instanceof ci){var d=e.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(a instanceof ni||a instanceof ei)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}},Kt.prototype.upload=function(e){for(var r in this.binders){var a=this.binders[r];(a instanceof ni||a instanceof ei||a instanceof ci)&&a.upload(e)}this.updatePaintBuffers()},Kt.prototype.destroy=function(){for(var e in this.binders){var r=this.binders[e];(r instanceof ni||r instanceof ei||r instanceof ci)&&r.destroy()}};var Xt=function(e,r,a){a===void 0&&(a=function(){return!0}),this.programConfigurations={};for(var d=0,g=e;d<g.length;d+=1){var E=g[d];this.programConfigurations[E.id]=new Kt(E,r,a)}this.needsUpload=!1,this._featureMap=new Le,this._bufferOffset=0};function yr(e,r){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace(r+"-","").replace(/-/g,"_")]}function Ir(e,r,a){var d={color:{source:re,composite:li},number:{source:mt,composite:re}},g=function(E){return{"line-pattern":{source:fe,composite:fe},"fill-pattern":{source:fe,composite:fe},"fill-extrusion-pattern":{source:fe,composite:fe}}[E]}(e);return g&&g[a]||d[r][a]}Xt.prototype.populatePaintArrays=function(e,r,a,d,g,E){for(var i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(e,r,d,g,E);r.id!==void 0&&this._featureMap.add(r.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0},Xt.prototype.updatePaintArrays=function(e,r,a,d){for(var g=0,E=a;g<E.length;g+=1){var i=E[g];this.needsUpload=this.programConfigurations[i.id].updatePaintArrays(e,this._featureMap,r,i,d)||this.needsUpload}},Xt.prototype.get=function(e){return this.programConfigurations[e]},Xt.prototype.upload=function(e){if(this.needsUpload){for(var r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}},Xt.prototype.destroy=function(){for(var e in this.programConfigurations)this.programConfigurations[e].destroy()},Ut("ConstantBinder",ai),Ut("CrossFadedConstantBinder",wi),Ut("SourceExpressionBinder",ni),Ut("CrossFadedCompositeBinder",ci),Ut("CompositeExpressionBinder",ei),Ut("ProgramConfiguration",Kt,{omit:["_buffers"]}),Ut("ProgramConfigurationSet",Xt);var Fr=Math.pow(2,14)-1,vn=-Fr-1;function xr(e){for(var r=8192/e.extent,a=e.loadGeometry(),d=0;d<a.length;d++)for(var g=a[d],E=0;E<g.length;E++){var i=g[E],t=Math.round(i.x*r),o=Math.round(i.y*r);i.x=zt(t,vn,Fr),i.y=zt(o,vn,Fr),(t<i.x||t>i.x+1||o<i.y||o>i.y+1)&&nr("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return a}function zi(e,r){return{type:e.type,id:e.id,properties:e.properties,geometry:r?xr(e):[]}}function Jn(e,r,a,d,g){e.emplaceBack(2*r+(d+1)/2,2*a+(g+1)/2)}var On=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(r){return r.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new O,this.indexArray=new st,this.segments=new se,this.programConfigurations=new Xt(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(function(r){return r.isStateDependent()}).map(function(r){return r.id})};function So(e,r){for(var a=0;a<e.length;a++)if(Ma(r,e[a]))return!0;for(var d=0;d<r.length;d++)if(Ma(e,r[d]))return!0;return!!yl(e,r)}function Wr(e,r,a){return!!Ma(e,r)||!!Ya(r,e,a)}function To(e,r){if(e.length===1)return Gs(r,e[0]);for(var a=0;a<r.length;a++)for(var d=r[a],g=0;g<d.length;g++)if(Ma(e,d[g]))return!0;for(var E=0;E<e.length;E++)if(Gs(r,e[E]))return!0;for(var i=0;i<r.length;i++)if(yl(e,r[i]))return!0;return!1}function Io(e,r,a){if(e.length>1){if(yl(e,r))return!0;for(var d=0;d<r.length;d++)if(Ya(r[d],e,a))return!0}for(var g=0;g<e.length;g++)if(Ya(e[g],r,a))return!0;return!1}function yl(e,r){if(e.length===0||r.length===0)return!1;for(var a=0;a<e.length-1;a++)for(var d=e[a],g=e[a+1],E=0;E<r.length-1;E++)if(gl(d,g,r[E],r[E+1]))return!0;return!1}function gl(e,r,a,d){return Ar(e,a,d)!==Ar(r,a,d)&&Ar(e,r,a)!==Ar(e,r,d)}function Ya(e,r,a){var d=a*a;if(r.length===1)return e.distSqr(r[0])<d;for(var g=1;g<r.length;g++)if(_l(e,r[g-1],r[g])<d)return!0;return!1}function _l(e,r,a){var d=r.distSqr(a);if(d===0)return e.distSqr(r);var g=((e.x-r.x)*(a.x-r.x)+(e.y-r.y)*(a.y-r.y))/d;return e.distSqr(g<0?r:g>1?a:a.sub(r)._mult(g)._add(r))}function Gs(e,r){for(var a,d,g,E=!1,i=0;i<e.length;i++)for(var t=0,o=(a=e[i]).length-1;t<a.length;o=t++)(d=a[t]).y>r.y!=(g=a[o]).y>r.y&&r.x<(g.x-d.x)*(r.y-d.y)/(g.y-d.y)+d.x&&(E=!E);return E}function Ma(e,r){for(var a=!1,d=0,g=e.length-1;d<e.length;g=d++){var E=e[d],i=e[g];E.y>r.y!=i.y>r.y&&r.x<(i.x-E.x)*(r.y-E.y)/(i.y-E.y)+E.x&&(a=!a)}return a}function Zs(e,r,a){var d=a[0],g=a[2];if(e.x<d.x&&r.x<d.x||e.x>g.x&&r.x>g.x||e.y<d.y&&r.y<d.y||e.y>g.y&&r.y>g.y)return!1;var E=Ar(e,r,a[0]);return E!==Ar(e,r,a[1])||E!==Ar(e,r,a[2])||E!==Ar(e,r,a[3])}function ya(e,r,a){var d=r.paint.get(e).value;return d.kind==="constant"?d.value:a.programConfigurations.get(r.id).getMaxValue(e)}function Hr(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Ao(e,r,a,d,g){if(!r[0]&&!r[1])return e;var E=Ke.convert(r)._mult(g);a==="viewport"&&E._rotate(-d);for(var i=[],t=0;t<e.length;t++)i.push(e[t].sub(E));return i}On.prototype.populate=function(e,r,a){var d=this.layers[0],g=[],E=null;d.type==="circle"&&(E=d.layout.get("circle-sort-key"));for(var i=0,t=e;i<t.length;i+=1){var o=t[i],l=o.feature,p=o.id,m=o.index,_=o.sourceLayerIndex,T=this.layers[0]._featureFilter.needGeometry,C=zi(l,T);if(this.layers[0]._featureFilter.filter(new wt(this.zoom),C,a)){var k=E?E.evaluate(C,{},a):void 0,R={id:p,properties:l.properties,type:l.type,sourceLayerIndex:_,index:m,geometry:T?C.geometry:xr(l),patterns:{},sortKey:k};g.push(R)}}E&&g.sort(function(ke,Re){return ke.sortKey-Re.sortKey});for(var D=0,V=g;D<V.length;D+=1){var G=V[D],Z=G.geometry,ee=G.index,ae=G.sourceLayerIndex,we=e[ee].feature;this.addFeature(G,Z,ee,a),r.featureIndex.insert(we,Z,ee,ae,this.index)}},On.prototype.update=function(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)},On.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},On.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},On.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,oe),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},On.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},On.prototype.addFeature=function(e,r,a,d){for(var g=0,E=r;g<E.length;g+=1)for(var i=0,t=E[g];i<t.length;i+=1){var o=t[i],l=o.x,p=o.y;if(!(l<0||l>=8192||p<0||p>=8192)){var m=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),_=m.vertexLength;Jn(this.layoutVertexArray,l,p,-1,-1),Jn(this.layoutVertexArray,l,p,1,-1),Jn(this.layoutVertexArray,l,p,1,1),Jn(this.layoutVertexArray,l,p,-1,1),this.indexArray.emplaceBack(_,_+1,_+2),this.indexArray.emplaceBack(_,_+3,_+2),m.vertexLength+=4,m.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},d)},Ut("CircleBucket",On,{omit:["layers"]});var _s=new b({"circle-sort-key":new Tt(ce.layout_circle["circle-sort-key"])}),ga={paint:new b({"circle-radius":new Tt(ce.paint_circle["circle-radius"]),"circle-color":new Tt(ce.paint_circle["circle-color"]),"circle-blur":new Tt(ce.paint_circle["circle-blur"]),"circle-opacity":new Tt(ce.paint_circle["circle-opacity"]),"circle-translate":new At(ce.paint_circle["circle-translate"]),"circle-translate-anchor":new At(ce.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new At(ce.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new At(ce.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Tt(ce.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Tt(ce.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Tt(ce.paint_circle["circle-stroke-opacity"])}),layout:_s},Ri=typeof Float32Array!="undefined"?Float32Array:Array;function Yn(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function go(e,r,a){var d=r[0],g=r[1],E=r[2],i=r[3],t=r[4],o=r[5],l=r[6],p=r[7],m=r[8],_=r[9],T=r[10],C=r[11],k=r[12],R=r[13],D=r[14],V=r[15],G=a[0],Z=a[1],ee=a[2],ae=a[3];return e[0]=G*d+Z*t+ee*m+ae*k,e[1]=G*g+Z*o+ee*_+ae*R,e[2]=G*E+Z*l+ee*T+ae*D,e[3]=G*i+Z*p+ee*C+ae*V,e[4]=(G=a[4])*d+(Z=a[5])*t+(ee=a[6])*m+(ae=a[7])*k,e[5]=G*g+Z*o+ee*_+ae*R,e[6]=G*E+Z*l+ee*T+ae*D,e[7]=G*i+Z*p+ee*C+ae*V,e[8]=(G=a[8])*d+(Z=a[9])*t+(ee=a[10])*m+(ae=a[11])*k,e[9]=G*g+Z*o+ee*_+ae*R,e[10]=G*E+Z*l+ee*T+ae*D,e[11]=G*i+Z*p+ee*C+ae*V,e[12]=(G=a[12])*d+(Z=a[13])*t+(ee=a[14])*m+(ae=a[15])*k,e[13]=G*g+Z*o+ee*_+ae*R,e[14]=G*E+Z*l+ee*T+ae*D,e[15]=G*i+Z*p+ee*C+ae*V,e}Math.hypot||(Math.hypot=function(){for(var e=arguments,r=0,a=arguments.length;a--;)r+=e[a]*e[a];return Math.sqrt(r)});var $s,vl=go;function xl(e,r,a){var d=r[0],g=r[1],E=r[2],i=r[3];return e[0]=a[0]*d+a[4]*g+a[8]*E+a[12]*i,e[1]=a[1]*d+a[5]*g+a[9]*E+a[13]*i,e[2]=a[2]*d+a[6]*g+a[10]*E+a[14]*i,e[3]=a[3]*d+a[7]*g+a[11]*E+a[15]*i,e}$s=new Ri(3),Ri!=Float32Array&&($s[0]=0,$s[1]=0,$s[2]=0),function(){var e=new Ri(4);Ri!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}();var bc=(function(){var e=new Ri(2);Ri!=Float32Array&&(e[0]=0,e[1]=0)}(),function(e){function r(a){e.call(this,a,ga)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.createBucket=function(a){return new On(a)},r.prototype.queryRadius=function(a){var d=a;return ya("circle-radius",this,d)+ya("circle-stroke-width",this,d)+Hr(this.paint.get("circle-translate"))},r.prototype.queryIntersectsFeature=function(a,d,g,E,i,t,o,l){for(var p=Ao(a,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),t.angle,o),m=this.paint.get("circle-radius").evaluate(d,g)+this.paint.get("circle-stroke-width").evaluate(d,g),_=this.paint.get("circle-pitch-alignment")==="map",T=_?p:function(we,ke){return we.map(function(Re){return Qa(Re,ke)})}(p,l),C=_?m*o:m,k=0,R=E;k<R.length;k+=1)for(var D=0,V=R[k];D<V.length;D+=1){var G=V[D],Z=_?G:Qa(G,l),ee=C,ae=xl([],[G.x,G.y,0,1],l);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ee*=ae[3]/t.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ee*=t.cameraToCenterDistance/ae[3]),Wr(T,Z,ee))return!0}return!1},r}(n));function Qa(e,r){var a=xl([],[e.x,e.y,0,1],r);return new Ke(a[0]/a[3],a[1]/a[3])}var wc=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r}(On);function es(e,r,a,d){var g=r.width,E=r.height;if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==g*E*a)throw new RangeError("mismatched image size")}else d=new Uint8Array(g*E*a);return e.width=g,e.height=E,e.data=d,e}function Wl(e,r,a){var d=r.width,g=r.height;if(d!==e.width||g!==e.height){var E=es({},{width:d,height:g},a);Ec(e,E,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,d),height:Math.min(e.height,g)},a),e.width=d,e.height=g,e.data=E.data}}function Ec(e,r,a,d,g,E){if(g.width===0||g.height===0)return r;if(g.width>e.width||g.height>e.height||a.x>e.width-g.width||a.y>e.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>r.width||g.height>r.height||d.x>r.width-g.width||d.y>r.height-g.height)throw new RangeError("out of range destination coordinates for image copy");for(var i=e.data,t=r.data,o=0;o<g.height;o++)for(var l=((a.y+o)*e.width+a.x)*E,p=((d.y+o)*r.width+d.x)*E,m=0;m<g.width*E;m++)t[p+m]=i[l+m];return r}Ut("HeatmapBucket",wc,{omit:["layers"]});var Hl=function(e,r){es(this,e,1,r)};Hl.prototype.resize=function(e){Wl(this,e,1)},Hl.prototype.clone=function(){return new Hl({width:this.width,height:this.height},new Uint8Array(this.data))},Hl.copy=function(e,r,a,d,g){Ec(e,r,a,d,g,1)};var Qn=function(e,r){es(this,e,4,r)};Qn.prototype.resize=function(e){Wl(this,e,4)},Qn.prototype.replace=function(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e},Qn.prototype.clone=function(){return new Qn({width:this.width,height:this.height},new Uint8Array(this.data))},Qn.copy=function(e,r,a,d,g){Ec(e,r,a,d,g,4)},Ut("AlphaImage",Hl),Ut("RGBAImage",Qn);var Oh={paint:new b({"heatmap-radius":new Tt(ce.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Tt(ce.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new At(ce.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Bn(ce.paint_heatmap["heatmap-color"]),"heatmap-opacity":new At(ce.paint_heatmap["heatmap-opacity"])})};function Sc(e){var r={},a=e.resolution||256,d=e.clips?e.clips.length:1,g=e.image||new Qn({width:a,height:d}),E=function(C,k,R){r[e.evaluationKey]=R;var D=e.expression.evaluate(r);g.data[C+k+0]=Math.floor(255*D.r/D.a),g.data[C+k+1]=Math.floor(255*D.g/D.a),g.data[C+k+2]=Math.floor(255*D.b/D.a),g.data[C+k+3]=Math.floor(255*D.a)};if(e.clips)for(var i=0,t=0;i<d;++i,t+=4*a)for(var o=0,l=0;o<a;o++,l+=4){var p=o/(a-1),m=e.clips[i];E(t,l,m.start*(1-p)+m.end*p)}else for(var _=0,T=0;_<a;_++,T+=4)E(0,T,_/(a-1));return g}var Zu=function(e){function r(a){e.call(this,a,Oh),this._updateColorRamp()}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.createBucket=function(a){return new wc(a)},r.prototype._handleSpecialPaintPropertyUpdate=function(a){a==="heatmap-color"&&this._updateColorRamp()},r.prototype._updateColorRamp=function(){this.colorRamp=Sc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},r.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},r.prototype.queryRadius=function(){return 0},r.prototype.queryIntersectsFeature=function(){return!1},r.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},r}(n),_a={paint:new b({"hillshade-illumination-direction":new At(ce.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new At(ce.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new At(ce.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new At(ce.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new At(ce.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new At(ce.paint_hillshade["hillshade-accent-color"])})},Fh=function(e){function r(a){e.call(this,a,_a)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},r}(n),Op=I([{name:"a_pos",components:2,type:"Int16"}],4).members,th=gu,Fp=gu;function gu(e,r,a){a=a||2;var d,g,E,i,t,o,l,p=r&&r.length,m=p?r[0]*a:e.length,_=$u(e,0,m,a,!0),T=[];if(!_||_.next===_.prev)return T;if(p&&(_=function(k,R,D,V){var G,Z,ee,ae=[];for(G=0,Z=R.length;G<Z;G++)(ee=$u(k,R[G]*V,G<Z-1?R[G+1]*V:k.length,V,!1))===ee.next&&(ee.steiner=!0),ae.push(rh(ee));for(ae.sort(jp),G=0;G<ae.length;G++)qp(ae[G],D),D=Xs(D,D.next);return D}(e,r,_,a)),e.length>80*a){d=E=e[0],g=i=e[1];for(var C=a;C<m;C+=a)(t=e[C])<d&&(d=t),(o=e[C+1])<g&&(g=o),t>E&&(E=t),o>i&&(i=o);l=(l=Math.max(E-d,i-g))!==0?1/l:0}return La(_,T,a,d,g,l),T}function $u(e,r,a,d,g){var E,i;if(g===Ku(e,r,a,d)>0)for(E=r;E<a;E+=d)i=nh(E,e[E],e[E+1],i);else for(E=a-d;E>=r;E-=d)i=nh(E,e[E],e[E+1],i);return i&&Pr(i,i.next)&&(bu(i),i=i.next),i}function Xs(e,r){if(!e)return e;r||(r=e);var a,d=e;do if(a=!1,d.steiner||!Pr(d,d.next)&&Kr(d.prev,d,d.next)!==0)d=d.next;else{if(bu(d),(d=r=d.prev)===d.next)break;a=!0}while(a||d!==r);return r}function La(e,r,a,d,g,E,i){if(e){!i&&E&&function(p,m,_,T){var C=p;do C.z===null&&(C.z=ih(C.x,C.y,m,_,T)),C.prevZ=C.prev,C.nextZ=C.next,C=C.next;while(C!==p);C.prevZ.nextZ=null,C.prevZ=null,function(k){var R,D,V,G,Z,ee,ae,we,ke=1;do{for(D=k,k=null,Z=null,ee=0;D;){for(ee++,V=D,ae=0,R=0;R<ke&&(ae++,V=V.nextZ);R++);for(we=ke;ae>0||we>0&&V;)ae!==0&&(we===0||!V||D.z<=V.z)?(G=D,D=D.nextZ,ae--):(G=V,V=V.nextZ,we--),Z?Z.nextZ=G:k=G,G.prevZ=Z,Z=G;D=V}Z.nextZ=null,ke*=2}while(ee>1)}(C)}(e,d,g,E);for(var t,o,l=e;e.prev!==e.next;)if(t=e.prev,o=e.next,E?Up(e,d,g,E):Xu(e))r.push(t.i/a),r.push(e.i/a),r.push(o.i/a),bu(e),e=o.next,l=o.next;else if((e=o)===l){i?i===1?La(e=Vp(Xs(e),r,a),r,a,d,g,E,2):i===2&&Np(e,r,a,d,g,E):La(Xs(e),r,a,d,g,E,1);break}}}function Xu(e){var r=e.prev,a=e,d=e.next;if(Kr(r,a,d)>=0)return!1;for(var g=e.next.next;g!==e.prev;){if(_u(r.x,r.y,a.x,a.y,d.x,d.y,g.x,g.y)&&Kr(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function Up(e,r,a,d){var g=e.prev,E=e,i=e.next;if(Kr(g,E,i)>=0)return!1;for(var t=g.x>E.x?g.x>i.x?g.x:i.x:E.x>i.x?E.x:i.x,o=g.y>E.y?g.y>i.y?g.y:i.y:E.y>i.y?E.y:i.y,l=ih(g.x<E.x?g.x<i.x?g.x:i.x:E.x<i.x?E.x:i.x,g.y<E.y?g.y<i.y?g.y:i.y:E.y<i.y?E.y:i.y,r,a,d),p=ih(t,o,r,a,d),m=e.prevZ,_=e.nextZ;m&&m.z>=l&&_&&_.z<=p;){if(m!==e.prev&&m!==e.next&&_u(g.x,g.y,E.x,E.y,i.x,i.y,m.x,m.y)&&Kr(m.prev,m,m.next)>=0||(m=m.prevZ,_!==e.prev&&_!==e.next&&_u(g.x,g.y,E.x,E.y,i.x,i.y,_.x,_.y)&&Kr(_.prev,_,_.next)>=0))return!1;_=_.nextZ}for(;m&&m.z>=l;){if(m!==e.prev&&m!==e.next&&_u(g.x,g.y,E.x,E.y,i.x,i.y,m.x,m.y)&&Kr(m.prev,m,m.next)>=0)return!1;m=m.prevZ}for(;_&&_.z<=p;){if(_!==e.prev&&_!==e.next&&_u(g.x,g.y,E.x,E.y,i.x,i.y,_.x,_.y)&&Kr(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function Vp(e,r,a){var d=e;do{var g=d.prev,E=d.next.next;!Pr(g,E)&&Wu(g,d,d.next,E)&&bl(g,E)&&bl(E,g)&&(r.push(g.i/a),r.push(d.i/a),r.push(E.i/a),bu(d),bu(d.next),d=e=E),d=d.next}while(d!==e);return Xs(d)}function Np(e,r,a,d,g,E){var i=e;do{for(var t=i.next.next;t!==i.prev;){if(i.i!==t.i&&vu(i,t)){var o=xu(i,t);return i=Xs(i,i.next),o=Xs(o,o.next),La(i,r,a,d,g,E),void La(o,r,a,d,g,E)}t=t.next}i=i.next}while(i!==e)}function jp(e,r){return e.x-r.x}function qp(e,r){if(r=function(d,g){var E,i=g,t=d.x,o=d.y,l=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var p=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(p<=t&&p>l){if(l=p,p===t){if(o===i.y)return i;if(o===i.next.y)return i.next}E=i.x<i.next.x?i:i.next}}i=i.next}while(i!==g);if(!E)return null;if(t===l)return E;var m,_=E,T=E.x,C=E.y,k=1/0;i=E;do t>=i.x&&i.x>=T&&t!==i.x&&_u(o<C?t:l,o,T,C,o<C?l:t,o,i.x,i.y)&&(m=Math.abs(o-i.y)/(t-i.x),bl(i,d)&&(m<k||m===k&&(i.x>E.x||i.x===E.x&&Gp(E,i)))&&(E=i,k=m)),i=i.next;while(i!==_);return E}(e,r)){var a=xu(r,e);Xs(r,r.next),Xs(a,a.next)}}function Gp(e,r){return Kr(e.prev,e,r.prev)<0&&Kr(r.next,e,e.next)<0}function ih(e,r,a,d,g){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-a)*g)|e<<8))|e<<4))|e<<2))|e<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-d)*g)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function rh(e){var r=e,a=e;do(r.x<a.x||r.x===a.x&&r.y<a.y)&&(a=r),r=r.next;while(r!==e);return a}function _u(e,r,a,d,g,E,i,t){return(g-i)*(r-t)-(e-i)*(E-t)>=0&&(e-i)*(d-t)-(a-i)*(r-t)>=0&&(a-i)*(E-t)-(g-i)*(d-t)>=0}function vu(e,r){return e.next.i!==r.i&&e.prev.i!==r.i&&!function(a,d){var g=a;do{if(g.i!==a.i&&g.next.i!==a.i&&g.i!==d.i&&g.next.i!==d.i&&Wu(g,g.next,a,d))return!0;g=g.next}while(g!==a);return!1}(e,r)&&(bl(e,r)&&bl(r,e)&&function(a,d){var g=a,E=!1,i=(a.x+d.x)/2,t=(a.y+d.y)/2;do g.y>t!=g.next.y>t&&g.next.y!==g.y&&i<(g.next.x-g.x)*(t-g.y)/(g.next.y-g.y)+g.x&&(E=!E),g=g.next;while(g!==a);return E}(e,r)&&(Kr(e.prev,e,r.prev)||Kr(e,r.prev,r))||Pr(e,r)&&Kr(e.prev,e,e.next)>0&&Kr(r.prev,r,r.next)>0)}function Kr(e,r,a){return(r.y-e.y)*(a.x-r.x)-(r.x-e.x)*(a.y-r.y)}function Pr(e,r){return e.x===r.x&&e.y===r.y}function Wu(e,r,a,d){var g=Kl(Kr(e,r,a)),E=Kl(Kr(e,r,d)),i=Kl(Kr(a,d,e)),t=Kl(Kr(a,d,r));return g!==E&&i!==t||!(g!==0||!Hu(e,a,r))||!(E!==0||!Hu(e,d,r))||!(i!==0||!Hu(a,e,d))||!(t!==0||!Hu(a,r,d))}function Hu(e,r,a){return r.x<=Math.max(e.x,a.x)&&r.x>=Math.min(e.x,a.x)&&r.y<=Math.max(e.y,a.y)&&r.y>=Math.min(e.y,a.y)}function Kl(e){return e>0?1:e<0?-1:0}function bl(e,r){return Kr(e.prev,e,e.next)<0?Kr(e,r,e.next)>=0&&Kr(e,e.prev,r)>=0:Kr(e,r,e.prev)<0||Kr(e,e.next,r)<0}function xu(e,r){var a=new Jl(e.i,e.x,e.y),d=new Jl(r.i,r.x,r.y),g=e.next,E=r.prev;return e.next=r,r.prev=e,a.next=g,g.prev=a,d.next=a,a.prev=d,E.next=d,d.prev=E,d}function nh(e,r,a,d){var g=new Jl(e,r,a);return d?(g.next=d.next,g.prev=d,d.next.prev=g,d.next=g):(g.prev=g,g.next=g),g}function bu(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Jl(e,r,a){this.i=e,this.x=r,this.y=a,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ku(e,r,a,d){for(var g=0,E=r,i=a-d;E<a;E+=d)g+=(e[i]-e[E])*(e[E+1]+e[i+1]),i=E;return g}function oh(e,r,a,d,g){(function E(i,t,o,l,p){for(;l>o;){if(l-o>600){var m=l-o+1,_=t-o+1,T=Math.log(m),C=.5*Math.exp(2*T/3),k=.5*Math.sqrt(T*C*(m-C)/m)*(_-m/2<0?-1:1);E(i,t,Math.max(o,Math.floor(t-_*C/m+k)),Math.min(l,Math.floor(t+(m-_)*C/m+k)),p)}var R=i[t],D=o,V=l;for(wu(i,o,t),p(i[l],R)>0&&wu(i,o,l);D<V;){for(wu(i,D,V),D++,V--;p(i[D],R)<0;)D++;for(;p(i[V],R)>0;)V--}p(i[o],R)===0?wu(i,o,V):wu(i,++V,l),V<=t&&(o=V+1),t<=V&&(l=V-1)}})(e,r,a||0,d||e.length-1,g||Zp)}function wu(e,r,a){var d=e[r];e[r]=e[a],e[a]=d}function Zp(e,r){return e<r?-1:e>r?1:0}function Tc(e,r){var a=e.length;if(a<=1)return[e];for(var d,g,E=[],i=0;i<a;i++){var t=Fo(e[i]);t!==0&&(e[i].area=Math.abs(t),g===void 0&&(g=t<0),g===t<0?(d&&E.push(d),d=[e[i]]):d.push(e[i]))}if(d&&E.push(d),r>1)for(var o=0;o<E.length;o++)E[o].length<=r||(oh(E[o],r,1,E[o].length-1,Ju),E[o]=E[o].slice(0,r));return E}function Ju(e,r){return r.area-e.area}function ah(e,r,a){for(var d=a.patternDependencies,g=!1,E=0,i=r;E<i.length;E+=1){var t=i[E].paint.get(e+"-pattern");t.isConstant()||(g=!0);var o=t.constantOr(null);o&&(g=!0,d[o.to]=!0,d[o.from]=!0)}return g}function Yu(e,r,a,d,g){for(var E=g.patternDependencies,i=0,t=r;i<t.length;i+=1){var o=t[i],l=o.paint.get(e+"-pattern").value;if(l.kind!=="constant"){var p=l.evaluate({zoom:d-1},a,{},g.availableImages),m=l.evaluate({zoom:d},a,{},g.availableImages),_=l.evaluate({zoom:d+1},a,{},g.availableImages);m=m&&m.name?m.name:m,_=_&&_.name?_.name:_,E[p=p&&p.name?p.name:p]=!0,E[m]=!0,E[_]=!0,a.patterns[o.id]={min:p,mid:m,max:_}}}return a}gu.deviation=function(e,r,a,d){var g=r&&r.length,E=Math.abs(Ku(e,0,g?r[0]*a:e.length,a));if(g)for(var i=0,t=r.length;i<t;i++)E-=Math.abs(Ku(e,r[i]*a,i<t-1?r[i+1]*a:e.length,a));var o=0;for(i=0;i<d.length;i+=3){var l=d[i]*a,p=d[i+1]*a,m=d[i+2]*a;o+=Math.abs((e[l]-e[m])*(e[p+1]-e[l+1])-(e[l]-e[p])*(e[m+1]-e[l+1]))}return E===0&&o===0?0:Math.abs((o-E)/E)},gu.flatten=function(e){for(var r=e[0][0].length,a={vertices:[],holes:[],dimensions:r},d=0,g=0;g<e.length;g++){for(var E=0;E<e[g].length;E++)for(var i=0;i<r;i++)a.vertices.push(e[g][E][i]);g>0&&a.holes.push(d+=e[g-1].length)}return a},th.default=Fp;var ts=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(r){return r.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new O,this.indexArray=new st,this.indexArray2=new qt,this.programConfigurations=new Xt(e.layers,e.zoom),this.segments=new se,this.segments2=new se,this.stateDependentLayerIds=this.layers.filter(function(r){return r.isStateDependent()}).map(function(r){return r.id})};ts.prototype.populate=function(e,r,a){this.hasPattern=ah("fill",this.layers,r);for(var d=this.layers[0].layout.get("fill-sort-key"),g=[],E=0,i=e;E<i.length;E+=1){var t=i[E],o=t.feature,l=t.id,p=t.index,m=t.sourceLayerIndex,_=this.layers[0]._featureFilter.needGeometry,T=zi(o,_);if(this.layers[0]._featureFilter.filter(new wt(this.zoom),T,a)){var C=d?d.evaluate(T,{},a,r.availableImages):void 0,k={id:l,properties:o.properties,type:o.type,sourceLayerIndex:m,index:p,geometry:_?T.geometry:xr(o),patterns:{},sortKey:C};g.push(k)}}d&&g.sort(function(we,ke){return we.sortKey-ke.sortKey});for(var R=0,D=g;R<D.length;R+=1){var V=D[R],G=V.geometry,Z=V.index,ee=V.sourceLayerIndex;if(this.hasPattern){var ae=Yu("fill",this.layers,V,this.zoom,r);this.patternFeatures.push(ae)}else this.addFeature(V,G,Z,a,{});r.featureIndex.insert(e[Z].feature,G,Z,ee,this.index)}},ts.prototype.update=function(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)},ts.prototype.addFeatures=function(e,r,a){for(var d=0,g=this.patternFeatures;d<g.length;d+=1){var E=g[d];this.addFeature(E,E.geometry,E.index,r,a)}},ts.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ts.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ts.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Op),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0},ts.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},ts.prototype.addFeature=function(e,r,a,d,g){for(var E=0,i=Tc(r,500);E<i.length;E+=1){for(var t=i[E],o=0,l=0,p=t;l<p.length;l+=1)o+=p[l].length;for(var m=this.segments.prepareSegment(o,this.layoutVertexArray,this.indexArray),_=m.vertexLength,T=[],C=[],k=0,R=t;k<R.length;k+=1){var D=R[k];if(D.length!==0){D!==t[0]&&C.push(T.length/2);var V=this.segments2.prepareSegment(D.length,this.layoutVertexArray,this.indexArray2),G=V.vertexLength;this.layoutVertexArray.emplaceBack(D[0].x,D[0].y),this.indexArray2.emplaceBack(G+D.length-1,G),T.push(D[0].x),T.push(D[0].y);for(var Z=1;Z<D.length;Z++)this.layoutVertexArray.emplaceBack(D[Z].x,D[Z].y),this.indexArray2.emplaceBack(G+Z-1,G+Z),T.push(D[Z].x),T.push(D[Z].y);V.vertexLength+=D.length,V.primitiveLength+=D.length}}for(var ee=th(T,C),ae=0;ae<ee.length;ae+=3)this.indexArray.emplaceBack(_+ee[ae],_+ee[ae+1],_+ee[ae+2]);m.vertexLength+=o,m.primitiveLength+=ee.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,g,d)},Ut("FillBucket",ts,{omit:["layers","patternFeatures"]});var sh=new b({"fill-sort-key":new Tt(ce.layout_fill["fill-sort-key"])}),lh={paint:new b({"fill-antialias":new At(ce.paint_fill["fill-antialias"]),"fill-opacity":new Tt(ce.paint_fill["fill-opacity"]),"fill-color":new Tt(ce.paint_fill["fill-color"]),"fill-outline-color":new Tt(ce.paint_fill["fill-outline-color"]),"fill-translate":new At(ce.paint_fill["fill-translate"]),"fill-translate-anchor":new At(ce.paint_fill["fill-translate-anchor"]),"fill-pattern":new qs(ce.paint_fill["fill-pattern"])}),layout:sh},uh=function(e){function r(a){e.call(this,a,lh)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.recalculate=function(a,d){e.prototype.recalculate.call(this,a,d);var g=this.paint._values["fill-outline-color"];g.value.kind==="constant"&&g.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},r.prototype.createBucket=function(a){return new ts(a)},r.prototype.queryRadius=function(){return Hr(this.paint.get("fill-translate"))},r.prototype.queryIntersectsFeature=function(a,d,g,E,i,t,o){return To(Ao(a,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),t.angle,o),E)},r.prototype.isTileClipped=function(){return!0},r}(n),$p=I([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Uh=Eu;function Eu(e,r,a,d,g){this.properties={},this.extent=a,this.type=0,this._pbf=e,this._geometry=-1,this._keys=d,this._values=g,e.readFields(Xp,this,r)}function Xp(e,r,a){e==1?r.id=a.readVarint():e==2?function(d,g){for(var E=d.readVarint()+d.pos;d.pos<E;){var i=g._keys[d.readVarint()],t=g._values[d.readVarint()];g.properties[i]=t}}(a,r):e==3?r.type=a.readVarint():e==4&&(r._geometry=a.pos)}function wl(e){for(var r,a,d=0,g=0,E=e.length,i=E-1;g<E;i=g++)d+=((a=e[i]).x-(r=e[g]).x)*(r.y+a.y);return d}Eu.types=["Unknown","Point","LineString","Polygon"],Eu.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var r,a=e.readVarint()+e.pos,d=1,g=0,E=0,i=0,t=[];e.pos<a;){if(g<=0){var o=e.readVarint();d=7&o,g=o>>3}if(g--,d===1||d===2)E+=e.readSVarint(),i+=e.readSVarint(),d===1&&(r&&t.push(r),r=[]),r.push(new Ke(E,i));else{if(d!==7)throw new Error("unknown command "+d);r&&r.push(r[0].clone())}}return r&&t.push(r),t},Eu.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var r=e.readVarint()+e.pos,a=1,d=0,g=0,E=0,i=1/0,t=-1/0,o=1/0,l=-1/0;e.pos<r;){if(d<=0){var p=e.readVarint();a=7&p,d=p>>3}if(d--,a===1||a===2)(g+=e.readSVarint())<i&&(i=g),g>t&&(t=g),(E+=e.readSVarint())<o&&(o=E),E>l&&(l=E);else if(a!==7)throw new Error("unknown command "+a)}return[i,o,t,l]},Eu.prototype.toGeoJSON=function(e,r,a){var d,g,E=this.extent*Math.pow(2,a),i=this.extent*e,t=this.extent*r,o=this.loadGeometry(),l=Eu.types[this.type];function p(T){for(var C=0;C<T.length;C++){var k=T[C];T[C]=[360*(k.x+i)/E-180,360/Math.PI*Math.atan(Math.exp((180-360*(k.y+t)/E)*Math.PI/180))-90]}}switch(this.type){case 1:var m=[];for(d=0;d<o.length;d++)m[d]=o[d][0];p(o=m);break;case 2:for(d=0;d<o.length;d++)p(o[d]);break;case 3:for(o=function(T){var C=T.length;if(C<=1)return[T];for(var k,R,D=[],V=0;V<C;V++){var G=wl(T[V]);G!==0&&(R===void 0&&(R=G<0),R===G<0?(k&&D.push(k),k=[T[V]]):k.push(T[V]))}return k&&D.push(k),D}(o),d=0;d<o.length;d++)for(g=0;g<o[d].length;g++)p(o[d][g])}o.length===1?o=o[0]:l="Multi"+l;var _={type:"Feature",geometry:{type:l,coordinates:o},properties:this.properties};return"id"in this&&(_.id=this.id),_};var Vh=ch;function ch(e,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Su,this,r),this.length=this._features.length}function Su(e,r,a){e===15?r.version=a.readVarint():e===1?r.name=a.readString():e===5?r.extent=a.readVarint():e===2?r._features.push(a.pos):e===3?r._keys.push(a.readString()):e===4&&r._values.push(function(d){for(var g=null,E=d.readVarint()+d.pos;d.pos<E;){var i=d.readVarint()>>3;g=i===1?d.readString():i===2?d.readFloat():i===3?d.readDouble():i===4?d.readVarint64():i===5?d.readVarint():i===6?d.readSVarint():i===7?d.readBoolean():null}return g}(a))}function Wp(e,r,a){if(e===3){var d=new Vh(a,a.readVarint()+a.pos);d.length&&(r[d.name]=d)}}ch.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var r=this._pbf.readVarint()+this._pbf.pos;return new Uh(this._pbf,r,this.extent,this._keys,this._values)};var Tu={VectorTile:function(e,r){this.layers=e.readFields(Wp,{},r)},VectorTileFeature:Uh,VectorTileLayer:Vh},Hp=Tu.VectorTileFeature.types,Ic=Math.pow(2,13);function Iu(e,r,a,d,g,E,i,t){e.emplaceBack(r,a,2*Math.floor(d*Ic)+i,g*Ic*2,E*Ic*2,Math.round(t))}var is=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(r){return r.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new $,this.indexArray=new st,this.programConfigurations=new Xt(e.layers,e.zoom),this.segments=new se,this.stateDependentLayerIds=this.layers.filter(function(r){return r.isStateDependent()}).map(function(r){return r.id})};function Kp(e,r){return e.x===r.x&&(e.x<0||e.x>8192)||e.y===r.y&&(e.y<0||e.y>8192)}is.prototype.populate=function(e,r,a){this.features=[],this.hasPattern=ah("fill-extrusion",this.layers,r);for(var d=0,g=e;d<g.length;d+=1){var E=g[d],i=E.feature,t=E.id,o=E.index,l=E.sourceLayerIndex,p=this.layers[0]._featureFilter.needGeometry,m=zi(i,p);if(this.layers[0]._featureFilter.filter(new wt(this.zoom),m,a)){var _={id:t,sourceLayerIndex:l,index:o,geometry:p?m.geometry:xr(i),properties:i.properties,type:i.type,patterns:{}};this.hasPattern?this.features.push(Yu("fill-extrusion",this.layers,_,this.zoom,r)):this.addFeature(_,_.geometry,o,a,{}),r.featureIndex.insert(i,_.geometry,o,l,this.index,!0)}}},is.prototype.addFeatures=function(e,r,a){for(var d=0,g=this.features;d<g.length;d+=1){var E=g[d];this.addFeature(E,E.geometry,E.index,r,a)}},is.prototype.update=function(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)},is.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},is.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},is.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$p),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},is.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},is.prototype.addFeature=function(e,r,a,d,g){for(var E=0,i=Tc(r,500);E<i.length;E+=1){for(var t=i[E],o=0,l=0,p=t;l<p.length;l+=1)o+=p[l].length;for(var m=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),_=0,T=t;_<T.length;_+=1){var C=T[_];if(C.length!==0&&!((ct=C).every(function(nt){return nt.x<0})||ct.every(function(nt){return nt.x>8192})||ct.every(function(nt){return nt.y<0})||ct.every(function(nt){return nt.y>8192})))for(var k=0,R=0;R<C.length;R++){var D=C[R];if(R>=1){var V=C[R-1];if(!Kp(D,V)){m.vertexLength+4>se.MAX_VERTEX_ARRAY_LENGTH&&(m=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var G=D.sub(V)._perp()._unit(),Z=V.dist(D);k+Z>32768&&(k=0),Iu(this.layoutVertexArray,D.x,D.y,G.x,G.y,0,0,k),Iu(this.layoutVertexArray,D.x,D.y,G.x,G.y,0,1,k),Iu(this.layoutVertexArray,V.x,V.y,G.x,G.y,0,0,k+=Z),Iu(this.layoutVertexArray,V.x,V.y,G.x,G.y,0,1,k);var ee=m.vertexLength;this.indexArray.emplaceBack(ee,ee+2,ee+1),this.indexArray.emplaceBack(ee+1,ee+2,ee+3),m.vertexLength+=4,m.primitiveLength+=2}}}}if(m.vertexLength+o>se.MAX_VERTEX_ARRAY_LENGTH&&(m=this.segments.prepareSegment(o,this.layoutVertexArray,this.indexArray)),Hp[e.type]==="Polygon"){for(var ae=[],we=[],ke=m.vertexLength,Re=0,Be=t;Re<Be.length;Re+=1){var $e=Be[Re];if($e.length!==0){$e!==t[0]&&we.push(ae.length/2);for(var Oe=0;Oe<$e.length;Oe++){var dt=$e[Oe];Iu(this.layoutVertexArray,dt.x,dt.y,0,0,1,1,0),ae.push(dt.x),ae.push(dt.y)}}}for(var ht=th(ae,we),Ye=0;Ye<ht.length;Ye+=3)this.indexArray.emplaceBack(ke+ht[Ye],ke+ht[Ye+2],ke+ht[Ye+1]);m.primitiveLength+=ht.length/3,m.vertexLength+=o}}var ct;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,g,d)},Ut("FillExtrusionBucket",is,{omit:["layers","features"]});var Jp={paint:new b({"fill-extrusion-opacity":new At(ce["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Tt(ce["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new At(ce["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new At(ce["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new qs(ce["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Tt(ce["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Tt(ce["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new At(ce["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Yp=function(e){function r(a){e.call(this,a,Jp)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.createBucket=function(a){return new is(a)},r.prototype.queryRadius=function(){return Hr(this.paint.get("fill-extrusion-translate"))},r.prototype.is3D=function(){return!0},r.prototype.queryIntersectsFeature=function(a,d,g,E,i,t,o,l){var p=Ao(a,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),t.angle,o),m=this.paint.get("fill-extrusion-height").evaluate(d,g),_=this.paint.get("fill-extrusion-base").evaluate(d,g),T=function(k,R,D,V){for(var G=[],Z=0,ee=k;Z<ee.length;Z+=1){var ae=ee[Z],we=[ae.x,ae.y,0,1];xl(we,we,R),G.push(new Ke(we[0]/we[3],we[1]/we[3]))}return G}(p,l),C=function(k,R,D,V){for(var G=[],Z=[],ee=V[8]*R,ae=V[9]*R,we=V[10]*R,ke=V[11]*R,Re=V[8]*D,Be=V[9]*D,$e=V[10]*D,Oe=V[11]*D,dt=0,ht=k;dt<ht.length;dt+=1){for(var Ye=[],ct=[],nt=0,ft=ht[dt];nt<ft.length;nt+=1){var tt=ft[nt],at=tt.x,Bt=tt.y,Dt=V[0]*at+V[4]*Bt+V[12],Qt=V[1]*at+V[5]*Bt+V[13],ri=V[2]*at+V[6]*Bt+V[14],vi=V[3]*at+V[7]*Bt+V[15],Ci=ri+we,Ui=vi+ke,Vi=Dt+Re,Mi=Qt+Be,Gi=ri+$e,Li=vi+Oe,Zi=new Ke((Dt+ee)/Ui,(Qt+ae)/Ui);Zi.z=Ci/Ui,Ye.push(Zi);var si=new Ke(Vi/Li,Mi/Li);si.z=Gi/Li,ct.push(si)}G.push(Ye),Z.push(ct)}return[G,Z]}(E,_,m,l);return function(k,R,D){var V=1/0;To(D,R)&&(V=Au(D,R[0]));for(var G=0;G<R.length;G++)for(var Z=R[G],ee=k[G],ae=0;ae<Z.length-1;ae++){var we=Z[ae],ke=[we,Z[ae+1],ee[ae+1],ee[ae],we];So(D,ke)&&(V=Math.min(V,Au(D,ke)))}return V!==1/0&&V}(C[0],C[1],T)},r}(n);function Yl(e,r){return e.x*r.x+e.y*r.y}function Au(e,r){if(e.length===1){for(var a,d=0,g=r[d++];!a||g.equals(a);)if(!(a=r[d++]))return 1/0;for(;d<r.length;d++){var E=r[d],i=e[0],t=a.sub(g),o=E.sub(g),l=i.sub(g),p=Yl(t,t),m=Yl(t,o),_=Yl(o,o),T=Yl(l,t),C=Yl(l,o),k=p*_-m*m,R=(_*T-m*C)/k,D=(p*C-m*T)/k,V=g.z*(1-R-D)+a.z*R+E.z*D;if(isFinite(V))return V}return 1/0}for(var G=1/0,Z=0,ee=r;Z<ee.length;Z+=1)G=Math.min(G,ee[Z].z);return G}var hh=I([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Qp=I([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,ed=Tu.VectorTileFeature.types,td=Math.cos(Math.PI/180*37.5),Cu=Math.pow(2,14)/.5,eo=function(e){var r=this;this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(a){r.gradients[a.id]={}}),this.layoutVertexArray=new H,this.layoutVertexArray2=new re,this.indexArray=new st,this.programConfigurations=new Xt(e.layers,e.zoom),this.segments=new se,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};eo.prototype.populate=function(e,r,a){this.hasPattern=ah("line",this.layers,r);for(var d=this.layers[0].layout.get("line-sort-key"),g=[],E=0,i=e;E<i.length;E+=1){var t=i[E],o=t.feature,l=t.id,p=t.index,m=t.sourceLayerIndex,_=this.layers[0]._featureFilter.needGeometry,T=zi(o,_);if(this.layers[0]._featureFilter.filter(new wt(this.zoom),T,a)){var C=d?d.evaluate(T,{},a):void 0,k={id:l,properties:o.properties,type:o.type,sourceLayerIndex:m,index:p,geometry:_?T.geometry:xr(o),patterns:{},sortKey:C};g.push(k)}}d&&g.sort(function(we,ke){return we.sortKey-ke.sortKey});for(var R=0,D=g;R<D.length;R+=1){var V=D[R],G=V.geometry,Z=V.index,ee=V.sourceLayerIndex;if(this.hasPattern){var ae=Yu("line",this.layers,V,this.zoom,r);this.patternFeatures.push(ae)}else this.addFeature(V,G,Z,a,{});r.featureIndex.insert(e[Z].feature,G,Z,ee,this.index)}},eo.prototype.update=function(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)},eo.prototype.addFeatures=function(e,r,a){for(var d=0,g=this.patternFeatures;d<g.length;d+=1){var E=g[d];this.addFeature(E,E.geometry,E.index,r,a)}},eo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},eo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},eo.prototype.upload=function(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Qp)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,hh),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},eo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},eo.prototype.lineFeatureClips=function(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}},eo.prototype.addFeature=function(e,r,a,d,g){var E=this.layers[0].layout,i=E.get("line-join").evaluate(e,{}),t=E.get("line-cap"),o=E.get("line-miter-limit"),l=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(var p=0,m=r;p<m.length;p+=1)this.addLine(m[p],e,i,t,o,l);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,g,d)},eo.prototype.addLine=function(e,r,a,d,g,E){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var i=0;i<e.length-1;i++)this.totalDistance+=e[i].dist(e[i+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var t=ed[r.type]==="Polygon",o=e.length;o>=2&&e[o-1].equals(e[o-2]);)o--;for(var l=0;l<o-1&&e[l].equals(e[l+1]);)l++;if(!(o<(t?3:2))){a==="bevel"&&(g=1.05);var p,m=this.overscaling<=16?122880/(512*this.overscaling):0,_=this.segments.prepareSegment(10*o,this.layoutVertexArray,this.indexArray),T=void 0,C=void 0,k=void 0,R=void 0;this.e1=this.e2=-1,t&&(R=e[l].sub(p=e[o-2])._unit()._perp());for(var D=l;D<o;D++)if(!(C=D===o-1?t?e[l+1]:void 0:e[D+1])||!e[D].equals(C)){R&&(k=R),p&&(T=p),p=e[D],R=C?C.sub(p)._unit()._perp():k;var V=(k=k||R).add(R);V.x===0&&V.y===0||V._unit();var G=k.x*R.x+k.y*R.y,Z=V.x*R.x+V.y*R.y,ee=Z!==0?1/Z:1/0,ae=2*Math.sqrt(2-2*Z),we=Z<td&&T&&C,ke=k.x*R.y-k.y*R.x>0;if(we&&D>l){var Re=p.dist(T);if(Re>2*m){var Be=p.sub(p.sub(T)._mult(m/Re)._round());this.updateDistance(T,Be),this.addCurrentVertex(Be,k,0,0,_),T=Be}}var $e=T&&C,Oe=$e?a:t?"butt":d;if($e&&Oe==="round"&&(ee<E?Oe="miter":ee<=2&&(Oe="fakeround")),Oe==="miter"&&ee>g&&(Oe="bevel"),Oe==="bevel"&&(ee>2&&(Oe="flipbevel"),ee<g&&(Oe="miter")),T&&this.updateDistance(T,p),Oe==="miter")V._mult(ee),this.addCurrentVertex(p,V,0,0,_);else if(Oe==="flipbevel"){if(ee>100)V=R.mult(-1);else{var dt=ee*k.add(R).mag()/k.sub(R).mag();V._perp()._mult(dt*(ke?-1:1))}this.addCurrentVertex(p,V,0,0,_),this.addCurrentVertex(p,V.mult(-1),0,0,_)}else if(Oe==="bevel"||Oe==="fakeround"){var ht=-Math.sqrt(ee*ee-1),Ye=ke?ht:0,ct=ke?0:ht;if(T&&this.addCurrentVertex(p,k,Ye,ct,_),Oe==="fakeround")for(var nt=Math.round(180*ae/Math.PI/20),ft=1;ft<nt;ft++){var tt=ft/nt;if(tt!==.5){var at=tt-.5;tt+=tt*at*(tt-1)*((1.0904+G*(G*(3.55645-1.43519*G)-3.2452))*at*at+(.848013+G*(.215638*G-1.06021)))}var Bt=R.sub(k)._mult(tt)._add(k)._unit()._mult(ke?-1:1);this.addHalfVertex(p,Bt.x,Bt.y,!1,ke,0,_)}C&&this.addCurrentVertex(p,R,-Ye,-ct,_)}else if(Oe==="butt")this.addCurrentVertex(p,V,0,0,_);else if(Oe==="square"){var Dt=T?1:-1;this.addCurrentVertex(p,V,Dt,Dt,_)}else Oe==="round"&&(T&&(this.addCurrentVertex(p,k,0,0,_),this.addCurrentVertex(p,k,1,1,_,!0)),C&&(this.addCurrentVertex(p,R,-1,-1,_,!0),this.addCurrentVertex(p,R,0,0,_)));if(we&&D<o-1){var Qt=p.dist(C);if(Qt>2*m){var ri=p.add(C.sub(p)._mult(m/Qt)._round());this.updateDistance(p,ri),this.addCurrentVertex(ri,R,0,0,_),p=ri}}}}},eo.prototype.addCurrentVertex=function(e,r,a,d,g,E){E===void 0&&(E=!1);var i=r.y*d-r.x,t=-r.y-r.x*d;this.addHalfVertex(e,r.x+r.y*a,r.y-r.x*a,E,!1,a,g),this.addHalfVertex(e,i,t,E,!0,-d,g),this.distance>Cu/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,r,a,d,g,E))},eo.prototype.addHalfVertex=function(e,r,a,d,g,E,i){var t=.5*(this.lineClips?this.scaledDistance*(Cu-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e.x<<1)+(d?1:0),(e.y<<1)+(g?1:0),Math.round(63*r)+128,Math.round(63*a)+128,1+(E===0?0:E<0?-1:1)|(63&t)<<2,t>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var o=i.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,o),i.primitiveLength++),g?this.e2=o:this.e1=o},eo.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},eo.prototype.updateDistance=function(e,r){this.distance+=e.dist(r),this.updateScaledDistance()},Ut("LineBucket",eo,{omit:["layers","patternFeatures"]});var id=new b({"line-cap":new At(ce.layout_line["line-cap"]),"line-join":new Tt(ce.layout_line["line-join"]),"line-miter-limit":new At(ce.layout_line["line-miter-limit"]),"line-round-limit":new At(ce.layout_line["line-round-limit"]),"line-sort-key":new Tt(ce.layout_line["line-sort-key"])}),Nh={paint:new b({"line-opacity":new Tt(ce.paint_line["line-opacity"]),"line-color":new Tt(ce.paint_line["line-color"]),"line-translate":new At(ce.paint_line["line-translate"]),"line-translate-anchor":new At(ce.paint_line["line-translate-anchor"]),"line-width":new Tt(ce.paint_line["line-width"]),"line-gap-width":new Tt(ce.paint_line["line-gap-width"]),"line-offset":new Tt(ce.paint_line["line-offset"]),"line-blur":new Tt(ce.paint_line["line-blur"]),"line-dasharray":new Or(ce.paint_line["line-dasharray"]),"line-pattern":new qs(ce.paint_line["line-pattern"]),"line-gradient":new Bn(ce.paint_line["line-gradient"])}),layout:id},jh=new(function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.possiblyEvaluate=function(a,d){return d=new wt(Math.floor(d.zoom),{now:d.now,fadeDuration:d.fadeDuration,zoomHistory:d.zoomHistory,transition:d.transition}),e.prototype.possiblyEvaluate.call(this,a,d)},r.prototype.evaluate=function(a,d,g,E){return d=mi({},d,{zoom:Math.floor(d.zoom)}),e.prototype.evaluate.call(this,a,d,g,E)},r}(Tt))(Nh.paint.properties["line-width"].specification);jh.useIntegerZoom=!0;var rd=function(e){function r(a){e.call(this,a,Nh),this.gradientVersion=0}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype._handleSpecialPaintPropertyUpdate=function(a){a==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof an,this.gradientVersion=(this.gradientVersion+1)%It)},r.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},r.prototype.recalculate=function(a,d){e.prototype.recalculate.call(this,a,d),this.paint._values["line-floorwidth"]=jh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)},r.prototype.createBucket=function(a){return new eo(a)},r.prototype.queryRadius=function(a){var d=a,g=qh(ya("line-width",this,d),ya("line-gap-width",this,d)),E=ya("line-offset",this,d);return g/2+Math.abs(E)+Hr(this.paint.get("line-translate"))},r.prototype.queryIntersectsFeature=function(a,d,g,E,i,t,o){var l=Ao(a,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),t.angle,o),p=o/2*qh(this.paint.get("line-width").evaluate(d,g),this.paint.get("line-gap-width").evaluate(d,g)),m=this.paint.get("line-offset").evaluate(d,g);return m&&(E=function(_,T){for(var C=[],k=new Ke(0,0),R=0;R<_.length;R++){for(var D=_[R],V=[],G=0;G<D.length;G++){var Z=D[G],ee=D[G+1],ae=G===0?k:Z.sub(D[G-1])._unit()._perp(),we=G===D.length-1?k:ee.sub(Z)._unit()._perp(),ke=ae._add(we)._unit();ke._mult(1/(ke.x*we.x+ke.y*we.y)),V.push(ke._mult(T)._add(Z))}C.push(V)}return C}(E,m*o)),function(_,T,C){for(var k=0;k<T.length;k++){var R=T[k];if(_.length>=3){for(var D=0;D<R.length;D++)if(Ma(_,R[D]))return!0}if(Io(_,R,C))return!0}return!1}(l,E,p)},r.prototype.isTileClipped=function(){return!0},r}(n);function qh(e,r){return r>0?r+2*e:e}var nd=I([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Gh=I([{name:"a_projected_pos",components:3,type:"Float32"}],4),ph=(I([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),I([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Zh=(I([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),I([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),$h=I([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Xh(e,r,a){return e.sections.forEach(function(d){d.text=function(g,E,i){var t=E.layout.get("text-transform").evaluate(i,{});return t==="uppercase"?g=g.toLocaleUpperCase():t==="lowercase"&&(g=g.toLocaleLowerCase()),Vt.applyArabicShaping&&(g=Vt.applyArabicShaping(g)),g}(d.text,r,a)}),e}I([{name:"triangle",components:3,type:"Uint16"}]),I([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),I([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),I([{type:"Float32",name:"offsetX"}]),I([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var zu={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Wh=function(e,r,a,d,g){var E,i,t=8*g-d-1,o=(1<<t)-1,l=o>>1,p=-7,m=a?g-1:0,_=a?-1:1,T=e[r+m];for(m+=_,E=T&(1<<-p)-1,T>>=-p,p+=t;p>0;E=256*E+e[r+m],m+=_,p-=8);for(i=E&(1<<-p)-1,E>>=-p,p+=d;p>0;i=256*i+e[r+m],m+=_,p-=8);if(E===0)E=1-l;else{if(E===o)return i?NaN:1/0*(T?-1:1);i+=Math.pow(2,d),E-=l}return(T?-1:1)*i*Math.pow(2,E-d)},Hh=function(e,r,a,d,g,E){var i,t,o,l=8*E-g-1,p=(1<<l)-1,m=p>>1,_=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,T=d?0:E-1,C=d?1:-1,k=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(t=isNaN(r)?1:0,i=p):(i=Math.floor(Math.log(r)/Math.LN2),r*(o=Math.pow(2,-i))<1&&(i--,o*=2),(r+=i+m>=1?_/o:_*Math.pow(2,1-m))*o>=2&&(i++,o/=2),i+m>=p?(t=0,i=p):i+m>=1?(t=(r*o-1)*Math.pow(2,g),i+=m):(t=r*Math.pow(2,m-1)*Math.pow(2,g),i=0));g>=8;e[a+T]=255&t,T+=C,t/=256,g-=8);for(i=i<<g|t,l+=g;l>0;e[a+T]=255&i,T+=C,i/=256,l-=8);e[a+T-C]|=128*k},Ac=ar;function ar(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}ar.Varint=0,ar.Fixed64=1,ar.Bytes=2,ar.Fixed32=5;var Kh=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Ws(e){return e.type===ar.Bytes?e.readVarint()+e.pos:e.pos+1}function vs(e,r,a){return a?4294967296*r+(e>>>0):4294967296*(r>>>0)+(e>>>0)}function zn(e,r,a){var d=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));a.realloc(d);for(var g=a.pos-1;g>=e;g--)a.buf[g+d]=a.buf[g]}function dh(e,r){for(var a=0;a<e.length;a++)r.writeVarint(e[a])}function Jh(e,r){for(var a=0;a<e.length;a++)r.writeSVarint(e[a])}function Yh(e,r){for(var a=0;a<e.length;a++)r.writeFloat(e[a])}function hr(e,r){for(var a=0;a<e.length;a++)r.writeDouble(e[a])}function El(e,r){for(var a=0;a<e.length;a++)r.writeBoolean(e[a])}function fh(e,r){for(var a=0;a<e.length;a++)r.writeFixed32(e[a])}function Qh(e,r){for(var a=0;a<e.length;a++)r.writeSFixed32(e[a])}function ep(e,r){for(var a=0;a<e.length;a++)r.writeFixed64(e[a])}function Hs(e,r){for(var a=0;a<e.length;a++)r.writeSFixed64(e[a])}function Ks(e,r){return(e[r]|e[r+1]<<8|e[r+2]<<16)+16777216*e[r+3]}function Ql(e,r,a){e[a]=r,e[a+1]=r>>>8,e[a+2]=r>>>16,e[a+3]=r>>>24}function tp(e,r){return(e[r]|e[r+1]<<8|e[r+2]<<16)+(e[r+3]<<24)}function od(e,r,a){e===1&&a.readMessage(ad,r)}function ad(e,r,a){if(e===3){var d=a.readMessage(sd,{}),g=d.width,E=d.height,i=d.left,t=d.top,o=d.advance;r.push({id:d.id,bitmap:new Hl({width:g+6,height:E+6},d.bitmap),metrics:{width:g,height:E,left:i,top:t,advance:o}})}}function sd(e,r,a){e===1?r.id=a.readVarint():e===2?r.bitmap=a.readBytes():e===3?r.width=a.readVarint():e===4?r.height=a.readVarint():e===5?r.left=a.readSVarint():e===6?r.top=a.readSVarint():e===7&&(r.advance=a.readVarint())}function ip(e){for(var r=0,a=0,d=0,g=e;d<g.length;d+=1){var E=g[d];r+=E.w*E.h,a=Math.max(a,E.w)}e.sort(function(k,R){return R.h-k.h});for(var i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),a),h:1/0}],t=0,o=0,l=0,p=e;l<p.length;l+=1)for(var m=p[l],_=i.length-1;_>=0;_--){var T=i[_];if(!(m.w>T.w||m.h>T.h)){if(m.x=T.x,m.y=T.y,o=Math.max(o,m.y+m.h),t=Math.max(t,m.x+m.w),m.w===T.w&&m.h===T.h){var C=i.pop();_<i.length&&(i[_]=C)}else m.h===T.h?(T.x+=m.w,T.w-=m.w):m.w===T.w?(T.y+=m.h,T.h-=m.h):(i.push({x:T.x+m.w,y:T.y,w:T.w-m.w,h:m.h}),T.y+=m.h,T.h-=m.h);break}}return{w:t,h:o,fill:r/(t*o)||0}}ar.prototype={destroy:function(){this.buf=null},readFields:function(e,r,a){for(a=a||this.length;this.pos<a;){var d=this.readVarint(),g=d>>3,E=this.pos;this.type=7&d,e(g,r,this),this.pos===E&&this.skip(d)}return r},readMessage:function(e,r){return this.readFields(e,r,this.readVarint()+this.pos)},readFixed32:function(){var e=Ks(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=tp(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Ks(this.buf,this.pos)+4294967296*Ks(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=Ks(this.buf,this.pos)+4294967296*tp(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=Wh(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Wh(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var r,a,d=this.buf;return r=127&(a=d[this.pos++]),a<128?r:(r|=(127&(a=d[this.pos++]))<<7,a<128?r:(r|=(127&(a=d[this.pos++]))<<14,a<128?r:(r|=(127&(a=d[this.pos++]))<<21,a<128?r:function(g,E,i){var t,o,l=i.buf;if(t=(112&(o=l[i.pos++]))>>4,o<128||(t|=(127&(o=l[i.pos++]))<<3,o<128)||(t|=(127&(o=l[i.pos++]))<<10,o<128)||(t|=(127&(o=l[i.pos++]))<<17,o<128)||(t|=(127&(o=l[i.pos++]))<<24,o<128)||(t|=(1&(o=l[i.pos++]))<<31,o<128))return vs(g,t,E);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(a=d[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,r=this.pos;return this.pos=e,e-r>=12&&Kh?function(a,d,g){return Kh.decode(a.subarray(d,g))}(this.buf,r,e):function(a,d,g){for(var E="",i=d;i<g;){var t,o,l,p=a[i],m=null,_=p>239?4:p>223?3:p>191?2:1;if(i+_>g)break;_===1?p<128&&(m=p):_===2?(192&(t=a[i+1]))==128&&(m=(31&p)<<6|63&t)<=127&&(m=null):_===3?(o=a[i+2],(192&(t=a[i+1]))==128&&(192&o)==128&&((m=(15&p)<<12|(63&t)<<6|63&o)<=2047||m>=55296&&m<=57343)&&(m=null)):_===4&&(o=a[i+2],l=a[i+3],(192&(t=a[i+1]))==128&&(192&o)==128&&(192&l)==128&&((m=(15&p)<<18|(63&t)<<12|(63&o)<<6|63&l)<=65535||m>=1114112)&&(m=null)),m===null?(m=65533,_=1):m>65535&&(m-=65536,E+=String.fromCharCode(m>>>10&1023|55296),m=56320|1023&m),E+=String.fromCharCode(m),i+=_}return E}(this.buf,r,e)},readBytes:function(){var e=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,e);return this.pos=e,r},readPackedVarint:function(e,r){if(this.type!==ar.Bytes)return e.push(this.readVarint(r));var a=Ws(this);for(e=e||[];this.pos<a;)e.push(this.readVarint(r));return e},readPackedSVarint:function(e){if(this.type!==ar.Bytes)return e.push(this.readSVarint());var r=Ws(this);for(e=e||[];this.pos<r;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==ar.Bytes)return e.push(this.readBoolean());var r=Ws(this);for(e=e||[];this.pos<r;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==ar.Bytes)return e.push(this.readFloat());var r=Ws(this);for(e=e||[];this.pos<r;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==ar.Bytes)return e.push(this.readDouble());var r=Ws(this);for(e=e||[];this.pos<r;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==ar.Bytes)return e.push(this.readFixed32());var r=Ws(this);for(e=e||[];this.pos<r;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==ar.Bytes)return e.push(this.readSFixed32());var r=Ws(this);for(e=e||[];this.pos<r;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==ar.Bytes)return e.push(this.readFixed64());var r=Ws(this);for(e=e||[];this.pos<r;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==ar.Bytes)return e.push(this.readSFixed64());var r=Ws(this);for(e=e||[];this.pos<r;)e.push(this.readSFixed64());return e},skip:function(e){var r=7&e;if(r===ar.Varint)for(;this.buf[this.pos++]>127;);else if(r===ar.Bytes)this.pos=this.readVarint()+this.pos;else if(r===ar.Fixed32)this.pos+=4;else{if(r!==ar.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(e,r){this.writeVarint(e<<3|r)},realloc:function(e){for(var r=this.length||16;r<this.pos+e;)r*=2;if(r!==this.length){var a=new Uint8Array(r);a.set(this.buf),this.buf=a,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Ql(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Ql(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Ql(this.buf,-1&e,this.pos),Ql(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Ql(this.buf,-1&e,this.pos),Ql(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(r,a){var d,g;if(r>=0?(d=r%4294967296|0,g=r/4294967296|0):(g=~(-r/4294967296),4294967295^(d=~(-r%4294967296))?d=d+1|0:(d=0,g=g+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),function(E,i,t){t.buf[t.pos++]=127&E|128,E>>>=7,t.buf[t.pos++]=127&E|128,E>>>=7,t.buf[t.pos++]=127&E|128,E>>>=7,t.buf[t.pos++]=127&E|128,t.buf[t.pos]=127&(E>>>=7)}(d,0,a),function(E,i){var t=(7&E)<<4;i.buf[i.pos++]|=t|((E>>>=3)?128:0),E&&(i.buf[i.pos++]=127&E|((E>>>=7)?128:0),E&&(i.buf[i.pos++]=127&E|((E>>>=7)?128:0),E&&(i.buf[i.pos++]=127&E|((E>>>=7)?128:0),E&&(i.buf[i.pos++]=127&E|((E>>>=7)?128:0),E&&(i.buf[i.pos++]=127&E)))))}(g,a)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var r=this.pos;this.pos=function(d,g,E){for(var i,t,o=0;o<g.length;o++){if((i=g.charCodeAt(o))>55295&&i<57344){if(!t){i>56319||o+1===g.length?(d[E++]=239,d[E++]=191,d[E++]=189):t=i;continue}if(i<56320){d[E++]=239,d[E++]=191,d[E++]=189,t=i;continue}i=t-55296<<10|i-56320|65536,t=null}else t&&(d[E++]=239,d[E++]=191,d[E++]=189,t=null);i<128?d[E++]=i:(i<2048?d[E++]=i>>6|192:(i<65536?d[E++]=i>>12|224:(d[E++]=i>>18|240,d[E++]=i>>12&63|128),d[E++]=i>>6&63|128),d[E++]=63&i|128)}return E}(this.buf,e,this.pos);var a=this.pos-r;a>=128&&zn(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeFloat:function(e){this.realloc(4),Hh(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),Hh(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var r=e.length;this.writeVarint(r),this.realloc(r);for(var a=0;a<r;a++)this.buf[this.pos++]=e[a]},writeRawMessage:function(e,r){this.pos++;var a=this.pos;e(r,this);var d=this.pos-a;d>=128&&zn(a,d,this),this.pos=a-1,this.writeVarint(d),this.pos+=d},writeMessage:function(e,r,a){this.writeTag(e,ar.Bytes),this.writeRawMessage(r,a)},writePackedVarint:function(e,r){r.length&&this.writeMessage(e,dh,r)},writePackedSVarint:function(e,r){r.length&&this.writeMessage(e,Jh,r)},writePackedBoolean:function(e,r){r.length&&this.writeMessage(e,El,r)},writePackedFloat:function(e,r){r.length&&this.writeMessage(e,Yh,r)},writePackedDouble:function(e,r){r.length&&this.writeMessage(e,hr,r)},writePackedFixed32:function(e,r){r.length&&this.writeMessage(e,fh,r)},writePackedSFixed32:function(e,r){r.length&&this.writeMessage(e,Qh,r)},writePackedFixed64:function(e,r){r.length&&this.writeMessage(e,ep,r)},writePackedSFixed64:function(e,r){r.length&&this.writeMessage(e,Hs,r)},writeBytesField:function(e,r){this.writeTag(e,ar.Bytes),this.writeBytes(r)},writeFixed32Field:function(e,r){this.writeTag(e,ar.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(e,r){this.writeTag(e,ar.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(e,r){this.writeTag(e,ar.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(e,r){this.writeTag(e,ar.Fixed64),this.writeSFixed64(r)},writeVarintField:function(e,r){this.writeTag(e,ar.Varint),this.writeVarint(r)},writeSVarintField:function(e,r){this.writeTag(e,ar.Varint),this.writeSVarint(r)},writeStringField:function(e,r){this.writeTag(e,ar.Bytes),this.writeString(r)},writeFloatField:function(e,r){this.writeTag(e,ar.Fixed32),this.writeFloat(r)},writeDoubleField:function(e,r){this.writeTag(e,ar.Fixed64),this.writeDouble(r)},writeBooleanField:function(e,r){this.writeVarintField(e,Boolean(r))}};var Cc=function(e,r){var a=r.pixelRatio,d=r.version,g=r.stretchX,E=r.stretchY,i=r.content;this.paddedRect=e,this.pixelRatio=a,this.stretchX=g,this.stretchY=E,this.content=i,this.version=d},Qu={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Qu.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Qu.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Qu.tlbr.get=function(){return this.tl.concat(this.br)},Qu.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Cc.prototype,Qu);var ec=function(e,r){var a={},d={};this.haveRenderCallbacks=[];var g=[];this.addImages(e,a,g),this.addImages(r,d,g);var E=ip(g),i=new Qn({width:E.w||1,height:E.h||1});for(var t in e){var o=e[t],l=a[t].paddedRect;Qn.copy(o.data,i,{x:0,y:0},{x:l.x+1,y:l.y+1},o.data)}for(var p in r){var m=r[p],_=d[p].paddedRect,T=_.x+1,C=_.y+1,k=m.data.width,R=m.data.height;Qn.copy(m.data,i,{x:0,y:0},{x:T,y:C},m.data),Qn.copy(m.data,i,{x:0,y:R-1},{x:T,y:C-1},{width:k,height:1}),Qn.copy(m.data,i,{x:0,y:0},{x:T,y:C+R},{width:k,height:1}),Qn.copy(m.data,i,{x:k-1,y:0},{x:T-1,y:C},{width:1,height:R}),Qn.copy(m.data,i,{x:0,y:0},{x:T+k,y:C},{width:1,height:R})}this.image=i,this.iconPositions=a,this.patternPositions=d};ec.prototype.addImages=function(e,r,a){for(var d in e){var g=e[d],E={x:0,y:0,w:g.data.width+2,h:g.data.height+2};a.push(E),r[d]=new Cc(E,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(d)}},ec.prototype.patchUpdatedImages=function(e,r){for(var a in e.dispatchRenderCallbacks(this.haveRenderCallbacks),e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),r),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),r)},ec.prototype.patchUpdatedImage=function(e,r,a){if(e&&r&&e.version!==r.version){e.version=r.version;var d=e.tl;a.update(r.data,void 0,{x:d[0],y:d[1]})}},Ut("ImagePosition",Cc),Ut("ImageAtlas",ec);var Jo={horizontal:1,vertical:2,horizontalOnly:3},Js=function(){this.scale=1,this.fontStack="",this.imageName=null};Js.forText=function(e,r){var a=new Js;return a.scale=e||1,a.fontStack=r,a},Js.forImage=function(e){var r=new Js;return r.imageName=e,r};var Jr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function tc(e,r,a,d,g,E,i,t,o,l,p,m,_,T,C,k){var R,D=Jr.fromFeature(e,g);m===Jo.vertical&&D.verticalizePunctuation();var V=Vt.processBidirectionalText,G=Vt.processStyledBidirectionalText;if(V&&D.sections.length===1){R=[];for(var Z=0,ee=V(D.toString(),Pu(D,l,E,r,d,T,C));Z<ee.length;Z+=1){var ae=ee[Z],we=new Jr;we.text=ae,we.sections=D.sections;for(var ke=0;ke<ae.length;ke++)we.sectionIndex.push(0);R.push(we)}}else if(G){R=[];for(var Re=0,Be=G(D.text,D.sectionIndex,Pu(D,l,E,r,d,T,C));Re<Be.length;Re+=1){var $e=Be[Re],Oe=new Jr;Oe.text=$e[0],Oe.sectionIndex=$e[1],Oe.sections=D.sections,R.push(Oe)}}else R=function(Ye,ct){for(var nt=[],ft=Ye.text,tt=0,at=0,Bt=ct;at<Bt.length;at+=1){var Dt=Bt[at];nt.push(Ye.substring(tt,Dt)),tt=Dt}return tt<ft.length&&nt.push(Ye.substring(tt,ft.length)),nt}(D,Pu(D,l,E,r,d,T,C));var dt=[],ht={positionedLines:dt,text:D.toString(),top:p[1],bottom:p[1],left:p[0],right:p[0],writingMode:m,iconsInText:!1,verticalizable:!1};return function(Ye,ct,nt,ft,tt,at,Bt,Dt,Qt,ri,vi,Ci){for(var Ui=0,Vi=-17,Mi=0,Gi=0,Li=Dt==="right"?1:Dt==="left"?0:.5,Zi=0,si=0,fi=tt;si<fi.length;si+=1){var xi=fi[si];xi.trim();var hi=xi.getMaxScale(),sr=24*(hi-1),ir={positionedGlyphs:[],lineOffset:0};Ye.positionedLines[Zi]=ir;var ki=ir.positionedGlyphs,Ii=0;if(xi.length()){for(var qi=0;qi<xi.length();qi++){var jt=xi.getSection(qi),Qr=xi.getSectionIndex(qi),pr=xi.getCharCode(qi),kr=0,Hi=null,Pn=null,cn=null,Yo=24,to=!(Qt===Jo.horizontal||!vi&&!fa(pr)||vi&&(zc[pr]||(ws=pr,St.Arabic(ws)||St["Arabic Supplement"](ws)||St["Arabic Extended-A"](ws)||St["Arabic Presentation Forms-A"](ws)||St["Arabic Presentation Forms-B"](ws))));if(jt.imageName){var io=ft[jt.imageName];if(!io)continue;cn=jt.imageName,Ye.iconsInText=Ye.iconsInText||!0,Pn=io.paddedRect;var en=io.displaySize;jt.scale=24*jt.scale/Ci,kr=sr+(24-en[1]*jt.scale),Yo=(Hi={width:en[0],height:en[1],left:1,top:-3,advance:to?en[1]:en[0]}).advance;var Qo=to?en[0]*jt.scale-24*hi:en[1]*jt.scale-24*hi;Qo>0&&Qo>Ii&&(Ii=Qo)}else{var Pl=nt[jt.fontStack],au=Pl&&Pl[pr];if(au&&au.rect)Pn=au.rect,Hi=au.metrics;else{var su=ct[jt.fontStack],Ou=su&&su[pr];if(!Ou)continue;Hi=Ou.metrics}kr=24*(hi-jt.scale)}to?(Ye.verticalizable=!0,ki.push({glyph:pr,imageName:cn,x:Ui,y:Vi+kr,vertical:to,scale:jt.scale,fontStack:jt.fontStack,sectionIndex:Qr,metrics:Hi,rect:Pn}),Ui+=Yo*jt.scale+ri):(ki.push({glyph:pr,imageName:cn,x:Ui,y:Vi+kr,vertical:to,scale:jt.scale,fontStack:jt.fontStack,sectionIndex:Qr,metrics:Hi,rect:Pn}),Ui+=Hi.advance*jt.scale+ri)}ki.length!==0&&(Mi=Math.max(Ui-ri,Mi),ku(ki,0,ki.length-1,Li,Ii)),Ui=0;var Ra=at*hi+Ii;ir.lineOffset=Math.max(Ii,sr),Vi+=Ra,Gi=Math.max(Ra,Gi),++Zi}else Vi+=at,++Zi}var ws,lu=Vi- -17,kl=eu(Bt),tl=kl.horizontalAlign,Fu=kl.verticalAlign;(function(Nc,jc,hc,pc,qc,dc,fc,Ro,uu){var cu,ro=(jc-hc)*qc;cu=dc!==fc?-Ro*pc- -17:(-pc*uu+.5)*fc;for(var Bo=0,il=Nc;Bo<il.length;Bo+=1)for(var rs=0,Uu=il[Bo].positionedGlyphs;rs<Uu.length;rs+=1){var Ba=Uu[rs];Ba.x+=ro,Ba.y+=cu}})(Ye.positionedLines,Li,tl,Fu,Mi,Gi,at,lu,tt.length),Ye.top+=-Fu*lu,Ye.bottom=Ye.top+lu,Ye.left+=-tl*Mi,Ye.right=Ye.left+Mi}(ht,r,a,d,R,i,t,o,m,l,_,k),!function(Ye){for(var ct=0,nt=Ye;ct<nt.length;ct+=1)if(nt[ct].positionedGlyphs.length!==0)return!1;return!0}(dt)&&ht}Jr.fromFeature=function(e,r){for(var a=new Jr,d=0;d<e.sections.length;d++){var g=e.sections[d];g.image?a.addImageSection(g):a.addTextSection(g,r)}return a},Jr.prototype.length=function(){return this.text.length},Jr.prototype.getSection=function(e){return this.sections[this.sectionIndex[e]]},Jr.prototype.getSectionIndex=function(e){return this.sectionIndex[e]},Jr.prototype.getCharCode=function(e){return this.text.charCodeAt(e)},Jr.prototype.verticalizePunctuation=function(){this.text=function(e){for(var r="",a=0;a<e.length;a++){var d=e.charCodeAt(a+1)||null,g=e.charCodeAt(a-1)||null;r+=d&&js(d)&&!zu[e[a+1]]||g&&js(g)&&!zu[e[a-1]]||!zu[e[a]]?e[a]:zu[e[a]]}return r}(this.text)},Jr.prototype.trim=function(){for(var e=0,r=0;r<this.text.length&&zc[this.text.charCodeAt(r)];r++)e++;for(var a=this.text.length,d=this.text.length-1;d>=0&&d>=e&&zc[this.text.charCodeAt(d)];d--)a--;this.text=this.text.substring(e,a),this.sectionIndex=this.sectionIndex.slice(e,a)},Jr.prototype.substring=function(e,r){var a=new Jr;return a.text=this.text.substring(e,r),a.sectionIndex=this.sectionIndex.slice(e,r),a.sections=this.sections,a},Jr.prototype.toString=function(){return this.text},Jr.prototype.getMaxScale=function(){var e=this;return this.sectionIndex.reduce(function(r,a){return Math.max(r,e.sections[a].scale)},0)},Jr.prototype.addTextSection=function(e,r){this.text+=e.text,this.sections.push(Js.forText(e.scale,e.fontStack||r));for(var a=this.sections.length-1,d=0;d<e.text.length;++d)this.sectionIndex.push(a)},Jr.prototype.addImageSection=function(e){var r=e.image?e.image.name:"";if(r.length!==0){var a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(Js.forImage(r)),this.sectionIndex.push(this.sections.length-1)):nr("Reached maximum number of images 6401")}else nr("Can't add FormattedSection with an empty image.")},Jr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var zc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Do={};function rp(e,r,a,d,g,E){if(r.imageName){var i=d[r.imageName];return i?i.displaySize[0]*r.scale*24/E+g:0}var t=a[r.fontStack],o=t&&t[e];return o?o.metrics.advance*r.scale+g:0}function mh(e,r,a,d){var g=Math.pow(e-r,2);return d?e<r?g/2:2*g:g+Math.abs(a)*a}function yh(e,r,a){var d=0;return e===10&&(d-=1e4),a&&(d+=150),e!==40&&e!==65288||(d+=50),r!==41&&r!==65289||(d+=50),d}function gh(e,r,a,d,g,E){for(var i=null,t=mh(r,a,g,E),o=0,l=d;o<l.length;o+=1){var p=l[o],m=mh(r-p.x,a,g,E)+p.badness;m<=t&&(i=p,t=m)}return{index:e,x:r,priorBreak:i,badness:t}}function Pu(e,r,a,d,g,E,i){if(E!=="point")return[];if(!e)return[];for(var t,o=[],l=function(R,D,V,G,Z,ee){for(var ae=0,we=0;we<R.length();we++){var ke=R.getSection(we);ae+=rp(R.getCharCode(we),ke,G,Z,D,ee)}return ae/Math.max(1,Math.ceil(ae/V))}(e,r,a,d,g,i),p=e.text.indexOf("\u200B")>=0,m=0,_=0;_<e.length();_++){var T=e.getSection(_),C=e.getCharCode(_);if(zc[C]||(m+=rp(C,T,d,g,r,i)),_<e.length()-1){var k=!((t=C)<11904||!(St["Bopomofo Extended"](t)||St.Bopomofo(t)||St["CJK Compatibility Forms"](t)||St["CJK Compatibility Ideographs"](t)||St["CJK Compatibility"](t)||St["CJK Radicals Supplement"](t)||St["CJK Strokes"](t)||St["CJK Symbols and Punctuation"](t)||St["CJK Unified Ideographs Extension A"](t)||St["CJK Unified Ideographs"](t)||St["Enclosed CJK Letters and Months"](t)||St["Halfwidth and Fullwidth Forms"](t)||St.Hiragana(t)||St["Ideographic Description Characters"](t)||St["Kangxi Radicals"](t)||St["Katakana Phonetic Extensions"](t)||St.Katakana(t)||St["Vertical Forms"](t)||St["Yi Radicals"](t)||St["Yi Syllables"](t)));(Do[C]||k||T.imageName)&&o.push(gh(_+1,m,l,o,yh(C,e.getCharCode(_+1),k&&p),!1))}}return function R(D){return D?R(D.priorBreak).concat(D.index):[]}(gh(e.length(),m,l,o,0,!0))}function eu(e){var r=.5,a=.5;switch(e){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:r,verticalAlign:a}}function ku(e,r,a,d,g){if(d||g)for(var E=e[a],i=(e[a].x+E.metrics.advance*E.scale)*d,t=r;t<=a;t++)e[t].x-=i,e[t].y+=g}function ic(e,r,a,d,g,E){var i,t=e.image;if(t.content){var o=t.content,l=t.pixelRatio||1;i=[o[0]/l,o[1]/l,t.displaySize[0]-o[2]/l,t.displaySize[1]-o[3]/l]}var p,m,_,T,C=r.left*E,k=r.right*E;a==="width"||a==="both"?(T=g[0]+C-d[3],m=g[0]+k+d[1]):m=(T=g[0]+(C+k-t.displaySize[0])/2)+t.displaySize[0];var R=r.top*E,D=r.bottom*E;return a==="height"||a==="both"?(p=g[1]+R-d[0],_=g[1]+D+d[2]):_=(p=g[1]+(R+D-t.displaySize[1])/2)+t.displaySize[1],{image:t,top:p,right:m,bottom:_,left:T,collisionPadding:i}}Do[10]=!0,Do[32]=!0,Do[38]=!0,Do[40]=!0,Do[41]=!0,Do[43]=!0,Do[45]=!0,Do[47]=!0,Do[173]=!0,Do[183]=!0,Do[8203]=!0,Do[8208]=!0,Do[8211]=!0,Do[8231]=!0;var Ys=function(e){function r(a,d,g,E){e.call(this,a,d),this.angle=g,E!==void 0&&(this.segment=E)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.clone=function(){return new r(this.x,this.y,this.angle,this.segment)},r}(Ke);function _h(e,r){var a=r.expression;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new wt(e+1))};if(a.kind==="source")return{kind:"source"};for(var d=a.zoomStops,g=a.interpolationType,E=0;E<d.length&&d[E]<=e;)E++;for(var i=E=Math.max(0,E-1);i<d.length&&d[i]<e+1;)i++;i=Math.min(d.length-1,i);var t=d[E],o=d[i];return a.kind==="composite"?{kind:"composite",minZoom:t,maxZoom:o,interpolationType:g}:{kind:"camera",minZoom:t,maxZoom:o,minSize:a.evaluate(new wt(t)),maxSize:a.evaluate(new wt(o)),interpolationType:g}}function vh(e,r,a){var d=r.uSize,g=a.lowerSize;return e.kind==="source"?g/128:e.kind==="composite"?Sr(g/128,a.upperSize/128,r.uSizeT):d}function xh(e,r){var a=0,d=0;if(e.kind==="constant")d=e.layoutSize;else if(e.kind!=="source"){var g=e.interpolationType,E=g?zt(ln.interpolationFactor(g,r,e.minZoom,e.maxZoom),0,1):0;e.kind==="camera"?d=Sr(e.minSize,e.maxSize,E):a=E}return{uSizeT:a,uSize:d}}Ut("Anchor",Ys);var ld=Object.freeze({__proto__:null,getSizeData:_h,evaluateSizeForFeature:vh,evaluateSizeForZoom:xh,SIZE_PACK_FACTOR:128});function bh(e,r,a,d,g){if(r.segment===void 0)return!0;for(var E=r,i=r.segment+1,t=0;t>-a/2;){if(--i<0)return!1;t-=e[i].dist(E),E=e[i]}t+=e[i].dist(e[i+1]),i++;for(var o=[],l=0;t<a/2;){var p=e[i],m=e[i+1];if(!m)return!1;var _=e[i-1].angleTo(p)-p.angleTo(m);for(_=Math.abs((_+3*Math.PI)%(2*Math.PI)-Math.PI),o.push({distance:t,angleDelta:_}),l+=_;t-o[0].distance>d;)l-=o.shift().angleDelta;if(l>g)return!1;i++,t+=p.dist(m)}return!0}function wh(e){for(var r=0,a=0;a<e.length-1;a++)r+=e[a].dist(e[a+1]);return r}function Pc(e,r,a){return e?.6*r*a:0}function kc(e,r){return Math.max(e?e.right-e.left:0,r?r.right-r.left:0)}function ud(e,r,a,d,g,E){for(var i=Pc(a,g,E),t=kc(a,d)*E,o=0,l=wh(e)/2,p=0;p<e.length-1;p++){var m=e[p],_=e[p+1],T=m.dist(_);if(o+T>l){var C=(l-o)/T,k=Sr(m.x,_.x,C),R=Sr(m.y,_.y,C),D=new Ys(k,R,_.angleTo(m),p);return D._round(),!i||bh(e,D,t,i,r)?D:void 0}o+=T}}function cd(e,r,a,d,g,E,i,t,o){var l=Pc(d,E,i),p=kc(d,g),m=p*i,_=e[0].x===0||e[0].x===o||e[0].y===0||e[0].y===o;return r-m<r/4&&(r=m+r/4),function T(C,k,R,D,V,G,Z,ee,ae){for(var we=G/2,ke=wh(C),Re=0,Be=k-R,$e=[],Oe=0;Oe<C.length-1;Oe++){for(var dt=C[Oe],ht=C[Oe+1],Ye=dt.dist(ht),ct=ht.angleTo(dt);Be+R<Re+Ye;){var nt=((Be+=R)-Re)/Ye,ft=Sr(dt.x,ht.x,nt),tt=Sr(dt.y,ht.y,nt);if(ft>=0&&ft<ae&&tt>=0&&tt<ae&&Be-we>=0&&Be+we<=ke){var at=new Ys(ft,tt,ct,Oe);at._round(),D&&!bh(C,at,G,D,V)||$e.push(at)}}Re+=Ye}return ee||$e.length||Z||($e=T(C,Re/2,R,D,V,G,Z,!0,ae)),$e}(e,_?r/2*t%r:(p/2+2*E)*i*t%r,r,l,a,m,_,!1,o)}function Eh(e,r,a,d,g){for(var E=[],i=0;i<e.length;i++)for(var t=e[i],o=void 0,l=0;l<t.length-1;l++){var p=t[l],m=t[l+1];p.x<r&&m.x<r||(p.x<r?p=new Ke(r,p.y+(r-p.x)/(m.x-p.x)*(m.y-p.y))._round():m.x<r&&(m=new Ke(r,p.y+(r-p.x)/(m.x-p.x)*(m.y-p.y))._round()),p.y<a&&m.y<a||(p.y<a?p=new Ke(p.x+(a-p.y)/(m.y-p.y)*(m.x-p.x),a)._round():m.y<a&&(m=new Ke(p.x+(a-p.y)/(m.y-p.y)*(m.x-p.x),a)._round()),p.x>=d&&m.x>=d||(p.x>=d?p=new Ke(d,p.y+(d-p.x)/(m.x-p.x)*(m.y-p.y))._round():m.x>=d&&(m=new Ke(d,p.y+(d-p.x)/(m.x-p.x)*(m.y-p.y))._round()),p.y>=g&&m.y>=g||(p.y>=g?p=new Ke(p.x+(g-p.y)/(m.y-p.y)*(m.x-p.x),g)._round():m.y>=g&&(m=new Ke(p.x+(g-p.y)/(m.y-p.y)*(m.x-p.x),g)._round()),o&&p.equals(o[o.length-1])||E.push(o=[p]),o.push(m)))))}return E}function xs(e,r,a,d){var g=[],E=e.image,i=E.pixelRatio,t=E.paddedRect.w-2,o=E.paddedRect.h-2,l=e.right-e.left,p=e.bottom-e.top,m=E.stretchX||[[0,t]],_=E.stretchY||[[0,o]],T=function(ft,tt){return ft+tt[1]-tt[0]},C=m.reduce(T,0),k=_.reduce(T,0),R=t-C,D=o-k,V=0,G=C,Z=0,ee=k,ae=0,we=R,ke=0,Re=D;if(E.content&&d){var Be=E.content;V=rc(m,0,Be[0]),Z=rc(_,0,Be[1]),G=rc(m,Be[0],Be[2]),ee=rc(_,Be[1],Be[3]),ae=Be[0]-V,ke=Be[1]-Z,we=Be[2]-Be[0]-G,Re=Be[3]-Be[1]-ee}var $e=function(ft,tt,at,Bt){var Dt=nc(ft.stretch-V,G,l,e.left),Qt=oc(ft.fixed-ae,we,ft.stretch,C),ri=nc(tt.stretch-Z,ee,p,e.top),vi=oc(tt.fixed-ke,Re,tt.stretch,k),Ci=nc(at.stretch-V,G,l,e.left),Ui=oc(at.fixed-ae,we,at.stretch,C),Vi=nc(Bt.stretch-Z,ee,p,e.top),Mi=oc(Bt.fixed-ke,Re,Bt.stretch,k),Gi=new Ke(Dt,ri),Li=new Ke(Ci,ri),Zi=new Ke(Ci,Vi),si=new Ke(Dt,Vi),fi=new Ke(Qt/i,vi/i),xi=new Ke(Ui/i,Mi/i),hi=r*Math.PI/180;if(hi){var sr=Math.sin(hi),ir=Math.cos(hi),ki=[ir,-sr,sr,ir];Gi._matMult(ki),Li._matMult(ki),si._matMult(ki),Zi._matMult(ki)}var Ii=ft.stretch+ft.fixed,qi=tt.stretch+tt.fixed;return{tl:Gi,tr:Li,bl:si,br:Zi,tex:{x:E.paddedRect.x+1+Ii,y:E.paddedRect.y+1+qi,w:at.stretch+at.fixed-Ii,h:Bt.stretch+Bt.fixed-qi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:fi,pixelOffsetBR:xi,minFontScaleX:we/i/l,minFontScaleY:Re/i/p,isSDF:a}};if(d&&(E.stretchX||E.stretchY))for(var Oe=Qs(m,R,C),dt=Qs(_,D,k),ht=0;ht<Oe.length-1;ht++)for(var Ye=Oe[ht],ct=Oe[ht+1],nt=0;nt<dt.length-1;nt++)g.push($e(Ye,dt[nt],ct,dt[nt+1]));else g.push($e({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:t+1},{fixed:0,stretch:o+1}));return g}function rc(e,r,a){for(var d=0,g=0,E=e;g<E.length;g+=1){var i=E[g];d+=Math.max(r,Math.min(a,i[1]))-Math.max(r,Math.min(a,i[0]))}return d}function Qs(e,r,a){for(var d=[{fixed:-1,stretch:0}],g=0,E=e;g<E.length;g+=1){var i=E[g],t=i[0],o=i[1],l=d[d.length-1];d.push({fixed:t-l.stretch,stretch:l.stretch}),d.push({fixed:t-l.stretch,stretch:l.stretch+(o-t)})}return d.push({fixed:r+1,stretch:a}),d}function nc(e,r,a,d){return e/r*a+d}function oc(e,r,a,d){return e-r*a/d}var ac=function(e,r,a,d,g,E,i,t,o,l){if(this.boxStartIndex=e.length,o){var p=E.top,m=E.bottom,_=E.collisionPadding;_&&(p-=_[1],m+=_[3]);var T=m-p;T>0&&(T=Math.max(10,T),this.circleDiameter=T)}else{var C=E.top*i-t,k=E.bottom*i+t,R=E.left*i-t,D=E.right*i+t,V=E.collisionPadding;if(V&&(R-=V[0]*i,C-=V[1]*i,D+=V[2]*i,k+=V[3]*i),l){var G=new Ke(R,C),Z=new Ke(D,C),ee=new Ke(R,k),ae=new Ke(D,k),we=l*Math.PI/180;G._rotate(we),Z._rotate(we),ee._rotate(we),ae._rotate(we),R=Math.min(G.x,Z.x,ee.x,ae.x),D=Math.max(G.x,Z.x,ee.x,ae.x),C=Math.min(G.y,Z.y,ee.y,ae.y),k=Math.max(G.y,Z.y,ee.y,ae.y)}e.emplaceBack(r.x,r.y,R,C,D,k,a,d,g)}this.boxEndIndex=e.length},tu=function(e,r){if(e===void 0&&(e=[]),r===void 0&&(r=hd),this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(var a=(this.length>>1)-1;a>=0;a--)this._down(a)};function hd(e,r){return e<r?-1:e>r?1:0}function pd(e,r,a){r===void 0&&(r=1),a===void 0&&(a=!1);for(var d=1/0,g=1/0,E=-1/0,i=-1/0,t=e[0],o=0;o<t.length;o++){var l=t[o];(!o||l.x<d)&&(d=l.x),(!o||l.y<g)&&(g=l.y),(!o||l.x>E)&&(E=l.x),(!o||l.y>i)&&(i=l.y)}var p=Math.min(E-d,i-g),m=p/2,_=new tu([],np);if(p===0)return new Ke(d,g);for(var T=d;T<E;T+=p)for(var C=g;C<i;C+=p)_.push(new iu(T+m,C+m,m,e));for(var k=function(V){for(var G=0,Z=0,ee=0,ae=V[0],we=0,ke=ae.length,Re=ke-1;we<ke;Re=we++){var Be=ae[we],$e=ae[Re],Oe=Be.x*$e.y-$e.x*Be.y;Z+=(Be.x+$e.x)*Oe,ee+=(Be.y+$e.y)*Oe,G+=3*Oe}return new iu(Z/G,ee/G,0,V)}(e),R=_.length;_.length;){var D=_.pop();(D.d>k.d||!k.d)&&(k=D,a&&console.log("found best %d after %d probes",Math.round(1e4*D.d)/1e4,R)),D.max-k.d<=r||(_.push(new iu(D.p.x-(m=D.h/2),D.p.y-m,m,e)),_.push(new iu(D.p.x+m,D.p.y-m,m,e)),_.push(new iu(D.p.x-m,D.p.y+m,m,e)),_.push(new iu(D.p.x+m,D.p.y+m,m,e)),R+=4)}return a&&(console.log("num probes: "+R),console.log("best distance: "+k.d)),k.p}function np(e,r){return r.max-e.max}function iu(e,r,a,d){this.p=new Ke(e,r),this.h=a,this.d=function(g,E){for(var i=!1,t=1/0,o=0;o<E.length;o++)for(var l=E[o],p=0,m=l.length,_=m-1;p<m;_=p++){var T=l[p],C=l[_];T.y>g.y!=C.y>g.y&&g.x<(C.x-T.x)*(g.y-T.y)/(C.y-T.y)+T.x&&(i=!i),t=Math.min(t,_l(g,T,C))}return(i?1:-1)*Math.sqrt(t)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}tu.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},tu.prototype.pop=function(){if(this.length!==0){var e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}},tu.prototype.peek=function(){return this.data[0]},tu.prototype._up=function(e){for(var r=this.data,a=this.compare,d=r[e];e>0;){var g=e-1>>1,E=r[g];if(a(d,E)>=0)break;r[e]=E,e=g}r[e]=d},tu.prototype._down=function(e){for(var r=this.data,a=this.compare,d=this.length>>1,g=r[e];e<d;){var E=1+(e<<1),i=r[E],t=E+1;if(t<this.length&&a(r[t],i)<0&&(E=t,i=r[t]),a(i,g)>=0)break;r[e]=i,e=E}r[e]=g};var Mc=Number.POSITIVE_INFINITY;function sc(e,r){return r[1]!==Mc?function(a,d,g){var E=0,i=0;switch(d=Math.abs(d),g=Math.abs(g),a){case"top-right":case"top-left":case"top":i=g-7;break;case"bottom-right":case"bottom-left":case"bottom":i=7-g}switch(a){case"top-right":case"bottom-right":case"right":E=-d;break;case"top-left":case"bottom-left":case"left":E=d}return[E,i]}(e,r[0],r[1]):function(a,d){var g=0,E=0;d<0&&(d=0);var i=d/Math.sqrt(2);switch(a){case"top-right":case"top-left":E=i-7;break;case"bottom-right":case"bottom-left":E=7-i;break;case"bottom":E=7-d;break;case"top":E=d-7}switch(a){case"top-right":case"bottom-right":g=-i;break;case"top-left":case"bottom-left":g=i;break;case"left":g=d;break;case"right":g=-d}return[g,E]}(e,r[0])}function Lc(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function lc(e,r,a,d,g,E,i,t,o,l,p,m,_,T,C){var k=function(Z,ee,ae,we,ke,Re,Be,$e){for(var Oe=we.layout.get("text-rotate").evaluate(Re,{})*Math.PI/180,dt=[],ht=0,Ye=ee.positionedLines;ht<Ye.length;ht+=1)for(var ct=Ye[ht],nt=0,ft=ct.positionedGlyphs;nt<ft.length;nt+=1){var tt=ft[nt];if(tt.rect){var at=tt.rect||{},Bt=4,Dt=!0,Qt=1,ri=0,vi=(ke||$e)&&tt.vertical,Ci=tt.metrics.advance*tt.scale/2;if($e&&ee.verticalizable&&(ri=ct.lineOffset/2-(tt.imageName?-(24-tt.metrics.width*tt.scale)/2:24*(tt.scale-1))),tt.imageName){var Ui=Be[tt.imageName];Dt=Ui.sdf,Bt=1/(Qt=Ui.pixelRatio)}var Vi=ke?[tt.x+Ci,tt.y]:[0,0],Mi=ke?[0,0]:[tt.x+Ci+ae[0],tt.y+ae[1]-ri],Gi=[0,0];vi&&(Gi=Mi,Mi=[0,0]);var Li=(tt.metrics.left-Bt)*tt.scale-Ci+Mi[0],Zi=(-tt.metrics.top-Bt)*tt.scale+Mi[1],si=Li+at.w*tt.scale/Qt,fi=Zi+at.h*tt.scale/Qt,xi=new Ke(Li,Zi),hi=new Ke(si,Zi),sr=new Ke(Li,fi),ir=new Ke(si,fi);if(vi){var ki=new Ke(-Ci,Ci- -17),Ii=-Math.PI/2,qi=12-Ci,jt=new Ke(22-qi,-(tt.imageName?qi:0)),Qr=new(Function.prototype.bind.apply(Ke,[null].concat(Gi)));xi._rotateAround(Ii,ki)._add(jt)._add(Qr),hi._rotateAround(Ii,ki)._add(jt)._add(Qr),sr._rotateAround(Ii,ki)._add(jt)._add(Qr),ir._rotateAround(Ii,ki)._add(jt)._add(Qr)}if(Oe){var pr=Math.sin(Oe),kr=Math.cos(Oe),Hi=[kr,-pr,pr,kr];xi._matMult(Hi),hi._matMult(Hi),sr._matMult(Hi),ir._matMult(Hi)}var Pn=new Ke(0,0),cn=new Ke(0,0);dt.push({tl:xi,tr:hi,bl:sr,br:ir,tex:at,writingMode:ee.writingMode,glyphOffset:Vi,sectionIndex:tt.sectionIndex,isSDF:Dt,pixelOffsetTL:Pn,pixelOffsetBR:cn,minFontScaleX:0,minFontScaleY:0})}}return dt}(0,a,t,g,E,i,d,e.allowVerticalPlacement),R=e.textSizeData,D=null;R.kind==="source"?(D=[128*g.layout.get("text-size").evaluate(i,{})])[0]>32640&&nr(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):R.kind==="composite"&&((D=[128*T.compositeTextSizes[0].evaluate(i,{},C),128*T.compositeTextSizes[1].evaluate(i,{},C)])[0]>32640||D[1]>32640)&&nr(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),e.addSymbols(e.text,k,D,t,E,i,l,r,o.lineStartIndex,o.lineLength,_,C);for(var V=0,G=p;V<G.length;V+=1)m[G[V]]=e.text.placedSymbolArray.length-1;return 4*k.length}function uc(e){for(var r in e)return e[r];return null}function Dc(e,r,a,d){var g=e.compareText;if(r in g){for(var E=g[r],i=E.length-1;i>=0;i--)if(d.dist(E[i])<a)return!0}else g[r]=[];return g[r].push(d),!1}var dd=Tu.VectorTileFeature.types,fd=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Rc(e,r,a,d,g,E,i,t,o,l,p,m,_){var T=t?Math.min(32640,Math.round(t[0])):0,C=t?Math.min(32640,Math.round(t[1])):0;e.emplaceBack(r,a,Math.round(32*d),Math.round(32*g),E,i,(T<<1)+(o?1:0),C,16*l,16*p,256*m,256*_)}function Sh(e,r,a){e.emplaceBack(r.x,r.y,a),e.emplaceBack(r.x,r.y,a),e.emplaceBack(r.x,r.y,a),e.emplaceBack(r.x,r.y,a)}function Mu(e){for(var r=0,a=e.sections;r<a.length;r+=1)if(or(a[r].text))return!0;return!1}var Sl=function(e){this.layoutVertexArray=new Pe,this.indexArray=new st,this.programConfigurations=e,this.segments=new se,this.dynamicLayoutVertexArray=new ye,this.opacityVertexArray=new ze,this.placedSymbolArray=new f};Sl.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Sl.prototype.upload=function(e,r,a,d){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,nd.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Gh.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,fd,!0),this.opacityVertexBuffer.itemSize=1),(a||d)&&this.programConfigurations.upload(e))},Sl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Ut("SymbolBuffers",Sl);var Lu=function(e,r,a){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new a,this.segments=new se,this.collisionVertexArray=new je};Lu.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,ph.members,!0)},Lu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Ut("CollisionBuffers",Lu);var Wi=function(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(E){return E.id}),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Yn([]),this.placementViewportMatrix=Yn([]);var r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=_h(this.zoom,r["text-size"]),this.iconSizeData=_h(this.zoom,r["icon-size"]);var a=this.layers[0].layout,d=a.get("symbol-sort-key"),g=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&d.constantOr(1)!==void 0,this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(function(E){return Jo[E]})),this.stateDependentLayerIds=this.layers.filter(function(E){return E.isStateDependent()}).map(function(E){return E.id}),this.sourceID=e.sourceID};Wi.prototype.createArrays=function(){this.text=new Sl(new Xt(this.layers,this.zoom,function(e){return/^text/.test(e)})),this.icon=new Sl(new Xt(this.layers,this.zoom,function(e){return/^icon/.test(e)})),this.glyphOffsetArray=new z,this.lineVertexArray=new B,this.symbolInstances=new A},Wi.prototype.calculateGlyphDependencies=function(e,r,a,d,g){for(var E=0;E<e.length;E++)if(r[e.charCodeAt(E)]=!0,(a||d)&&g){var i=zu[e.charAt(E)];i&&(r[i.charCodeAt(0)]=!0)}},Wi.prototype.populate=function(e,r,a){var d=this.layers[0],g=d.layout,E=g.get("text-font"),i=g.get("text-field"),t=g.get("icon-image"),o=(i.value.kind!=="constant"||i.value.value instanceof Fi&&!i.value.value.isEmpty()||i.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),l=t.value.kind!=="constant"||!!t.value.value||Object.keys(t.parameters).length>0,p=g.get("symbol-sort-key");if(this.features=[],o||l){for(var m=r.iconDependencies,_=r.glyphDependencies,T=r.availableImages,C=new wt(this.zoom),k=0,R=e;k<R.length;k+=1){var D=R[k],V=D.feature,G=D.id,Z=D.index,ee=D.sourceLayerIndex,ae=d._featureFilter.needGeometry,we=zi(V,ae);if(d._featureFilter.filter(C,we,a)){ae||(we.geometry=xr(V));var ke=void 0;if(o){var Re=d.getValueAndResolveTokens("text-field",we,a,T),Be=Fi.factory(Re);Mu(Be)&&(this.hasRTLText=!0),(!this.hasRTLText||Eo()==="unavailable"||this.hasRTLText&&Vt.isParsed())&&(ke=Xh(Be,d,we))}var $e=void 0;if(l){var Oe=d.getValueAndResolveTokens("icon-image",we,a,T);$e=Oe instanceof yn?Oe:yn.fromString(Oe)}if(ke||$e){var dt=this.sortFeaturesByKey?p.evaluate(we,{},a):void 0;if(this.features.push({id:G,text:ke,icon:$e,index:Z,sourceLayerIndex:ee,geometry:we.geometry,properties:V.properties,type:dd[V.type],sortKey:dt}),$e&&(m[$e.name]=!0),ke){var ht=E.evaluate(we,{},a).join(","),Ye=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Jo.vertical)>=0;for(var ct=0,nt=ke.sections;ct<nt.length;ct+=1){var ft=nt[ct];if(ft.image)m[ft.image.name]=!0;else{var tt=Ns(ke.toString()),at=ft.fontStack||ht,Bt=_[at]=_[at]||{};this.calculateGlyphDependencies(ft.text,Bt,Ye,this.allowVerticalPlacement,tt)}}}}}}g.get("symbol-placement")==="line"&&(this.features=function(Dt){var Qt={},ri={},vi=[],Ci=0;function Ui(ki){vi.push(Dt[ki]),Ci++}function Vi(ki,Ii,qi){var jt=ri[ki];return delete ri[ki],ri[Ii]=jt,vi[jt].geometry[0].pop(),vi[jt].geometry[0]=vi[jt].geometry[0].concat(qi[0]),jt}function Mi(ki,Ii,qi){var jt=Qt[Ii];return delete Qt[Ii],Qt[ki]=jt,vi[jt].geometry[0].shift(),vi[jt].geometry[0]=qi[0].concat(vi[jt].geometry[0]),jt}function Gi(ki,Ii,qi){var jt=qi?Ii[0][Ii[0].length-1]:Ii[0][0];return ki+":"+jt.x+":"+jt.y}for(var Li=0;Li<Dt.length;Li++){var Zi=Dt[Li],si=Zi.geometry,fi=Zi.text?Zi.text.toString():null;if(fi){var xi=Gi(fi,si),hi=Gi(fi,si,!0);if(xi in ri&&hi in Qt&&ri[xi]!==Qt[hi]){var sr=Mi(xi,hi,si),ir=Vi(xi,hi,vi[sr].geometry);delete Qt[xi],delete ri[hi],ri[Gi(fi,vi[ir].geometry,!0)]=ir,vi[sr].geometry=null}else xi in ri?Vi(xi,hi,si):hi in Qt?Mi(xi,hi,si):(Ui(Li),Qt[xi]=Ci-1,ri[hi]=Ci-1)}else Ui(Li)}return vi.filter(function(ki){return ki.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Dt,Qt){return Dt.sortKey-Qt.sortKey})}},Wi.prototype.update=function(e,r,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,a),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,a))},Wi.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Wi.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Wi.prototype.upload=function(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Wi.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Wi.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Wi.prototype.addToLineVertexArray=function(e,r){var a=this.lineVertexArray.length;if(e.segment!==void 0){for(var d=e.dist(r[e.segment+1]),g=e.dist(r[e.segment]),E={},i=e.segment+1;i<r.length;i++)E[i]={x:r[i].x,y:r[i].y,tileUnitDistanceFromAnchor:d},i<r.length-1&&(d+=r[i+1].dist(r[i]));for(var t=e.segment||0;t>=0;t--)E[t]={x:r[t].x,y:r[t].y,tileUnitDistanceFromAnchor:g},t>0&&(g+=r[t-1].dist(r[t]));for(var o=0;o<r.length;o++){var l=E[o];this.lineVertexArray.emplaceBack(l.x,l.y,l.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}},Wi.prototype.addSymbols=function(e,r,a,d,g,E,i,t,o,l,p,m){for(var _=e.indexArray,T=e.layoutVertexArray,C=e.segments.prepareSegment(4*r.length,T,_,this.canOverlap?E.sortKey:void 0),k=this.glyphOffsetArray.length,R=C.vertexLength,D=this.allowVerticalPlacement&&i===Jo.vertical?Math.PI/2:0,V=E.text&&E.text.sections,G=0;G<r.length;G++){var Z=r[G],ee=Z.tl,ae=Z.tr,we=Z.bl,ke=Z.br,Re=Z.tex,Be=Z.pixelOffsetTL,$e=Z.pixelOffsetBR,Oe=Z.minFontScaleX,dt=Z.minFontScaleY,ht=Z.glyphOffset,Ye=Z.isSDF,ct=Z.sectionIndex,nt=C.vertexLength,ft=ht[1];Rc(T,t.x,t.y,ee.x,ft+ee.y,Re.x,Re.y,a,Ye,Be.x,Be.y,Oe,dt),Rc(T,t.x,t.y,ae.x,ft+ae.y,Re.x+Re.w,Re.y,a,Ye,$e.x,Be.y,Oe,dt),Rc(T,t.x,t.y,we.x,ft+we.y,Re.x,Re.y+Re.h,a,Ye,Be.x,$e.y,Oe,dt),Rc(T,t.x,t.y,ke.x,ft+ke.y,Re.x+Re.w,Re.y+Re.h,a,Ye,$e.x,$e.y,Oe,dt),Sh(e.dynamicLayoutVertexArray,t,D),_.emplaceBack(nt,nt+1,nt+2),_.emplaceBack(nt+1,nt+2,nt+3),C.vertexLength+=4,C.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ht[0]),G!==r.length-1&&ct===r[G+1].sectionIndex||e.programConfigurations.populatePaintArrays(T.length,E,E.index,{},m,V&&V[ct])}e.placedSymbolArray.emplaceBack(t.x,t.y,k,this.glyphOffsetArray.length-k,R,o,l,t.segment,a?a[0]:0,a?a[1]:0,d[0],d[1],i,0,!1,0,p)},Wi.prototype._addCollisionDebugVertex=function(e,r,a,d,g,E){return r.emplaceBack(0,0),e.emplaceBack(a.x,a.y,d,g,Math.round(E.x),Math.round(E.y))},Wi.prototype.addCollisionDebugVertices=function(e,r,a,d,g,E,i){var t=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),o=t.vertexLength,l=g.layoutVertexArray,p=g.collisionVertexArray,m=i.anchorX,_=i.anchorY;this._addCollisionDebugVertex(l,p,E,m,_,new Ke(e,r)),this._addCollisionDebugVertex(l,p,E,m,_,new Ke(a,r)),this._addCollisionDebugVertex(l,p,E,m,_,new Ke(a,d)),this._addCollisionDebugVertex(l,p,E,m,_,new Ke(e,d)),t.vertexLength+=4;var T=g.indexArray;T.emplaceBack(o,o+1),T.emplaceBack(o+1,o+2),T.emplaceBack(o+2,o+3),T.emplaceBack(o+3,o),t.primitiveLength+=4},Wi.prototype.addDebugCollisionBoxes=function(e,r,a,d){for(var g=e;g<r;g++){var E=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(E.x1,E.y1,E.x2,E.y2,d?this.textCollisionBox:this.iconCollisionBox,E.anchorPoint,a)}},Wi.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Lu(Fe,Zh.members,qt),this.iconCollisionBox=new Lu(Fe,Zh.members,qt);for(var e=0;e<this.symbolInstances.length;e++){var r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}},Wi.prototype._deserializeCollisionBoxesForSymbol=function(e,r,a,d,g,E,i,t,o){for(var l={},p=r;p<a;p++){var m=e.get(p);l.textBox={x1:m.x1,y1:m.y1,x2:m.x2,y2:m.y2,anchorPointX:m.anchorPointX,anchorPointY:m.anchorPointY},l.textFeatureIndex=m.featureIndex;break}for(var _=d;_<g;_++){var T=e.get(_);l.verticalTextBox={x1:T.x1,y1:T.y1,x2:T.x2,y2:T.y2,anchorPointX:T.anchorPointX,anchorPointY:T.anchorPointY},l.verticalTextFeatureIndex=T.featureIndex;break}for(var C=E;C<i;C++){var k=e.get(C);l.iconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,anchorPointX:k.anchorPointX,anchorPointY:k.anchorPointY},l.iconFeatureIndex=k.featureIndex;break}for(var R=t;R<o;R++){var D=e.get(R);l.verticalIconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},l.verticalIconFeatureIndex=D.featureIndex;break}return l},Wi.prototype.deserializeCollisionBoxes=function(e){this.collisionArrays=[];for(var r=0;r<this.symbolInstances.length;r++){var a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}},Wi.prototype.hasTextData=function(){return this.text.segments.get().length>0},Wi.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Wi.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Wi.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Wi.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Wi.prototype.addIndicesForPlacedSymbol=function(e,r){for(var a=e.placedSymbolArray.get(r),d=a.vertexStartIndex+4*a.numGlyphs,g=a.vertexStartIndex;g<d;g+=4)e.indexArray.emplaceBack(g,g+1,g+2),e.indexArray.emplaceBack(g+1,g+2,g+3)},Wi.prototype.getSortedSymbolIndexes=function(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var r=Math.sin(e),a=Math.cos(e),d=[],g=[],E=[],i=0;i<this.symbolInstances.length;++i){E.push(i);var t=this.symbolInstances.get(i);d.push(0|Math.round(r*t.anchorX+a*t.anchorY)),g.push(t.featureIndex)}return E.sort(function(o,l){return d[o]-d[l]||g[l]-g[o]}),E},Wi.prototype.addToSortKeyRanges=function(e,r){var a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})},Wi.prototype.sortFeatures=function(e){var r=this;if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var a=0,d=this.symbolInstanceIndexes;a<d.length;a+=1){var g=this.symbolInstances.get(d[a]);this.featureSortOrder.push(g.featureIndex),[g.rightJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.leftJustifiedTextSymbolIndex].forEach(function(E,i,t){E>=0&&t.indexOf(E)===i&&r.addIndicesForPlacedSymbol(r.text,E)}),g.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,g.verticalPlacedTextSymbolIndex),g.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.placedIconSymbolIndex),g.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,g.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Ut("SymbolBucket",Wi,{omit:["layers","collisionBoxArray","features","compareText"]}),Wi.MAX_GLYPHS=65535,Wi.addDynamicAttributes=Sh;var md=new b({"symbol-placement":new At(ce.layout_symbol["symbol-placement"]),"symbol-spacing":new At(ce.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new At(ce.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Tt(ce.layout_symbol["symbol-sort-key"]),"symbol-z-order":new At(ce.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new At(ce.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new At(ce.layout_symbol["icon-ignore-placement"]),"icon-optional":new At(ce.layout_symbol["icon-optional"]),"icon-rotation-alignment":new At(ce.layout_symbol["icon-rotation-alignment"]),"icon-size":new Tt(ce.layout_symbol["icon-size"]),"icon-text-fit":new At(ce.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new At(ce.layout_symbol["icon-text-fit-padding"]),"icon-image":new Tt(ce.layout_symbol["icon-image"]),"icon-rotate":new Tt(ce.layout_symbol["icon-rotate"]),"icon-padding":new At(ce.layout_symbol["icon-padding"]),"icon-keep-upright":new At(ce.layout_symbol["icon-keep-upright"]),"icon-offset":new Tt(ce.layout_symbol["icon-offset"]),"icon-anchor":new Tt(ce.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new At(ce.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new At(ce.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new At(ce.layout_symbol["text-rotation-alignment"]),"text-field":new Tt(ce.layout_symbol["text-field"]),"text-font":new Tt(ce.layout_symbol["text-font"]),"text-size":new Tt(ce.layout_symbol["text-size"]),"text-max-width":new Tt(ce.layout_symbol["text-max-width"]),"text-line-height":new At(ce.layout_symbol["text-line-height"]),"text-letter-spacing":new Tt(ce.layout_symbol["text-letter-spacing"]),"text-justify":new Tt(ce.layout_symbol["text-justify"]),"text-radial-offset":new Tt(ce.layout_symbol["text-radial-offset"]),"text-variable-anchor":new At(ce.layout_symbol["text-variable-anchor"]),"text-anchor":new Tt(ce.layout_symbol["text-anchor"]),"text-max-angle":new At(ce.layout_symbol["text-max-angle"]),"text-writing-mode":new At(ce.layout_symbol["text-writing-mode"]),"text-rotate":new Tt(ce.layout_symbol["text-rotate"]),"text-padding":new At(ce.layout_symbol["text-padding"]),"text-keep-upright":new At(ce.layout_symbol["text-keep-upright"]),"text-transform":new Tt(ce.layout_symbol["text-transform"]),"text-offset":new Tt(ce.layout_symbol["text-offset"]),"text-allow-overlap":new At(ce.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new At(ce.layout_symbol["text-ignore-placement"]),"text-optional":new At(ce.layout_symbol["text-optional"])}),bs={paint:new b({"icon-opacity":new Tt(ce.paint_symbol["icon-opacity"]),"icon-color":new Tt(ce.paint_symbol["icon-color"]),"icon-halo-color":new Tt(ce.paint_symbol["icon-halo-color"]),"icon-halo-width":new Tt(ce.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Tt(ce.paint_symbol["icon-halo-blur"]),"icon-translate":new At(ce.paint_symbol["icon-translate"]),"icon-translate-anchor":new At(ce.paint_symbol["icon-translate-anchor"]),"text-opacity":new Tt(ce.paint_symbol["text-opacity"]),"text-color":new Tt(ce.paint_symbol["text-color"],{runtimeType:ve,getOverride:function(e){return e.textColor},hasOverride:function(e){return!!e.textColor}}),"text-halo-color":new Tt(ce.paint_symbol["text-halo-color"]),"text-halo-width":new Tt(ce.paint_symbol["text-halo-width"]),"text-halo-blur":new Tt(ce.paint_symbol["text-halo-blur"]),"text-translate":new At(ce.paint_symbol["text-translate"]),"text-translate-anchor":new At(ce.paint_symbol["text-translate-anchor"])}),layout:md},ru=function(e){this.type=e.property.overrides?e.property.overrides.runtimeType:de,this.defaultValue=e};ru.prototype.evaluate=function(e){if(e.formattedSection){var r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default},ru.prototype.eachChild=function(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)},ru.prototype.outputDefined=function(){return!1},ru.prototype.serialize=function(){return null},Ut("FormatSectionOverride",ru,{omit:["defaultValue"]});var op=function(e){function r(a){e.call(this,a,bs)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.recalculate=function(a,d){if(e.prototype.recalculate.call(this,a,d),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var g=this.layout.get("text-writing-mode");if(g){for(var E=[],i=0,t=g;i<t.length;i+=1){var o=t[i];E.indexOf(o)<0&&E.push(o)}this.layout._values["text-writing-mode"]=E}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},r.prototype.getValueAndResolveTokens=function(a,d,g,E){var i=this.layout.get(a).evaluate(d,{},g,E),t=this._unevaluatedLayout._values[a];return t.isDataDriven()||Za(t.value)||!i?i:function(o,l){return l.replace(/{([^{}]+)}/g,function(p,m){return m in o?String(o[m]):""})}(d.properties,i)},r.prototype.createBucket=function(a){return new Wi(a)},r.prototype.queryRadius=function(){return 0},r.prototype.queryIntersectsFeature=function(){return!1},r.prototype._setPaintOverrides=function(){for(var a=0,d=bs.paint.overridableProperties;a<d.length;a+=1){var g=d[a];if(r.hasPaintOverride(this.layout,g)){var E,i=this.paint.get(g),t=new ru(i),o=new la(t,i.property.specification);E=i.value.kind==="constant"||i.value.kind==="source"?new za("source",o):new ua("composite",o,i.value.zoomStops,i.value._interpolationType),this.paint._values[g]=new Cn(i.property,E,i.parameters)}}},r.prototype._handleOverridablePaintPropertyUpdate=function(a,d,g){return!(!this.layout||d.isDataDriven()||g.isDataDriven())&&r.hasPaintOverride(this.layout,a)},r.hasPaintOverride=function(a,d){var g=a.get("text-field"),E=bs.paint.properties[d],i=!1,t=function(p){for(var m=0,_=p;m<_.length;m+=1)if(E.overrides&&E.overrides.hasOverride(_[m]))return void(i=!0)};if(g.value.kind==="constant"&&g.value.value instanceof Fi)t(g.value.value.sections);else if(g.value.kind==="source"){var o=function(p){i||(p instanceof En&&wr(p.value)===bt?t(p.value.sections):p instanceof ho?t(p.sections):p.eachChild(o))},l=g.value;l._styleExpression&&o(l._styleExpression.expression)}return i},r}(n),yd={paint:new b({"background-color":new At(ce.paint_background["background-color"]),"background-pattern":new Or(ce.paint_background["background-pattern"]),"background-opacity":new At(ce.paint_background["background-opacity"])})},gd=function(e){function r(a){e.call(this,a,yd)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r}(n),_d={paint:new b({"raster-opacity":new At(ce.paint_raster["raster-opacity"]),"raster-hue-rotate":new At(ce.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new At(ce.paint_raster["raster-brightness-min"]),"raster-brightness-max":new At(ce.paint_raster["raster-brightness-max"]),"raster-saturation":new At(ce.paint_raster["raster-saturation"]),"raster-contrast":new At(ce.paint_raster["raster-contrast"]),"raster-resampling":new At(ce.paint_raster["raster-resampling"]),"raster-fade-duration":new At(ce.paint_raster["raster-fade-duration"])})},Bc=function(e){function r(a){e.call(this,a,_d)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r}(n),Th=function(e){function r(a){e.call(this,a,{}),this.implementation=a}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},r.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},r.prototype.recalculate=function(){},r.prototype.updateTransitions=function(){},r.prototype.hasTransition=function(){},r.prototype.serialize=function(){},r.prototype.onAdd=function(a){this.implementation.onAdd&&this.implementation.onAdd(a,a.painter.context.gl)},r.prototype.onRemove=function(a){this.implementation.onRemove&&this.implementation.onRemove(a,a.painter.context.gl)},r}(n),vd={circle:bc,heatmap:Zu,hillshade:Fh,fill:uh,"fill-extrusion":Yp,line:rd,symbol:op,background:gd,raster:Bc},Oc=Se.HTMLImageElement,Fc=Se.HTMLCanvasElement,nu=Se.HTMLVideoElement,ap=Se.ImageData,Du=Se.ImageBitmap,Tl=function(e,r,a,d){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(r,d)};Tl.prototype.update=function(e,r,a){var d=e.width,g=e.height,E=!(this.size&&this.size[0]===d&&this.size[1]===g||a),i=this.context,t=i.gl;if(this.useMipmap=Boolean(r&&r.useMipmap),t.bindTexture(t.TEXTURE_2D,this.texture),i.pixelStoreUnpackFlipY.set(!1),i.pixelStoreUnpack.set(1),i.pixelStoreUnpackPremultiplyAlpha.set(this.format===t.RGBA&&(!r||r.premultiply!==!1)),E)this.size=[d,g],e instanceof Oc||e instanceof Fc||e instanceof nu||e instanceof ap||Du&&e instanceof Du?t.texImage2D(t.TEXTURE_2D,0,this.format,this.format,t.UNSIGNED_BYTE,e):t.texImage2D(t.TEXTURE_2D,0,this.format,d,g,0,this.format,t.UNSIGNED_BYTE,e.data);else{var o=a||{x:0,y:0},l=o.x,p=o.y;e instanceof Oc||e instanceof Fc||e instanceof nu||e instanceof ap||Du&&e instanceof Du?t.texSubImage2D(t.TEXTURE_2D,0,l,p,t.RGBA,t.UNSIGNED_BYTE,e):t.texSubImage2D(t.TEXTURE_2D,0,l,p,d,g,t.RGBA,t.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&t.generateMipmap(t.TEXTURE_2D)},Tl.prototype.bind=function(e,r,a){var d=this.context.gl;d.bindTexture(d.TEXTURE_2D,this.texture),a!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(a=d.LINEAR),e!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,a||e),this.filter=e),r!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,r),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,r),this.wrap=r)},Tl.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Tl.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Ru=function(e){var r=this;this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){r._triggered=!1,r._callback()})};Ru.prototype.trigger=function(){var e=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){e._triggered=!1,e._callback()},0))},Ru.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Il=function(e,r,a){this.target=e,this.parent=r,this.mapId=a,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Ni(["receive","process"],this),this.invoker=new Ru(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Yt()?e:Se};function sp(e,r,a){var d=2*Math.PI*6378137/256/Math.pow(2,a);return[e*d-2*Math.PI*6378137/2,r*d-2*Math.PI*6378137/2]}Il.prototype.send=function(e,r,a,d,g){var E=this;g===void 0&&(g=!1);var i=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(this.callbacks[i]=a);var t=Co(this.globalScope)?void 0:[];return this.target.postMessage({id:i,type:e,hasCallback:!!a,targetMapId:d,mustQueue:g,sourceMapId:this.mapId,data:yo(r,t)},t),{cancel:function(){a&&delete E.callbacks[i],E.target.postMessage({id:i,type:"<cancel>",targetMapId:d,sourceMapId:E.mapId})}}},Il.prototype.receive=function(e){var r=e.data,a=r.id;if(a&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){delete this.tasks[a];var d=this.cancelCallbacks[a];delete this.cancelCallbacks[a],d&&d()}else Yt()||r.mustQueue?(this.tasks[a]=r,this.taskQueue.push(a),this.invoker.trigger()):this.processTask(a,r)},Il.prototype.process=function(){if(this.taskQueue.length){var e=this.taskQueue.shift(),r=this.tasks[e];delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),r&&this.processTask(e,r)}},Il.prototype.processTask=function(e,r){var a=this;if(r.type==="<response>"){var d=this.callbacks[e];delete this.callbacks[e],d&&(r.error?d(cr(r.error)):d(null,cr(r.data)))}else{var g=!1,E=Co(this.globalScope)?void 0:[],i=r.hasCallback?function(p,m){g=!0,delete a.cancelCallbacks[e],a.target.postMessage({id:e,type:"<response>",sourceMapId:a.mapId,error:p?yo(p):null,data:yo(m,E)},E)}:function(p){g=!0},t=null,o=cr(r.data);if(this.parent[r.type])t=this.parent[r.type](r.sourceMapId,o,i);else if(this.parent.getWorkerSource){var l=r.type.split(".");t=this.parent.getWorkerSource(r.sourceMapId,l[0],o.source)[l[1]](o,i)}else i(new Error("Could not find function "+r.type));!g&&t&&t.cancel&&(this.cancelCallbacks[e]=t.cancel)}},Il.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Yr=function(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))};Yr.prototype.setNorthEast=function(e){return this._ne=e instanceof gr?new gr(e.lng,e.lat):gr.convert(e),this},Yr.prototype.setSouthWest=function(e){return this._sw=e instanceof gr?new gr(e.lng,e.lat):gr.convert(e),this},Yr.prototype.extend=function(e){var r,a,d=this._sw,g=this._ne;if(e instanceof gr)r=e,a=e;else{if(!(e instanceof Yr))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Yr.convert(e)):this.extend(gr.convert(e)):this;if(a=e._ne,!(r=e._sw)||!a)return this}return d||g?(d.lng=Math.min(r.lng,d.lng),d.lat=Math.min(r.lat,d.lat),g.lng=Math.max(a.lng,g.lng),g.lat=Math.max(a.lat,g.lat)):(this._sw=new gr(r.lng,r.lat),this._ne=new gr(a.lng,a.lat)),this},Yr.prototype.getCenter=function(){return new gr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Yr.prototype.getSouthWest=function(){return this._sw},Yr.prototype.getNorthEast=function(){return this._ne},Yr.prototype.getNorthWest=function(){return new gr(this.getWest(),this.getNorth())},Yr.prototype.getSouthEast=function(){return new gr(this.getEast(),this.getSouth())},Yr.prototype.getWest=function(){return this._sw.lng},Yr.prototype.getSouth=function(){return this._sw.lat},Yr.prototype.getEast=function(){return this._ne.lng},Yr.prototype.getNorth=function(){return this._ne.lat},Yr.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Yr.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Yr.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Yr.prototype.contains=function(e){var r=gr.convert(e),a=r.lng,d=r.lat,g=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&g},Yr.convert=function(e){return!e||e instanceof Yr?e:new Yr(e)};var gr=function(e,r){if(isNaN(e)||isNaN(r))throw new Error("Invalid LngLat object: ("+e+", "+r+")");if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};gr.prototype.wrap=function(){return new gr(Ei(this.lng,-180,180),this.lat)},gr.prototype.toArray=function(){return[this.lng,this.lat]},gr.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},gr.prototype.distanceTo=function(e){var r=Math.PI/180,a=this.lat*r,d=e.lat*r,g=Math.sin(a)*Math.sin(d)+Math.cos(a)*Math.cos(d)*Math.cos((e.lng-this.lng)*r);return 63710088e-1*Math.acos(Math.min(g,1))},gr.prototype.toBounds=function(e){e===void 0&&(e=0);var r=360*e/40075017,a=r/Math.cos(Math.PI/180*this.lat);return new Yr(new gr(this.lng-a,this.lat-r),new gr(this.lng+a,this.lat+r))},gr.convert=function(e){if(e instanceof gr)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new gr(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new gr(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var lp=2*Math.PI*63710088e-1;function up(e){return lp*Math.cos(e*Math.PI/180)}function Ih(e){return(180+e)/360}function Ur(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Al(e,r){return e/up(r)}function Uc(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}var Cl=function(e,r,a){a===void 0&&(a=0),this.x=+e,this.y=+r,this.z=+a};Cl.fromLngLat=function(e,r){r===void 0&&(r=0);var a=gr.convert(e);return new Cl(Ih(a.lng),Ur(a.lat),Al(r,a.lat))},Cl.prototype.toLngLat=function(){return new gr(360*this.x-180,Uc(this.y))},Cl.prototype.toAltitude=function(){return this.z*up(Uc(this.y))},Cl.prototype.meterInMercatorCoordinateUnits=function(){return 1/lp*(e=Uc(this.y),1/Math.cos(e*Math.PI/180));var e};var zl=function(e,r,a){this.z=e,this.x=r,this.y=a,this.key=ou(0,e,e,r,a)};zl.prototype.equals=function(e){return this.z===e.z&&this.x===e.x&&this.y===e.y},zl.prototype.url=function(e,r){var a,d,g,E,i,t=(d=this.y,g=this.z,E=sp(256*(a=this.x),256*(d=Math.pow(2,g)-d-1),g),i=sp(256*(a+1),256*(d+1),g),E[0]+","+E[1]+","+i[0]+","+i[1]),o=function(l,p,m){for(var _,T="",C=l;C>0;C--)T+=(p&(_=1<<C-1)?1:0)+(m&_?2:0);return T}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",o).replace("{bbox-epsg-3857}",t)},zl.prototype.getTilePoint=function(e){var r=Math.pow(2,this.z);return new Ke(8192*(e.x*r-this.x),8192*(e.y*r-this.y))},zl.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Ah=function(e,r){this.wrap=e,this.canonical=r,this.key=ou(e,r.z,r.z,r.x,r.y)},jr=function(e,r,a,d,g){this.overscaledZ=e,this.wrap=r,this.canonical=new zl(a,+d,+g),this.key=ou(r,e,a,d,g)};function ou(e,r,a,d,g){(e*=2)<0&&(e=-1*e-1);var E=1<<a;return(E*E*e+E*g+d).toString(36)+a.toString(36)+r.toString(36)}jr.prototype.equals=function(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)},jr.prototype.scaledTo=function(e){var r=this.canonical.z-e;return e>this.canonical.z?new jr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new jr(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)},jr.prototype.calculateScaledKey=function(e,r){var a=this.canonical.z-e;return e>this.canonical.z?ou(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):ou(this.wrap*+r,e,e,this.canonical.x>>a,this.canonical.y>>a)},jr.prototype.isChildOf=function(e){if(e.wrap!==this.wrap)return!1;var r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r},jr.prototype.children=function(e){if(this.overscaledZ>=e)return[new jr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var r=this.canonical.z+1,a=2*this.canonical.x,d=2*this.canonical.y;return[new jr(r,this.wrap,r,a,d),new jr(r,this.wrap,r,a+1,d),new jr(r,this.wrap,r,a,d+1),new jr(r,this.wrap,r,a+1,d+1)]},jr.prototype.isLessThan=function(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))},jr.prototype.wrapped=function(){return new jr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},jr.prototype.unwrapTo=function(e){return new jr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)},jr.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},jr.prototype.toUnwrapped=function(){return new Ah(this.wrap,this.canonical)},jr.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},jr.prototype.getTilePoint=function(e){return this.canonical.getTilePoint(new Cl(e.x-this.wrap,e.y))},Ut("CanonicalTileID",zl),Ut("OverscaledTileID",jr,{omit:["posMatrix"]});var Da=function(e,r,a){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return nr('"'+a+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=r.height;var d=this.dim=r.height-2;this.data=new Uint32Array(r.data.buffer),this.encoding=a||"mapbox";for(var g=0;g<d;g++)this.data[this._idx(-1,g)]=this.data[this._idx(0,g)],this.data[this._idx(d,g)]=this.data[this._idx(d-1,g)],this.data[this._idx(g,-1)]=this.data[this._idx(g,0)],this.data[this._idx(g,d)]=this.data[this._idx(g,d-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(d,-1)]=this.data[this._idx(d-1,0)],this.data[this._idx(-1,d)]=this.data[this._idx(0,d-1)],this.data[this._idx(d,d)]=this.data[this._idx(d-1,d-1)]};Da.prototype.get=function(e,r){var a=new Uint8Array(this.data.buffer),d=4*this._idx(e,r);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(a[d],a[d+1],a[d+2])},Da.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Da.prototype._idx=function(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)},Da.prototype._unpackMapbox=function(e,r,a){return(256*e*256+256*r+a)/10-1e4},Da.prototype._unpackTerrarium=function(e,r,a){return 256*e+r+a/256-32768},Da.prototype.getPixels=function(){return new Qn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Da.prototype.backfillBorder=function(e,r,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");var d=r*this.dim,g=r*this.dim+this.dim,E=a*this.dim,i=a*this.dim+this.dim;switch(r){case-1:d=g-1;break;case 1:g=d+1}switch(a){case-1:E=i-1;break;case 1:i=E+1}for(var t=-r*this.dim,o=-a*this.dim,l=E;l<i;l++)for(var p=d;p<g;p++)this.data[this._idx(p,l)]=e.data[this._idx(p+t,l+o)]},Ut("DEMData",Da);var cc=function(e){this._stringToNumber={},this._numberToString=[];for(var r=0;r<e.length;r++){var a=e[r];this._stringToNumber[a]=r,this._numberToString[r]=a}};cc.prototype.encode=function(e){return this._stringToNumber[e]},cc.prototype.decode=function(e){return this._numberToString[e]};var Bu=function(e,r,a,d,g){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=a,e._y=d,this.properties=e.properties,this.id=g},Vc={geometry:{configurable:!0}};Vc.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Vc.geometry.set=function(e){this._geometry=e},Bu.prototype.toJSON=function(){var e={geometry:this.geometry};for(var r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e},Object.defineProperties(Bu.prototype,Vc);var _o=function(){this.state={},this.stateChanges={},this.deletedStates={}};_o.prototype.updateState=function(e,r,a){var d=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][d]=this.stateChanges[e][d]||{},mi(this.stateChanges[e][d],a),this.deletedStates[e]===null)for(var g in this.deletedStates[e]={},this.state[e])g!==d&&(this.deletedStates[e][g]=null);else if(this.deletedStates[e]&&this.deletedStates[e][d]===null)for(var E in this.deletedStates[e][d]={},this.state[e][d])a[E]||(this.deletedStates[e][d][E]=null);else for(var i in a)this.deletedStates[e]&&this.deletedStates[e][d]&&this.deletedStates[e][d][i]===null&&delete this.deletedStates[e][d][i]},_o.prototype.removeFeatureState=function(e,r,a){if(this.deletedStates[e]!==null){var d=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&r!==void 0)this.deletedStates[e][d]!==null&&(this.deletedStates[e][d]=this.deletedStates[e][d]||{},this.deletedStates[e][d][a]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][d])for(a in this.deletedStates[e][d]={},this.stateChanges[e][d])this.deletedStates[e][d][a]=null;else this.deletedStates[e][d]=null;else this.deletedStates[e]=null}},_o.prototype.getState=function(e,r){var a=String(r),d=mi({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){var g=this.deletedStates[e][r];if(g===null)return{};for(var E in g)delete d[E]}return d},_o.prototype.initializeTileState=function(e,r){e.setFeatureState(this.state,r)},_o.prototype.coalesceChanges=function(e,r){var a={};for(var d in this.stateChanges){this.state[d]=this.state[d]||{};var g={};for(var E in this.stateChanges[d])this.state[d][E]||(this.state[d][E]={}),mi(this.state[d][E],this.stateChanges[d][E]),g[E]=this.state[d][E];a[d]=g}for(var i in this.deletedStates){this.state[i]=this.state[i]||{};var t={};if(this.deletedStates[i]===null)for(var o in this.state[i])t[o]={},this.state[i][o]={};else for(var l in this.deletedStates[i]){if(this.deletedStates[i][l]===null)this.state[i][l]={};else for(var p=0,m=Object.keys(this.deletedStates[i][l]);p<m.length;p+=1)delete this.state[i][l][m[p]];t[l]=this.state[i][l]}a[i]=a[i]||{},mi(a[i],t)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(var _ in e)e[_].setFeatureState(a,r)};var va=function(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new da(8192,16,0),this.grid3D=new da(8192,16,0),this.featureIndexArray=new W,this.promoteId=r};function Ch(e,r,a,d,g){return lr(e,function(E,i){var t=r instanceof ma?r.get(i):null;return t&&t.evaluate?t.evaluate(a,d,g):t})}function zh(e){for(var r=1/0,a=1/0,d=-1/0,g=-1/0,E=0,i=e;E<i.length;E+=1){var t=i[E];r=Math.min(r,t.x),a=Math.min(a,t.y),d=Math.max(d,t.x),g=Math.max(g,t.y)}return{minX:r,minY:a,maxX:d,maxY:g}}function cp(e,r){return r-e}va.prototype.insert=function(e,r,a,d,g,E){var i=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,d,g);for(var t=E?this.grid3D:this.grid,o=0;o<r.length;o++){for(var l=r[o],p=[1/0,1/0,-1/0,-1/0],m=0;m<l.length;m++){var _=l[m];p[0]=Math.min(p[0],_.x),p[1]=Math.min(p[1],_.y),p[2]=Math.max(p[2],_.x),p[3]=Math.max(p[3],_.y)}p[0]<8192&&p[1]<8192&&p[2]>=0&&p[3]>=0&&t.insert(i,p[0],p[1],p[2],p[3])}},va.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Tu.VectorTile(new Ac(this.rawTileData)).layers,this.sourceLayerCoder=new cc(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},va.prototype.query=function(e,r,a,d){var g=this;this.loadVTLayers();for(var E=e.params||{},i=8192/e.tileSize/e.scale,t=Us(E.filter),o=e.queryGeometry,l=e.queryPadding*i,p=zh(o),m=this.grid.query(p.minX-l,p.minY-l,p.maxX+l,p.maxY+l),_=zh(e.cameraQueryGeometry),T=this.grid3D.query(_.minX-l,_.minY-l,_.maxX+l,_.maxY+l,function(Z,ee,ae,we){return function(ke,Re,Be,$e,Oe){for(var dt=0,ht=ke;dt<ht.length;dt+=1){var Ye=ht[dt];if(Re<=Ye.x&&Be<=Ye.y&&$e>=Ye.x&&Oe>=Ye.y)return!0}var ct=[new Ke(Re,Be),new Ke(Re,Oe),new Ke($e,Oe),new Ke($e,Be)];if(ke.length>2){for(var nt=0,ft=ct;nt<ft.length;nt+=1)if(Ma(ke,ft[nt]))return!0}for(var tt=0;tt<ke.length-1;tt++)if(Zs(ke[tt],ke[tt+1],ct))return!0;return!1}(e.cameraQueryGeometry,Z-l,ee-l,ae+l,we+l)}),C=0,k=T;C<k.length;C+=1)m.push(k[C]);m.sort(cp);for(var R,D={},V=function(Z){var ee=m[Z];if(ee!==R){R=ee;var ae=g.featureIndexArray.get(ee),we=null;g.loadMatchingFeature(D,ae.bucketIndex,ae.sourceLayerIndex,ae.featureIndex,t,E.layers,E.availableImages,r,a,d,function(ke,Re,Be){return we||(we=xr(ke)),Re.queryIntersectsFeature(o,ke,Be,we,g.z,e.transform,i,e.pixelPosMatrix)})}},G=0;G<m.length;G++)V(G);return D},va.prototype.loadMatchingFeature=function(e,r,a,d,g,E,i,t,o,l,p){var m=this.bucketLayerIDs[r];if(!E||function(ke,Re){for(var Be=0;Be<ke.length;Be++)if(Re.indexOf(ke[Be])>=0)return!0;return!1}(E,m)){var _=this.sourceLayerCoder.decode(a),T=this.vtLayers[_].feature(d);if(g.needGeometry){var C=zi(T,!0);if(!g.filter(new wt(this.tileID.overscaledZ),C,this.tileID.canonical))return}else if(!g.filter(new wt(this.tileID.overscaledZ),T))return;for(var k=this.getId(T,_),R=0;R<m.length;R++){var D=m[R];if(!(E&&E.indexOf(D)<0)){var V=t[D];if(V){var G={};k!==void 0&&l&&(G=l.getState(V.sourceLayer||"_geojsonTileLayer",k));var Z=mi({},o[D]);Z.paint=Ch(Z.paint,V.paint,T,G,i),Z.layout=Ch(Z.layout,V.layout,T,G,i);var ee=!p||p(T,V,G);if(ee){var ae=new Bu(T,this.z,this.x,this.y,k);ae.layer=Z;var we=e[D];we===void 0&&(we=e[D]=[]),we.push({featureIndex:d,feature:ae,intersectionZ:ee})}}}}}},va.prototype.lookupSymbolFeatures=function(e,r,a,d,g,E,i,t){var o={};this.loadVTLayers();for(var l=Us(g),p=0,m=e;p<m.length;p+=1)this.loadMatchingFeature(o,a,d,m[p],l,E,i,t,r);return o},va.prototype.hasLayer=function(e){for(var r=0,a=this.bucketLayerIDs;r<a.length;r+=1)for(var d=0,g=a[r];d<g.length;d+=1)if(e===g[d])return!0;return!1},va.prototype.getId=function(e,r){var a=e.id;return this.promoteId&&typeof(a=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]])=="boolean"&&(a=Number(a)),a},Ut("FeatureIndex",va,{omit:["rawTileData","sourceLayerCoder"]});var un=function(e,r){this.tileID=e,this.uid=br(),this.uses=0,this.tileSize=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};un.prototype.registerFadeDuration=function(e){var r=e+this.timeAdded;r<dn.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)},un.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},un.prototype.loadVectorData=function(e,r,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){for(var d in e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(l,p){var m={};if(!p)return m;for(var _=function(){var k=C[T],R=k.layerIds.map(function(G){return p.getLayer(G)}).filter(Boolean);if(R.length!==0){k.layers=R,k.stateDependentLayerIds&&(k.stateDependentLayers=k.stateDependentLayerIds.map(function(G){return R.filter(function(Z){return Z.id===G})[0]}));for(var D=0,V=R;D<V.length;D+=1)m[V[D].id]=k}},T=0,C=l;T<C.length;T+=1)_();return m}(e.buckets,r.style),this.hasSymbolBuckets=!1,this.buckets){var g=this.buckets[d];if(g instanceof Wi){if(this.hasSymbolBuckets=!0,!a)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var E in this.buckets){var i=this.buckets[E];if(i instanceof Wi&&i.hasRTLText){this.hasRTLText=!0,Vt.isLoading()||Vt.isLoaded()||Eo()!=="deferred"||Wn();break}}for(var t in this.queryPadding=0,this.buckets){var o=this.buckets[t];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(t).queryRadius(o))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new c},un.prototype.unloadVectorData=function(){for(var e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},un.prototype.getBucket=function(e){return this.buckets[e.id]},un.prototype.upload=function(e){for(var r in this.buckets){var a=this.buckets[r];a.uploadPending()&&a.upload(e)}var d=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Tl(e,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Tl(e,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)},un.prototype.prepare=function(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)},un.prototype.queryRenderedFeatures=function(e,r,a,d,g,E,i,t,o,l){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:g,scale:E,tileSize:this.tileSize,pixelPosMatrix:l,transform:t,params:i,queryPadding:this.queryPadding*o},e,r,a):{}},un.prototype.querySourceFeatures=function(e,r){var a=this.latestFeatureIndex;if(a&&a.rawTileData){var d=a.loadVTLayers(),g=r?r.sourceLayer:"",E=d._geojsonTileLayer||d[g];if(E)for(var i=Us(r&&r.filter),t=this.tileID.canonical,o=t.z,l=t.x,p=t.y,m={z:o,x:l,y:p},_=0;_<E.length;_++){var T=E.feature(_);if(i.needGeometry){var C=zi(T,!0);if(!i.filter(new wt(this.tileID.overscaledZ),C,this.tileID.canonical))continue}else if(!i.filter(new wt(this.tileID.overscaledZ),T))continue;var k=a.getId(T,g),R=new Bu(T,o,l,p,k);R.tile=m,e.push(R)}}},un.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},un.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},un.prototype.setExpiryData=function(e){var r=this.expirationTime;if(e.cacheControl){var a=Un(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){var d=Date.now(),g=!1;if(this.expirationTime>d)g=!1;else if(r)if(this.expirationTime<r)g=!0;else{var E=this.expirationTime-r;E?this.expirationTime=d+Math.max(E,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},un.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},un.prototype.setFeatureState=function(e,r){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0){var a=this.latestFeatureIndex.loadVTLayers();for(var d in this.buckets)if(r.style.hasLayer(d)){var g=this.buckets[d],E=g.layers[0].sourceLayer||"_geojsonTileLayer",i=a[E],t=e[E];if(i&&t&&Object.keys(t).length!==0){g.update(t,i,this.imageAtlas&&this.imageAtlas.patternPositions||{});var o=r&&r.style&&r.style.getLayer(d);o&&(this.queryPadding=Math.max(this.queryPadding,o.queryRadius(g)))}}}},un.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},un.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<dn.now()},un.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},un.prototype.setHoldDuration=function(e){this.symbolFadeHoldUntil=dn.now()+e},un.prototype.setDependencies=function(e,r){for(var a={},d=0,g=r;d<g.length;d+=1)a[g[d]]=!0;this.dependencies[e]=a},un.prototype.hasDependency=function(e,r){for(var a=0,d=e;a<d.length;a+=1){var g=this.dependencies[d[a]];if(g){for(var E=0,i=r;E<i.length;E+=1)if(g[i[E]])return!0}}return!1};var el=Se.performance,Ph=function(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},el.mark(this._marks.start)};Ph.prototype.finish=function(){el.mark(this._marks.end);var e=el.getEntriesByName(this._marks.measure);return e.length===0&&(el.measure(this._marks.measure,this._marks.start,this._marks.end),e=el.getEntriesByName(this._marks.measure),el.clearMarks(this._marks.start),el.clearMarks(this._marks.end),el.clearMeasures(this._marks.measure)),e},y.Actor=Il,y.AlphaImage=Hl,y.CanonicalTileID=zl,y.CollisionBoxArray=c,y.Color=oi,y.DEMData=Da,y.DataConstantProperty=At,y.DictionaryCoder=cc,y.EXTENT=8192,y.ErrorEvent=Me,y.EvaluationParameters=wt,y.Event=xe,y.Evented=De,y.FeatureIndex=va,y.FillBucket=ts,y.FillExtrusionBucket=is,y.ImageAtlas=ec,y.ImagePosition=Cc,y.LineBucket=eo,y.LngLat=gr,y.LngLatBounds=Yr,y.MercatorCoordinate=Cl,y.ONE_EM=24,y.OverscaledTileID=jr,y.Point=Ke,y.Point$1=Ke,y.Properties=b,y.Protobuf=Ac,y.RGBAImage=Qn,y.RequestManager=Gr,y.RequestPerformance=Ph,y.ResourceType=Ti,y.SegmentVector=se,y.SourceFeatureState=_o,y.StructArrayLayout1ui2=Rt,y.StructArrayLayout2f1f2i16=Xe,y.StructArrayLayout2i4=O,y.StructArrayLayout3ui6=st,y.StructArrayLayout4i8=N,y.SymbolBucket=Wi,y.Texture=Tl,y.Tile=un,y.Transitionable=Nr,y.Uniform1f=_t,y.Uniform1i=ut,y.Uniform2f=gt,y.Uniform3f=Mt,y.Uniform4f=Zt,y.UniformColor=Wt,y.UniformMatrix4f=Ai,y.UnwrappedTileID=Ah,y.ValidationError=Ie,y.WritingMode=Jo,y.ZoomHistory=Ko,y.add=function(e,r,a){return e[0]=r[0]+a[0],e[1]=r[1]+a[1],e[2]=r[2]+a[2],e},y.addDynamicAttributes=Sh,y.asyncAll=function(e,r,a){if(!e.length)return a(null,[]);var d=e.length,g=new Array(e.length),E=null;e.forEach(function(i,t){r(i,function(o,l){o&&(E=o),g[t]=l,--d==0&&a(E,g)})})},y.bezier=yt,y.bindAll=Ni,y.browser=dn,y.cacheEntryPossiblyAdded=function(e){++er>Ki&&(e.getActor().send("enforceCacheSizeLimit",Zn),er=0)},y.clamp=zt,y.clearTileCache=function(e){var r=Se.caches.delete("mapbox-tiles");e&&r.catch(e).then(function(){return e()})},y.clipLine=Eh,y.clone=function(e){var r=new Ri(16);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},y.clone$1=hn,y.clone$2=function(e){var r=new Ri(3);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r},y.collisionCircleLayout=$h,y.config=Bi,y.create=function(){var e=new Ri(16);return Ri!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},y.create$1=function(){var e=new Ri(9);return Ri!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},y.create$2=function(){var e=new Ri(4);return Ri!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},y.createCommonjsModule=x,y.createExpression=Bs,y.createLayout=I,y.createStyleLayer=function(e){return e.type==="custom"?new Th(e):new vd[e.type](e)},y.cross=function(e,r,a){var d=r[0],g=r[1],E=r[2],i=a[0],t=a[1],o=a[2];return e[0]=g*o-E*t,e[1]=E*i-d*o,e[2]=d*t-g*i,e},y.deepEqual=function e(r,a){if(Array.isArray(r)){if(!Array.isArray(a)||r.length!==a.length)return!1;for(var d=0;d<r.length;d++)if(!e(r[d],a[d]))return!1;return!0}if(typeof r=="object"&&r!==null&&a!==null){if(typeof a!="object"||Object.keys(r).length!==Object.keys(a).length)return!1;for(var g in r)if(!e(r[g],a[g]))return!1;return!0}return r===a},y.dot=function(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]},y.dot$1=function(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]+e[3]*r[3]},y.ease=ti,y.emitValidationErrors=fs,y.endsWith=Lr,y.enforceCacheSizeLimit=function(e){mn(),on&&on.then(function(r){r.keys().then(function(a){for(var d=0;d<a.length-e;d++)r.delete(a[d])})})},y.evaluateSizeForFeature=vh,y.evaluateSizeForZoom=xh,y.evaluateVariableOffset=sc,y.evented=Xl,y.extend=mi,y.featureFilter=Us,y.filterObject=Fn,y.fromRotation=function(e,r){var a=Math.sin(r),d=Math.cos(r);return e[0]=d,e[1]=a,e[2]=0,e[3]=-a,e[4]=d,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},y.getAnchorAlignment=eu,y.getAnchorJustification=Lc,y.getArrayBuffer=Ln,y.getImage=Y,y.getJSON=function(e,r){return xo(mi(e,{type:"json"}),r)},y.getRTLTextPluginStatus=Eo,y.getReferrer=Rr,y.getVideo=function(e,r){var a,d,g=Se.document.createElement("video");g.muted=!0,g.onloadstart=function(){r(null,g)};for(var E=0;E<e.length;E++){var i=Se.document.createElement("source");a=e[E],d=void 0,(d=Se.document.createElement("a")).href=a,(d.protocol!==Se.document.location.protocol||d.host!==Se.document.location.host)&&(g.crossOrigin="Anonymous"),i.src=e[E],g.appendChild(i)}return{cancel:function(){}}},y.identity=Yn,y.invert=function(e,r){var a=r[0],d=r[1],g=r[2],E=r[3],i=r[4],t=r[5],o=r[6],l=r[7],p=r[8],m=r[9],_=r[10],T=r[11],C=r[12],k=r[13],R=r[14],D=r[15],V=a*t-d*i,G=a*o-g*i,Z=a*l-E*i,ee=d*o-g*t,ae=d*l-E*t,we=g*l-E*o,ke=p*k-m*C,Re=p*R-_*C,Be=p*D-T*C,$e=m*R-_*k,Oe=m*D-T*k,dt=_*D-T*R,ht=V*dt-G*Oe+Z*$e+ee*Be-ae*Re+we*ke;return ht?(e[0]=(t*dt-o*Oe+l*$e)*(ht=1/ht),e[1]=(g*Oe-d*dt-E*$e)*ht,e[2]=(k*we-R*ae+D*ee)*ht,e[3]=(_*ae-m*we-T*ee)*ht,e[4]=(o*Be-i*dt-l*Re)*ht,e[5]=(a*dt-g*Be+E*Re)*ht,e[6]=(R*Z-C*we-D*G)*ht,e[7]=(p*we-_*Z+T*G)*ht,e[8]=(i*Oe-t*Be+l*ke)*ht,e[9]=(d*Be-a*Oe-E*ke)*ht,e[10]=(C*ae-k*Z+D*V)*ht,e[11]=(m*Z-p*ae-T*V)*ht,e[12]=(t*Re-i*$e-o*ke)*ht,e[13]=(a*$e-d*Re+g*ke)*ht,e[14]=(k*G-C*ee-R*V)*ht,e[15]=(p*ee-m*G+_*V)*ht,e):null},y.isChar=St,y.isMapboxURL=nn,y.keysDifference=function(e,r){var a=[];for(var d in e)d in r||a.push(d);return a},y.makeRequest=xo,y.mapObject=lr,y.mercatorXfromLng=Ih,y.mercatorYfromLat=Ur,y.mercatorZfromAltitude=Al,y.mul=vl,y.multiply=go,y.mvt=Tu,y.nextPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},y.normalize=function(e,r){var a=r[0],d=r[1],g=r[2],E=a*a+d*d+g*g;return E>0&&(E=1/Math.sqrt(E)),e[0]=r[0]*E,e[1]=r[1]*E,e[2]=r[2]*E,e},y.number=Sr,y.offscreenCanvasSupported=Ct,y.ortho=function(e,r,a,d,g,E,i){var t=1/(r-a),o=1/(d-g),l=1/(E-i);return e[0]=-2*t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(r+a)*t,e[13]=(g+d)*o,e[14]=(i+E)*l,e[15]=1,e},y.parseGlyphPBF=function(e){return new Ac(e).readFields(od,[])},y.pbf=Ac,y.performSymbolLayout=function(e,r,a,d,g,E,i){e.createArrays(),e.tilePixelRatio=8192/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;var t=e.layers[0].layout,o=e.layers[0]._unevaluatedLayout._values,l={};if(e.textSizeData.kind==="composite"){var p=e.textSizeData,m=p.maxZoom;l.compositeTextSizes=[o["text-size"].possiblyEvaluate(new wt(p.minZoom),i),o["text-size"].possiblyEvaluate(new wt(m),i)]}if(e.iconSizeData.kind==="composite"){var _=e.iconSizeData,T=_.maxZoom;l.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new wt(_.minZoom),i),o["icon-size"].possiblyEvaluate(new wt(T),i)]}l.layoutTextSize=o["text-size"].possiblyEvaluate(new wt(e.zoom+1),i),l.layoutIconSize=o["icon-size"].possiblyEvaluate(new wt(e.zoom+1),i),l.textMaxSize=o["text-size"].possiblyEvaluate(new wt(18));for(var C=24*t.get("text-line-height"),k=t.get("text-rotation-alignment")==="map"&&t.get("symbol-placement")!=="point",R=t.get("text-keep-upright"),D=t.get("text-size"),V=function(){var ee=Z[G],ae=t.get("text-font").evaluate(ee,{},i).join(","),we=D.evaluate(ee,{},i),ke=l.layoutTextSize.evaluate(ee,{},i),Re=l.layoutIconSize.evaluate(ee,{},i),Be={horizontal:{},vertical:void 0},$e=ee.text,Oe=[0,0];if($e){var dt=$e.toString(),ht=24*t.get("text-letter-spacing").evaluate(ee,{},i),Ye=function(si){for(var fi=0,xi=si;fi<xi.length;fi+=1)if(hi=xi[fi].charCodeAt(0),St.Arabic(hi)||St["Arabic Supplement"](hi)||St["Arabic Extended-A"](hi)||St["Arabic Presentation Forms-A"](hi)||St["Arabic Presentation Forms-B"](hi))return!1;var hi;return!0}(dt)?ht:0,ct=t.get("text-anchor").evaluate(ee,{},i),nt=t.get("text-variable-anchor");if(!nt){var ft=t.get("text-radial-offset").evaluate(ee,{},i);Oe=ft?sc(ct,[24*ft,Mc]):t.get("text-offset").evaluate(ee,{},i).map(function(si){return 24*si})}var tt=k?"center":t.get("text-justify").evaluate(ee,{},i),at=t.get("symbol-placement"),Bt=at==="point"?24*t.get("text-max-width").evaluate(ee,{},i):0,Dt=function(){e.allowVerticalPlacement&&Ns(dt)&&(Be.vertical=tc($e,r,a,g,ae,Bt,C,ct,"left",Ye,Oe,Jo.vertical,!0,at,ke,we))};if(!k&&nt){for(var Qt=tt==="auto"?nt.map(function(si){return Lc(si)}):[tt],ri=!1,vi=0;vi<Qt.length;vi++){var Ci=Qt[vi];if(!Be.horizontal[Ci])if(ri)Be.horizontal[Ci]=Be.horizontal[0];else{var Ui=tc($e,r,a,g,ae,Bt,C,"center",Ci,Ye,Oe,Jo.horizontal,!1,at,ke,we);Ui&&(Be.horizontal[Ci]=Ui,ri=Ui.positionedLines.length===1)}}Dt()}else{tt==="auto"&&(tt=Lc(ct));var Vi=tc($e,r,a,g,ae,Bt,C,ct,tt,Ye,Oe,Jo.horizontal,!1,at,ke,we);Vi&&(Be.horizontal[tt]=Vi),Dt(),Ns(dt)&&k&&R&&(Be.vertical=tc($e,r,a,g,ae,Bt,C,ct,tt,Ye,Oe,Jo.vertical,!1,at,ke,we))}}var Mi=void 0,Gi=!1;if(ee.icon&&ee.icon.name){var Li=d[ee.icon.name];Li&&(Mi=function(si,fi,xi){var hi=eu(xi),sr=fi[0]-si.displaySize[0]*hi.horizontalAlign,ir=fi[1]-si.displaySize[1]*hi.verticalAlign;return{image:si,top:ir,bottom:ir+si.displaySize[1],left:sr,right:sr+si.displaySize[0]}}(g[ee.icon.name],t.get("icon-offset").evaluate(ee,{},i),t.get("icon-anchor").evaluate(ee,{},i)),Gi=Li.sdf,e.sdfIcons===void 0?e.sdfIcons=Li.sdf:e.sdfIcons!==Li.sdf&&nr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Li.pixelRatio!==e.pixelRatio||t.get("icon-rotate").constantOr(1)!==0)&&(e.iconsNeedLinear=!0))}var Zi=uc(Be.horizontal)||Be.vertical;e.iconsInText=!!Zi&&Zi.iconsInText,(Zi||Mi)&&function(si,fi,xi,hi,sr,ir,ki,Ii,qi,jt,Qr){var pr=ir.textMaxSize.evaluate(fi,{});pr===void 0&&(pr=ki);var kr,Hi=si.layers[0].layout,Pn=Hi.get("icon-offset").evaluate(fi,{},Qr),cn=uc(xi.horizontal),Yo=ki/24,to=si.tilePixelRatio*Yo,io=si.tilePixelRatio*pr/24,en=si.tilePixelRatio*Ii,Qo=si.tilePixelRatio*Hi.get("symbol-spacing"),Pl=Hi.get("text-padding")*si.tilePixelRatio,au=Hi.get("icon-padding")*si.tilePixelRatio,su=Hi.get("text-max-angle")/180*Math.PI,Ou=Hi.get("text-rotation-alignment")==="map"&&Hi.get("symbol-placement")!=="point",Ra=Hi.get("icon-rotation-alignment")==="map"&&Hi.get("symbol-placement")!=="point",ws=Hi.get("symbol-placement"),lu=Qo/2,kl=Hi.get("icon-text-fit");hi&&kl!=="none"&&(si.allowVerticalPlacement&&xi.vertical&&(kr=ic(hi,xi.vertical,kl,Hi.get("icon-text-fit-padding"),Pn,Yo)),cn&&(hi=ic(hi,cn,kl,Hi.get("icon-text-fit-padding"),Pn,Yo)));var tl=function(uy,kh){kh.x<0||kh.x>=8192||kh.y<0||kh.y>=8192||function(tn,rl,cy,Vu,Ed,df,hp,Ml,pp,Mh,dp,fp,Sd,ff,Lh,mf,yf,gf,_f,vf,Oa,mp,xf,Ll,hy){var bf,mc,Gc,Zc,$c,Xc=tn.addToLineVertexArray(rl,cy),wf=0,Ef=0,Sf=0,Tf=0,Td=-1,Id=-1,hu={},If=me(""),Ad=0,Cd=0;if(Ml._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Ad=(bf=Ml.layout.get("text-offset").evaluate(Oa,{},Ll).map(function(Rh){return 24*Rh}))[0],Cd=bf[1]):(Ad=24*Ml.layout.get("text-radial-offset").evaluate(Oa,{},Ll),Cd=Mc),tn.allowVerticalPlacement&&Vu.vertical){var Af=Ml.layout.get("text-rotate").evaluate(Oa,{},Ll)+90;Zc=new ac(pp,rl,Mh,dp,fp,Vu.vertical,Sd,ff,Lh,Af),hp&&($c=new ac(pp,rl,Mh,dp,fp,hp,yf,gf,Lh,Af))}if(Ed){var zd=Ml.layout.get("icon-rotate").evaluate(Oa,{}),Cf=Ml.layout.get("icon-text-fit")!=="none",zf=xs(Ed,zd,xf,Cf),Pd=hp?xs(hp,zd,xf,Cf):void 0;Gc=new ac(pp,rl,Mh,dp,fp,Ed,yf,gf,!1,zd),wf=4*zf.length;var Pf=tn.iconSizeData,Dh=null;Pf.kind==="source"?(Dh=[128*Ml.layout.get("icon-size").evaluate(Oa,{})])[0]>32640&&nr(tn.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):Pf.kind==="composite"&&((Dh=[128*mp.compositeIconSizes[0].evaluate(Oa,{},Ll),128*mp.compositeIconSizes[1].evaluate(Oa,{},Ll)])[0]>32640||Dh[1]>32640)&&nr(tn.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),tn.addSymbols(tn.icon,zf,Dh,vf,_f,Oa,!1,rl,Xc.lineStartIndex,Xc.lineLength,-1,Ll),Td=tn.icon.placedSymbolArray.length-1,Pd&&(Ef=4*Pd.length,tn.addSymbols(tn.icon,Pd,Dh,vf,_f,Oa,Jo.vertical,rl,Xc.lineStartIndex,Xc.lineLength,-1,Ll),Id=tn.icon.placedSymbolArray.length-1)}for(var kf in Vu.horizontal){var yp=Vu.horizontal[kf];if(!mc){If=me(yp.text);var py=Ml.layout.get("text-rotate").evaluate(Oa,{},Ll);mc=new ac(pp,rl,Mh,dp,fp,yp,Sd,ff,Lh,py)}var Mf=yp.positionedLines.length===1;if(Sf+=lc(tn,rl,yp,df,Ml,Lh,Oa,mf,Xc,Vu.vertical?Jo.horizontal:Jo.horizontalOnly,Mf?Object.keys(Vu.horizontal):[kf],hu,Td,mp,Ll),Mf)break}Vu.vertical&&(Tf+=lc(tn,rl,Vu.vertical,df,Ml,Lh,Oa,mf,Xc,Jo.vertical,["vertical"],hu,Id,mp,Ll));var dy=mc?mc.boxStartIndex:tn.collisionBoxArray.length,fy=mc?mc.boxEndIndex:tn.collisionBoxArray.length,my=Zc?Zc.boxStartIndex:tn.collisionBoxArray.length,yy=Zc?Zc.boxEndIndex:tn.collisionBoxArray.length,gy=Gc?Gc.boxStartIndex:tn.collisionBoxArray.length,_y=Gc?Gc.boxEndIndex:tn.collisionBoxArray.length,vy=$c?$c.boxStartIndex:tn.collisionBoxArray.length,xy=$c?$c.boxEndIndex:tn.collisionBoxArray.length,Dl=-1,gp=function(Rh,Df){return Rh&&Rh.circleDiameter?Math.max(Rh.circleDiameter,Df):Df};Dl=gp(mc,Dl),Dl=gp(Zc,Dl),Dl=gp(Gc,Dl);var Lf=(Dl=gp($c,Dl))>-1?1:0;Lf&&(Dl*=hy/24),tn.glyphOffsetArray.length>=Wi.MAX_GLYPHS&&nr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Oa.sortKey!==void 0&&tn.addToSortKeyRanges(tn.symbolInstances.length,Oa.sortKey),tn.symbolInstances.emplaceBack(rl.x,rl.y,hu.right>=0?hu.right:-1,hu.center>=0?hu.center:-1,hu.left>=0?hu.left:-1,hu.vertical||-1,Td,Id,If,dy,fy,my,yy,gy,_y,vy,xy,Mh,Sf,Tf,wf,Ef,Lf,0,Sd,Ad,Cd,Dl)}(si,kh,uy,xi,hi,sr,kr,si.layers[0],si.collisionBoxArray,fi.index,fi.sourceLayerIndex,si.index,to,Pl,Ou,qi,en,au,Ra,Pn,fi,ir,jt,Qr,ki)};if(ws==="line")for(var Fu=0,Nc=Eh(fi.geometry,0,0,8192,8192);Fu<Nc.length;Fu+=1)for(var jc=Nc[Fu],hc=0,pc=cd(jc,Qo,su,xi.vertical||cn,hi,24,io,si.overscaling,8192);hc<pc.length;hc+=1){var qc=pc[hc];cn&&Dc(si,cn.text,lu,qc)||tl(jc,qc)}else if(ws==="line-center")for(var dc=0,fc=fi.geometry;dc<fc.length;dc+=1){var Ro=fc[dc];if(Ro.length>1){var uu=ud(Ro,su,xi.vertical||cn,hi,24,io);uu&&tl(Ro,uu)}}else if(fi.type==="Polygon")for(var cu=0,ro=Tc(fi.geometry,0);cu<ro.length;cu+=1){var Bo=ro[cu],il=pd(Bo,16);tl(Bo[0],new Ys(il.x,il.y,0))}else if(fi.type==="LineString")for(var rs=0,Uu=fi.geometry;rs<Uu.length;rs+=1){var Ba=Uu[rs];tl(Ba,new Ys(Ba[0].x,Ba[0].y,0))}else if(fi.type==="Point")for(var xd=0,hf=fi.geometry;xd<hf.length;xd+=1)for(var bd=0,pf=hf[xd];bd<pf.length;bd+=1){var wd=pf[bd];tl([wd],new Ys(wd.x,wd.y,0))}}(e,ee,Be,Mi,d,l,ke,Re,Oe,Gi,i)},G=0,Z=e.features;G<Z.length;G+=1)V();E&&e.generateCollisionDebugBuffers()},y.perspective=function(e,r,a,d,g){var E,i=1/Math.tan(r/2);return e[0]=i/a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,g!=null&&g!==1/0?(e[10]=(g+d)*(E=1/(d-g)),e[14]=2*g*d*E):(e[10]=-1,e[14]=-2*d),e},y.pick=function(e,r){for(var a={},d=0;d<r.length;d++){var g=r[d];g in e&&(a[g]=e[g])}return a},y.plugin=Vt,y.polygonIntersectsPolygon=So,y.postMapLoadEvent=zo,y.postTurnstileEvent=ot,y.potpack=ip,y.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],y.register=Ut,y.registerForPluginStateChange=function(e){return e({pluginStatus:_n,pluginURL:Lo}),Xl.on("pluginStateChange",e),e},y.renderColorRamp=Sc,y.rotate=function(e,r,a){var d=r[0],g=r[1],E=r[2],i=r[3],t=Math.sin(a),o=Math.cos(a);return e[0]=d*o+E*t,e[1]=g*o+i*t,e[2]=d*-t+E*o,e[3]=g*-t+i*o,e},y.rotateX=function(e,r,a){var d=Math.sin(a),g=Math.cos(a),E=r[4],i=r[5],t=r[6],o=r[7],l=r[8],p=r[9],m=r[10],_=r[11];return r!==e&&(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[4]=E*g+l*d,e[5]=i*g+p*d,e[6]=t*g+m*d,e[7]=o*g+_*d,e[8]=l*g-E*d,e[9]=p*g-i*d,e[10]=m*g-t*d,e[11]=_*g-o*d,e},y.rotateZ=function(e,r,a){var d=Math.sin(a),g=Math.cos(a),E=r[0],i=r[1],t=r[2],o=r[3],l=r[4],p=r[5],m=r[6],_=r[7];return r!==e&&(e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=E*g+l*d,e[1]=i*g+p*d,e[2]=t*g+m*d,e[3]=o*g+_*d,e[4]=l*g-E*d,e[5]=p*g-i*d,e[6]=m*g-t*d,e[7]=_*g-o*d,e},y.scale=function(e,r,a){var d=a[0],g=a[1],E=a[2];return e[0]=r[0]*d,e[1]=r[1]*d,e[2]=r[2]*d,e[3]=r[3]*d,e[4]=r[4]*g,e[5]=r[5]*g,e[6]=r[6]*g,e[7]=r[7]*g,e[8]=r[8]*E,e[9]=r[9]*E,e[10]=r[10]*E,e[11]=r[11]*E,e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},y.scale$1=function(e,r,a){return e[0]=r[0]*a,e[1]=r[1]*a,e[2]=r[2]*a,e[3]=r[3]*a,e},y.scale$2=function(e,r,a){return e[0]=r[0]*a,e[1]=r[1]*a,e[2]=r[2]*a,e},y.setCacheLimits=function(e,r){Zn=e,Ki=r},y.setRTLTextPlugin=function(e,r,a){if(a===void 0&&(a=!1),_n==="deferred"||_n==="loading"||_n==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Lo=dn.resolveURL(e),_n="deferred",Ja=r,gs(),a||Wn()},y.sphericalToCartesian=function(e){var r=e[0],a=e[1],d=e[2];return a+=90,a*=Math.PI/180,d*=Math.PI/180,{x:r*Math.cos(a)*Math.sin(d),y:r*Math.sin(a)*Math.sin(d),z:r*Math.cos(d)}},y.sqrLen=function(e){var r=e[0],a=e[1];return r*r+a*a},y.styleSpec=ce,y.sub=function(e,r,a){return e[0]=r[0]-a[0],e[1]=r[1]-a[1],e[2]=r[2]-a[2],e},y.symbolSize=ld,y.transformMat3=function(e,r,a){var d=r[0],g=r[1],E=r[2];return e[0]=d*a[0]+g*a[3]+E*a[6],e[1]=d*a[1]+g*a[4]+E*a[7],e[2]=d*a[2]+g*a[5]+E*a[8],e},y.transformMat4=xl,y.translate=function(e,r,a){var d,g,E,i,t,o,l,p,m,_,T,C,k=a[0],R=a[1],D=a[2];return r===e?(e[12]=r[0]*k+r[4]*R+r[8]*D+r[12],e[13]=r[1]*k+r[5]*R+r[9]*D+r[13],e[14]=r[2]*k+r[6]*R+r[10]*D+r[14],e[15]=r[3]*k+r[7]*R+r[11]*D+r[15]):(g=r[1],E=r[2],i=r[3],t=r[4],o=r[5],l=r[6],p=r[7],m=r[8],_=r[9],T=r[10],C=r[11],e[0]=d=r[0],e[1]=g,e[2]=E,e[3]=i,e[4]=t,e[5]=o,e[6]=l,e[7]=p,e[8]=m,e[9]=_,e[10]=T,e[11]=C,e[12]=d*k+t*R+m*D+r[12],e[13]=g*k+o*R+_*D+r[13],e[14]=E*k+l*R+T*D+r[14],e[15]=i*k+p*R+C*D+r[15]),e},y.triggerPluginCompletionEvent=$l,y.uniqueId=br,y.validateCustomStyleLayer=function(e){var r=[],a=e.id;return a===void 0&&r.push({message:"layers."+a+': missing required property "id"'}),e.render===void 0&&r.push({message:"layers."+a+': missing required method "render"'}),e.renderingMode&&e.renderingMode!=="2d"&&e.renderingMode!=="3d"&&r.push({message:"layers."+a+': property "renderingMode" must be either "2d" or "3d"'}),r},y.validateLight=Vs,y.validateStyle=Mo,y.values=function(e){var r=[];for(var a in e)r.push(e[a]);return r},y.vectorTile=Tu,y.version="1.13.2",y.warnOnce=nr,y.webpSupported=so,y.window=Se,y.wrap=Ei}),Ae(["./shared"],function(y){function x(X){var Y=typeof X;if(Y==="number"||Y==="boolean"||Y==="string"||X==null)return JSON.stringify(X);if(Array.isArray(X)){for(var ie="[",pe=0,xe=X;pe<xe.length;pe+=1)ie+=x(xe[pe])+",";return ie+"]"}for(var Me=Object.keys(X).sort(),De="{",ce=0;ce<Me.length;ce++)De+=JSON.stringify(Me[ce])+":"+x(X[Me[ce]])+",";return De+"}"}function he(X){for(var Y="",ie=0,pe=y.refProperties;ie<pe.length;ie+=1)Y+="/"+x(X[pe[ie]]);return Y}var it=function(X){this.keyCache={},X&&this.replace(X)};it.prototype.replace=function(X){this._layerConfigs={},this._layers={},this.update(X,[])},it.prototype.update=function(X,Y){for(var ie=this,pe=0,xe=X;pe<xe.length;pe+=1){var Me=xe[pe];this._layerConfigs[Me.id]=Me;var De=this._layers[Me.id]=y.createStyleLayer(Me);De._featureFilter=y.featureFilter(De.filter),this.keyCache[Me.id]&&delete this.keyCache[Me.id]}for(var ce=0,Ie=Y;ce<Ie.length;ce+=1){var qe=Ie[ce];delete this.keyCache[qe],delete this._layerConfigs[qe],delete this._layers[qe]}this.familiesBySource={};for(var Q=0,F=function(ge,ve){for(var Ge={},Ue=0;Ue<ge.length;Ue++){var Ze=ve&&ve[ge[Ue].id]||he(ge[Ue]);ve&&(ve[ge[Ue].id]=Ze);var bt=Ge[Ze];bt||(bt=Ge[Ze]=[]),bt.push(ge[Ue])}var pt=[];for(var vt in Ge)pt.push(Ge[vt]);return pt}(y.values(this._layerConfigs),this.keyCache);Q<F.length;Q+=1){var U=F[Q].map(function(ge){return ie._layers[ge.id]}),J=U[0];if(J.visibility!=="none"){var ne=J.source||"",de=this.familiesBySource[ne];de||(de=this.familiesBySource[ne]={});var le=J.sourceLayer||"_geojsonTileLayer",_e=de[le];_e||(_e=de[le]=[]),_e.push(U)}}};var Ke=function(X){var Y={},ie=[];for(var pe in X){var xe=X[pe],Me=Y[pe]={};for(var De in xe){var ce=xe[+De];if(ce&&ce.bitmap.width!==0&&ce.bitmap.height!==0){var Ie={x:0,y:0,w:ce.bitmap.width+2,h:ce.bitmap.height+2};ie.push(Ie),Me[De]={rect:Ie,metrics:ce.metrics}}}}var qe=y.potpack(ie),Q=new y.AlphaImage({width:qe.w||1,height:qe.h||1});for(var F in X){var U=X[F];for(var J in U){var ne=U[+J];if(ne&&ne.bitmap.width!==0&&ne.bitmap.height!==0){var de=Y[F][J].rect;y.AlphaImage.copy(ne.bitmap,Q,{x:0,y:0},{x:de.x+1,y:de.y+1},ne.bitmap)}}}this.image=Q,this.positions=Y};y.register("GlyphAtlas",Ke);var Qe=function(X){this.tileID=new y.OverscaledTileID(X.tileID.overscaledZ,X.tileID.wrap,X.tileID.canonical.z,X.tileID.canonical.x,X.tileID.canonical.y),this.uid=X.uid,this.zoom=X.zoom,this.pixelRatio=X.pixelRatio,this.tileSize=X.tileSize,this.source=X.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=X.showCollisionBoxes,this.collectResourceTiming=!!X.collectResourceTiming,this.returnDependencies=!!X.returnDependencies,this.promoteId=X.promoteId};function Se(X,Y,ie){for(var pe=new y.EvaluationParameters(Y),xe=0,Me=X;xe<Me.length;xe+=1)Me[xe].recalculate(pe,ie)}function It(X,Y){var ie=y.getArrayBuffer(X.request,function(pe,xe,Me,De){pe?Y(pe):xe&&Y(null,{vectorTile:new y.vectorTile.VectorTile(new y.pbf(xe)),rawData:xe,cacheControl:Me,expires:De})});return function(){ie.cancel(),Y()}}Qe.prototype.parse=function(X,Y,ie,pe,xe){var Me=this;this.status="parsing",this.data=X,this.collisionBoxArray=new y.CollisionBoxArray;var De=new y.DictionaryCoder(Object.keys(X.layers).sort()),ce=new y.FeatureIndex(this.tileID,this.promoteId);ce.bucketLayerIDs=[];var Ie,qe,Q,F,U={},J={featureIndex:ce,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ie},ne=Y.familiesBySource[this.source];for(var de in ne){var le=X.layers[de];if(le){le.version===1&&y.warnOnce('Vector tile source "'+this.source+'" layer "'+de+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var _e=De.encode(de),ge=[],ve=0;ve<le.length;ve++){var Ge=le.feature(ve),Ue=ce.getId(Ge,de);ge.push({feature:Ge,id:Ue,index:ve,sourceLayerIndex:_e})}for(var Ze=0,bt=ne[de];Ze<bt.length;Ze+=1){var pt=bt[Ze],vt=pt[0];vt.minzoom&&this.zoom<Math.floor(vt.minzoom)||vt.maxzoom&&this.zoom>=vt.maxzoom||vt.visibility!=="none"&&(Se(pt,this.zoom,ie),(U[vt.id]=vt.createBucket({index:ce.bucketLayerIDs.length,layers:pt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:_e,sourceID:this.source})).populate(ge,J,this.tileID.canonical),ce.bucketLayerIDs.push(pt.map(function(Nt){return Nt.id})))}}}var Et=y.mapObject(J.glyphDependencies,function(Nt){return Object.keys(Nt).map(Number)});Object.keys(Et).length?pe.send("getGlyphs",{uid:this.uid,stacks:Et},function(Nt,Pt){Ie||(Ie=Nt,qe=Pt,Jt.call(Me))}):qe={};var di=Object.keys(J.iconDependencies);di.length?pe.send("getImages",{icons:di,source:this.source,tileID:this.tileID,type:"icons"},function(Nt,Pt){Ie||(Ie=Nt,Q=Pt,Jt.call(Me))}):Q={};var $t=Object.keys(J.patternDependencies);function Jt(){if(Ie)return xe(Ie);if(qe&&Q&&F){var Nt=new Ke(qe),Pt=new y.ImageAtlas(Q,F);for(var oi in U){var Oi=U[oi];Oi instanceof y.SymbolBucket?(Se(Oi.layers,this.zoom,ie),y.performSymbolLayout(Oi,qe,Nt.positions,Q,Pt.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Oi.hasPattern&&(Oi instanceof y.LineBucket||Oi instanceof y.FillBucket||Oi instanceof y.FillExtrusionBucket)&&(Se(Oi.layers,this.zoom,ie),Oi.addFeatures(J,this.tileID.canonical,Pt.patternPositions))}this.status="done",xe(null,{buckets:y.values(U).filter(function(Cr){return!Cr.isEmpty()}),featureIndex:ce,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Nt.image,imageAtlas:Pt,glyphMap:this.returnDependencies?qe:null,iconMap:this.returnDependencies?Q:null,glyphPositions:this.returnDependencies?Nt.positions:null})}}$t.length?pe.send("getImages",{icons:$t,source:this.source,tileID:this.tileID,type:"patterns"},function(Nt,Pt){Ie||(Ie=Nt,F=Pt,Jt.call(Me))}):F={},Jt.call(this)};var yt=function(X,Y,ie,pe){this.actor=X,this.layerIndex=Y,this.availableImages=ie,this.loadVectorData=pe||It,this.loading={},this.loaded={}};yt.prototype.loadTile=function(X,Y){var ie=this,pe=X.uid;this.loading||(this.loading={});var xe=!!(X&&X.request&&X.request.collectResourceTiming)&&new y.RequestPerformance(X.request),Me=this.loading[pe]=new Qe(X);Me.abort=this.loadVectorData(X,function(De,ce){if(delete ie.loading[pe],De||!ce)return Me.status="done",ie.loaded[pe]=Me,Y(De);var Ie=ce.rawData,qe={};ce.expires&&(qe.expires=ce.expires),ce.cacheControl&&(qe.cacheControl=ce.cacheControl);var Q={};if(xe){var F=xe.finish();F&&(Q.resourceTiming=JSON.parse(JSON.stringify(F)))}Me.vectorTile=ce.vectorTile,Me.parse(ce.vectorTile,ie.layerIndex,ie.availableImages,ie.actor,function(U,J){if(U||!J)return Y(U);Y(null,y.extend({rawTileData:Ie.slice(0)},J,qe,Q))}),ie.loaded=ie.loaded||{},ie.loaded[pe]=Me})},yt.prototype.reloadTile=function(X,Y){var ie=this,pe=this.loaded,xe=X.uid,Me=this;if(pe&&pe[xe]){var De=pe[xe];De.showCollisionBoxes=X.showCollisionBoxes;var ce=function(Ie,qe){var Q=De.reloadCallback;Q&&(delete De.reloadCallback,De.parse(De.vectorTile,Me.layerIndex,ie.availableImages,Me.actor,Q)),Y(Ie,qe)};De.status==="parsing"?De.reloadCallback=ce:De.status==="done"&&(De.vectorTile?De.parse(De.vectorTile,this.layerIndex,this.availableImages,this.actor,ce):ce())}},yt.prototype.abortTile=function(X,Y){var ie=this.loading,pe=X.uid;ie&&ie[pe]&&ie[pe].abort&&(ie[pe].abort(),delete ie[pe]),Y()},yt.prototype.removeTile=function(X,Y){var ie=this.loaded,pe=X.uid;ie&&ie[pe]&&delete ie[pe],Y()};var ti=y.window.ImageBitmap,zt=function(){this.loaded={}};function Ei(X,Y){if(X.length!==0){mi(X[0],Y);for(var ie=1;ie<X.length;ie++)mi(X[ie],!Y)}}function mi(X,Y){for(var ie=0,pe=0,xe=X.length,Me=xe-1;pe<xe;Me=pe++)ie+=(X[pe][0]-X[Me][0])*(X[Me][1]+X[pe][1]);ie>=0!=!!Y&&X.reverse()}zt.prototype.loadTile=function(X,Y){var ie=X.uid,pe=X.encoding,xe=X.rawImageData,Me=ti&&xe instanceof ti?this.getImageData(xe):xe,De=new y.DEMData(ie,Me,pe);this.loaded=this.loaded||{},this.loaded[ie]=De,Y(null,De)},zt.prototype.getImageData=function(X){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(X.width,X.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=X.width,this.offscreenCanvas.height=X.height,this.offscreenCanvasContext.drawImage(X,0,0,X.width,X.height);var Y=this.offscreenCanvasContext.getImageData(-1,-1,X.width+2,X.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new y.RGBAImage({width:Y.width,height:Y.height},Y.data)},zt.prototype.removeTile=function(X){var Y=this.loaded,ie=X.uid;Y&&Y[ie]&&delete Y[ie]};var Ht=y.vectorTile.VectorTileFeature.prototype.toGeoJSON,br=function(X){this._feature=X,this.extent=y.EXTENT,this.type=X.type,this.properties=X.tags,"id"in X&&!isNaN(X.id)&&(this.id=parseInt(X.id,10))};br.prototype.loadGeometry=function(){if(this._feature.type===1){for(var X=[],Y=0,ie=this._feature.geometry;Y<ie.length;Y+=1){var pe=ie[Y];X.push([new y.Point$1(pe[0],pe[1])])}return X}for(var xe=[],Me=0,De=this._feature.geometry;Me<De.length;Me+=1){for(var ce=[],Ie=0,qe=De[Me];Ie<qe.length;Ie+=1){var Q=qe[Ie];ce.push(new y.Point$1(Q[0],Q[1]))}xe.push(ce)}return xe},br.prototype.toGeoJSON=function(X,Y,ie){return Ht.call(this,X,Y,ie)};var pi=function(X){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=y.EXTENT,this.length=X.length,this._features=X};pi.prototype.feature=function(X){return new br(this._features[X])};var Si=y.vectorTile.VectorTileFeature,Ni=Lr;function Lr(X,Y){this.options=Y||{},this.features=X,this.length=X.length}function lr(X,Y){this.id=typeof X.id=="number"?X.id:void 0,this.type=X.type,this.rawGeometry=X.type===1?[X.geometry]:X.geometry,this.properties=X.tags,this.extent=Y||4096}Lr.prototype.feature=function(X){return new lr(this.features[X],this.options.extent)},lr.prototype.loadGeometry=function(){var X=this.rawGeometry;this.geometry=[];for(var Y=0;Y<X.length;Y++){for(var ie=X[Y],pe=[],xe=0;xe<ie.length;xe++)pe.push(new y.Point$1(ie[xe][0],ie[xe][1]));this.geometry.push(pe)}return this.geometry},lr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var X=this.geometry,Y=1/0,ie=-1/0,pe=1/0,xe=-1/0,Me=0;Me<X.length;Me++)for(var De=X[Me],ce=0;ce<De.length;ce++){var Ie=De[ce];Y=Math.min(Y,Ie.x),ie=Math.max(ie,Ie.x),pe=Math.min(pe,Ie.y),xe=Math.max(xe,Ie.y)}return[Y,pe,ie,xe]},lr.prototype.toGeoJSON=Si.prototype.toGeoJSON;var Fn=no,hn=Ni;function no(X){var Y=new y.pbf;return function(ie,pe){for(var xe in ie.layers)pe.writeMessage(3,nr,ie.layers[xe])}(X,Y),Y.finish()}function nr(X,Y){var ie;Y.writeVarintField(15,X.version||1),Y.writeStringField(1,X.name||""),Y.writeVarintField(5,X.extent||4096);var pe={keys:[],values:[],keycache:{},valuecache:{}};for(ie=0;ie<X.length;ie++)pe.feature=X.feature(ie),Y.writeMessage(2,Ar,pe);var xe=pe.keys;for(ie=0;ie<xe.length;ie++)Y.writeStringField(3,xe[ie]);var Me=pe.values;for(ie=0;ie<Me.length;ie++)Y.writeMessage(4,Co,Me[ie])}function Ar(X,Y){var ie=X.feature;ie.id!==void 0&&Y.writeVarintField(1,ie.id),Y.writeMessage(2,Fo,X),Y.writeVarintField(3,ie.type),Y.writeMessage(4,oo,ie)}function Fo(X,Y){var ie=X.feature,pe=X.keys,xe=X.values,Me=X.keycache,De=X.valuecache;for(var ce in ie.properties){var Ie=Me[ce];Ie===void 0&&(pe.push(ce),Me[ce]=Ie=pe.length-1),Y.writeVarint(Ie);var qe=ie.properties[ce],Q=typeof qe;Q!=="string"&&Q!=="boolean"&&Q!=="number"&&(qe=JSON.stringify(qe));var F=Q+":"+qe,U=De[F];U===void 0&&(xe.push(qe),De[F]=U=xe.length-1),Y.writeVarint(U)}}function Yt(X,Y){return(Y<<3)+(7&X)}function Un(X){return X<<1^X>>31}function oo(X,Y){for(var ie=X.loadGeometry(),pe=X.type,xe=0,Me=0,De=ie.length,ce=0;ce<De;ce++){var Ie=ie[ce],qe=1;pe===1&&(qe=Ie.length),Y.writeVarint(Yt(1,qe));for(var Q=pe===3?Ie.length-1:Ie.length,F=0;F<Q;F++){F===1&&pe!==1&&Y.writeVarint(Yt(2,Q-1));var U=Ie[F].x-xe,J=Ie[F].y-Me;Y.writeVarint(Un(U)),Y.writeVarint(Un(J)),xe+=U,Me+=J}pe===3&&Y.writeVarint(Yt(7,1))}}function Co(X,Y){var ie=typeof X;ie==="string"?Y.writeStringField(1,X):ie==="boolean"?Y.writeBooleanField(7,X):ie==="number"&&(X%1!=0?Y.writeDoubleField(3,X):X<0?Y.writeSVarintField(6,X):Y.writeVarintField(5,X))}function rn(X,Y,ie,pe){pn(X,ie,pe),pn(Y,2*ie,2*pe),pn(Y,2*ie+1,2*pe+1)}function pn(X,Y,ie){var pe=X[Y];X[Y]=X[ie],X[ie]=pe}function bn(X,Y,ie,pe){var xe=X-ie,Me=Y-pe;return xe*xe+Me*Me}Fn.fromVectorTileJs=no,Fn.fromGeojsonVt=function(X,Y){Y=Y||{};var ie={};for(var pe in X)ie[pe]=new Ni(X[pe].features,Y),ie[pe].name=pe,ie[pe].version=Y.version,ie[pe].extent=Y.extent;return no({layers:ie})},Fn.GeoJSONWrapper=hn;var kn=function(X){return X[0]},Vn=function(X){return X[1]},Nn=function(X,Y,ie,pe,xe){Y===void 0&&(Y=kn),ie===void 0&&(ie=Vn),pe===void 0&&(pe=64),xe===void 0&&(xe=Float64Array),this.nodeSize=pe,this.points=X;for(var Me=X.length<65536?Uint16Array:Uint32Array,De=this.ids=new Me(X.length),ce=this.coords=new xe(2*X.length),Ie=0;Ie<X.length;Ie++)De[Ie]=Ie,ce[2*Ie]=Y(X[Ie]),ce[2*Ie+1]=ie(X[Ie]);(function qe(Q,F,U,J,ne,de){if(!(ne-J<=U)){var le=J+ne>>1;(function _e(ge,ve,Ge,Ue,Ze,bt){for(;Ze>Ue;){if(Ze-Ue>600){var pt=Ze-Ue+1,vt=Ge-Ue+1,Et=Math.log(pt),di=.5*Math.exp(2*Et/3),$t=.5*Math.sqrt(Et*di*(pt-di)/pt)*(vt-pt/2<0?-1:1);_e(ge,ve,Ge,Math.max(Ue,Math.floor(Ge-vt*di/pt+$t)),Math.min(Ze,Math.floor(Ge+(pt-vt)*di/pt+$t)),bt)}var Jt=ve[2*Ge+bt],Nt=Ue,Pt=Ze;for(rn(ge,ve,Ue,Ge),ve[2*Ze+bt]>Jt&&rn(ge,ve,Ue,Ze);Nt<Pt;){for(rn(ge,ve,Nt,Pt),Nt++,Pt--;ve[2*Nt+bt]<Jt;)Nt++;for(;ve[2*Pt+bt]>Jt;)Pt--}ve[2*Ue+bt]===Jt?rn(ge,ve,Ue,Pt):rn(ge,ve,++Pt,Ze),Pt<=Ge&&(Ue=Pt+1),Ge<=Pt&&(Ze=Pt-1)}})(Q,F,le,J,ne,de%2),qe(Q,F,U,J,le-1,de+1),qe(Q,F,U,le+1,ne,de+1)}})(De,ce,pe,0,De.length-1,0)};Nn.prototype.range=function(X,Y,ie,pe){return function(xe,Me,De,ce,Ie,qe,Q){for(var F,U,J=[0,xe.length-1,0],ne=[];J.length;){var de=J.pop(),le=J.pop(),_e=J.pop();if(le-_e<=Q)for(var ge=_e;ge<=le;ge++)U=Me[2*ge+1],(F=Me[2*ge])>=De&&F<=Ie&&U>=ce&&U<=qe&&ne.push(xe[ge]);else{var ve=Math.floor((_e+le)/2);U=Me[2*ve+1],(F=Me[2*ve])>=De&&F<=Ie&&U>=ce&&U<=qe&&ne.push(xe[ve]);var Ge=(de+1)%2;(de===0?De<=F:ce<=U)&&(J.push(_e),J.push(ve-1),J.push(Ge)),(de===0?Ie>=F:qe>=U)&&(J.push(ve+1),J.push(le),J.push(Ge))}}return ne}(this.ids,this.coords,X,Y,ie,pe,this.nodeSize)},Nn.prototype.within=function(X,Y,ie){return function(pe,xe,Me,De,ce,Ie){for(var qe=[0,pe.length-1,0],Q=[],F=ce*ce;qe.length;){var U=qe.pop(),J=qe.pop(),ne=qe.pop();if(J-ne<=Ie)for(var de=ne;de<=J;de++)bn(xe[2*de],xe[2*de+1],Me,De)<=F&&Q.push(pe[de]);else{var le=Math.floor((ne+J)/2),_e=xe[2*le],ge=xe[2*le+1];bn(_e,ge,Me,De)<=F&&Q.push(pe[le]);var ve=(U+1)%2;(U===0?Me-ce<=_e:De-ce<=ge)&&(qe.push(ne),qe.push(le-1),qe.push(ve)),(U===0?Me+ce>=_e:De+ce>=ge)&&(qe.push(le+1),qe.push(J),qe.push(ve))}}return Q}(this.ids,this.coords,X,Y,ie,this.nodeSize)};var ao={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(X){return X}},_r=function(X){this.options=Mn(Object.create(ao),X),this.trees=new Array(this.options.maxZoom+1)};function dn(X,Y,ie,pe,xe){return{x:X,y:Y,zoom:1/0,id:ie,parentId:-1,numPoints:pe,properties:xe}}function Bi(X,Y){var ie=X.geometry.coordinates,pe=ie[1];return{x:jn(ie[0]),y:ii(pe),zoom:1/0,index:Y,parentId:-1}}function so(X){return{type:"Feature",id:X.id,properties:Uo(X),geometry:{type:"Point",coordinates:[(pe=X.x,360*(pe-.5)),(Y=X.y,ie=(180-360*Y)*Math.PI/180,360*Math.atan(Math.exp(ie))/Math.PI-90)]}};var Y,ie,pe}function Uo(X){var Y=X.numPoints,ie=Y>=1e4?Math.round(Y/1e3)+"k":Y>=1e3?Math.round(Y/100)/10+"k":Y;return Mn(Mn({},X.properties),{cluster:!0,cluster_id:X.id,point_count:Y,point_count_abbreviated:ie})}function jn(X){return X/360+.5}function ii(X){var Y=Math.sin(X*Math.PI/180),ie=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return ie<0?0:ie>1?1:ie}function Mn(X,Y){for(var ie in Y)X[ie]=Y[ie];return X}function Gr(X){return X.x}function nn(X){return X.y}function vo(X,Y,ie,pe,xe,Me){var De=xe-ie,ce=Me-pe;if(De!==0||ce!==0){var Ie=((X-ie)*De+(Y-pe)*ce)/(De*De+ce*ce);Ie>1?(ie=xe,pe=Me):Ie>0&&(ie+=De*Ie,pe+=ce*Ie)}return(De=X-ie)*De+(ce=Y-pe)*ce}function qn(X,Y,ie,pe){var xe={id:X===void 0?null:X,type:Y,geometry:ie,tags:pe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Me){var De=Me.geometry,ce=Me.type;if(ce==="Point"||ce==="MultiPoint"||ce==="LineString")lo(Me,De);else if(ce==="Polygon"||ce==="MultiLineString")for(var Ie=0;Ie<De.length;Ie++)lo(Me,De[Ie]);else if(ce==="MultiPolygon")for(Ie=0;Ie<De.length;Ie++)for(var qe=0;qe<De[Ie].length;qe++)lo(Me,De[Ie][qe])}(xe),xe}function lo(X,Y){for(var ie=0;ie<Y.length;ie+=3)X.minX=Math.min(X.minX,Y[ie]),X.minY=Math.min(X.minY,Y[ie+1]),X.maxX=Math.max(X.maxX,Y[ie]),X.maxY=Math.max(X.maxY,Y[ie+1])}function Dr(X,Y,ie,pe){if(Y.geometry){var xe=Y.geometry.coordinates,Me=Y.geometry.type,De=Math.pow(ie.tolerance/((1<<ie.maxZoom)*ie.extent),2),ce=[],Ie=Y.id;if(ie.promoteId?Ie=Y.properties[ie.promoteId]:ie.generateId&&(Ie=pe||0),Me==="Point")wn(xe,ce);else if(Me==="MultiPoint")for(var qe=0;qe<xe.length;qe++)wn(xe[qe],ce);else if(Me==="LineString")Vo(xe,ce,De,!1);else if(Me==="MultiLineString"){if(ie.lineMetrics){for(qe=0;qe<xe.length;qe++)Vo(xe[qe],ce=[],De,!1),X.push(qn(Ie,"LineString",ce,Y.properties));return}yi(xe,ce,De,!1)}else if(Me==="Polygon")yi(xe,ce,De,!0);else{if(Me!=="MultiPolygon"){if(Me==="GeometryCollection"){for(qe=0;qe<Y.geometry.geometries.length;qe++)Dr(X,{id:Ie,geometry:Y.geometry.geometries[qe],properties:Y.properties},ie,pe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(qe=0;qe<xe.length;qe++){var Q=[];yi(xe[qe],Q,De,!0),ce.push(Q)}}X.push(qn(Ie,Me,ce,Y.properties))}}function wn(X,Y){Y.push(on(X[0])),Y.push(Gn(X[1])),Y.push(0)}function Vo(X,Y,ie,pe){for(var xe,Me,De=0,ce=0;ce<X.length;ce++){var Ie=on(X[ce][0]),qe=Gn(X[ce][1]);Y.push(Ie),Y.push(qe),Y.push(0),ce>0&&(De+=pe?(xe*qe-Ie*Me)/2:Math.sqrt(Math.pow(Ie-xe,2)+Math.pow(qe-Me,2))),xe=Ie,Me=qe}var Q=Y.length-3;Y[2]=1,function F(U,J,ne,de){for(var le,_e=de,ge=ne-J>>1,ve=ne-J,Ge=U[J],Ue=U[J+1],Ze=U[ne],bt=U[ne+1],pt=J+3;pt<ne;pt+=3){var vt=vo(U[pt],U[pt+1],Ge,Ue,Ze,bt);if(vt>_e)le=pt,_e=vt;else if(vt===_e){var Et=Math.abs(pt-ge);Et<ve&&(le=pt,ve=Et)}}_e>de&&(le-J>3&&F(U,J,le,de),U[le+2]=_e,ne-le>3&&F(U,le,ne,de))}(Y,0,Q,ie),Y[Q+2]=1,Y.size=Math.abs(De),Y.start=0,Y.end=Y.size}function yi(X,Y,ie,pe){for(var xe=0;xe<X.length;xe++){var Me=[];Vo(X[xe],Me,ie,pe),Y.push(Me)}}function on(X){return X/360+.5}function Gn(X){var Y=Math.sin(X*Math.PI/180),ie=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return ie<0?0:ie>1?1:ie}function fn(X,Y,ie,pe,xe,Me,De,ce){if(pe/=Y,Me>=(ie/=Y)&&De<pe)return X;if(De<ie||Me>=pe)return null;for(var Ie=[],qe=0;qe<X.length;qe++){var Q=X[qe],F=Q.geometry,U=Q.type,J=xe===0?Q.minX:Q.minY,ne=xe===0?Q.maxX:Q.maxY;if(J>=ie&&ne<pe)Ie.push(Q);else if(!(ne<ie||J>=pe)){var de=[];if(U==="Point"||U==="MultiPoint")xa(F,de,ie,pe,xe);else if(U==="LineString")ot(F,de,ie,pe,xe,!1,ce.lineMetrics);else if(U==="MultiLineString")zo(F,de,ie,pe,xe,!1);else if(U==="Polygon")zo(F,de,ie,pe,xe,!0);else if(U==="MultiPolygon")for(var le=0;le<F.length;le++){var _e=[];zo(F[le],_e,ie,pe,xe,!0),_e.length&&de.push(_e)}if(de.length){if(ce.lineMetrics&&U==="LineString"){for(le=0;le<de.length;le++)Ie.push(qn(Q.id,U,de[le],Q.tags));continue}U!=="LineString"&&U!=="MultiLineString"||(de.length===1?(U="LineString",de=de[0]):U="MultiLineString"),U!=="Point"&&U!=="MultiPoint"||(U=de.length===3?"Point":"MultiPoint"),Ie.push(qn(Q.id,U,de,Q.tags))}}}return Ie.length?Ie:null}function xa(X,Y,ie,pe,xe){for(var Me=0;Me<X.length;Me+=3){var De=X[Me+xe];De>=ie&&De<=pe&&(Y.push(X[Me]),Y.push(X[Me+1]),Y.push(X[Me+2]))}}function ot(X,Y,ie,pe,xe,Me,De){for(var ce,Ie,qe=Lt(X),Q=xe===0?Ki:mn,F=X.start,U=0;U<X.length-3;U+=3){var J=X[U],ne=X[U+1],de=X[U+2],le=X[U+3],_e=X[U+4],ge=xe===0?J:ne,ve=xe===0?le:_e,Ge=!1;De&&(ce=Math.sqrt(Math.pow(J-le,2)+Math.pow(ne-_e,2))),ge<ie?ve>ie&&(Ie=Q(qe,J,ne,le,_e,ie),De&&(qe.start=F+ce*Ie)):ge>pe?ve<pe&&(Ie=Q(qe,J,ne,le,_e,pe),De&&(qe.start=F+ce*Ie)):Zn(qe,J,ne,de),ve<ie&&ge>=ie&&(Ie=Q(qe,J,ne,le,_e,ie),Ge=!0),ve>pe&&ge<=pe&&(Ie=Q(qe,J,ne,le,_e,pe),Ge=!0),!Me&&Ge&&(De&&(qe.end=F+ce*Ie),Y.push(qe),qe=Lt(X)),De&&(F+=ce)}var Ue=X.length-3;J=X[Ue],ne=X[Ue+1],de=X[Ue+2],(ge=xe===0?J:ne)>=ie&&ge<=pe&&Zn(qe,J,ne,de),Ue=qe.length-3,Me&&Ue>=3&&(qe[Ue]!==qe[0]||qe[Ue+1]!==qe[1])&&Zn(qe,qe[0],qe[1],qe[2]),qe.length&&Y.push(qe)}function Lt(X){var Y=[];return Y.size=X.size,Y.start=X.start,Y.end=X.end,Y}function zo(X,Y,ie,pe,xe,Me){for(var De=0;De<X.length;De++)ot(X[De],Y,ie,pe,xe,Me,!1)}function Zn(X,Y,ie,pe){X.push(Y),X.push(ie),X.push(pe)}function Ki(X,Y,ie,pe,xe,Me){var De=(Me-Y)/(pe-Y);return X.push(Me),X.push(ie+(xe-ie)*De),X.push(1),De}function mn(X,Y,ie,pe,xe,Me){var De=(Me-ie)/(xe-ie);return X.push(Y+(pe-Y)*De),X.push(Me),X.push(1),De}function Zr(X,Y){for(var ie=[],pe=0;pe<X.length;pe++){var xe,Me=X[pe],De=Me.type;if(De==="Point"||De==="MultiPoint"||De==="LineString")xe=uo(Me.geometry,Y);else if(De==="MultiLineString"||De==="Polygon"){xe=[];for(var ce=0;ce<Me.geometry.length;ce++)xe.push(uo(Me.geometry[ce],Y))}else if(De==="MultiPolygon")for(xe=[],ce=0;ce<Me.geometry.length;ce++){for(var Ie=[],qe=0;qe<Me.geometry[ce].length;qe++)Ie.push(uo(Me.geometry[ce][qe],Y));xe.push(Ie)}ie.push(qn(Me.id,De,xe,Me.tags))}return ie}function uo(X,Y){var ie=[];ie.size=X.size,X.start!==void 0&&(ie.start=X.start,ie.end=X.end);for(var pe=0;pe<X.length;pe+=3)ie.push(X[pe]+Y,X[pe+1],X[pe+2]);return ie}function er(X,Y){if(X.transformed)return X;var ie,pe,xe,Me=1<<X.z,De=X.x,ce=X.y;for(ie=0;ie<X.features.length;ie++){var Ie=X.features[ie],qe=Ie.geometry,Q=Ie.type;if(Ie.geometry=[],Q===1)for(pe=0;pe<qe.length;pe+=2)Ie.geometry.push(Ct(qe[pe],qe[pe+1],Y,Me,De,ce));else for(pe=0;pe<qe.length;pe++){var F=[];for(xe=0;xe<qe[pe].length;xe+=2)F.push(Ct(qe[pe][xe],qe[pe][xe+1],Y,Me,De,ce));Ie.geometry.push(F)}}return X.transformed=!0,X}function Ct(X,Y,ie,pe,xe,Me){return[Math.round(ie*(X*pe-xe)),Math.round(ie*(Y*pe-Me))]}function Ti(X,Y,ie,pe,xe){for(var Me=Y===xe.maxZoom?0:xe.tolerance/((1<<Y)*xe.extent),De={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ie,y:pe,z:Y,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ce=0;ce<X.length;ce++){De.numFeatures++,gi(De,X[ce],Me,xe);var Ie=X[ce].minX,qe=X[ce].minY,Q=X[ce].maxX,F=X[ce].maxY;Ie<De.minX&&(De.minX=Ie),qe<De.minY&&(De.minY=qe),Q>De.maxX&&(De.maxX=Q),F>De.maxY&&(De.maxY=F)}return De}function gi(X,Y,ie,pe){var xe=Y.geometry,Me=Y.type,De=[];if(Me==="Point"||Me==="MultiPoint")for(var ce=0;ce<xe.length;ce+=3)De.push(xe[ce]),De.push(xe[ce+1]),X.numPoints++,X.numSimplified++;else if(Me==="LineString")Rr(De,xe,X,ie,!1,!1);else if(Me==="MultiLineString"||Me==="Polygon")for(ce=0;ce<xe.length;ce++)Rr(De,xe[ce],X,ie,Me==="Polygon",ce===0);else if(Me==="MultiPolygon")for(var Ie=0;Ie<xe.length;Ie++){var qe=xe[Ie];for(ce=0;ce<qe.length;ce++)Rr(De,qe[ce],X,ie,!0,ce===0)}if(De.length){var Q=Y.tags||null;if(Me==="LineString"&&pe.lineMetrics){for(var F in Q={},Y.tags)Q[F]=Y.tags[F];Q.mapbox_clip_start=xe.start/xe.size,Q.mapbox_clip_end=xe.end/xe.size}var U={geometry:De,type:Me==="Polygon"||Me==="MultiPolygon"?3:Me==="LineString"||Me==="MultiLineString"?2:1,tags:Q};Y.id!==null&&(U.id=Y.id),X.features.push(U)}}function Rr(X,Y,ie,pe,xe,Me){var De=pe*pe;if(pe>0&&Y.size<(xe?De:pe))ie.numPoints+=Y.length/3;else{for(var ce=[],Ie=0;Ie<Y.length;Ie+=3)(pe===0||Y[Ie+2]>De)&&(ie.numSimplified++,ce.push(Y[Ie]),ce.push(Y[Ie+1])),ie.numPoints++;xe&&function(qe,Q){for(var F=0,U=0,J=qe.length,ne=J-2;U<J;ne=U,U+=2)F+=(qe[U]-qe[ne])*(qe[U+1]+qe[ne+1]);if(F>0===Q)for(U=0,J=qe.length;U<J/2;U+=2){var de=qe[U],le=qe[U+1];qe[U]=qe[J-2-U],qe[U+1]=qe[J-1-U],qe[J-2-U]=de,qe[J-1-U]=le}}(ce,Me),X.push(ce)}}function $r(X,Y){var ie=(Y=this.options=function(xe,Me){for(var De in Me)xe[De]=Me[De];return xe}(Object.create(this.options),Y)).debug;if(ie&&console.time("preprocess data"),Y.maxZoom<0||Y.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Y.promoteId&&Y.generateId)throw new Error("promoteId and generateId cannot be used together.");var pe=function(xe,Me){var De=[];if(xe.type==="FeatureCollection")for(var ce=0;ce<xe.features.length;ce++)Dr(De,xe.features[ce],Me,ce);else Dr(De,xe.type==="Feature"?xe:{geometry:xe},Me);return De}(X,Y);this.tiles={},this.tileCoords=[],ie&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Y.indexMaxZoom,Y.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(pe=function(xe,Me){var De=Me.buffer/Me.extent,ce=xe,Ie=fn(xe,1,-1-De,De,0,-1,2,Me),qe=fn(xe,1,1-De,2+De,0,-1,2,Me);return(Ie||qe)&&(ce=fn(xe,1,-De,1+De,0,-1,2,Me)||[],Ie&&(ce=Zr(Ie,1).concat(ce)),qe&&(ce=ce.concat(Zr(qe,-1)))),ce}(pe,Y)).length&&this.splitTile(pe,0,0,0),ie&&(pe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ui(X,Y,ie){return 32*((1<<X)*ie+Y)+X}function xo(X,Y){var ie=X.tileID.canonical;if(!this._geoJSONIndex)return Y(null,null);var pe=this._geoJSONIndex.getTile(ie.z,ie.x,ie.y);if(!pe)return Y(null,null);var xe=new pi(pe.features),Me=Fn(xe);Me.byteOffset===0&&Me.byteLength===Me.buffer.byteLength||(Me=new Uint8Array(Me)),Y(null,{vectorTile:xe,rawData:Me.buffer})}_r.prototype.load=function(X){var Y=this.options,ie=Y.log,pe=Y.minZoom,xe=Y.maxZoom,Me=Y.nodeSize;ie&&console.time("total time");var De="prepare "+X.length+" points";ie&&console.time(De),this.points=X;for(var ce=[],Ie=0;Ie<X.length;Ie++)X[Ie].geometry&&ce.push(Bi(X[Ie],Ie));this.trees[xe+1]=new Nn(ce,Gr,nn,Me,Float32Array),ie&&console.timeEnd(De);for(var qe=xe;qe>=pe;qe--){var Q=+Date.now();ce=this._cluster(ce,qe),this.trees[qe]=new Nn(ce,Gr,nn,Me,Float32Array),ie&&console.log("z%d: %d clusters in %dms",qe,ce.length,+Date.now()-Q)}return ie&&console.timeEnd("total time"),this},_r.prototype.getClusters=function(X,Y){var ie=((X[0]+180)%360+360)%360-180,pe=Math.max(-90,Math.min(90,X[1])),xe=X[2]===180?180:((X[2]+180)%360+360)%360-180,Me=Math.max(-90,Math.min(90,X[3]));if(X[2]-X[0]>=360)ie=-180,xe=180;else if(ie>xe){var De=this.getClusters([ie,pe,180,Me],Y),ce=this.getClusters([-180,pe,xe,Me],Y);return De.concat(ce)}for(var Ie=this.trees[this._limitZoom(Y)],qe=[],Q=0,F=Ie.range(jn(ie),ii(Me),jn(xe),ii(pe));Q<F.length;Q+=1){var U=Ie.points[F[Q]];qe.push(U.numPoints?so(U):this.points[U.index])}return qe},_r.prototype.getChildren=function(X){var Y=this._getOriginId(X),ie=this._getOriginZoom(X),pe="No cluster with the specified id.",xe=this.trees[ie];if(!xe)throw new Error(pe);var Me=xe.points[Y];if(!Me)throw new Error(pe);for(var De=this.options.radius/(this.options.extent*Math.pow(2,ie-1)),ce=[],Ie=0,qe=xe.within(Me.x,Me.y,De);Ie<qe.length;Ie+=1){var Q=xe.points[qe[Ie]];Q.parentId===X&&ce.push(Q.numPoints?so(Q):this.points[Q.index])}if(ce.length===0)throw new Error(pe);return ce},_r.prototype.getLeaves=function(X,Y,ie){var pe=[];return this._appendLeaves(pe,X,Y=Y||10,ie=ie||0,0),pe},_r.prototype.getTile=function(X,Y,ie){var pe=this.trees[this._limitZoom(X)],xe=Math.pow(2,X),Me=this.options,De=Me.radius/Me.extent,ce=(ie-De)/xe,Ie=(ie+1+De)/xe,qe={features:[]};return this._addTileFeatures(pe.range((Y-De)/xe,ce,(Y+1+De)/xe,Ie),pe.points,Y,ie,xe,qe),Y===0&&this._addTileFeatures(pe.range(1-De/xe,ce,1,Ie),pe.points,xe,ie,xe,qe),Y===xe-1&&this._addTileFeatures(pe.range(0,ce,De/xe,Ie),pe.points,-1,ie,xe,qe),qe.features.length?qe:null},_r.prototype.getClusterExpansionZoom=function(X){for(var Y=this._getOriginZoom(X)-1;Y<=this.options.maxZoom;){var ie=this.getChildren(X);if(Y++,ie.length!==1)break;X=ie[0].properties.cluster_id}return Y},_r.prototype._appendLeaves=function(X,Y,ie,pe,xe){for(var Me=0,De=this.getChildren(Y);Me<De.length;Me+=1){var ce=De[Me],Ie=ce.properties;if(Ie&&Ie.cluster?xe+Ie.point_count<=pe?xe+=Ie.point_count:xe=this._appendLeaves(X,Ie.cluster_id,ie,pe,xe):xe<pe?xe++:X.push(ce),X.length===ie)break}return xe},_r.prototype._addTileFeatures=function(X,Y,ie,pe,xe,Me){for(var De=0,ce=X;De<ce.length;De+=1){var Ie=Y[ce[De]],qe=Ie.numPoints,Q={type:1,geometry:[[Math.round(this.options.extent*(Ie.x*xe-ie)),Math.round(this.options.extent*(Ie.y*xe-pe))]],tags:qe?Uo(Ie):this.points[Ie.index].properties},F=void 0;qe?F=Ie.id:this.options.generateId?F=Ie.index:this.points[Ie.index].id&&(F=this.points[Ie.index].id),F!==void 0&&(Q.id=F),Me.features.push(Q)}},_r.prototype._limitZoom=function(X){return Math.max(this.options.minZoom,Math.min(+X,this.options.maxZoom+1))},_r.prototype._cluster=function(X,Y){for(var ie=[],pe=this.options,xe=pe.reduce,Me=pe.minPoints,De=pe.radius/(pe.extent*Math.pow(2,Y)),ce=0;ce<X.length;ce++){var Ie=X[ce];if(!(Ie.zoom<=Y)){Ie.zoom=Y;for(var qe=this.trees[Y+1],Q=qe.within(Ie.x,Ie.y,De),F=Ie.numPoints||1,U=F,J=0,ne=Q;J<ne.length;J+=1){var de=qe.points[ne[J]];de.zoom>Y&&(U+=de.numPoints||1)}if(U>=Me){for(var le=Ie.x*F,_e=Ie.y*F,ge=xe&&F>1?this._map(Ie,!0):null,ve=(ce<<5)+(Y+1)+this.points.length,Ge=0,Ue=Q;Ge<Ue.length;Ge+=1){var Ze=qe.points[Ue[Ge]];if(!(Ze.zoom<=Y)){Ze.zoom=Y;var bt=Ze.numPoints||1;le+=Ze.x*bt,_e+=Ze.y*bt,Ze.parentId=ve,xe&&(ge||(ge=this._map(Ie,!0)),xe(ge,this._map(Ze)))}}Ie.parentId=ve,ie.push(dn(le/U,_e/U,ve,U,ge))}else if(ie.push(Ie),U>1)for(var pt=0,vt=Q;pt<vt.length;pt+=1){var Et=qe.points[vt[pt]];Et.zoom<=Y||(Et.zoom=Y,ie.push(Et))}}}return ie},_r.prototype._getOriginId=function(X){return X-this.points.length>>5},_r.prototype._getOriginZoom=function(X){return(X-this.points.length)%32},_r.prototype._map=function(X,Y){if(X.numPoints)return Y?Mn({},X.properties):X.properties;var ie=this.points[X.index].properties,pe=this.options.map(ie);return Y&&pe===ie?Mn({},pe):pe},$r.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},$r.prototype.splitTile=function(X,Y,ie,pe,xe,Me,De){for(var ce=[X,Y,ie,pe],Ie=this.options,qe=Ie.debug;ce.length;){pe=ce.pop(),ie=ce.pop(),Y=ce.pop(),X=ce.pop();var Q=1<<Y,F=ui(Y,ie,pe),U=this.tiles[F];if(!U&&(qe>1&&console.time("creation"),U=this.tiles[F]=Ti(X,Y,ie,pe,Ie),this.tileCoords.push({z:Y,x:ie,y:pe}),qe)){qe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Y,ie,pe,U.numFeatures,U.numPoints,U.numSimplified),console.timeEnd("creation"));var J="z"+Y;this.stats[J]=(this.stats[J]||0)+1,this.total++}if(U.source=X,xe){if(Y===Ie.maxZoom||Y===xe)continue;var ne=1<<xe-Y;if(ie!==Math.floor(Me/ne)||pe!==Math.floor(De/ne))continue}else if(Y===Ie.indexMaxZoom||U.numPoints<=Ie.indexMaxPoints)continue;if(U.source=null,X.length!==0){qe>1&&console.time("clipping");var de,le,_e,ge,ve,Ge,Ue=.5*Ie.buffer/Ie.extent,Ze=.5-Ue,bt=.5+Ue,pt=1+Ue;de=le=_e=ge=null,ve=fn(X,Q,ie-Ue,ie+bt,0,U.minX,U.maxX,Ie),Ge=fn(X,Q,ie+Ze,ie+pt,0,U.minX,U.maxX,Ie),X=null,ve&&(de=fn(ve,Q,pe-Ue,pe+bt,1,U.minY,U.maxY,Ie),le=fn(ve,Q,pe+Ze,pe+pt,1,U.minY,U.maxY,Ie),ve=null),Ge&&(_e=fn(Ge,Q,pe-Ue,pe+bt,1,U.minY,U.maxY,Ie),ge=fn(Ge,Q,pe+Ze,pe+pt,1,U.minY,U.maxY,Ie),Ge=null),qe>1&&console.timeEnd("clipping"),ce.push(de||[],Y+1,2*ie,2*pe),ce.push(le||[],Y+1,2*ie,2*pe+1),ce.push(_e||[],Y+1,2*ie+1,2*pe),ce.push(ge||[],Y+1,2*ie+1,2*pe+1)}}},$r.prototype.getTile=function(X,Y,ie){var pe=this.options,xe=pe.extent,Me=pe.debug;if(X<0||X>24)return null;var De=1<<X,ce=ui(X,Y=(Y%De+De)%De,ie);if(this.tiles[ce])return er(this.tiles[ce],xe);Me>1&&console.log("drilling down to z%d-%d-%d",X,Y,ie);for(var Ie,qe=X,Q=Y,F=ie;!Ie&&qe>0;)qe--,Q=Math.floor(Q/2),F=Math.floor(F/2),Ie=this.tiles[ui(qe,Q,F)];return Ie&&Ie.source?(Me>1&&console.log("found parent tile z%d-%d-%d",qe,Q,F),Me>1&&console.time("drilling down"),this.splitTile(Ie.source,qe,Q,F,X,Y,ie),Me>1&&console.timeEnd("drilling down"),this.tiles[ce]?er(this.tiles[ce],xe):null):null};var Ln=function(X){function Y(ie,pe,xe,Me){X.call(this,ie,pe,xe,xo),Me&&(this.loadGeoJSON=Me)}return X&&(Y.__proto__=X),(Y.prototype=Object.create(X&&X.prototype)).constructor=Y,Y.prototype.loadData=function(ie,pe){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=pe,this._pendingLoadDataParams=ie,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},Y.prototype._loadData=function(){var ie=this;if(this._pendingCallback&&this._pendingLoadDataParams){var pe=this._pendingCallback,xe=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Me=!!(xe&&xe.request&&xe.request.collectResourceTiming)&&new y.RequestPerformance(xe.request);this.loadGeoJSON(xe,function(De,ce){if(De||!ce)return pe(De);if(typeof ce!="object")return pe(new Error("Input data given to '"+xe.source+"' is not a valid GeoJSON object."));(function U(J,ne){var de,le=J&&J.type;if(le==="FeatureCollection")for(de=0;de<J.features.length;de++)U(J.features[de],ne);else if(le==="GeometryCollection")for(de=0;de<J.geometries.length;de++)U(J.geometries[de],ne);else if(le==="Feature")U(J.geometry,ne);else if(le==="Polygon")Ei(J.coordinates,ne);else if(le==="MultiPolygon")for(de=0;de<J.coordinates.length;de++)Ei(J.coordinates[de],ne);return J})(ce,!0);try{if(xe.filter){var Ie=y.createExpression(xe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ie.result==="error")throw new Error(Ie.value.map(function(U){return U.key+": "+U.message}).join(", "));var qe=ce.features.filter(function(U){return Ie.value.evaluate({zoom:0},U)});ce={type:"FeatureCollection",features:qe}}ie._geoJSONIndex=xe.cluster?new _r(function(U){var J=U.superclusterOptions,ne=U.clusterProperties;if(!ne||!J)return J;for(var de={},le={},_e={accumulated:null,zoom:0},ge={properties:null},ve=Object.keys(ne),Ge=0,Ue=ve;Ge<Ue.length;Ge+=1){var Ze=Ue[Ge],bt=ne[Ze],pt=bt[0],vt=y.createExpression(bt[1]),Et=y.createExpression(typeof pt=="string"?[pt,["accumulated"],["get",Ze]]:pt);de[Ze]=vt.value,le[Ze]=Et.value}return J.map=function(di){ge.properties=di;for(var $t={},Jt=0,Nt=ve;Jt<Nt.length;Jt+=1){var Pt=Nt[Jt];$t[Pt]=de[Pt].evaluate(_e,ge)}return $t},J.reduce=function(di,$t){ge.properties=$t;for(var Jt=0,Nt=ve;Jt<Nt.length;Jt+=1){var Pt=Nt[Jt];_e.accumulated=di[Pt],di[Pt]=le[Pt].evaluate(_e,ge)}},J}(xe)).load(ce.features):function(U,J){return new $r(U,J)}(ce,xe.geojsonVtOptions)}catch(U){return pe(U)}ie.loaded={};var Q={};if(Me){var F=Me.finish();F&&(Q.resourceTiming={},Q.resourceTiming[xe.source]=JSON.parse(JSON.stringify(F)))}pe(null,Q)})}},Y.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},Y.prototype.reloadTile=function(ie,pe){var xe=this.loaded;return xe&&xe[ie.uid]?X.prototype.reloadTile.call(this,ie,pe):this.loadTile(ie,pe)},Y.prototype.loadGeoJSON=function(ie,pe){if(ie.request)y.getJSON(ie.request,pe);else{if(typeof ie.data!="string")return pe(new Error("Input data given to '"+ie.source+"' is not a valid GeoJSON object."));try{return pe(null,JSON.parse(ie.data))}catch{return pe(new Error("Input data given to '"+ie.source+"' is not a valid GeoJSON object."))}}},Y.prototype.removeSource=function(ie,pe){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),pe()},Y.prototype.getClusterExpansionZoom=function(ie,pe){try{pe(null,this._geoJSONIndex.getClusterExpansionZoom(ie.clusterId))}catch(xe){pe(xe)}},Y.prototype.getClusterChildren=function(ie,pe){try{pe(null,this._geoJSONIndex.getChildren(ie.clusterId))}catch(xe){pe(xe)}},Y.prototype.getClusterLeaves=function(ie,pe){try{pe(null,this._geoJSONIndex.getLeaves(ie.clusterId,ie.limit,ie.offset))}catch(xe){pe(xe)}},Y}(yt),Ji=function(X){var Y=this;this.self=X,this.actor=new y.Actor(X,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:yt,geojson:Ln},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(ie,pe){if(Y.workerSourceTypes[ie])throw new Error('Worker source with name "'+ie+'" already registered.');Y.workerSourceTypes[ie]=pe},this.self.registerRTLTextPlugin=function(ie){if(y.plugin.isParsed())throw new Error("RTL text plugin already registered.");y.plugin.applyArabicShaping=ie.applyArabicShaping,y.plugin.processBidirectionalText=ie.processBidirectionalText,y.plugin.processStyledBidirectionalText=ie.processStyledBidirectionalText}};return Ji.prototype.setReferrer=function(X,Y){this.referrer=Y},Ji.prototype.setImages=function(X,Y,ie){for(var pe in this.availableImages[X]=Y,this.workerSources[X]){var xe=this.workerSources[X][pe];for(var Me in xe)xe[Me].availableImages=Y}ie()},Ji.prototype.setLayers=function(X,Y,ie){this.getLayerIndex(X).replace(Y),ie()},Ji.prototype.updateLayers=function(X,Y,ie){this.getLayerIndex(X).update(Y.layers,Y.removedIds),ie()},Ji.prototype.loadTile=function(X,Y,ie){this.getWorkerSource(X,Y.type,Y.source).loadTile(Y,ie)},Ji.prototype.loadDEMTile=function(X,Y,ie){this.getDEMWorkerSource(X,Y.source).loadTile(Y,ie)},Ji.prototype.reloadTile=function(X,Y,ie){this.getWorkerSource(X,Y.type,Y.source).reloadTile(Y,ie)},Ji.prototype.abortTile=function(X,Y,ie){this.getWorkerSource(X,Y.type,Y.source).abortTile(Y,ie)},Ji.prototype.removeTile=function(X,Y,ie){this.getWorkerSource(X,Y.type,Y.source).removeTile(Y,ie)},Ji.prototype.removeDEMTile=function(X,Y){this.getDEMWorkerSource(X,Y.source).removeTile(Y)},Ji.prototype.removeSource=function(X,Y,ie){if(this.workerSources[X]&&this.workerSources[X][Y.type]&&this.workerSources[X][Y.type][Y.source]){var pe=this.workerSources[X][Y.type][Y.source];delete this.workerSources[X][Y.type][Y.source],pe.removeSource!==void 0?pe.removeSource(Y,ie):ie()}},Ji.prototype.loadWorkerSource=function(X,Y,ie){try{this.self.importScripts(Y.url),ie()}catch(pe){ie(pe.toString())}},Ji.prototype.syncRTLPluginState=function(X,Y,ie){try{y.plugin.setState(Y);var pe=y.plugin.getPluginURL();if(y.plugin.isLoaded()&&!y.plugin.isParsed()&&pe!=null){this.self.importScripts(pe);var xe=y.plugin.isParsed();ie(xe?void 0:new Error("RTL Text Plugin failed to import scripts from "+pe),xe)}}catch(Me){ie(Me.toString())}},Ji.prototype.getAvailableImages=function(X){var Y=this.availableImages[X];return Y||(Y=[]),Y},Ji.prototype.getLayerIndex=function(X){var Y=this.layerIndexes[X];return Y||(Y=this.layerIndexes[X]=new it),Y},Ji.prototype.getWorkerSource=function(X,Y,ie){var pe=this;return this.workerSources[X]||(this.workerSources[X]={}),this.workerSources[X][Y]||(this.workerSources[X][Y]={}),this.workerSources[X][Y][ie]||(this.workerSources[X][Y][ie]=new this.workerSourceTypes[Y]({send:function(xe,Me,De){pe.actor.send(xe,Me,De,X)}},this.getLayerIndex(X),this.getAvailableImages(X))),this.workerSources[X][Y][ie]},Ji.prototype.getDEMWorkerSource=function(X,Y){return this.demWorkerSources[X]||(this.demWorkerSources[X]={}),this.demWorkerSources[X][Y]||(this.demWorkerSources[X][Y]=new zt),this.demWorkerSources[X][Y]},Ji.prototype.enforceCacheSizeLimit=function(X,Y){y.enforceCacheSizeLimit(Y)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Ji(self)),Ji}),Ae(["./shared"],function(y){var x=y.createCommonjsModule(function(s){function c(S){return!u(S)}function u(S){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var z,B,q=new Blob([""],{type:"text/javascript"}),W=URL.createObjectURL(q);try{B=new Worker(W),z=!0}catch{z=!1}return B&&B.terminate(),URL.revokeObjectURL(W),z}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var z=document.createElement("canvas");z.width=z.height=1;var B=z.getContext("2d");if(!B)return!1;var q=B.getImageData(0,0,1,1);return q&&q.width===z.width}()?(f[A=S&&S.failIfMajorPerformanceCaveat]===void 0&&(f[A]=function(z){var B=function(W){var oe=document.createElement("canvas"),se=Object.create(c.webGLContextAttributes);return se.failIfMajorPerformanceCaveat=W,oe.probablySupportsContext?oe.probablySupportsContext("webgl",se)||oe.probablySupportsContext("experimental-webgl",se):oe.supportsContext?oe.supportsContext("webgl",se)||oe.supportsContext("experimental-webgl",se):oe.getContext("webgl",se)||oe.getContext("experimental-webgl",se)}(z);if(!B)return!1;var q=B.createShader(B.VERTEX_SHADER);return!(!q||B.isContextLost())&&(B.shaderSource(q,"void main() {}"),B.compileShader(q),B.getShaderParameter(q,B.COMPILE_STATUS)===!0)}(A)),f[A]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var A}s.exports?s.exports=c:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=c,window.mapboxgl.notSupportedReason=u);var f={};c.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),he={create:function(s,c,u){var f=y.window.document.createElement(s);return c!==void 0&&(f.className=c),u&&u.appendChild(f),f},createNS:function(s,c){return y.window.document.createElementNS(s,c)}},it=y.window.document&&y.window.document.documentElement.style;function Ke(s){if(!it)return s[0];for(var c=0;c<s.length;c++)if(s[c]in it)return s[c];return s[0]}var Qe,Se=Ke(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);he.disableDrag=function(){it&&Se&&(Qe=it[Se],it[Se]="none")},he.enableDrag=function(){it&&Se&&(it[Se]=Qe)};var It=Ke(["transform","WebkitTransform"]);he.setTransform=function(s,c){s.style[It]=c};var yt=!1;try{var ti=Object.defineProperty({},"passive",{get:function(){yt=!0}});y.window.addEventListener("test",ti,ti),y.window.removeEventListener("test",ti,ti)}catch{yt=!1}he.addEventListener=function(s,c,u,f){f===void 0&&(f={}),s.addEventListener(c,u,"passive"in f&&yt?f:f.capture)},he.removeEventListener=function(s,c,u,f){f===void 0&&(f={}),s.removeEventListener(c,u,"passive"in f&&yt?f:f.capture)};var zt=function(s){s.preventDefault(),s.stopPropagation(),y.window.removeEventListener("click",zt,!0)};function Ei(s){var c=s.userImage;return!!(c&&c.render&&c.render())&&(s.data.replace(new Uint8Array(c.data.buffer)),!0)}he.suppressClick=function(){y.window.addEventListener("click",zt,!0),y.window.setTimeout(function(){y.window.removeEventListener("click",zt,!0)},0)},he.mousePos=function(s,c){var u=s.getBoundingClientRect();return new y.Point(c.clientX-u.left-s.clientLeft,c.clientY-u.top-s.clientTop)},he.touchPos=function(s,c){for(var u=s.getBoundingClientRect(),f=[],S=0;S<c.length;S++)f.push(new y.Point(c[S].clientX-u.left-s.clientLeft,c[S].clientY-u.top-s.clientTop));return f},he.mouseButton=function(s){return y.window.InstallTrigger!==void 0&&s.button===2&&s.ctrlKey&&y.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:s.button},he.remove=function(s){s.parentNode&&s.parentNode.removeChild(s)};var mi=function(s){function c(){s.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new y.RGBAImage({width:1,height:1}),this.dirty=!0}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.isLoaded=function(){return this.loaded},c.prototype.setLoaded=function(u){if(this.loaded!==u&&(this.loaded=u,u)){for(var f=0,S=this.requestors;f<S.length;f+=1){var A=S[f];this._notify(A.ids,A.callback)}this.requestors=[]}},c.prototype.getImage=function(u){return this.images[u]},c.prototype.addImage=function(u,f){this._validate(u,f)&&(this.images[u]=f)},c.prototype._validate=function(u,f){var S=!0;return this._validateStretch(f.stretchX,f.data&&f.data.width)||(this.fire(new y.ErrorEvent(new Error('Image "'+u+'" has invalid "stretchX" value'))),S=!1),this._validateStretch(f.stretchY,f.data&&f.data.height)||(this.fire(new y.ErrorEvent(new Error('Image "'+u+'" has invalid "stretchY" value'))),S=!1),this._validateContent(f.content,f)||(this.fire(new y.ErrorEvent(new Error('Image "'+u+'" has invalid "content" value'))),S=!1),S},c.prototype._validateStretch=function(u,f){if(!u)return!0;for(var S=0,A=0,z=u;A<z.length;A+=1){var B=z[A];if(B[0]<S||B[1]<B[0]||f<B[1])return!1;S=B[1]}return!0},c.prototype._validateContent=function(u,f){return!(u&&(u.length!==4||u[0]<0||f.data.width<u[0]||u[1]<0||f.data.height<u[1]||u[2]<0||f.data.width<u[2]||u[3]<0||f.data.height<u[3]||u[2]<u[0]||u[3]<u[1]))},c.prototype.updateImage=function(u,f){f.version=this.images[u].version+1,this.images[u]=f,this.updatedImages[u]=!0},c.prototype.removeImage=function(u){var f=this.images[u];delete this.images[u],delete this.patterns[u],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()},c.prototype.listImages=function(){return Object.keys(this.images)},c.prototype.getImages=function(u,f){var S=!0;if(!this.isLoaded())for(var A=0,z=u;A<z.length;A+=1)this.images[z[A]]||(S=!1);this.isLoaded()||S?this._notify(u,f):this.requestors.push({ids:u,callback:f})},c.prototype._notify=function(u,f){for(var S={},A=0,z=u;A<z.length;A+=1){var B=z[A];this.images[B]||this.fire(new y.Event("styleimagemissing",{id:B}));var q=this.images[B];q?S[B]={data:q.data.clone(),pixelRatio:q.pixelRatio,sdf:q.sdf,version:q.version,stretchX:q.stretchX,stretchY:q.stretchY,content:q.content,hasRenderCallback:Boolean(q.userImage&&q.userImage.render)}:y.warnOnce('Image "'+B+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}f(null,S)},c.prototype.getPixelSize=function(){var u=this.atlasImage;return{width:u.width,height:u.height}},c.prototype.getPattern=function(u){var f=this.patterns[u],S=this.getImage(u);if(!S)return null;if(f&&f.position.version===S.version)return f.position;if(f)f.position.version=S.version;else{var A={w:S.data.width+2,h:S.data.height+2,x:0,y:0},z=new y.ImagePosition(A,S);this.patterns[u]={bin:A,position:z}}return this._updatePatternAtlas(),this.patterns[u].position},c.prototype.bind=function(u){var f=u.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new y.Texture(u,this.atlasImage,f.RGBA),this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)},c.prototype._updatePatternAtlas=function(){var u=[];for(var f in this.patterns)u.push(this.patterns[f].bin);var S=y.potpack(u),A=S.w,z=S.h,B=this.atlasImage;for(var q in B.resize({width:A||1,height:z||1}),this.patterns){var W=this.patterns[q].bin,oe=W.x+1,se=W.y+1,ue=this.images[q].data,Ee=ue.width,be=ue.height;y.RGBAImage.copy(ue,B,{x:0,y:0},{x:oe,y:se},{width:Ee,height:be}),y.RGBAImage.copy(ue,B,{x:0,y:be-1},{x:oe,y:se-1},{width:Ee,height:1}),y.RGBAImage.copy(ue,B,{x:0,y:0},{x:oe,y:se+be},{width:Ee,height:1}),y.RGBAImage.copy(ue,B,{x:Ee-1,y:0},{x:oe-1,y:se},{width:1,height:be}),y.RGBAImage.copy(ue,B,{x:0,y:0},{x:oe+Ee,y:se},{width:1,height:be})}this.dirty=!0},c.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},c.prototype.dispatchRenderCallbacks=function(u){for(var f=0,S=u;f<S.length;f+=1){var A=S[f];if(!this.callbackDispatchedThisFrame[A]){this.callbackDispatchedThisFrame[A]=!0;var z=this.images[A];Ei(z)&&this.updateImage(A,z)}}},c}(y.Evented),Ht=Si,br=Si,pi=1e20;function Si(s,c,u,f,S,A){this.fontSize=s||24,this.buffer=c===void 0?3:c,this.cutoff=f||.25,this.fontFamily=S||"sans-serif",this.fontWeight=A||"normal",this.radius=u||8;var z=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=z,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(z*z),this.gridInner=new Float64Array(z*z),this.f=new Float64Array(z),this.d=new Float64Array(z),this.z=new Float64Array(z+1),this.v=new Int16Array(z),this.middle=Math.round(z/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Ni(s,c,u,f,S,A,z){for(var B=0;B<c;B++){for(var q=0;q<u;q++)f[q]=s[q*c+B];for(Lr(f,S,A,z,u),q=0;q<u;q++)s[q*c+B]=S[q]}for(q=0;q<u;q++){for(B=0;B<c;B++)f[B]=s[q*c+B];for(Lr(f,S,A,z,c),B=0;B<c;B++)s[q*c+B]=Math.sqrt(S[B])}}function Lr(s,c,u,f,S){u[0]=0,f[0]=-pi,f[1]=+pi;for(var A=1,z=0;A<S;A++){for(var B=(s[A]+A*A-(s[u[z]]+u[z]*u[z]))/(2*A-2*u[z]);B<=f[z];)z--,B=(s[A]+A*A-(s[u[z]]+u[z]*u[z]))/(2*A-2*u[z]);u[++z]=A,f[z]=B,f[z+1]=+pi}for(A=0,z=0;A<S;A++){for(;f[z+1]<A;)z++;c[A]=(A-u[z])*(A-u[z])+s[u[z]]}}Si.prototype.draw=function(s){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(s,this.buffer,this.middle);for(var c=this.ctx.getImageData(0,0,this.size,this.size),u=new Uint8ClampedArray(this.size*this.size),f=0;f<this.size*this.size;f++){var S=c.data[4*f+3]/255;this.gridOuter[f]=S===1?0:S===0?pi:Math.pow(Math.max(0,.5-S),2),this.gridInner[f]=S===1?pi:S===0?0:Math.pow(Math.max(0,S-.5),2)}for(Ni(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Ni(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),f=0;f<this.size*this.size;f++)u[f]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[f]-this.gridInner[f])/this.radius+this.cutoff))));return u},Ht.default=br;var lr=function(s,c){this.requestManager=s,this.localIdeographFontFamily=c,this.entries={}};lr.prototype.setURL=function(s){this.url=s},lr.prototype.getGlyphs=function(s,c){var u=this,f=[];for(var S in s)for(var A=0,z=s[S];A<z.length;A+=1)f.push({stack:S,id:z[A]});y.asyncAll(f,function(B,q){var W=B.stack,oe=B.id,se=u.entries[W];se||(se=u.entries[W]={glyphs:{},requests:{},ranges:{}});var ue=se.glyphs[oe];if(ue===void 0){if(ue=u._tinySDF(se,W,oe))return se.glyphs[oe]=ue,void q(null,{stack:W,id:oe,glyph:ue});var Ee=Math.floor(oe/256);if(256*Ee>65535)q(new Error("glyphs > 65535 not supported"));else if(se.ranges[Ee])q(null,{stack:W,id:oe,glyph:ue});else{var be=se.requests[Ee];be||(be=se.requests[Ee]=[],lr.loadGlyphRange(W,Ee,u.url,u.requestManager,function(Ce,me){if(me){for(var Te in me)u._doesCharSupportLocalGlyph(+Te)||(se.glyphs[+Te]=me[+Te]);se.ranges[Ee]=!0}for(var Le=0,Ne=be;Le<Ne.length;Le+=1)(0,Ne[Le])(Ce,me);delete se.requests[Ee]})),be.push(function(Ce,me){Ce?q(Ce):me&&q(null,{stack:W,id:oe,glyph:me[oe]||null})})}}else q(null,{stack:W,id:oe,glyph:ue})},function(B,q){if(B)c(B);else if(q){for(var W={},oe=0,se=q;oe<se.length;oe+=1){var ue=se[oe],Ee=ue.stack,be=ue.id,Ce=ue.glyph;(W[Ee]||(W[Ee]={}))[be]=Ce&&{id:Ce.id,bitmap:Ce.bitmap.clone(),metrics:Ce.metrics}}c(null,W)}})},lr.prototype._doesCharSupportLocalGlyph=function(s){return!!this.localIdeographFontFamily&&(y.isChar["CJK Unified Ideographs"](s)||y.isChar["Hangul Syllables"](s)||y.isChar.Hiragana(s)||y.isChar.Katakana(s))},lr.prototype._tinySDF=function(s,c,u){var f=this.localIdeographFontFamily;if(f&&this._doesCharSupportLocalGlyph(u)){var S=s.tinySDF;if(!S){var A="400";/bold/i.test(c)?A="900":/medium/i.test(c)?A="500":/light/i.test(c)&&(A="200"),S=s.tinySDF=new lr.TinySDF(24,3,8,.25,f,A)}return{id:u,bitmap:new y.AlphaImage({width:30,height:30},S.draw(String.fromCharCode(u))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},lr.loadGlyphRange=function(s,c,u,f,S){var A=256*c,z=A+255,B=f.transformRequest(f.normalizeGlyphsURL(u).replace("{fontstack}",s).replace("{range}",A+"-"+z),y.ResourceType.Glyphs);y.getArrayBuffer(B,function(q,W){if(q)S(q);else if(W){for(var oe={},se=0,ue=y.parseGlyphPBF(W);se<ue.length;se+=1){var Ee=ue[se];oe[Ee.id]=Ee}S(null,oe)}})},lr.TinySDF=Ht;var Fn=function(){this.specification=y.styleSpec.light.position};Fn.prototype.possiblyEvaluate=function(s,c){return y.sphericalToCartesian(s.expression.evaluate(c))},Fn.prototype.interpolate=function(s,c,u){return{x:y.number(s.x,c.x,u),y:y.number(s.y,c.y,u),z:y.number(s.z,c.z,u)}};var hn=new y.Properties({anchor:new y.DataConstantProperty(y.styleSpec.light.anchor),position:new Fn,color:new y.DataConstantProperty(y.styleSpec.light.color),intensity:new y.DataConstantProperty(y.styleSpec.light.intensity)}),no=function(s){function c(u){s.call(this),this._transitionable=new y.Transitionable(hn),this.setLight(u),this._transitioning=this._transitionable.untransitioned()}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getLight=function(){return this._transitionable.serialize()},c.prototype.setLight=function(u,f){if(f===void 0&&(f={}),!this._validate(y.validateLight,u,f))for(var S in u){var A=u[S];y.endsWith(S,"-transition")?this._transitionable.setTransition(S.slice(0,-11),A):this._transitionable.setValue(S,A)}},c.prototype.updateTransitions=function(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)},c.prototype.hasTransition=function(){return this._transitioning.hasTransition()},c.prototype.recalculate=function(u){this.properties=this._transitioning.possiblyEvaluate(u)},c.prototype._validate=function(u,f,S){return(!S||S.validate!==!1)&&y.emitValidationErrors(this,u.call(y.validateStyle,y.extend({value:f,style:{glyphs:!0,sprite:!0},styleSpec:y.styleSpec})))},c}(y.Evented),nr=function(s,c){this.width=s,this.height=c,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};nr.prototype.getDash=function(s,c){var u=s.join(",")+String(c);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(s,c)),this.dashEntry[u]},nr.prototype.getDashRanges=function(s,c,u){var f=[],S=s.length%2==1?-s[s.length-1]*u:0,A=s[0]*u,z=!0;f.push({left:S,right:A,isDash:z,zeroLength:s[0]===0});for(var B=s[0],q=1;q<s.length;q++){var W=s[q];f.push({left:S=B*u,right:A=(B+=W)*u,isDash:z=!z,zeroLength:W===0})}return f},nr.prototype.addRoundDash=function(s,c,u){for(var f=c/2,S=-u;S<=u;S++)for(var A=this.width*(this.nextRow+u+S),z=0,B=s[z],q=0;q<this.width;q++){q/B.right>1&&(B=s[++z]);var W=Math.abs(q-B.left),oe=Math.abs(q-B.right),se=Math.min(W,oe),ue=void 0,Ee=S/u*(f+1);if(B.isDash){var be=f-Math.abs(Ee);ue=Math.sqrt(se*se+be*be)}else ue=f-Math.sqrt(se*se+Ee*Ee);this.data[A+q]=Math.max(0,Math.min(255,ue+128))}},nr.prototype.addRegularDash=function(s){for(var c=s.length-1;c>=0;--c){var u=s[c],f=s[c+1];u.zeroLength?s.splice(c,1):f&&f.isDash===u.isDash&&(f.left=u.left,s.splice(c,1))}var S=s[0],A=s[s.length-1];S.isDash===A.isDash&&(S.left=A.left-this.width,A.right=S.right+this.width);for(var z=this.width*this.nextRow,B=0,q=s[B],W=0;W<this.width;W++){W/q.right>1&&(q=s[++B]);var oe=Math.abs(W-q.left),se=Math.abs(W-q.right),ue=Math.min(oe,se);this.data[z+W]=Math.max(0,Math.min(255,(q.isDash?ue:-ue)+128))}},nr.prototype.addDash=function(s,c){var u=c?7:0,f=2*u+1;if(this.nextRow+f>this.height)return y.warnOnce("LineAtlas out of space"),null;for(var S=0,A=0;A<s.length;A++)S+=s[A];if(S!==0){var z=this.width/S,B=this.getDashRanges(s,this.width,z);c?this.addRoundDash(B,z,u):this.addRegularDash(B)}var q={y:(this.nextRow+u+.5)/this.height,height:2*u/this.height,width:S};return this.nextRow+=f,this.dirty=!0,q},nr.prototype.bind=function(s){var c=s.gl;this.texture?(c.bindTexture(c.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,c.texSubImage2D(c.TEXTURE_2D,0,0,0,this.width,this.height,c.ALPHA,c.UNSIGNED_BYTE,this.data))):(this.texture=c.createTexture(),c.bindTexture(c.TEXTURE_2D,this.texture),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texImage2D(c.TEXTURE_2D,0,c.ALPHA,this.width,this.height,0,c.ALPHA,c.UNSIGNED_BYTE,this.data))};var Ar=function s(c,u){this.workerPool=c,this.actors=[],this.currentActor=0,this.id=y.uniqueId();for(var f=this.workerPool.acquire(this.id),S=0;S<f.length;S++){var A=new s.Actor(f[S],u,this.id);A.name="Worker "+S,this.actors.push(A)}};function Fo(s,c,u){var f=function(S,A){if(S)return u(S);if(A){var z=y.pick(y.extend(A,s),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);A.vector_layers&&(z.vectorLayers=A.vector_layers,z.vectorLayerIds=z.vectorLayers.map(function(B){return B.id})),z.tiles=c.canonicalizeTileset(z,s.url),u(null,z)}};return s.url?y.getJSON(c.transformRequest(c.normalizeSourceURL(s.url),y.ResourceType.Source),f):y.browser.frame(function(){return f(null,s)})}Ar.prototype.broadcast=function(s,c,u){y.asyncAll(this.actors,function(f,S){f.send(s,c,S)},u=u||function(){})},Ar.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Ar.prototype.remove=function(){this.actors.forEach(function(s){s.remove()}),this.actors=[],this.workerPool.release(this.id)},Ar.Actor=y.Actor;var Yt=function(s,c,u){this.bounds=y.LngLatBounds.convert(this.validateBounds(s)),this.minzoom=c||0,this.maxzoom=u||24};Yt.prototype.validateBounds=function(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]},Yt.prototype.contains=function(s){var c=Math.pow(2,s.z),u=Math.floor(y.mercatorXfromLng(this.bounds.getWest())*c),f=Math.floor(y.mercatorYfromLat(this.bounds.getNorth())*c),S=Math.ceil(y.mercatorXfromLng(this.bounds.getEast())*c),A=Math.ceil(y.mercatorYfromLat(this.bounds.getSouth())*c);return s.x>=u&&s.x<S&&s.y>=f&&s.y<A};var Un=function(s){function c(u,f,S,A){if(s.call(this),this.id=u,this.dispatcher=S,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,y.extend(this,y.pick(f,["url","scheme","tileSize","promoteId"])),this._options=y.extend({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(A)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.load=function(){var u=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Fo(this._options,this.map._requestManager,function(f,S){u._tileJSONRequest=null,u._loaded=!0,f?u.fire(new y.ErrorEvent(f)):S&&(y.extend(u,S),S.bounds&&(u.tileBounds=new Yt(S.bounds,u.minzoom,u.maxzoom)),y.postTurnstileEvent(S.tiles,u.map._requestManager._customAccessToken),y.postMapLoadEvent(S.tiles,u.map._getMapId(),u.map._requestManager._skuToken,u.map._requestManager._customAccessToken),u.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),u.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},c.prototype.loaded=function(){return this._loaded},c.prototype.hasTile=function(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)},c.prototype.onAdd=function(u){this.map=u,this.load()},c.prototype.setSourceProperty=function(u){this._tileJSONRequest&&this._tileJSONRequest.cancel(),u(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},c.prototype.setTiles=function(u){var f=this;return this.setSourceProperty(function(){f._options.tiles=u}),this},c.prototype.setUrl=function(u){var f=this;return this.setSourceProperty(function(){f.url=u,f._options.url=u}),this},c.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},c.prototype.serialize=function(){return y.extend({},this._options)},c.prototype.loadTile=function(u,f){var S=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme)),A={request:this.map._requestManager.transformRequest(S,y.ResourceType.Tile),uid:u.uid,tileID:u.tileID,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function z(B,q){return delete u.request,u.aborted?f(null):B&&B.status!==404?f(B):(q&&q.resourceTiming&&(u.resourceTiming=q.resourceTiming),this.map._refreshExpiredTiles&&q&&u.setExpiryData(q),u.loadVectorData(q,this.map.painter),y.cacheEntryPossiblyAdded(this.dispatcher),f(null),void(u.reloadCallback&&(this.loadTile(u,u.reloadCallback),u.reloadCallback=null)))}A.request.collectResourceTiming=this._collectResourceTiming,u.actor&&u.state!=="expired"?u.state==="loading"?u.reloadCallback=f:u.request=u.actor.send("reloadTile",A,z.bind(this)):(u.actor=this.dispatcher.getActor(),u.request=u.actor.send("loadTile",A,z.bind(this)))},c.prototype.abortTile=function(u){u.request&&(u.request.cancel(),delete u.request),u.actor&&u.actor.send("abortTile",{uid:u.uid,type:this.type,source:this.id},void 0)},c.prototype.unloadTile=function(u){u.unloadVectorData(),u.actor&&u.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id},void 0)},c.prototype.hasTransition=function(){return!1},c}(y.Evented),oo=function(s){function c(u,f,S,A){s.call(this),this.id=u,this.dispatcher=S,this.setEventedParent(A),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=y.extend({type:"raster"},f),y.extend(this,y.pick(f,["url","scheme","tileSize"]))}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.load=function(){var u=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Fo(this._options,this.map._requestManager,function(f,S){u._tileJSONRequest=null,u._loaded=!0,f?u.fire(new y.ErrorEvent(f)):S&&(y.extend(u,S),S.bounds&&(u.tileBounds=new Yt(S.bounds,u.minzoom,u.maxzoom)),y.postTurnstileEvent(S.tiles),y.postMapLoadEvent(S.tiles,u.map._getMapId(),u.map._requestManager._skuToken),u.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})),u.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})))})},c.prototype.loaded=function(){return this._loaded},c.prototype.onAdd=function(u){this.map=u,this.load()},c.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},c.prototype.serialize=function(){return y.extend({},this._options)},c.prototype.hasTile=function(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)},c.prototype.loadTile=function(u,f){var S=this,A=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);u.request=y.getImage(this.map._requestManager.transformRequest(A,y.ResourceType.Tile),function(z,B){if(delete u.request,u.aborted)u.state="unloaded",f(null);else if(z)u.state="errored",f(z);else if(B){S.map._refreshExpiredTiles&&u.setExpiryData(B),delete B.cacheControl,delete B.expires;var q=S.map.painter.context,W=q.gl;u.texture=S.map.painter.getTileTexture(B.width),u.texture?u.texture.update(B,{useMipmap:!0}):(u.texture=new y.Texture(q,B,W.RGBA,{useMipmap:!0}),u.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE,W.LINEAR_MIPMAP_NEAREST),q.extTextureFilterAnisotropic&&W.texParameterf(W.TEXTURE_2D,q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,q.extTextureFilterAnisotropicMax)),u.state="loaded",y.cacheEntryPossiblyAdded(S.dispatcher),f(null)}})},c.prototype.abortTile=function(u,f){u.request&&(u.request.cancel(),delete u.request),f()},c.prototype.unloadTile=function(u,f){u.texture&&this.map.painter.saveTileTexture(u.texture),f()},c.prototype.hasTransition=function(){return!1},c}(y.Evented),Co=function(s){function c(u,f,S,A){s.call(this,u,f,S,A),this.type="raster-dem",this.maxzoom=22,this._options=y.extend({type:"raster-dem"},f),this.encoding=f.encoding||"mapbox"}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},c.prototype.loadTile=function(u,f){var S=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function A(z,B){z&&(u.state="errored",f(z)),B&&(u.dem=B,u.needsHillshadePrepare=!0,u.state="loaded",f(null))}u.request=y.getImage(this.map._requestManager.transformRequest(S,y.ResourceType.Tile),function(z,B){if(delete u.request,u.aborted)u.state="unloaded",f(null);else if(z)u.state="errored",f(z);else if(B){this.map._refreshExpiredTiles&&u.setExpiryData(B),delete B.cacheControl,delete B.expires;var q=y.window.ImageBitmap&&B instanceof y.window.ImageBitmap&&y.offscreenCanvasSupported()?B:y.browser.getImageData(B,1),W={uid:u.uid,coord:u.tileID,source:this.id,rawImageData:q,encoding:this.encoding};u.actor&&u.state!=="expired"||(u.actor=this.dispatcher.getActor(),u.actor.send("loadDEMTile",W,A.bind(this)))}}.bind(this)),u.neighboringTiles=this._getNeighboringTiles(u.tileID)},c.prototype._getNeighboringTiles=function(u){var f=u.canonical,S=Math.pow(2,f.z),A=(f.x-1+S)%S,z=f.x===0?u.wrap-1:u.wrap,B=(f.x+1+S)%S,q=f.x+1===S?u.wrap+1:u.wrap,W={};return W[new y.OverscaledTileID(u.overscaledZ,z,f.z,A,f.y).key]={backfilled:!1},W[new y.OverscaledTileID(u.overscaledZ,q,f.z,B,f.y).key]={backfilled:!1},f.y>0&&(W[new y.OverscaledTileID(u.overscaledZ,z,f.z,A,f.y-1).key]={backfilled:!1},W[new y.OverscaledTileID(u.overscaledZ,u.wrap,f.z,f.x,f.y-1).key]={backfilled:!1},W[new y.OverscaledTileID(u.overscaledZ,q,f.z,B,f.y-1).key]={backfilled:!1}),f.y+1<S&&(W[new y.OverscaledTileID(u.overscaledZ,z,f.z,A,f.y+1).key]={backfilled:!1},W[new y.OverscaledTileID(u.overscaledZ,u.wrap,f.z,f.x,f.y+1).key]={backfilled:!1},W[new y.OverscaledTileID(u.overscaledZ,q,f.z,B,f.y+1).key]={backfilled:!1}),W},c.prototype.unloadTile=function(u){u.demTexture&&this.map.painter.saveTileTexture(u.demTexture),u.fbo&&(u.fbo.destroy(),delete u.fbo),u.dem&&delete u.dem,delete u.neighboringTiles,u.state="unloaded",u.actor&&u.actor.send("removeDEMTile",{uid:u.uid,source:this.id})},c}(oo),rn=function(s){function c(u,f,S,A){s.call(this),this.id=u,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=S.getActor(),this.setEventedParent(A),this._data=f.data,this._options=y.extend({},f),this._collectResourceTiming=f.collectResourceTiming,this._resourceTiming=[],f.maxzoom!==void 0&&(this.maxzoom=f.maxzoom),f.type&&(this.type=f.type),f.attribution&&(this.attribution=f.attribution),this.promoteId=f.promoteId;var z=y.EXTENT/this.tileSize;this.workerOptions=y.extend({source:this.id,cluster:f.cluster||!1,geojsonVtOptions:{buffer:(f.buffer!==void 0?f.buffer:128)*z,tolerance:(f.tolerance!==void 0?f.tolerance:.375)*z,extent:y.EXTENT,maxZoom:this.maxzoom,lineMetrics:f.lineMetrics||!1,generateId:f.generateId||!1},superclusterOptions:{maxZoom:f.clusterMaxZoom!==void 0?Math.min(f.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,f.clusterMinPoints||2),extent:y.EXTENT,radius:(f.clusterRadius||50)*z,log:!1,generateId:f.generateId||!1},clusterProperties:f.clusterProperties,filter:f.filter},f.workerOptions)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.load=function(){var u=this;this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(f){if(f)u.fire(new y.ErrorEvent(f));else{var S={dataType:"source",sourceDataType:"metadata"};u._collectResourceTiming&&u._resourceTiming&&u._resourceTiming.length>0&&(S.resourceTiming=u._resourceTiming,u._resourceTiming=[]),u.fire(new y.Event("data",S))}})},c.prototype.onAdd=function(u){this.map=u,this.load()},c.prototype.setData=function(u){var f=this;return this._data=u,this.fire(new y.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(S){if(S)f.fire(new y.ErrorEvent(S));else{var A={dataType:"source",sourceDataType:"content"};f._collectResourceTiming&&f._resourceTiming&&f._resourceTiming.length>0&&(A.resourceTiming=f._resourceTiming,f._resourceTiming=[]),f.fire(new y.Event("data",A))}}),this},c.prototype.getClusterExpansionZoom=function(u,f){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:u,source:this.id},f),this},c.prototype.getClusterChildren=function(u,f){return this.actor.send("geojson.getClusterChildren",{clusterId:u,source:this.id},f),this},c.prototype.getClusterLeaves=function(u,f,S,A){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:u,limit:f,offset:S},A),this},c.prototype._updateWorkerData=function(u){var f=this;this._loaded=!1;var S=y.extend({},this.workerOptions),A=this._data;typeof A=="string"?(S.request=this.map._requestManager.transformRequest(y.browser.resolveURL(A),y.ResourceType.Source),S.request.collectResourceTiming=this._collectResourceTiming):S.data=JSON.stringify(A),this.actor.send(this.type+".loadData",S,function(z,B){f._removed||B&&B.abandoned||(f._loaded=!0,B&&B.resourceTiming&&B.resourceTiming[f.id]&&(f._resourceTiming=B.resourceTiming[f.id].slice(0)),f.actor.send(f.type+".coalesce",{source:S.source},null),u(z))})},c.prototype.loaded=function(){return this._loaded},c.prototype.loadTile=function(u,f){var S=this,A=u.actor?"reloadTile":"loadTile";u.actor=this.actor,u.request=this.actor.send(A,{type:this.type,uid:u.uid,tileID:u.tileID,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:y.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(z,B){return delete u.request,u.unloadVectorData(),u.aborted?f(null):z?f(z):(u.loadVectorData(B,S.map.painter,A==="reloadTile"),f(null))})},c.prototype.abortTile=function(u){u.request&&(u.request.cancel(),delete u.request),u.aborted=!0},c.prototype.unloadTile=function(u){u.unloadVectorData(),this.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id})},c.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},c.prototype.serialize=function(){return y.extend({},this._options,{type:this.type,data:this._data})},c.prototype.hasTransition=function(){return!1},c}(y.Evented),pn=y.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),bn=function(s){function c(u,f,S,A){s.call(this),this.id=u,this.dispatcher=S,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(A),this.options=f}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.load=function(u,f){var S=this;this._loaded=!1,this.fire(new y.Event("dataloading",{dataType:"source"})),this.url=this.options.url,y.getImage(this.map._requestManager.transformRequest(this.url,y.ResourceType.Image),function(A,z){S._loaded=!0,A?S.fire(new y.ErrorEvent(A)):z&&(S.image=z,u&&(S.coordinates=u),f&&f(),S._finishLoading())})},c.prototype.loaded=function(){return this._loaded},c.prototype.updateImage=function(u){var f=this;return this.image&&u.url?(this.options.url=u.url,this.load(u.coordinates,function(){f.texture=null}),this):this},c.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"metadata"})))},c.prototype.onAdd=function(u){this.map=u,this.load()},c.prototype.setCoordinates=function(u){var f=this;this.coordinates=u;var S=u.map(y.MercatorCoordinate.fromLngLat);this.tileID=function(z){for(var B=1/0,q=1/0,W=-1/0,oe=-1/0,se=0,ue=z;se<ue.length;se+=1){var Ee=ue[se];B=Math.min(B,Ee.x),q=Math.min(q,Ee.y),W=Math.max(W,Ee.x),oe=Math.max(oe,Ee.y)}var be=Math.max(W-B,oe-q),Ce=Math.max(0,Math.floor(-Math.log(be)/Math.LN2)),me=Math.pow(2,Ce);return new y.CanonicalTileID(Ce,Math.floor((B+W)/2*me),Math.floor((q+oe)/2*me))}(S),this.minzoom=this.maxzoom=this.tileID.z;var A=S.map(function(z){return f.tileID.getTilePoint(z)._round()});return this._boundsArray=new y.StructArrayLayout4i8,this._boundsArray.emplaceBack(A[0].x,A[0].y,0,0),this._boundsArray.emplaceBack(A[1].x,A[1].y,y.EXTENT,0),this._boundsArray.emplaceBack(A[3].x,A[3].y,0,y.EXTENT),this._boundsArray.emplaceBack(A[2].x,A[2].y,y.EXTENT,y.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new y.Event("data",{dataType:"source",sourceDataType:"content"})),this},c.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var u=this.map.painter.context,f=u.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=u.createVertexBuffer(this._boundsArray,pn.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new y.Texture(u,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE)),this.tiles){var A=this.tiles[S];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture)}}},c.prototype.loadTile=function(u,f){this.tileID&&this.tileID.equals(u.tileID.canonical)?(this.tiles[String(u.tileID.wrap)]=u,u.buckets={},f(null)):(u.state="errored",f(null))},c.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},c.prototype.hasTransition=function(){return!1},c}(y.Evented),kn=function(s){function c(u,f,S,A){s.call(this,u,f,S,A),this.roundZoom=!0,this.type="video",this.options=f}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.load=function(){var u=this;this._loaded=!1;var f=this.options;this.urls=[];for(var S=0,A=f.urls;S<A.length;S+=1)this.urls.push(this.map._requestManager.transformRequest(A[S],y.ResourceType.Source).url);y.getVideo(this.urls,function(z,B){u._loaded=!0,z?u.fire(new y.ErrorEvent(z)):B&&(u.video=B,u.video.loop=!0,u.video.addEventListener("playing",function(){u.map.triggerRepaint()}),u.map&&u.video.play(),u._finishLoading())})},c.prototype.pause=function(){this.video&&this.video.pause()},c.prototype.play=function(){this.video&&this.video.play()},c.prototype.seek=function(u){if(this.video){var f=this.video.seekable;u<f.start(0)||u>f.end(0)?this.fire(new y.ErrorEvent(new y.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+f.start(0)+" and "+f.end(0)+"-second mark."))):this.video.currentTime=u}},c.prototype.getVideo=function(){return this.video},c.prototype.onAdd=function(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},c.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var u=this.map.painter.context,f=u.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=u.createVertexBuffer(this._boundsArray,pn.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE),f.texSubImage2D(f.TEXTURE_2D,0,0,0,f.RGBA,f.UNSIGNED_BYTE,this.video)):(this.texture=new y.Texture(u,this.video,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE)),this.tiles){var A=this.tiles[S];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture)}}},c.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},c.prototype.hasTransition=function(){return this.video&&!this.video.paused},c}(bn),Vn=function(s){function c(u,f,S,A){s.call(this,u,f,S,A),f.coordinates?Array.isArray(f.coordinates)&&f.coordinates.length===4&&!f.coordinates.some(function(z){return!Array.isArray(z)||z.length!==2||z.some(function(B){return typeof B!="number"})})||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+u,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+u,null,'missing required property "coordinates"'))),f.animate&&typeof f.animate!="boolean"&&this.fire(new y.ErrorEvent(new y.ValidationError("sources."+u,null,'optional "animate" property must be a boolean value'))),f.canvas?typeof f.canvas=="string"||f.canvas instanceof y.window.HTMLCanvasElement||this.fire(new y.ErrorEvent(new y.ValidationError("sources."+u,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new y.ErrorEvent(new y.ValidationError("sources."+u,null,'missing required property "canvas"'))),this.options=f,this.animate=f.animate===void 0||f.animate}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof y.window.HTMLCanvasElement?this.options.canvas:y.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new y.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},c.prototype.getCanvas=function(){return this.canvas},c.prototype.onAdd=function(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()},c.prototype.onRemove=function(){this.pause()},c.prototype.prepare=function(){var u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var f=this.map.painter.context,S=f.gl;for(var A in this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,pn.members)),this.boundsSegments||(this.boundsSegments=y.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(u||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new y.Texture(f,this.canvas,S.RGBA,{premultiply:!0}),this.tiles){var z=this.tiles[A];z.state!=="loaded"&&(z.state="loaded",z.texture=this.texture)}}},c.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},c.prototype.hasTransition=function(){return this._playing},c.prototype._hasInvalidDimensions=function(){for(var u=0,f=[this.canvas.width,this.canvas.height];u<f.length;u+=1){var S=f[u];if(isNaN(S)||S<=0)return!0}return!1},c}(bn),Nn={vector:Un,raster:oo,"raster-dem":Co,geojson:rn,video:kn,image:bn,canvas:Vn};function ao(s,c){var u=y.identity([]);return y.translate(u,u,[1,1,0]),y.scale(u,u,[.5*s.width,.5*s.height,1]),y.multiply(u,u,s.calculatePosMatrix(c.toUnwrapped()))}function _r(s,c,u,f,S,A){var z=function(Ce,me,Te){if(Ce)for(var Le=0,Ne=Ce;Le<Ne.length;Le+=1){var We=me[Ne[Le]];if(We&&We.source===Te&&We.type==="fill-extrusion")return!0}else for(var He in me){var Je=me[He];if(Je.source===Te&&Je.type==="fill-extrusion")return!0}return!1}(S&&S.layers,c,s.id),B=A.maxPitchScaleFactor(),q=s.tilesIn(f,B,z);q.sort(dn);for(var W=[],oe=0,se=q;oe<se.length;oe+=1){var ue=se[oe];W.push({wrappedTileID:ue.tileID.wrapped().key,queryResults:ue.tile.queryRenderedFeatures(c,u,s._state,ue.queryGeometry,ue.cameraQueryGeometry,ue.scale,S,A,B,ao(s.transform,ue.tileID))})}var Ee=function(Ce){for(var me={},Te={},Le=0,Ne=Ce;Le<Ne.length;Le+=1){var We=Ne[Le],He=We.queryResults,Je=We.wrappedTileID,ut=Te[Je]=Te[Je]||{};for(var _t in He)for(var gt=He[_t],Mt=ut[_t]=ut[_t]||{},Zt=me[_t]=me[_t]||[],Wt=0,Gt=gt;Wt<Gt.length;Wt+=1){var Ai=Gt[Wt];Mt[Ai.featureIndex]||(Mt[Ai.featureIndex]=!0,Zt.push(Ai))}}return me}(W);for(var be in Ee)Ee[be].forEach(function(Ce){var me=Ce.feature,Te=s.getFeatureState(me.layer["source-layer"],me.id);me.source=me.layer.source,me.layer["source-layer"]&&(me.sourceLayer=me.layer["source-layer"]),me.state=Te});return Ee}function dn(s,c){var u=s.tileID,f=c.tileID;return u.overscaledZ-f.overscaledZ||u.canonical.y-f.canonical.y||u.wrap-f.wrap||u.canonical.x-f.canonical.x}var Bi=function(s,c){this.max=s,this.onRemove=c,this.reset()};Bi.prototype.reset=function(){for(var s in this.data)for(var c=0,u=this.data[s];c<u.length;c+=1){var f=u[c];f.timeout&&clearTimeout(f.timeout),this.onRemove(f.value)}return this.data={},this.order=[],this},Bi.prototype.add=function(s,c,u){var f=this,S=s.wrapped().key;this.data[S]===void 0&&(this.data[S]=[]);var A={value:c,timeout:void 0};if(u!==void 0&&(A.timeout=setTimeout(function(){f.remove(s,A)},u)),this.data[S].push(A),this.order.push(S),this.order.length>this.max){var z=this._getAndRemoveByKey(this.order[0]);z&&this.onRemove(z)}return this},Bi.prototype.has=function(s){return s.wrapped().key in this.data},Bi.prototype.getAndRemove=function(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null},Bi.prototype._getAndRemoveByKey=function(s){var c=this.data[s].shift();return c.timeout&&clearTimeout(c.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),c.value},Bi.prototype.getByKey=function(s){var c=this.data[s];return c?c[0].value:null},Bi.prototype.get=function(s){return this.has(s)?this.data[s.wrapped().key][0].value:null},Bi.prototype.remove=function(s,c){if(!this.has(s))return this;var u=s.wrapped().key,f=c===void 0?0:this.data[u].indexOf(c),S=this.data[u][f];return this.data[u].splice(f,1),S.timeout&&clearTimeout(S.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(S.value),this.order.splice(this.order.indexOf(u),1),this},Bi.prototype.setMaxSize=function(s){for(this.max=s;this.order.length>this.max;){var c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this},Bi.prototype.filter=function(s){var c=[];for(var u in this.data)for(var f=0,S=this.data[u];f<S.length;f+=1){var A=S[f];s(A.value)||c.push(A)}for(var z=0,B=c;z<B.length;z+=1){var q=B[z];this.remove(q.value.tileID,q)}};var so=function(s,c,u){this.context=s;var f=s.gl;this.buffer=f.createBuffer(),this.dynamicDraw=Boolean(u),this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer};so.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},so.prototype.updateData=function(s){var c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)},so.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Uo={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},jn=function(s,c,u,f){this.length=c.length,this.attributes=u,this.itemSize=c.bytesPerElement,this.dynamicDraw=f,this.context=s;var S=s.gl;this.buffer=S.createBuffer(),s.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer};jn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},jn.prototype.updateData=function(s){var c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,s.arrayBuffer)},jn.prototype.enableAttributes=function(s,c){for(var u=0;u<this.attributes.length;u++){var f=c.attributes[this.attributes[u].name];f!==void 0&&s.enableVertexAttribArray(f)}},jn.prototype.setVertexAttribPointers=function(s,c,u){for(var f=0;f<this.attributes.length;f++){var S=this.attributes[f],A=c.attributes[S.name];A!==void 0&&s.vertexAttribPointer(A,S.components,s[Uo[S.type]],!1,this.itemSize,S.offset+this.itemSize*(u||0))}},jn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var ii=function(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};ii.prototype.get=function(){return this.current},ii.prototype.set=function(s){},ii.prototype.getDefault=function(){return this.default},ii.prototype.setDefault=function(){this.set(this.default)};var Mn=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return y.Color.transparent},c.prototype.set=function(u){var f=this.current;(u.r!==f.r||u.g!==f.g||u.b!==f.b||u.a!==f.a||this.dirty)&&(this.gl.clearColor(u.r,u.g,u.b,u.a),this.current=u,this.dirty=!1)},c}(ii),Gr=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return 1},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.clearDepth(u),this.current=u,this.dirty=!1)},c}(ii),nn=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return 0},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.clearStencil(u),this.current=u,this.dirty=!1)},c}(ii),vo=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return[!0,!0,!0,!0]},c.prototype.set=function(u){var f=this.current;(u[0]!==f[0]||u[1]!==f[1]||u[2]!==f[2]||u[3]!==f[3]||this.dirty)&&(this.gl.colorMask(u[0],u[1],u[2],u[3]),this.current=u,this.dirty=!1)},c}(ii),qn=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return!0},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.depthMask(u),this.current=u,this.dirty=!1)},c}(ii),lo=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return 255},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.stencilMask(u),this.current=u,this.dirty=!1)},c}(ii),Dr=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},c.prototype.set=function(u){var f=this.current;(u.func!==f.func||u.ref!==f.ref||u.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(u.func,u.ref,u.mask),this.current=u,this.dirty=!1)},c}(ii),wn=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){var u=this.gl;return[u.KEEP,u.KEEP,u.KEEP]},c.prototype.set=function(u){var f=this.current;(u[0]!==f[0]||u[1]!==f[1]||u[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(u[0],u[1],u[2]),this.current=u,this.dirty=!1)},c}(ii),Vo=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return!1},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;u?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=u,this.dirty=!1}},c}(ii),yi=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return[0,1]},c.prototype.set=function(u){var f=this.current;(u[0]!==f[0]||u[1]!==f[1]||this.dirty)&&(this.gl.depthRange(u[0],u[1]),this.current=u,this.dirty=!1)},c}(ii),on=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return!1},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;u?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=u,this.dirty=!1}},c}(ii),Gn=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return this.gl.LESS},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.depthFunc(u),this.current=u,this.dirty=!1)},c}(ii),fn=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return!1},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;u?f.enable(f.BLEND):f.disable(f.BLEND),this.current=u,this.dirty=!1}},c}(ii),xa=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){var u=this.gl;return[u.ONE,u.ZERO]},c.prototype.set=function(u){var f=this.current;(u[0]!==f[0]||u[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(u[0],u[1]),this.current=u,this.dirty=!1)},c}(ii),ot=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return y.Color.transparent},c.prototype.set=function(u){var f=this.current;(u.r!==f.r||u.g!==f.g||u.b!==f.b||u.a!==f.a||this.dirty)&&(this.gl.blendColor(u.r,u.g,u.b,u.a),this.current=u,this.dirty=!1)},c}(ii),Lt=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return this.gl.FUNC_ADD},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.blendEquation(u),this.current=u,this.dirty=!1)},c}(ii),zo=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return!1},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;u?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=u,this.dirty=!1}},c}(ii),Zn=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return this.gl.BACK},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.cullFace(u),this.current=u,this.dirty=!1)},c}(ii),Ki=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return this.gl.CCW},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.frontFace(u),this.current=u,this.dirty=!1)},c}(ii),mn=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return null},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.useProgram(u),this.current=u,this.dirty=!1)},c}(ii),Zr=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return this.gl.TEXTURE0},c.prototype.set=function(u){(u!==this.current||this.dirty)&&(this.gl.activeTexture(u),this.current=u,this.dirty=!1)},c}(ii),uo=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){var u=this.gl;return[0,0,u.drawingBufferWidth,u.drawingBufferHeight]},c.prototype.set=function(u){var f=this.current;(u[0]!==f[0]||u[1]!==f[1]||u[2]!==f[2]||u[3]!==f[3]||this.dirty)&&(this.gl.viewport(u[0],u[1],u[2],u[3]),this.current=u,this.dirty=!1)},c}(ii),er=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return null},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,u),this.current=u,this.dirty=!1}},c}(ii),Ct=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return null},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,u),this.current=u,this.dirty=!1}},c}(ii),Ti=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return null},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;f.bindTexture(f.TEXTURE_2D,u),this.current=u,this.dirty=!1}},c}(ii),gi=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return null},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,u),this.current=u,this.dirty=!1}},c}(ii),Rr=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return null},c.prototype.set=function(u){var f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,u),this.current=u,this.dirty=!1},c}(ii),$r=function(s){function c(u){s.call(this,u),this.vao=u.extVertexArrayObject}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return null},c.prototype.set=function(u){this.vao&&(u!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(u),this.current=u,this.dirty=!1)},c}(ii),ui=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return 4},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,u),this.current=u,this.dirty=!1}},c}(ii),xo=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return!1},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,u),this.current=u,this.dirty=!1}},c}(ii),Ln=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return!1},c.prototype.set=function(u){if(u!==this.current||this.dirty){var f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,u),this.current=u,this.dirty=!1}},c}(ii),Ji=function(s){function c(u,f){s.call(this,u),this.context=u,this.parent=f}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getDefault=function(){return null},c}(ii),X=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.setDirty=function(){this.dirty=!0},c.prototype.set=function(u){if(u!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,u,0),this.current=u,this.dirty=!1}},c}(Ji),Y=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.set=function(u){if(u!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.RENDERBUFFER,u),this.current=u,this.dirty=!1}},c}(Ji),ie=function(s,c,u,f){this.context=s,this.width=c,this.height=u;var S=this.framebuffer=s.gl.createFramebuffer();this.colorAttachment=new X(s,S),f&&(this.depthAttachment=new Y(s,S))};ie.prototype.destroy=function(){var s=this.context.gl,c=this.colorAttachment.get();if(c&&s.deleteTexture(c),this.depthAttachment){var u=this.depthAttachment.get();u&&s.deleteRenderbuffer(u)}s.deleteFramebuffer(this.framebuffer)};var pe=function(s,c,u){this.func=s,this.mask=c,this.range=u};pe.ReadOnly=!1,pe.ReadWrite=!0,pe.disabled=new pe(519,pe.ReadOnly,[0,1]);var xe=function(s,c,u,f,S,A){this.test=s,this.ref=c,this.mask=u,this.fail=f,this.depthFail=S,this.pass=A};xe.disabled=new xe({func:519,mask:0},0,0,7680,7680,7680);var Me=function(s,c,u){this.blendFunction=s,this.blendColor=c,this.mask=u};Me.disabled=new Me(Me.Replace=[1,0],y.Color.transparent,[!1,!1,!1,!1]),Me.unblended=new Me(Me.Replace,y.Color.transparent,[!0,!0,!0,!0]),Me.alphaBlended=new Me([1,771],y.Color.transparent,[!0,!0,!0,!0]);var De=function(s,c,u){this.enable=s,this.mode=c,this.frontFace=u};De.disabled=new De(!1,1029,2305),De.backCCW=new De(!0,1029,2305);var ce=function(s){this.gl=s,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Mn(this),this.clearDepth=new Gr(this),this.clearStencil=new nn(this),this.colorMask=new vo(this),this.depthMask=new qn(this),this.stencilMask=new lo(this),this.stencilFunc=new Dr(this),this.stencilOp=new wn(this),this.stencilTest=new Vo(this),this.depthRange=new yi(this),this.depthTest=new on(this),this.depthFunc=new Gn(this),this.blend=new fn(this),this.blendFunc=new xa(this),this.blendColor=new ot(this),this.blendEquation=new Lt(this),this.cullFace=new zo(this),this.cullFaceSide=new Zn(this),this.frontFace=new Ki(this),this.program=new mn(this),this.activeTexture=new Zr(this),this.viewport=new uo(this),this.bindFramebuffer=new er(this),this.bindRenderbuffer=new Ct(this),this.bindTexture=new Ti(this),this.bindVertexBuffer=new gi(this),this.bindElementBuffer=new Rr(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new $r(this),this.pixelStoreUnpack=new ui(this),this.pixelStoreUnpackPremultiplyAlpha=new xo(this),this.pixelStoreUnpackFlipY=new Ln(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=s.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(s.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE)};ce.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},ce.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},ce.prototype.createIndexBuffer=function(s,c){return new so(this,s,c)},ce.prototype.createVertexBuffer=function(s,c,u){return new jn(this,s,c,u)},ce.prototype.createRenderbuffer=function(s,c,u){var f=this.gl,S=f.createRenderbuffer();return this.bindRenderbuffer.set(S),f.renderbufferStorage(f.RENDERBUFFER,s,c,u),this.bindRenderbuffer.set(null),S},ce.prototype.createFramebuffer=function(s,c,u){return new ie(this,s,c,u)},ce.prototype.clear=function(s){var c=s.color,u=s.depth,f=this.gl,S=0;c&&(S|=f.COLOR_BUFFER_BIT,this.clearColor.set(c),this.colorMask.set([!0,!0,!0,!0])),u!==void 0&&(S|=f.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),f.clear(S)},ce.prototype.setCullFace=function(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))},ce.prototype.setDepthMode=function(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)},ce.prototype.setStencilMode=function(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)},ce.prototype.setColorMode=function(s){y.deepEqual(s.blendFunction,Me.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)},ce.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Ie=function(s){function c(u,f,S){var A=this;s.call(this),this.id=u,this.dispatcher=S,this.on("data",function(z){z.dataType==="source"&&z.sourceDataType==="metadata"&&(A._sourceLoaded=!0),A._sourceLoaded&&!A._paused&&z.dataType==="source"&&z.sourceDataType==="content"&&(A.reload(),A.transform&&A.update(A.transform))}),this.on("error",function(){A._sourceErrored=!0}),this._source=function(z,B,q,W){var oe=new Nn[B.type](z,B,q,W);if(oe.id!==z)throw new Error("Expected Source id to be "+z+" instead of "+oe.id);return y.bindAll(["load","abort","unload","serialize","prepare"],oe),oe}(u,f,S,this),this._tiles={},this._cache=new Bi(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new y.SourceFeatureState}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.onAdd=function(u){this.map=u,this._maxTileCacheSize=u?u._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(u)},c.prototype.onRemove=function(u){this._source&&this._source.onRemove&&this._source.onRemove(u)},c.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var u in this._tiles){var f=this._tiles[u];if(f.state!=="loaded"&&f.state!=="errored")return!1}return!0},c.prototype.getSource=function(){return this._source},c.prototype.pause=function(){this._paused=!0},c.prototype.resume=function(){if(this._paused){var u=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,u&&this.reload(),this.transform&&this.update(this.transform)}},c.prototype._loadTile=function(u,f){return this._source.loadTile(u,f)},c.prototype._unloadTile=function(u){if(this._source.unloadTile)return this._source.unloadTile(u,function(){})},c.prototype._abortTile=function(u){if(this._source.abortTile)return this._source.abortTile(u,function(){})},c.prototype.serialize=function(){return this._source.serialize()},c.prototype.prepare=function(u){for(var f in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var S=this._tiles[f];S.upload(u),S.prepare(this.map.style.imageManager)}},c.prototype.getIds=function(){return y.values(this._tiles).map(function(u){return u.tileID}).sort(qe).map(function(u){return u.key})},c.prototype.getRenderableIds=function(u){var f=this,S=[];for(var A in this._tiles)this._isIdRenderable(A,u)&&S.push(this._tiles[A]);return u?S.sort(function(z,B){var q=z.tileID,W=B.tileID,oe=new y.Point(q.canonical.x,q.canonical.y)._rotate(f.transform.angle),se=new y.Point(W.canonical.x,W.canonical.y)._rotate(f.transform.angle);return q.overscaledZ-W.overscaledZ||se.y-oe.y||se.x-oe.x}).map(function(z){return z.tileID.key}):S.map(function(z){return z.tileID}).sort(qe).map(function(z){return z.key})},c.prototype.hasRenderableParent=function(u){var f=this.findLoadedParent(u,0);return!!f&&this._isIdRenderable(f.tileID.key)},c.prototype._isIdRenderable=function(u,f){return this._tiles[u]&&this._tiles[u].hasData()&&!this._coveredTiles[u]&&(f||!this._tiles[u].holdingForFade())},c.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var u in this._cache.reset(),this._tiles)this._tiles[u].state!=="errored"&&this._reloadTile(u,"reloading")},c.prototype._reloadTile=function(u,f){var S=this._tiles[u];S&&(S.state!=="loading"&&(S.state=f),this._loadTile(S,this._tileLoaded.bind(this,S,u,f)))},c.prototype._tileLoaded=function(u,f,S,A){if(A)return u.state="errored",void(A.status!==404?this._source.fire(new y.ErrorEvent(A,{tile:u})):this.update(this.transform));u.timeAdded=y.browser.now(),S==="expired"&&(u.refreshedUponExpiration=!0),this._setTileReloadTimer(f,u),this.getSource().type==="raster-dem"&&u.dem&&this._backfillDEM(u),this._state.initializeTileState(u,this.map?this.map.painter:null),this._source.fire(new y.Event("data",{dataType:"source",tile:u,coord:u.tileID}))},c.prototype._backfillDEM=function(u){for(var f=this.getRenderableIds(),S=0;S<f.length;S++){var A=f[S];if(u.neighboringTiles&&u.neighboringTiles[A]){var z=this.getTileByID(A);B(u,z),B(z,u)}}function B(q,W){q.needsHillshadePrepare=!0;var oe=W.tileID.canonical.x-q.tileID.canonical.x,se=W.tileID.canonical.y-q.tileID.canonical.y,ue=Math.pow(2,q.tileID.canonical.z),Ee=W.tileID.key;oe===0&&se===0||Math.abs(se)>1||(Math.abs(oe)>1&&(Math.abs(oe+ue)===1?oe+=ue:Math.abs(oe-ue)===1&&(oe-=ue)),W.dem&&q.dem&&(q.dem.backfillBorder(W.dem,oe,se),q.neighboringTiles&&q.neighboringTiles[Ee]&&(q.neighboringTiles[Ee].backfilled=!0)))}},c.prototype.getTile=function(u){return this.getTileByID(u.key)},c.prototype.getTileByID=function(u){return this._tiles[u]},c.prototype._retainLoadedChildren=function(u,f,S,A){for(var z in this._tiles){var B=this._tiles[z];if(!(A[z]||!B.hasData()||B.tileID.overscaledZ<=f||B.tileID.overscaledZ>S)){for(var q=B.tileID;B&&B.tileID.overscaledZ>f+1;){var W=B.tileID.scaledTo(B.tileID.overscaledZ-1);(B=this._tiles[W.key])&&B.hasData()&&(q=W)}for(var oe=q;oe.overscaledZ>f;)if(u[(oe=oe.scaledTo(oe.overscaledZ-1)).key]){A[q.key]=q;break}}}},c.prototype.findLoadedParent=function(u,f){if(u.key in this._loadedParentTiles){var S=this._loadedParentTiles[u.key];return S&&S.tileID.overscaledZ>=f?S:null}for(var A=u.overscaledZ-1;A>=f;A--){var z=u.scaledTo(A),B=this._getLoadedTile(z);if(B)return B}},c.prototype._getLoadedTile=function(u){var f=this._tiles[u.key];return f&&f.hasData()?f:this._cache.getByKey(u.wrapped().key)},c.prototype.updateCacheSize=function(u){var f=Math.ceil(u.width/this._source.tileSize)+1,S=Math.ceil(u.height/this._source.tileSize)+1,A=Math.floor(f*S*5),z=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,A):A;this._cache.setMaxSize(z)},c.prototype.handleWrapJump=function(u){var f=Math.round((u-(this._prevLng===void 0?u:this._prevLng))/360);if(this._prevLng=u,f){var S={};for(var A in this._tiles){var z=this._tiles[A];z.tileID=z.tileID.unwrapTo(z.tileID.wrap+f),S[z.tileID.key]=z}for(var B in this._tiles=S,this._timers)clearTimeout(this._timers[B]),delete this._timers[B];for(var q in this._tiles)this._setTileReloadTimer(q,this._tiles[q])}},c.prototype.update=function(u){var f=this;if(this.transform=u,this._sourceLoaded&&!this._paused){var S;this.updateCacheSize(u),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?S=u.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(ut){return new y.OverscaledTileID(ut.canonical.z,ut.wrap,ut.canonical.z,ut.canonical.x,ut.canonical.y)}):(S=u.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(S=S.filter(function(ut){return f._source.hasTile(ut)}))):S=[];var A=u.coveringZoomLevel(this._source),z=Math.max(A-c.maxOverzooming,this._source.minzoom),B=Math.max(A+c.maxUnderzooming,this._source.minzoom),q=this._updateRetainedTiles(S,A);if(Q(this._source.type)){for(var W={},oe={},se=0,ue=Object.keys(q);se<ue.length;se+=1){var Ee=ue[se],be=q[Ee],Ce=this._tiles[Ee];if(Ce&&!(Ce.fadeEndTime&&Ce.fadeEndTime<=y.browser.now())){var me=this.findLoadedParent(be,z);me&&(this._addTile(me.tileID),W[me.tileID.key]=me.tileID),oe[Ee]=be}}for(var Te in this._retainLoadedChildren(oe,A,B,q),W)q[Te]||(this._coveredTiles[Te]=!0,q[Te]=W[Te])}for(var Le in q)this._tiles[Le].clearFadeHold();for(var Ne=0,We=y.keysDifference(this._tiles,q);Ne<We.length;Ne+=1){var He=We[Ne],Je=this._tiles[He];Je.hasSymbolBuckets&&!Je.holdingForFade()?Je.setHoldDuration(this.map._fadeDuration):Je.hasSymbolBuckets&&!Je.symbolFadeFinished()||this._removeTile(He)}this._updateLoadedParentTileCache()}},c.prototype.releaseSymbolFadeTiles=function(){for(var u in this._tiles)this._tiles[u].holdingForFade()&&this._removeTile(u)},c.prototype._updateRetainedTiles=function(u,f){for(var S={},A={},z=Math.max(f-c.maxOverzooming,this._source.minzoom),B=Math.max(f+c.maxUnderzooming,this._source.minzoom),q={},W=0,oe=u;W<oe.length;W+=1){var se=oe[W],ue=this._addTile(se);S[se.key]=se,ue.hasData()||f<this._source.maxzoom&&(q[se.key]=se)}this._retainLoadedChildren(q,f,B,S);for(var Ee=0,be=u;Ee<be.length;Ee+=1){var Ce=be[Ee],me=this._tiles[Ce.key];if(!me.hasData()){if(f+1>this._source.maxzoom){var Te=Ce.children(this._source.maxzoom)[0],Le=this.getTile(Te);if(Le&&Le.hasData()){S[Te.key]=Te;continue}}else{var Ne=Ce.children(this._source.maxzoom);if(S[Ne[0].key]&&S[Ne[1].key]&&S[Ne[2].key]&&S[Ne[3].key])continue}for(var We=me.wasRequested(),He=Ce.overscaledZ-1;He>=z;--He){var Je=Ce.scaledTo(He);if(A[Je.key]||(A[Je.key]=!0,!(me=this.getTile(Je))&&We&&(me=this._addTile(Je)),me&&(S[Je.key]=Je,We=me.wasRequested(),me.hasData())))break}}}return S},c.prototype._updateLoadedParentTileCache=function(){for(var u in this._loadedParentTiles={},this._tiles){for(var f=[],S=void 0,A=this._tiles[u].tileID;A.overscaledZ>0;){if(A.key in this._loadedParentTiles){S=this._loadedParentTiles[A.key];break}f.push(A.key);var z=A.scaledTo(A.overscaledZ-1);if(S=this._getLoadedTile(z))break;A=z}for(var B=0,q=f;B<q.length;B+=1)this._loadedParentTiles[q[B]]=S}},c.prototype._addTile=function(u){var f=this._tiles[u.key];if(f)return f;(f=this._cache.getAndRemove(u))&&(this._setTileReloadTimer(u.key,f),f.tileID=u,this._state.initializeTileState(f,this.map?this.map.painter:null),this._cacheTimers[u.key]&&(clearTimeout(this._cacheTimers[u.key]),delete this._cacheTimers[u.key],this._setTileReloadTimer(u.key,f)));var S=Boolean(f);return S||(f=new y.Tile(u,this._source.tileSize*u.overscaleFactor()),this._loadTile(f,this._tileLoaded.bind(this,f,u.key,f.state))),f?(f.uses++,this._tiles[u.key]=f,S||this._source.fire(new y.Event("dataloading",{tile:f,coord:f.tileID,dataType:"source"})),f):null},c.prototype._setTileReloadTimer=function(u,f){var S=this;u in this._timers&&(clearTimeout(this._timers[u]),delete this._timers[u]);var A=f.getExpiryTimeout();A&&(this._timers[u]=setTimeout(function(){S._reloadTile(u,"expired"),delete S._timers[u]},A))},c.prototype._removeTile=function(u){var f=this._tiles[u];f&&(f.uses--,delete this._tiles[u],this._timers[u]&&(clearTimeout(this._timers[u]),delete this._timers[u]),f.uses>0||(f.hasData()&&f.state!=="reloading"?this._cache.add(f.tileID,f,f.getExpiryTimeout()):(f.aborted=!0,this._abortTile(f),this._unloadTile(f))))},c.prototype.clearTiles=function(){for(var u in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(u);this._cache.reset()},c.prototype.tilesIn=function(u,f,S){var A=this,z=[],B=this.transform;if(!B)return z;for(var q=S?B.getCameraQueryGeometry(u):u,W=u.map(function(He){return B.pointCoordinate(He)}),oe=q.map(function(He){return B.pointCoordinate(He)}),se=this.getIds(),ue=1/0,Ee=1/0,be=-1/0,Ce=-1/0,me=0,Te=oe;me<Te.length;me+=1){var Le=Te[me];ue=Math.min(ue,Le.x),Ee=Math.min(Ee,Le.y),be=Math.max(be,Le.x),Ce=Math.max(Ce,Le.y)}for(var Ne=function(He){var Je=A._tiles[se[He]];if(!Je.holdingForFade()){var ut=Je.tileID,_t=Math.pow(2,B.zoom-Je.tileID.overscaledZ),gt=f*Je.queryPadding*y.EXTENT/Je.tileSize/_t,Mt=[ut.getTilePoint(new y.MercatorCoordinate(ue,Ee)),ut.getTilePoint(new y.MercatorCoordinate(be,Ce))];if(Mt[0].x-gt<y.EXTENT&&Mt[0].y-gt<y.EXTENT&&Mt[1].x+gt>=0&&Mt[1].y+gt>=0){var Zt=W.map(function(Gt){return ut.getTilePoint(Gt)}),Wt=oe.map(function(Gt){return ut.getTilePoint(Gt)});z.push({tile:Je,tileID:ut,queryGeometry:Zt,cameraQueryGeometry:Wt,scale:_t})}}},We=0;We<se.length;We++)Ne(We);return z},c.prototype.getVisibleCoordinates=function(u){for(var f=this,S=this.getRenderableIds(u).map(function(q){return f._tiles[q].tileID}),A=0,z=S;A<z.length;A+=1){var B=z[A];B.posMatrix=this.transform.calculatePosMatrix(B.toUnwrapped())}return S},c.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Q(this._source.type))for(var u in this._tiles){var f=this._tiles[u];if(f.fadeEndTime!==void 0&&f.fadeEndTime>=y.browser.now())return!0}return!1},c.prototype.setFeatureState=function(u,f,S){this._state.updateState(u=u||"_geojsonTileLayer",f,S)},c.prototype.removeFeatureState=function(u,f,S){this._state.removeFeatureState(u=u||"_geojsonTileLayer",f,S)},c.prototype.getFeatureState=function(u,f){return this._state.getState(u=u||"_geojsonTileLayer",f)},c.prototype.setDependencies=function(u,f,S){var A=this._tiles[u];A&&A.setDependencies(f,S)},c.prototype.reloadTilesForDependencies=function(u,f){for(var S in this._tiles)this._tiles[S].hasDependency(u,f)&&this._reloadTile(S,"reloading");this._cache.filter(function(A){return!A.hasDependency(u,f)})},c}(y.Evented);function qe(s,c){var u=Math.abs(2*s.wrap)-+(s.wrap<0),f=Math.abs(2*c.wrap)-+(c.wrap<0);return s.overscaledZ-c.overscaledZ||f-u||c.canonical.y-s.canonical.y||c.canonical.x-s.canonical.x}function Q(s){return s==="raster"||s==="image"||s==="video"}function F(){return new y.window.Worker(li.workerUrl)}Ie.maxOverzooming=10,Ie.maxUnderzooming=3;var U="mapboxgl_preloaded_worker_pool",J=function(){this.active={}};J.prototype.acquire=function(s){if(!this.workers)for(this.workers=[];this.workers.length<J.workerCount;)this.workers.push(new F);return this.active[s]=!0,this.workers.slice()},J.prototype.release=function(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach(function(c){c.terminate()}),this.workers=null)},J.prototype.isPreloaded=function(){return!!this.active[U]},J.prototype.numActive=function(){return Object.keys(this.active).length};var ne,de=Math.floor(y.browser.hardwareConcurrency/2);function le(){return ne||(ne=new J),ne}function _e(s,c){var u={};for(var f in s)f!=="ref"&&(u[f]=s[f]);return y.refProperties.forEach(function(S){S in c&&(u[S]=c[S])}),u}function ge(s){s=s.slice();for(var c=Object.create(null),u=0;u<s.length;u++)c[s[u].id]=s[u];for(var f=0;f<s.length;f++)"ref"in s[f]&&(s[f]=_e(s[f],c[s[f].ref]));return s}J.workerCount=Math.max(Math.min(de,6),1);var ve={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ge(s,c,u){u.push({command:ve.addSource,args:[s,c[s]]})}function Ue(s,c,u){c.push({command:ve.removeSource,args:[s]}),u[s]=!0}function Ze(s,c,u,f){Ue(s,u,f),Ge(s,c,u)}function bt(s,c,u){var f;for(f in s[u])if(s[u].hasOwnProperty(f)&&f!=="data"&&!y.deepEqual(s[u][f],c[u][f]))return!1;for(f in c[u])if(c[u].hasOwnProperty(f)&&f!=="data"&&!y.deepEqual(s[u][f],c[u][f]))return!1;return!0}function pt(s,c,u,f,S,A){var z;for(z in c=c||{},s=s||{})s.hasOwnProperty(z)&&(y.deepEqual(s[z],c[z])||u.push({command:A,args:[f,z,c[z],S]}));for(z in c)c.hasOwnProperty(z)&&!s.hasOwnProperty(z)&&(y.deepEqual(s[z],c[z])||u.push({command:A,args:[f,z,c[z],S]}))}function vt(s){return s.id}function Et(s,c){return s[c.id]=c,s}var di=function(s,c){this.reset(s,c)};di.prototype.reset=function(s,c){this.points=s||[],this._distances=[0];for(var u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding},di.prototype.lerp=function(s){if(this.points.length===1)return this.points[0];s=y.clamp(s,0,1);for(var c=1,u=this._distances[c],f=s*this.paddedLength+this.padding;u<f&&c<this._distances.length;)u=this._distances[++c];var S=c-1,A=this._distances[S],z=u-A,B=z>0?(f-A)/z:0;return this.points[S].mult(1-B).add(this.points[c].mult(B))};var $t=function(s,c,u){var f=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(s/u),this.yCellCount=Math.ceil(c/u);for(var A=0;A<this.xCellCount*this.yCellCount;A++)f.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=c,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0};function Jt(s,c,u,f,S){var A=y.create();return c?(y.scale(A,A,[1/S,1/S,1]),u||y.rotateZ(A,A,f.angle)):y.multiply(A,f.labelPlaneMatrix,s),A}function Nt(s,c,u,f,S){if(c){var A=y.clone(s);return y.scale(A,A,[S,S,1]),u||y.rotateZ(A,A,-f.angle),A}return f.glCoordMatrix}function Pt(s,c){var u=[s.x,s.y,0,1];Br(u,u,c);var f=u[3];return{point:new y.Point(u[0]/f,u[1]/f),signedDistanceFromCamera:f}}function oi(s,c){return .5+s/c*.5}function Oi(s,c){var u=s[0]/s[3],f=s[1]/s[3];return u>=-c[0]&&u<=c[0]&&f>=-c[1]&&f<=c[1]}function Cr(s,c,u,f,S,A,z,B){var q=f?s.textSizeData:s.iconSizeData,W=y.evaluateSizeForZoom(q,u.transform.zoom),oe=[256/u.width*2+1,256/u.height*2+1],se=f?s.text.dynamicLayoutVertexArray:s.icon.dynamicLayoutVertexArray;se.clear();for(var ue=s.lineVertexArray,Ee=f?s.text.placedSymbolArray:s.icon.placedSymbolArray,be=u.transform.width/u.transform.height,Ce=!1,me=0;me<Ee.length;me++){var Te=Ee.get(me);if(Te.hidden||Te.writingMode===y.WritingMode.vertical&&!Ce)En(Te.numGlyphs,se);else{Ce=!1;var Le=[Te.anchorX,Te.anchorY,0,1];if(y.transformMat4(Le,Le,c),Oi(Le,oe)){var Ne=oi(u.transform.cameraToCenterDistance,Le[3]),We=y.evaluateSizeForFeature(q,W,Te),He=z?We/Ne:We*Ne,Je=new y.Point(Te.anchorX,Te.anchorY),ut=Pt(Je,S).point,_t={},gt=Ss(Te,He,!1,B,c,S,A,s.glyphOffsetArray,ue,se,ut,Je,_t,be);Ce=gt.useVertical,(gt.notEnoughRoom||Ce||gt.needsFlipping&&Ss(Te,He,!0,B,c,S,A,s.glyphOffsetArray,ue,se,ut,Je,_t,be).notEnoughRoom)&&En(Te.numGlyphs,se)}else En(Te.numGlyphs,se)}}f?s.text.dynamicLayoutVertexBuffer.updateData(se):s.icon.dynamicLayoutVertexBuffer.updateData(se)}function Fi(s,c,u,f,S,A,z,B,q,W,oe){var se=B.glyphStartIndex+B.numGlyphs,ue=B.lineStartIndex,Ee=B.lineStartIndex+B.lineLength,be=c.getoffsetX(B.glyphStartIndex),Ce=c.getoffsetX(se-1),me=wr(s*be,u,f,S,A,z,B.segment,ue,Ee,q,W,oe);if(!me)return null;var Te=wr(s*Ce,u,f,S,A,z,B.segment,ue,Ee,q,W,oe);return Te?{first:me,last:Te}:null}function yn(s,c,u,f){return s===y.WritingMode.horizontal&&Math.abs(u.y-c.y)>Math.abs(u.x-c.x)*f?{useVertical:!0}:(s===y.WritingMode.vertical?c.y<u.y:c.x>u.x)?{needsFlipping:!0}:null}function Ss(s,c,u,f,S,A,z,B,q,W,oe,se,ue,Ee){var be,Ce=c/24,me=s.lineOffsetX*Ce,Te=s.lineOffsetY*Ce;if(s.numGlyphs>1){var Le=s.glyphStartIndex+s.numGlyphs,Ne=s.lineStartIndex,We=s.lineStartIndex+s.lineLength,He=Fi(Ce,B,me,Te,u,oe,se,s,q,A,ue);if(!He)return{notEnoughRoom:!0};var Je=Pt(He.first.point,z).point,ut=Pt(He.last.point,z).point;if(f&&!u){var _t=yn(s.writingMode,Je,ut,Ee);if(_t)return _t}be=[He.first];for(var gt=s.glyphStartIndex+1;gt<Le-1;gt++)be.push(wr(Ce*B.getoffsetX(gt),me,Te,u,oe,se,s.segment,Ne,We,q,A,ue));be.push(He.last)}else{if(f&&!u){var Mt=Pt(se,S).point,Zt=s.lineStartIndex+s.segment+1,Wt=new y.Point(q.getx(Zt),q.gety(Zt)),Gt=Pt(Wt,S),Ai=Gt.signedDistanceFromCamera>0?Gt.point:$i(se,Wt,Mt,1,S),Ft=yn(s.writingMode,Mt,Ai,Ee);if(Ft)return Ft}var ai=wr(Ce*B.getoffsetX(s.glyphStartIndex),me,Te,u,oe,se,s.segment,s.lineStartIndex,s.lineStartIndex+s.lineLength,q,A,ue);if(!ai)return{notEnoughRoom:!0};be=[ai]}for(var wi=0,ni=be;wi<ni.length;wi+=1){var ei=ni[wi];y.addDynamicAttributes(W,ei.point,ei.angle)}return{}}function $i(s,c,u,f,S){var A=Pt(s.add(s.sub(c)._unit()),S).point,z=u.sub(A);return u.add(z._mult(f/z.mag()))}function wr(s,c,u,f,S,A,z,B,q,W,oe,se){var ue=f?s-c:s+c,Ee=ue>0?1:-1,be=0;f&&(Ee*=-1,be=Math.PI),Ee<0&&(be+=Math.PI);for(var Ce=Ee>0?B+z:B+z+1,me=S,Te=S,Le=0,Ne=0,We=Math.abs(ue),He=[];Le+Ne<=We;){if((Ce+=Ee)<B||Ce>=q)return null;if(Te=me,He.push(me),(me=se[Ce])===void 0){var Je=new y.Point(W.getx(Ce),W.gety(Ce)),ut=Pt(Je,oe);if(ut.signedDistanceFromCamera>0)me=se[Ce]=ut.point;else{var _t=Ce-Ee;me=$i(Le===0?A:new y.Point(W.getx(_t),W.gety(_t)),Je,Te,We-Le+1,oe)}}Le+=Ne,Ne=Te.dist(me)}var gt=(We-Le)/Ne,Mt=me.sub(Te),Zt=Mt.mult(gt)._add(Te);Zt._add(Mt._unit()._perp()._mult(u*Ee));var Wt=be+Math.atan2(me.y-Te.y,me.x-Te.x);return He.push(Zt),{point:Zt,angle:Wt,path:He}}$t.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},$t.prototype.insert=function(s,c,u,f,S){this._forEachCell(c,u,f,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(c),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(S)},$t.prototype.insertCircle=function(s,c,u,f){this._forEachCell(c-f,u-f,c+f,u+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(c),this.circles.push(u),this.circles.push(f)},$t.prototype._insertBoxCell=function(s,c,u,f,S,A){this.boxCells[S].push(A)},$t.prototype._insertCircleCell=function(s,c,u,f,S,A){this.circleCells[S].push(A)},$t.prototype._query=function(s,c,u,f,S,A){if(u<0||s>this.width||f<0||c>this.height)return!S&&[];var z=[];if(s<=0&&c<=0&&this.width<=u&&this.height<=f){if(S)return!0;for(var B=0;B<this.boxKeys.length;B++)z.push({key:this.boxKeys[B],x1:this.bboxes[4*B],y1:this.bboxes[4*B+1],x2:this.bboxes[4*B+2],y2:this.bboxes[4*B+3]});for(var q=0;q<this.circleKeys.length;q++){var W=this.circles[3*q],oe=this.circles[3*q+1],se=this.circles[3*q+2];z.push({key:this.circleKeys[q],x1:W-se,y1:oe-se,x2:W+se,y2:oe+se})}return A?z.filter(A):z}return this._forEachCell(s,c,u,f,this._queryCell,z,{hitTest:S,seenUids:{box:{},circle:{}}},A),S?z.length>0:z},$t.prototype._queryCircle=function(s,c,u,f,S){var A=s-u,z=s+u,B=c-u,q=c+u;if(z<0||A>this.width||q<0||B>this.height)return!f&&[];var W=[];return this._forEachCell(A,B,z,q,this._queryCellCircle,W,{hitTest:f,circle:{x:s,y:c,radius:u},seenUids:{box:{},circle:{}}},S),f?W.length>0:W},$t.prototype.query=function(s,c,u,f,S){return this._query(s,c,u,f,!1,S)},$t.prototype.hitTest=function(s,c,u,f,S){return this._query(s,c,u,f,!0,S)},$t.prototype.hitTestCircle=function(s,c,u,f){return this._queryCircle(s,c,u,!0,f)},$t.prototype._queryCell=function(s,c,u,f,S,A,z,B){var q=z.seenUids,W=this.boxCells[S];if(W!==null)for(var oe=this.bboxes,se=0,ue=W;se<ue.length;se+=1){var Ee=ue[se];if(!q.box[Ee]){q.box[Ee]=!0;var be=4*Ee;if(s<=oe[be+2]&&c<=oe[be+3]&&u>=oe[be+0]&&f>=oe[be+1]&&(!B||B(this.boxKeys[Ee]))){if(z.hitTest)return A.push(!0),!0;A.push({key:this.boxKeys[Ee],x1:oe[be],y1:oe[be+1],x2:oe[be+2],y2:oe[be+3]})}}}var Ce=this.circleCells[S];if(Ce!==null)for(var me=this.circles,Te=0,Le=Ce;Te<Le.length;Te+=1){var Ne=Le[Te];if(!q.circle[Ne]){q.circle[Ne]=!0;var We=3*Ne;if(this._circleAndRectCollide(me[We],me[We+1],me[We+2],s,c,u,f)&&(!B||B(this.circleKeys[Ne]))){if(z.hitTest)return A.push(!0),!0;var He=me[We],Je=me[We+1],ut=me[We+2];A.push({key:this.circleKeys[Ne],x1:He-ut,y1:Je-ut,x2:He+ut,y2:Je+ut})}}}},$t.prototype._queryCellCircle=function(s,c,u,f,S,A,z,B){var q=z.circle,W=z.seenUids,oe=this.boxCells[S];if(oe!==null)for(var se=this.bboxes,ue=0,Ee=oe;ue<Ee.length;ue+=1){var be=Ee[ue];if(!W.box[be]){W.box[be]=!0;var Ce=4*be;if(this._circleAndRectCollide(q.x,q.y,q.radius,se[Ce+0],se[Ce+1],se[Ce+2],se[Ce+3])&&(!B||B(this.boxKeys[be])))return A.push(!0),!0}}var me=this.circleCells[S];if(me!==null)for(var Te=this.circles,Le=0,Ne=me;Le<Ne.length;Le+=1){var We=Ne[Le];if(!W.circle[We]){W.circle[We]=!0;var He=3*We;if(this._circlesCollide(Te[He],Te[He+1],Te[He+2],q.x,q.y,q.radius)&&(!B||B(this.circleKeys[We])))return A.push(!0),!0}}},$t.prototype._forEachCell=function(s,c,u,f,S,A,z,B){for(var q=this._convertToXCellCoord(s),W=this._convertToYCellCoord(c),oe=this._convertToXCellCoord(u),se=this._convertToYCellCoord(f),ue=q;ue<=oe;ue++)for(var Ee=W;Ee<=se;Ee++)if(S.call(this,s,c,u,f,this.xCellCount*Ee+ue,A,z,B))return},$t.prototype._convertToXCellCoord=function(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))},$t.prototype._convertToYCellCoord=function(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))},$t.prototype._circlesCollide=function(s,c,u,f,S,A){var z=f-s,B=S-c,q=u+A;return q*q>z*z+B*B},$t.prototype._circleAndRectCollide=function(s,c,u,f,S,A,z){var B=(A-f)/2,q=Math.abs(s-(f+B));if(q>B+u)return!1;var W=(z-S)/2,oe=Math.abs(c-(S+W));if(oe>W+u)return!1;if(q<=B||oe<=W)return!0;var se=q-B,ue=oe-W;return se*se+ue*ue<=u*u};var Ua=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function En(s,c){for(var u=0;u<s;u++){var f=c.length;c.resize(f+4),c.float32.set(Ua,3*f)}}function Br(s,c,u){var f=c[0],S=c[1];return s[0]=u[0]*f+u[4]*S+u[12],s[1]=u[1]*f+u[5]*S+u[13],s[3]=u[3]*f+u[7]*S+u[15],s}var co=function(s,c,u){c===void 0&&(c=new $t(s.width+200,s.height+200,25)),u===void 0&&(u=new $t(s.width+200,s.height+200,25)),this.transform=s,this.grid=c,this.ignoredGrid=u,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+100,this.screenBottomBoundary=s.height+100,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200};function tr(s,c,u){return c*(y.EXTENT/(s.tileSize*Math.pow(2,u-s.tileID.overscaledZ)))}co.prototype.placeCollisionBox=function(s,c,u,f,S){var A=this.projectAndGetPerspectiveRatio(f,s.anchorPointX,s.anchorPointY),z=u*A.perspectiveRatio,B=s.x1*z+A.point.x,q=s.y1*z+A.point.y,W=s.x2*z+A.point.x,oe=s.y2*z+A.point.y;return!this.isInsideGrid(B,q,W,oe)||!c&&this.grid.hitTest(B,q,W,oe,S)?{box:[],offscreen:!1}:{box:[B,q,W,oe],offscreen:this.isOffscreen(B,q,W,oe)}},co.prototype.placeCollisionCircles=function(s,c,u,f,S,A,z,B,q,W,oe,se,ue){var Ee=[],be=new y.Point(c.anchorX,c.anchorY),Ce=Pt(be,A),me=oi(this.transform.cameraToCenterDistance,Ce.signedDistanceFromCamera),Te=(W?S/me:S*me)/y.ONE_EM,Le=Pt(be,z).point,Ne=Fi(Te,f,c.lineOffsetX*Te,c.lineOffsetY*Te,!1,Le,be,c,u,z,{}),We=!1,He=!1,Je=!0;if(Ne){for(var ut=.5*se*me+ue,_t=new y.Point(-100,-100),gt=new y.Point(this.screenRightBoundary,this.screenBottomBoundary),Mt=new di,Zt=Ne.first,Wt=Ne.last,Gt=[],Ai=Zt.path.length-1;Ai>=1;Ai--)Gt.push(Zt.path[Ai]);for(var Ft=1;Ft<Wt.path.length;Ft++)Gt.push(Wt.path[Ft]);var ai=2.5*ut;if(B){var wi=Gt.map(function(Io){return Pt(Io,B)});Gt=wi.some(function(Io){return Io.signedDistanceFromCamera<=0})?[]:wi.map(function(Io){return Io.point})}var ni=[];if(Gt.length>0){for(var ei=Gt[0].clone(),ci=Gt[0].clone(),Kt=1;Kt<Gt.length;Kt++)ei.x=Math.min(ei.x,Gt[Kt].x),ei.y=Math.min(ei.y,Gt[Kt].y),ci.x=Math.max(ci.x,Gt[Kt].x),ci.y=Math.max(ci.y,Gt[Kt].y);ni=ei.x>=_t.x&&ci.x<=gt.x&&ei.y>=_t.y&&ci.y<=gt.y?[Gt]:ci.x<_t.x||ei.x>gt.x||ci.y<_t.y||ei.y>gt.y?[]:y.clipLine([Gt],_t.x,_t.y,gt.x,gt.y)}for(var Xt=0,yr=ni;Xt<yr.length;Xt+=1){var Ir;Mt.reset(yr[Xt],.25*ut),Ir=Mt.length<=.5*ut?1:Math.ceil(Mt.paddedLength/ai)+1;for(var Fr=0;Fr<Ir;Fr++){var vn=Fr/Math.max(Ir-1,1),xr=Mt.lerp(vn),zi=xr.x+100,Jn=xr.y+100;Ee.push(zi,Jn,ut,0);var On=zi-ut,So=Jn-ut,Wr=zi+ut,To=Jn+ut;if(Je=Je&&this.isOffscreen(On,So,Wr,To),He=He||this.isInsideGrid(On,So,Wr,To),!s&&this.grid.hitTestCircle(zi,Jn,ut,oe)&&(We=!0,!q))return{circles:[],offscreen:!1,collisionDetected:We}}}}return{circles:!q&&We||!He?[]:Ee,offscreen:Je,collisionDetected:We}},co.prototype.queryRenderedSymbols=function(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var c=[],u=1/0,f=1/0,S=-1/0,A=-1/0,z=0,B=s;z<B.length;z+=1){var q=B[z],W=new y.Point(q.x+100,q.y+100);u=Math.min(u,W.x),f=Math.min(f,W.y),S=Math.max(S,W.x),A=Math.max(A,W.y),c.push(W)}for(var oe={},se={},ue=0,Ee=this.grid.query(u,f,S,A).concat(this.ignoredGrid.query(u,f,S,A));ue<Ee.length;ue+=1){var be=Ee[ue],Ce=be.key;if(oe[Ce.bucketInstanceId]===void 0&&(oe[Ce.bucketInstanceId]={}),!oe[Ce.bucketInstanceId][Ce.featureIndex]){var me=[new y.Point(be.x1,be.y1),new y.Point(be.x2,be.y1),new y.Point(be.x2,be.y2),new y.Point(be.x1,be.y2)];y.polygonIntersectsPolygon(c,me)&&(oe[Ce.bucketInstanceId][Ce.featureIndex]=!0,se[Ce.bucketInstanceId]===void 0&&(se[Ce.bucketInstanceId]=[]),se[Ce.bucketInstanceId].push(Ce.featureIndex))}}return se},co.prototype.insertCollisionBox=function(s,c,u,f,S){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:f,collisionGroupID:S},s[0],s[1],s[2],s[3])},co.prototype.insertCollisionCircles=function(s,c,u,f,S){for(var A=c?this.ignoredGrid:this.grid,z={bucketInstanceId:u,featureIndex:f,collisionGroupID:S},B=0;B<s.length;B+=4)A.insertCircle(z,s[B],s[B+1],s[B+2])},co.prototype.projectAndGetPerspectiveRatio=function(s,c,u){var f=[c,u,0,1];return Br(f,f,s),{point:new y.Point((f[0]/f[3]+1)/2*this.transform.width+100,(-f[1]/f[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/f[3]*.5}},co.prototype.isOffscreen=function(s,c,u,f){return u<100||s>=this.screenRightBoundary||f<100||c>this.screenBottomBoundary},co.prototype.isInsideGrid=function(s,c,u,f){return u>=0&&s<this.gridRightBoundary&&f>=0&&c<this.gridBottomBoundary},co.prototype.getViewportMatrix=function(){var s=y.identity([]);return y.translate(s,s,[-100,-100,0]),s};var ho=function(s,c,u,f){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?c:-c))):f&&u?1:0,this.placed=u};ho.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Dn=function(s,c,u,f,S){this.text=new ho(s?s.text:null,c,u,S),this.icon=new ho(s?s.icon:null,c,f,S)};Dn.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Rl=function(s,c,u){this.text=s,this.icon=c,this.skipFade=u},po=function(){this.invProjMatrix=y.create(),this.viewportMatrix=y.create(),this.circles=[]},Va=function(s,c,u,f,S){this.bucketInstanceId=s,this.featureIndex=c,this.sourceLayerIndex=u,this.bucketIndex=f,this.tileID=S},bo=function(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}};function Er(s,c,u,f,S){var A=y.getAnchorAlignment(s),z=-(A.horizontalAlign-.5)*c,B=-(A.verticalAlign-.5)*u,q=y.evaluateVariableOffset(s,f);return new y.Point(z+q[0]*S,B+q[1]*S)}function $n(s,c,u,f,S,A){var z=s.x1,B=s.x2,q=s.y1,W=s.y2,oe=s.anchorPointX,se=s.anchorPointY,ue=new y.Point(c,u);return f&&ue._rotate(S?A:-A),{x1:z+ue.x,y1:q+ue.y,x2:B+ue.x,y2:W+ue.y,anchorPointX:oe,anchorPointY:se}}bo.prototype.get=function(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){var c=++this.maxGroupID;this.collisionGroups[s]={ID:c,predicate:function(u){return u.collisionGroupID===c}}}return this.collisionGroups[s]};var Xr=function(s,c,u,f){this.transform=s.clone(),this.collisionIndex=new co(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new bo(u),this.collisionCircleArrays={},this.prevPlacement=f,f&&(f.prevPlacement=void 0),this.placedOrientations={}};function No(s,c,u,f,S){s.emplaceBack(c?1:0,u?1:0,f||0,S||0),s.emplaceBack(c?1:0,u?1:0,f||0,S||0),s.emplaceBack(c?1:0,u?1:0,f||0,S||0),s.emplaceBack(c?1:0,u?1:0,f||0,S||0)}Xr.prototype.getBucketParts=function(s,c,u,f){var S=u.getBucket(c),A=u.latestFeatureIndex;if(S&&A&&c.id===S.layerIds[0]){var z=u.collisionBoxArray,B=S.layers[0].layout,q=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),W=u.tileSize/y.EXTENT,oe=this.transform.calculatePosMatrix(u.tileID.toUnwrapped()),se=B.get("text-pitch-alignment")==="map",ue=B.get("text-rotation-alignment")==="map",Ee=tr(u,1,this.transform.zoom),be=Jt(oe,se,ue,this.transform,Ee),Ce=null;if(se){var me=Nt(oe,se,ue,this.transform,Ee);Ce=y.multiply([],this.transform.labelPlaneMatrix,me)}this.retainedQueryData[S.bucketInstanceId]=new Va(S.bucketInstanceId,A,S.sourceLayerIndex,S.index,u.tileID);var Te={bucket:S,layout:B,posMatrix:oe,textLabelPlaneMatrix:be,labelToScreenMatrix:Ce,scale:q,textPixelRatio:W,holdingForFade:u.holdingForFade(),collisionBoxArray:z,partiallyEvaluatedTextSize:y.evaluateSizeForZoom(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(f)for(var Le=0,Ne=S.sortKeyRanges;Le<Ne.length;Le+=1){var We=Ne[Le];s.push({sortKey:We.sortKey,symbolInstanceStart:We.symbolInstanceStart,symbolInstanceEnd:We.symbolInstanceEnd,parameters:Te})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:Te})}},Xr.prototype.attemptAnchorPlacement=function(s,c,u,f,S,A,z,B,q,W,oe,se,ue,Ee,be){var Ce,me=[se.textOffset0,se.textOffset1],Te=Er(s,u,f,me,S),Le=this.collisionIndex.placeCollisionBox($n(c,Te.x,Te.y,A,z,this.transform.angle),oe,B,q,W.predicate);if(!be||this.collisionIndex.placeCollisionBox($n(be,Te.x,Te.y,A,z,this.transform.angle),oe,B,q,W.predicate).box.length!==0)return Le.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[se.crossTileID]&&this.prevPlacement.placements[se.crossTileID]&&this.prevPlacement.placements[se.crossTileID].text&&(Ce=this.prevPlacement.variableOffsets[se.crossTileID].anchor),this.variableOffsets[se.crossTileID]={textOffset:me,width:u,height:f,anchor:s,textBoxScale:S,prevAnchor:Ce},this.markUsedJustification(ue,s,se,Ee),ue.allowVerticalPlacement&&(this.markUsedOrientation(ue,Ee,se),this.placedOrientations[se.crossTileID]=Ee),{shift:Te,placedGlyphBoxes:Le}):void 0},Xr.prototype.placeLayerBucketPart=function(s,c,u){var f=this,S=s.parameters,A=S.bucket,z=S.layout,B=S.posMatrix,q=S.textLabelPlaneMatrix,W=S.labelToScreenMatrix,oe=S.textPixelRatio,se=S.holdingForFade,ue=S.collisionBoxArray,Ee=S.partiallyEvaluatedTextSize,be=S.collisionGroup,Ce=z.get("text-optional"),me=z.get("icon-optional"),Te=z.get("text-allow-overlap"),Le=z.get("icon-allow-overlap"),Ne=z.get("text-rotation-alignment")==="map",We=z.get("text-pitch-alignment")==="map",He=z.get("icon-text-fit")!=="none",Je=z.get("symbol-z-order")==="viewport-y",ut=Te&&(Le||!A.hasIconData()||me),_t=Le&&(Te||!A.hasTextData()||Ce);!A.collisionArrays&&ue&&A.deserializeCollisionBoxes(ue);var gt=function(Ft,ai){if(!c[Ft.crossTileID])if(se)f.placements[Ft.crossTileID]=new Rl(!1,!1,!1);else{var wi,ni=!1,ei=!1,ci=!0,Kt=null,Xt={box:null,offscreen:null},yr={box:null,offscreen:null},Ir=null,Fr=null,vn=0,xr=0,zi=0;ai.textFeatureIndex?vn=ai.textFeatureIndex:Ft.useRuntimeCollisionCircles&&(vn=Ft.featureIndex),ai.verticalTextFeatureIndex&&(xr=ai.verticalTextFeatureIndex);var Jn=ai.textBox;if(Jn){var On=function(Ri){var Yn=y.WritingMode.horizontal;if(A.allowVerticalPlacement&&!Ri&&f.prevPlacement){var go=f.prevPlacement.placedOrientations[Ft.crossTileID];go&&(f.placedOrientations[Ft.crossTileID]=go,f.markUsedOrientation(A,Yn=go,Ft))}return Yn},So=function(Ri,Yn){if(A.allowVerticalPlacement&&Ft.numVerticalGlyphVertices>0&&ai.verticalTextBox)for(var go=0,$s=A.writingModes;go<$s.length&&($s[go]===y.WritingMode.vertical?(Xt=Yn(),yr=Xt):Xt=Ri(),!(Xt&&Xt.box&&Xt.box.length));go+=1);else Xt=Ri()};if(z.get("text-variable-anchor")){var Wr=z.get("text-variable-anchor");if(f.prevPlacement&&f.prevPlacement.variableOffsets[Ft.crossTileID]){var To=f.prevPlacement.variableOffsets[Ft.crossTileID];Wr.indexOf(To.anchor)>0&&(Wr=Wr.filter(function(Ri){return Ri!==To.anchor})).unshift(To.anchor)}var Io=function(Ri,Yn,go){for(var $s=Ri.x2-Ri.x1,vl=Ri.y2-Ri.y1,xl=Ft.textBoxScale,bc=He&&!Le?Yn:null,Qa={box:[],offscreen:!1},wc=Te?2*Wr.length:Wr.length,es=0;es<wc;++es){var Wl=f.attemptAnchorPlacement(Wr[es%Wr.length],Ri,$s,vl,xl,Ne,We,oe,B,be,es>=Wr.length,Ft,A,go,bc);if(Wl&&(Qa=Wl.placedGlyphBoxes)&&Qa.box&&Qa.box.length){ni=!0,Kt=Wl.shift;break}}return Qa};So(function(){return Io(Jn,ai.iconBox,y.WritingMode.horizontal)},function(){var Ri=ai.verticalTextBox;return A.allowVerticalPlacement&&!(Xt&&Xt.box&&Xt.box.length)&&Ft.numVerticalGlyphVertices>0&&Ri?Io(Ri,ai.verticalIconBox,y.WritingMode.vertical):{box:null,offscreen:null}}),Xt&&(ni=Xt.box,ci=Xt.offscreen);var yl=On(Xt&&Xt.box);if(!ni&&f.prevPlacement){var gl=f.prevPlacement.variableOffsets[Ft.crossTileID];gl&&(f.variableOffsets[Ft.crossTileID]=gl,f.markUsedJustification(A,gl.anchor,Ft,yl))}}else{var Ya=function(Ri,Yn){var go=f.collisionIndex.placeCollisionBox(Ri,Te,oe,B,be.predicate);return go&&go.box&&go.box.length&&(f.markUsedOrientation(A,Yn,Ft),f.placedOrientations[Ft.crossTileID]=Yn),go};So(function(){return Ya(Jn,y.WritingMode.horizontal)},function(){var Ri=ai.verticalTextBox;return A.allowVerticalPlacement&&Ft.numVerticalGlyphVertices>0&&Ri?Ya(Ri,y.WritingMode.vertical):{box:null,offscreen:null}}),On(Xt&&Xt.box&&Xt.box.length)}}if(ni=(wi=Xt)&&wi.box&&wi.box.length>0,ci=wi&&wi.offscreen,Ft.useRuntimeCollisionCircles){var _l=A.text.placedSymbolArray.get(Ft.centerJustifiedTextSymbolIndex),Gs=y.evaluateSizeForFeature(A.textSizeData,Ee,_l),Ma=z.get("text-padding");Ir=f.collisionIndex.placeCollisionCircles(Te,_l,A.lineVertexArray,A.glyphOffsetArray,Gs,B,q,W,u,We,be.predicate,Ft.collisionCircleDiameter,Ma),ni=Te||Ir.circles.length>0&&!Ir.collisionDetected,ci=ci&&Ir.offscreen}if(ai.iconFeatureIndex&&(zi=ai.iconFeatureIndex),ai.iconBox){var Zs=function(Ri){var Yn=He&&Kt?$n(Ri,Kt.x,Kt.y,Ne,We,f.transform.angle):Ri;return f.collisionIndex.placeCollisionBox(Yn,Le,oe,B,be.predicate)};ei=yr&&yr.box&&yr.box.length&&ai.verticalIconBox?(Fr=Zs(ai.verticalIconBox)).box.length>0:(Fr=Zs(ai.iconBox)).box.length>0,ci=ci&&Fr.offscreen}var ya=Ce||Ft.numHorizontalGlyphVertices===0&&Ft.numVerticalGlyphVertices===0,Hr=me||Ft.numIconVertices===0;if(ya||Hr?Hr?ya||(ei=ei&&ni):ni=ei&&ni:ei=ni=ei&&ni,ni&&wi&&wi.box&&f.collisionIndex.insertCollisionBox(wi.box,z.get("text-ignore-placement"),A.bucketInstanceId,yr&&yr.box&&xr?xr:vn,be.ID),ei&&Fr&&f.collisionIndex.insertCollisionBox(Fr.box,z.get("icon-ignore-placement"),A.bucketInstanceId,zi,be.ID),Ir&&(ni&&f.collisionIndex.insertCollisionCircles(Ir.circles,z.get("text-ignore-placement"),A.bucketInstanceId,vn,be.ID),u)){var Ao=A.bucketInstanceId,_s=f.collisionCircleArrays[Ao];_s===void 0&&(_s=f.collisionCircleArrays[Ao]=new po);for(var ga=0;ga<Ir.circles.length;ga+=4)_s.circles.push(Ir.circles[ga+0]),_s.circles.push(Ir.circles[ga+1]),_s.circles.push(Ir.circles[ga+2]),_s.circles.push(Ir.collisionDetected?1:0)}f.placements[Ft.crossTileID]=new Rl(ni||ut,ei||_t,ci||A.justReloaded),c[Ft.crossTileID]=!0}};if(Je)for(var Mt=A.getSortedSymbolIndexes(this.transform.angle),Zt=Mt.length-1;Zt>=0;--Zt){var Wt=Mt[Zt];gt(A.symbolInstances.get(Wt),A.collisionArrays[Wt])}else for(var Gt=s.symbolInstanceStart;Gt<s.symbolInstanceEnd;Gt++)gt(A.symbolInstances.get(Gt),A.collisionArrays[Gt]);if(u&&A.bucketInstanceId in this.collisionCircleArrays){var Ai=this.collisionCircleArrays[A.bucketInstanceId];y.invert(Ai.invProjMatrix,B),Ai.viewportMatrix=this.collisionIndex.getViewportMatrix()}A.justReloaded=!1},Xr.prototype.markUsedJustification=function(s,c,u,f){var S;S=f===y.WritingMode.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[y.getAnchorJustification(c)];for(var A=0,z=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];A<z.length;A+=1){var B=z[A];B>=0&&(s.text.placedSymbolArray.get(B).crossTileID=S>=0&&B!==S?0:u.crossTileID)}},Xr.prototype.markUsedOrientation=function(s,c,u){for(var f=c===y.WritingMode.horizontal||c===y.WritingMode.horizontalOnly?c:0,S=c===y.WritingMode.vertical?c:0,A=0,z=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];A<z.length;A+=1)s.text.placedSymbolArray.get(z[A]).placedOrientation=f;u.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=S)},Xr.prototype.commit=function(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;var c=this.prevPlacement,u=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;var f=c?c.symbolFadeChange(s):1,S=c?c.opacities:{},A=c?c.variableOffsets:{},z=c?c.placedOrientations:{};for(var B in this.placements){var q=this.placements[B],W=S[B];W?(this.opacities[B]=new Dn(W,f,q.text,q.icon),u=u||q.text!==W.text.placed||q.icon!==W.icon.placed):(this.opacities[B]=new Dn(null,f,q.text,q.icon,q.skipFade),u=u||q.text||q.icon)}for(var oe in S){var se=S[oe];if(!this.opacities[oe]){var ue=new Dn(se,f,!1,!1);ue.isHidden()||(this.opacities[oe]=ue,u=u||se.text.placed||se.icon.placed)}}for(var Ee in A)this.variableOffsets[Ee]||!this.opacities[Ee]||this.opacities[Ee].isHidden()||(this.variableOffsets[Ee]=A[Ee]);for(var be in z)this.placedOrientations[be]||!this.opacities[be]||this.opacities[be].isHidden()||(this.placedOrientations[be]=z[be]);u?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:s)},Xr.prototype.updateLayerOpacities=function(s,c){for(var u={},f=0,S=c;f<S.length;f+=1){var A=S[f],z=A.getBucket(s);z&&A.latestFeatureIndex&&s.id===z.layerIds[0]&&this.updateBucketOpacities(z,u,A.collisionBoxArray)}},Xr.prototype.updateBucketOpacities=function(s,c,u){var f=this;s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();var S=s.layers[0].layout,A=new Dn(null,0,!1,!1,!0),z=S.get("text-allow-overlap"),B=S.get("icon-allow-overlap"),q=S.get("text-variable-anchor"),W=S.get("text-rotation-alignment")==="map",oe=S.get("text-pitch-alignment")==="map",se=S.get("icon-text-fit")!=="none",ue=new Dn(null,0,z&&(B||!s.hasIconData()||S.get("icon-optional")),B&&(z||!s.hasTextData()||S.get("text-optional")),!0);!s.collisionArrays&&u&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(u);for(var Ee=function(Te,Le,Ne){for(var We=0;We<Le/4;We++)Te.opacityVertexArray.emplaceBack(Ne)},be=function(Te){var Le=s.symbolInstances.get(Te),Ne=Le.numHorizontalGlyphVertices,We=Le.numVerticalGlyphVertices,He=Le.crossTileID,Je=f.opacities[He];c[He]?Je=A:Je||(f.opacities[He]=Je=ue),c[He]=!0;var ut=Le.numIconVertices>0,_t=f.placedOrientations[Le.crossTileID],gt=_t===y.WritingMode.vertical,Mt=_t===y.WritingMode.horizontal||_t===y.WritingMode.horizontalOnly;if(Ne>0||We>0){var Zt=Fl(Je.text);Ee(s.text,Ne,gt?ia:Zt),Ee(s.text,We,Mt?ia:Zt);var Wt=Je.text.isHidden();[Le.rightJustifiedTextSymbolIndex,Le.centerJustifiedTextSymbolIndex,Le.leftJustifiedTextSymbolIndex].forEach(function(Xt){Xt>=0&&(s.text.placedSymbolArray.get(Xt).hidden=Wt||gt?1:0)}),Le.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get(Le.verticalPlacedTextSymbolIndex).hidden=Wt||Mt?1:0);var Gt=f.variableOffsets[Le.crossTileID];Gt&&f.markUsedJustification(s,Gt.anchor,Le,_t);var Ai=f.placedOrientations[Le.crossTileID];Ai&&(f.markUsedJustification(s,"left",Le,Ai),f.markUsedOrientation(s,Ai,Le))}if(ut){var Ft=Fl(Je.icon),ai=!(se&&Le.verticalPlacedIconSymbolIndex&&gt);Le.placedIconSymbolIndex>=0&&(Ee(s.icon,Le.numIconVertices,ai?Ft:ia),s.icon.placedSymbolArray.get(Le.placedIconSymbolIndex).hidden=Je.icon.isHidden()),Le.verticalPlacedIconSymbolIndex>=0&&(Ee(s.icon,Le.numVerticalIconVertices,ai?ia:Ft),s.icon.placedSymbolArray.get(Le.verticalPlacedIconSymbolIndex).hidden=Je.icon.isHidden())}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){var wi=s.collisionArrays[Te];if(wi){var ni=new y.Point(0,0);if(wi.textBox||wi.verticalTextBox){var ei=!0;if(q){var ci=f.variableOffsets[He];ci?(ni=Er(ci.anchor,ci.width,ci.height,ci.textOffset,ci.textBoxScale),W&&ni._rotate(oe?f.transform.angle:-f.transform.angle)):ei=!1}wi.textBox&&No(s.textCollisionBox.collisionVertexArray,Je.text.placed,!ei||gt,ni.x,ni.y),wi.verticalTextBox&&No(s.textCollisionBox.collisionVertexArray,Je.text.placed,!ei||Mt,ni.x,ni.y)}var Kt=Boolean(!Mt&&wi.verticalIconBox);wi.iconBox&&No(s.iconCollisionBox.collisionVertexArray,Je.icon.placed,Kt,se?ni.x:0,se?ni.y:0),wi.verticalIconBox&&No(s.iconCollisionBox.collisionVertexArray,Je.icon.placed,!Kt,se?ni.x:0,se?ni.y:0)}}},Ce=0;Ce<s.symbolInstances.length;Ce++)be(Ce);if(s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){var me=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=me.invProjMatrix,s.placementViewportMatrix=me.viewportMatrix,s.collisionCircleArray=me.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}},Xr.prototype.symbolFadeChange=function(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Xr.prototype.zoomAdjustment=function(s){return Math.max(0,(this.transform.zoom-s)/1.5)},Xr.prototype.hasTransitions=function(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration},Xr.prototype.stillRecent=function(s,c){var u=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*u>s},Xr.prototype.setStale=function(){this.stale=!0};var Ts=Math.pow(2,25),ol=Math.pow(2,24),Na=Math.pow(2,17),Vr=Math.pow(2,16),os=Math.pow(2,9),Bl=Math.pow(2,8),Ol=Math.pow(2,1);function Fl(s){if(s.opacity===0&&!s.placed)return 0;if(s.opacity===1&&s.placed)return 4294967295;var c=s.placed?1:0,u=Math.floor(127*s.opacity);return u*Ts+c*ol+u*Na+c*Vr+u*os+c*Bl+u*Ol+c}var ia=0,Is=function(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&s.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Is.prototype.continuePlacement=function(s,c,u,f,S){for(var A=this._bucketParts;this._currentTileIndex<s.length;)if(c.getBucketParts(A,f,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort(function(z,B){return z.sortKey-B.sortKey}));this._currentPartIndex<A.length;)if(c.placeLayerBucketPart(A[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,S())return!0;return!1};var As=function(s,c,u,f,S,A,z){this.placement=new Xr(s,S,A,z),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=f,this._done=!1};As.prototype.isDone=function(){return this._done},As.prototype.continuePlacement=function(s,c,u){for(var f=this,S=y.browser.now(),A=function(){var q=y.browser.now()-S;return!f._forceFullPlacement&&q>2};this._currentPlacementIndex>=0;){var z=c[s[this._currentPlacementIndex]],B=this.placement.collisionIndex.transform.zoom;if(z.type==="symbol"&&(!z.minzoom||z.minzoom<=B)&&(!z.maxzoom||z.maxzoom>B)){if(this._inProgressLayer||(this._inProgressLayer=new Is(z)),this._inProgressLayer.continuePlacement(u[z.source],this.placement,this._showCollisionBoxes,z,A))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},As.prototype.commit=function(s){return this.placement.commit(s),this.placement};var pu=512/y.EXTENT/2,as=function(s,c,u){this.tileID=s,this.indexedSymbolInstances={},this.bucketInstanceId=u;for(var f=0;f<c.length;f++){var S=c.get(f),A=S.key;this.indexedSymbolInstances[A]||(this.indexedSymbolInstances[A]=[]),this.indexedSymbolInstances[A].push({crossTileID:S.crossTileID,coord:this.getScaledCoordinates(S,s)})}};as.prototype.getScaledCoordinates=function(s,c){var u=pu/Math.pow(2,c.canonical.z-this.tileID.canonical.z);return{x:Math.floor((c.canonical.x*y.EXTENT+s.anchorX)*u),y:Math.floor((c.canonical.y*y.EXTENT+s.anchorY)*u)}},as.prototype.findMatches=function(s,c,u){for(var f=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),S=0;S<s.length;S++){var A=s.get(S);if(!A.crossTileID){var z=this.indexedSymbolInstances[A.key];if(z)for(var B=this.getScaledCoordinates(A,c),q=0,W=z;q<W.length;q+=1){var oe=W[q];if(Math.abs(oe.coord.x-B.x)<=f&&Math.abs(oe.coord.y-B.y)<=f&&!u[oe.crossTileID]){u[oe.crossTileID]=!0,A.crossTileID=oe.crossTileID;break}}}}};var Xn=function(){this.maxCrossTileID=0};Xn.prototype.generate=function(){return++this.maxCrossTileID};var jo=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};jo.prototype.handleWrapJump=function(s){var c=Math.round((s-this.lng)/360);if(c!==0)for(var u in this.indexes){var f=this.indexes[u],S={};for(var A in f){var z=f[A];z.tileID=z.tileID.unwrapTo(z.tileID.wrap+c),S[z.tileID.key]=z}this.indexes[u]=S}this.lng=s},jo.prototype.addBucket=function(s,c,u){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(var f=0;f<c.symbolInstances.length;f++)c.symbolInstances.get(f).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});var S=this.usedCrossTileIDs[s.overscaledZ];for(var A in this.indexes){var z=this.indexes[A];if(Number(A)>s.overscaledZ)for(var B in z){var q=z[B];q.tileID.isChildOf(s)&&q.findMatches(c.symbolInstances,s,S)}else{var W=z[s.scaledTo(Number(A)).key];W&&W.findMatches(c.symbolInstances,s,S)}}for(var oe=0;oe<c.symbolInstances.length;oe++){var se=c.symbolInstances.get(oe);se.crossTileID||(se.crossTileID=u.generate(),S[se.crossTileID]=!0)}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new as(s,c.symbolInstances,c.bucketInstanceId),!0},jo.prototype.removeBucketCrossTileIDs=function(s,c){for(var u in c.indexedSymbolInstances)for(var f=0,S=c.indexedSymbolInstances[u];f<S.length;f+=1)delete this.usedCrossTileIDs[s][S[f].crossTileID]},jo.prototype.removeStaleBuckets=function(s){var c=!1;for(var u in this.indexes){var f=this.indexes[u];for(var S in f)s[f[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,f[S]),delete f[S],c=!0)}return c};var qo=function(){this.layerIndexes={},this.crossTileIDs=new Xn,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};qo.prototype.addLayer=function(s,c,u){var f=this.layerIndexes[s.id];f===void 0&&(f=this.layerIndexes[s.id]=new jo);var S=!1,A={};f.handleWrapJump(u);for(var z=0,B=c;z<B.length;z+=1){var q=B[z],W=q.getBucket(s);W&&s.id===W.layerIds[0]&&(W.bucketInstanceId||(W.bucketInstanceId=++this.maxBucketInstanceId),f.addBucket(q.tileID,W,this.crossTileIDs)&&(S=!0),A[W.bucketInstanceId]=!0)}return f.removeStaleBuckets(A)&&(S=!0),S},qo.prototype.pruneUnusedLayers=function(s){var c={};for(var u in s.forEach(function(f){c[f]=!0}),this.layerIndexes)c[u]||delete this.layerIndexes[u]};var ba=function(s,c){return y.emitValidationErrors(s,c&&c.filter(function(u){return u.identifier!=="source.canvas"}))},Pi=y.pick(ve,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),wa=y.pick(ve,["setCenter","setZoom","setBearing","setPitch"]),Ea=function(){var s={},c=y.styleSpec.$version;for(var u in y.styleSpec.$root){var f,S=y.styleSpec.$root[u];S.required&&(f=u==="version"?c:S.type==="array"?[]:{})!=null&&(s[u]=f)}return s}(),an=function(s){function c(u,f){var S=this;f===void 0&&(f={}),s.call(this),this.map=u,this.dispatcher=new Ar(le(),this),this.imageManager=new mi,this.imageManager.setEventedParent(this),this.glyphManager=new lr(u._requestManager,f.localIdeographFontFamily),this.lineAtlas=new nr(256,512),this.crossTileSymbolIndex=new qo,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new y.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",y.getReferrer());var A=this;this._rtlTextPluginCallback=c.registerForPluginStateChange(function(z){A.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:z.pluginStatus,pluginURL:z.pluginURL},function(B,q){if(y.triggerPluginCompletionEvent(B),q&&q.every(function(oe){return oe}))for(var W in A.sourceCaches)A.sourceCaches[W].reload()})}),this.on("data",function(z){if(z.dataType==="source"&&z.sourceDataType==="metadata"){var B=S.sourceCaches[z.sourceId];if(B){var q=B.getSource();if(q&&q.vectorLayerIds)for(var W in S._layers){var oe=S._layers[W];oe.source===q.id&&S._validateLayer(oe)}}}})}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.loadURL=function(u,f){var S=this;f===void 0&&(f={}),this.fire(new y.Event("dataloading",{dataType:"style"}));var A=typeof f.validate=="boolean"?f.validate:!y.isMapboxURL(u);u=this.map._requestManager.normalizeStyleURL(u,f.accessToken);var z=this.map._requestManager.transformRequest(u,y.ResourceType.Style);this._request=y.getJSON(z,function(B,q){S._request=null,B?S.fire(new y.ErrorEvent(B)):q&&S._load(q,A)})},c.prototype.loadJSON=function(u,f){var S=this;f===void 0&&(f={}),this.fire(new y.Event("dataloading",{dataType:"style"})),this._request=y.browser.frame(function(){S._request=null,S._load(u,f.validate!==!1)})},c.prototype.loadEmpty=function(){this.fire(new y.Event("dataloading",{dataType:"style"})),this._load(Ea,!1)},c.prototype._load=function(u,f){if(!f||!ba(this,y.validateStyle(u))){for(var S in this._loaded=!0,this.stylesheet=u,u.sources)this.addSource(S,u.sources[S],{validate:!1});u.sprite?this._loadSprite(u.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(u.glyphs);var A=ge(this.stylesheet.layers);this._order=A.map(function(W){return W.id}),this._layers={},this._serializedLayers={};for(var z=0,B=A;z<B.length;z+=1){var q=B[z];(q=y.createStyleLayer(q)).setEventedParent(this,{layer:{id:q.id}}),this._layers[q.id]=q,this._serializedLayers[q.id]=q.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new no(this.stylesheet.light),this.fire(new y.Event("data",{dataType:"style"})),this.fire(new y.Event("style.load"))}},c.prototype._loadSprite=function(u){var f=this;this._spriteRequest=function(S,A,z){var B,q,W,oe=y.browser.devicePixelRatio>1?"@2x":"",se=y.getJSON(A.transformRequest(A.normalizeSpriteURL(S,oe,".json"),y.ResourceType.SpriteJSON),function(be,Ce){se=null,W||(W=be,B=Ce,Ee())}),ue=y.getImage(A.transformRequest(A.normalizeSpriteURL(S,oe,".png"),y.ResourceType.SpriteImage),function(be,Ce){ue=null,W||(W=be,q=Ce,Ee())});function Ee(){if(W)z(W);else if(B&&q){var be=y.browser.getImageData(q),Ce={};for(var me in B){var Te=B[me],Le=Te.width,Ne=Te.height,We=Te.x,He=Te.y,Je=Te.sdf,ut=Te.pixelRatio,_t=Te.stretchX,gt=Te.stretchY,Mt=Te.content,Zt=new y.RGBAImage({width:Le,height:Ne});y.RGBAImage.copy(be,Zt,{x:We,y:He},{x:0,y:0},{width:Le,height:Ne}),Ce[me]={data:Zt,pixelRatio:ut,sdf:Je,stretchX:_t,stretchY:gt,content:Mt}}z(null,Ce)}}return{cancel:function(){se&&(se.cancel(),se=null),ue&&(ue.cancel(),ue=null)}}}(u,this.map._requestManager,function(S,A){if(f._spriteRequest=null,S)f.fire(new y.ErrorEvent(S));else if(A)for(var z in A)f.imageManager.addImage(z,A[z]);f.imageManager.setLoaded(!0),f._availableImages=f.imageManager.listImages(),f.dispatcher.broadcast("setImages",f._availableImages),f.fire(new y.Event("data",{dataType:"style"}))})},c.prototype._validateLayer=function(u){var f=this.sourceCaches[u.source];if(f){var S=u.sourceLayer;if(S){var A=f.getSource();(A.type==="geojson"||A.vectorLayerIds&&A.vectorLayerIds.indexOf(S)===-1)&&this.fire(new y.ErrorEvent(new Error('Source layer "'+S+'" does not exist on source "'+A.id+'" as specified by style layer "'+u.id+'"')))}}},c.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var u in this.sourceCaches)if(!this.sourceCaches[u].loaded())return!1;return!!this.imageManager.isLoaded()},c.prototype._serializeLayers=function(u){for(var f=[],S=0,A=u;S<A.length;S+=1){var z=this._layers[A[S]];z.type!=="custom"&&f.push(z.serialize())}return f},c.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var u in this.sourceCaches)if(this.sourceCaches[u].hasTransition())return!0;for(var f in this._layers)if(this._layers[f].hasTransition())return!0;return!1},c.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},c.prototype.update=function(u){if(this._loaded){var f=this._changed;if(this._changed){var S=Object.keys(this._updatedLayers),A=Object.keys(this._removedLayers);for(var z in(S.length||A.length)&&this._updateWorkerLayers(S,A),this._updatedSources){var B=this._updatedSources[z];B==="reload"?this._reloadSource(z):B==="clear"&&this._clearSource(z)}for(var q in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[q].updateTransitions(u);this.light.updateTransitions(u),this._resetUpdates()}var W={};for(var oe in this.sourceCaches){var se=this.sourceCaches[oe];W[oe]=se.used,se.used=!1}for(var ue=0,Ee=this._order;ue<Ee.length;ue+=1){var be=this._layers[Ee[ue]];be.recalculate(u,this._availableImages),!be.isHidden(u.zoom)&&be.source&&(this.sourceCaches[be.source].used=!0)}for(var Ce in W){var me=this.sourceCaches[Ce];W[Ce]!==me.used&&me.fire(new y.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:Ce}))}this.light.recalculate(u),this.z=u.zoom,f&&this.fire(new y.Event("data",{dataType:"style"}))}},c.prototype._updateTilesForChangedImages=function(){var u=Object.keys(this._changedImages);if(u.length){for(var f in this.sourceCaches)this.sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],u);this._changedImages={}}},c.prototype._updateWorkerLayers=function(u,f){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(u),removedIds:f})},c.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},c.prototype.setState=function(u){var f=this;if(this._checkLoaded(),ba(this,y.validateStyle(u)))return!1;(u=y.clone$1(u)).layers=ge(u.layers);var S=function(z,B){if(!z)return[{command:ve.setStyle,args:[B]}];var q=[];try{if(!y.deepEqual(z.version,B.version))return[{command:ve.setStyle,args:[B]}];y.deepEqual(z.center,B.center)||q.push({command:ve.setCenter,args:[B.center]}),y.deepEqual(z.zoom,B.zoom)||q.push({command:ve.setZoom,args:[B.zoom]}),y.deepEqual(z.bearing,B.bearing)||q.push({command:ve.setBearing,args:[B.bearing]}),y.deepEqual(z.pitch,B.pitch)||q.push({command:ve.setPitch,args:[B.pitch]}),y.deepEqual(z.sprite,B.sprite)||q.push({command:ve.setSprite,args:[B.sprite]}),y.deepEqual(z.glyphs,B.glyphs)||q.push({command:ve.setGlyphs,args:[B.glyphs]}),y.deepEqual(z.transition,B.transition)||q.push({command:ve.setTransition,args:[B.transition]}),y.deepEqual(z.light,B.light)||q.push({command:ve.setLight,args:[B.light]});var W={},oe=[];(function(ue,Ee,be,Ce){var me;for(me in Ee=Ee||{},ue=ue||{})ue.hasOwnProperty(me)&&(Ee.hasOwnProperty(me)||Ue(me,be,Ce));for(me in Ee)Ee.hasOwnProperty(me)&&(ue.hasOwnProperty(me)?y.deepEqual(ue[me],Ee[me])||(ue[me].type==="geojson"&&Ee[me].type==="geojson"&&bt(ue,Ee,me)?be.push({command:ve.setGeoJSONSourceData,args:[me,Ee[me].data]}):Ze(me,Ee,be,Ce)):Ge(me,Ee,be))})(z.sources,B.sources,oe,W);var se=[];z.layers&&z.layers.forEach(function(ue){W[ue.source]?q.push({command:ve.removeLayer,args:[ue.id]}):se.push(ue)}),q=q.concat(oe),function(ue,Ee,be){Ee=Ee||[];var Ce,me,Te,Le,Ne,We,He,Je=(ue=ue||[]).map(vt),ut=Ee.map(vt),_t=ue.reduce(Et,{}),gt=Ee.reduce(Et,{}),Mt=Je.slice(),Zt=Object.create(null);for(Ce=0,me=0;Ce<Je.length;Ce++)gt.hasOwnProperty(Te=Je[Ce])?me++:(be.push({command:ve.removeLayer,args:[Te]}),Mt.splice(Mt.indexOf(Te,me),1));for(Ce=0,me=0;Ce<ut.length;Ce++)Mt[Mt.length-1-Ce]!==(Te=ut[ut.length-1-Ce])&&(_t.hasOwnProperty(Te)?(be.push({command:ve.removeLayer,args:[Te]}),Mt.splice(Mt.lastIndexOf(Te,Mt.length-me),1)):me++,be.push({command:ve.addLayer,args:[gt[Te],We=Mt[Mt.length-Ce]]}),Mt.splice(Mt.length-Ce,0,Te),Zt[Te]=!0);for(Ce=0;Ce<ut.length;Ce++)if(Le=_t[Te=ut[Ce]],Ne=gt[Te],!Zt[Te]&&!y.deepEqual(Le,Ne))if(y.deepEqual(Le.source,Ne.source)&&y.deepEqual(Le["source-layer"],Ne["source-layer"])&&y.deepEqual(Le.type,Ne.type)){for(He in pt(Le.layout,Ne.layout,be,Te,null,ve.setLayoutProperty),pt(Le.paint,Ne.paint,be,Te,null,ve.setPaintProperty),y.deepEqual(Le.filter,Ne.filter)||be.push({command:ve.setFilter,args:[Te,Ne.filter]}),y.deepEqual(Le.minzoom,Ne.minzoom)&&y.deepEqual(Le.maxzoom,Ne.maxzoom)||be.push({command:ve.setLayerZoomRange,args:[Te,Ne.minzoom,Ne.maxzoom]}),Le)Le.hasOwnProperty(He)&&He!=="layout"&&He!=="paint"&&He!=="filter"&&He!=="metadata"&&He!=="minzoom"&&He!=="maxzoom"&&(He.indexOf("paint.")===0?pt(Le[He],Ne[He],be,Te,He.slice(6),ve.setPaintProperty):y.deepEqual(Le[He],Ne[He])||be.push({command:ve.setLayerProperty,args:[Te,He,Ne[He]]}));for(He in Ne)Ne.hasOwnProperty(He)&&!Le.hasOwnProperty(He)&&He!=="layout"&&He!=="paint"&&He!=="filter"&&He!=="metadata"&&He!=="minzoom"&&He!=="maxzoom"&&(He.indexOf("paint.")===0?pt(Le[He],Ne[He],be,Te,He.slice(6),ve.setPaintProperty):y.deepEqual(Le[He],Ne[He])||be.push({command:ve.setLayerProperty,args:[Te,He,Ne[He]]}))}else be.push({command:ve.removeLayer,args:[Te]}),We=Mt[Mt.lastIndexOf(Te)+1],be.push({command:ve.addLayer,args:[Ne,We]})}(se,B.layers,q)}catch(ue){console.warn("Unable to compute style diff:",ue),q=[{command:ve.setStyle,args:[B]}]}return q}(this.serialize(),u).filter(function(z){return!(z.command in wa)});if(S.length===0)return!1;var A=S.filter(function(z){return!(z.command in Pi)});if(A.length>0)throw new Error("Unimplemented: "+A.map(function(z){return z.command}).join(", ")+".");return S.forEach(function(z){z.command!=="setTransition"&&f[z.command].apply(f,z.args)}),this.stylesheet=u,!0},c.prototype.addImage=function(u,f){if(this.getImage(u))return this.fire(new y.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(u,f),this._afterImageUpdated(u)},c.prototype.updateImage=function(u,f){this.imageManager.updateImage(u,f)},c.prototype.getImage=function(u){return this.imageManager.getImage(u)},c.prototype.removeImage=function(u){if(!this.getImage(u))return this.fire(new y.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(u),this._afterImageUpdated(u)},c.prototype._afterImageUpdated=function(u){this._availableImages=this.imageManager.listImages(),this._changedImages[u]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new y.Event("data",{dataType:"style"}))},c.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},c.prototype.addSource=function(u,f,S){var A=this;if(S===void 0&&(S={}),this._checkLoaded(),this.sourceCaches[u]!==void 0)throw new Error("There is already a source with this ID");if(!f.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(f).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(y.validateStyle.source,"sources."+u,f,null,S))){this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);var z=this.sourceCaches[u]=new Ie(u,f,this.dispatcher);z.style=this,z.setEventedParent(this,function(){return{isSourceLoaded:A.loaded(),source:z.serialize(),sourceId:u}}),z.onAdd(this.map),this._changed=!0}},c.prototype.removeSource=function(u){if(this._checkLoaded(),this.sourceCaches[u]===void 0)throw new Error("There is no source with this ID");for(var f in this._layers)if(this._layers[f].source===u)return this.fire(new y.ErrorEvent(new Error('Source "'+u+'" cannot be removed while layer "'+f+'" is using it.')));var S=this.sourceCaches[u];delete this.sourceCaches[u],delete this._updatedSources[u],S.fire(new y.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:u})),S.setEventedParent(null),S.clearTiles(),S.onRemove&&S.onRemove(this.map),this._changed=!0},c.prototype.setGeoJSONSourceData=function(u,f){this._checkLoaded(),this.sourceCaches[u].getSource().setData(f),this._changed=!0},c.prototype.getSource=function(u){return this.sourceCaches[u]&&this.sourceCaches[u].getSource()},c.prototype.addLayer=function(u,f,S){S===void 0&&(S={}),this._checkLoaded();var A=u.id;if(this.getLayer(A))this.fire(new y.ErrorEvent(new Error('Layer with id "'+A+'" already exists on this map')));else{var z;if(u.type==="custom"){if(ba(this,y.validateCustomStyleLayer(u)))return;z=y.createStyleLayer(u)}else{if(typeof u.source=="object"&&(this.addSource(A,u.source),u=y.clone$1(u),u=y.extend(u,{source:A})),this._validate(y.validateStyle.layer,"layers."+A,u,{arrayIndex:-1},S))return;z=y.createStyleLayer(u),this._validateLayer(z),z.setEventedParent(this,{layer:{id:A}}),this._serializedLayers[z.id]=z.serialize()}var B=f?this._order.indexOf(f):this._order.length;if(f&&B===-1)this.fire(new y.ErrorEvent(new Error('Layer with id "'+f+'" does not exist on this map.')));else{if(this._order.splice(B,0,A),this._layerOrderChanged=!0,this._layers[A]=z,this._removedLayers[A]&&z.source&&z.type!=="custom"){var q=this._removedLayers[A];delete this._removedLayers[A],q.type!==z.type?this._updatedSources[z.source]="clear":(this._updatedSources[z.source]="reload",this.sourceCaches[z.source].pause())}this._updateLayer(z),z.onAdd&&z.onAdd(this.map)}}},c.prototype.moveLayer=function(u,f){if(this._checkLoaded(),this._changed=!0,this._layers[u]){if(u!==f){var S=this._order.indexOf(u);this._order.splice(S,1);var A=f?this._order.indexOf(f):this._order.length;f&&A===-1?this.fire(new y.ErrorEvent(new Error('Layer with id "'+f+'" does not exist on this map.'))):(this._order.splice(A,0,u),this._layerOrderChanged=!0)}}else this.fire(new y.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style and cannot be moved.")))},c.prototype.removeLayer=function(u){this._checkLoaded();var f=this._layers[u];if(f){f.setEventedParent(null);var S=this._order.indexOf(u);this._order.splice(S,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[u]=f,delete this._layers[u],delete this._serializedLayers[u],delete this._updatedLayers[u],delete this._updatedPaintProps[u],f.onRemove&&f.onRemove(this.map)}else this.fire(new y.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style and cannot be removed.")))},c.prototype.getLayer=function(u){return this._layers[u]},c.prototype.hasLayer=function(u){return u in this._layers},c.prototype.setLayerZoomRange=function(u,f,S){this._checkLoaded();var A=this.getLayer(u);A?A.minzoom===f&&A.maxzoom===S||(f!=null&&(A.minzoom=f),S!=null&&(A.maxzoom=S),this._updateLayer(A)):this.fire(new y.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style and cannot have zoom extent.")))},c.prototype.setFilter=function(u,f,S){S===void 0&&(S={}),this._checkLoaded();var A=this.getLayer(u);if(A){if(!y.deepEqual(A.filter,f))return f==null?(A.filter=void 0,void this._updateLayer(A)):void(this._validate(y.validateStyle.filter,"layers."+A.id+".filter",f,null,S)||(A.filter=y.clone$1(f),this._updateLayer(A)))}else this.fire(new y.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style and cannot be filtered.")))},c.prototype.getFilter=function(u){return y.clone$1(this.getLayer(u).filter)},c.prototype.setLayoutProperty=function(u,f,S,A){A===void 0&&(A={}),this._checkLoaded();var z=this.getLayer(u);z?y.deepEqual(z.getLayoutProperty(f),S)||(z.setLayoutProperty(f,S,A),this._updateLayer(z)):this.fire(new y.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style and cannot be styled.")))},c.prototype.getLayoutProperty=function(u,f){var S=this.getLayer(u);if(S)return S.getLayoutProperty(f);this.fire(new y.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style.")))},c.prototype.setPaintProperty=function(u,f,S,A){A===void 0&&(A={}),this._checkLoaded();var z=this.getLayer(u);z?y.deepEqual(z.getPaintProperty(f),S)||(z.setPaintProperty(f,S,A)&&this._updateLayer(z),this._changed=!0,this._updatedPaintProps[u]=!0):this.fire(new y.ErrorEvent(new Error("The layer '"+u+"' does not exist in the map's style and cannot be styled.")))},c.prototype.getPaintProperty=function(u,f){return this.getLayer(u).getPaintProperty(f)},c.prototype.setFeatureState=function(u,f){this._checkLoaded();var S=u.source,A=u.sourceLayer,z=this.sourceCaches[S];if(z!==void 0){var B=z.getSource().type;B==="geojson"&&A?this.fire(new y.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):B!=="vector"||A?(u.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),z.setFeatureState(A,u.id,f)):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},c.prototype.removeFeatureState=function(u,f){this._checkLoaded();var S=u.source,A=this.sourceCaches[S];if(A!==void 0){var z=A.getSource().type,B=z==="vector"?u.sourceLayer:void 0;z!=="vector"||B?f&&typeof u.id!="string"&&typeof u.id!="number"?this.fire(new y.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):A.removeFeatureState(B,u.id,f):this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},c.prototype.getFeatureState=function(u){this._checkLoaded();var f=u.source,S=u.sourceLayer,A=this.sourceCaches[f];if(A!==void 0){if(A.getSource().type!=="vector"||S)return u.id===void 0&&this.fire(new y.ErrorEvent(new Error("The feature id parameter must be provided."))),A.getFeatureState(S,u.id);this.fire(new y.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new y.ErrorEvent(new Error("The source '"+f+"' does not exist in the map's style.")))},c.prototype.getTransition=function(){return y.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},c.prototype.serialize=function(){return y.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:y.mapObject(this.sourceCaches,function(u){return u.serialize()}),layers:this._serializeLayers(this._order)},function(u){return u!==void 0})},c.prototype._updateLayer=function(u){this._updatedLayers[u.id]=!0,u.source&&!this._updatedSources[u.source]&&this.sourceCaches[u.source].getSource().type!=="raster"&&(this._updatedSources[u.source]="reload",this.sourceCaches[u.source].pause()),this._changed=!0},c.prototype._flattenAndSortRenderedFeatures=function(u){for(var f=this,S=function(_t){return f._layers[_t].type==="fill-extrusion"},A={},z=[],B=this._order.length-1;B>=0;B--){var q=this._order[B];if(S(q)){A[q]=B;for(var W=0,oe=u;W<oe.length;W+=1){var se=oe[W][q];if(se)for(var ue=0,Ee=se;ue<Ee.length;ue+=1)z.push(Ee[ue])}}}z.sort(function(_t,gt){return gt.intersectionZ-_t.intersectionZ});for(var be=[],Ce=this._order.length-1;Ce>=0;Ce--){var me=this._order[Ce];if(S(me))for(var Te=z.length-1;Te>=0;Te--){var Le=z[Te].feature;if(A[Le.layer.id]<Ce)break;be.push(Le),z.pop()}else for(var Ne=0,We=u;Ne<We.length;Ne+=1){var He=We[Ne][me];if(He)for(var Je=0,ut=He;Je<ut.length;Je+=1)be.push(ut[Je].feature)}}return be},c.prototype.queryRenderedFeatures=function(u,f,S){f&&f.filter&&this._validate(y.validateStyle.filter,"queryRenderedFeatures.filter",f.filter,null,f);var A={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new y.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var z=0,B=f.layers;z<B.length;z+=1){var q=B[z],W=this._layers[q];if(!W)return this.fire(new y.ErrorEvent(new Error("The layer '"+q+"' does not exist in the map's style and cannot be queried for features."))),[];A[W.source]=!0}}var oe=[];for(var se in f.availableImages=this._availableImages,this.sourceCaches)f.layers&&!A[se]||oe.push(_r(this.sourceCaches[se],this._layers,this._serializedLayers,u,f,S));return this.placement&&oe.push(function(ue,Ee,be,Ce,me,Te,Le){for(var Ne={},We=Te.queryRenderedSymbols(Ce),He=[],Je=0,ut=Object.keys(We).map(Number);Je<ut.length;Je+=1)He.push(Le[ut[Je]]);He.sort(dn);for(var _t=function(){var Gt=Mt[gt],Ai=Gt.featureIndex.lookupSymbolFeatures(We[Gt.bucketInstanceId],Ee,Gt.bucketIndex,Gt.sourceLayerIndex,me.filter,me.layers,me.availableImages,ue);for(var Ft in Ai){var ai=Ne[Ft]=Ne[Ft]||[],wi=Ai[Ft];wi.sort(function(ci,Kt){var Xt=Gt.featureSortOrder;if(Xt){var yr=Xt.indexOf(ci.featureIndex);return Xt.indexOf(Kt.featureIndex)-yr}return Kt.featureIndex-ci.featureIndex});for(var ni=0,ei=wi;ni<ei.length;ni+=1)ai.push(ei[ni])}},gt=0,Mt=He;gt<Mt.length;gt+=1)_t();var Zt=function(Gt){Ne[Gt].forEach(function(Ai){var Ft=Ai.feature,ai=be[ue[Gt].source].getFeatureState(Ft.layer["source-layer"],Ft.id);Ft.source=Ft.layer.source,Ft.layer["source-layer"]&&(Ft.sourceLayer=Ft.layer["source-layer"]),Ft.state=ai})};for(var Wt in Ne)Zt(Wt);return Ne}(this._layers,this._serializedLayers,this.sourceCaches,u,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(oe)},c.prototype.querySourceFeatures=function(u,f){f&&f.filter&&this._validate(y.validateStyle.filter,"querySourceFeatures.filter",f.filter,null,f);var S=this.sourceCaches[u];return S?function(A,z){for(var B=A.getRenderableIds().map(function(Ee){return A.getTileByID(Ee)}),q=[],W={},oe=0;oe<B.length;oe++){var se=B[oe],ue=se.tileID.canonical.key;W[ue]||(W[ue]=!0,se.querySourceFeatures(q,z))}return q}(S,f):[]},c.prototype.addSourceType=function(u,f,S){return c.getSourceType(u)?S(new Error('A source type called "'+u+'" already exists.')):(c.setSourceType(u,f),f.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:u,url:f.workerSourceURL},S):S(null,null))},c.prototype.getLight=function(){return this.light.getLight()},c.prototype.setLight=function(u,f){f===void 0&&(f={}),this._checkLoaded();var S=this.light.getLight(),A=!1;for(var z in u)if(!y.deepEqual(u[z],S[z])){A=!0;break}if(A){var B={now:y.browser.now(),transition:y.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(u,f),this.light.updateTransitions(B)}},c.prototype._validate=function(u,f,S,A,z){return z===void 0&&(z={}),(!z||z.validate!==!1)&&ba(this,u.call(y.validateStyle,y.extend({key:f,style:this.serialize(),value:S,styleSpec:y.styleSpec},A)))},c.prototype._remove=function(){for(var u in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),y.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[u].setEventedParent(null);for(var f in this.sourceCaches)this.sourceCaches[f].clearTiles(),this.sourceCaches[f].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},c.prototype._clearSource=function(u){this.sourceCaches[u].clearTiles()},c.prototype._reloadSource=function(u){this.sourceCaches[u].resume(),this.sourceCaches[u].reload()},c.prototype._updateSources=function(u){for(var f in this.sourceCaches)this.sourceCaches[f].update(u)},c.prototype._generateCollisionBoxes=function(){for(var u in this.sourceCaches)this._reloadSource(u)},c.prototype._updatePlacement=function(u,f,S,A,z){z===void 0&&(z=!1);for(var B=!1,q=!1,W={},oe=0,se=this._order;oe<se.length;oe+=1){var ue=this._layers[se[oe]];if(ue.type==="symbol"){if(!W[ue.source]){var Ee=this.sourceCaches[ue.source];W[ue.source]=Ee.getRenderableIds(!0).map(function(Le){return Ee.getTileByID(Le)}).sort(function(Le,Ne){return Ne.tileID.overscaledZ-Le.tileID.overscaledZ||(Le.tileID.isLessThan(Ne.tileID)?-1:1)})}var be=this.crossTileSymbolIndex.addLayer(ue,W[ue.source],u.center.lng);B=B||be}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((z=z||this._layerOrderChanged||S===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(y.browser.now(),u.zoom))&&(this.pauseablePlacement=new As(u,this._order,z,f,S,A,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,W),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(y.browser.now()),q=!0),B&&this.pauseablePlacement.placement.setStale()),q||B)for(var Ce=0,me=this._order;Ce<me.length;Ce+=1){var Te=this._layers[me[Ce]];Te.type==="symbol"&&this.placement.updateLayerOpacities(Te,W[Te.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(y.browser.now())},c.prototype._releaseSymbolFadeTiles=function(){for(var u in this.sourceCaches)this.sourceCaches[u].releaseSymbolFadeTiles()},c.prototype.getImages=function(u,f,S){this.imageManager.getImages(f.icons,S),this._updateTilesForChangedImages();var A=this.sourceCaches[f.source];A&&A.setDependencies(f.tileID.key,f.type,f.icons)},c.prototype.getGlyphs=function(u,f,S){this.glyphManager.getGlyphs(f.stacks,S)},c.prototype.getResource=function(u,f,S){return y.makeRequest(f,S)},c}(y.Evented);an.getSourceType=function(s){return Nn[s]},an.setSourceType=function(s,c){Nn[s]=c},an.registerForPluginStateChange=y.registerForPluginStateChange;var Sr=y.createLayout([{name:"a_pos",type:"Int16",components:2}]),sn=Xi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),al=Xi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),sl=Xi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),ll=Xi(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Cs=Xi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),zs=Xi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),ss=Xi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Ps=Xi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),ul=Xi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),ks=Xi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),du=Xi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),ls=Xi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Go=Xi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fu=Xi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),ln=Xi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Ul=Xi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Sa=Xi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Ta=Xi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),ja=Xi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),ra=Xi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Zo=Xi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),wo=Xi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Ia=Xi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),na=Xi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),cl=Xi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Aa=Xi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Xi(s,c){var u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=c.match(/attribute ([\w]+) ([\w]+)/g),S=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),A=c.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),z=A?A.concat(S):S,B={};return{fragmentSource:s=s.replace(u,function(q,W,oe,se,ue){return B[ue]=!0,W==="define"?`
#ifndef HAS_UNIFORM_u_`+ue+`
varying `+oe+" "+se+" "+ue+`;
#else
uniform `+oe+" "+se+" u_"+ue+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+ue+`
    `+oe+" "+se+" "+ue+" = u_"+ue+`;
#endif
`}),vertexSource:c=c.replace(u,function(q,W,oe,se,ue){var Ee=se==="float"?"vec2":"vec4",be=ue.match(/color/)?"color":Ee;return B[ue]?W==="define"?`
#ifndef HAS_UNIFORM_u_`+ue+`
uniform lowp float u_`+ue+`_t;
attribute `+oe+" "+Ee+" a_"+ue+`;
varying `+oe+" "+se+" "+ue+`;
#else
uniform `+oe+" "+se+" u_"+ue+`;
#endif
`:be==="vec4"?`
#ifndef HAS_UNIFORM_u_`+ue+`
    `+ue+" = a_"+ue+`;
#else
    `+oe+" "+se+" "+ue+" = u_"+ue+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+ue+`
    `+ue+" = unpack_mix_"+be+"(a_"+ue+", u_"+ue+`_t);
#else
    `+oe+" "+se+" "+ue+" = u_"+ue+`;
#endif
`:W==="define"?`
#ifndef HAS_UNIFORM_u_`+ue+`
uniform lowp float u_`+ue+`_t;
attribute `+oe+" "+Ee+" a_"+ue+`;
#else
uniform `+oe+" "+se+" u_"+ue+`;
#endif
`:be==="vec4"?`
#ifndef HAS_UNIFORM_u_`+ue+`
    `+oe+" "+se+" "+ue+" = a_"+ue+`;
#else
    `+oe+" "+se+" "+ue+" = u_"+ue+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+ue+`
    `+oe+" "+se+" "+ue+" = unpack_mix_"+be+"(a_"+ue+", u_"+ue+`_t);
#else
    `+oe+" "+se+" "+ue+" = u_"+ue+`;
#endif
`}),staticAttributes:f,staticUniforms:z}}var qa=Object.freeze({__proto__:null,prelude:sn,background:al,backgroundPattern:sl,circle:ll,clippingMask:Cs,heatmap:zs,heatmapTexture:ss,collisionBox:Ps,collisionCircle:ul,debug:ks,fill:du,fillOutline:ls,fillOutlinePattern:Go,fillPattern:fu,fillExtrusion:ln,fillExtrusionPattern:Ul,hillshadePrepare:Sa,hillshade:Ta,line:ja,lineGradient:ra,linePattern:Zo,lineSDF:wo,raster:Ia,symbolIcon:na,symbolSDF:cl,symbolTextAndIcon:Aa}),oa=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Vl(s){for(var c=[],u=0;u<s.length;u++)if(s[u]!==null){var f=s[u].split(" ");c.push(f.pop())}return c}oa.prototype.bind=function(s,c,u,f,S,A,z,B){this.context=s;for(var q=this.boundPaintVertexBuffers.length!==f.length,W=0;!q&&W<f.length;W++)this.boundPaintVertexBuffers[W]!==f[W]&&(q=!0);s.extVertexArrayObject&&this.vao&&this.boundProgram===c&&this.boundLayoutVertexBuffer===u&&!q&&this.boundIndexBuffer===S&&this.boundVertexOffset===A&&this.boundDynamicVertexBuffer===z&&this.boundDynamicVertexBuffer2===B?(s.bindVertexArrayOES.set(this.vao),z&&z.bind(),S&&S.dynamicDraw&&S.bind(),B&&B.bind()):this.freshBind(c,u,f,S,A,z,B)},oa.prototype.freshBind=function(s,c,u,f,S,A,z){var B,q=s.numAttributes,W=this.context,oe=W.gl;if(W.extVertexArrayObject)this.vao&&this.destroy(),this.vao=W.extVertexArrayObject.createVertexArrayOES(),W.bindVertexArrayOES.set(this.vao),B=0,this.boundProgram=s,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=f,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=A,this.boundDynamicVertexBuffer2=z;else{B=W.currentNumAttributes||0;for(var se=q;se<B;se++)oe.disableVertexAttribArray(se)}c.enableAttributes(oe,s);for(var ue=0,Ee=u;ue<Ee.length;ue+=1)Ee[ue].enableAttributes(oe,s);A&&A.enableAttributes(oe,s),z&&z.enableAttributes(oe,s),c.bind(),c.setVertexAttribPointers(oe,s,S);for(var be=0,Ce=u;be<Ce.length;be+=1){var me=Ce[be];me.bind(),me.setVertexAttribPointers(oe,s,S)}A&&(A.bind(),A.setVertexAttribPointers(oe,s,S)),f&&f.bind(),z&&(z.bind(),z.setVertexAttribPointers(oe,s,S)),W.currentNumAttributes=q},oa.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var hl=function(s,c,u,f,S,A){var z=s.gl;this.program=z.createProgram();for(var B=Vl(u.staticAttributes),q=f?f.getBinderAttributes():[],W=B.concat(q),oe=u.staticUniforms?Vl(u.staticUniforms):[],se=f?f.getBinderUniforms():[],ue=[],Ee=0,be=oe.concat(se);Ee<be.length;Ee+=1){var Ce=be[Ee];ue.indexOf(Ce)<0&&ue.push(Ce)}var me=f?f.defines():[];A&&me.push("#define OVERDRAW_INSPECTOR;");var Te=me.concat(sn.fragmentSource,u.fragmentSource).join(`
`),Le=me.concat(sn.vertexSource,u.vertexSource).join(`
`),Ne=z.createShader(z.FRAGMENT_SHADER);if(z.isContextLost())this.failedToCreate=!0;else{z.shaderSource(Ne,Te),z.compileShader(Ne),z.attachShader(this.program,Ne);var We=z.createShader(z.VERTEX_SHADER);if(z.isContextLost())this.failedToCreate=!0;else{z.shaderSource(We,Le),z.compileShader(We),z.attachShader(this.program,We),this.attributes={};var He={};this.numAttributes=W.length;for(var Je=0;Je<this.numAttributes;Je++)W[Je]&&(z.bindAttribLocation(this.program,Je,W[Je]),this.attributes[W[Je]]=Je);z.linkProgram(this.program),z.deleteShader(We),z.deleteShader(Ne);for(var ut=0;ut<ue.length;ut++){var _t=ue[ut];if(_t&&!He[_t]){var gt=z.getUniformLocation(this.program,_t);gt&&(He[_t]=gt)}}this.fixedUniforms=S(s,He),this.binderUniforms=f?f.getUniforms(s,He):[]}}};function _i(s,c,u){var f=1/tr(u,1,c.transform.tileZoom),S=Math.pow(2,u.tileID.overscaledZ),A=u.tileSize*Math.pow(2,c.transform.tileZoom)/S,z=A*(u.tileID.canonical.x+u.tileID.wrap*S),B=A*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[f,s.fromScale,s.toScale],u_fade:s.t,u_pixel_coord_upper:[z>>16,B>>16],u_pixel_coord_lower:[65535&z,65535&B]}}hl.prototype.draw=function(s,c,u,f,S,A,z,B,q,W,oe,se,ue,Ee,be,Ce){var me,Te=s.gl;if(!this.failedToCreate){for(var Le in s.program.set(this.program),s.setDepthMode(u),s.setStencilMode(f),s.setColorMode(S),s.setCullFace(A),this.fixedUniforms)this.fixedUniforms[Le].set(z[Le]);Ee&&Ee.setUniforms(s,this.binderUniforms,se,{zoom:ue});for(var Ne=(me={},me[Te.LINES]=2,me[Te.TRIANGLES]=3,me[Te.LINE_STRIP]=1,me)[c],We=0,He=oe.get();We<He.length;We+=1){var Je=He[We],ut=Je.vaos||(Je.vaos={});(ut[B]||(ut[B]=new oa)).bind(s,this,q,Ee?Ee.getPaintVertexBuffers():[],W,Je.vertexOffset,be,Ce),Te.drawElements(c,Je.primitiveLength*Ne,Te.UNSIGNED_SHORT,Je.primitiveOffset*Ne*2)}}};var Ms=function(s,c,u,f){var S=c.style.light,A=S.properties.get("position"),z=[A.x,A.y,A.z],B=y.create$1();S.properties.get("anchor")==="viewport"&&y.fromRotation(B,-c.transform.angle),y.transformMat3(z,z,B);var q=S.properties.get("color");return{u_matrix:s,u_lightpos:z,u_lightintensity:S.properties.get("intensity"),u_lightcolor:[q.r,q.g,q.b],u_vertical_gradient:+u,u_opacity:f}},Di=function(s,c,u,f,S,A,z){return y.extend(Ms(s,c,u,f),_i(A,c,z),{u_height_factor:-Math.pow(2,S.overscaledZ)/z.tileSize/8})},Po=function(s){return{u_matrix:s}},Yi=function(s,c,u,f){return y.extend(Po(s),_i(u,c,f))},Tr=function(s,c){return{u_matrix:s,u_world:c}},Ls=function(s,c,u,f,S){return y.extend(Yi(s,c,u,f),{u_world:S})},Ds=function(s,c,u,f){var S,A,z=s.transform;if(f.paint.get("circle-pitch-alignment")==="map"){var B=tr(u,1,z.zoom);S=!0,A=[B,B]}else S=!1,A=z.pixelsToGLUnits;return{u_camera_to_center_distance:z.cameraToCenterDistance,u_scale_with_map:+(f.paint.get("circle-pitch-scale")==="map"),u_matrix:s.translatePosMatrix(c.posMatrix,u,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_pitch_with_map:+S,u_device_pixel_ratio:y.browser.devicePixelRatio,u_extrude_scale:A}},Ga=function(s,c,u){var f=tr(u,1,c.zoom),S=Math.pow(2,c.zoom-u.tileID.overscaledZ),A=u.tileID.overscaleFactor();return{u_matrix:s,u_camera_to_center_distance:c.cameraToCenterDistance,u_pixels_to_tile_units:f,u_extrude_scale:[c.pixelsToGLUnits[0]/(f*S),c.pixelsToGLUnits[1]/(f*S)],u_overscale_factor:A}},pl=function(s,c,u){return{u_matrix:s,u_inv_matrix:c,u_camera_to_center_distance:u.cameraToCenterDistance,u_viewport_size:[u.width,u.height]}},$o=function(s,c,u){return u===void 0&&(u=1),{u_matrix:s,u_color:c,u_overlay:0,u_overlay_scale:u}},Xo=function(s){return{u_matrix:s}},Rs=function(s,c,u,f){return{u_matrix:s,u_extrude_scale:tr(c,1,u),u_intensity:f}},Ca=function(s,c,u){var f=s.transform;return{u_matrix:Nl(s,c,u),u_ratio:1/tr(c,1,f.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},Qi=function(s,c,u,f){return y.extend(Ca(s,c,u),{u_image:0,u_image_height:f})},aa=function(s,c,u,f){var S=s.transform,A=Sn(c,S);return{u_matrix:Nl(s,c,u),u_texsize:c.imageAtlasTexture.size,u_ratio:1/tr(c,1,S.zoom),u_device_pixel_ratio:y.browser.devicePixelRatio,u_image:0,u_scale:[A,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},dl=function(s,c,u,f,S){var A=s.lineAtlas,z=Sn(c,s.transform),B=u.layout.get("line-cap")==="round",q=A.getDash(f.from,B),W=A.getDash(f.to,B),oe=q.width*S.fromScale,se=W.width*S.toScale;return y.extend(Ca(s,c,u),{u_patternscale_a:[z/oe,-q.height/2],u_patternscale_b:[z/se,-W.height/2],u_sdfgamma:A.width/(256*Math.min(oe,se)*y.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:q.y,u_tex_y_b:W.y,u_mix:S.t})};function Sn(s,c){return 1/tr(s,1,c.tileZoom)}function Nl(s,c,u){return s.translatePosMatrix(c.tileID.posMatrix,c,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}var mu=function(s,c,u,f,S){return{u_matrix:s,u_tl_parent:c,u_scale_parent:u,u_buffer_scale:1,u_fade_t:f.mix,u_opacity:f.opacity*S.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:S.paint.get("raster-brightness-min"),u_brightness_high:S.paint.get("raster-brightness-max"),u_saturation_factor:(z=S.paint.get("raster-saturation"),z>0?1-1/(1.001-z):-z),u_contrast_factor:(A=S.paint.get("raster-contrast"),A>0?1/(1-A):1+A),u_spin_weights:jl(S.paint.get("raster-hue-rotate"))};var A,z};function jl(s){s*=Math.PI/180;var c=Math.sin(s),u=Math.cos(s);return[(2*u+1)/3,(-Math.sqrt(3)*c-u+1)/3,(Math.sqrt(3)*c-u+1)/3]}var sa,la=function(s,c,u,f,S,A,z,B,q,W){var oe=S.transform;return{u_is_size_zoom_constant:+(s==="constant"||s==="source"),u_is_size_feature_constant:+(s==="constant"||s==="camera"),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:oe.cameraToCenterDistance,u_pitch:oe.pitch/360*2*Math.PI,u_rotate_symbol:+u,u_aspect_ratio:oe.width/oe.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_matrix:A,u_label_plane_matrix:z,u_coord_matrix:B,u_is_text:+q,u_pitch_with_map:+f,u_texsize:W,u_texture:0}},Za=function(s,c,u,f,S,A,z,B,q,W,oe){var se=S.transform;return y.extend(la(s,c,u,f,S,A,z,B,q,W),{u_gamma_scale:f?Math.cos(se._pitch)*se.cameraToCenterDistance:1,u_device_pixel_ratio:y.browser.devicePixelRatio,u_is_halo:+oe})},Bs=function(s,c,u,f,S,A,z,B,q,W){return y.extend(Za(s,c,u,f,S,A,z,B,!0,q,!0),{u_texsize_icon:W,u_texture_icon:1})},za=function(s,c,u){return{u_matrix:s,u_opacity:c,u_color:u}},ua=function(s,c,u,f,S,A){return y.extend(function(z,B,q,W){var oe=q.imageManager.getPattern(z.from.toString()),se=q.imageManager.getPattern(z.to.toString()),ue=q.imageManager.getPixelSize(),Ee=ue.width,be=ue.height,Ce=Math.pow(2,W.tileID.overscaledZ),me=W.tileSize*Math.pow(2,q.transform.tileZoom)/Ce,Te=me*(W.tileID.canonical.x+W.tileID.wrap*Ce),Le=me*W.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:oe.tl,u_pattern_br_a:oe.br,u_pattern_tl_b:se.tl,u_pattern_br_b:se.br,u_texsize:[Ee,be],u_mix:B.t,u_pattern_size_a:oe.displaySize,u_pattern_size_b:se.displaySize,u_scale_a:B.fromScale,u_scale_b:B.toScale,u_tile_units_to_pixels:1/tr(W,1,q.transform.tileZoom),u_pixel_coord_upper:[Te>>16,Le>>16],u_pixel_coord_lower:[65535&Te,65535&Le]}}(f,A,u,S),{u_matrix:s,u_opacity:c})},ql={fillExtrusion:function(s,c){return{u_matrix:new y.UniformMatrix4f(s,c.u_matrix),u_lightpos:new y.Uniform3f(s,c.u_lightpos),u_lightintensity:new y.Uniform1f(s,c.u_lightintensity),u_lightcolor:new y.Uniform3f(s,c.u_lightcolor),u_vertical_gradient:new y.Uniform1f(s,c.u_vertical_gradient),u_opacity:new y.Uniform1f(s,c.u_opacity)}},fillExtrusionPattern:function(s,c){return{u_matrix:new y.UniformMatrix4f(s,c.u_matrix),u_lightpos:new y.Uniform3f(s,c.u_lightpos),u_lightintensity:new y.Uniform1f(s,c.u_lightintensity),u_lightcolor:new y.Uniform3f(s,c.u_lightcolor),u_vertical_gradient:new y.Uniform1f(s,c.u_vertical_gradient),u_height_factor:new y.Uniform1f(s,c.u_height_factor),u_image:new y.Uniform1i(s,c.u_image),u_texsize:new y.Uniform2f(s,c.u_texsize),u_pixel_coord_upper:new y.Uniform2f(s,c.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(s,c.u_pixel_coord_lower),u_scale:new y.Uniform3f(s,c.u_scale),u_fade:new y.Uniform1f(s,c.u_fade),u_opacity:new y.Uniform1f(s,c.u_opacity)}},fill:function(s,c){return{u_matrix:new y.UniformMatrix4f(s,c.u_matrix)}},fillPattern:function(s,c){return{u_matrix:new y.UniformMatrix4f(s,c.u_matrix),u_image:new y.Uniform1i(s,c.u_image),u_texsize:new y.Uniform2f(s,c.u_texsize),u_pixel_coord_upper:new y.Uniform2f(s,c.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(s,c.u_pixel_coord_lower),u_scale:new y.Uniform3f(s,c.u_scale),u_fade:new y.Uniform1f(s,c.u_fade)}},fillOutline:function(s,c){return{u_matrix:new y.UniformMatrix4f(s,c.u_matrix),u_world:new y.Uniform2f(s,c.u_world)}},fillOutlinePattern:function(s,c){return{u_matrix:new y.UniformMatrix4f(s,c.u_matrix),u_world:new y.Uniform2f(s,c.u_world),u_image:new y.Uniform1i(s,c.u_image),u_texsize:new y.Uniform2f(s,c.u_texsize),u_pixel_coord_upper:new y.Uniform2f(s,c.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(s,c.u_pixel_coord_lower),u_scale:new y.Uniform3f(s,c.u_scale),u_fade:new y.Uniform1f(s,c.u_fade)}},circle:function(s,c){return{u_camera_to_center_distance:new y.Uniform1f(s,c.u_camera_to_center_distance),u_scale_with_map:new y.Uniform1i(s,c.u_scale_with_map),u_pitch_with_map:new y.Uniform1i(s,c.u_pitch_with_map),u_extrude_scale:new y.Uniform2f(s,c.u_extrude_scale),u_device_pixel_ratio:new y.Uniform1f(s,c.u_device_pixel_ratio),u_matrix:new y.UniformMatrix4f(s,c.u_matrix)}},collisionBox:function(s,c){return{u_matrix:new y.UniformMatrix4f(s,c.u_matrix),u_camera_to_center_distance:new y.Uniform1f(s,c.u_camera_to_center_distance),u_pixels_to_tile_units:new y.Uniform1f(s,c.u_pixels_to_tile_units),u_extrude_scale:new y.Uniform2f(s,c.u_extrude_scale),u_overscale_factor:new y.Uniform1f(s,c.u_overscale_factor)}},collisionCircle:function(s,c){return{u_matrix:new y.UniformMatrix4f(s,c.u_matrix),u_inv_matrix:new y.UniformMatrix4f(s,c.u_inv_matrix),u_camera_to_center_distance:new y.Uniform1f(s,c.u_camera_to_center_distance),u_viewport_size:new y.Uniform2f(s,c.u_viewport_size)}},debug:function(s,c){return{u_color:new y.UniformColor(s,c.u_color),u_matrix:new y.UniformMatrix4f(s,c.u_matrix),u_overlay:new y.Uniform1i(s,c.u_overlay),u_overlay_scale:new y.Uniform1f(s,c.u_overlay_scale)}},clippingMask:function(s,c){return{u_matrix:new y.UniformMatrix4f(s,c.u_matrix)}},heatmap:function(s,c){return{u_extrude_scale:new y.Uniform1f(s,c.u_extrude_scale),u_intensity:new y.Uniform1f(s,c.u_intensity),u_matrix:new y.UniformMatrix4f(s,c.u_matrix)}},heatmapTexture:function(s,c){return{u_matrix:new y.UniformMatrix4f(s,c.u_matrix),u_world:new y.Uniform2f(s,c.u_world),u_image:new y.Uniform1i(s,c.u_image),u_color_ramp:new y.Uniform1i(s,c.u_color_ramp),u_opacity:new y.Uniform1f(s,c.u_opacity)}},hillshade:function(s,c){return{u_matrix:new y.UniformMatrix4f(s,c.u_matrix),u_image:new y.Uniform1i(s,c.u_image),u_latrange:new y.Uniform2f(s,c.u_latrange),u_light:new y.Uniform2f(s,c.u_light),u_shadow:new y.UniformColor(s,c.u_shadow),u_highlight:new y.UniformColor(s,c.u_highlight),u_accent:new y.UniformColor(s,c.u_accent)}},hillshadePrepare:function(s,c){return{u_matrix:new y.UniformMatrix4f(s,c.u_matrix),u_image:new y.Uniform1i(s,c.u_image),u_dimension:new y.Uniform2f(s,c.u_dimension),u_zoom:new y.Uniform1f(s,c.u_zoom),u_unpack:new y.Uniform4f(s,c.u_unpack)}},line:function(s,c){return{u_matrix:new y.UniformMatrix4f(s,c.u_matrix),u_ratio:new y.Uniform1f(s,c.u_ratio),u_device_pixel_ratio:new y.Uniform1f(s,c.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(s,c.u_units_to_pixels)}},lineGradient:function(s,c){return{u_matrix:new y.UniformMatrix4f(s,c.u_matrix),u_ratio:new y.Uniform1f(s,c.u_ratio),u_device_pixel_ratio:new y.Uniform1f(s,c.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(s,c.u_units_to_pixels),u_image:new y.Uniform1i(s,c.u_image),u_image_height:new y.Uniform1f(s,c.u_image_height)}},linePattern:function(s,c){return{u_matrix:new y.UniformMatrix4f(s,c.u_matrix),u_texsize:new y.Uniform2f(s,c.u_texsize),u_ratio:new y.Uniform1f(s,c.u_ratio),u_device_pixel_ratio:new y.Uniform1f(s,c.u_device_pixel_ratio),u_image:new y.Uniform1i(s,c.u_image),u_units_to_pixels:new y.Uniform2f(s,c.u_units_to_pixels),u_scale:new y.Uniform3f(s,c.u_scale),u_fade:new y.Uniform1f(s,c.u_fade)}},lineSDF:function(s,c){return{u_matrix:new y.UniformMatrix4f(s,c.u_matrix),u_ratio:new y.Uniform1f(s,c.u_ratio),u_device_pixel_ratio:new y.Uniform1f(s,c.u_device_pixel_ratio),u_units_to_pixels:new y.Uniform2f(s,c.u_units_to_pixels),u_patternscale_a:new y.Uniform2f(s,c.u_patternscale_a),u_patternscale_b:new y.Uniform2f(s,c.u_patternscale_b),u_sdfgamma:new y.Uniform1f(s,c.u_sdfgamma),u_image:new y.Uniform1i(s,c.u_image),u_tex_y_a:new y.Uniform1f(s,c.u_tex_y_a),u_tex_y_b:new y.Uniform1f(s,c.u_tex_y_b),u_mix:new y.Uniform1f(s,c.u_mix)}},raster:function(s,c){return{u_matrix:new y.UniformMatrix4f(s,c.u_matrix),u_tl_parent:new y.Uniform2f(s,c.u_tl_parent),u_scale_parent:new y.Uniform1f(s,c.u_scale_parent),u_buffer_scale:new y.Uniform1f(s,c.u_buffer_scale),u_fade_t:new y.Uniform1f(s,c.u_fade_t),u_opacity:new y.Uniform1f(s,c.u_opacity),u_image0:new y.Uniform1i(s,c.u_image0),u_image1:new y.Uniform1i(s,c.u_image1),u_brightness_low:new y.Uniform1f(s,c.u_brightness_low),u_brightness_high:new y.Uniform1f(s,c.u_brightness_high),u_saturation_factor:new y.Uniform1f(s,c.u_saturation_factor),u_contrast_factor:new y.Uniform1f(s,c.u_contrast_factor),u_spin_weights:new y.Uniform3f(s,c.u_spin_weights)}},symbolIcon:function(s,c){return{u_is_size_zoom_constant:new y.Uniform1i(s,c.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(s,c.u_is_size_feature_constant),u_size_t:new y.Uniform1f(s,c.u_size_t),u_size:new y.Uniform1f(s,c.u_size),u_camera_to_center_distance:new y.Uniform1f(s,c.u_camera_to_center_distance),u_pitch:new y.Uniform1f(s,c.u_pitch),u_rotate_symbol:new y.Uniform1i(s,c.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(s,c.u_aspect_ratio),u_fade_change:new y.Uniform1f(s,c.u_fade_change),u_matrix:new y.UniformMatrix4f(s,c.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(s,c.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(s,c.u_coord_matrix),u_is_text:new y.Uniform1i(s,c.u_is_text),u_pitch_with_map:new y.Uniform1i(s,c.u_pitch_with_map),u_texsize:new y.Uniform2f(s,c.u_texsize),u_texture:new y.Uniform1i(s,c.u_texture)}},symbolSDF:function(s,c){return{u_is_size_zoom_constant:new y.Uniform1i(s,c.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(s,c.u_is_size_feature_constant),u_size_t:new y.Uniform1f(s,c.u_size_t),u_size:new y.Uniform1f(s,c.u_size),u_camera_to_center_distance:new y.Uniform1f(s,c.u_camera_to_center_distance),u_pitch:new y.Uniform1f(s,c.u_pitch),u_rotate_symbol:new y.Uniform1i(s,c.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(s,c.u_aspect_ratio),u_fade_change:new y.Uniform1f(s,c.u_fade_change),u_matrix:new y.UniformMatrix4f(s,c.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(s,c.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(s,c.u_coord_matrix),u_is_text:new y.Uniform1i(s,c.u_is_text),u_pitch_with_map:new y.Uniform1i(s,c.u_pitch_with_map),u_texsize:new y.Uniform2f(s,c.u_texsize),u_texture:new y.Uniform1i(s,c.u_texture),u_gamma_scale:new y.Uniform1f(s,c.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(s,c.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(s,c.u_is_halo)}},symbolTextAndIcon:function(s,c){return{u_is_size_zoom_constant:new y.Uniform1i(s,c.u_is_size_zoom_constant),u_is_size_feature_constant:new y.Uniform1i(s,c.u_is_size_feature_constant),u_size_t:new y.Uniform1f(s,c.u_size_t),u_size:new y.Uniform1f(s,c.u_size),u_camera_to_center_distance:new y.Uniform1f(s,c.u_camera_to_center_distance),u_pitch:new y.Uniform1f(s,c.u_pitch),u_rotate_symbol:new y.Uniform1i(s,c.u_rotate_symbol),u_aspect_ratio:new y.Uniform1f(s,c.u_aspect_ratio),u_fade_change:new y.Uniform1f(s,c.u_fade_change),u_matrix:new y.UniformMatrix4f(s,c.u_matrix),u_label_plane_matrix:new y.UniformMatrix4f(s,c.u_label_plane_matrix),u_coord_matrix:new y.UniformMatrix4f(s,c.u_coord_matrix),u_is_text:new y.Uniform1i(s,c.u_is_text),u_pitch_with_map:new y.Uniform1i(s,c.u_pitch_with_map),u_texsize:new y.Uniform2f(s,c.u_texsize),u_texsize_icon:new y.Uniform2f(s,c.u_texsize_icon),u_texture:new y.Uniform1i(s,c.u_texture),u_texture_icon:new y.Uniform1i(s,c.u_texture_icon),u_gamma_scale:new y.Uniform1f(s,c.u_gamma_scale),u_device_pixel_ratio:new y.Uniform1f(s,c.u_device_pixel_ratio),u_is_halo:new y.Uniform1i(s,c.u_is_halo)}},background:function(s,c){return{u_matrix:new y.UniformMatrix4f(s,c.u_matrix),u_opacity:new y.Uniform1f(s,c.u_opacity),u_color:new y.UniformColor(s,c.u_color)}},backgroundPattern:function(s,c){return{u_matrix:new y.UniformMatrix4f(s,c.u_matrix),u_opacity:new y.Uniform1f(s,c.u_opacity),u_image:new y.Uniform1i(s,c.u_image),u_pattern_tl_a:new y.Uniform2f(s,c.u_pattern_tl_a),u_pattern_br_a:new y.Uniform2f(s,c.u_pattern_br_a),u_pattern_tl_b:new y.Uniform2f(s,c.u_pattern_tl_b),u_pattern_br_b:new y.Uniform2f(s,c.u_pattern_br_b),u_texsize:new y.Uniform2f(s,c.u_texsize),u_mix:new y.Uniform1f(s,c.u_mix),u_pattern_size_a:new y.Uniform2f(s,c.u_pattern_size_a),u_pattern_size_b:new y.Uniform2f(s,c.u_pattern_size_b),u_scale_a:new y.Uniform1f(s,c.u_scale_a),u_scale_b:new y.Uniform1f(s,c.u_scale_b),u_pixel_coord_upper:new y.Uniform2f(s,c.u_pixel_coord_upper),u_pixel_coord_lower:new y.Uniform2f(s,c.u_pixel_coord_lower),u_tile_units_to_pixels:new y.Uniform1f(s,c.u_tile_units_to_pixels)}}};function Wo(s,c,u,f,S,A,z){for(var B=s.context,q=B.gl,W=s.useProgram("collisionBox"),oe=[],se=0,ue=0,Ee=0;Ee<f.length;Ee++){var be=f[Ee],Ce=c.getTile(be),me=Ce.getBucket(u);if(me){var Te=be.posMatrix;S[0]===0&&S[1]===0||(Te=s.translatePosMatrix(be.posMatrix,Ce,S,A));var Le=z?me.textCollisionBox:me.iconCollisionBox,Ne=me.collisionCircleArray;if(Ne.length>0){var We=y.create(),He=Te;y.mul(We,me.placementInvProjMatrix,s.transform.glCoordMatrix),y.mul(We,We,me.placementViewportMatrix),oe.push({circleArray:Ne,circleOffset:ue,transform:He,invTransform:We}),ue=se+=Ne.length/4}Le&&W.draw(B,q.LINES,pe.disabled,xe.disabled,s.colorModeForRenderPass(),De.disabled,Ga(Te,s.transform,Ce),u.id,Le.layoutVertexBuffer,Le.indexBuffer,Le.segments,null,s.transform.zoom,null,null,Le.collisionVertexBuffer)}}if(z&&oe.length){var Je=s.useProgram("collisionCircle"),ut=new y.StructArrayLayout2f1f2i16;ut.resize(4*se),ut._trim();for(var _t=0,gt=0,Mt=oe;gt<Mt.length;gt+=1)for(var Zt=Mt[gt],Wt=0;Wt<Zt.circleArray.length/4;Wt++){var Gt=4*Wt,Ai=Zt.circleArray[Gt+0],Ft=Zt.circleArray[Gt+1],ai=Zt.circleArray[Gt+2],wi=Zt.circleArray[Gt+3];ut.emplace(_t++,Ai,Ft,ai,wi,0),ut.emplace(_t++,Ai,Ft,ai,wi,1),ut.emplace(_t++,Ai,Ft,ai,wi,2),ut.emplace(_t++,Ai,Ft,ai,wi,3)}(!sa||sa.length<2*se)&&(sa=function(Ir){var Fr=2*Ir,vn=new y.StructArrayLayout3ui6;vn.resize(Fr),vn._trim();for(var xr=0;xr<Fr;xr++){var zi=6*xr;vn.uint16[zi+0]=4*xr+0,vn.uint16[zi+1]=4*xr+1,vn.uint16[zi+2]=4*xr+2,vn.uint16[zi+3]=4*xr+2,vn.uint16[zi+4]=4*xr+3,vn.uint16[zi+5]=4*xr+0}return vn}(se));for(var ni=B.createIndexBuffer(sa,!0),ei=B.createVertexBuffer(ut,y.collisionCircleLayout.members,!0),ci=0,Kt=oe;ci<Kt.length;ci+=1){var Xt=Kt[ci],yr=pl(Xt.transform,Xt.invTransform,s.transform);Je.draw(B,q.TRIANGLES,pe.disabled,xe.disabled,s.colorModeForRenderPass(),De.disabled,yr,u.id,ei,ni,y.SegmentVector.simpleSegment(0,2*Xt.circleOffset,Xt.circleArray.length,Xt.circleArray.length/2),null,s.transform.zoom,null,null,null)}ei.destroy(),ni.destroy()}}var fo=y.identity(new Float32Array(16));function Os(s,c,u,f,S,A){var z=y.getAnchorAlignment(s),B=-(z.horizontalAlign-.5)*c,q=-(z.verticalAlign-.5)*u,W=y.evaluateVariableOffset(s,f);return new y.Point((B/S+W[0])*A,(q/S+W[1])*A)}function Fs(s,c,u,f,S,A,z,B,q,W,oe){var se=s.text.placedSymbolArray,ue=s.text.dynamicLayoutVertexArray,Ee=s.icon.dynamicLayoutVertexArray,be={};ue.clear();for(var Ce=0;Ce<se.length;Ce++){var me=se.get(Ce),Te=me.hidden||!me.crossTileID||s.allowVerticalPlacement&&!me.placedOrientation?null:f[me.crossTileID];if(Te){var Le=new y.Point(me.anchorX,me.anchorY),Ne=Pt(Le,u?B:z),We=oi(A.cameraToCenterDistance,Ne.signedDistanceFromCamera),He=S.evaluateSizeForFeature(s.textSizeData,W,me)*We/y.ONE_EM;u&&(He*=s.tilePixelRatio/q);for(var Je=Os(Te.anchor,Te.width,Te.height,Te.textOffset,Te.textBoxScale,He),ut=u?Pt(Le.add(Je),z).point:Ne.point.add(c?Je.rotate(-A.angle):Je),_t=s.allowVerticalPlacement&&me.placedOrientation===y.WritingMode.vertical?Math.PI/2:0,gt=0;gt<me.numGlyphs;gt++)y.addDynamicAttributes(ue,ut,_t);oe&&me.associatedIconIndex>=0&&(be[me.associatedIconIndex]={shiftedAnchor:ut,angle:_t})}else En(me.numGlyphs,ue)}if(oe){Ee.clear();for(var Mt=s.icon.placedSymbolArray,Zt=0;Zt<Mt.length;Zt++){var Wt=Mt.get(Zt);if(Wt.hidden)En(Wt.numGlyphs,Ee);else{var Gt=be[Zt];if(Gt)for(var Ai=0;Ai<Wt.numGlyphs;Ai++)y.addDynamicAttributes(Ee,Gt.shiftedAnchor,Gt.angle);else En(Wt.numGlyphs,Ee)}}s.icon.dynamicLayoutVertexBuffer.updateData(Ee)}s.text.dynamicLayoutVertexBuffer.updateData(ue)}function $a(s,c,u){return u.iconsInText&&c?"symbolTextAndIcon":s?"symbolSDF":"symbolIcon"}function ko(s,c,u,f,S,A,z,B,q,W,oe,se){for(var ue=s.context,Ee=ue.gl,be=s.transform,Ce=B==="map",me=q==="map",Te=Ce&&u.layout.get("symbol-placement")!=="point",Le=Ce&&!me&&!Te,Ne=u.layout.get("symbol-sort-key").constantOr(1)!==void 0,We=!1,He=s.depthModeForSublayer(0,pe.ReadOnly),Je=u.layout.get("text-variable-anchor"),ut=[],_t=0,gt=f;_t<gt.length;_t+=1){var Mt=gt[_t],Zt=c.getTile(Mt),Wt=Zt.getBucket(u);if(Wt){var Gt=S?Wt.text:Wt.icon;if(Gt&&Gt.segments.get().length){var Ai=Gt.programConfigurations.get(u.id),Ft=S||Wt.sdfIcons,ai=S?Wt.textSizeData:Wt.iconSizeData,wi=me||be.pitch!==0,ni=s.useProgram($a(Ft,S,Wt),Ai),ei=y.evaluateSizeForZoom(ai,be.zoom),ci=void 0,Kt=[0,0],Xt=void 0,yr=void 0,Ir=null,Fr=void 0;if(S)Xt=Zt.glyphAtlasTexture,yr=Ee.LINEAR,ci=Zt.glyphAtlasTexture.size,Wt.iconsInText&&(Kt=Zt.imageAtlasTexture.size,Ir=Zt.imageAtlasTexture,Fr=wi||s.options.rotating||s.options.zooming||ai.kind==="composite"||ai.kind==="camera"?Ee.LINEAR:Ee.NEAREST);else{var vn=u.layout.get("icon-size").constantOr(0)!==1||Wt.iconsNeedLinear;Xt=Zt.imageAtlasTexture,yr=Ft||s.options.rotating||s.options.zooming||vn||wi?Ee.LINEAR:Ee.NEAREST,ci=Zt.imageAtlasTexture.size}var xr=tr(Zt,1,s.transform.zoom),zi=Jt(Mt.posMatrix,me,Ce,s.transform,xr),Jn=Nt(Mt.posMatrix,me,Ce,s.transform,xr),On=Je&&Wt.hasTextData(),So=u.layout.get("icon-text-fit")!=="none"&&On&&Wt.hasIconData();Te&&Cr(Wt,Mt.posMatrix,s,S,zi,Jn,me,W);var Wr=s.translatePosMatrix(Mt.posMatrix,Zt,A,z),To=Te||S&&Je||So?fo:zi,Io=s.translatePosMatrix(Jn,Zt,A,z,!0),yl=Ft&&u.paint.get(S?"text-halo-width":"icon-halo-width").constantOr(1)!==0,gl={program:ni,buffers:Gt,uniformValues:Ft?Wt.iconsInText?Bs(ai.kind,ei,Le,me,s,Wr,To,Io,ci,Kt):Za(ai.kind,ei,Le,me,s,Wr,To,Io,S,ci,!0):la(ai.kind,ei,Le,me,s,Wr,To,Io,S,ci),atlasTexture:Xt,atlasTextureIcon:Ir,atlasInterpolation:yr,atlasInterpolationIcon:Fr,isSDF:Ft,hasHalo:yl};if(Ne&&Wt.canOverlap){We=!0;for(var Ya=0,_l=Gt.segments.get();Ya<_l.length;Ya+=1){var Gs=_l[Ya];ut.push({segments:new y.SegmentVector([Gs]),sortKey:Gs.sortKey,state:gl})}}else ut.push({segments:Gt.segments,sortKey:0,state:gl})}}}We&&ut.sort(function(_s,ga){return _s.sortKey-ga.sortKey});for(var Ma=0,Zs=ut;Ma<Zs.length;Ma+=1){var ya=Zs[Ma],Hr=ya.state;if(ue.activeTexture.set(Ee.TEXTURE0),Hr.atlasTexture.bind(Hr.atlasInterpolation,Ee.CLAMP_TO_EDGE),Hr.atlasTextureIcon&&(ue.activeTexture.set(Ee.TEXTURE1),Hr.atlasTextureIcon&&Hr.atlasTextureIcon.bind(Hr.atlasInterpolationIcon,Ee.CLAMP_TO_EDGE)),Hr.isSDF){var Ao=Hr.uniformValues;Hr.hasHalo&&(Ao.u_is_halo=1,us(Hr.buffers,ya.segments,u,s,Hr.program,He,oe,se,Ao)),Ao.u_is_halo=0}us(Hr.buffers,ya.segments,u,s,Hr.program,He,oe,se,Hr.uniformValues)}}function us(s,c,u,f,S,A,z,B,q){var W=f.context;S.draw(W,W.gl.TRIANGLES,A,z,B,De.disabled,q,u.id,s.layoutVertexBuffer,s.indexBuffer,c,u.paint,f.transform.zoom,s.programConfigurations.get(u.id),s.dynamicLayoutVertexBuffer,s.opacityVertexBuffer)}function Pa(s,c,u,f,S,A,z){var B,q,W,oe,se,ue=s.context.gl,Ee=u.paint.get("fill-pattern"),be=Ee&&Ee.constantOr(1),Ce=u.getCrossfadeParameters();z?(q=be&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=ue.LINES):(q=be?"fillPattern":"fill",B=ue.TRIANGLES);for(var me=0,Te=f;me<Te.length;me+=1){var Le=Te[me],Ne=c.getTile(Le);if(!be||Ne.patternsLoaded()){var We=Ne.getBucket(u);if(We){var He=We.programConfigurations.get(u.id),Je=s.useProgram(q,He);be&&(s.context.activeTexture.set(ue.TEXTURE0),Ne.imageAtlasTexture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),He.updatePaintBuffers(Ce));var ut=Ee.constantOr(null);if(ut&&Ne.imageAtlas){var _t=Ne.imageAtlas,gt=_t.patternPositions[ut.to.toString()],Mt=_t.patternPositions[ut.from.toString()];gt&&Mt&&He.setConstantPatternPositions(gt,Mt)}var Zt=s.translatePosMatrix(Le.posMatrix,Ne,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));if(z){oe=We.indexBuffer2,se=We.segments2;var Wt=[ue.drawingBufferWidth,ue.drawingBufferHeight];W=q==="fillOutlinePattern"&&be?Ls(Zt,s,Ce,Ne,Wt):Tr(Zt,Wt)}else oe=We.indexBuffer,se=We.segments,W=be?Yi(Zt,s,Ce,Ne):Po(Zt);Je.draw(s.context,B,S,s.stencilModeForClipping(Le),A,De.disabled,W,u.id,We.layoutVertexBuffer,oe,se,u.paint,s.transform.zoom,He)}}}}function fl(s,c,u,f,S,A,z){for(var B=s.context,q=B.gl,W=u.paint.get("fill-extrusion-pattern"),oe=W.constantOr(1),se=u.getCrossfadeParameters(),ue=u.paint.get("fill-extrusion-opacity"),Ee=0,be=f;Ee<be.length;Ee+=1){var Ce=be[Ee],me=c.getTile(Ce),Te=me.getBucket(u);if(Te){var Le=Te.programConfigurations.get(u.id),Ne=s.useProgram(oe?"fillExtrusionPattern":"fillExtrusion",Le);oe&&(s.context.activeTexture.set(q.TEXTURE0),me.imageAtlasTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),Le.updatePaintBuffers(se));var We=W.constantOr(null);if(We&&me.imageAtlas){var He=me.imageAtlas,Je=He.patternPositions[We.to.toString()],ut=He.patternPositions[We.from.toString()];Je&&ut&&Le.setConstantPatternPositions(Je,ut)}var _t=s.translatePosMatrix(Ce.posMatrix,me,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),gt=u.paint.get("fill-extrusion-vertical-gradient"),Mt=oe?Di(_t,s,gt,ue,Ce,se,me):Ms(_t,s,gt,ue);Ne.draw(B,B.gl.TRIANGLES,S,A,z,De.backCCW,Mt,u.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,u.paint,s.transform.zoom,Le)}}}function Us(s,c,u,f,S,A){var z=s.context,B=z.gl,q=c.fbo;if(q){var W=s.useProgram("hillshade");z.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,q.colorAttachment.get());var oe=function(se,ue,Ee){var be=Ee.paint.get("hillshade-shadow-color"),Ce=Ee.paint.get("hillshade-highlight-color"),me=Ee.paint.get("hillshade-accent-color"),Te=Ee.paint.get("hillshade-illumination-direction")*(Math.PI/180);Ee.paint.get("hillshade-illumination-anchor")==="viewport"&&(Te-=se.transform.angle);var Le,Ne,We,He=!se.options.moving;return{u_matrix:se.transform.calculatePosMatrix(ue.tileID.toUnwrapped(),He),u_image:0,u_latrange:(Le=ue.tileID,Ne=Math.pow(2,Le.canonical.z),We=Le.canonical.y,[new y.MercatorCoordinate(0,We/Ne).toLngLat().lat,new y.MercatorCoordinate(0,(We+1)/Ne).toLngLat().lat]),u_light:[Ee.paint.get("hillshade-exaggeration"),Te],u_shadow:be,u_highlight:Ce,u_accent:me}}(s,c,u);W.draw(z,B.TRIANGLES,f,S,A,De.disabled,oe,u.id,s.rasterBoundsBuffer,s.quadTriangleIndexBuffer,s.rasterBoundsSegments)}}function yu(s,c,u,f,S,A){var z=s.context,B=z.gl,q=c.dem;if(q&&q.data){var W=q.dim,oe=q.stride,se=q.getPixels();if(z.activeTexture.set(B.TEXTURE1),z.pixelStoreUnpackPremultiplyAlpha.set(!1),c.demTexture=c.demTexture||s.getTileTexture(oe),c.demTexture){var ue=c.demTexture;ue.update(se,{premultiply:!1}),ue.bind(B.NEAREST,B.CLAMP_TO_EDGE)}else c.demTexture=new y.Texture(z,se,B.RGBA,{premultiply:!1}),c.demTexture.bind(B.NEAREST,B.CLAMP_TO_EDGE);z.activeTexture.set(B.TEXTURE0);var Ee=c.fbo;if(!Ee){var be=new y.Texture(z,{width:W,height:W,data:null},B.RGBA);be.bind(B.LINEAR,B.CLAMP_TO_EDGE),(Ee=c.fbo=z.createFramebuffer(W,W,!0)).colorAttachment.set(be.texture)}z.bindFramebuffer.set(Ee.framebuffer),z.viewport.set([0,0,W,W]),s.useProgram("hillshadePrepare").draw(z,B.TRIANGLES,f,S,A,De.disabled,function(Ce,me){var Te=me.stride,Le=y.create();return y.ortho(Le,0,y.EXTENT,-y.EXTENT,0,0,1),y.translate(Le,Le,[0,-y.EXTENT,0]),{u_matrix:Le,u_image:1,u_dimension:[Te,Te],u_zoom:Ce.overscaledZ,u_unpack:me.getUnpackVector()}}(c.tileID,q),u.id,s.rasterBoundsBuffer,s.quadTriangleIndexBuffer,s.rasterBoundsSegments),c.needsHillshadePrepare=!1}}function ca(s,c,u,f,S){var A=f.paint.get("raster-fade-duration");if(A>0){var z=y.browser.now(),B=(z-s.timeAdded)/A,q=c?(z-c.timeAdded)/A:-1,W=u.getSource(),oe=S.coveringZoomLevel({tileSize:W.tileSize,roundZoom:W.roundZoom}),se=!c||Math.abs(c.tileID.overscaledZ-oe)>Math.abs(s.tileID.overscaledZ-oe),ue=se&&s.refreshedUponExpiration?1:y.clamp(se?B:1-q,0,1);return s.refreshedUponExpiration&&B>=1&&(s.refreshedUponExpiration=!1),c?{opacity:1,mix:1-ue}:{opacity:ue,mix:0}}return{opacity:1,mix:0}}var ml=new y.Color(1,0,0,1),cs=new y.Color(0,1,0,1),hs=new y.Color(0,0,1,1),Tn=new y.Color(1,0,1,1),In=new y.Color(0,1,1,1);function Gl(s,c,u,f){ps(s,0,c+u/2,s.transform.width,u,f)}function ha(s,c,u,f){ps(s,c-u/2,0,u,s.transform.height,f)}function ps(s,c,u,f,S,A){var z=s.context,B=z.gl;B.enable(B.SCISSOR_TEST),B.scissor(c*y.browser.devicePixelRatio,u*y.browser.devicePixelRatio,f*y.browser.devicePixelRatio,S*y.browser.devicePixelRatio),z.clear({color:A}),B.disable(B.SCISSOR_TEST)}function Xa(s,c,u){var f=s.context,S=f.gl,A=u.posMatrix,z=s.useProgram("debug"),B=pe.disabled,q=xe.disabled,W=s.colorModeForRenderPass();f.activeTexture.set(S.TEXTURE0),s.emptyTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),z.draw(f,S.LINE_STRIP,B,q,W,De.disabled,$o(A,y.Color.red),"$debug",s.debugBuffer,s.tileBorderIndexBuffer,s.debugSegments);var oe=c.getTileByID(u.key).latestRawTileData,se=Math.floor((oe&&oe.byteLength||0)/1024),ue=c.getTile(u).tileSize,Ee=512/Math.min(ue,512)*(u.overscaledZ/s.transform.zoom)*.5,be=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(be+=" => "+u.overscaledZ),function(Ce,me){Ce.initDebugOverlayCanvas();var Te=Ce.debugOverlayCanvas,Le=Ce.context.gl,Ne=Ce.debugOverlayCanvas.getContext("2d");Ne.clearRect(0,0,Te.width,Te.height),Ne.shadowColor="white",Ne.shadowBlur=2,Ne.lineWidth=1.5,Ne.strokeStyle="white",Ne.textBaseline="top",Ne.font="bold 36px Open Sans, sans-serif",Ne.fillText(me,5,5),Ne.strokeText(me,5,5),Ce.debugOverlayTexture.update(Te),Ce.debugOverlayTexture.bind(Le.LINEAR,Le.CLAMP_TO_EDGE)}(s,be+" "+se+"kb"),z.draw(f,S.TRIANGLES,B,q,Me.alphaBlended,De.disabled,$o(A,y.Color.transparent,Ee),"$debug",s.debugBuffer,s.quadTriangleIndexBuffer,s.debugSegments)}var mo={symbol:function(s,c,u,f,S){if(s.renderPass==="translucent"){var A=xe.disabled,z=s.colorModeForRenderPass();u.layout.get("text-variable-anchor")&&function(B,q,W,oe,se,ue,Ee){for(var be=q.transform,Ce=se==="map",me=ue==="map",Te=0,Le=B;Te<Le.length;Te+=1){var Ne=Le[Te],We=oe.getTile(Ne),He=We.getBucket(W);if(He&&He.text&&He.text.segments.get().length){var Je=y.evaluateSizeForZoom(He.textSizeData,be.zoom),ut=tr(We,1,q.transform.zoom),_t=Jt(Ne.posMatrix,me,Ce,q.transform,ut),gt=W.layout.get("icon-text-fit")!=="none"&&He.hasIconData();if(Je){var Mt=Math.pow(2,be.zoom-We.tileID.overscaledZ);Fs(He,Ce,me,Ee,y.symbolSize,be,_t,Ne.posMatrix,Mt,Je,gt)}}}}(f,s,u,c,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),S),u.paint.get("icon-opacity").constantOr(1)!==0&&ko(s,c,u,f,!1,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),u.layout.get("icon-rotation-alignment"),u.layout.get("icon-pitch-alignment"),u.layout.get("icon-keep-upright"),A,z),u.paint.get("text-opacity").constantOr(1)!==0&&ko(s,c,u,f,!0,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),u.layout.get("text-keep-upright"),A,z),c.map.showCollisionBoxes&&(Wo(s,c,u,f,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),Wo(s,c,u,f,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))}},circle:function(s,c,u,f){if(s.renderPass==="translucent"){var S=u.paint.get("circle-opacity"),A=u.paint.get("circle-stroke-width"),z=u.paint.get("circle-stroke-opacity"),B=u.layout.get("circle-sort-key").constantOr(1)!==void 0;if(S.constantOr(1)!==0||A.constantOr(1)!==0&&z.constantOr(1)!==0){for(var q=s.context,W=q.gl,oe=s.depthModeForSublayer(0,pe.ReadOnly),se=xe.disabled,ue=s.colorModeForRenderPass(),Ee=[],be=0;be<f.length;be++){var Ce=f[be],me=c.getTile(Ce),Te=me.getBucket(u);if(Te){var Le=Te.programConfigurations.get(u.id),Ne={programConfiguration:Le,program:s.useProgram("circle",Le),layoutVertexBuffer:Te.layoutVertexBuffer,indexBuffer:Te.indexBuffer,uniformValues:Ds(s,Ce,me,u)};if(B)for(var We=0,He=Te.segments.get();We<He.length;We+=1){var Je=He[We];Ee.push({segments:new y.SegmentVector([Je]),sortKey:Je.sortKey,state:Ne})}else Ee.push({segments:Te.segments,sortKey:0,state:Ne})}}B&&Ee.sort(function(Zt,Wt){return Zt.sortKey-Wt.sortKey});for(var ut=0,_t=Ee;ut<_t.length;ut+=1){var gt=_t[ut],Mt=gt.state;Mt.program.draw(q,W.TRIANGLES,oe,se,ue,De.disabled,Mt.uniformValues,u.id,Mt.layoutVertexBuffer,Mt.indexBuffer,gt.segments,u.paint,s.transform.zoom,Mt.programConfiguration)}}}},heatmap:function(s,c,u,f){if(u.paint.get("heatmap-opacity")!==0)if(s.renderPass==="offscreen"){var S=s.context,A=S.gl,z=xe.disabled,B=new Me([A.ONE,A.ONE],y.Color.transparent,[!0,!0,!0,!0]);(function(Ee,be,Ce){var me=Ee.gl;Ee.activeTexture.set(me.TEXTURE1),Ee.viewport.set([0,0,be.width/4,be.height/4]);var Te=Ce.heatmapFbo;if(Te)me.bindTexture(me.TEXTURE_2D,Te.colorAttachment.get()),Ee.bindFramebuffer.set(Te.framebuffer);else{var Le=me.createTexture();me.bindTexture(me.TEXTURE_2D,Le),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_WRAP_S,me.CLAMP_TO_EDGE),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_WRAP_T,me.CLAMP_TO_EDGE),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_MIN_FILTER,me.LINEAR),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_MAG_FILTER,me.LINEAR),Te=Ce.heatmapFbo=Ee.createFramebuffer(be.width/4,be.height/4,!1),function(Ne,We,He,Je){var ut=Ne.gl;ut.texImage2D(ut.TEXTURE_2D,0,ut.RGBA,We.width/4,We.height/4,0,ut.RGBA,Ne.extRenderToTextureHalfFloat?Ne.extTextureHalfFloat.HALF_FLOAT_OES:ut.UNSIGNED_BYTE,null),Je.colorAttachment.set(He)}(Ee,be,Le,Te)}})(S,s,u),S.clear({color:y.Color.transparent});for(var q=0;q<f.length;q++){var W=f[q];if(!c.hasRenderableParent(W)){var oe=c.getTile(W),se=oe.getBucket(u);if(se){var ue=se.programConfigurations.get(u.id);s.useProgram("heatmap",ue).draw(S,A.TRIANGLES,pe.disabled,z,B,De.disabled,Rs(W.posMatrix,oe,s.transform.zoom,u.paint.get("heatmap-intensity")),u.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,u.paint,s.transform.zoom,ue)}}}S.viewport.set([0,0,s.width,s.height])}else s.renderPass==="translucent"&&(s.context.setColorMode(s.colorModeForRenderPass()),function(Ee,be){var Ce=Ee.context,me=Ce.gl,Te=be.heatmapFbo;if(Te){Ce.activeTexture.set(me.TEXTURE0),me.bindTexture(me.TEXTURE_2D,Te.colorAttachment.get()),Ce.activeTexture.set(me.TEXTURE1);var Le=be.colorRampTexture;Le||(Le=be.colorRampTexture=new y.Texture(Ce,be.colorRamp,me.RGBA)),Le.bind(me.LINEAR,me.CLAMP_TO_EDGE),Ee.useProgram("heatmapTexture").draw(Ce,me.TRIANGLES,pe.disabled,xe.disabled,Ee.colorModeForRenderPass(),De.disabled,function(Ne,We,He,Je){var ut=y.create();y.ortho(ut,0,Ne.width,Ne.height,0,0,1);var _t=Ne.context.gl;return{u_matrix:ut,u_world:[_t.drawingBufferWidth,_t.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:We.paint.get("heatmap-opacity")}}(Ee,be),be.id,Ee.viewportBuffer,Ee.quadTriangleIndexBuffer,Ee.viewportSegments,be.paint,Ee.transform.zoom)}}(s,u))},line:function(s,c,u,f){if(s.renderPass==="translucent"){var S=u.paint.get("line-opacity"),A=u.paint.get("line-width");if(S.constantOr(1)!==0&&A.constantOr(1)!==0)for(var z=s.depthModeForSublayer(0,pe.ReadOnly),B=s.colorModeForRenderPass(),q=u.paint.get("line-dasharray"),W=u.paint.get("line-pattern"),oe=W.constantOr(1),se=u.paint.get("line-gradient"),ue=u.getCrossfadeParameters(),Ee=oe?"linePattern":q?"lineSDF":se?"lineGradient":"line",be=s.context,Ce=be.gl,me=!0,Te=0,Le=f;Te<Le.length;Te+=1){var Ne=Le[Te],We=c.getTile(Ne);if(!oe||We.patternsLoaded()){var He=We.getBucket(u);if(He){var Je=He.programConfigurations.get(u.id),ut=s.context.program.get(),_t=s.useProgram(Ee,Je),gt=me||_t.program!==ut,Mt=W.constantOr(null);if(Mt&&We.imageAtlas){var Zt=We.imageAtlas,Wt=Zt.patternPositions[Mt.to.toString()],Gt=Zt.patternPositions[Mt.from.toString()];Wt&&Gt&&Je.setConstantPatternPositions(Wt,Gt)}var Ai=oe?aa(s,We,u,ue):q?dl(s,We,u,q,ue):se?Qi(s,We,u,He.lineClipsArray.length):Ca(s,We,u);if(oe)be.activeTexture.set(Ce.TEXTURE0),We.imageAtlasTexture.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE),Je.updatePaintBuffers(ue);else if(q&&(gt||s.lineAtlas.dirty))be.activeTexture.set(Ce.TEXTURE0),s.lineAtlas.bind(be);else if(se){var Ft=He.gradients[u.id],ai=Ft.texture;if(u.gradientVersion!==Ft.version){var wi=256;if(u.stepInterpolant){var ni=c.getSource().maxzoom,ei=Ne.canonical.z===ni?Math.ceil(1<<s.transform.maxZoom-Ne.canonical.z):1;wi=y.clamp(y.nextPowerOfTwo(He.maxLineLength/y.EXTENT*1024*ei),256,be.maxTextureSize)}Ft.gradient=y.renderColorRamp({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:wi,image:Ft.gradient||void 0,clips:He.lineClipsArray}),Ft.texture?Ft.texture.update(Ft.gradient):Ft.texture=new y.Texture(be,Ft.gradient,Ce.RGBA),Ft.version=u.gradientVersion,ai=Ft.texture}be.activeTexture.set(Ce.TEXTURE0),ai.bind(u.stepInterpolant?Ce.NEAREST:Ce.LINEAR,Ce.CLAMP_TO_EDGE)}_t.draw(be,Ce.TRIANGLES,z,s.stencilModeForClipping(Ne),B,De.disabled,Ai,u.id,He.layoutVertexBuffer,He.indexBuffer,He.segments,u.paint,s.transform.zoom,Je,He.layoutVertexBuffer2),me=!1}}}}},fill:function(s,c,u,f){var S=u.paint.get("fill-color"),A=u.paint.get("fill-opacity");if(A.constantOr(1)!==0){var z=s.colorModeForRenderPass(),B=u.paint.get("fill-pattern"),q=s.opaquePassEnabledForLayer()&&!B.constantOr(1)&&S.constantOr(y.Color.transparent).a===1&&A.constantOr(0)===1?"opaque":"translucent";if(s.renderPass===q){var W=s.depthModeForSublayer(1,s.renderPass==="opaque"?pe.ReadWrite:pe.ReadOnly);Pa(s,c,u,f,W,z,!1)}if(s.renderPass==="translucent"&&u.paint.get("fill-antialias")){var oe=s.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,pe.ReadOnly);Pa(s,c,u,f,oe,z,!0)}}},"fill-extrusion":function(s,c,u,f){var S=u.paint.get("fill-extrusion-opacity");if(S!==0&&s.renderPass==="translucent"){var A=new pe(s.context.gl.LEQUAL,pe.ReadWrite,s.depthRangeFor3D);if(S!==1||u.paint.get("fill-extrusion-pattern").constantOr(1))fl(s,c,u,f,A,xe.disabled,Me.disabled),fl(s,c,u,f,A,s.stencilModeFor3D(),s.colorModeForRenderPass());else{var z=s.colorModeForRenderPass();fl(s,c,u,f,A,xe.disabled,z)}}},hillshade:function(s,c,u,f){if(s.renderPass==="offscreen"||s.renderPass==="translucent"){for(var S=s.context,A=s.depthModeForSublayer(0,pe.ReadOnly),z=s.colorModeForRenderPass(),B=s.renderPass==="translucent"?s.stencilConfigForOverlap(f):[{},f],q=B[0],W=0,oe=B[1];W<oe.length;W+=1){var se=oe[W],ue=c.getTile(se);ue.needsHillshadePrepare&&s.renderPass==="offscreen"?yu(s,ue,u,A,xe.disabled,z):s.renderPass==="translucent"&&Us(s,ue,u,A,q[se.overscaledZ],z)}S.viewport.set([0,0,s.width,s.height])}},raster:function(s,c,u,f){if(s.renderPass==="translucent"&&u.paint.get("raster-opacity")!==0&&f.length)for(var S=s.context,A=S.gl,z=c.getSource(),B=s.useProgram("raster"),q=s.colorModeForRenderPass(),W=z instanceof bn?[{},f]:s.stencilConfigForOverlap(f),oe=W[0],se=W[1],ue=se[se.length-1].overscaledZ,Ee=!s.options.moving,be=0,Ce=se;be<Ce.length;be+=1){var me=Ce[be],Te=s.depthModeForSublayer(me.overscaledZ-ue,u.paint.get("raster-opacity")===1?pe.ReadWrite:pe.ReadOnly,A.LESS),Le=c.getTile(me),Ne=s.transform.calculatePosMatrix(me.toUnwrapped(),Ee);Le.registerFadeDuration(u.paint.get("raster-fade-duration"));var We=c.findLoadedParent(me,0),He=ca(Le,We,c,u,s.transform),Je=void 0,ut=void 0,_t=u.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;S.activeTexture.set(A.TEXTURE0),Le.texture.bind(_t,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),S.activeTexture.set(A.TEXTURE1),We?(We.texture.bind(_t,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),Je=Math.pow(2,We.tileID.overscaledZ-Le.tileID.overscaledZ),ut=[Le.tileID.canonical.x*Je%1,Le.tileID.canonical.y*Je%1]):Le.texture.bind(_t,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST);var gt=mu(Ne,ut||[0,0],Je||1,He,u);z instanceof bn?B.draw(S,A.TRIANGLES,Te,xe.disabled,q,De.disabled,gt,u.id,z.boundsBuffer,s.quadTriangleIndexBuffer,z.boundsSegments):B.draw(S,A.TRIANGLES,Te,oe[me.overscaledZ],q,De.disabled,gt,u.id,s.rasterBoundsBuffer,s.quadTriangleIndexBuffer,s.rasterBoundsSegments)}},background:function(s,c,u){var f=u.paint.get("background-color"),S=u.paint.get("background-opacity");if(S!==0){var A=s.context,z=A.gl,B=s.transform,q=B.tileSize,W=u.paint.get("background-pattern");if(!s.isPatternMissing(W)){var oe=!W&&f.a===1&&S===1&&s.opaquePassEnabledForLayer()?"opaque":"translucent";if(s.renderPass===oe){var se=xe.disabled,ue=s.depthModeForSublayer(0,oe==="opaque"?pe.ReadWrite:pe.ReadOnly),Ee=s.colorModeForRenderPass(),be=s.useProgram(W?"backgroundPattern":"background"),Ce=B.coveringTiles({tileSize:q});W&&(A.activeTexture.set(z.TEXTURE0),s.imageManager.bind(s.context));for(var me=u.getCrossfadeParameters(),Te=0,Le=Ce;Te<Le.length;Te+=1){var Ne=Le[Te],We=s.transform.calculatePosMatrix(Ne.toUnwrapped()),He=W?ua(We,S,s,W,{tileID:Ne,tileSize:q},me):za(We,S,f);be.draw(A,z.TRIANGLES,ue,se,Ee,De.disabled,He,u.id,s.tileExtentBuffer,s.quadTriangleIndexBuffer,s.tileExtentSegments)}}}}},debug:function(s,c,u){for(var f=0;f<u.length;f++)Xa(s,c,u[f])},custom:function(s,c,u){var f=s.context,S=u.implementation;if(s.renderPass==="offscreen"){var A=S.prerender;A&&(s.setCustomLayerDefaults(),f.setColorMode(s.colorModeForRenderPass()),A.call(S,f.gl,s.transform.customLayerMatrix()),f.setDirty(),s.setBaseState())}else if(s.renderPass==="translucent"){s.setCustomLayerDefaults(),f.setColorMode(s.colorModeForRenderPass()),f.setStencilMode(xe.disabled);var z=S.renderingMode==="3d"?new pe(s.context.gl.LEQUAL,pe.ReadWrite,s.depthRangeFor3D):s.depthModeForSublayer(0,pe.ReadOnly);f.setDepthMode(z),S.render(f.gl,s.transform.customLayerMatrix()),f.setDirty(),s.setBaseState(),f.bindFramebuffer.set(null)}}},ur=function(s,c){this.context=new ce(s),this.transform=c,this._tileTextures={},this.setup(),this.numSublayers=Ie.maxUnderzooming+Ie.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new qo,this.gpuTimers={}};ur.prototype.resize=function(s,c){if(this.width=s*y.browser.devicePixelRatio,this.height=c*y.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var u=0,f=this.style._order;u<f.length;u+=1)this.style._layers[f[u]].resize()},ur.prototype.setup=function(){var s=this.context,c=new y.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(y.EXTENT,0),c.emplaceBack(0,y.EXTENT),c.emplaceBack(y.EXTENT,y.EXTENT),this.tileExtentBuffer=s.createVertexBuffer(c,Sr.members),this.tileExtentSegments=y.SegmentVector.simpleSegment(0,0,4,2);var u=new y.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(y.EXTENT,0),u.emplaceBack(0,y.EXTENT),u.emplaceBack(y.EXTENT,y.EXTENT),this.debugBuffer=s.createVertexBuffer(u,Sr.members),this.debugSegments=y.SegmentVector.simpleSegment(0,0,4,5);var f=new y.StructArrayLayout4i8;f.emplaceBack(0,0,0,0),f.emplaceBack(y.EXTENT,0,y.EXTENT,0),f.emplaceBack(0,y.EXTENT,0,y.EXTENT),f.emplaceBack(y.EXTENT,y.EXTENT,y.EXTENT,y.EXTENT),this.rasterBoundsBuffer=s.createVertexBuffer(f,pn.members),this.rasterBoundsSegments=y.SegmentVector.simpleSegment(0,0,4,2);var S=new y.StructArrayLayout2i4;S.emplaceBack(0,0),S.emplaceBack(1,0),S.emplaceBack(0,1),S.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(S,Sr.members),this.viewportSegments=y.SegmentVector.simpleSegment(0,0,4,2);var A=new y.StructArrayLayout1ui2;A.emplaceBack(0),A.emplaceBack(1),A.emplaceBack(3),A.emplaceBack(2),A.emplaceBack(0),this.tileBorderIndexBuffer=s.createIndexBuffer(A);var z=new y.StructArrayLayout3ui6;z.emplaceBack(0,1,2),z.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(z),this.emptyTexture=new y.Texture(s,{width:1,height:1,data:new Uint8Array([0,0,0,0])},s.gl.RGBA);var B=this.context.gl;this.stencilClearMode=new xe({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO)},ur.prototype.clearStencil=function(){var s=this.context,c=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var u=y.create();y.ortho(u,0,this.width,this.height,0,0,1),y.scale(u,u,[c.drawingBufferWidth,c.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(s,c.TRIANGLES,pe.disabled,this.stencilClearMode,Me.disabled,De.disabled,Xo(u),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},ur.prototype._renderTileClippingMasks=function(s,c){if(this.currentStencilSource!==s.source&&s.isTileClipped()&&c&&c.length){this.currentStencilSource=s.source;var u=this.context,f=u.gl;this.nextStencilID+c.length>256&&this.clearStencil(),u.setColorMode(Me.disabled),u.setDepthMode(pe.disabled);var S=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var A=0,z=c;A<z.length;A+=1){var B=z[A],q=this._tileClippingMaskIDs[B.key]=this.nextStencilID++;S.draw(u,f.TRIANGLES,pe.disabled,new xe({func:f.ALWAYS,mask:0},q,255,f.KEEP,f.KEEP,f.REPLACE),Me.disabled,De.disabled,Xo(B.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},ur.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var s=this.nextStencilID++,c=this.context.gl;return new xe({func:c.NOTEQUAL,mask:255},s,255,c.KEEP,c.KEEP,c.REPLACE)},ur.prototype.stencilModeForClipping=function(s){var c=this.context.gl;return new xe({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,c.KEEP,c.KEEP,c.REPLACE)},ur.prototype.stencilConfigForOverlap=function(s){var c,u=this.context.gl,f=s.sort(function(q,W){return W.overscaledZ-q.overscaledZ}),S=f[f.length-1].overscaledZ,A=f[0].overscaledZ-S+1;if(A>1){this.currentStencilSource=void 0,this.nextStencilID+A>256&&this.clearStencil();for(var z={},B=0;B<A;B++)z[B+S]=new xe({func:u.GEQUAL,mask:255},B+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=A,[z,f]}return[(c={},c[S]=xe.disabled,c),f]},ur.prototype.colorModeForRenderPass=function(){var s=this.context.gl;return this._showOverdrawInspector?new Me([s.CONSTANT_COLOR,s.ONE],new y.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Me.unblended:Me.alphaBlended},ur.prototype.depthModeForSublayer=function(s,c,u){if(!this.opaquePassEnabledForLayer())return pe.disabled;var f=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new pe(u||this.context.gl.LEQUAL,c,[f,f])},ur.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},ur.prototype.render=function(s,c){var u=this;this.style=s,this.options=c,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(y.browser.now()),this.imageManager.beginFrame();var f=this.style._order,S=this.style.sourceCaches;for(var A in S){var z=S[A];z.used&&z.prepare(this.context)}var B,q,W={},oe={},se={};for(var ue in S){var Ee=S[ue];W[ue]=Ee.getVisibleCoordinates(),oe[ue]=W[ue].slice().reverse(),se[ue]=Ee.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var be=0;be<f.length;be++)if(this.style._layers[f[be]].is3D()){this.opaquePassCutoff=be;break}this.renderPass="offscreen";for(var Ce=0,me=f;Ce<me.length;Ce+=1){var Te=this.style._layers[me[Ce]];if(Te.hasOffscreenPass()&&!Te.isHidden(this.transform.zoom)){var Le=oe[Te.source];(Te.type==="custom"||Le.length)&&this.renderLayer(this,S[Te.source],Te,Le)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:c.showOverdrawInspector?y.Color.black:y.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.depthRangeFor3D=[0,1-(s._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){var Ne=this.style._layers[f[this.currentLayer]],We=S[Ne.source],He=W[Ne.source];this._renderTileClippingMasks(Ne,He),this.renderLayer(this,We,Ne,He)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){var Je=this.style._layers[f[this.currentLayer]],ut=S[Je.source],_t=(Je.type==="symbol"?se:oe)[Je.source];this._renderTileClippingMasks(Je,W[Je.source]),this.renderLayer(this,ut,Je,_t)}this.options.showTileBoundaries&&(y.values(this.style._layers).forEach(function(gt){gt.source&&!gt.isHidden(u.transform.zoom)&&(gt.source!==(q&&q.id)&&(q=u.style.sourceCaches[gt.source]),(!B||B.getSource().maxzoom<q.getSource().maxzoom)&&(B=q))}),B&&mo.debug(this,B,B.getVisibleCoordinates())),this.options.showPadding&&function(gt){var Mt=gt.transform.padding;Gl(gt,gt.transform.height-(Mt.top||0),3,ml),Gl(gt,Mt.bottom||0,3,cs),ha(gt,Mt.left||0,3,hs),ha(gt,gt.transform.width-(Mt.right||0),3,Tn);var Zt=gt.transform.centerPoint;(function(Wt,Gt,Ai,Ft){ps(Wt,Gt-1,Ai-10,2,20,Ft),ps(Wt,Gt-10,Ai-1,20,2,Ft)})(gt,Zt.x,gt.transform.height-Zt.y,In)}(this),this.context.setDefault()},ur.prototype.renderLayer=function(s,c,u,f){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="custom"||f.length)&&(this.id=u.id,this.gpuTimingStart(u),mo[u.type](s,c,u,f,this.style.placement.variableOffsets),this.gpuTimingEnd())},ur.prototype.gpuTimingStart=function(s){if(this.options.gpuTiming){var c=this.context.extTimerQuery,u=this.gpuTimers[s.id];u||(u=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),u.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,u.query)}},ur.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var s=this.context.extTimerQuery;s.endQueryEXT(s.TIME_ELAPSED_EXT)}},ur.prototype.collectGpuTimers=function(){var s=this.gpuTimers;return this.gpuTimers={},s},ur.prototype.queryGpuTimers=function(s){var c={};for(var u in s){var f=s[u],S=this.context.extTimerQuery,A=S.getQueryObjectEXT(f.query,S.QUERY_RESULT_EXT)/1e6;S.deleteQueryEXT(f.query),c[u]=A}return c},ur.prototype.translatePosMatrix=function(s,c,u,f,S){if(!u[0]&&!u[1])return s;var A=S?f==="map"?this.transform.angle:0:f==="viewport"?-this.transform.angle:0;if(A){var z=Math.sin(A),B=Math.cos(A);u=[u[0]*B-u[1]*z,u[0]*z+u[1]*B]}var q=[S?u[0]:tr(c,u[0],this.transform.zoom),S?u[1]:tr(c,u[1],this.transform.zoom),0],W=new Float32Array(16);return y.translate(W,s,q),W},ur.prototype.saveTileTexture=function(s){var c=this._tileTextures[s.size[0]];c?c.push(s):this._tileTextures[s.size[0]]=[s]},ur.prototype.getTileTexture=function(s){var c=this._tileTextures[s];return c&&c.length>0?c.pop():null},ur.prototype.isPatternMissing=function(s){if(!s)return!1;if(!s.from||!s.to)return!0;var c=this.imageManager.getPattern(s.from.toString()),u=this.imageManager.getPattern(s.to.toString());return!c||!u},ur.prototype.useProgram=function(s,c){this.cache=this.cache||{};var u=""+s+(c?c.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[u]||(this.cache[u]=new hl(this.context,s,qa[s],c,ql[s],this._showOverdrawInspector)),this.cache[u]},ur.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},ur.prototype.setBaseState=function(){var s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)},ur.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=y.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new y.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},ur.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var ds=function(s,c){this.points=s,this.planes=c};ds.fromInvProjectionMatrix=function(s,c,u){var f=Math.pow(2,u),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(z){return y.transformMat4([],z,s)}).map(function(z){return y.scale$1([],z,1/z[3]/c*f)}),A=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(z){var B=y.sub([],S[z[0]],S[z[1]]),q=y.sub([],S[z[2]],S[z[1]]),W=y.normalize([],y.cross([],B,q)),oe=-y.dot(W,S[z[1]]);return W.concat(oe)});return new ds(S,A)};var Wa=function(s,c){this.min=s,this.max=c,this.center=y.scale$2([],y.add([],this.min,this.max),.5)};Wa.prototype.quadrant=function(s){for(var c=[s%2==0,s<2],u=y.clone$2(this.min),f=y.clone$2(this.max),S=0;S<c.length;S++)u[S]=c[S]?this.min[S]:this.center[S],f[S]=c[S]?this.center[S]:this.max[S];return f[2]=this.max[2],new Wa(u,f)},Wa.prototype.distanceX=function(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]},Wa.prototype.distanceY=function(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]},Wa.prototype.intersects=function(s){for(var c=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],u=!0,f=0;f<s.planes.length;f++){for(var S=s.planes[f],A=0,z=0;z<c.length;z++)A+=y.dot$1(S,c[z])>=0;if(A===0)return 0;A!==c.length&&(u=!1)}if(u)return 2;for(var B=0;B<3;B++){for(var q=Number.MAX_VALUE,W=-Number.MAX_VALUE,oe=0;oe<s.points.length;oe++){var se=s.points[oe][B]-this.min[B];q=Math.min(q,se),W=Math.max(W,se)}if(W<0||q>this.max[B]-this.min[B])return 0}return 1};var pa=function(s,c,u,f){if(s===void 0&&(s=0),c===void 0&&(c=0),u===void 0&&(u=0),f===void 0&&(f=0),isNaN(s)||s<0||isNaN(c)||c<0||isNaN(u)||u<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=c,this.left=u,this.right=f};pa.prototype.interpolate=function(s,c,u){return c.top!=null&&s.top!=null&&(this.top=y.number(s.top,c.top,u)),c.bottom!=null&&s.bottom!=null&&(this.bottom=y.number(s.bottom,c.bottom,u)),c.left!=null&&s.left!=null&&(this.left=y.number(s.left,c.left,u)),c.right!=null&&s.right!=null&&(this.right=y.number(s.right,c.right,u)),this},pa.prototype.getCenter=function(s,c){var u=y.clamp((this.left+s-this.right)/2,0,s),f=y.clamp((this.top+c-this.bottom)/2,0,c);return new y.Point(u,f)},pa.prototype.equals=function(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right},pa.prototype.clone=function(){return new pa(this.top,this.bottom,this.left,this.right)},pa.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var bi=function(s,c,u,f,S){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=S===void 0||S,this._minZoom=s||0,this._maxZoom=c||22,this._minPitch=u==null?0:u,this._maxPitch=f==null?60:f,this.setMaxBounds(),this.width=0,this.height=0,this._center=new y.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new pa,this._posMatrixCache={},this._alignedPosMatrixCache={}},ji={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};bi.prototype.clone=function(){var s=new bi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return s.tileSize=this.tileSize,s.latRange=this.latRange,s.width=this.width,s.height=this.height,s._center=this._center,s.zoom=this.zoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._calcMatrices(),s},ji.minZoom.get=function(){return this._minZoom},ji.minZoom.set=function(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))},ji.maxZoom.get=function(){return this._maxZoom},ji.maxZoom.set=function(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))},ji.minPitch.get=function(){return this._minPitch},ji.minPitch.set=function(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))},ji.maxPitch.get=function(){return this._maxPitch},ji.maxPitch.set=function(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))},ji.renderWorldCopies.get=function(){return this._renderWorldCopies},ji.renderWorldCopies.set=function(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s},ji.worldSize.get=function(){return this.tileSize*this.scale},ji.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},ji.size.get=function(){return new y.Point(this.width,this.height)},ji.bearing.get=function(){return-this.angle/Math.PI*180},ji.bearing.set=function(s){var c=-y.wrap(s,-180,180)*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=y.create$2(),y.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},ji.pitch.get=function(){return this._pitch/Math.PI*180},ji.pitch.set=function(s){var c=y.clamp(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())},ji.fov.get=function(){return this._fov/Math.PI*180},ji.fov.set=function(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=s/180*Math.PI,this._calcMatrices())},ji.zoom.get=function(){return this._zoom},ji.zoom.set=function(s){var c=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._zoom=c,this.scale=this.zoomScale(c),this.tileZoom=Math.floor(c),this.zoomFraction=c-this.tileZoom,this._constrain(),this._calcMatrices())},ji.center.get=function(){return this._center},ji.center.set=function(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._constrain(),this._calcMatrices())},ji.padding.get=function(){return this._edgeInsets.toJSON()},ji.padding.set=function(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())},ji.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},bi.prototype.isPaddingEqual=function(s){return this._edgeInsets.equals(s)},bi.prototype.interpolatePadding=function(s,c,u){this._unmodified=!1,this._edgeInsets.interpolate(s,c,u),this._constrain(),this._calcMatrices()},bi.prototype.coveringZoomLevel=function(s){var c=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,c)},bi.prototype.getVisibleUnwrappedCoordinates=function(s){var c=[new y.UnwrappedTileID(0,s)];if(this._renderWorldCopies)for(var u=this.pointCoordinate(new y.Point(0,0)),f=this.pointCoordinate(new y.Point(this.width,0)),S=this.pointCoordinate(new y.Point(this.width,this.height)),A=this.pointCoordinate(new y.Point(0,this.height)),z=Math.floor(Math.min(u.x,f.x,S.x,A.x)),B=Math.floor(Math.max(u.x,f.x,S.x,A.x)),q=z-1;q<=B+1;q++)q!==0&&c.push(new y.UnwrappedTileID(q,s));return c},bi.prototype.coveringTiles=function(s){var c=this.coveringZoomLevel(s),u=c;if(s.minzoom!==void 0&&c<s.minzoom)return[];s.maxzoom!==void 0&&c>s.maxzoom&&(c=s.maxzoom);var f=y.MercatorCoordinate.fromLngLat(this.center),S=Math.pow(2,c),A=[S*f.x,S*f.y,0],z=ds.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c),B=s.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(B=c);var q=function(gt){return{aabb:new Wa([gt*S,0,0],[(gt+1)*S,S,0]),zoom:0,x:0,y:0,wrap:gt,fullyVisible:!1}},W=[],oe=[],se=c,ue=s.reparseOverscaled?u:c;if(this._renderWorldCopies)for(var Ee=1;Ee<=3;Ee++)W.push(q(-Ee)),W.push(q(Ee));for(W.push(q(0));W.length>0;){var be=W.pop(),Ce=be.x,me=be.y,Te=be.fullyVisible;if(!Te){var Le=be.aabb.intersects(z);if(Le===0)continue;Te=Le===2}var Ne=be.aabb.distanceX(A),We=be.aabb.distanceY(A),He=Math.max(Math.abs(Ne),Math.abs(We));if(be.zoom===se||He>3+(1<<se-be.zoom)-2&&be.zoom>=B)oe.push({tileID:new y.OverscaledTileID(be.zoom===se?ue:be.zoom,be.wrap,be.zoom,Ce,me),distanceSq:y.sqrLen([A[0]-.5-Ce,A[1]-.5-me])});else for(var Je=0;Je<4;Je++){var ut=(Ce<<1)+Je%2,_t=(me<<1)+(Je>>1);W.push({aabb:be.aabb.quadrant(Je),zoom:be.zoom+1,x:ut,y:_t,wrap:be.wrap,fullyVisible:Te})}}return oe.sort(function(gt,Mt){return gt.distanceSq-Mt.distanceSq}).map(function(gt){return gt.tileID})},bi.prototype.resize=function(s,c){this.width=s,this.height=c,this.pixelsToGLUnits=[2/s,-2/c],this._constrain(),this._calcMatrices()},ji.unmodified.get=function(){return this._unmodified},bi.prototype.zoomScale=function(s){return Math.pow(2,s)},bi.prototype.scaleZoom=function(s){return Math.log(s)/Math.LN2},bi.prototype.project=function(s){var c=y.clamp(s.lat,-this.maxValidLatitude,this.maxValidLatitude);return new y.Point(y.mercatorXfromLng(s.lng)*this.worldSize,y.mercatorYfromLat(c)*this.worldSize)},bi.prototype.unproject=function(s){return new y.MercatorCoordinate(s.x/this.worldSize,s.y/this.worldSize).toLngLat()},ji.point.get=function(){return this.project(this.center)},bi.prototype.setLocationAtPoint=function(s,c){var u=this.pointCoordinate(c),f=this.pointCoordinate(this.centerPoint),S=this.locationCoordinate(s),A=new y.MercatorCoordinate(S.x-(u.x-f.x),S.y-(u.y-f.y));this.center=this.coordinateLocation(A),this._renderWorldCopies&&(this.center=this.center.wrap())},bi.prototype.locationPoint=function(s){return this.coordinatePoint(this.locationCoordinate(s))},bi.prototype.pointLocation=function(s){return this.coordinateLocation(this.pointCoordinate(s))},bi.prototype.locationCoordinate=function(s){return y.MercatorCoordinate.fromLngLat(s)},bi.prototype.coordinateLocation=function(s){return s.toLngLat()},bi.prototype.pointCoordinate=function(s){var c=[s.x,s.y,0,1],u=[s.x,s.y,1,1];y.transformMat4(c,c,this.pixelMatrixInverse),y.transformMat4(u,u,this.pixelMatrixInverse);var f=c[3],S=u[3],A=c[1]/f,z=u[1]/S,B=c[2]/f,q=u[2]/S,W=B===q?0:(0-B)/(q-B);return new y.MercatorCoordinate(y.number(c[0]/f,u[0]/S,W)/this.worldSize,y.number(A,z,W)/this.worldSize)},bi.prototype.coordinatePoint=function(s){var c=[s.x*this.worldSize,s.y*this.worldSize,0,1];return y.transformMat4(c,c,this.pixelMatrix),new y.Point(c[0]/c[3],c[1]/c[3])},bi.prototype.getBounds=function(){return new y.LngLatBounds().extend(this.pointLocation(new y.Point(0,0))).extend(this.pointLocation(new y.Point(this.width,0))).extend(this.pointLocation(new y.Point(this.width,this.height))).extend(this.pointLocation(new y.Point(0,this.height)))},bi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new y.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},bi.prototype.setMaxBounds=function(s){s?(this.lngRange=[s.getWest(),s.getEast()],this.latRange=[s.getSouth(),s.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},bi.prototype.calculatePosMatrix=function(s,c){c===void 0&&(c=!1);var u=s.key,f=c?this._alignedPosMatrixCache:this._posMatrixCache;if(f[u])return f[u];var S=s.canonical,A=this.worldSize/this.zoomScale(S.z),z=S.x+Math.pow(2,S.z)*s.wrap,B=y.identity(new Float64Array(16));return y.translate(B,B,[z*A,S.y*A,0]),y.scale(B,B,[A/y.EXTENT,A/y.EXTENT,1]),y.multiply(B,c?this.alignedProjMatrix:this.projMatrix,B),f[u]=new Float32Array(B),f[u]},bi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},bi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var s,c,u,f,S=-90,A=90,z=-180,B=180,q=this.size,W=this._unmodified;if(this.latRange){var oe=this.latRange;S=y.mercatorYfromLat(oe[1])*this.worldSize,s=(A=y.mercatorYfromLat(oe[0])*this.worldSize)-S<q.y?q.y/(A-S):0}if(this.lngRange){var se=this.lngRange;z=y.mercatorXfromLng(se[0])*this.worldSize,c=(B=y.mercatorXfromLng(se[1])*this.worldSize)-z<q.x?q.x/(B-z):0}var ue=this.point,Ee=Math.max(c||0,s||0);if(Ee)return this.center=this.unproject(new y.Point(c?(B+z)/2:ue.x,s?(A+S)/2:ue.y)),this.zoom+=this.scaleZoom(Ee),this._unmodified=W,void(this._constraining=!1);if(this.latRange){var be=ue.y,Ce=q.y/2;be-Ce<S&&(f=S+Ce),be+Ce>A&&(f=A-Ce)}if(this.lngRange){var me=ue.x,Te=q.x/2;me-Te<z&&(u=z+Te),me+Te>B&&(u=B-Te)}u===void 0&&f===void 0||(this.center=this.unproject(new y.Point(u!==void 0?u:ue.x,f!==void 0?f:ue.y))),this._unmodified=W,this._constraining=!1}},bi.prototype._calcMatrices=function(){if(this.height){var s=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var c=Math.PI/2+this._pitch,u=this._fov*(.5+s.y/this.height),f=Math.sin(u)*this.cameraToCenterDistance/Math.sin(y.clamp(Math.PI-c-u,.01,Math.PI-.01)),S=this.point,A=S.x,z=S.y,B=1.01*(Math.cos(Math.PI/2-this._pitch)*f+this.cameraToCenterDistance),q=this.height/50,W=new Float64Array(16);y.perspective(W,this._fov,this.width/this.height,q,B),W[8]=2*-s.x/this.width,W[9]=2*s.y/this.height,y.scale(W,W,[1,-1,1]),y.translate(W,W,[0,0,-this.cameraToCenterDistance]),y.rotateX(W,W,this._pitch),y.rotateZ(W,W,this.angle),y.translate(W,W,[-A,-z,0]),this.mercatorMatrix=y.scale([],W,[this.worldSize,this.worldSize,this.worldSize]),y.scale(W,W,[1,1,y.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=W,this.invProjMatrix=y.invert([],this.projMatrix);var oe=this.width%2/2,se=this.height%2/2,ue=Math.cos(this.angle),Ee=Math.sin(this.angle),be=A-Math.round(A)+ue*oe+Ee*se,Ce=z-Math.round(z)+ue*se+Ee*oe,me=new Float64Array(W);if(y.translate(me,me,[be>.5?be-1:be,Ce>.5?Ce-1:Ce,0]),this.alignedProjMatrix=me,W=y.create(),y.scale(W,W,[this.width/2,-this.height/2,1]),y.translate(W,W,[1,-1,0]),this.labelPlaneMatrix=W,W=y.create(),y.scale(W,W,[1,-1,1]),y.translate(W,W,[-1,-1,0]),y.scale(W,W,[2/this.width,2/this.height,1]),this.glCoordMatrix=W,this.pixelMatrix=y.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(W=y.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=W,this._posMatrixCache={},this._alignedPosMatrixCache={}}},bi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var s=this.pointCoordinate(new y.Point(0,0)),c=[s.x*this.worldSize,s.y*this.worldSize,0,1];return y.transformMat4(c,c,this.pixelMatrix)[3]/this.cameraToCenterDistance},bi.prototype.getCameraPoint=function(){var s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new y.Point(0,s))},bi.prototype.getCameraQueryGeometry=function(s){var c=this.getCameraPoint();if(s.length===1)return[s[0],c];for(var u=c.x,f=c.y,S=c.x,A=c.y,z=0,B=s;z<B.length;z+=1){var q=B[z];u=Math.min(u,q.x),f=Math.min(f,q.y),S=Math.max(S,q.x),A=Math.max(A,q.y)}return[new y.Point(u,f),new y.Point(S,f),new y.Point(S,A),new y.Point(u,A),new y.Point(u,f)]},Object.defineProperties(bi.prototype,ji);var kt=function(s){var c,u,f,S;this._hashName=s&&encodeURIComponent(s),y.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(c=this._updateHashUnthrottled.bind(this),u=!1,f=null,S=function(){f=null,u&&(c(),f=setTimeout(S,300),u=!1)},function(){return u=!0,f||S(),f})};kt.prototype.addTo=function(s){return this._map=s,y.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},kt.prototype.remove=function(){return y.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},kt.prototype.getHashString=function(s){var c=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,f=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,f),A=Math.round(c.lng*S)/S,z=Math.round(c.lat*S)/S,B=this._map.getBearing(),q=this._map.getPitch(),W="";if(W+=s?"/"+A+"/"+z+"/"+u:u+"/"+z+"/"+A,(B||q)&&(W+="/"+Math.round(10*B)/10),q&&(W+="/"+Math.round(q)),this._hashName){var oe=this._hashName,se=!1,ue=y.window.location.hash.slice(1).split("&").map(function(Ee){var be=Ee.split("=")[0];return be===oe?(se=!0,be+"="+W):Ee}).filter(function(Ee){return Ee});return se||ue.push(oe+"="+W),"#"+ue.join("&")}return"#"+W},kt.prototype._getCurrentHash=function(){var s,c=this,u=y.window.location.hash.replace("#","");return this._hashName?(u.split("&").map(function(f){return f.split("=")}).forEach(function(f){f[0]===c._hashName&&(s=f)}),(s&&s[1]||"").split("/")):u.split("/")},kt.prototype._onHashChange=function(){var s=this._getCurrentHash();if(s.length>=3&&!s.some(function(u){return isNaN(u)})){var c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:c,pitch:+(s[4]||0)}),!0}return!1},kt.prototype._updateHashUnthrottled=function(){var s=y.window.location.href.replace(/(#.+)?$/,this.getHashString());try{y.window.history.replaceState(y.window.history.state,null,s)}catch{}};var Ha={linearity:.3,easing:y.bezier(0,0,.3,1)},Ho=y.extend({deceleration:2500,maxSpeed:1400},Ha),Mo=y.extend({deceleration:20,maxSpeed:1400},Ha),Vs=y.extend({deceleration:1e3,maxSpeed:360},Ha),Ot=y.extend({deceleration:1e3,maxSpeed:90},Ha),Ka=function(s){this._map=s,this.clear()};function fs(s,c){(!s.duration||s.duration<c.duration)&&(s.duration=c.duration,s.easing=c.easing)}function da(s,c,u){var f=u.maxSpeed,S=u.linearity,A=u.deceleration,z=y.clamp(s*S/(c/1e3),-f,f),B=Math.abs(z)/(A*S);return{easing:u.easing,duration:1e3*B,amount:z*(B/2)}}Ka.prototype.clear=function(){this._inertiaBuffer=[]},Ka.prototype.record=function(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:y.browser.now(),settings:s})},Ka.prototype._drainInertiaBuffer=function(){for(var s=this._inertiaBuffer,c=y.browser.now();s.length>0&&c-s[0].time>160;)s.shift()},Ka.prototype._onMoveEnd=function(s){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var c={zoom:0,bearing:0,pitch:0,pan:new y.Point(0,0),pinchAround:void 0,around:void 0},u=0,f=this._inertiaBuffer;u<f.length;u+=1){var S=f[u].settings;c.zoom+=S.zoomDelta||0,c.bearing+=S.bearingDelta||0,c.pitch+=S.pitchDelta||0,S.panDelta&&c.pan._add(S.panDelta),S.around&&(c.around=S.around),S.pinchAround&&(c.pinchAround=S.pinchAround)}var A=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,z={};if(c.pan.mag()){var B=da(c.pan.mag(),A,y.extend({},Ho,s||{}));z.offset=c.pan.mult(B.amount/c.pan.mag()),z.center=this._map.transform.center,fs(z,B)}if(c.zoom){var q=da(c.zoom,A,Mo);z.zoom=this._map.transform.zoom+q.amount,fs(z,q)}if(c.bearing){var W=da(c.bearing,A,Vs);z.bearing=this._map.transform.bearing+y.clamp(W.amount,-179,179),fs(z,W)}if(c.pitch){var oe=da(c.pitch,A,Ot);z.pitch=this._map.transform.pitch+oe.amount,fs(z,oe)}if(z.zoom||z.bearing){var se=c.pinchAround===void 0?c.around:c.pinchAround;z.around=se?this._map.unproject(se):this._map.getCenter()}return this.clear(),y.extend(z,{noMoveStart:!0})}};var dr=function(s){function c(f,S,A,z){z===void 0&&(z={});var B=he.mousePos(S.getCanvasContainer(),A),q=S.unproject(B);s.call(this,f,y.extend({point:B,lngLat:q,originalEvent:A},z)),this._defaultPrevented=!1,this.target=S}s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c;var u={defaultPrevented:{configurable:!0}};return c.prototype.preventDefault=function(){this._defaultPrevented=!0},u.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(c.prototype,u),c}(y.Event),ms=function(s){function c(f,S,A){var z=f==="touchend"?A.changedTouches:A.touches,B=he.touchPos(S.getCanvasContainer(),z),q=B.map(function(se){return S.unproject(se)}),W=B.reduce(function(se,ue,Ee,be){return se.add(ue.div(be.length))},new y.Point(0,0)),oe=S.unproject(W);s.call(this,f,{points:B,point:W,lngLats:q,lngLat:oe,originalEvent:A}),this._defaultPrevented=!1}s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c;var u={defaultPrevented:{configurable:!0}};return c.prototype.preventDefault=function(){this._defaultPrevented=!0},u.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(c.prototype,u),c}(y.Event),Zl=function(s){function c(f,S,A){s.call(this,f,{originalEvent:A}),this._defaultPrevented=!1}s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c;var u={defaultPrevented:{configurable:!0}};return c.prototype.preventDefault=function(){this._defaultPrevented=!0},u.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(c.prototype,u),c}(y.Event),zr=function(s,c){this._map=s,this._clickTolerance=c.clickTolerance};zr.prototype.reset=function(){delete this._mousedownPos},zr.prototype.wheel=function(s){return this._firePreventable(new Zl(s.type,this._map,s))},zr.prototype.mousedown=function(s,c){return this._mousedownPos=c,this._firePreventable(new dr(s.type,this._map,s))},zr.prototype.mouseup=function(s){this._map.fire(new dr(s.type,this._map,s))},zr.prototype.click=function(s,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||this._map.fire(new dr(s.type,this._map,s))},zr.prototype.dblclick=function(s){return this._firePreventable(new dr(s.type,this._map,s))},zr.prototype.mouseover=function(s){this._map.fire(new dr(s.type,this._map,s))},zr.prototype.mouseout=function(s){this._map.fire(new dr(s.type,this._map,s))},zr.prototype.touchstart=function(s){return this._firePreventable(new ms(s.type,this._map,s))},zr.prototype.touchmove=function(s){this._map.fire(new ms(s.type,this._map,s))},zr.prototype.touchend=function(s){this._map.fire(new ms(s.type,this._map,s))},zr.prototype.touchcancel=function(s){this._map.fire(new ms(s.type,this._map,s))},zr.prototype._firePreventable=function(s){if(this._map.fire(s),s.defaultPrevented)return{}},zr.prototype.isEnabled=function(){return!0},zr.prototype.isActive=function(){return!1},zr.prototype.enable=function(){},zr.prototype.disable=function(){};var Ut=function(s){this._map=s};Ut.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Ut.prototype.mousemove=function(s){this._map.fire(new dr(s.type,this._map,s))},Ut.prototype.mousedown=function(){this._delayContextMenu=!0},Ut.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new dr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Ut.prototype.contextmenu=function(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new dr(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()},Ut.prototype.isEnabled=function(){return!0},Ut.prototype.isActive=function(){return!1},Ut.prototype.enable=function(){},Ut.prototype.disable=function(){};var gn=function(s,c){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=c.clickTolerance||1};function ys(s,c){for(var u={},f=0;f<s.length;f++)u[s[f].identifier]=c[f];return u}gn.prototype.isEnabled=function(){return!!this._enabled},gn.prototype.isActive=function(){return!!this._active},gn.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},gn.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},gn.prototype.mousedown=function(s,c){this.isEnabled()&&s.shiftKey&&s.button===0&&(he.disableDrag(),this._startPos=this._lastPos=c,this._active=!0)},gn.prototype.mousemoveWindow=function(s,c){if(this._active){var u=c;if(!(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)){var f=this._startPos;this._lastPos=u,this._box||(this._box=he.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));var S=Math.min(f.x,u.x),A=Math.max(f.x,u.x),z=Math.min(f.y,u.y),B=Math.max(f.y,u.y);he.setTransform(this._box,"translate("+S+"px,"+z+"px)"),this._box.style.width=A-S+"px",this._box.style.height=B-z+"px"}}},gn.prototype.mouseupWindow=function(s,c){var u=this;if(this._active&&s.button===0){var f=this._startPos,S=c;if(this.reset(),he.suppressClick(),f.x!==S.x||f.y!==S.y)return this._map.fire(new y.Event("boxzoomend",{originalEvent:s})),{cameraAnimation:function(A){return A.fitScreenCoordinates(f,S,u._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",s)}},gn.prototype.keydown=function(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))},gn.prototype.blur=function(){this.reset()},gn.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(he.remove(this._box),this._box=null),he.enableDrag(),delete this._startPos,delete this._lastPos},gn.prototype._fireEvent=function(s,c){return this._map.fire(new y.Event(s,{originalEvent:c}))};var ka=function(s){this.reset(),this.numTouches=s.numTouches};ka.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},ka.prototype.touchstart=function(s,c,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=s.timeStamp),u.length===this.numTouches&&(this.centroid=function(f){for(var S=new y.Point(0,0),A=0,z=f;A<z.length;A+=1)S._add(z[A]);return S.div(f.length)}(c),this.touches=ys(u,c)))},ka.prototype.touchmove=function(s,c,u){if(!this.aborted&&this.centroid){var f=ys(u,c);for(var S in this.touches){var A=f[S];(!A||A.dist(this.touches[S])>30)&&(this.aborted=!0)}}},ka.prototype.touchend=function(s,c,u){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){var f=!this.aborted&&this.centroid;if(this.reset(),f)return f}};var yo=function(s){this.singleTap=new ka(s),this.numTaps=s.numTaps,this.reset()};yo.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},yo.prototype.touchstart=function(s,c,u){this.singleTap.touchstart(s,c,u)},yo.prototype.touchmove=function(s,c,u){this.singleTap.touchmove(s,c,u)},yo.prototype.touchend=function(s,c,u){var f=this.singleTap.touchend(s,c,u);if(f){var S=s.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(f)<30;if(S&&A||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}};var cr=function(){this._zoomIn=new yo({numTouches:1,numTaps:2}),this._zoomOut=new yo({numTouches:2,numTaps:1}),this.reset()};cr.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},cr.prototype.touchstart=function(s,c,u){this._zoomIn.touchstart(s,c,u),this._zoomOut.touchstart(s,c,u)},cr.prototype.touchmove=function(s,c,u){this._zoomIn.touchmove(s,c,u),this._zoomOut.touchmove(s,c,u)},cr.prototype.touchend=function(s,c,u){var f=this,S=this._zoomIn.touchend(s,c,u),A=this._zoomOut.touchend(s,c,u);return S?(this._active=!0,s.preventDefault(),setTimeout(function(){return f.reset()},0),{cameraAnimation:function(z){return z.easeTo({duration:300,zoom:z.getZoom()+1,around:z.unproject(S)},{originalEvent:s})}}):A?(this._active=!0,s.preventDefault(),setTimeout(function(){return f.reset()},0),{cameraAnimation:function(z){return z.easeTo({duration:300,zoom:z.getZoom()-1,around:z.unproject(A)},{originalEvent:s})}}):void 0},cr.prototype.touchcancel=function(){this.reset()},cr.prototype.enable=function(){this._enabled=!0},cr.prototype.disable=function(){this._enabled=!1,this.reset()},cr.prototype.isEnabled=function(){return this._enabled},cr.prototype.isActive=function(){return this._active};var Ko={0:1,2:2},St=function(s){this.reset(),this._clickTolerance=s.clickTolerance||1};St.prototype.blur=function(){this.reset()},St.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},St.prototype._correctButton=function(s,c){return!1},St.prototype._move=function(s,c){return{}},St.prototype.mousedown=function(s,c){if(!this._lastPoint){var u=he.mouseButton(s);this._correctButton(s,u)&&(this._lastPoint=c,this._eventButton=u)}},St.prototype.mousemoveWindow=function(s,c){var u=this._lastPoint;if(u){if(s.preventDefault(),function(f,S){var A=Ko[S];return f.buttons===void 0||(f.buttons&A)!==A}(s,this._eventButton))this.reset();else if(this._moved||!(c.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(u,c)}},St.prototype.mouseupWindow=function(s){this._lastPoint&&he.mouseButton(s)===this._eventButton&&(this._moved&&he.suppressClick(),this.reset())},St.prototype.enable=function(){this._enabled=!0},St.prototype.disable=function(){this._enabled=!1,this.reset()},St.prototype.isEnabled=function(){return this._enabled},St.prototype.isActive=function(){return this._active};var Ns=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.mousedown=function(u,f){s.prototype.mousedown.call(this,u,f),this._lastPoint&&(this._active=!0)},c.prototype._correctButton=function(u,f){return f===0&&!u.ctrlKey},c.prototype._move=function(u,f){return{around:f,panDelta:f.sub(u)}},c}(St),fa=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype._correctButton=function(u,f){return f===0&&u.ctrlKey||f===2},c.prototype._move=function(u,f){var S=.8*(f.x-u.x);if(S)return this._active=!0,{bearingDelta:S}},c.prototype.contextmenu=function(u){u.preventDefault()},c}(St),js=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype._correctButton=function(u,f){return f===0&&u.ctrlKey||f===2},c.prototype._move=function(u,f){var S=-.5*(f.y-u.y);if(S)return this._active=!0,{pitchDelta:S}},c.prototype.contextmenu=function(u){u.preventDefault()},c}(St),Rn=function(s){this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset()};Rn.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new y.Point(0,0)},Rn.prototype.touchstart=function(s,c,u){return this._calculateTransform(s,c,u)},Rn.prototype.touchmove=function(s,c,u){if(this._active&&!(u.length<this._minTouches))return s.preventDefault(),this._calculateTransform(s,c,u)},Rn.prototype.touchend=function(s,c,u){this._calculateTransform(s,c,u),this._active&&u.length<this._minTouches&&this.reset()},Rn.prototype.touchcancel=function(){this.reset()},Rn.prototype._calculateTransform=function(s,c,u){u.length>0&&(this._active=!0);var f=ys(u,c),S=new y.Point(0,0),A=new y.Point(0,0),z=0;for(var B in f){var q=f[B],W=this._touches[B];W&&(S._add(q),A._add(q.sub(W)),z++,f[B]=q)}if(this._touches=f,!(z<this._minTouches)&&A.mag()){var oe=A.div(z);if(this._sum._add(oe),!(this._sum.mag()<this._clickTolerance))return{around:S.div(z),panDelta:oe}}},Rn.prototype.enable=function(){this._enabled=!0},Rn.prototype.disable=function(){this._enabled=!1,this.reset()},Rn.prototype.isEnabled=function(){return this._enabled},Rn.prototype.isActive=function(){return this._active};var fr=function(){this.reset()};function or(s,c,u){for(var f=0;f<s.length;f++)if(s[f].identifier===u)return c[f]}function Ja(s,c){return Math.log(s/c)/Math.LN2}fr.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},fr.prototype._start=function(s){},fr.prototype._move=function(s,c,u){return{}},fr.prototype.touchstart=function(s,c,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([c[0],c[1]]))},fr.prototype.touchmove=function(s,c,u){if(this._firstTwoTouches){s.preventDefault();var f=this._firstTwoTouches,S=f[1],A=or(u,c,f[0]),z=or(u,c,S);if(A&&z){var B=this._aroundCenter?null:A.add(z).div(2);return this._move([A,z],B,s)}}},fr.prototype.touchend=function(s,c,u){if(this._firstTwoTouches){var f=this._firstTwoTouches,S=f[1],A=or(u,c,f[0]),z=or(u,c,S);A&&z||(this._active&&he.suppressClick(),this.reset())}},fr.prototype.touchcancel=function(){this.reset()},fr.prototype.enable=function(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"},fr.prototype.disable=function(){this._enabled=!1,this.reset()},fr.prototype.isEnabled=function(){return this._enabled},fr.prototype.isActive=function(){return this._active};var _n=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.reset=function(){s.prototype.reset.call(this),delete this._distance,delete this._startDistance},c.prototype._start=function(u){this._startDistance=this._distance=u[0].dist(u[1])},c.prototype._move=function(u,f){var S=this._distance;if(this._distance=u[0].dist(u[1]),this._active||!(Math.abs(Ja(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ja(this._distance,S),pinchAround:f}},c}(fr);function Lo(s,c){return 180*s.angleWith(c)/Math.PI}var $l=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.reset=function(){s.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},c.prototype._start=function(u){this._startVector=this._vector=u[0].sub(u[1]),this._minDiameter=u[0].dist(u[1])},c.prototype._move=function(u,f){var S=this._vector;if(this._vector=u[0].sub(u[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Lo(this._vector,S),pinchAround:f}},c.prototype._isBelowThreshold=function(u){this._minDiameter=Math.min(this._minDiameter,u.mag());var f=25/(Math.PI*this._minDiameter)*360,S=Lo(u,this._startVector);return Math.abs(S)<f},c}(fr);function gs(s){return Math.abs(s.y)>Math.abs(s.x)}var Xl=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.reset=function(){s.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},c.prototype._start=function(u){this._lastPoints=u,gs(u[0].sub(u[1]))&&(this._valid=!1)},c.prototype._move=function(u,f,S){var A=u[0].sub(this._lastPoints[0]),z=u[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(A,z,S.timeStamp),this._valid)return this._lastPoints=u,this._active=!0,{pitchDelta:(A.y+z.y)/2*-.5}},c.prototype.gestureBeginsVertically=function(u,f,S){if(this._valid!==void 0)return this._valid;var A=u.mag()>=2,z=f.mag()>=2;if(A||z){if(!A||!z)return this._firstMove===void 0&&(this._firstMove=S),S-this._firstMove<100&&void 0;var B=u.y>0==f.y>0;return gs(u)&&gs(f)&&B}},c}(fr),Eo={panStep:100,bearingStep:15,pitchStep:10},Wn=function(){var s=Eo;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1};function Vt(s){return s*(2-s)}Wn.prototype.blur=function(){this.reset()},Wn.prototype.reset=function(){this._active=!1},Wn.prototype.keydown=function(s){var c=this;if(!(s.altKey||s.ctrlKey||s.metaKey)){var u=0,f=0,S=0,A=0,z=0;switch(s.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:s.shiftKey?f=-1:(s.preventDefault(),A=-1);break;case 39:s.shiftKey?f=1:(s.preventDefault(),A=1);break;case 38:s.shiftKey?S=1:(s.preventDefault(),z=-1);break;case 40:s.shiftKey?S=-1:(s.preventDefault(),z=1);break;default:return}return this._rotationDisabled&&(f=0,S=0),{cameraAnimation:function(B){var q=B.getZoom();B.easeTo({duration:300,easeId:"keyboardHandler",easing:Vt,zoom:u?Math.round(q)+u*(s.shiftKey?2:1):q,bearing:B.getBearing()+f*c._bearingStep,pitch:B.getPitch()+S*c._pitchStep,offset:[-A*c._panStep,-z*c._panStep],center:B.getCenter()},{originalEvent:s})}}}},Wn.prototype.enable=function(){this._enabled=!0},Wn.prototype.disable=function(){this._enabled=!1,this.reset()},Wn.prototype.isEnabled=function(){return this._enabled},Wn.prototype.isActive=function(){return this._active},Wn.prototype.disableRotation=function(){this._rotationDisabled=!0},Wn.prototype.enableRotation=function(){this._rotationDisabled=!1};var wt=function(s,c){this._map=s,this._el=s.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,y.bindAll(["_onTimeout"],this)};wt.prototype.setZoomRate=function(s){this._defaultZoomRate=s},wt.prototype.setWheelZoomRate=function(s){this._wheelZoomRate=s},wt.prototype.isEnabled=function(){return!!this._enabled},wt.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},wt.prototype.isZooming=function(){return!!this._zooming},wt.prototype.enable=function(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=s&&s.around==="center")},wt.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},wt.prototype.wheel=function(s){if(this.isEnabled()){var c=s.deltaMode===y.window.WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY,u=y.browser.now(),f=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,c!==0&&c%4.000244140625==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(f*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),s.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=s,this._delta-=c,this._active||this._start(s)),s.preventDefault()}},wt.prototype._onTimeout=function(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)},wt.prototype._start=function(s){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var c=he.mousePos(this._el,s);this._around=y.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(c)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},wt.prototype.renderFrame=function(){var s=this;if(this._frameId&&(this._frameId=null,this.isActive())){var c=this._map.transform;if(this._delta!==0){var u=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,f=2/(1+Math.exp(-Math.abs(this._delta*u)));this._delta<0&&f!==0&&(f=1/f);var S=typeof this._targetZoom=="number"?c.zoomScale(this._targetZoom):c.scale;this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,c.scaleZoom(S*f))),this._type==="wheel"&&(this._startZoom=c.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var A,z=typeof this._targetZoom=="number"?this._targetZoom:c.zoom,B=this._startZoom,q=this._easing,W=!1;if(this._type==="wheel"&&B&&q){var oe=Math.min((y.browser.now()-this._lastWheelEventTime)/200,1),se=q(oe);A=y.number(B,z,se),oe<1?this._frameId||(this._frameId=!0):W=!0}else A=z,W=!0;return this._active=!0,W&&(this._active=!1,this._finishTimeout=setTimeout(function(){s._zooming=!1,s._handler._triggerRenderFrame(),delete s._targetZoom,delete s._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!W,zoomDelta:A-c.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},wt.prototype._smoothOutEasing=function(s){var c=y.ease;if(this._prevEase){var u=this._prevEase,f=(y.browser.now()-u.start)/u.duration,S=u.easing(f+.01)-u.easing(f),A=.27/Math.sqrt(S*S+1e-4)*.01,z=Math.sqrt(.0729-A*A);c=y.bezier(A,z,.25,1)}return this._prevEase={start:y.browser.now(),duration:s,easing:c},c},wt.prototype.blur=function(){this.reset()},wt.prototype.reset=function(){this._active=!1};var Hn=function(s,c){this._clickZoom=s,this._tapZoom=c};Hn.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Hn.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Hn.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Hn.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var An=function(){this.reset()};An.prototype.reset=function(){this._active=!1},An.prototype.blur=function(){this.reset()},An.prototype.dblclick=function(s,c){return s.preventDefault(),{cameraAnimation:function(u){u.easeTo({duration:300,zoom:u.getZoom()+(s.shiftKey?-1:1),around:u.unproject(c)},{originalEvent:s})}}},An.prototype.enable=function(){this._enabled=!0},An.prototype.disable=function(){this._enabled=!1,this.reset()},An.prototype.isEnabled=function(){return this._enabled},An.prototype.isActive=function(){return this._active};var Nr=function(){this._tap=new yo({numTouches:1,numTaps:1}),this.reset()};Nr.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Nr.prototype.touchstart=function(s,c,u){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=c[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(s,c,u))},Nr.prototype.touchmove=function(s,c,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;var f=c[0],S=f.y-this._swipePoint.y;return this._swipePoint=f,s.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(s,c,u)},Nr.prototype.touchend=function(s,c,u){this._tapTime?this._swipePoint&&u.length===0&&this.reset():this._tap.touchend(s,c,u)&&(this._tapTime=s.timeStamp)},Nr.prototype.touchcancel=function(){this.reset()},Nr.prototype.enable=function(){this._enabled=!0},Nr.prototype.disable=function(){this._enabled=!1,this.reset()},Nr.prototype.isEnabled=function(){return this._enabled},Nr.prototype.isActive=function(){return this._active};var mr=function(s,c,u){this._el=s,this._mousePan=c,this._touchPan=u};mr.prototype.enable=function(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},mr.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},mr.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},mr.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Kn=function(s,c,u){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=c,this._mousePitch=u};Kn.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Kn.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Kn.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Kn.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var vr=function(s,c,u,f){this._el=s,this._touchZoom=c,this._touchRotate=u,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0};vr.prototype.enable=function(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},vr.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},vr.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},vr.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},vr.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},vr.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var Cn=function(s){return s.zoom||s.drag||s.pitch||s.rotate},ma=function(s){function c(){s.apply(this,arguments)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c}(y.Event);function At(s){return s.panDelta&&s.panDelta.mag()||s.zoomDelta||s.bearingDelta||s.pitchDelta}var Tt=function(s,c){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ka(s),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(c),y.bindAll(["handleEvent","handleWindowEvent"],this);var u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[y.window.document,"mousemove",{capture:!0}],[y.window.document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[y.window,"blur",void 0]];for(var f=0,S=this._listeners;f<S.length;f+=1){var A=S[f],z=A[0];he.addEventListener(z,A[1],z===y.window.document?this.handleWindowEvent:this.handleEvent,A[2])}};Tt.prototype.destroy=function(){for(var s=0,c=this._listeners;s<c.length;s+=1){var u=c[s],f=u[0];he.removeEventListener(f,u[1],f===y.window.document?this.handleWindowEvent:this.handleEvent,u[2])}},Tt.prototype._addDefaultHandlers=function(s){var c=this._map,u=c.getCanvasContainer();this._add("mapEvent",new zr(c,s));var f=c.boxZoom=new gn(c,s);this._add("boxZoom",f);var S=new cr,A=new An;c.doubleClickZoom=new Hn(A,S),this._add("tapZoom",S),this._add("clickZoom",A);var z=new Nr;this._add("tapDragZoom",z);var B=c.touchPitch=new Xl;this._add("touchPitch",B);var q=new fa(s),W=new js(s);c.dragRotate=new Kn(s,q,W),this._add("mouseRotate",q,["mousePitch"]),this._add("mousePitch",W,["mouseRotate"]);var oe=new Ns(s),se=new Rn(s);c.dragPan=new mr(u,oe,se),this._add("mousePan",oe),this._add("touchPan",se,["touchZoom","touchRotate"]);var ue=new $l,Ee=new _n;c.touchZoomRotate=new vr(u,Ee,ue,z),this._add("touchRotate",ue,["touchPan","touchZoom"]),this._add("touchZoom",Ee,["touchPan","touchRotate"]);var be=c.scrollZoom=new wt(c,this);this._add("scrollZoom",be,["mousePan"]);var Ce=c.keyboard=new Wn;this._add("keyboard",Ce),this._add("blockableMapEvent",new Ut(c));for(var me=0,Te=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];me<Te.length;me+=1){var Le=Te[me];s.interactive&&s[Le]&&c[Le].enable(s[Le])}},Tt.prototype._add=function(s,c,u){this._handlers.push({handlerName:s,handler:c,allowed:u}),this._handlersById[s]=c},Tt.prototype.stop=function(s){if(!this._updatingCamera){for(var c=0,u=this._handlers;c<u.length;c+=1)u[c].handler.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}},Tt.prototype.isActive=function(){for(var s=0,c=this._handlers;s<c.length;s+=1)if(c[s].handler.isActive())return!0;return!1},Tt.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Tt.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Tt.prototype.isMoving=function(){return Boolean(Cn(this._eventsInProgress))||this.isZooming()},Tt.prototype._blockedByActive=function(s,c,u){for(var f in s)if(f!==u&&(!c||c.indexOf(f)<0))return!0;return!1},Tt.prototype.handleWindowEvent=function(s){this.handleEvent(s,s.type+"Window")},Tt.prototype._getMapTouches=function(s){for(var c=[],u=0,f=s;u<f.length;u+=1){var S=f[u];this._el.contains(S.target)&&c.push(S)}return c},Tt.prototype.handleEvent=function(s,c){this._updatingCamera=!0;for(var u=s.type==="renderFrame"?void 0:s,f={needsRenderFrame:!1},S={},A={},z=s.touches?this._getMapTouches(s.touches):void 0,B=z?he.touchPos(this._el,z):he.mousePos(this._el,s),q=0,W=this._handlers;q<W.length;q+=1){var oe=W[q],se=oe.handlerName,ue=oe.handler,Ee=oe.allowed;if(ue.isEnabled()){var be=void 0;this._blockedByActive(A,Ee,se)?ue.reset():ue[c||s.type]&&(be=ue[c||s.type](s,B,z),this.mergeHandlerResult(f,S,be,se,u),be&&be.needsRenderFrame&&this._triggerRenderFrame()),(be||ue.isActive())&&(A[se]=ue)}}var Ce={};for(var me in this._previousActiveHandlers)A[me]||(Ce[me]=u);this._previousActiveHandlers=A,(Object.keys(Ce).length||At(f))&&(this._changes.push([f,S,Ce]),this._triggerRenderFrame()),(Object.keys(A).length||At(f))&&this._map._stop(!0),this._updatingCamera=!1;var Te=f.cameraAnimation;Te&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Te(this._map))},Tt.prototype.mergeHandlerResult=function(s,c,u,f,S){if(u){y.extend(s,u);var A={handlerName:f,originalEvent:u.originalEvent||S};u.zoomDelta!==void 0&&(c.zoom=A),u.panDelta!==void 0&&(c.drag=A),u.pitchDelta!==void 0&&(c.pitch=A),u.bearingDelta!==void 0&&(c.rotate=A)}},Tt.prototype._applyChanges=function(){for(var s={},c={},u={},f=0,S=this._changes;f<S.length;f+=1){var A=S[f],z=A[0],B=A[1],q=A[2];z.panDelta&&(s.panDelta=(s.panDelta||new y.Point(0,0))._add(z.panDelta)),z.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+z.zoomDelta),z.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+z.bearingDelta),z.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+z.pitchDelta),z.around!==void 0&&(s.around=z.around),z.pinchAround!==void 0&&(s.pinchAround=z.pinchAround),z.noInertia&&(s.noInertia=z.noInertia),y.extend(c,B),y.extend(u,q)}this._updateMapTransform(s,c,u),this._changes=[]},Tt.prototype._updateMapTransform=function(s,c,u){var f=this._map,S=f.transform;if(!At(s))return this._fireEvents(c,u,!0);var A=s.panDelta,z=s.zoomDelta,B=s.bearingDelta,q=s.pitchDelta,W=s.around,oe=s.pinchAround;oe!==void 0&&(W=oe),f._stop(!0),W=W||f.transform.centerPoint;var se=S.pointLocation(A?W.sub(A):W);B&&(S.bearing+=B),q&&(S.pitch+=q),z&&(S.zoom+=z),S.setLocationAtPoint(se,W),this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(c,u,!0)},Tt.prototype._fireEvents=function(s,c,u){var f=this,S=Cn(this._eventsInProgress),A=Cn(s),z={};for(var B in s)this._eventsInProgress[B]||(z[B+"start"]=s[B].originalEvent),this._eventsInProgress[B]=s[B];for(var q in!S&&A&&this._fireEvent("movestart",A.originalEvent),z)this._fireEvent(q,z[q]);for(var W in A&&this._fireEvent("move",A.originalEvent),s)this._fireEvent(W,s[W].originalEvent);var oe,se={};for(var ue in this._eventsInProgress){var Ee=this._eventsInProgress[ue],be=Ee.handlerName,Ce=Ee.originalEvent;this._handlersById[be].isActive()||(delete this._eventsInProgress[ue],se[ue+"end"]=oe=c[be]||Ce)}for(var me in se)this._fireEvent(me,se[me]);var Te=Cn(this._eventsInProgress);if(u&&(S||A)&&!Te){this._updatingCamera=!0;var Le=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Ne=function(We){return We!==0&&-f._bearingSnap<We&&We<f._bearingSnap};Le?(Ne(Le.bearing||this._map.getBearing())&&(Le.bearing=0),this._map.easeTo(Le,{originalEvent:oe})):(this._map.fire(new y.Event("moveend",{originalEvent:oe})),Ne(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Tt.prototype._fireEvent=function(s,c){this._map.fire(new y.Event(s,c?{originalEvent:c}:{}))},Tt.prototype._requestFrame=function(){var s=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(c){delete s._frameId,s.handleEvent(new ma("renderFrame",{timeStamp:c})),s._applyChanges()})},Tt.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var qs=function(s){function c(u,f){s.call(this),this._moving=!1,this._zooming=!1,this.transform=u,this._bearingSnap=f.bearingSnap,y.bindAll(["_renderFrameCallback"],this)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.getCenter=function(){return new y.LngLat(this.transform.center.lng,this.transform.center.lat)},c.prototype.setCenter=function(u,f){return this.jumpTo({center:u},f)},c.prototype.panBy=function(u,f,S){return u=y.Point.convert(u).mult(-1),this.panTo(this.transform.center,y.extend({offset:u},f),S)},c.prototype.panTo=function(u,f,S){return this.easeTo(y.extend({center:u},f),S)},c.prototype.getZoom=function(){return this.transform.zoom},c.prototype.setZoom=function(u,f){return this.jumpTo({zoom:u},f),this},c.prototype.zoomTo=function(u,f,S){return this.easeTo(y.extend({zoom:u},f),S)},c.prototype.zoomIn=function(u,f){return this.zoomTo(this.getZoom()+1,u,f),this},c.prototype.zoomOut=function(u,f){return this.zoomTo(this.getZoom()-1,u,f),this},c.prototype.getBearing=function(){return this.transform.bearing},c.prototype.setBearing=function(u,f){return this.jumpTo({bearing:u},f),this},c.prototype.getPadding=function(){return this.transform.padding},c.prototype.setPadding=function(u,f){return this.jumpTo({padding:u},f),this},c.prototype.rotateTo=function(u,f,S){return this.easeTo(y.extend({bearing:u},f),S)},c.prototype.resetNorth=function(u,f){return this.rotateTo(0,y.extend({duration:1e3},u),f),this},c.prototype.resetNorthPitch=function(u,f){return this.easeTo(y.extend({bearing:0,pitch:0,duration:1e3},u),f),this},c.prototype.snapToNorth=function(u,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(u,f):this},c.prototype.getPitch=function(){return this.transform.pitch},c.prototype.setPitch=function(u,f){return this.jumpTo({pitch:u},f),this},c.prototype.cameraForBounds=function(u,f){u=y.LngLatBounds.convert(u);var S=f&&f.bearing||0;return this._cameraForBoxAndBearing(u.getNorthWest(),u.getSouthEast(),S,f)},c.prototype._cameraForBoxAndBearing=function(u,f,S,A){var z={top:0,bottom:0,right:0,left:0};if(typeof(A=y.extend({padding:z,offset:[0,0],maxZoom:this.transform.maxZoom},A)).padding=="number"){var B=A.padding;A.padding={top:B,bottom:B,right:B,left:B}}A.padding=y.extend(z,A.padding);var q=this.transform,W=q.padding,oe=q.project(y.LngLat.convert(u)),se=q.project(y.LngLat.convert(f)),ue=oe.rotate(-S*Math.PI/180),Ee=se.rotate(-S*Math.PI/180),be=new y.Point(Math.max(ue.x,Ee.x),Math.max(ue.y,Ee.y)),Ce=new y.Point(Math.min(ue.x,Ee.x),Math.min(ue.y,Ee.y)),me=be.sub(Ce),Te=(q.width-(W.left+W.right+A.padding.left+A.padding.right))/me.x,Le=(q.height-(W.top+W.bottom+A.padding.top+A.padding.bottom))/me.y;if(!(Le<0||Te<0)){var Ne=Math.min(q.scaleZoom(q.scale*Math.min(Te,Le)),A.maxZoom),We=typeof A.offset.x=="number"?new y.Point(A.offset.x,A.offset.y):y.Point.convert(A.offset),He=new y.Point((A.padding.left-A.padding.right)/2,(A.padding.top-A.padding.bottom)/2).rotate(S*Math.PI/180),Je=We.add(He).mult(q.scale/q.zoomScale(Ne));return{center:q.unproject(oe.add(se).div(2).sub(Je)),zoom:Ne,bearing:S}}y.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},c.prototype.fitBounds=function(u,f,S){return this._fitInternal(this.cameraForBounds(u,f),f,S)},c.prototype.fitScreenCoordinates=function(u,f,S,A,z){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(y.Point.convert(u)),this.transform.pointLocation(y.Point.convert(f)),S,A),A,z)},c.prototype._fitInternal=function(u,f,S){return u?(delete(f=y.extend(u,f)).padding,f.linear?this.easeTo(f,S):this.flyTo(f,S)):this},c.prototype.jumpTo=function(u,f){this.stop();var S=this.transform,A=!1,z=!1,B=!1;return"zoom"in u&&S.zoom!==+u.zoom&&(A=!0,S.zoom=+u.zoom),u.center!==void 0&&(S.center=y.LngLat.convert(u.center)),"bearing"in u&&S.bearing!==+u.bearing&&(z=!0,S.bearing=+u.bearing),"pitch"in u&&S.pitch!==+u.pitch&&(B=!0,S.pitch=+u.pitch),u.padding==null||S.isPaddingEqual(u.padding)||(S.padding=u.padding),this.fire(new y.Event("movestart",f)).fire(new y.Event("move",f)),A&&this.fire(new y.Event("zoomstart",f)).fire(new y.Event("zoom",f)).fire(new y.Event("zoomend",f)),z&&this.fire(new y.Event("rotatestart",f)).fire(new y.Event("rotate",f)).fire(new y.Event("rotateend",f)),B&&this.fire(new y.Event("pitchstart",f)).fire(new y.Event("pitch",f)).fire(new y.Event("pitchend",f)),this.fire(new y.Event("moveend",f))},c.prototype.easeTo=function(u,f){var S=this;this._stop(!1,u.easeId),((u=y.extend({offset:[0,0],duration:500,easing:y.ease},u)).animate===!1||!u.essential&&y.browser.prefersReducedMotion)&&(u.duration=0);var A=this.transform,z=this.getZoom(),B=this.getBearing(),q=this.getPitch(),W=this.getPadding(),oe="zoom"in u?+u.zoom:z,se="bearing"in u?this._normalizeBearing(u.bearing,B):B,ue="pitch"in u?+u.pitch:q,Ee="padding"in u?u.padding:A.padding,be=y.Point.convert(u.offset),Ce=A.centerPoint.add(be),me=A.pointLocation(Ce),Te=y.LngLat.convert(u.center||me);this._normalizeCenter(Te);var Le,Ne,We=A.project(me),He=A.project(Te).sub(We),Je=A.zoomScale(oe-z);u.around&&(Le=y.LngLat.convert(u.around),Ne=A.locationPoint(Le));var ut={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||oe!==z,this._rotating=this._rotating||B!==se,this._pitching=this._pitching||ue!==q,this._padding=!A.isPaddingEqual(Ee),this._easeId=u.easeId,this._prepareEase(f,u.noMoveStart,ut),this._ease(function(_t){if(S._zooming&&(A.zoom=y.number(z,oe,_t)),S._rotating&&(A.bearing=y.number(B,se,_t)),S._pitching&&(A.pitch=y.number(q,ue,_t)),S._padding&&(A.interpolatePadding(W,Ee,_t),Ce=A.centerPoint.add(be)),Le)A.setLocationAtPoint(Le,Ne);else{var gt=A.zoomScale(A.zoom-z),Mt=oe>z?Math.min(2,Je):Math.max(.5,Je),Zt=Math.pow(Mt,1-_t),Wt=A.unproject(We.add(He.mult(_t*Zt)).mult(gt));A.setLocationAtPoint(A.renderWorldCopies?Wt.wrap():Wt,Ce)}S._fireMoveEvents(f)},function(_t){S._afterEase(f,_t)},u),this},c.prototype._prepareEase=function(u,f,S){S===void 0&&(S={}),this._moving=!0,f||S.moving||this.fire(new y.Event("movestart",u)),this._zooming&&!S.zooming&&this.fire(new y.Event("zoomstart",u)),this._rotating&&!S.rotating&&this.fire(new y.Event("rotatestart",u)),this._pitching&&!S.pitching&&this.fire(new y.Event("pitchstart",u))},c.prototype._fireMoveEvents=function(u){this.fire(new y.Event("move",u)),this._zooming&&this.fire(new y.Event("zoom",u)),this._rotating&&this.fire(new y.Event("rotate",u)),this._pitching&&this.fire(new y.Event("pitch",u))},c.prototype._afterEase=function(u,f){if(!this._easeId||!f||this._easeId!==f){delete this._easeId;var S=this._zooming,A=this._rotating,z=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,S&&this.fire(new y.Event("zoomend",u)),A&&this.fire(new y.Event("rotateend",u)),z&&this.fire(new y.Event("pitchend",u)),this.fire(new y.Event("moveend",u))}},c.prototype.flyTo=function(u,f){var S=this;if(!u.essential&&y.browser.prefersReducedMotion){var A=y.pick(u,["center","zoom","bearing","pitch","around"]);return this.jumpTo(A,f)}this.stop(),u=y.extend({offset:[0,0],speed:1.2,curve:1.42,easing:y.ease},u);var z=this.transform,B=this.getZoom(),q=this.getBearing(),W=this.getPitch(),oe=this.getPadding(),se="zoom"in u?y.clamp(+u.zoom,z.minZoom,z.maxZoom):B,ue="bearing"in u?this._normalizeBearing(u.bearing,q):q,Ee="pitch"in u?+u.pitch:W,be="padding"in u?u.padding:z.padding,Ce=z.zoomScale(se-B),me=y.Point.convert(u.offset),Te=z.centerPoint.add(me),Le=z.pointLocation(Te),Ne=y.LngLat.convert(u.center||Le);this._normalizeCenter(Ne);var We=z.project(Le),He=z.project(Ne).sub(We),Je=u.curve,ut=Math.max(z.width,z.height),_t=ut/Ce,gt=He.mag();if("minZoom"in u){var Mt=y.clamp(Math.min(u.minZoom,B,se),z.minZoom,z.maxZoom),Zt=ut/z.zoomScale(Mt-B);Je=Math.sqrt(Zt/gt*2)}var Wt=Je*Je;function Gt(Kt){var Xt=(_t*_t-ut*ut+(Kt?-1:1)*Wt*Wt*gt*gt)/(2*(Kt?_t:ut)*Wt*gt);return Math.log(Math.sqrt(Xt*Xt+1)-Xt)}function Ai(Kt){return(Math.exp(Kt)-Math.exp(-Kt))/2}function Ft(Kt){return(Math.exp(Kt)+Math.exp(-Kt))/2}var ai=Gt(0),wi=function(Kt){return Ft(ai)/Ft(ai+Je*Kt)},ni=function(Kt){return ut*((Ft(ai)*(Ai(Xt=ai+Je*Kt)/Ft(Xt))-Ai(ai))/Wt)/gt;var Xt},ei=(Gt(1)-ai)/Je;if(Math.abs(gt)<1e-6||!isFinite(ei)){if(Math.abs(ut-_t)<1e-6)return this.easeTo(u,f);var ci=_t<ut?-1:1;ei=Math.abs(Math.log(_t/ut))/Je,ni=function(){return 0},wi=function(Kt){return Math.exp(ci*Je*Kt)}}return u.duration="duration"in u?+u.duration:1e3*ei/("screenSpeed"in u?+u.screenSpeed/Je:+u.speed),u.maxDuration&&u.duration>u.maxDuration&&(u.duration=0),this._zooming=!0,this._rotating=q!==ue,this._pitching=Ee!==W,this._padding=!z.isPaddingEqual(be),this._prepareEase(f,!1),this._ease(function(Kt){var Xt=Kt*ei,yr=1/wi(Xt);z.zoom=Kt===1?se:B+z.scaleZoom(yr),S._rotating&&(z.bearing=y.number(q,ue,Kt)),S._pitching&&(z.pitch=y.number(W,Ee,Kt)),S._padding&&(z.interpolatePadding(oe,be,Kt),Te=z.centerPoint.add(me));var Ir=Kt===1?Ne:z.unproject(We.add(He.mult(ni(Xt))).mult(yr));z.setLocationAtPoint(z.renderWorldCopies?Ir.wrap():Ir,Te),S._fireMoveEvents(f)},function(){return S._afterEase(f)},u),this},c.prototype.isEasing=function(){return!!this._easeFrameId},c.prototype.stop=function(){return this._stop()},c.prototype._stop=function(u,f){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var S=this._onEaseEnd;delete this._onEaseEnd,S.call(this,f)}if(!u){var A=this.handlers;A&&A.stop(!1)}return this},c.prototype._ease=function(u,f,S){S.animate===!1||S.duration===0?(u(1),f()):(this._easeStart=y.browser.now(),this._easeOptions=S,this._onEaseFrame=u,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},c.prototype._renderFrameCallback=function(){var u=Math.min((y.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(u)),u<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},c.prototype._normalizeBearing=function(u,f){u=y.wrap(u,-180,180);var S=Math.abs(u-f);return Math.abs(u-360-f)<S&&(u-=360),Math.abs(u+360-f)<S&&(u+=360),u},c.prototype._normalizeCenter=function(u){var f=this.transform;if(f.renderWorldCopies&&!f.lngRange){var S=u.lng-f.center.lng;u.lng+=S>180?-360:S<-180?360:0}},c}(y.Evented),Or=function(s){s===void 0&&(s={}),this.options=s,y.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};Or.prototype.getDefaultPosition=function(){return"bottom-right"},Or.prototype.onAdd=function(s){var c=this.options&&this.options.compact;return this._map=s,this._container=he.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=he.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=he.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},Or.prototype.onRemove=function(){he.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},Or.prototype._setElementTitle=function(s,c){var u=this._map._getUIString("AttributionControl."+c);s.title=u,s.setAttribute("aria-label",u)},Or.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},Or.prototype._updateEditLink=function(){var s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));var c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||y.config.ACCESS_TOKEN}];if(s){var u=c.reduce(function(f,S,A){return S.value&&(f+=S.key+"="+S.value+(A<c.length-1?"&":"")),f},"?");s.href=y.config.FEEDBACK_URL+"/"+u+(this._map._hash?this._map._hash.getHashString(!0):""),s.rel="noopener nofollow",this._setElementTitle(s,"MapFeedback")}},Or.prototype._updateData=function(s){!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},Or.prototype._updateAttributions=function(){if(this._map.style){var s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map(function(B){return typeof B!="string"?"":B})):typeof this.options.customAttribution=="string"&&s.push(this.options.customAttribution)),this._map.style.stylesheet){var c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}var u=this._map.style.sourceCaches;for(var f in u){var S=u[f];if(S.used){var A=S.getSource();A.attribution&&s.indexOf(A.attribution)<0&&s.push(A.attribution)}}s.sort(function(B,q){return B.length-q.length});var z=(s=s.filter(function(B,q){for(var W=q+1;W<s.length;W++)if(s[W].indexOf(B)>=0)return!1;return!0})).join(" | ");z!==this._attribHTML&&(this._attribHTML=z,s.length?(this._innerContainer.innerHTML=z,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},Or.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Bn=function(){y.bindAll(["_updateLogo"],this),y.bindAll(["_updateCompact"],this)};Bn.prototype.onAdd=function(s){this._map=s,this._container=he.create("div","mapboxgl-ctrl");var c=he.create("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Bn.prototype.onRemove=function(){he.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Bn.prototype.getDefaultPosition=function(){return"bottom-left"},Bn.prototype._updateLogo=function(s){s&&s.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Bn.prototype._logoRequired=function(){if(this._map.style){var s=this._map.style.sourceCaches;for(var c in s)if(s[c].getSource().mapbox_logo)return!0;return!1}},Bn.prototype._updateCompact=function(){var s=this._container.children;if(s.length){var c=s[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}};var b=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};b.prototype.add=function(s){var c=++this._id;return this._queue.push({callback:s,id:c,cancelled:!1}),c},b.prototype.remove=function(s){for(var c=this._currentlyRunning,u=0,f=c?this._queue.concat(c):this._queue;u<f.length;u+=1){var S=f[u];if(S.id===s)return void(S.cancelled=!0)}},b.prototype.run=function(s){s===void 0&&(s=0);var c=this._currentlyRunning=this._queue;this._queue=[];for(var u=0,f=c;u<f.length;u+=1){var S=f[u];if(!S.cancelled&&(S.callback(s),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},b.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var n={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},h=y.window.HTMLImageElement,v=y.window.HTMLElement,w=y.window.ImageBitmap,I={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},L=function(s){function c(f){var S=this;if((f=y.extend({},I,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var A=new bi(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies);if(s.call(this,A,f),this._interactive=f.interactive,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._crossSourceCollisions=f.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=f.collectResourceTiming,this._renderTaskQueue=new b,this._controls=[],this._mapId=y.uniqueId(),this._locale=y.extend({},n,f.locale),this._clickTolerance=f.clickTolerance,this._requestManager=new y.RequestManager(f.transformRequest,f.accessToken),typeof f.container=="string"){if(this._container=y.window.document.getElementById(f.container),!this._container)throw new Error("Container '"+f.container+"' not found.")}else{if(!(f.container instanceof v))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(f.maxBounds&&this.setMaxBounds(f.maxBounds),y.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return S._update(!1)}),this.on("moveend",function(){return S._update(!1)}),this.on("zoom",function(){return S._update(!0)}),y.window!==void 0&&(y.window.addEventListener("online",this._onWindowOnline,!1),y.window.addEventListener("resize",this._onWindowResize,!1),y.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Tt(this,f),this._hash=f.hash&&new kt(typeof f.hash=="string"&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,y.extend({},f.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=f.localIdeographFontFamily,f.style&&this.setStyle(f.style,{localIdeographFontFamily:f.localIdeographFontFamily}),f.attributionControl&&this.addControl(new Or({customAttribution:f.customAttribution})),this.addControl(new Bn,f.logoPosition),this.on("style.load",function(){S.transform.unmodified&&S.jumpTo(S.style.stylesheet)}),this.on("data",function(z){S._update(z.dataType==="style"),S.fire(new y.Event(z.dataType+"data",z))}),this.on("dataloading",function(z){S.fire(new y.Event(z.dataType+"dataloading",z))})}s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c;var u={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return c.prototype._getMapId=function(){return this._mapId},c.prototype.addControl=function(f,S){if(S===void 0&&(S=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var A=f.onAdd(this);this._controls.push(f);var z=this._controlPositions[S];return S.indexOf("bottom")!==-1?z.insertBefore(A,z.firstChild):z.appendChild(A),this},c.prototype.removeControl=function(f){if(!f||!f.onRemove)return this.fire(new y.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var S=this._controls.indexOf(f);return S>-1&&this._controls.splice(S,1),f.onRemove(this),this},c.prototype.hasControl=function(f){return this._controls.indexOf(f)>-1},c.prototype.resize=function(f){var S=this._containerDimensions(),A=S[0],z=S[1];if(A===this.transform.width&&z===this.transform.height)return this;this._resizeCanvas(A,z),this.transform.resize(A,z),this.painter.resize(A,z);var B=!this._moving;return B&&this.fire(new y.Event("movestart",f)).fire(new y.Event("move",f)),this.fire(new y.Event("resize",f)),B&&this.fire(new y.Event("moveend",f)),this},c.prototype.getBounds=function(){return this.transform.getBounds()},c.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},c.prototype.setMaxBounds=function(f){return this.transform.setMaxBounds(y.LngLatBounds.convert(f)),this._update()},c.prototype.setMinZoom=function(f){if((f=f==null?-2:f)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f&&this.setZoom(f),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},c.prototype.getMinZoom=function(){return this.transform.minZoom},c.prototype.setMaxZoom=function(f){if((f=f==null?22:f)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f&&this.setZoom(f),this;throw new Error("maxZoom must be greater than the current minZoom")},c.prototype.getMaxZoom=function(){return this.transform.maxZoom},c.prototype.setMinPitch=function(f){if((f=f==null?0:f)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f&&this.setPitch(f),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},c.prototype.getMinPitch=function(){return this.transform.minPitch},c.prototype.setMaxPitch=function(f){if((f=f==null?60:f)>60)throw new Error("maxPitch must be less than or equal to 60");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f&&this.setPitch(f),this;throw new Error("maxPitch must be greater than the current minPitch")},c.prototype.getMaxPitch=function(){return this.transform.maxPitch},c.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},c.prototype.setRenderWorldCopies=function(f){return this.transform.renderWorldCopies=f,this._update()},c.prototype.project=function(f){return this.transform.locationPoint(y.LngLat.convert(f))},c.prototype.unproject=function(f){return this.transform.pointLocation(y.Point.convert(f))},c.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},c.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},c.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},c.prototype._createDelegatedListener=function(f,S,A){var z,B=this;if(f==="mouseenter"||f==="mouseover"){var q=!1;return{layer:S,listener:A,delegates:{mousemove:function(oe){var se=B.getLayer(S)?B.queryRenderedFeatures(oe.point,{layers:[S]}):[];se.length?q||(q=!0,A.call(B,new dr(f,B,oe.originalEvent,{features:se}))):q=!1},mouseout:function(){q=!1}}}}if(f==="mouseleave"||f==="mouseout"){var W=!1;return{layer:S,listener:A,delegates:{mousemove:function(oe){(B.getLayer(S)?B.queryRenderedFeatures(oe.point,{layers:[S]}):[]).length?W=!0:W&&(W=!1,A.call(B,new dr(f,B,oe.originalEvent)))},mouseout:function(oe){W&&(W=!1,A.call(B,new dr(f,B,oe.originalEvent)))}}}}return{layer:S,listener:A,delegates:(z={},z[f]=function(oe){var se=B.getLayer(S)?B.queryRenderedFeatures(oe.point,{layers:[S]}):[];se.length&&(oe.features=se,A.call(B,oe),delete oe.features)},z)}},c.prototype.on=function(f,S,A){if(A===void 0)return s.prototype.on.call(this,f,S);var z=this._createDelegatedListener(f,S,A);for(var B in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(z),z.delegates)this.on(B,z.delegates[B]);return this},c.prototype.once=function(f,S,A){if(A===void 0)return s.prototype.once.call(this,f,S);var z=this._createDelegatedListener(f,S,A);for(var B in z.delegates)this.once(B,z.delegates[B]);return this},c.prototype.off=function(f,S,A){var z=this;return A===void 0?s.prototype.off.call(this,f,S):(this._delegatedListeners&&this._delegatedListeners[f]&&function(B){for(var q=B[f],W=0;W<q.length;W++){var oe=q[W];if(oe.layer===S&&oe.listener===A){for(var se in oe.delegates)z.off(se,oe.delegates[se]);return q.splice(W,1),z}}}(this._delegatedListeners),this)},c.prototype.queryRenderedFeatures=function(f,S){if(!this.style)return[];var A;if(S!==void 0||f===void 0||f instanceof y.Point||Array.isArray(f)||(S=f,f=void 0),S=S||{},(f=f||[[0,0],[this.transform.width,this.transform.height]])instanceof y.Point||typeof f[0]=="number")A=[y.Point.convert(f)];else{var z=y.Point.convert(f[0]),B=y.Point.convert(f[1]);A=[z,new y.Point(B.x,z.y),B,new y.Point(z.x,B.y),z]}return this.style.queryRenderedFeatures(A,S,this.transform)},c.prototype.querySourceFeatures=function(f,S){return this.style.querySourceFeatures(f,S)},c.prototype.setStyle=function(f,S){return(S=y.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},S)).diff!==!1&&S.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&f?(this._diffStyle(f,S),this):(this._localIdeographFontFamily=S.localIdeographFontFamily,this._updateStyle(f,S))},c.prototype._getUIString=function(f){var S=this._locale[f];if(S==null)throw new Error("Missing UI string '"+f+"'");return S},c.prototype._updateStyle=function(f,S){return this.style&&(this.style.setEventedParent(null),this.style._remove()),f?(this.style=new an(this,S||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f):this.style.loadJSON(f),this):(delete this.style,this)},c.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new an(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},c.prototype._diffStyle=function(f,S){var A=this;if(typeof f=="string"){var z=this._requestManager.normalizeStyleURL(f),B=this._requestManager.transformRequest(z,y.ResourceType.Style);y.getJSON(B,function(q,W){q?A.fire(new y.ErrorEvent(q)):W&&A._updateDiff(W,S)})}else typeof f=="object"&&this._updateDiff(f,S)},c.prototype._updateDiff=function(f,S){try{this.style.setState(f)&&this._update(!0)}catch(A){y.warnOnce("Unable to perform style diff: "+(A.message||A.error||A)+".  Rebuilding the style from scratch."),this._updateStyle(f,S)}},c.prototype.getStyle=function(){if(this.style)return this.style.serialize()},c.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():y.warnOnce("There is no style added to the map.")},c.prototype.addSource=function(f,S){return this._lazyInitEmptyStyle(),this.style.addSource(f,S),this._update(!0)},c.prototype.isSourceLoaded=function(f){var S=this.style&&this.style.sourceCaches[f];if(S!==void 0)return S.loaded();this.fire(new y.ErrorEvent(new Error("There is no source with ID '"+f+"'")))},c.prototype.areTilesLoaded=function(){var f=this.style&&this.style.sourceCaches;for(var S in f){var A=f[S]._tiles;for(var z in A){var B=A[z];if(B.state!=="loaded"&&B.state!=="errored")return!1}}return!0},c.prototype.addSourceType=function(f,S,A){return this._lazyInitEmptyStyle(),this.style.addSourceType(f,S,A)},c.prototype.removeSource=function(f){return this.style.removeSource(f),this._update(!0)},c.prototype.getSource=function(f){return this.style.getSource(f)},c.prototype.addImage=function(f,S,A){A===void 0&&(A={});var z=A.pixelRatio;z===void 0&&(z=1);var B=A.sdf;B===void 0&&(B=!1);var q=A.stretchX,W=A.stretchY,oe=A.content;if(this._lazyInitEmptyStyle(),S instanceof h||w&&S instanceof w){var se=y.browser.getImageData(S);this.style.addImage(f,{data:new y.RGBAImage({width:se.width,height:se.height},se.data),pixelRatio:z,stretchX:q,stretchY:W,content:oe,sdf:B,version:0})}else{if(S.width===void 0||S.height===void 0)return this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var ue=S;this.style.addImage(f,{data:new y.RGBAImage({width:S.width,height:S.height},new Uint8Array(S.data)),pixelRatio:z,stretchX:q,stretchY:W,content:oe,sdf:B,version:0,userImage:ue}),ue.onAdd&&ue.onAdd(this,f)}},c.prototype.updateImage=function(f,S){var A=this.style.getImage(f);if(!A)return this.fire(new y.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var z=S instanceof h||w&&S instanceof w?y.browser.getImageData(S):S,B=z.width,q=z.height,W=z.data;return B===void 0||q===void 0?this.fire(new y.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):B!==A.data.width||q!==A.data.height?this.fire(new y.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(A.data.replace(W,!(S instanceof h||w&&S instanceof w)),void this.style.updateImage(f,A))},c.prototype.hasImage=function(f){return f?!!this.style.getImage(f):(this.fire(new y.ErrorEvent(new Error("Missing required image id"))),!1)},c.prototype.removeImage=function(f){this.style.removeImage(f)},c.prototype.loadImage=function(f,S){y.getImage(this._requestManager.transformRequest(f,y.ResourceType.Image),S)},c.prototype.listImages=function(){return this.style.listImages()},c.prototype.addLayer=function(f,S){return this._lazyInitEmptyStyle(),this.style.addLayer(f,S),this._update(!0)},c.prototype.moveLayer=function(f,S){return this.style.moveLayer(f,S),this._update(!0)},c.prototype.removeLayer=function(f){return this.style.removeLayer(f),this._update(!0)},c.prototype.getLayer=function(f){return this.style.getLayer(f)},c.prototype.setLayerZoomRange=function(f,S,A){return this.style.setLayerZoomRange(f,S,A),this._update(!0)},c.prototype.setFilter=function(f,S,A){return A===void 0&&(A={}),this.style.setFilter(f,S,A),this._update(!0)},c.prototype.getFilter=function(f){return this.style.getFilter(f)},c.prototype.setPaintProperty=function(f,S,A,z){return z===void 0&&(z={}),this.style.setPaintProperty(f,S,A,z),this._update(!0)},c.prototype.getPaintProperty=function(f,S){return this.style.getPaintProperty(f,S)},c.prototype.setLayoutProperty=function(f,S,A,z){return z===void 0&&(z={}),this.style.setLayoutProperty(f,S,A,z),this._update(!0)},c.prototype.getLayoutProperty=function(f,S){return this.style.getLayoutProperty(f,S)},c.prototype.setLight=function(f,S){return S===void 0&&(S={}),this._lazyInitEmptyStyle(),this.style.setLight(f,S),this._update(!0)},c.prototype.getLight=function(){return this.style.getLight()},c.prototype.setFeatureState=function(f,S){return this.style.setFeatureState(f,S),this._update()},c.prototype.removeFeatureState=function(f,S){return this.style.removeFeatureState(f,S),this._update()},c.prototype.getFeatureState=function(f){return this.style.getFeatureState(f)},c.prototype.getContainer=function(){return this._container},c.prototype.getCanvasContainer=function(){return this._canvasContainer},c.prototype.getCanvas=function(){return this._canvas},c.prototype._containerDimensions=function(){var f=0,S=0;return this._container&&(f=this._container.clientWidth||400,S=this._container.clientHeight||300),[f,S]},c.prototype._detectMissingCSS=function(){y.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&y.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},c.prototype._setupContainer=function(){var f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=he.create("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();var S=this._canvasContainer=he.create("div","mapboxgl-canvas-container",f);this._interactive&&S.classList.add("mapboxgl-interactive"),this._canvas=he.create("canvas","mapboxgl-canvas",S),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var A=this._containerDimensions();this._resizeCanvas(A[0],A[1]);var z=this._controlContainer=he.create("div","mapboxgl-control-container",f),B=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(q){B[q]=he.create("div","mapboxgl-ctrl-"+q,z)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},c.prototype._resizeCanvas=function(f,S){var A=y.browser.devicePixelRatio||1;this._canvas.width=A*f,this._canvas.height=A*S,this._canvas.style.width=f+"px",this._canvas.style.height=S+"px"},c.prototype._setupPainter=function(){var f=y.extend({},x.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),S=this._canvas.getContext("webgl",f)||this._canvas.getContext("experimental-webgl",f);S?(this.painter=new ur(S,this.transform),y.webpSupported.testSupport(S)):this.fire(new y.ErrorEvent(new Error("Failed to initialize WebGL")))},c.prototype._contextLost=function(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new y.Event("webglcontextlost",{originalEvent:f}))},c.prototype._contextRestored=function(f){this._setupPainter(),this.resize(),this._update(),this.fire(new y.Event("webglcontextrestored",{originalEvent:f}))},c.prototype._onMapScroll=function(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},c.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},c.prototype._update=function(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this},c.prototype._requestRenderFrame=function(f){return this._update(),this._renderTaskQueue.add(f)},c.prototype._cancelRenderFrame=function(f){this._renderTaskQueue.remove(f)},c.prototype._render=function(f){var S,A=this,z=0,B=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(S=B.createQueryEXT(),B.beginQueryEXT(B.TIME_ELAPSED_EXT,S),z=y.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),!this._removed){var q=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var W=this.transform.zoom,oe=y.browser.now();this.style.zoomHistory.update(W,oe);var se=new y.EvaluationParameters(W,{now:oe,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ue=se.crossFadingFactor();ue===1&&ue===this._crossFadingFactor||(q=!0,this._crossFadingFactor=ue),this.style.update(se)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new y.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new y.Event("load"))),this.style&&(this.style.hasTransitions()||q)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Ee=y.browser.now()-z;B.endQueryEXT(B.TIME_ELAPSED_EXT,S),setTimeout(function(){var me=B.getQueryObjectEXT(S,B.QUERY_RESULT_EXT)/1e6;B.deleteQueryEXT(S),A.fire(new y.Event("gpu-timing-frame",{cpuTime:Ee,gpuTime:me}))},50)}if(this.listens("gpu-timing-layer")){var be=this.painter.collectGpuTimers();setTimeout(function(){var me=A.painter.queryGpuTimers(be);A.fire(new y.Event("gpu-timing-layer",{layerTimes:me}))},50)}var Ce=this._sourcesDirty||this._styleDirty||this._placementDirty;return Ce||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new y.Event("idle")),!this._loaded||this._fullyLoaded||Ce||(this._fullyLoaded=!0),this}},c.prototype.remove=function(){this._hash&&this._hash.remove();for(var f=0,S=this._controls;f<S.length;f+=1)S[f].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),y.window!==void 0&&(y.window.removeEventListener("resize",this._onWindowResize,!1),y.window.removeEventListener("orientationchange",this._onWindowResize,!1),y.window.removeEventListener("online",this._onWindowOnline,!1));var A=this.painter.context.gl.getExtension("WEBGL_lose_context");A&&A.loseContext(),O(this._canvasContainer),O(this._controlContainer),O(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new y.Event("remove"))},c.prototype.triggerRepaint=function(){var f=this;this.style&&!this._frame&&(this._frame=y.browser.frame(function(S){f._frame=null,f._render(S)}))},c.prototype._onWindowOnline=function(){this._update()},c.prototype._onWindowResize=function(f){this._trackResize&&this.resize({originalEvent:f})._update()},u.showTileBoundaries.get=function(){return!!this._showTileBoundaries},u.showTileBoundaries.set=function(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())},u.showPadding.get=function(){return!!this._showPadding},u.showPadding.set=function(f){this._showPadding!==f&&(this._showPadding=f,this._update())},u.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},u.showCollisionBoxes.set=function(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())},u.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},u.showOverdrawInspector.set=function(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())},u.repaint.get=function(){return!!this._repaint},u.repaint.set=function(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())},u.vertices.get=function(){return!!this._vertices},u.vertices.set=function(f){this._vertices=f,this._update()},c.prototype._setCacheLimits=function(f,S){y.setCacheLimits(f,S)},u.version.get=function(){return y.version},Object.defineProperties(c.prototype,u),c}(qs);function O(s){s.parentNode&&s.parentNode.removeChild(s)}var N={showCompass:!0,showZoom:!0,visualizePitch:!1},$=function(s){var c=this;this.options=y.extend({},N,s),this._container=he.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(u){return u.preventDefault()}),this.options.showZoom&&(y.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(u){return c._map.zoomIn({},{originalEvent:u})}),he.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(u){return c._map.zoomOut({},{originalEvent:u})}),he.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(y.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(u){c.options.visualizePitch?c._map.resetNorthPitch({},{originalEvent:u}):c._map.resetNorth({},{originalEvent:u})}),this._compassIcon=he.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};$.prototype._updateZoomButtons=function(){var s=this._map.getZoom(),c=s===this._map.getMaxZoom(),u=s===this._map.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},$.prototype._rotateCompassArrow=function(){var s=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=s},$.prototype.onAdd=function(s){return this._map=s,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new H(this._map,this._compass,this.options.visualizePitch)),this._container},$.prototype.onRemove=function(){he.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},$.prototype._createButton=function(s,c){var u=he.create("button",s,this._container);return u.type="button",u.addEventListener("click",c),u},$.prototype._setButtonTitle=function(s,c){var u=this._map._getUIString("NavigationControl."+c);s.title=u,s.setAttribute("aria-label",u)};var H=function(s,c,u){u===void 0&&(u=!1),this._clickTolerance=10,this.element=c,this.mouseRotate=new fa({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,u&&(this.mousePitch=new js({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),y.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),he.addEventListener(c,"mousedown",this.mousedown),he.addEventListener(c,"touchstart",this.touchstart,{passive:!1}),he.addEventListener(c,"touchmove",this.touchmove),he.addEventListener(c,"touchend",this.touchend),he.addEventListener(c,"touchcancel",this.reset)};function re(s,c,u){if(s=new y.LngLat(s.lng,s.lat),c){var f=new y.LngLat(s.lng-360,s.lat),S=new y.LngLat(s.lng+360,s.lat),A=u.locationPoint(s).distSqr(c);u.locationPoint(f).distSqr(c)<A?s=f:u.locationPoint(S).distSqr(c)<A&&(s=S)}for(;Math.abs(s.lng-u.center.lng)>180;){var z=u.locationPoint(s);if(z.x>=0&&z.y>=0&&z.x<=u.width&&z.y<=u.height)break;s.lng>u.center.lng?s.lng-=360:s.lng+=360}return s}H.prototype.down=function(s,c){this.mouseRotate.mousedown(s,c),this.mousePitch&&this.mousePitch.mousedown(s,c),he.disableDrag()},H.prototype.move=function(s,c){var u=this.map,f=this.mouseRotate.mousemoveWindow(s,c);if(f&&f.bearingDelta&&u.setBearing(u.getBearing()+f.bearingDelta),this.mousePitch){var S=this.mousePitch.mousemoveWindow(s,c);S&&S.pitchDelta&&u.setPitch(u.getPitch()+S.pitchDelta)}},H.prototype.off=function(){var s=this.element;he.removeEventListener(s,"mousedown",this.mousedown),he.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),he.removeEventListener(s,"touchmove",this.touchmove),he.removeEventListener(s,"touchend",this.touchend),he.removeEventListener(s,"touchcancel",this.reset),this.offTemp()},H.prototype.offTemp=function(){he.enableDrag(),he.removeEventListener(y.window,"mousemove",this.mousemove),he.removeEventListener(y.window,"mouseup",this.mouseup)},H.prototype.mousedown=function(s){this.down(y.extend({},s,{ctrlKey:!0,preventDefault:function(){return s.preventDefault()}}),he.mousePos(this.element,s)),he.addEventListener(y.window,"mousemove",this.mousemove),he.addEventListener(y.window,"mouseup",this.mouseup)},H.prototype.mousemove=function(s){this.move(s,he.mousePos(this.element,s))},H.prototype.mouseup=function(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()},H.prototype.touchstart=function(s){s.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=he.touchPos(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return s.preventDefault()}},this._startPos))},H.prototype.touchmove=function(s){s.targetTouches.length!==1?this.reset():(this._lastPos=he.touchPos(this.element,s.targetTouches)[0],this.move({preventDefault:function(){return s.preventDefault()}},this._lastPos))},H.prototype.touchend=function(s){s.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},H.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var fe={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Pe(s,c,u){var f=s.classList;for(var S in fe)f.remove("mapboxgl-"+u+"-anchor-"+S);f.add("mapboxgl-"+u+"-anchor-"+c)}var ye,ze=function(s){function c(u,f){if(s.call(this),(u instanceof y.window.HTMLElement||f)&&(u=y.extend({element:u},f)),y.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=u&&u.anchor||"center",this._color=u&&u.color||"#3FB1CE",this._scale=u&&u.scale||1,this._draggable=u&&u.draggable||!1,this._clickTolerance=u&&u.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=u&&u.rotation||0,this._rotationAlignment=u&&u.rotationAlignment||"auto",this._pitchAlignment=u&&u.pitchAlignment&&u.pitchAlignment!=="auto"?u.pitchAlignment:this._rotationAlignment,u&&u.element)this._element=u.element,this._offset=y.Point.convert(u&&u.offset||[0,0]);else{this._defaultMarker=!0,this._element=he.create("div"),this._element.setAttribute("aria-label","Map marker");var S=he.createNS("http://www.w3.org/2000/svg","svg");S.setAttributeNS(null,"display","block"),S.setAttributeNS(null,"height","41px"),S.setAttributeNS(null,"width","27px"),S.setAttributeNS(null,"viewBox","0 0 27 41");var A=he.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"stroke","none"),A.setAttributeNS(null,"stroke-width","1"),A.setAttributeNS(null,"fill","none"),A.setAttributeNS(null,"fill-rule","evenodd");var z=he.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill-rule","nonzero");var B=he.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"transform","translate(3.0, 29.0)"),B.setAttributeNS(null,"fill","#000000");for(var q=0,W=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];q<W.length;q+=1){var oe=W[q],se=he.createNS("http://www.w3.org/2000/svg","ellipse");se.setAttributeNS(null,"opacity","0.04"),se.setAttributeNS(null,"cx","10.5"),se.setAttributeNS(null,"cy","5.80029008"),se.setAttributeNS(null,"rx",oe.rx),se.setAttributeNS(null,"ry",oe.ry),B.appendChild(se)}var ue=he.createNS("http://www.w3.org/2000/svg","g");ue.setAttributeNS(null,"fill",this._color);var Ee=he.createNS("http://www.w3.org/2000/svg","path");Ee.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),ue.appendChild(Ee);var be=he.createNS("http://www.w3.org/2000/svg","g");be.setAttributeNS(null,"opacity","0.25"),be.setAttributeNS(null,"fill","#000000");var Ce=he.createNS("http://www.w3.org/2000/svg","path");Ce.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),be.appendChild(Ce);var me=he.createNS("http://www.w3.org/2000/svg","g");me.setAttributeNS(null,"transform","translate(6.0, 7.0)"),me.setAttributeNS(null,"fill","#FFFFFF");var Te=he.createNS("http://www.w3.org/2000/svg","g");Te.setAttributeNS(null,"transform","translate(8.0, 8.0)");var Le=he.createNS("http://www.w3.org/2000/svg","circle");Le.setAttributeNS(null,"fill","#000000"),Le.setAttributeNS(null,"opacity","0.25"),Le.setAttributeNS(null,"cx","5.5"),Le.setAttributeNS(null,"cy","5.5"),Le.setAttributeNS(null,"r","5.4999962");var Ne=he.createNS("http://www.w3.org/2000/svg","circle");Ne.setAttributeNS(null,"fill","#FFFFFF"),Ne.setAttributeNS(null,"cx","5.5"),Ne.setAttributeNS(null,"cy","5.5"),Ne.setAttributeNS(null,"r","5.4999962"),Te.appendChild(Le),Te.appendChild(Ne),z.appendChild(B),z.appendChild(ue),z.appendChild(be),z.appendChild(me),z.appendChild(Te),S.appendChild(z),S.setAttributeNS(null,"height",41*this._scale+"px"),S.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(S),this._offset=y.Point.convert(u&&u.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(We){We.preventDefault()}),this._element.addEventListener("mousedown",function(We){We.preventDefault()}),Pe(this._element,this._anchor,"marker"),this._popup=null}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.addTo=function(u){return this.remove(),this._map=u,u.getCanvasContainer().appendChild(this._element),u.on("move",this._update),u.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},c.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),he.remove(this._element),this._popup&&this._popup.remove(),this},c.prototype.getLngLat=function(){return this._lngLat},c.prototype.setLngLat=function(u){return this._lngLat=y.LngLat.convert(u),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},c.prototype.getElement=function(){return this._element},c.prototype.setPopup=function(u){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),u){if(!("offset"in u.options)){var f=Math.sqrt(Math.pow(13.5,2)/2);u.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(24.6+f)],"bottom-right":[-f,-1*(24.6+f)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=u,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},c.prototype._onKeyPress=function(u){var f=u.code,S=u.charCode||u.keyCode;f!=="Space"&&f!=="Enter"&&S!==32&&S!==13||this.togglePopup()},c.prototype._onMapClick=function(u){var f=u.originalEvent.target,S=this._element;this._popup&&(f===S||S.contains(f))&&this.togglePopup()},c.prototype.getPopup=function(){return this._popup},c.prototype.togglePopup=function(){var u=this._popup;return u?(u.isOpen()?u.remove():u.addTo(this._map),this):this},c.prototype._update=function(u){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=re(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var f="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?f="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(f="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S="rotateX("+this._map.getPitch()+"deg)"),u&&u.type!=="moveend"||(this._pos=this._pos.round()),he.setTransform(this._element,fe[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+S+" "+f)}},c.prototype.getOffset=function(){return this._offset},c.prototype.setOffset=function(u){return this._offset=y.Point.convert(u),this._update(),this},c.prototype._onMove=function(u){if(!this._isDragging){var f=this._clickTolerance||this._map._clickTolerance;this._isDragging=u.point.dist(this._pointerdownPos)>=f}this._isDragging&&(this._pos=u.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new y.Event("dragstart"))),this.fire(new y.Event("drag")))},c.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new y.Event("dragend")),this._state="inactive"},c.prototype._addDragHandler=function(u){this._element.contains(u.originalEvent.target)&&(u.preventDefault(),this._positionDelta=u.point.sub(this._pos).add(this._offset),this._pointerdownPos=u.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},c.prototype.setDraggable=function(u){return this._draggable=!!u,this._map&&(u?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},c.prototype.isDraggable=function(){return this._draggable},c.prototype.setRotation=function(u){return this._rotation=u||0,this._update(),this},c.prototype.getRotation=function(){return this._rotation},c.prototype.setRotationAlignment=function(u){return this._rotationAlignment=u||"auto",this._update(),this},c.prototype.getRotationAlignment=function(){return this._rotationAlignment},c.prototype.setPitchAlignment=function(u){return this._pitchAlignment=u&&u!=="auto"?u:this._rotationAlignment,this._update(),this},c.prototype.getPitchAlignment=function(){return this._pitchAlignment},c}(y.Evented),Ve={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Fe=0,Xe=!1,je=function(s){function c(u){s.call(this),this.options=y.extend({},Ve,u),y.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.onAdd=function(u){var f;return this._map=u,this._container=he.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),f=this._setupUI,ye!==void 0?f(ye):y.window.navigator.permissions!==void 0?y.window.navigator.permissions.query({name:"geolocation"}).then(function(S){f(ye=S.state!=="denied")}):f(ye=!!y.window.navigator.geolocation),this._container},c.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),he.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Fe=0,Xe=!1},c.prototype._isOutOfMapMaxBounds=function(u){var f=this._map.getMaxBounds(),S=u.coords;return f&&(S.longitude<f.getWest()||S.longitude>f.getEast()||S.latitude<f.getSouth()||S.latitude>f.getNorth())},c.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},c.prototype._onSuccess=function(u){if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new y.Event("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(u),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("geolocate",u)),this._finish()}},c.prototype._updateCamera=function(u){var f=new y.LngLat(u.coords.longitude,u.coords.latitude),S=u.coords.accuracy,A=this._map.getBearing(),z=y.extend({bearing:A},this.options.fitBoundsOptions);this._map.fitBounds(f.toBounds(S),z,{geolocateSource:!0})},c.prototype._updateMarker=function(u){if(u){var f=new y.LngLat(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(f).addTo(this._map),this._userLocationDotMarker.setLngLat(f).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},c.prototype._updateCircleRadius=function(){var u=this._map._container.clientHeight/2,f=this._map.unproject([0,u]),S=this._map.unproject([1,u]),A=f.distanceTo(S),z=Math.ceil(2*this._accuracy/A);this._circleElement.style.width=z+"px",this._circleElement.style.height=z+"px"},c.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},c.prototype._onError=function(u){if(this._map){if(this.options.trackUserLocation)if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&Xe)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new y.Event("error",u)),this._finish()}},c.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},c.prototype._setupUI=function(u){var f=this;if(this._container.addEventListener("contextmenu",function(z){return z.preventDefault()}),this._geolocateButton=he.create("button","mapboxgl-ctrl-geolocate",this._container),he.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",u===!1){y.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var S=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=S,this._geolocateButton.setAttribute("aria-label",S)}else{var A=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=A,this._geolocateButton.setAttribute("aria-label",A)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=he.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new ze(this._dotElement),this._circleElement=he.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ze({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(z){z.geolocateSource||f._watchState!=="ACTIVE_LOCK"||z.originalEvent&&z.originalEvent.type==="resize"||(f._watchState="BACKGROUND",f._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),f._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),f.fire(new y.Event("trackuserlocationend")))})},c.prototype.trigger=function(){if(!this._setup)return y.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new y.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Fe--,Xe=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new y.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new y.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var u;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Fe>1?(u={maximumAge:6e5,timeout:0},Xe=!0):(u=this.options.positionOptions,Xe=!1),this._geolocationWatchID=y.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,u)}}else y.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},c.prototype._clearWatch=function(){y.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},c}(y.Evented),st={maxWidth:100,unit:"metric"},et=function(s){this.options=y.extend({},st,s),y.bindAll(["_onMove","setUnit"],this)};function rt(s,c,u){var f=u&&u.maxWidth||100,S=s._container.clientHeight/2,A=s.unproject([0,S]),z=s.unproject([f,S]),B=A.distanceTo(z);if(u&&u.unit==="imperial"){var q=3.2808*B;q>5280?mt(c,f,q/5280,s._getUIString("ScaleControl.Miles")):mt(c,f,q,s._getUIString("ScaleControl.Feet"))}else u&&u.unit==="nautical"?mt(c,f,B/1852,s._getUIString("ScaleControl.NauticalMiles")):B>=1e3?mt(c,f,B/1e3,s._getUIString("ScaleControl.Kilometers")):mt(c,f,B,s._getUIString("ScaleControl.Meters"))}function mt(s,c,u,f){var S,A,z,B=(S=u,(A=Math.pow(10,(""+Math.floor(S)).length-1))*(z=(z=S/A)>=10?10:z>=5?5:z>=3?3:z>=2?2:z>=1?1:function(q){var W=Math.pow(10,Math.ceil(-Math.log(q)/Math.LN10));return Math.round(q*W)/W}(z)));s.style.width=c*(B/u)+"px",s.innerHTML=B+"&nbsp;"+f}et.prototype.getDefaultPosition=function(){return"bottom-left"},et.prototype._onMove=function(){rt(this._map,this._container,this.options)},et.prototype.onAdd=function(s){return this._map=s,this._container=he.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",s.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},et.prototype.onRemove=function(){he.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},et.prototype.setUnit=function(s){this.options.unit=s,rt(this._map,this._container,this.options)};var xt=function(s){this._fullscreen=!1,s&&s.container&&(s.container instanceof y.window.HTMLElement?this._container=s.container:y.warnOnce("Full screen control 'container' must be a DOM element.")),y.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in y.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in y.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in y.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in y.window.document&&(this._fullscreenchange="MSFullscreenChange")};xt.prototype.onAdd=function(s){return this._map=s,this._container||(this._container=this._map.getContainer()),this._controlContainer=he.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",y.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},xt.prototype.onRemove=function(){he.remove(this._controlContainer),this._map=null,y.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},xt.prototype._checkFullscreenSupport=function(){return!!(y.window.document.fullscreenEnabled||y.window.document.mozFullScreenEnabled||y.window.document.msFullscreenEnabled||y.window.document.webkitFullscreenEnabled)},xt.prototype._setupUI=function(){var s=this._fullscreenButton=he.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);he.create("span","mapboxgl-ctrl-icon",s).setAttribute("aria-hidden",!0),s.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),y.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},xt.prototype._updateTitle=function(){var s=this._getTitle();this._fullscreenButton.setAttribute("aria-label",s),this._fullscreenButton.title=s},xt.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},xt.prototype._isFullscreen=function(){return this._fullscreen},xt.prototype._changeIcon=function(){(y.window.document.fullscreenElement||y.window.document.mozFullScreenElement||y.window.document.webkitFullscreenElement||y.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},xt.prototype._onClickFullscreen=function(){this._isFullscreen()?y.window.document.exitFullscreen?y.window.document.exitFullscreen():y.window.document.mozCancelFullScreen?y.window.document.mozCancelFullScreen():y.window.document.msExitFullscreen?y.window.document.msExitFullscreen():y.window.document.webkitCancelFullScreen&&y.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var lt={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},qt=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Rt=function(s){function c(u){s.call(this),this.options=y.extend(Object.create(lt),u),y.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return s&&(c.__proto__=s),(c.prototype=Object.create(s&&s.prototype)).constructor=c,c.prototype.addTo=function(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new y.Event("open")),this},c.prototype.isOpen=function(){return!!this._map},c.prototype.remove=function(){return this._content&&he.remove(this._content),this._container&&(he.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new y.Event("close")),this},c.prototype.getLngLat=function(){return this._lngLat},c.prototype.setLngLat=function(u){return this._lngLat=y.LngLat.convert(u),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},c.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},c.prototype.getElement=function(){return this._container},c.prototype.setText=function(u){return this.setDOMContent(y.window.document.createTextNode(u))},c.prototype.setHTML=function(u){var f,S=y.window.document.createDocumentFragment(),A=y.window.document.createElement("body");for(A.innerHTML=u;f=A.firstChild;)S.appendChild(f);return this.setDOMContent(S)},c.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},c.prototype.setMaxWidth=function(u){return this.options.maxWidth=u,this._update(),this},c.prototype.setDOMContent=function(u){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=he.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(u),this._createCloseButton(),this._update(),this._focusFirstElement(),this},c.prototype.addClassName=function(u){this._container&&this._container.classList.add(u)},c.prototype.removeClassName=function(u){this._container&&this._container.classList.remove(u)},c.prototype.setOffset=function(u){return this.options.offset=u,this._update(),this},c.prototype.toggleClassName=function(u){if(this._container)return this._container.classList.toggle(u)},c.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=he.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},c.prototype._onMouseUp=function(u){this._update(u.point)},c.prototype._onMouseMove=function(u){this._update(u.point)},c.prototype._onDrag=function(u){this._update(u.point)},c.prototype._update=function(u){var f=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=he.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=he.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(se){return f._container.classList.add(se)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=re(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||u)){var S=this._pos=this._trackPointer&&u?u:this._map.project(this._lngLat),A=this.options.anchor,z=function se(ue){if(ue){if(typeof ue=="number"){var Ee=Math.round(Math.sqrt(.5*Math.pow(ue,2)));return{center:new y.Point(0,0),top:new y.Point(0,ue),"top-left":new y.Point(Ee,Ee),"top-right":new y.Point(-Ee,Ee),bottom:new y.Point(0,-ue),"bottom-left":new y.Point(Ee,-Ee),"bottom-right":new y.Point(-Ee,-Ee),left:new y.Point(ue,0),right:new y.Point(-ue,0)}}if(ue instanceof y.Point||Array.isArray(ue)){var be=y.Point.convert(ue);return{center:be,top:be,"top-left":be,"top-right":be,bottom:be,"bottom-left":be,"bottom-right":be,left:be,right:be}}return{center:y.Point.convert(ue.center||[0,0]),top:y.Point.convert(ue.top||[0,0]),"top-left":y.Point.convert(ue["top-left"]||[0,0]),"top-right":y.Point.convert(ue["top-right"]||[0,0]),bottom:y.Point.convert(ue.bottom||[0,0]),"bottom-left":y.Point.convert(ue["bottom-left"]||[0,0]),"bottom-right":y.Point.convert(ue["bottom-right"]||[0,0]),left:y.Point.convert(ue.left||[0,0]),right:y.Point.convert(ue.right||[0,0])}}return se(new y.Point(0,0))}(this.options.offset);if(!A){var B,q=this._container.offsetWidth,W=this._container.offsetHeight;B=S.y+z.bottom.y<W?["top"]:S.y>this._map.transform.height-W?["bottom"]:[],S.x<q/2?B.push("left"):S.x>this._map.transform.width-q/2&&B.push("right"),A=B.length===0?"bottom":B.join("-")}var oe=S.add(z[A]).round();he.setTransform(this._container,fe[A]+" translate("+oe.x+"px,"+oe.y+"px)"),Pe(this._container,A,"popup")}},c.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var u=this._container.querySelector(qt);u&&u.focus()}},c.prototype._onClose=function(){this.remove()},c}(y.Evented),li={version:y.version,supported:x,setRTLTextPlugin:y.setRTLTextPlugin,getRTLTextPluginStatus:y.getRTLTextPluginStatus,Map:L,NavigationControl:$,GeolocateControl:je,AttributionControl:Or,ScaleControl:et,FullscreenControl:xt,Popup:Rt,Marker:ze,Style:an,LngLat:y.LngLat,LngLatBounds:y.LngLatBounds,Point:y.Point,MercatorCoordinate:y.MercatorCoordinate,Evented:y.Evented,config:y.config,prewarm:function(){le().acquire(U)},clearPrewarmedResources:function(){var s=ne;s&&(s.isPreloaded()&&s.numActive()===1?(s.release(U),ne=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return y.config.ACCESS_TOKEN},set accessToken(s){y.config.ACCESS_TOKEN=s},get baseApiUrl(){return y.config.API_URL},set baseApiUrl(s){y.config.API_URL=s},get workerCount(){return J.workerCount},set workerCount(s){J.workerCount=s},get maxParallelImageRequests(){return y.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(s){y.config.MAX_PARALLEL_IMAGE_REQUESTS=s},clearStorage:function(s){y.clearTileCache(s)},workerUrl:""};return li}),te})})(Qd);Object.defineProperty($m,"__esModule",{value:!0});const j_=Qd.exports;class q_{constructor(M){this.map=M,this.contents=[]}add(M,j,K){var te;let Ae=`
    <div class="mapboxgl-popup-layer-name">${K}</div>
    <div class="mapboxgl-popup-panel_area"><table class="mapboxgl-popup-table">
    ${Object.keys(j.properties).map(he=>`<tr><th class="mapboxgl-popup-th">${he.replace(/_/g," ").replace(/-/g," ")}</th><td class="mapboxgl-popup-td">${j.properties[he]}</td></tr>`).join("")}
    </table></div>`;this.contents.push(Ae);let y;if(this.contents.length===1?y=this.contents[0]:y=`
      <div class="mapboxgl-popup-tab_wrap">
      ${this.contents.map(he=>{let it=this.contents.indexOf(he)+1;return`<input id="mapboxgl-popup-tab${it}" type="radio" name="tab_btn" ${it===0?"checked":""}>`}).join("")}
      <div class="mapboxgl-popup-tab_area">
      ${this.contents.map(he=>{let it=this.contents.indexOf(he)+1;return`<label class="mapboxgl-popup-tab${it}_label" for="mapboxgl-popup-tab${it}">${it}</label>`}).join("")}
      </div>
      <div class="mapboxgl-popup-panel_area">
      ${this.contents.map(he=>`<div id="mapboxgl-popup-panel${this.contents.indexOf(he)+1}" class="mapboxgl-popup-tab_panel">${he}</div>`).join("")}
      </div>
     </div>`,this.popup?this.popup.setHTML(y):this.popup=new j_.Popup().setLngLat(M).setHTML(y).setMaxWidth("400px").addTo(this.map),this.contents.length>1){const he=document.getElementById("mapboxgl-popup-tab1");he.checked=!0}var x=this;(te=x.popup)===null||te===void 0||te.on("close",function(){x.popup=null,x.contents=[]})}}class G_{constructor(M=[]){this.targets=M}createPopup(M,j){var K;let te=M.lngLat;const Ae=M.features[0];for(Ae.geometry.type==="Point"&&(te=Ae.geometry.coordinates.slice());Math.abs(M.lngLat.lng-te[0])>180;)te[0]+=M.lngLat.lng>te[0]?360:-360;!this.map||(K=this.popupManager)===null||K===void 0||K.add(te,Ae,j)}onAdd(M){if(this.map=M,this.popupManager=new q_(this.map),this.targets.length>0){const j=this;this.targets.forEach(K=>{M.on("click",K,function(te){j.createPopup(te,K)})})}return this.controlContainer=document.createElement("div"),this.controlContainer.className="mapboxgl-ctrl mapboxgl-ctrl-group",Object.assign(this.controlContainer,{style:"display:none"}),this.popupButton=document.createElement("button"),this.popupButton.className="mapboxgl-ctrl-icon",this.popupButton.type="button",this.controlContainer.appendChild(this.popupButton),this.controlContainer}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.popupButton||(this.controlContainer.parentNode.removeChild(this.controlContainer),this.map=void 0)}}var Z_=$m.default=G_,ef={};Object.defineProperty(ef,"__esModule",{value:!0});var Xm=ef.MapboxStyleSwitcherControl=void 0;class Qc{constructor(M,j){this.styles=M||Qc.DEFAULT_STYLES,this.defaultStyle=j||Qc.DEFAULT_STYLE,this.styleUrl=new $_,this.defaultStyleFromUrl=this.styleUrl.get();let K=!1;for(const te of this.styles)te.title===this.defaultStyleFromUrl&&(K=!0);K||(this.styleUrl.delete(),this.defaultStyleFromUrl=null),this.onDocumentClick=this.onDocumentClick.bind(this)}getDefaultPosition(){return"top-right"}onAdd(M){this.map=M,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("mapboxgl-ctrl"),this.controlContainer.classList.add("mapboxgl-ctrl-group"),this.mapStyleContainer=document.createElement("div"),this.styleButton=document.createElement("button"),this.styleButton.type="button",this.mapStyleContainer.classList.add("mapboxgl-style-list");for(const j of this.styles){const K=document.createElement("button");K.type="button",K.innerText=j.title,K.classList.add(j.title.replace(/[^a-z0-9-]/gi,"_")),K.dataset.uri=JSON.stringify(j.uri),K.dataset.title=j.title,K.addEventListener("click",te=>{const Ae=te.srcElement;if(Ae.classList.contains("active"))return;this.map.setStyle(JSON.parse(Ae.dataset.uri)),this.styleUrl.set(Ae.dataset.title),this.mapStyleContainer.style.display="none",this.styleButton.style.display="block";const y=this.mapStyleContainer.getElementsByClassName("active");for(;y[0];)y[0].classList.remove("active");Ae.classList.add("active")}),j.title===this.defaultStyleFromUrl&&this.mapStyleContainer.getElementsByClassName("active").length===0&&(K.classList.add("active"),this.map.setStyle(j.uri)),!this.defaultStyleFromUrl&&j.title===this.defaultStyle&&this.mapStyleContainer.getElementsByClassName("active").length===0&&(K.classList.add("active"),this.map.setStyle(j.uri)),this.mapStyleContainer.appendChild(K)}return this.styleButton.classList.add("mapboxgl-ctrl-icon"),this.styleButton.classList.add("mapboxgl-style-switcher"),this.styleButton.addEventListener("click",()=>{this.styleButton.style.display="none",this.mapStyleContainer.style.display="block"}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.styleButton),this.controlContainer.appendChild(this.mapStyleContainer),this.controlContainer}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.styleButton||(this.styleButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.map=void 0)}onDocumentClick(M){this.controlContainer&&!this.controlContainer.contains(M.target)&&this.mapStyleContainer&&this.styleButton&&(this.mapStyleContainer.style.display="none",this.styleButton.style.display="block")}}Xm=ef.MapboxStyleSwitcherControl=Qc;Qc.DEFAULT_STYLE="Streets";Qc.DEFAULT_STYLES=[{title:"Dark",uri:"mapbox://styles/mapbox/dark-v10"},{title:"Light",uri:"mapbox://styles/mapbox/light-v10"},{title:"Outdoors",uri:"mapbox://styles/mapbox/outdoors-v11"},{title:"Satellite",uri:"mapbox://styles/mapbox/satellite-streets-v11"},{title:"Streets",uri:"mapbox://styles/mapbox/streets-v11"}];class $_{constructor(){this.STYLE_PATHNAME="style"}getUrl(){const M=window.location,j=new URL(M.href);return j.hash=M.hash,j}updateUrl(M){history.replaceState("","",M.toString())}get(){return this.getUrl().searchParams.get(this.STYLE_PATHNAME)}set(M){const j=this.getUrl();j.searchParams.set(this.STYLE_PATHNAME,M),this.updateUrl(j)}delete(){const M=this.getUrl();M.searchParams.delete(this.STYLE_PATHNAME),this.updateUrl(M)}}var Wm={},tf={},rf={},Mp={},nf={exports:{}},Hm=function(M,j){return function(){for(var te=new Array(arguments.length),Ae=0;Ae<te.length;Ae++)te[Ae]=arguments[Ae];return M.apply(j,te)}},X_=Hm,xc=Object.prototype.toString;function of(P){return xc.call(P)==="[object Array]"}function $d(P){return typeof P=="undefined"}function W_(P){return P!==null&&!$d(P)&&P.constructor!==null&&!$d(P.constructor)&&typeof P.constructor.isBuffer=="function"&&P.constructor.isBuffer(P)}function H_(P){return xc.call(P)==="[object ArrayBuffer]"}function K_(P){return typeof FormData!="undefined"&&P instanceof FormData}function J_(P){var M;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?M=ArrayBuffer.isView(P):M=P&&P.buffer&&P.buffer instanceof ArrayBuffer,M}function Y_(P){return typeof P=="string"}function Q_(P){return typeof P=="number"}function Km(P){return P!==null&&typeof P=="object"}function Sp(P){if(xc.call(P)!=="[object Object]")return!1;var M=Object.getPrototypeOf(P);return M===null||M===Object.prototype}function ev(P){return xc.call(P)==="[object Date]"}function tv(P){return xc.call(P)==="[object File]"}function iv(P){return xc.call(P)==="[object Blob]"}function Jm(P){return xc.call(P)==="[object Function]"}function rv(P){return Km(P)&&Jm(P.pipe)}function nv(P){return typeof URLSearchParams!="undefined"&&P instanceof URLSearchParams}function ov(P){return P.trim?P.trim():P.replace(/^\s+|\s+$/g,"")}function av(){return typeof navigator!="undefined"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"}function af(P,M){if(!(P===null||typeof P=="undefined"))if(typeof P!="object"&&(P=[P]),of(P))for(var j=0,K=P.length;j<K;j++)M.call(null,P[j],j,P);else for(var te in P)Object.prototype.hasOwnProperty.call(P,te)&&M.call(null,P[te],te,P)}function Xd(){var P={};function M(te,Ae){Sp(P[Ae])&&Sp(te)?P[Ae]=Xd(P[Ae],te):Sp(te)?P[Ae]=Xd({},te):of(te)?P[Ae]=te.slice():P[Ae]=te}for(var j=0,K=arguments.length;j<K;j++)af(arguments[j],M);return P}function sv(P,M,j){return af(M,function(te,Ae){j&&typeof te=="function"?P[Ae]=X_(te,j):P[Ae]=te}),P}function lv(P){return P.charCodeAt(0)===65279&&(P=P.slice(1)),P}var ns={isArray:of,isArrayBuffer:H_,isBuffer:W_,isFormData:K_,isArrayBufferView:J_,isString:Y_,isNumber:Q_,isObject:Km,isPlainObject:Sp,isUndefined:$d,isDate:ev,isFile:tv,isBlob:iv,isFunction:Jm,isStream:rv,isURLSearchParams:nv,isStandardBrowserEnv:av,forEach:af,merge:Xd,extend:sv,trim:ov,stripBOM:lv},Wc=ns;function Zf(P){return encodeURIComponent(P).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var Ym=function(M,j,K){if(!j)return M;var te;if(K)te=K(j);else if(Wc.isURLSearchParams(j))te=j.toString();else{var Ae=[];Wc.forEach(j,function(he,it){he===null||typeof he=="undefined"||(Wc.isArray(he)?it=it+"[]":he=[he],Wc.forEach(he,function(Qe){Wc.isDate(Qe)?Qe=Qe.toISOString():Wc.isObject(Qe)&&(Qe=JSON.stringify(Qe)),Ae.push(Zf(it)+"="+Zf(Qe))}))}),te=Ae.join("&")}if(te){var y=M.indexOf("#");y!==-1&&(M=M.slice(0,y)),M+=(M.indexOf("?")===-1?"?":"&")+te}return M},uv=ns;function Lp(){this.handlers=[]}Lp.prototype.use=function(M,j,K){return this.handlers.push({fulfilled:M,rejected:j,synchronous:K?K.synchronous:!1,runWhen:K?K.runWhen:null}),this.handlers.length-1};Lp.prototype.eject=function(M){this.handlers[M]&&(this.handlers[M]=null)};Lp.prototype.forEach=function(M){uv.forEach(this.handlers,function(K){K!==null&&M(K)})};var cv=Lp,hv=ns,pv=function(M,j){hv.forEach(M,function(te,Ae){Ae!==j&&Ae.toUpperCase()===j.toUpperCase()&&(M[j]=te,delete M[Ae])})},Qm=function(M,j,K,te,Ae){return M.config=j,K&&(M.code=K),M.request=te,M.response=Ae,M.isAxiosError=!0,M.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},M},dv=Qm,ey=function(M,j,K,te,Ae){var y=new Error(M);return dv(y,j,K,te,Ae)},fv=ey,mv=function(M,j,K){var te=K.config.validateStatus;!K.status||!te||te(K.status)?M(K):j(fv("Request failed with status code "+K.status,K.config,null,K.request,K))},vp=ns,yv=vp.isStandardBrowserEnv()?function(){return{write:function(j,K,te,Ae,y,x){var he=[];he.push(j+"="+encodeURIComponent(K)),vp.isNumber(te)&&he.push("expires="+new Date(te).toGMTString()),vp.isString(Ae)&&he.push("path="+Ae),vp.isString(y)&&he.push("domain="+y),x===!0&&he.push("secure"),document.cookie=he.join("; ")},read:function(j){var K=document.cookie.match(new RegExp("(^|;\\s*)("+j+")=([^;]*)"));return K?decodeURIComponent(K[3]):null},remove:function(j){this.write(j,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),gv=function(M){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(M)},_v=function(M,j){return j?M.replace(/\/+$/,"")+"/"+j.replace(/^\/+/,""):M},vv=gv,xv=_v,bv=function(M,j){return M&&!vv(j)?xv(M,j):j},Fd=ns,wv=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],Ev=function(M){var j={},K,te,Ae;return M&&Fd.forEach(M.split(`
`),function(x){if(Ae=x.indexOf(":"),K=Fd.trim(x.substr(0,Ae)).toLowerCase(),te=Fd.trim(x.substr(Ae+1)),K){if(j[K]&&wv.indexOf(K)>=0)return;K==="set-cookie"?j[K]=(j[K]?j[K]:[]).concat([te]):j[K]=j[K]?j[K]+", "+te:te}}),j},$f=ns,Sv=$f.isStandardBrowserEnv()?function(){var M=/(msie|trident)/i.test(navigator.userAgent),j=document.createElement("a"),K;function te(Ae){var y=Ae;return M&&(j.setAttribute("href",y),y=j.href),j.setAttribute("href",y),{href:j.href,protocol:j.protocol?j.protocol.replace(/:$/,""):"",host:j.host,search:j.search?j.search.replace(/^\?/,""):"",hash:j.hash?j.hash.replace(/^#/,""):"",hostname:j.hostname,port:j.port,pathname:j.pathname.charAt(0)==="/"?j.pathname:"/"+j.pathname}}return K=te(window.location.href),function(y){var x=$f.isString(y)?te(y):y;return x.protocol===K.protocol&&x.host===K.host}}():function(){return function(){return!0}}(),xp=ns,Tv=mv,Iv=yv,Av=Ym,Cv=bv,zv=Ev,Pv=Sv,Ud=ey,Xf=function(M){return new Promise(function(K,te){var Ae=M.data,y=M.headers,x=M.responseType;xp.isFormData(Ae)&&delete y["Content-Type"];var he=new XMLHttpRequest;if(M.auth){var it=M.auth.username||"",Ke=M.auth.password?unescape(encodeURIComponent(M.auth.password)):"";y.Authorization="Basic "+btoa(it+":"+Ke)}var Qe=Cv(M.baseURL,M.url);he.open(M.method.toUpperCase(),Av(Qe,M.params,M.paramsSerializer),!0),he.timeout=M.timeout;function Se(){if(!!he){var yt="getAllResponseHeaders"in he?zv(he.getAllResponseHeaders()):null,ti=!x||x==="text"||x==="json"?he.responseText:he.response,zt={data:ti,status:he.status,statusText:he.statusText,headers:yt,config:M,request:he};Tv(K,te,zt),he=null}}if("onloadend"in he?he.onloadend=Se:he.onreadystatechange=function(){!he||he.readyState!==4||he.status===0&&!(he.responseURL&&he.responseURL.indexOf("file:")===0)||setTimeout(Se)},he.onabort=function(){!he||(te(Ud("Request aborted",M,"ECONNABORTED",he)),he=null)},he.onerror=function(){te(Ud("Network Error",M,null,he)),he=null},he.ontimeout=function(){var ti="timeout of "+M.timeout+"ms exceeded";M.timeoutErrorMessage&&(ti=M.timeoutErrorMessage),te(Ud(ti,M,M.transitional&&M.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",he)),he=null},xp.isStandardBrowserEnv()){var It=(M.withCredentials||Pv(Qe))&&M.xsrfCookieName?Iv.read(M.xsrfCookieName):void 0;It&&(y[M.xsrfHeaderName]=It)}"setRequestHeader"in he&&xp.forEach(y,function(ti,zt){typeof Ae=="undefined"&&zt.toLowerCase()==="content-type"?delete y[zt]:he.setRequestHeader(zt,ti)}),xp.isUndefined(M.withCredentials)||(he.withCredentials=!!M.withCredentials),x&&x!=="json"&&(he.responseType=M.responseType),typeof M.onDownloadProgress=="function"&&he.addEventListener("progress",M.onDownloadProgress),typeof M.onUploadProgress=="function"&&he.upload&&he.upload.addEventListener("progress",M.onUploadProgress),M.cancelToken&&M.cancelToken.promise.then(function(ti){!he||(he.abort(),te(ti),he=null)}),Ae||(Ae=null),he.send(Ae)})},Oo=ns,Wf=pv,kv=Qm,Mv={"Content-Type":"application/x-www-form-urlencoded"};function Hf(P,M){!Oo.isUndefined(P)&&Oo.isUndefined(P["Content-Type"])&&(P["Content-Type"]=M)}function Lv(){var P;return(typeof XMLHttpRequest!="undefined"||typeof process!="undefined"&&Object.prototype.toString.call(process)==="[object process]")&&(P=Xf),P}function Dv(P,M,j){if(Oo.isString(P))try{return(M||JSON.parse)(P),Oo.trim(P)}catch(K){if(K.name!=="SyntaxError")throw K}return(j||JSON.stringify)(P)}var Dp={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:Lv(),transformRequest:[function(M,j){return Wf(j,"Accept"),Wf(j,"Content-Type"),Oo.isFormData(M)||Oo.isArrayBuffer(M)||Oo.isBuffer(M)||Oo.isStream(M)||Oo.isFile(M)||Oo.isBlob(M)?M:Oo.isArrayBufferView(M)?M.buffer:Oo.isURLSearchParams(M)?(Hf(j,"application/x-www-form-urlencoded;charset=utf-8"),M.toString()):Oo.isObject(M)||j&&j["Content-Type"]==="application/json"?(Hf(j,"application/json"),Dv(M)):M}],transformResponse:[function(M){var j=this.transitional,K=j&&j.silentJSONParsing,te=j&&j.forcedJSONParsing,Ae=!K&&this.responseType==="json";if(Ae||te&&Oo.isString(M)&&M.length)try{return JSON.parse(M)}catch(y){if(Ae)throw y.name==="SyntaxError"?kv(y,this,"E_JSON_PARSE"):y}return M}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(M){return M>=200&&M<300}};Dp.headers={common:{Accept:"application/json, text/plain, */*"}};Oo.forEach(["delete","get","head"],function(M){Dp.headers[M]={}});Oo.forEach(["post","put","patch"],function(M){Dp.headers[M]=Oo.merge(Mv)});var sf=Dp,Rv=ns,Bv=sf,Ov=function(M,j,K){var te=this||Bv;return Rv.forEach(K,function(y){M=y.call(te,M,j)}),M},ty=function(M){return!!(M&&M.__CANCEL__)},Kf=ns,Vd=Ov,Fv=ty,Uv=sf;function Nd(P){P.cancelToken&&P.cancelToken.throwIfRequested()}var Vv=function(M){Nd(M),M.headers=M.headers||{},M.data=Vd.call(M,M.data,M.headers,M.transformRequest),M.headers=Kf.merge(M.headers.common||{},M.headers[M.method]||{},M.headers),Kf.forEach(["delete","get","head","post","put","patch","common"],function(te){delete M.headers[te]});var j=M.adapter||Uv.adapter;return j(M).then(function(te){return Nd(M),te.data=Vd.call(M,te.data,te.headers,M.transformResponse),te},function(te){return Fv(te)||(Nd(M),te&&te.response&&(te.response.data=Vd.call(M,te.response.data,te.response.headers,M.transformResponse))),Promise.reject(te)})},ea=ns,iy=function(M,j){j=j||{};var K={},te=["url","method","data"],Ae=["headers","auth","proxy","params"],y=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],x=["validateStatus"];function he(Se,It){return ea.isPlainObject(Se)&&ea.isPlainObject(It)?ea.merge(Se,It):ea.isPlainObject(It)?ea.merge({},It):ea.isArray(It)?It.slice():It}function it(Se){ea.isUndefined(j[Se])?ea.isUndefined(M[Se])||(K[Se]=he(void 0,M[Se])):K[Se]=he(M[Se],j[Se])}ea.forEach(te,function(It){ea.isUndefined(j[It])||(K[It]=he(void 0,j[It]))}),ea.forEach(Ae,it),ea.forEach(y,function(It){ea.isUndefined(j[It])?ea.isUndefined(M[It])||(K[It]=he(void 0,M[It])):K[It]=he(void 0,j[It])}),ea.forEach(x,function(It){It in j?K[It]=he(M[It],j[It]):It in M&&(K[It]=he(void 0,M[It]))});var Ke=te.concat(Ae).concat(y).concat(x),Qe=Object.keys(M).concat(Object.keys(j)).filter(function(It){return Ke.indexOf(It)===-1});return ea.forEach(Qe,it),K};const Nv="axios",jv="0.21.4",qv="Promise based HTTP client for the browser and node.js",Gv="index.js",Zv={test:"grunt test",start:"node ./sandbox/server.js",build:"NODE_ENV=production grunt build",preversion:"npm test",version:"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json",postversion:"git push && git push --tags",examples:"node ./examples/server.js",coveralls:"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js",fix:"eslint --fix lib/**/*.js"},$v={type:"git",url:"https://github.com/axios/axios.git"},Xv=["xhr","http","ajax","promise","node"],Wv="Matt Zabriskie",Hv="MIT",Kv={url:"https://github.com/axios/axios/issues"},Jv="https://axios-http.com",Yv={coveralls:"^3.0.0","es6-promise":"^4.2.4",grunt:"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1",karma:"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2",minimist:"^1.2.0",mocha:"^8.2.1",sinon:"^4.5.0","terser-webpack-plugin":"^4.2.3",typescript:"^4.0.5","url-search-params":"^0.10.0",webpack:"^4.44.2","webpack-dev-server":"^3.11.0"},Qv={"./lib/adapters/http.js":"./lib/adapters/xhr.js"},ex="dist/axios.min.js",tx="dist/axios.min.js",ix="./index.d.ts",rx={"follow-redirects":"^1.14.0"},nx=[{path:"./dist/axios.min.js",threshold:"5kB"}];var ox={name:Nv,version:jv,description:qv,main:Gv,scripts:Zv,repository:$v,keywords:Xv,author:Wv,license:Hv,bugs:Kv,homepage:Jv,devDependencies:Yv,browser:Qv,jsdelivr:ex,unpkg:tx,typings:ix,dependencies:rx,bundlesize:nx},ry=ox,lf={};["object","boolean","number","function","string","symbol"].forEach(function(P,M){lf[P]=function(K){return typeof K===P||"a"+(M<1?"n ":" ")+P}});var Jf={},ax=ry.version.split(".");function ny(P,M){for(var j=M?M.split("."):ax,K=P.split("."),te=0;te<3;te++){if(j[te]>K[te])return!0;if(j[te]<K[te])return!1}return!1}lf.transitional=function(M,j,K){var te=j&&ny(j);function Ae(y,x){return"[Axios v"+ry.version+"] Transitional option '"+y+"'"+x+(K?". "+K:"")}return function(y,x,he){if(M===!1)throw new Error(Ae(x," has been removed in "+j));return te&&!Jf[x]&&(Jf[x]=!0,console.warn(Ae(x," has been deprecated since v"+j+" and will be removed in the near future"))),M?M(y,x,he):!0}};function sx(P,M,j){if(typeof P!="object")throw new TypeError("options must be an object");for(var K=Object.keys(P),te=K.length;te-- >0;){var Ae=K[te],y=M[Ae];if(y){var x=P[Ae],he=x===void 0||y(x,Ae,P);if(he!==!0)throw new TypeError("option "+Ae+" must be "+he);continue}if(j!==!0)throw Error("Unknown option "+Ae)}}var lx={isOlderVersion:ny,assertOptions:sx,validators:lf},oy=ns,ux=Ym,Yf=cv,Qf=Vv,Rp=iy,ay=lx,Hc=ay.validators;function Bh(P){this.defaults=P,this.interceptors={request:new Yf,response:new Yf}}Bh.prototype.request=function(M){typeof M=="string"?(M=arguments[1]||{},M.url=arguments[0]):M=M||{},M=Rp(this.defaults,M),M.method?M.method=M.method.toLowerCase():this.defaults.method?M.method=this.defaults.method.toLowerCase():M.method="get";var j=M.transitional;j!==void 0&&ay.assertOptions(j,{silentJSONParsing:Hc.transitional(Hc.boolean,"1.0.0"),forcedJSONParsing:Hc.transitional(Hc.boolean,"1.0.0"),clarifyTimeoutError:Hc.transitional(Hc.boolean,"1.0.0")},!1);var K=[],te=!0;this.interceptors.request.forEach(function(Se){typeof Se.runWhen=="function"&&Se.runWhen(M)===!1||(te=te&&Se.synchronous,K.unshift(Se.fulfilled,Se.rejected))});var Ae=[];this.interceptors.response.forEach(function(Se){Ae.push(Se.fulfilled,Se.rejected)});var y;if(!te){var x=[Qf,void 0];for(Array.prototype.unshift.apply(x,K),x=x.concat(Ae),y=Promise.resolve(M);x.length;)y=y.then(x.shift(),x.shift());return y}for(var he=M;K.length;){var it=K.shift(),Ke=K.shift();try{he=it(he)}catch(Qe){Ke(Qe);break}}try{y=Qf(he)}catch(Qe){return Promise.reject(Qe)}for(;Ae.length;)y=y.then(Ae.shift(),Ae.shift());return y};Bh.prototype.getUri=function(M){return M=Rp(this.defaults,M),ux(M.url,M.params,M.paramsSerializer).replace(/^\?/,"")};oy.forEach(["delete","get","head","options"],function(M){Bh.prototype[M]=function(j,K){return this.request(Rp(K||{},{method:M,url:j,data:(K||{}).data}))}});oy.forEach(["post","put","patch"],function(M){Bh.prototype[M]=function(j,K,te){return this.request(Rp(te||{},{method:M,url:j,data:K}))}});var cx=Bh;function uf(P){this.message=P}uf.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")};uf.prototype.__CANCEL__=!0;var sy=uf,hx=sy;function zp(P){if(typeof P!="function")throw new TypeError("executor must be a function.");var M;this.promise=new Promise(function(te){M=te});var j=this;P(function(te){j.reason||(j.reason=new hx(te),M(j.reason))})}zp.prototype.throwIfRequested=function(){if(this.reason)throw this.reason};zp.source=function(){var M,j=new zp(function(te){M=te});return{token:j,cancel:M}};var px=zp,dx=function(M){return function(K){return M.apply(null,K)}},fx=function(M){return typeof M=="object"&&M.isAxiosError===!0},em=ns,mx=Hm,Tp=cx,yx=iy,gx=sf;function ly(P){var M=new Tp(P),j=mx(Tp.prototype.request,M);return em.extend(j,Tp.prototype,M),em.extend(j,M),j}var nl=ly(gx);nl.Axios=Tp;nl.create=function(M){return ly(yx(nl.defaults,M))};nl.Cancel=sy;nl.CancelToken=px;nl.isCancel=ty;nl.all=function(M){return Promise.all(M)};nl.spread=dx;nl.isAxiosError=fx;nf.exports=nl;nf.exports.default=nl;var _x=nf.exports;(function(P){Object.defineProperty(P,"__esModule",{value:!0}),P.ContourType=P.Costing=void 0;const M=_x,j=Qd.exports;P.Costing={Walking:"pedestrian",Bicycle:"bicycle",Car:"auto"},P.ContourType={Time:"time",Distance:"distance"};class K{constructor(Ae,y,x){this.contourSources=[],this.contourLayers=[],this.contourMaker=void 0,this.contours=[{time:5,distance:1,color:"ff0000"},{time:10,distance:3,color:"ffff00"},{time:15,distance:5,color:"0000ff"}],this.map=Ae,this.url=y,x&&(this.contours=x)}clearFeatures(){this.contourLayers&&this.contourLayers.length>0&&(this.contourLayers.forEach(Ae=>{var y;(y=this.map)===null||y===void 0||y.removeLayer(Ae)}),this.contourLayers=[]),this.contourSources&&this.contourSources.length>0&&(this.contourSources.forEach(Ae=>{var y;(y=this.map)===null||y===void 0||y.removeSource(Ae)}),this.contourSources=[]),this.contourMaker&&(this.contourMaker.remove(),this.contourMaker=void 0)}getIsochrone(Ae,y,x,he,it){this.clearFeatures();let Ke=JSON.parse(JSON.stringify(this.contours));it&&(Ke=it),Ke.forEach(Se=>{x===P.ContourType.Time?delete Se.distance:delete Se.time});let Qe="km";return x===P.ContourType.Time&&(Qe="min"),new Promise((Se,It)=>{const yt={locations:[{lat:y,lon:Ae}],costing:he,contours:Ke,polygons:!0},ti=`${this.url}/isochrone?json=${JSON.stringify(yt)}`;M.default.get(ti).then(zt=>{zt.data.features.forEach(mi=>{var Ht,br,pi,Si;const Ni=`isochrone-${mi.properties.contour}`;(Ht=this.map)===null||Ht===void 0||Ht.addSource(Ni,{type:"geojson",data:mi}),this.contourSources.push(Ni),(br=this.map)===null||br===void 0||br.addLayer({id:`pg-${Ni}`,type:"fill",source:Ni,layout:{},paint:{"fill-color":mi.properties.fillColor,"fill-opacity":.1}}),this.contourLayers.push(`pg-${Ni}`),(pi=this.map)===null||pi===void 0||pi.addLayer({id:`ls-${Ni}`,type:"line",source:Ni,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":mi.properties.fillColor,"line-width":3}}),this.contourLayers.push(`ls-${Ni}`),(Si=this.map)===null||Si===void 0||Si.addLayer({id:`symbol-${Ni}`,type:"symbol",source:Ni,layout:{"symbol-placement":"line","text-pitch-alignment":"viewport","text-font":["Roboto Bold"],"text-field":["concat",["get","contour"],` ${Qe}`],"text-size":16},paint:{"text-color":"#000000","text-halo-width":1,"text-halo-color":"#FFFFFF"}}),this.contourLayers.push(`symbol-${Ni}`)}),this.map&&(this.contourMaker=new j.Marker().setLngLat([Ae,y]).addTo(this.map)),Se()}).catch(zt=>It(zt))})}getContoursOption(){return this.contours}}P.default=K})(Mp);var Bp={};Object.defineProperty(Bp,"__esModule",{value:!0});class vx{constructor(M){this.color="#535353",this.map=M}create(){this.updateValues(),this.map!==void 0?(this.map.on("resize",this.mapResize.bind(this)),this.createCanvas(this.map.getCanvasContainer())):console.error("map object is null")}updateValues(){var M,j;this.width=(M=this.map)===null||M===void 0?void 0:M.getCanvas().clientWidth,this.height=(j=this.map)===null||j===void 0?void 0:j.getCanvas().clientHeight}mapResize(){this.updateValues(),this.updateCanvas()}updateCanvas(){if(this.svgCanvas!==void 0&&this.yLine!==void 0&&this.xLine!==void 0&&this.width!==void 0&&this.height!==void 0){this.svgCanvas.setAttribute("width",`${this.width}px`),this.svgCanvas.setAttribute("height",`${this.height}px`);const M=this.width/2,j=this.height/2;this.yLine.setAttribute("x1",`${M}px`),this.yLine.setAttribute("y1","0px"),this.yLine.setAttribute("x2",`${M}px`),this.yLine.setAttribute("y2",`${this.height}px`),this.xLine.setAttribute("x1",`${0}px`),this.xLine.setAttribute("y1",`${j}px`),this.xLine.setAttribute("x2",`${this.width}px`),this.xLine.setAttribute("y2",`${j}px`)}}createCanvas(M){if(this.width!==void 0&&this.height!==void 0){const j=document.createElementNS("http://www.w3.org/2000/svg","svg");j.style.position="relative",j.setAttribute("width",`${this.width}px`),j.setAttribute("height",`${this.height}px`);const K=this.width/2,te=this.height/2;this.yLine=j.appendChild(this.createLine(K,0,K,this.height,this.color,"2px")),this.xLine=j.appendChild(this.createLine(0,te,this.width,te,this.color,"2px")),M==null||M.appendChild(j),this.svgCanvas=j}}createLine(M,j,K,te,Ae,y){const x=document.createElementNS("http://www.w3.org/2000/svg","line");return x.setAttribute("x1",M),x.setAttribute("y1",j),x.setAttribute("x2",K),x.setAttribute("y2",te),x.setAttribute("stroke-dasharray","5,5"),x.setAttribute("stroke",Ae),x.setAttribute("stroke-width",y),x}destroy(){this.xLine!==void 0&&(this.xLine.remove(),this.xLine=void 0),this.yLine!==void 0&&(this.yLine.remove(),this.yLine=void 0),this.svgCanvas!==void 0&&(this.svgCanvas.remove(),this.svgCanvas=void 0),this.map!==void 0&&(this.map.off("resize",this.mapResize),this.map=void 0)}}Bp.default=vx;var vc={};Object.defineProperty(vc,"__esModule",{value:!0});vc.createTextbox=vc.createSelection=void 0;const xx=(P,M,j,K,te)=>{const Ae=document.createElement("label");Ae.textContent=M;const y=document.createElement("select");y.setAttribute("id",`mapbox-gl-valhalla-${j}`),y.style.width="100%",Object.keys(P).forEach(Ke=>{const Qe=document.createElement("option");Qe.setAttribute("value",te(P,Ke)),Qe.appendChild(document.createTextNode(Ke)),Qe.setAttribute("name",j),K===P[Ke]&&(Qe.selected=!0),y.appendChild(Qe)});const x=document.createElement("TR"),he=document.createElement("TD"),it=document.createElement("TD");return he.appendChild(Ae),it.appendChild(y),x.appendChild(he),x.appendChild(it),x};vc.createSelection=xx;const bx=(P,M,j,K,te)=>{const Ae=document.createElement("label");Ae.textContent=P,te||(te="text");const y=document.createElement("input");y.setAttribute("id",`mapbox-gl-valhalla-${M}`),y.setAttribute("type",te),y.setAttribute("value",j),y.readOnly=K;const x=document.createElement("TR"),he=document.createElement("TD"),it=document.createElement("TD");return he.appendChild(Ae),it.appendChild(y),x.appendChild(he),x.appendChild(it),x};vc.createTextbox=bx;Object.defineProperty(rf,"__esModule",{value:!0});const jd=Mp,wx=Bp,bp=vc;class Ex{constructor(M,j){this.map=M,this.valhalla=j,this.onDocumentClick=this.onDocumentClick.bind(this)}addTo(M){var j,K;this.map||console.error("map object is null"),this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("mapboxgl-ctrl"),this.controlContainer.classList.add("mapboxgl-ctrl-group"),this.mainContainer=document.createElement("div"),this.mainContainer.classList.add("mapboxgl-valhalla-list"),this.mainButton=document.createElement("button"),this.mainButton.classList.add("mapboxgl-ctrl-icon"),this.mainButton.classList.add("mapboxgl-valhalla-time-isochrone-control"),this.mainButton.addEventListener("click",()=>{this.mainButton.style.display="none",this.mainContainer.style.display="block",this.toggleCrosshair(!0)}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.mainButton),this.controlContainer.appendChild(this.mainContainer);const te=document.createElement("TABLE");te.className="valhalla-table",this.mainContainer.appendChild(te);const Ae=bp.createSelection(jd.Costing,"Means of transport","costing",jd.Costing.Walking,(Ke,Qe)=>Ke[Qe]);te.appendChild(Ae);const y=(j=this.map)===null||j===void 0?void 0:j.getCenter();if(y){const Ke=bp.createTextbox("Longitude","lon-time",y.lng,!0);te.appendChild(Ke);const Qe=bp.createTextbox("Latitude","lat-time",y.lat,!0);te.appendChild(Qe)}const x=this.valhalla.getContoursOption();for(let Ke=0;Ke<x.length;Ke+=1){const Qe=x[Ke],Se=bp.createTextbox(`Contour ${Ke+1} (min)`,`contour-time-${Ke}`,Qe.time,!1,"number");te.appendChild(Se)}const he=document.createElement("button");he.textContent="Clear",he.classList.add("mapbox-valhalla-control-button"),he.addEventListener("click",()=>{this.valhalla.clearFeatures()}),this.mainContainer.appendChild(he);const it=document.createElement("button");return it.textContent="Calculate",it.classList.add("mapbox-valhalla-control-button"),it.addEventListener("click",()=>{const Ke=document.getElementById("mapbox-gl-valhalla-lon-time"),Qe=document.getElementById("mapbox-gl-valhalla-lat-time"),Se=document.getElementById("mapbox-gl-valhalla-costing"),It=this.valhalla.getContoursOption();for(let yt=0;yt<It.length;yt+=1){const ti=It[yt],zt=document.getElementById(`mapbox-gl-valhalla-contour-time-${yt}`);ti.time=Number(zt.value)}this.valhalla.getIsochrone(Number(Ke.value),Number(Qe.value),jd.ContourType.Time,Se.value,It)}),this.mainContainer.appendChild(it),(K=this.map)===null||K===void 0||K.on("moveend",()=>{var Ke;const Qe=(Ke=this.map)===null||Ke===void 0?void 0:Ke.getCenter(),Se=document.getElementById("mapbox-gl-valhalla-lon-time"),It=document.getElementById("mapbox-gl-valhalla-lat-time");Qe||(Se.setAttribute("value",""),It.setAttribute("value",""));const yt=Qe,ti=yt!=null&&yt.lng?yt.lng.toString():"";Se.setAttribute("value",ti);const zt=yt!=null&&yt.lat?yt.lat.toString():"";It.setAttribute("value",zt)}),M.appendChild(this.controlContainer),M}onDocumentClick(M){this.controlContainer&&!this.controlContainer.contains(M.target)&&this.hide()}hide(){this.mainContainer&&this.mainButton&&(this.mainContainer.style.display="none",this.mainButton.style.display="block",this.toggleCrosshair(!1))}destroy(){!this.mainContainer||!this.mainContainer.parentNode||!this.map||!this.mainButton||(this.mainButton.removeEventListener("click",this.onDocumentClick),this.mainContainer.parentNode.removeChild(this.mainContainer),document.removeEventListener("click",this.onDocumentClick),this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0),this.map=void 0)}toggleCrosshair(M){M===!1?this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0):(this.crosshair=new wx.default(this.map),this.crosshair.create())}}rf.default=Ex;var cf={};Object.defineProperty(cf,"__esModule",{value:!0});const tm=Mp,Sx=Bp,qd=vc;class Tx{constructor(M,j){this.map=M,this.valhalla=j,this.onDocumentClick=this.onDocumentClick.bind(this)}addTo(M){var j,K;this.map||console.error("map object is null"),this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("mapboxgl-ctrl"),this.controlContainer.classList.add("mapboxgl-ctrl-group"),this.mainContainer=document.createElement("div"),this.mainContainer.classList.add("mapboxgl-valhalla-list"),this.mainButton=document.createElement("button"),this.mainButton.classList.add("mapboxgl-ctrl-icon"),this.mainButton.classList.add("mapboxgl-valhalla-distance-isochrone-control"),this.mainButton.addEventListener("click",()=>{this.mainButton.style.display="none",this.mainContainer.style.display="block",this.toggleCrosshair(!0)}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.mainButton),this.controlContainer.appendChild(this.mainContainer);const te=document.createElement("TABLE");te.className="valhalla-table",this.mainContainer.appendChild(te);const Ae=(j=this.map)===null||j===void 0?void 0:j.getCenter();if(Ae){const it=qd.createTextbox("Longitude","lon-distance",Ae.lng,!0);te.appendChild(it);const Ke=qd.createTextbox("Latitude","lat-distance",Ae.lat,!0);te.appendChild(Ke)}const y=this.valhalla.getContoursOption();for(let it=0;it<y.length;it+=1){const Ke=y[it],Qe=qd.createTextbox(`Contour ${it+1} (km)`,`contour-distance-${it}`,Ke.distance,!1,"number");te.appendChild(Qe)}const x=document.createElement("button");x.textContent="Clear",x.classList.add("mapbox-valhalla-control-button"),x.addEventListener("click",()=>{this.valhalla.clearFeatures()}),this.mainContainer.appendChild(x);const he=document.createElement("button");return he.textContent="Calculate",he.classList.add("mapbox-valhalla-control-button"),he.addEventListener("click",()=>{const it=document.getElementById("mapbox-gl-valhalla-lon-distance"),Ke=document.getElementById("mapbox-gl-valhalla-lat-distance"),Qe=this.valhalla.getContoursOption();for(let Se=0;Se<Qe.length;Se+=1){const It=Qe[Se],yt=document.getElementById(`mapbox-gl-valhalla-contour-distance-${Se}`);It.distance=Number(yt.value)}this.valhalla.getIsochrone(Number(it.value),Number(Ke.value),tm.ContourType.Distance,tm.Costing.Walking,Qe)}),this.mainContainer.appendChild(he),(K=this.map)===null||K===void 0||K.on("moveend",()=>{var it;const Ke=(it=this.map)===null||it===void 0?void 0:it.getCenter(),Qe=document.getElementById("mapbox-gl-valhalla-lon-distance"),Se=document.getElementById("mapbox-gl-valhalla-lat-distance");Ke||(Qe.setAttribute("value",""),Se.setAttribute("value",""));const It=Ke,yt=It!=null&&It.lng?It.lng.toString():"";Qe.setAttribute("value",yt);const ti=It!=null&&It.lat?It.lat.toString():"";Se.setAttribute("value",ti)}),M.appendChild(this.controlContainer),M}onDocumentClick(M){this.controlContainer&&!this.controlContainer.contains(M.target)&&this.hide()}hide(){this.mainContainer&&this.mainButton&&(this.mainContainer.style.display="none",this.mainButton.style.display="block",this.toggleCrosshair(!1))}destroy(){!this.mainContainer||!this.mainContainer.parentNode||!this.map||!this.mainButton||(this.mainButton.removeEventListener("click",this.onDocumentClick),this.mainContainer.parentNode.removeChild(this.mainContainer),document.removeEventListener("click",this.onDocumentClick),this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0),this.map=void 0)}toggleCrosshair(M){M===!1?this.crosshair!==void 0&&(this.crosshair.destroy(),this.crosshair=void 0):(this.crosshair=new Sx.default(this.map),this.crosshair.create())}}cf.default=Tx;Object.defineProperty(tf,"__esModule",{value:!0});const Ix=rf,Ax=cf,Cx=Mp;class zx{constructor(M,j){this.options={Contours:[{time:5,distance:1,color:"ff0000"},{time:10,distance:3,color:"ffff00"},{time:15,distance:5,color:"0000ff"}]},this.url=M,j&&(this.options=Object.assign(this.options,j)),this.onDocumentClick=this.onDocumentClick.bind(this)}getDefaultPosition(){return"top-right"}onAdd(M){return this.map=M,this.map&&(this.valhalla=new Cx.default(this.map,this.url,this.options.Contours)),this.controlContainer=document.createElement("div"),this.timeIsochroneControl=new Ix.default(this.map,this.valhalla),this.controlContainer=this.timeIsochroneControl.addTo(this.controlContainer),this.distanceIsochroneControl=new Ax.default(this.map,this.valhalla),this.controlContainer=this.distanceIsochroneControl.addTo(this.controlContainer),document.addEventListener("click",this.onDocumentClick),this.controlContainer}onDocumentClick(M){this.controlContainer&&!this.controlContainer.contains(M.target)&&this.timeIsochroneControl&&this.distanceIsochroneControl&&(this.timeIsochroneControl.hide(),this.distanceIsochroneControl.hide())}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.timeIsochroneControl||!this.distanceIsochroneControl||(this.timeIsochroneControl.destroy(),this.distanceIsochroneControl.destroy(),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.map=void 0)}}tf.default=zx;(function(P){Object.defineProperty(P,"__esModule",{value:!0}),P.MapboxValhallaControl=void 0;var M=tf;Object.defineProperty(P,"MapboxValhallaControl",{enumerable:!0,get:function(){return M.default}})})(Wm);const xn={attribution:"\xA9NARWASSCO",styles:[{title:"UNVT(Water)",uri:"https://narwassco.github.io/mapbox-stylefiles/unvt/style.json"},{title:"UNVT(Sewer",uri:"https://narwassco.github.io/mapbox-stylefiles/unvt/style-sewer.json"}],center:{lng:35.87063,lat:-1.08551},zoom:13,search:{url:"https://narwassco.github.io/vt/meter.geojson",target:["connno","serialno"],format:P=>`${P.customer}, ${P.connno}, ${P.serialno}, ${P.village}`,place_type:["meter"],placeholder:"Search CONN NO or S/N",zoom:17},popup:{target:["meter","flow meter","valve","washout","firehydrant","tank","pipeline"]},areaSwitcher:{areas:[{title:"Narok",latlng:[35.87063,-1.08551],zoom:14},{title:"Ololulung'a",latlng:[35.65072,-1.0085],zoom:13},{title:"Kilgoris",latlng:[34.87533,-1.00278],zoom:14},{title:"Suswa",latlng:[36.33078,-1.05307],zoom:13}]},legend:{targets:{pipeline:"Pipeline",pipeline_annotation:"Pipeline Label",meter:"Water Meter","flow meter":"Flow Meter",valve:"Valve",firehydrant:"Fire Hydrant",washout:"Washout",tank:"Tank",tank_annotation:"Tank Label",wtp:"WTP",wtp_annotation:"WTP Label",intake:"Intake",intake_annotation:"Intake Label",parcels:"Parcels",parcels_annotation:"Parcels Label",village:"Village",village_annotation:"Village Label",dma:"DMA","dma-annotation":"DMA Label","contour-line":"Countour","contour-label":"Contour Label",hillshade:"Hillshade"},options:{showDefault:!1,showCheckbox:!0,reverseOrder:!0,onlyRendered:!0}},elevation:{url:"https://narwassco.github.io/narok-terrain/tiles/{z}/{x}/{y}.png",options:{tileSize:512,font:["Roboto Medium"],fontSize:12,fontHalo:1,mainColor:"#263238",haloColor:"#fff",units:"kilometers"}},valhalla:{url:"https://valhalla.water-gis.com",options:{Contours:[{time:3,distance:1,color:"ff0000"},{time:5,distance:2,color:"ffff00"},{time:10,distance:3,color:"0000ff"},{time:15,distance:4,color:"ff00ff"}]}}};function Px(P){let M;return{c(){M=om("div"),this.h()},l(j){M=am(j,"DIV",{class:!0,id:!0}),sm(M).forEach(Ip),this.h()},h(){Rf(M,"class","map svelte-qhutam"),Rf(M,"id","map")},m(j,K){lm(j,M,K),P[1](M)},p:wp,i:wp,o:wp,d(j){j&&Ip(M),P[1](null)}}}function kx(P,M,j){let K,te;by(async()=>{if(K=new _c.exports.Map({container:te,style:xn.styles[0].uri,center:xn.center,zoom:xn.zoom,hash:!0,attributionControl:!1}),K.addControl(new _c.exports.NavigationControl({}),"top-right"),K.addControl(new _c.exports.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),"top-right"),K.addControl(new _c.exports.ScaleControl({maxWidth:80,unit:"metric"}),"bottom-left"),K.addControl(new _c.exports.AttributionControl({compact:!0}),"bottom-right"),K.addControl(new Xm(xn.styles),"top-right"),K.addControl(new N_(xn.areaSwitcher.areas),"top-right"),xn.elevation){const Qe=await(await kd(()=>import("./index-cccbb6d8.js").then(function(Se){return Se.i}),[])).default;K.addControl(new Qe(xn.elevation.url,xn.elevation.options),"top-right")}const{MaplibreExportControl:y,Size:x,PageOrientation:he,Format:it,DPI:Ke}=await kd(()=>import("./index-f3dd1617.js").then(function(Qe){return Qe.i}),[]);if(K.addControl(new y({PageSize:x.A4,PageOrientation:he.Landscape,Format:it.PNG,DPI:Ke[96],Crosshair:!0,PrintableArea:!0}),"top-right"),xn.valhalla&&K.addControl(new Wm.MapboxValhallaControl(xn.valhalla.url,xn.valhalla.options),"top-right"),xn.legend){const{MaplibreLegendControl:Qe}=await kd(()=>import("./index-ecf6943c.js").then(function(Se){return Se.i}),[]);K.addControl(new Qe(xn.legend.targets,xn.legend.options),"bottom-left")}xn.popup&&K.addControl(new Z_(xn.popup.target)),xn.search&&fetch(xn.search.url).then(Qe=>Qe.json()).then(Qe=>{const Se=Qe;function It(yt){for(var ti=[],zt=0;zt<Se.features.length;zt++){var Ei=Se.features[zt];xn.search.target.forEach(mi=>{var Ht=Ei.properties[mi];!Ht||Ht.toString().toLowerCase().search(yt.toString().toLowerCase())!==-1&&(Ei.place_name=xn.search.format(Ei.properties),Ei.center=Ei.geometry.coordinates,Ei.place_type=xn.search.place_type,ti.push(Ei))})}return ti}K.addControl(new V_({localGeocoder:It,localGeocoderOnly:!0,zoom:xn.search.zoom,placeholder:xn.search.placeholder,mapboxgl:Py}),"top-left")})});function Ae(y){wy[y?"unshift":"push"](()=>{te=y,j(0,te)})}return[te,Ae]}class Mx extends im{constructor(M){super(),rm(this,M,kx,Px,nm,{})}}function Lx(P){let M,j,K;return j=new Mx({}),{c(){M=om("div"),Ey(j.$$.fragment)},l(te){M=am(te,"DIV",{});var Ae=sm(M);Sy(j.$$.fragment,Ae),Ae.forEach(Ip)},m(te,Ae){lm(te,M,Ae),Ty(j,M,null),K=!0},p:wp,i(te){K||(Iy(j.$$.fragment,te),K=!0)},o(te){Ay(j.$$.fragment,te),K=!1},d(te){te&&Ip(M),Cy(j)}}}class Ox extends im{constructor(M){super(),rm(this,M,null,Lx,nm,{})}}export{Ox as R,_x as a,Bx as b,Es as c,zy as g,_c as m};
